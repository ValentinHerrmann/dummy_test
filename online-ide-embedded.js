var Av=Object.defineProperty;var Mv=(r,e,t)=>e in r?Av(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ev=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var y=(r,e,t)=>(Mv(r,typeof e!="symbol"?e+"":e,t),t);var gI=Ev((_I,rc)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var f=(r=>(r[r.identifier=0]="identifier",r[r.integerConstant=1]="integerConstant",r[r.longConstant=2]="longConstant",r[r.shortConstant=3]="shortConstant",r[r.floatingPointConstant=4]="floatingPointConstant",r[r.booleanConstant=5]="booleanConstant",r[r.stringConstant=6]="stringConstant",r[r.charConstant=7]="charConstant",r[r.true=8]="true",r[r.false=9]="false",r[r.keywordPrint=10]="keywordPrint",r[r.keywordPrintln=11]="keywordPrintln",r[r.keywordClass=12]="keywordClass",r[r.keywordThis=13]="keywordThis",r[r.keywordSuper=14]="keywordSuper",r[r.keywordNew=15]="keywordNew",r[r.keywordInterface=16]="keywordInterface",r[r.keywordEnum=17]="keywordEnum",r[r.keywordVoid=18]="keywordVoid",r[r.keywordAbstract=19]="keywordAbstract",r[r.keywordPublic=20]="keywordPublic",r[r.keywordProtected=21]="keywordProtected",r[r.keywordPrivate=22]="keywordPrivate",r[r.keywordTransient=23]="keywordTransient",r[r.keywordStatic=24]="keywordStatic",r[r.keywordExtends=25]="keywordExtends",r[r.keywordImplements=26]="keywordImplements",r[r.keywordWhile=27]="keywordWhile",r[r.keywordDo=28]="keywordDo",r[r.keywordFor=29]="keywordFor",r[r.keywordSwitch=30]="keywordSwitch",r[r.keywordCase=31]="keywordCase",r[r.keywordDefault=32]="keywordDefault",r[r.keywordIf=33]="keywordIf",r[r.keywordThen=34]="keywordThen",r[r.keywordElse=35]="keywordElse",r[r.keywordReturn=36]="keywordReturn",r[r.keywordBreak=37]="keywordBreak",r[r.keywordContinue=38]="keywordContinue",r[r.keywordNull=39]="keywordNull",r[r.keywordFinal=40]="keywordFinal",r[r.keywordInstanceof=41]="keywordInstanceof",r[r.leftBracket=42]="leftBracket",r[r.rightBracket=43]="rightBracket",r[r.leftSquareBracket=44]="leftSquareBracket",r[r.rightSquareBracket=45]="rightSquareBracket",r[r.leftCurlyBracket=46]="leftCurlyBracket",r[r.rightCurlyBracket=47]="rightCurlyBracket",r[r.leftRightSquareBracket=48]="leftRightSquareBracket",r[r.doubleMinus=49]="doubleMinus",r[r.doublePlus=50]="doublePlus",r[r.dot=51]="dot",r[r.modulo=52]="modulo",r[r.minus=53]="minus",r[r.plus=54]="plus",r[r.multiplication=55]="multiplication",r[r.division=56]="division",r[r.singleQuote=57]="singleQuote",r[r.doubleQuote=58]="doubleQuote",r[r.lower=59]="lower",r[r.greater=60]="greater",r[r.lowerOrEqual=61]="lowerOrEqual",r[r.greaterOrEqual=62]="greaterOrEqual",r[r.equal=63]="equal",r[r.notEqual=64]="notEqual",r[r.assignment=65]="assignment",r[r.plusAssignment=66]="plusAssignment",r[r.minusAssignment=67]="minusAssignment",r[r.multiplicationAssignment=68]="multiplicationAssignment",r[r.divisionAssignment=69]="divisionAssignment",r[r.divisionAssignmentInteger=70]="divisionAssignmentInteger",r[r.moduloAssignment=71]="moduloAssignment",r[r.and=72]="and",r[r.or=73]="or",r[r.ampersand=74]="ampersand",r[r.ANDAssigment=75]="ANDAssigment",r[r.XORAssigment=76]="XORAssigment",r[r.ORAssigment=77]="ORAssigment",r[r.shiftLeftAssigment=78]="shiftLeftAssigment",r[r.shiftRightAssigment=79]="shiftRightAssigment",r[r.shiftRightUnsignedAssigment=80]="shiftRightUnsignedAssigment",r[r.OR=81]="OR",r[r.XOR=82]="XOR",r[r.tilde=83]="tilde",r[r.shiftRightUnsigned=84]="shiftRightUnsigned",r[r.shiftRight=85]="shiftRight",r[r.shiftLeft=86]="shiftLeft",r[r.ternaryOperator=87]="ternaryOperator",r[r.colon=88]="colon",r[r.ellipsis=89]="ellipsis",r[r.not=90]="not",r[r.semicolon=91]="semicolon",r[r.comma=92]="comma",r[r.backslash=93]="backslash",r[r.at=94]="at",r[r.space=95]="space",r[r.tab=96]="tab",r[r.newline=97]="newline",r[r.linefeed=98]="linefeed",r[r.identifierChar=99]="identifierChar",r[r.comment=100]="comment",r[r.negation=101]="negation",r[r.referenceElement=102]="referenceElement",r[r.endofSourcecode=103]="endofSourcecode",r[r.binaryOp=104]="binaryOp",r[r.unaryOp=105]="unaryOp",r[r.localVariableDeclaration=106]="localVariableDeclaration",r[r.heapVariableDeclaration=107]="heapVariableDeclaration",r[r.pushLocalVariableToStack=108]="pushLocalVariableToStack",r[r.popAndStoreIntoVariable=109]="popAndStoreIntoVariable",r[r.pushFromHeapToStack=110]="pushFromHeapToStack",r[r.pushAttribute=111]="pushAttribute",r[r.pushArrayLength=112]="pushArrayLength",r[r.pushConstant=113]="pushConstant",r[r.pushStaticClassObject=114]="pushStaticClassObject",r[r.pushStaticAttribute=115]="pushStaticAttribute",r[r.pushStaticAttributeIntrinsic=116]="pushStaticAttributeIntrinsic",r[r.checkCast=117]="checkCast",r[r.castValue=118]="castValue",r[r.selectArrayElement=119]="selectArrayElement",r[r.callMethod=120]="callMethod",r[r.callMainMethod=121]="callMainMethod",r[r.processPostConstructorCallbacks=122]="processPostConstructorCallbacks",r[r.callInputMethod=123]="callInputMethod",r[r.makeEllipsisArray=124]="makeEllipsisArray",r[r.decreaseStackpointer=125]="decreaseStackpointer",r[r.initStackframe=126]="initStackframe",r[r.closeStackframe=127]="closeStackframe",r[r.increaseSpaceForLocalVariables=128]="increaseSpaceForLocalVariables",r[r.return=129]="return",r[r.newObject=130]="newObject",r[r.jumpIfFalse=131]="jumpIfFalse",r[r.jumpIfTrue=132]="jumpIfTrue",r[r.jumpIfFalseAndLeaveOnStack=133]="jumpIfFalseAndLeaveOnStack",r[r.jumpIfTrueAndLeaveOnStack=134]="jumpIfTrueAndLeaveOnStack",r[r.jumpAlways=135]="jumpAlways",r[r.noOp=136]="noOp",r[r.incrementDecrementBefore=137]="incrementDecrementBefore",r[r.incrementDecrementAfter=138]="incrementDecrementAfter",r[r.incrementDecrementCharBefore=139]="incrementDecrementCharBefore",r[r.incrementDecrementCharAfter=140]="incrementDecrementCharAfter",r[r.programEnd=141]="programEnd",r[r.beginArray=142]="beginArray",r[r.addToArray=143]="addToArray",r[r.pushEmptyArray=144]="pushEmptyArray",r[r.forLoopOverCollection=145]="forLoopOverCollection",r[r.type=146]="type",r[r.typeParameter=147]="typeParameter",r[r.attributeDeclaration=148]="attributeDeclaration",r[r.methodDeclaration=149]="methodDeclaration",r[r.parameterDeclaration=150]="parameterDeclaration",r[r.superConstructorCall=151]="superConstructorCall",r[r.constructorCall=152]="constructorCall",r[r.newArray=153]="newArray",r[r.arrayInitialization=154]="arrayInitialization",r[r.print=155]="print",r[r.println=156]="println",r[r.pushEnumValue=157]="pushEnumValue",r[r.initializeEnumValue=158]="initializeEnumValue",r[r.scopeNode=159]="scopeNode",r[r.returnIfDestroyed=160]="returnIfDestroyed",r[r.extendedForLoopInit=161]="extendedForLoopInit",r[r.extendedForLoopCheckCounterAndGetElement=162]="extendedForLoopCheckCounterAndGetElement",r[r.setPauseDuration=163]="setPauseDuration",r[r.pause=164]="pause",r))(f||{}),ni={0:"ein Bezeichner",1:"eine Integer-Konstante",4:"eine Fließkomma-Konstante",5:"eine boolesche Konstante",6:"eine Zeichenketten-Konstante",7:"eine char-Konstante",8:"true",9:"false",12:"class",13:"this",14:"super",15:"new",16:"interface",17:"enum",18:"void",19:"abstract",20:"public",21:"protected",22:"private",23:"transient",24:"static",25:"extends",26:"implements",27:"while",28:"do",29:"for",30:"switch",31:"case",32:"default",33:"if",34:"then",35:"else",36:"return",37:"break",38:"continue",39:"null",40:"final",41:"instanceof",10:"print",11:"println",42:"(",43:")",44:"[",45:"]",46:"{",47:"}",48:"[]",51:".",53:"-",52:"%",54:"+",55:"*",56:"/",57:"'",58:'"',49:"--",50:"++",59:"<",60:">",61:"<=",62:">=",63:"==",64:"!=",65:"=",66:"+=",67:"-=",68:"*=",69:"/=",71:"%=",74:"&",72:"&&",73:"||",90:"!",75:"&=",76:"^=",77:"|=",78:"<<=",79:">>=",80:">>>=",81:"|",82:"^",83:"~",86:"<<",85:">>",84:">>>",87:"?",91:";",88:":",89:"...",92:",",93:"\\",94:"@",95:"ein Leerzeichen",96:"ein Tabulatorzeichen",97:"ein Zeilenumbruch",99:"eines der Zeichen a..z, A..Z, _",100:"ein Kommentar",103:"das Ende des Programmes"},rh={"(":42,")":43,"[":44,"]":45,"{":46,"}":47,".":51,",":92,"-":53,"%":52,"+":54,"*":55,"/":56,"\\":93,"@":94,"'":57,'"':58,"<":59,">":60,"=":65,"&":72,"|":73,"!":90,"?":87,"^":82,"~":83,";":91,":":88,"...":89," ":95,"	":96,"\n":97,"\r":98},Pv={class:12,this:13,super:14,new:15,interface:16,enum:17,void:18,abstract:19,public:20,protected:21,private:22,transient:23,static:24,extends:25,implements:26,while:27,do:28,for:29,switch:30,case:31,default:32,if:33,then:34,else:35,return:36,break:37,continue:38,null:39,final:40,instanceof:41,true:8,false:9,print:10,println:11},sh={n:`
`,r:"\r",t:"	",'"':'"',"'":"'","\\":"\\"};class ar{constructor(){y(this,"onlyFirstPass",!1);y(this,"usagePositions",new Map);y(this,"declaration");y(this,"identifier");y(this,"documentation","")}toTokenType(){return null}clearUsagePositions(){this.usagePositions=new Map}}class ut extends ar{constructor(){super(...arguments);y(this,"initialValue",null);y(this,"description","");y(this,"operationTable");y(this,"canCastToMap")}equals(t){return t==this}getResultType(t,i){let n=this.operationTable[t];return n==null?null:i!=null?n[i.identifier]:n.none}canCastTo(t){return this.canCastToMap[t.identifier]!=null}getCastInformation(t){return this.canCastToMap[t.identifier]}}let ce=class{constructor(e,t,i,n,s,a,l){y(this,"onlyFirstPass",!1);y(this,"identifier");y(this,"index");y(this,"type");y(this,"isStatic");y(this,"isFinal");y(this,"isTransient");y(this,"visibility");y(this,"updateValue");y(this,"usagePositions");y(this,"declaration");y(this,"documentation");y(this,"annotation");this.identifier=e,this.type=t,this.updateValue=i,this.isStatic=n,this.visibility=s,this.isFinal=a,this.usagePositions=new Map,this.documentation=l}};class m extends ar{constructor(t,i,n,s,a,l,o,u=!1){super();y(this,"onlyFirstPass",!1);y(this,"visibility");y(this,"isAbstract");y(this,"isStatic");y(this,"isFinal");y(this,"isConstructor",!1);y(this,"isVirtual",!1);y(this,"parameterlist");y(this,"returnType");y(this,"annotation");y(this,"invoke");y(this,"program");y(this,"reserveStackForLocalVariables",0);y(this,"hasGenericTypes");y(this,"genericTypeMap",null);y(this,"signature");this.identifier=t,this.parameterlist=i,this.returnType=n,this.isAbstract=a,this.isStatic=l,this.visibility=0,this.documentation=o,this.isConstructor=u,s!=null&&(typeof s=="function"?this.invoke=s:(this.program=s,s.method=this)),this.signature=t+i.id;for(let h of i.parameters)if(h.isTypeVariable==!0){this.hasGenericTypes=!0;break}this.hasGenericTypes=this.hasGenericTypes||this.returnType!=null&&this.returnType.isTypeVariable==!0}implements(t){if(this.identifier!=t.identifier)return!1;if(this.returnType==null||this.returnType.identifier=="void"){if(t.returnType!=null&&t.returnType.identifier!="void")return!1}else if(t.returnType instanceof ut){if(t.returnType!=this.returnType)return!1}else if(!this.returnType.canCastTo(t.returnType))return!1;if(this.parameterlist.parameters.length!=t.parameterlist.parameters.length)return!1;for(let i=0;i<this.parameterlist.parameters.length;i++){let n=this.parameterlist.parameters[i],s=t.parameterlist.parameters[i];if(s.type instanceof ut){if(s.type!=n.type)return!1}else if(!s.type.canCastTo(n.type))return!1}return!0}hasEllipsis(){return this.parameterlist.parameters.length==0?!1:this.parameterlist.parameters[this.parameterlist.parameters.length-1].isEllipsis}getParameterType(t){return this.parameterlist.parameters[t].type}getParameter(t){return this.parameterlist.parameters[t]}getReturnType(){return this.returnType}getParameterCount(){return this.parameterlist.parameters.length}getParameterList(){return this.parameterlist}getSignatureWithReturnParameter(){return this.returnType!=null?this.returnType.identifier+" "+this.signature:"void "+this.signature}getCompletionLabel(){let t="";this.returnType!=null&&this.returnType.identifier!="void"&&(t+=Ns(this.returnType)+" "),t+=this.identifier+"(";let i=this.parameterlist.parameters;for(let n=0;n<i.length;n++){let s=i[n];if(s.isEllipsis){let a=s.type;t+=Ns(a.arrayOfType)+"... "+s.identifier}else t+=Ns(s.type)+" "+s.identifier;n<i.length-1&&(t+=", ")}return t+=")",t}getCompletionSnippet(t){if(t)return this.identifier+"($0";let i="";i+=this.identifier+"(";let s=this.returnType==null||this.returnType.identifier=="void"?1:0,a=this.parameterlist.parameters;for(let l=0;l<a.length;l++){let o=a[l];i+="${"+(l+1)%(a.length+s)+":"+o.identifier+"}",l<a.length-1&&(i+=", ")}return i+=")",(this.returnType==null||this.returnType.identifier=="void")&&(i+=";$0"),i}debugOutput(t){return""}equals(t){return t==this}getResultType(t,i){return null}compute(t,i,n){return null}canCastTo(t){return!1}castTo(t,i){return t}}class g{constructor(e){y(this,"id");y(this,"parameters");this.parameters=e,this.computeId()}computeId(){this.id="(";let e=0;for(;e<this.parameters.length;)this.id+=this.parameters[e].type.identifier,e<this.parameters.length-1&&(this.id+=", "),e++;this.id+=")"}}function Ns(r){var e,t;if(r.typeVariables&&r.typeVariables.length>0){let i=(r.isTypeVariable?r.identifier+" extends "+((e=r.isGenericVariantFrom)==null?void 0:e.identifier):r.identifier)+"<";return i+=r.typeVariables.map(n=>Ns(n.type)).join(", "),i+">"}return r.isTypeVariable?r.identifier+" extends "+((t=r.isGenericVariantFrom)==null?void 0:t.identifier):r.identifier}class he{constructor(e){y(this,"class");y(this,"intrinsicData",{});y(this,"attributes");y(this,"gngAttributes");this.class=e,this.initializeAttributeValues()}getValue(e){let t=this.attributes[e];return(t==null?void 0:t.updateValue)!=null&&t.updateValue(t),t}initializeAttributeValues(){this.attributes=Array(this.class.numberOfAttributesIncludingBaseClass).fill(null);let e=this.class;for(;e!=null;){for(let t of e.attributes){let i=null;t.type instanceof ut&&(i=t.type.initialValue);let n={type:t.type,value:i};t.updateValue!=null&&(n.updateValue=t.updateValue,n.object=this),this.attributes[t.index]=n}e=e.baseClass}}}class sc{constructor(e){y(this,"maxLabelIndex",0);y(this,"labeledNodes",[]);y(this,"labelMap",new Map);y(this,"jumpNodesToResolve",[]);y(this,"switchStatements",[]);y(this,"program");this.program=e}correctPositionsAfterInsert(e,t){for(let i of this.labeledNodes)i.position!=null&&i.position>=e&&(i.position+=t)}registerSwitchStatement(e){this.switchStatements.push(e)}insertJumpNode(e,t,i,n){let s=this.program.statements;t==null&&s.length>0&&(t=s[s.length-1].position);let a={type:e,position:t,stepFinished:!0};return i.pushStatements(a),this.registerJumpNode(a,n)}markJumpDestination(e,t){let i=this.program.statements.length-1+e;t==null&&(t=this.maxLabelIndex++);let n={position:i,labelIndex:t};return this.labeledNodes.push(n),this.labelMap.set(t,n),t}removeNode(e){for(let t=0;t<this.labeledNodes.length;t++){let i=this.labeledNodes[t];if(i.node==e){let n=this.program.statements.indexOf(e);if(n<this.program.statements.length-1){let s=this.program.statements[n+1];i.node=s}}else t++}}registerJumpDestination(e,t){t==null&&(t=this.maxLabelIndex++);let i={node:e,labelIndex:t};return this.labeledNodes.push(i),this.labelMap.set(t,i),t}registerJumpNode(e,t){t==null&&(t=this.maxLabelIndex++);let i={labelIndex:t,node:e};return this.jumpNodesToResolve.push(i),t}resolveNodes(){for(let e of this.labeledNodes)if(e.position==null)e.position=this.program.statements.indexOf(e.node);else{for(;e.position>this.program.statements.length-1;)this.program.statements.push({type:f.noOp,position:null});e.node=this.program.statements[e.position]}for(let e of this.jumpNodesToResolve){let t=this.labelMap.get(e.labelIndex);t!=null&&(e.node.destination=t.position)}for(let e of this.switchStatements){for(let t of e.destinationLabels)e.destinationMap[t.constant]=this.labelMap.get(t.label).position;e.destinationLabels=null,e.defaultDestination!=null&&(e.defaultDestination=this.labelMap.get(e.defaultDestination).position)}}}var ee=(r=>(r[r.public=0]="public",r[r.protected=1]="protected",r[r.private=2]="private",r))(ee||{}),$a;function Iv(r){$a=r}const In=class In extends ar{constructor(t,i,n){super();y(this,"typeVariables",[]);y(this,"isGenericVariantFrom");y(this,"isTypeVariable",!1);y(this,"typeVariablesReady",!0);y(this,"baseClass");y(this,"firstPassBaseClass");y(this,"staticClass");y(this,"module");y(this,"visibility");y(this,"implements",[]);y(this,"firstPassImplements",[]);y(this,"isAbstract",!1);y(this,"isFinal",!1);y(this,"attributeInitializationProgram");y(this,"postConstructorCallbacks",null);y(this,"methods",[]);y(this,"methodMap",new Map);y(this,"attributes",[]);y(this,"attributeMap",new Map);y(this,"numberOfAttributesIncludingBaseClass",null);y(this,"symbolTable");this.documentation=n,this.identifier=t,this.module=i,this.visibility=0,this.staticClass=new Vt(this),this.attributeInitializationProgram={method:null,module:this.module,statements:[],labelManager:null},this.attributeInitializationProgram.labelManager=new sc(this.attributeInitializationProgram)}setupAttributeIndicesRecursive(){this.baseClass!=null&&this.baseClass.numberOfAttributesIncludingBaseClass==null&&this.baseClass.setupAttributeIndicesRecursive();let t=this.baseClass==null?0:this.baseClass.numberOfAttributesIncludingBaseClass;for(let i of this.attributes)i.index=t++;this.numberOfAttributesIncludingBaseClass=t}hasAttributes(){return this.numberOfAttributesIncludingBaseClass>0}getNonGenericClass(){let t=this;for(;t.isGenericVariantFrom!=null;)t=t.isGenericVariantFrom;return t}getNonGenericIdentifier(){let t=this;for(;t.isGenericVariantFrom!=null;)t=t.isGenericVariantFrom;return t.identifier}implementsInterface(t){let i=this;for(;i!=null;){for(let n of i.implements)if(n.getThisOrExtendedInterface(t.getNonGenericIdentifier())!=null)return!0;i=i.baseClass}return!1}getImplementedInterface(t){let i=this;for(;i!=null;){for(let n of i.implements){let s=n.getThisOrExtendedInterface(t);if(s!=null)return s}i=i.baseClass}return null}registerUsedSystemClasses(t){this.baseClass!=null&&this.baseClass.module!=null&&this.baseClass.module.isSystemModule&&t.indexOf(this.baseClass)<0&&t.push(this.baseClass);for(let i of this.getCompositeData())i.klass!=null&&i.klass.module!=null&&i.klass.module.isSystemModule&&t.indexOf(i.klass)<0&&t.push(i.klass);for(let i of this.implements)i!=null&&i.module.isSystemModule&&t.indexOf(i)<0&&t.push(i)}getCompositeData(){let t=[],i=new Map;for(let n of this.attributes){let s=n.type;if(n.type instanceof In||n.type instanceof Pe||n.type instanceof ze){for(["ArrayList","List","LinkedList"].indexOf(s.identifier)>=0&&s instanceof In&&s.typeVariables.length==1&&(s=s.typeVariables[0].type);s instanceof ze;)s=s.arrayOfType;let a=i.get(n.type);a==null?(a={klass:s,identifier:n.identifier},i.set(n.type,a),t.push(a)):a.identifier+=", "+n.identifier}else{let a=n.type;if(a instanceof In||a instanceof Pe){let l=i.get(a);l==null?(l={klass:a,identifier:n.identifier},i.set(a,l),t.push(l)):l.identifier+=", "+n.identifier}}}return t}clearUsagePositions(){super.clearUsagePositions();for(let t of this.methods)t.clearUsagePositions();for(let t of this.attributes)t.usagePositions=new Map;this.staticClass!=null&&this.staticClass.clearUsagePositions()}getPostConstructorCallbacks(){let t=this,i=null;for(;t!=null;)t.postConstructorCallbacks!=null&&(i==null?i=t.postConstructorCallbacks:i=i.concat(t.postConstructorCallbacks)),t=t.baseClass;return i}getCompletionItems(t,i,n,s,a){let l=[];for(let o of this.getAttributes(t))l.push({label:o.identifier+"",kind:monaco.languages.CompletionItemKind.Field,insertText:o.identifier,range:s,documentation:o.documentation==null?void 0:{value:o.documentation}});for(let o of this.getMethods(t)){if(o.isConstructor)if(a!=null&&a.isConstructor&&a!=o&&this.baseClass.methods.indexOf(o)>=0){this.pushSuperCompletionItem(l,o,i,s);continue}else continue;l.push({label:o.getCompletionLabel(),filterText:o.identifier,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Method,insertText:o.getCompletionSnippet(i),range:s,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:o.documentation==null?void 0:{value:o.documentation}})}return l=l.concat(this.staticClass.getCompletionItems(t,i,n,s)),l}pushSuperCompletionItem(t,i,n,s){t.push({label:i.getCompletionLabel().replace(i.identifier,"super"),filterText:"super",command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},kind:monaco.languages.CompletionItemKind.Method,insertText:i.getCompletionSnippet(n).replace(i.identifier,"super"),range:s,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:i.documentation==null?void 0:{value:i.documentation}})}pushStaticInitializationPrograms(t){this.staticClass.attributeInitializationProgram.statements.length>0&&t.push({program:this.staticClass.attributeInitializationProgram,programPosition:0,textPosition:{line:1,column:1,length:0},method:"Initialisierung statischer Variablen der Klasse "+this.staticClass.identifier,callbackAfterReturn:null,isCalledFromOutside:"Initialisierung statischer Attribute"})}getMethodBySignature(t){let i=this;for(;i!=null;){let n=i.methodMap.get(t);if(n!=null)return n;i=i.baseClass}return null}equals(t){return t==this}setBaseClass(t){this.baseClass=t,this.staticClass.baseClass=t.staticClass}addMethod(t){t.isConstructor&&(t.returnType=null),t.isStatic?this.staticClass.addMethod(t):(this.methods.push(t),this.methodMap.set(t.signature,t))}addAttribute(t){t.isStatic?this.staticClass.addAttribute(t):(this.attributes.push(t),this.attributeMap.set(t.identifier,t))}getResultType(t,i){return(t==f.equal||t==f.notEqual)&&(i instanceof In||i==Ka)||t==f.keywordInstanceof&&(i instanceof Vt||i instanceof Pe)?$a:null}compute(t,i,n){var s;if(t==f.equal)return i.value==n.value;if(t==f.notEqual)return i.value!=n.value;if(t==f.keywordInstanceof){let a=(s=i==null?void 0:i.value)==null?void 0:s.class;if(a==null)return!1;let l=a,o=n.type;if(o instanceof Vt){for(;l!=null;){if(l===o.Klass)return!0;l=l.baseClass}return!1}if(o instanceof Pe)for(;l!=null;){for(let u of l.implements)if(u===o)return!0;l=l.baseClass}return!1}return null}getMethods(t,i){let n=this.methods.filter(s=>s.visibility<=t&&(i==null||s.identifier==i));if(this.baseClass!=null&&(i==null||i!=this.identifier||n.length==0)){let s=t==0?t:1;for(let a of this.baseClass.getMethods(s,i==this.identifier?this.baseClass.identifier:i)){let l=!1;for(let o of n)if(o.signature==a.signature){l=!0;break}l||n.push(a)}}return n}getAttributes(t){let i=[];for(let n of this.attributes)n.visibility<=t&&i.push(n);if(this.baseClass!=null){let n=t==0?t:1;for(let s of this.baseClass.getAttributes(n)){let a=!1;if(!(s.visibility>n)){for(let l of i)if(l.identifier==s.identifier){a=!0;break}a||i.push(s)}}}return i}hasConstructor(){for(let t of this.methods)if(t.isConstructor)return!0;return this.baseClass!=null?this.baseClass.hasConstructor():!1}hasParameterlessConstructor(){let t=!1;for(let i of this.methods)if(i.isConstructor){if(i.parameterlist.parameters.length==0)return!0;t=!0}return!t&&this.baseClass!=null?this.baseClass.hasParameterlessConstructor():!1}getParameterlessConstructor(){for(let t of this.methods)if(t.isConstructor&&t.parameterlist.parameters.length==0)return t;return this.baseClass!=null?this.baseClass.getParameterlessConstructor():null}getConstructor(t,i,n=this.identifier){let s=this.methods.filter(a=>a.isConstructor&&a.visibility<=i);return s.length==0&&this.baseClass!=null?this.baseClass.getConstructor(t,i,n):_o(s,this.identifier,t,n,!0)}getMethodsThatFitWithCasting(t,i,n,s){let a=this.getMethods(s),l=_o(a,t,i,this.identifier,n);if(l.methodList.length==0&&!n){let o=this.staticClass.getMethodsThatFitWithCasting(t,i,!1,s);return o.error==null?o:l}return l}getMethod(t,i){let n=this.methodMap.get(t+i.id);return n==null&&this.baseClass!=null?this.baseClass.getMethod(t,i):n}getAttribute(t,i){let n=null,s=!1,a=this.attributeMap.get(t),l=a==null;if(a==null?n="Das Attribut "+t+" kann nicht gefunden werden.":a.visibility>i&&(n="Das Attribut "+t+" hat die Sichtbarkeit "+ee[a.visibility]+" und ist daher hier nicht sichtbar.",a=null,s=!0),a==null&&this.baseClass!=null){let o=i==0?i:1,u=this.baseClass.getAttribute(t,o);if(u.attribute!=null||l)return u}return{attribute:a,error:n,foundButInvisible:s}}canCastTo(t){if(t==F)return!0;if(t instanceof In){let i=this;for(;i!=null;){if(t.getNonGenericIdentifier()==i.getNonGenericIdentifier()){if(t.typeVariables.length>0){let n=Math.min(t.typeVariables.length,i.typeVariables.length);for(let s=0;s<n;s++)if(!i.typeVariables[s].type.canCastTo(t.typeVariables[s].type))return!1;return!0}return!0}i=i.baseClass}}if(t instanceof Pe){let i=this;for(;i!=null;){for(let n of i.implements){let s=t.getNonGenericIdentifier();if(n.getThisOrExtendedInterface(s)!=null)return!0}i=i.baseClass}}return!1}castTo(t,i){return t}checkInheritance(){if(this.baseClass!=null&&In.dontInheritFrom.indexOf(this.baseClass.identifier)>=0)return{message:"Aus Performancegründen ist es leider nicht möglich, Unterklassen der Klassen String, Boolean, Character, Integer, Float und Double zu bilden.",missingMethods:[]};let t="",i=[],n=[],s=[],a=this,l=[a.identifier];for(;a.baseClass!=null;){if(a=a.baseClass,l.indexOf(a.identifier)>=0){a.baseClass=null,l=[a.identifier].concat(l),t="Die Klasse "+a.identifier+" erbt von sich selbst: ",t+="("+l.join(" extends ")+")";break}l=[a.identifier].concat(l)}if(t==""){if(this.baseClass!=null){let o=this;for(;o!=null;){for(let u of o.methods)if(u.isAbstract){let h=!1;for(let d of n)if(d.implements(u)){h=!0;break}h||i.push(u)}else n.push(u);o=o.baseClass}}i.length>0&&!this.isAbstract&&(t="Die Klasse "+this.identifier+" muss noch folgende Methoden ihrer abstrakten Basisklassen implementieren: ",t+=i.map(o=>o.getSignatureWithReturnParameter()).join(", "));for(let o of this.implements)for(let u of o.getMethods()){let h=!1;for(let d of n)if(d.implements(u)){h=!0;break}h||s.push(u)}s.length>0&&(t!=""&&(t+=`
`),t+="Die Klasse "+this.identifier+" muss noch folgende Methoden der von ihr implementierten Interfaces implementieren: ",t+=s.map(o=>o.signature).join(", "))}return{message:t,missingMethods:i.concat(s)}}hasAncestorOrIs(t){let i=this,n=t.identifier;for(t instanceof In&&(n=t.getNonGenericIdentifier());i!=null;){if(i.getNonGenericIdentifier()==n)return!0;i=i.baseClass}return!1}debugOutput(t,i=40){let n="{",s=this.getAttributes(2),a=t.value;if(a==null)return"null";for(let l=0;l<s.length;l++){let o=s[l],u=a.getValue(o.index);o.type instanceof ut?n+=o.identifier+":&nbsp;"+o.type.debugOutput(u,i/2):n+=o.identifier+":&nbsp; {...}",l<s.length-1&&(n+=",&nbsp;")}return n+"}"}clone(){let t=Object.create(this);return t.implements=this.implements.slice(0),t.usagePositions=new Map,t.isGenericVariantFrom=this,t}};y(In,"dontInheritFrom",["Integer","Float","Double","Boolean","Character","String","Shape","FilledShape"]);let $=In;class Vt extends ar{constructor(t){super();y(this,"baseClass");y(this,"Klass");y(this,"classObject");y(this,"attributeInitializationProgram");y(this,"methods",[]);y(this,"methodMap",new Map);y(this,"attributes",[]);y(this,"attributeMap",new Map);y(this,"numberOfAttributesIncludingBaseClass",null);this.Klass=t,this.identifier=t.identifier,t.baseClass!=null&&(this.baseClass=t.baseClass.staticClass),this.attributeInitializationProgram={method:null,module:this.Klass.module,statements:[],labelManager:null},this.attributeInitializationProgram.labelManager=new sc(this.attributeInitializationProgram)}setupAttributeIndicesRecursive(){this.baseClass!=null&&this.baseClass.numberOfAttributesIncludingBaseClass==null&&this.baseClass.setupAttributeIndicesRecursive();let t=this.baseClass==null?0:this.baseClass.numberOfAttributesIncludingBaseClass;for(let i of this.attributes)i.index=t++;this.numberOfAttributesIncludingBaseClass=t}clearUsagePositions(){super.clearUsagePositions();for(let t of this.methods)t.clearUsagePositions();for(let t of this.attributes)t.usagePositions=new Map}debugOutput(t,i=40){var l;let n="{",s=this.getAttributes(2),a=this.classObject;if(s==null)return"{}";for(let o=0;o<s.length;o++){let u=s[o];n+=u.identifier+": "+a==null?"---":(l=u.type)==null?void 0:l.debugOutput(a==null?void 0:a.getValue(u.index),i/2),o<s.length-1&&(n+=", ")}return n+"}"}getCompletionItems(t,i,n,s){let a=[];for(let l of this.getAttributes(t))a.push({label:l.identifier,detail:l.color?l.color:void 0,kind:l.color?monaco.languages.CompletionItemKind.Color:monaco.languages.CompletionItemKind.Field,insertText:l.identifier,range:s,documentation:l.documentation==null?void 0:{value:l.documentation}});for(let l of this.getMethods(t))a.push({label:l.getCompletionLabel(),filterText:l.identifier,kind:monaco.languages.CompletionItemKind.Method,insertText:l.getCompletionSnippet(i),range:s,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:l.documentation==null?void 0:{value:l.documentation}});return a}equals(t){return t==this}addMethod(t){this.methods.push(t),this.methodMap.set(t.signature,t)}addAttribute(t){this.attributes.push(t),this.attributeMap.set(t.identifier,t)}getResultType(t,i){return null}compute(t,i,n){return null}getMethodsThatFitWithCasting(t,i,n,s){return _o(this.getMethods(s),t,i,this.Klass.identifier,n)}getMethods(t,i){let n=this.methods.slice().filter(s=>s.visibility<=t&&(i==null||i==s.identifier));if(this.baseClass!=null){let s=t==0?0:1;for(let a of this.baseClass.getMethods(s,i)){let l=!1;for(let o of n)if(o.signature==a.signature){l=!0;break}l||n.push(a)}}return n}getAttributes(t){let i=this.attributes.filter(n=>n.visibility<=t);if(this.baseClass!=null){let n=t==0?t:1;for(let s of this.baseClass.getAttributes(n)){let a=!1;for(let l of i)if(l.identifier==s.identifier){a=!0;break}a||i.push(s)}}return i}getMethod(t,i){let n=this.methodMap.get(t+i.id);return n==null&&this.baseClass!=null?this.baseClass.getMethod(t,i):n}getAttribute(t,i){let n="",s=!1,a=this.attributeMap.get(t);if(a==null?(s=!0,n="Das Attribut "+t+" konnte nicht gefunden werden."):a.visibility>i&&(n="Das Attribut "+t+" hat die Sichtbarkeit "+ee[a.visibility]+" und ist hier daher nicht sichtbar.",a=null),a==null&&this.baseClass!=null){let l=i==0?i:1,o=this.baseClass.getAttribute(t,l);if(s)return o}return{attribute:a,error:n,foundButInvisible:!s,staticClass:this}}canCastTo(t){return!1}castTo(t,i){return t}hasAncestorOrIs(t){let i=this;for(;i!=null;){if(i==t)return!0;i=i.baseClass}return!1}}class Pe extends ar{constructor(t,i,n){super();y(this,"typeVariables",[]);y(this,"isGenericVariantFrom");y(this,"typeVariablesReady",!0);y(this,"module");y(this,"extends",[]);y(this,"methods",[]);y(this,"methodMap",new Map);y(this,"methodsWithSubInterfaces");this.documentation=n,this.identifier=t,this.module=i}getNonGenericIdentifier(){let t=this;for(;t.isGenericVariantFrom!=null;)t=t.isGenericVariantFrom;return t.identifier}getThisOrExtendedInterface(t){if(this.getNonGenericIdentifier()==t)return this;for(let i of this.extends){let n=i.getThisOrExtendedInterface(t);if(n!=null)return n}return null}clone(){let t=Object.create(this);return t.usagePositions=new Map,t.isGenericVariantFrom=this,t}clearUsagePositions(){super.clearUsagePositions();for(let t of this.methods)t.clearUsagePositions()}getCompletionItems(t,i,n){let s=[];for(let a of this.getMethods())s.push({label:a.getCompletionLabel(),filterText:a.identifier,kind:monaco.languages.CompletionItemKind.Method,insertText:a.getCompletionSnippet(t),range:n,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,documentation:a.documentation==null?void 0:{value:a.documentation}});return s}debugOutput(t,i=40){return t.value==null?"null":t.value instanceof he?t.value.class.debugOutput(t):"{...}"}equals(t){return t==this}addMethod(t){t.isAbstract=!0,this.methods.push(t),this.methodMap.set(t.signature,t)}getResultType(t,i){return t==f.equal||t==f.notEqual||t==f.keywordInstanceof&&(i instanceof Vt||i instanceof Pe)?$a:null}compute(t,i,n){return t==f.equal?i.value==n.value:t==f.notEqual?i.value!=n.value:null}getMethods(){if(this.extends.length==0)return this.methods;if(this.methodsWithSubInterfaces!=null)return this.methodsWithSubInterfaces;let t={},i={};this.methodsWithSubInterfaces=this.methods.slice(0);for(let s of this.methods)i[s.signature]=!0;t[this.identifier]=!0;let n=this.extends.slice(0);for(;n.length>0;){let s=n.pop();for(let a of s.methods)i[a.signature]||(this.methodsWithSubInterfaces.push(a),i[a.signature]=!0);for(let a of s.extends)t[a.identifier]||(n.push(a),t[a.identifier]=!0)}return this.methodsWithSubInterfaces}getMethod(t,i){return this.methodMap.get(t+i.id)}canCastTo(t){if(t instanceof Pe){if(t.getNonGenericIdentifier()==this.getNonGenericIdentifier()){if(this.typeVariables.length==0)return!0;let i=t;if(this.typeVariables.length!=i.typeVariables.length)return!1;for(let n=0;n<this.typeVariables.length;n++){let s=this.typeVariables[n];if(!i.typeVariables[n].type.canCastTo(s.type))return!1}return!1}else for(let i of this.extends)if(i.canCastTo(t))return!0;return!1}else return t instanceof $&&t.getNonGenericIdentifier()=="Object"}castTo(t,i){return t}getMethodsThatFitWithCasting(t,i,n){return _o(this.getMethods(),t,i,this.identifier,n)}}function _o(r,e,t,i,n){let s=[],a=1e4,l=null,o=!1;for(let u of r){let h=0;if(u.identifier==e||u.isConstructor&&n){o=!0;let d=u.hasEllipsis();if(u.getParameterCount()==t.length||d&&u.getParameterCount()<=t.length){let p=!0,v=0;for(v=0;v<u.getParameterCount()-(d?1:0);v++){let w=u.getParameterType(v),_=t[v];if(_==null){p=!1;break}if(w!=_){if(_.canCastTo(w)){h++,w==F&&(h+=.5);continue}p=!1;break}}if(p&&d){let _=u.getParameter(v).type.arrayOfType;for(let T=v;T<t.length;T++){let D=t[v];if(D==null){p=!1;break}if(_!=D){if(D.canCastTo(_)){h++,_==F&&(h+=.5);continue}p=!1;break}}}p&&h<=a&&(h<a&&(s=[]),s.push(u),a=h)}}}if(s.length==0)if(o)if(t.length==0)l=n?"Es gibt keinen parameterlosen Konstruktor der Klasse "+i:"Die vorhandenen Methoden mit dem Bezeichner "+e+" haben alle mindestens einen Parameter. Hier wird aber kein Parameterwert übergeben.";else{let u=t.map(h=>h==null?void 0:h.identifier).join(", ");l=n?`Die Parametertypen (${u}) passen zu keinem Konstruktor der Klasse ${i}`:`Die Parametertypen (${u}) passen zu keiner der vorhandenen Methoden mit dem Bezeichner ${e}.`}else l="Der Typ "+i+" besitzt keine Methode mit dem Bezeichner "+e+".",e=="setCenter"&&(l+=' Tipp: Die Methode setCenter der Klasse Shape wurde umbenannt in "moveTo".');return s.length>1&&(s=s.slice(0,1)),{error:l,methodList:s}}function Aa(r,e){return e==null?0:(r instanceof Vt&&(r=r.Klass),e instanceof Vt&&(e=e.Klass),r==e?2:e.hasAncestorOrIs(r)?1:0)}class ze extends ar{constructor(t){super();y(this,"arrayOfType");y(this,"lengthAttribute");this.arrayOfType=t,this.identifier="Array",t!=null&&(this.identifier=t.identifier+"[]"),this.lengthAttribute=new ce("length",C,i=>i.value.length,!1,ee.public,!0)}equals(t){return t instanceof ze&&t.arrayOfType.equals(this.arrayOfType)}get id(){return this.arrayOfType.identifier+"[]"}getResultType(t,i){return t==f.referenceElement?this.arrayOfType:[f.equal,f.notEqual].indexOf(t)>=0&&i==Ka?P:null}compute(t,i,n){if(t==f.referenceElement)return i.value[n.value];if(t==f.equal)return i.value==n.value;if(t==f.notEqual)return i.value!=n.value}getMethod(t,i){return null}getAttribute(t){return t=="length"?this.lengthAttribute:null}canCastTo(t){return t instanceof ze?this.arrayOfType.canCastTo(t.arrayOfType):!1}castTo(t,i){let n=t.value.slice(),s=i.arrayOfType;for(let a of n)this.arrayOfType.castTo(a,s);return{type:i,value:n}}debugOutput(t,i=40){let n=0;if(t.value!=null){let s="[",a=t.value;for(let l=0;l<a.length;l++){let o=a[l],u=o.type.debugOutput(o,i/2);if(s+=u,l<a.length-1&&(s+=",&nbsp;"),n+=u.length,n>i)break}return s+"]"}else return"null"}}class Ma extends ${constructor(e){super("Object",e,"Basisklasse aller Klassen");let t=new m("toString",new g([]),F,i=>i[0].value instanceof he?"("+i[0].value.class.identifier+")":i[0].value,!1,!1);t.isVirtual=!0,this.addMethod(t)}}class Dv extends ${constructor(t){super("Integer",null,"Wrapper-Klasse, um int-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.addAttribute(new ce("MAX_VALUE",C,i=>{i.value=2147483647},!0,ee.public,!0,"Der größte Wert, den eine Variable vom Typ int annehmen kann")),this.addAttribute(new ce("MIN_VALUE",C,i=>{i.value=-2147483648},!0,ee.public,!0,"Der kleinste Wert, den eine Variable vom Typ int annehmen kann")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[C,G,A],this.addMethod(new m("Integer",new g([{identifier:"int-wert",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Integer-Objekt",!0)),this.addMethod(new m("Integer",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=Number.parseInt(t[1].value)},!1,!1,"Instanziert ein neues Integer-Objekt, indem die übergebene Zeichenkette in einen int-Wert umgewandelt wird.",!0)),this.addMethod(new m("doubleValue",new g([]),A,t=>t[0].value,!1,!1,"Wandelt das Integer-Objekt in einen double-Wert um")),this.addMethod(new m("floatValue",new g([]),G,t=>t[0].value,!1,!1,"Wandelt das Integer-Objekt in einen float-Wert um")),this.addMethod(new m("intValue",new g([]),C,t=>t[0].value,!1,!1,"Wandelt das Integer-Objekt in einen int-Wert um")),this.addMethod(new m("compareTo",new g([{identifier:"anotherInteger",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{let i=t[0].value,n=t[1].value;return i>n?1:i<n?-1:0},!1,!1,"Ist der Wert größer als der übergebene Wert, so wird +1 zurückgegeben. Ist er kleiner, so wird -1 zurückgegeben. Sind die Werte gleich, so wird 0 zurückgegeben.")),this.addMethod(new m("equals",new g([{identifier:"anotherInteger",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>""+t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zur Basis 10 zurück.")),this.addMethod(new m("hashCode",new g([]),C,t=>t[0].value,!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("parseInt",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Number.parseInt(t[1].value),!1,!0,"Wandelt die Zeichenkette in einen int-Wert um")),this.addMethod(new m("parseInt",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Number.parseInt(t[1].value,t[2].value),!1,!0,"Wandelt die Zeichenkette s in einen int-Wert um. Dabei wird s als Zahl im Zahlensystem mit der Basis radix interpretiert.")),this.addMethod(new m("signum",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.sign(t[1].value),!1,!0,"Gibt das Signum der übergebenen Zahl zurück, also -1 falls negativ, 0 falls 0 und +1 falls positiv.")),this.addMethod(new m("toBinary",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(2),!1,!0,"Gibt die übergebene Zahl als Binärrepräsentation zurück.")),this.addMethod(new m("toHex",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(16),!1,!0,"Gibt die übergebene Zahl als Hexadezimalrepräsentation zurück.")),this.addMethod(new m("toOctal",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(8),!1,!0,"Gibt die übergebene Zahl als Oktalrepräsentation zurück.")),this.addMethod(new m("toString",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>t[1].value.toString(),!1,!0,"Gibt die übergebene Zahl als String-Wert zur Basis 10 zurück.")),this.addMethod(new m("toString",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:C,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(t[2].value),!1,!0,"Gibt die übergebene Zahl als String-Wert zur Basis radix zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"i",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Gibt die übergebene Zahl als Integer-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseInt(t[1].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Dezimalzahl und gib sie als Integer-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseInt(t[1].value,t[2].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Zahl zur Basis radix und gib sie als Integer-Objekt zurück."))}debugOutput(t){return""+t.value}}class Fv extends ${constructor(t){super("Long",null,"Wrapper-Klasse, um int-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.addAttribute(new ce("MAX_VALUE",se,i=>{i.value=Number.MAX_SAFE_INTEGER},!0,ee.public,!0,"Der größte Wert, den eine Variable vom Typ long annehmen kann")),this.addAttribute(new ce("MIN_VALUE",se,i=>{i.value=Number.MIN_SAFE_INTEGER},!0,ee.public,!0,"Der kleinste Wert, den eine Variable vom Typ long annehmen kann")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[C,se,G,A],this.addMethod(new m("Long",new g([{identifier:"long-wert",type:se,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Long-Objekt",!0)),this.addMethod(new m("Long",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=Number.parseInt(t[1].value)},!1,!1,"Instanziert ein neues Long-Objekt, indem die übergebene Zeichenkette in einen int-Wert umgewandelt wird.",!0)),this.addMethod(new m("doubleValue",new g([]),A,t=>t[0].value,!1,!1,"Wandelt das Long-Objekt in einen double-Wert um")),this.addMethod(new m("floatValue",new g([]),G,t=>t[0].value,!1,!1,"Wandelt das Long-Objekt in einen float-Wert um")),this.addMethod(new m("intValue",new g([]),C,t=>t[0].value,!1,!1,"Wandelt das Long-Objekt in einen int-Wert um")),this.addMethod(new m("longValue",new g([]),se,t=>t[0].value,!1,!1,"Wandelt das Long-Objekt in einen long-Wert um")),this.addMethod(new m("compareTo",new g([{identifier:"anotherLong",type:this,declaration:null,usagePositions:null,isFinal:!0}]),se,t=>{let i=t[0].value,n=t[1].value;return i>n?1:i<n?-1:0},!1,!1,"Ist der Wert größer als der übergebene Wert, so wird +1 zurückgegeben. Ist er kleiner, so wird -1 zurückgegeben. Sind die Werte gleich, so wird 0 zurückgegeben.")),this.addMethod(new m("equals",new g([{identifier:"anotherLong",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>""+t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zur Basis 10 zurück.")),this.addMethod(new m("hashCode",new g([]),se,t=>t[0].value,!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("parseLong",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),se,t=>Number.parseInt(t[1].value),!1,!0,"Wandelt die Zeichenkette in einen long-Wert um")),this.addMethod(new m("parseLong",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:se,declaration:null,usagePositions:null,isFinal:!0}]),se,t=>Number.parseInt(t[1].value,t[2].value),!1,!0,"Wandelt die Zeichenkette s in einen long-Wert um. Dabei wird s als Zahl im Zahlensystem mit der Basis radix interpretiert.")),this.addMethod(new m("signum",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),se,t=>Math.sign(t[1].value),!1,!0,"Gibt das Signum der übergebenen Zahl zurück, also -1 falls negativ, 0 falls 0 und +1 falls positiv.")),this.addMethod(new m("toBinary",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(2),!1,!0,"Gibt die übergebene Zahl als Binärrepräsentation zurück.")),this.addMethod(new m("toHex",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(16),!1,!0,"Gibt die übergebene Zahl als Hexadezimalrepräsentation zurück.")),this.addMethod(new m("toOctal",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(8),!1,!0,"Gibt die übergebene Zahl als Oktalrepräsentation zurück.")),this.addMethod(new m("toString",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>t[1].value.toString(),!1,!0,"Gibt die übergebene Zahl als String-Wert zur Basis 10 zurück.")),this.addMethod(new m("toString",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:se,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>(t[1].value>>>0).toString(t[2].value),!1,!0,"Gibt die übergebene Zahl als String-Wert zur Basis radix zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"i",type:se,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Gibt die übergebene Zahl als Long-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseInt(t[1].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Dezimalzahl und gib sie als Long-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:se,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseInt(t[1].value,t[2].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Zahl zur Basis radix und gib sie als Long-Objekt zurück."))}debugOutput(t){return""+t.value}}class Rv extends ${constructor(t){super("Float",null,"Wrapper-Klasse, um float-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.addAttribute(new ce("MAX_VALUE",G,i=>{i.value=Number.MAX_VALUE},!0,ee.public,!0,"Der größte Wert, den eine Variable vom Typ float annehmen kann")),this.addAttribute(new ce("MIN_VALUE",G,i=>{i.value=Number.MIN_VALUE},!0,ee.public,!0,"Der kleinste Wert, den eine Variable vom Typ float annehmen kann")),this.addAttribute(new ce("NaN_VALUE",G,i=>{i.value=Number.NaN},!0,ee.public,!0,'Der "Not a Number"-Wert vom Typ float')),this.addAttribute(new ce("NEGATIVE_INFINITY",G,i=>{i.value=Number.NEGATIVE_INFINITY},!0,ee.public,!0,'Der "negative infinity"-Wert vom Typ float')),this.addAttribute(new ce("POSITIVE_INFINITY",G,i=>{i.value=Number.POSITIVE_INFINITY},!0,ee.public,!0,'Der "positive infinity"-Wert vom Typ float')),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[G,A],this.addMethod(new m("Float",new g([{identifier:"double-value",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Float-Objekt",!0)),this.addMethod(new m("Float",new g([{identifier:"int-value",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Float-Objekt",!0)),this.addMethod(new m("Float",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=Number.parseFloat(t[1].value)},!1,!1,"Instanziert ein neues Float-Objekt, indem die übergebene Zeichenkette in einen float-Wert umgewandelt wird.",!0)),this.addMethod(new m("doubleValue",new g([]),A,t=>t[0].value,!1,!1,"Wandelt das Float-Objekt in einen double-Wert um.")),this.addMethod(new m("floatValue",new g([]),G,t=>t[0].value,!1,!1,"Wandelt das Float-Objekt in einen float-Wert um.")),this.addMethod(new m("intValue",new g([]),C,t=>Math.trunc(t[0].value),!1,!1,"Wandelt das Float-Objekt durch Abrunden in einen int-Wert um.")),this.addMethod(new m("compareTo",new g([{identifier:"anotherFloat",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{let i=t[0].value,n=t[1].value;return i>n?1:i<n?-1:0},!1,!1,"Ist der Wert größer als der übergebene Wert, so wird +1 zurückgegeben. Ist er kleiner, so wird -1 zurückgegeben. Sind die Werte gleich, so wird 0 zurückgegeben.")),this.addMethod(new m("equals",new g([{identifier:"anotherFloat",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>""+t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zurück.")),this.addMethod(new m("hashCode",new g([]),C,t=>Math.trunc(t[0].value),!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("parseFloat",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>Number.parseFloat(t[1].value),!1,!0,"Wandelt die Zeichenkette in einen float-Wert um")),this.addMethod(new m("toString",new g([{identifier:"f",type:G,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>""+t[1].value,!1,!0,"Gibt die übergebene Zahl als String-Wert zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"f",type:G,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Gibt die übergebene Zahl als Float-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseFloat(t[1].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Dezimalzahl und gib sie als Float-Objekt zurück.")),this.addMethod(new m("isNaN",new g([{identifier:"f",type:G,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>Number.isNaN(t[1].value),!1,!0,"Gibt genau dann true zurück, falls die übergebene float-Zahl NaN (not a Number) ist.")),this.addMethod(new m("isNaN",new g([]),P,t=>Number.isNaN(t[0].value),!1,!1,"Gibt genau dann true zurück, falls das Objekt NaN (not a Number) ist.")),this.addMethod(new m("isInfinite",new g([{identifier:"f",type:G,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value==1/0,!1,!0,"Gibt genau dann true zurück, falls die übergebene float-Zahl INFINTITY ist.")),this.addMethod(new m("isInfinite",new g([]),P,t=>t[0].value==1/0,!1,!1,"Gibt genau dann true zurück, falls das Objekt INFINITY ist."))}debugOutput(t){return""+t.value}}class Ov extends ${constructor(t){super("Character",null,"Wrapper-Klasse, um char-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[Ge,F],this.addMethod(new m("Character",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Character-Objekt",!0)),this.addMethod(new m("charValue",new g([]),Ge,t=>t[0].value,!1,!1,"Wandelt das Character-Objekt in einen char-Wert um")),this.addMethod(new m("compareTo",new g([{identifier:"anotherCharacter",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{let i=t[0].value,n=t[1].value;return i>n?1:i<n?-1:0},!1,!1,"Ist der Wert größer als der übergebene Wert, so wird +1 zurückgegeben. Ist er kleiner, so wird -1 zurückgegeben. Sind die Werte gleich, so wird 0 zurückgegeben.")),this.addMethod(new m("equals",new g([{identifier:"anotherCharacter",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zurück.")),this.addMethod(new m("hashCode",new g([]),C,t=>t[0].value.charCodeAt(0),!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("charValue",new g([]),Ge,t=>t[0].value,!1,!1,"Gibt den char-Wert des Objekts zurück.")),this.addMethod(new m("digit",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Number.parseInt(t[1].value,t[2].value),!1,!0,"Gibt den numerischen Wert des Zeichens zur Basis radix zurück.")),this.addMethod(new m("forDigit",new g([{identifier:"int-value",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radix",type:C,declaration:null,usagePositions:null,isFinal:!0}]),Ge,t=>t[1].value.toString(t[2].value).charAt(0),!1,!0,"Gibt den übergebenen Wert als Ziffer im Zahlensystem zur Basis radix zurück.")),this.addMethod(new m("getNumericValue",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>t[1].value.charCodeAt(0),!1,!0,"Wandelt das Zeichen in einen numerischen Wert (Unicode-Wert) um.")),this.addMethod(new m("isLetter",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value.match(/[a-zäöüß]/i)!=null,!1,!0,"Gibt genau dann true zurück, wenn das Zeichen ein deutsches Alphabet-Zeichen ist.")),this.addMethod(new m("isLetterOrDigit",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value.match(/[a-zäöüß0-9]/i)!=null,!1,!0,"Gibt genau dann true zurück, wenn das Zeichen ein deutsches Alphabet-Zeichen oder eine Ziffer ist.")),this.addMethod(new m("isDigit",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value.match(/[0-9]/i)!=null,!1,!0,"Gibt genau dann true zurück, wenn das Zeichen eine Ziffer ist.")),this.addMethod(new m("isWhitespace",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value.match(/[ \r\n\t]/i)!=null,!1,!0,"Gibt genau dann true zurück, wenn das Zeichen ein Leerzeichen, Tabulatorzeichen oder Zeilenumbruch ist.")),this.addMethod(new m("toUpperCase",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),Ge,t=>t[1].value.toLocaleUpperCase(),!1,!0,"Wandelt das Zeichen in Großschreibung um.")),this.addMethod(new m("toLowerCase",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),Ge,t=>t[1].value.toLocaleLowerCase(),!1,!0,"Wandelt das Zeichen in Kleinschreibung um.")),this.addMethod(new m("valueOf",new g([{identifier:"char-value",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Wandelt den char-Wert in ein Character-Objekt um."))}debugOutput(t){return""+t.value}}class Lv extends ${constructor(t){super("Boolean",null,"Wrapper-Klasse, um boolean-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.addAttribute(new ce("TRUE",this,i=>{i.value=!0},!0,ee.public,!0,"das Boolean-Objekt, das TRUE repräsentiert")),this.addAttribute(new ce("FALSE",this,i=>{i.value=!1},!0,ee.public,!0,"das Boolean-Objekt, das FALSE repräsentiert")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[P],this.addMethod(new m("Boolean",new g([{identifier:"boolean-value",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Boolean-Objekt",!0)),this.addMethod(new m("Boolean",new g([{identifier:"string-value",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1]!=null&&t[1].value.toLowerCase()=="true"},!1,!1,'Instanziert ein neues Boolean-Objekt: Es nimmt genau dann den Wert true an, wenn die übergebene Zeichenkette ohne Berücksichtigung von Klein-/Großschreibung den Wert "true" hat.',!0)),this.addMethod(new m("booleanValue",new g([]),P,t=>t[0].value,!1,!1,"Wandelt das Boolean-Objekt in einen boolean-Wert um")),this.addMethod(new m("compareTo",new g([{identifier:"anotherBoolean",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{let i=t[0].value,n=t[1].value;return i==n?0:1},!1,!1,"Gibt genau dann 0 zurück, wenn der Wert des Objekts gleich dem übergebenen Wert ist, ansonsten 1.")),this.addMethod(new m("equals",new g([{identifier:"anotherBoolean",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>""+t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zurück.")),this.addMethod(new m("hashCode",new g([]),C,t=>t[0].value?0:1,!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("booleanValue",new g([]),P,t=>t[0].value,!1,!1,"Gibt den boolean-Wert des Objekts zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"boolean-value",type:P,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Wandelt den boolean-Wert in ein Boolean-Objekt um.")),this.addMethod(new m("valueOf",new g([{identifier:"string-value",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value!=null&&t[1].value.toLowerCase()=="true",!1,!0,'Wandelt die Zeichenkette in einen boolean-Wert um. Er ergibt true genau dann, wenn die Zeichenkette != null ist und - ohne Berücksichtigung von Klein-/Großschreibung - den Wert "true" hat.')),this.addMethod(new m("parseBoolean",new g([{identifier:"string-value",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value!=null&&t[1].value.toLowerCase()=="true",!1,!0,'Wandelt die Zeichenkette in einen boolean-Wert um. Er ergibt true genau dann, wenn die Zeichenkette != null ist und - ohne Berücksichtigung von Klein-/Großschreibung - den Wert "true" hat.'))}debugOutput(t){return""+t.value}}class Bv extends ${constructor(t){super("Double",null,"Wrapper-Klasse, um double-Werte in Collections verenden zu können.");y(this,"unboxableAs",[]);this.baseClass=t,this.addAttribute(new ce("MAX_VALUE",A,i=>{i.value=Number.MAX_VALUE},!0,ee.public,!0,"Der größte Wert, den eine Variable vom Typ double annehmen kann")),this.addAttribute(new ce("MIN_VALUE",A,i=>{i.value=Number.MIN_VALUE},!0,ee.public,!0,"Der kleinste Wert, den eine Variable vom Typ double annehmen kann")),this.addAttribute(new ce("NaN_VALUE",A,i=>{i.value=Number.NaN},!0,ee.public,!0,'Der "Not a Number"-Wert vom Typ double')),this.addAttribute(new ce("NEGATIVE_INFINITY",A,i=>{i.value=Number.NEGATIVE_INFINITY},!0,ee.public,!0,'Der "negative infinity"-Wert vom Typ double')),this.addAttribute(new ce("POSITIVE_INFINITY",A,i=>{i.value=Number.POSITIVE_INFINITY},!0,ee.public,!0,'Der "positive infinity"-Wert vom Typ double')),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}canCastTo(t){return this.unboxableAs.indexOf(t)>=0||super.canCastTo(t)}init(){this.unboxableAs=[A],this.addMethod(new m("Double",new g([{identifier:"double-value",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Double-Objekt",!0)),this.addMethod(new m("Double",new g([{identifier:"int-value",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=t[1].value},!1,!1,"Instanziert ein neues Double-Objekt",!0)),this.addMethod(new m("Double",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{t[0].value=Number.parseFloat(t[1].value)},!1,!1,"Instanziert ein neues Double-Objekt, indem die übergebene Zeichenkette in einen double-Wert umgewandelt wird.",!0)),this.addMethod(new m("doubleValue",new g([]),A,t=>t[0].value,!1,!1,"Wandelt das Double-Objekt in einen double-Wert um.")),this.addMethod(new m("floatValue",new g([]),G,t=>t[0].value,!1,!1,"Wandelt das Double-Objekt in einen float-Wert um.")),this.addMethod(new m("intValue",new g([]),C,t=>Math.trunc(t[0].value),!1,!1,"Wandelt das Double-Objekt durch Abrunden in einen int-Wert um.")),this.addMethod(new m("compareTo",new g([{identifier:"anotherDouble",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{let i=t[0].value,n=t[1].value;return i>n?1:i<n?-1:0},!1,!1,"Ist der Wert größer als der übergebene Wert, so wird +1 zurückgegeben. Ist er kleiner, so wird -1 zurückgegeben. Sind die Werte gleich, so wird 0 zurückgegeben.")),this.addMethod(new m("equals",new g([{identifier:"anotherDouble",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[0].value==t[1].value,!1,!1,"Gibt genau dann true zurück, wenn der Wert gleich dem übergebenen Wert ist.")),this.addMethod(new m("toString",new g([]),F,t=>""+t[0].value,!1,!1,"Gibt den Wert des Objekts als String-Wert zurück.")),this.addMethod(new m("hashCode",new g([]),C,t=>Math.trunc(t[0].value),!1,!1,"Gibt den hashCode des Objekts zurück.")),this.addMethod(new m("parseDouble",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Number.parseFloat(t[1].value),!1,!0,"Wandelt die Zeichenkette in einen double-Wert um")),this.addMethod(new m("toString",new g([{identifier:"f",type:A,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>""+t[1].value,!1,!0,"Gibt die übergebene Zahl als String-Wert zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"f",type:A,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>t[1].value,!1,!0,"Gibt die übergebene Zahl als Double-Objekt zurück.")),this.addMethod(new m("valueOf",new g([{identifier:"s",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>Number.parseFloat(t[1].value),!1,!0,"Interpretiert die übergebene Zeichenkette als Dezimalzahl und gib sie als Double-Objekt zurück.")),this.addMethod(new m("isNaN",new g([{identifier:"f",type:A,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>Number.isNaN(t[1].value),!1,!0,"Gibt genau dann true zurück, falls die übergebene double-Zahl NaN (not a Number) ist.")),this.addMethod(new m("isNaN",new g([]),P,t=>Number.isNaN(t[0].value),!1,!1,"Gibt genau dann true zurück, falls das Objekt NaN (not a Number) ist.")),this.addMethod(new m("isInfinite",new g([{identifier:"f",type:A,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>t[1].value==1/0,!1,!0,"Gibt genau dann true zurück, falls die übergebene double-Zahl INFINTITY ist.")),this.addMethod(new m("isInfinite",new g([]),P,t=>t[0].value==1/0,!1,!1,"Gibt genau dann true zurück, falls das Objekt INFINITY ist."))}debugOutput(t){return""+t.value}}class zv extends ar{constructor(){super(),this.identifier="null"}getResultType(e,t){return[f.equal,f.notEqual].indexOf(e)>=0&&(t instanceof $||t instanceof ze)?P:null}compute(e,t,i){return e==f.equal?t.value==i.value:e==f.notEqual?t.value!=i.value:null}canCastTo(e){return e instanceof $||e instanceof Pe||e instanceof ze}castTo(e,t){return e}equals(e){return e instanceof $||e instanceof Pe}debugOutput(e){return"null"}}class jv extends ar{constructor(){super(),this.identifier="var"}getResultType(e,t){return null}compute(e,t,i){return null}canCastTo(e){return e instanceof $||e instanceof Pe}castTo(e,t){return e}equals(e){return e instanceof $||e instanceof Pe}debugOutput(e){return"var"}}class ac extends ut{init(){this.initialValue=0,this.identifier="int",this.description="ganze Zahl",this.operationTable={[f.plus]:{char:C,long:se,short:C,Short:C,Long:se,int:C,Integer:C,float:G,Float:G,double:A,Double:A,String:F},[f.minus]:{none:C,long:se,short:C,Short:C,Long:se,int:C,Integer:C,float:G,Float:G,double:A,Double:A},[f.multiplication]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C,float:G,Float:G,double:A,Double:A},[f.modulo]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.division]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C,float:G,Float:G,double:A,Double:A},[f.doublePlus]:{none:C},[f.doubleMinus]:{none:C},[f.negation]:{none:C},[f.tilde]:{none:C},[f.lower]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.greater]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.lowerOrEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.greaterOrEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.equal]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.notEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P,char:P},[f.OR]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.XOR]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.ampersand]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.shiftLeft]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.shiftRight]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C},[f.shiftRightUnsigned]:{long:se,short:C,Short:C,Long:se,int:C,Integer:C}},this.canCastToMap={float:{automatic:!0,needsStatement:!1},double:{automatic:!0,needsStatement:!1},String:{automatic:!0,needsStatement:!0},char:{automatic:!1,needsStatement:!0},int:{automatic:!0,needsStatement:!1},short:{automatic:!0,needsStatement:!1},long:{automatic:!0,needsStatement:!1},Integer:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.integerConstant}castTo(e,t){if(t==G||t==A)return{type:t,value:e.value};if(t==F)return{type:t,value:""+e.value};if(t==Ge)return{type:t,value:String.fromCharCode(e.value)}}compute(e,t,i){let n=t.value;switch(e){case f.plus:return i.type==F,n+i.value;case f.minus:return i==null?-n:n-i.value;case f.multiplication:return n*i.value;case f.division:return i.type==C?Math.trunc(n/i.value):n/i.value;case f.modulo:return i.type==C?Math.trunc(n%i.value):1;case f.doublePlus:return n++;case f.doubleMinus:return n--;case f.negation:return-n;case f.tilde:return~n;case f.lower:return n<i.value;case f.greater:return n>i.value;case f.lowerOrEqual:return n<=i.value;case f.greaterOrEqual:return n>=i.value;case f.equal:return n==i.value;case f.notEqual:return n!=i.value;case f.OR:return n|i.value;case f.XOR:return n^i.value;case f.ampersand:return n&i.value;case f.shiftLeft:return n<<i.value;case f.shiftRight:return n>>i.value;case f.shiftRightUnsigned:return n>>>i.value}}debugOutput(e){return""+e.value}}class Nv extends ac{init(){this.initialValue=0,this.identifier="long",this.description="ganze Zahl",this.operationTable={[f.plus]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se,float:G,Float:G,double:A,Double:A,String:F},[f.minus]:{none:C,long:se,short:se,Short:se,int:se,Long:se,Integer:se,float:G,Float:G,double:A,Double:A},[f.multiplication]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se,float:G,Float:G,double:A,Double:A},[f.modulo]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.division]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se,float:G,Float:G,double:A,Double:A},[f.doublePlus]:{none:C},[f.doubleMinus]:{none:C},[f.negation]:{none:C},[f.tilde]:{none:C},[f.lower]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greater]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.lowerOrEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greaterOrEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.equal]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.notEqual]:{long:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.OR]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.XOR]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.ampersand]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.shiftLeft]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.shiftRight]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se},[f.shiftRightUnsigned]:{long:se,short:se,Short:se,int:se,Long:se,Integer:se}},this.canCastToMap={float:{automatic:!0,needsStatement:!1},double:{automatic:!0,needsStatement:!1},String:{automatic:!0,needsStatement:!0},char:{automatic:!0,needsStatement:!0},int:{automatic:!1,needsStatement:!1},long:{automatic:!0,needsStatement:!1},short:{automatic:!0,needsStatement:!1},Integer:{automatic:!0,needsStatement:!1},Long:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.longConstant}}class Gv extends ac{init(){this.initialValue=0,this.identifier="short",this.description="ganze Zahl",this.operationTable={[f.plus]:{short:it,int:C,Short:it,Integer:C,float:G,Float:G,double:A,Double:A,String:F},[f.minus]:{none:it,short:it,int:C,Short:it,Integer:C,float:G,Float:G,double:A,Double:A},[f.multiplication]:{short:it,int:C,Short:it,Integer:C,float:G,Float:G,double:A,Double:A},[f.modulo]:{short:it,int:C,Short:it,Integer:C},[f.division]:{short:it,int:C,Short:it,Integer:C,float:G,Float:G,double:A,Double:A},[f.doublePlus]:{none:it},[f.doubleMinus]:{none:it},[f.negation]:{none:it},[f.tilde]:{none:it},[f.lower]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greater]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.lowerOrEqual]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greaterOrEqual]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.equal]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.notEqual]:{short:P,int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.OR]:{short:it,int:C,Short:it,Integer:it},[f.XOR]:{short:it,int:C,Short:it,Integer:it},[f.ampersand]:{short:it,int:C,Short:it,Integer:it},[f.shiftLeft]:{short:it,int:C,Short:it,Integer:it},[f.shiftRight]:{short:it,int:C,Short:it,Integer:it},[f.shiftRightUnsigned]:{short:it,int:C,Short:it,Integer:it}},this.canCastToMap={float:{automatic:!0,needsStatement:!1},double:{automatic:!0,needsStatement:!1},String:{automatic:!0,needsStatement:!0},char:{automatic:!0,needsStatement:!0},int:{automatic:!1,needsStatement:!1},long:{automatic:!0,needsStatement:!1},short:{automatic:!0,needsStatement:!1},Short:{automatic:!0,needsStatement:!1},Integer:{automatic:!0,needsStatement:!1},Long:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.shortConstant}}class Wv extends ut{init(){this.initialValue=0,this.identifier="float",this.description="Fließkommazahl mit einfacher Genauigkeit",this.operationTable={[f.plus]:{short:G,Short:G,Integer:G,int:G,float:G,Float:G,double:A,Double:A,String:F},[f.minus]:{none:G,short:G,Short:G,Integer:G,int:G,float:G,Float:G,double:A,Double:A},[f.multiplication]:{short:G,Short:G,Integer:G,int:G,float:G,Float:G,double:A,Double:A},[f.division]:{short:G,Short:G,Integer:G,int:G,float:G,Float:G,double:A,Double:A},[f.modulo]:{short:G,Short:G,Integer:G,int:G,float:G,Float:G,double:A,Double:A},[f.doublePlus]:{none:G},[f.doubleMinus]:{none:G},[f.negation]:{none:G},[f.lower]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greater]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.lowerOrEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greaterOrEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.equal]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.notEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P}},this.canCastToMap={int:{automatic:!1,needsStatement:!0},double:{automatic:!0,needsStatement:!1},float:{automatic:!0,needsStatement:!1},String:{automatic:!0,needsStatement:!0},Float:{automatic:!0,needsStatement:!1},Double:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.floatingPointConstant}castTo(e,t){if(t==F)return{type:t,value:""+e.value};if(t==C)return{type:t,value:Math.trunc(e.value)};if(t==A)return{type:t,value:e.value}}compute(e,t,i){let n=t.value;switch(e){case f.plus:return i.type==F,n+i.value;case f.minus:return i==null?-n:n-i.value;case f.multiplication:return n*i.value;case f.division:return n/i.value;case f.modulo:return n%i.value;case f.doublePlus:return n++;case f.doubleMinus:return n--;case f.negation:return-n;case f.lower:return n<i.value;case f.greater:return n>i.value;case f.lowerOrEqual:return n<=i.value;case f.greaterOrEqual:return n>=i.value;case f.equal:return n==i.value;case f.notEqual:return n!=i.value}}debugOutput(e){return""+e.value}}class Hv extends ut{init(){this.initialValue=0,this.identifier="double",this.description="Fließkommazahl mit doppelter Genauigkeit",this.operationTable={[f.plus]:{int:A,short:A,Short:A,Integer:A,float:A,Float:A,double:A,Double:A,String:F},[f.minus]:{none:A,int:A,short:A,Short:A,Integer:A,float:A,Float:A,double:A,Double:A},[f.multiplication]:{int:A,short:A,Short:A,Integer:A,float:A,Float:A,double:A,Double:A},[f.division]:{int:A,short:A,Short:A,Integer:A,float:A,Float:A,double:A,Double:A},[f.modulo]:{int:A,short:A,Short:A,Integer:A,float:A,Float:A,double:A,Double:A},[f.doublePlus]:{none:A},[f.doubleMinus]:{none:A},[f.negation]:{none:A},[f.lower]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greater]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.lowerOrEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.greaterOrEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.equal]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P},[f.notEqual]:{int:P,float:P,double:P,Integer:P,Float:P,Double:P}},this.canCastToMap={int:{automatic:!1,needsStatement:!0},float:{automatic:!0,needsStatement:!1},double:{automatic:!0,needsStatement:!1},String:{automatic:!0,needsStatement:!0},Float:{automatic:!0,needsStatement:!1},Double:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.floatingPointConstant}castTo(e,t){if(t==F)return{type:t,value:""+e.value};if(t==C)return{type:t,value:Math.trunc(e.value)};if(t==G)return{type:t,value:e.value}}compute(e,t,i){let n=t.value;switch(e){case f.plus:return i.type==F,n+i.value;case f.minus:return i==null?-n:n-i.value;case f.multiplication:return n*i.value;case f.division:return n/i.value;case f.modulo:return n%i.value;case f.doublePlus:return n++;case f.doubleMinus:return n--;case f.negation:return-n;case f.lower:return n<i.value;case f.greater:return n>i.value;case f.lowerOrEqual:return n<=i.value;case f.greaterOrEqual:return n>=i.value;case f.equal:return n==i.value;case f.notEqual:return n!=i.value}}debugOutput(e){return""+e.value}}class Uv extends ut{init(){this.initialValue=!1,this.identifier="boolean",this.description="boolescher Wert (true oder false)",this.operationTable={[f.plus]:{String:F},[f.and]:{boolean:P},[f.or]:{boolean:P},[f.not]:{none:P},[f.equal]:{boolean:P},[f.notEqual]:{boolean:P}},this.canCastToMap={String:{automatic:!0,needsStatement:!0},boolean:{automatic:!0,needsStatement:!1},Boolean:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.booleanConstant}castTo(e,t){if(t==F)return{type:t,value:""+e.value}}compute(e,t,i){let n=t.value;switch(e){case f.plus:return n+i.value;case f.equal:return n==i.value;case f.notEqual:return n!=i.value;case f.and:return n&&i.value;case f.or:return n||i.value;case f.not:return!n}}debugOutput(e){return""+e.value}}class Vv extends ut{init(){this.initialValue=!1,this.identifier="void",this.description="leerer Rückgabewert",this.operationTable={},this.canCastToMap={}}toTokenType(){return f.keywordVoid}castTo(e,t){return e}compute(e,t,i){return null}debugOutput(e){return"void"}}class Xa extends ${constructor(t){super("String",null,"Ein Objekt der Klasse String speichert eine Zeichenkette.");y(this,"operationTable");this.baseClass=t;let i=this;t.methods.filter(n=>n.identifier=="toString").forEach(n=>n.returnType=i)}toTokenType(){return f.stringConstant}getResultType(t,i){if(t==f.keywordInstanceof)return super.getResultType(t,i);let n=this.operationTable[t];return n==null?null:i!=null?n[i.identifier]||n[i.identifier.toLocaleLowerCase()]:n.none}init(){this.operationTable={[f.plus]:{String:F,int:F,float:F,double:A,boolean:F,char:F},[f.equal]:{String:P,null:P},[f.notEqual]:{String:P,null:P},[f.lower]:{String:P},[f.greater]:{String:P},[f.lowerOrEqual]:{String:P},[f.greaterOrEqual]:{String:P}},this.addMethod(new m("length",new g([]),C,i=>i[0].value.length,!1,!1,"Länge der Zeichenkette, d.h. Anzahl der Zeichen in der Zeichenkette.")),this.addMethod(new m("charAt",new g([{identifier:"Position",type:C,declaration:null,usagePositions:null,isFinal:!1}]),Ge,i=>{let n=i[1].value,s=i[0].value;return(n<0||n>=s.length)&&this.module.main.getInterpreter().throwException("Die Zeichenkette hat kein Zeichen an der Position "+n+"."),s.charAt(n)},!1,!1,`Zeichen an der gegebenen Position.
**Bem.: ** Position == 0 bedeutet das erste Zeichen in der Zeichenkette, Position == 1 das zweite usw. .`)),this.addMethod(new m("equals",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),P,i=>i[0].value==i[1].value,!1,!1,"Gibt genau dann **wahr** zurück, wenn die zwei Zeichenketten übereinstimmen (unter Berücksichtigung von Klein-/Großschreibung).")),this.addMethod(new m("compareTo",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.localeCompare(i[1].value,"de",{caseFirst:"upper"}),!1,!1,"Vergleicht den String mit dem übergebenen String. Gibt -1 zurück, falls ersterer im Alphabet vor letzterem steht, +1, falls umgekehrt und 0, falls beide Strings identisch sind.")),this.addMethod(new m("concat",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,i=>i[0].value+i[1].value,!1,!1,"Hängt die übergebene Zeichenkette an diese Zeichenkette an.")),this.addMethod(new m("compareToIgnoreCase",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.localeCompare(i[1].value,"de",{sensitivity:"accent"}),!1,!1,"Vergleicht den String mit dem übergebenen String. Gibt -1 zurück, falls ersterer im Alphabet vor letzterem steht, +1, falls umgekehrt und 0, falls beide Strings identisch sind.")),this.addMethod(new m("equalsIgnoreCase",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),P,i=>i[0].value.toLowerCase()==i[1].value.toLowerCase(),!1,!1,"Gibt genau dann **wahr** zurück, wenn die zwei Zeichenketten übereinstimmen (**ohne** Berücksichtigung von Klein-/Großschreibung).")),this.addMethod(new m("endsWith",new g([{identifier:"suffix",type:F,declaration:null,usagePositions:null,isFinal:!1}]),P,i=>i[0].value.endsWith(i[1].value),!1,!1,"Gibt genau dann **wahr** zurück, wenn die Zeichenkette mit der übergebenen Zeichenkette ( = suffix) endet. Klein-/Großschreibung wird dabei berücksichtigt!")),this.addMethod(new m("startsWith",new g([{identifier:"präfix",type:F,declaration:null,usagePositions:null,isFinal:!1}]),P,i=>i[0].value.startsWith(i[1].value),!1,!1,"Gibt genau dann **wahr** zurück, wenn die Zeichenkette mit der übergebenen Zeichenkette ( = präfix) beginnt. Klein-/Großschreibung wird dabei berücksichtigt!")),this.addMethod(new m("toLowerCase",new g([]),F,i=>i[0].value.toLocaleLowerCase(),!1,!1,`Gibt die Zeichenkette zurück, die sich ergibt, wenn man in der gegebenen Zeichnkette jeden Großbuchstaben durch den entsprechenden Kleinbuchstaben ersetzt.
**Bemerkung: ** Die Methode verändert die Zeichenkette selbst nicht.`)),this.addMethod(new m("toUpperCase",new g([]),F,i=>i[0].value.toLocaleUpperCase(),!1,!1,`Gibt die Zeichenkette zurück, die sich ergibt, wenn man in der gegebenen Zeichnkette jeden Kleinbuchstaben durch den entsprechenden Großbuchstaben ersetzt.
**Bemerkung: ** Die Methode verändert die Zeichenkette selbst nicht.`)),this.addMethod(new m("substring",new g([{identifier:"beginIndex",type:C,declaration:null,usagePositions:null,isFinal:!1}]),F,i=>i[0].value.substring(i[1].value),!1,!1,"Gibt das hintere Ende der Zeichenkette ab **beginIndex** zurück. **beginIndex** == 1 bedeutet, dass die Zeichenkette ab dem 2.(!) Zeichen zurückgegeben wird. ")),this.addMethod(new m("substring",new g([{identifier:"beginIndex",type:C,declaration:null,usagePositions:null,isFinal:!1},{identifier:"endIndex",type:C,declaration:null,usagePositions:null,isFinal:!1}]),F,i=>i[0].value.substring(i[1].value,i[2].value),!1,!1,`Gibt die Teil-Zeichenkette von **beginIndex** bis **endIndex** zurück.
**Vorsicht: ** beginIndex und endIndex sind nullbasiert, d.h. beginIndex == 0 bedeutet die Position vor dem ersten Zeichen.`)),this.addMethod(new m("trim",new g([]),F,i=>i[0].value.trim(),!1,!1,"Gibt die Zeichenkette zurück, die entsteht, wenn man am Anfang und Ende der Zeichenkette alle Leerzeichen, Tabs und Zeilenumbrüche entfernt.")),this.addMethod(new m("isEmpty",new g([]),P,i=>i[0].value=="",!1,!1,`Gibt genau dann wahr zurück, wenn die Zeichenkette leer ist.
**Warnung: ** Die Methode darf nicht mit dem '''null'''-Objekt aufgerufen werden!`)),this.addMethod(new m("indexOf",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.indexOf(i[1].value),!1,!1,"Gibt die erste Position zurück, an der **otherString** in der Zeichenkette gefunden wird.")),this.addMethod(new m("indexOf",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1},{identifier:"fromIndex",type:C,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.indexOf(i[1].value,i[2].value),!1,!1,"Gibt die erste Position zurück, an der **otherString** in der Zeichenkette gefunden wird. Dabei wird erst bei fromIndex mit der Suche begonnen.")),this.addMethod(new m("lastIndexOf",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.lastIndexOf(i[1].value),!1,!1,"Gibt die letzte Position zurück, bei der otherString in der Zeichenkette gefunden wird.")),this.addMethod(new m("lastIndexOf",new g([{identifier:"otherString",type:F,declaration:null,usagePositions:null,isFinal:!1},{identifier:"fromIndex",type:C,declaration:null,usagePositions:null,isFinal:!1}]),C,i=>i[0].value.lastIndexOf(i[1].value,i[2].value),!1,!1,"Gibt die letzte Position zurück, bei der otherString in der Zeichenkette gefunden wird. Dabei wird erst bei fromIndex - von rechts her beginnend - gesucht.")),this.addMethod(new m("replace",new g([{identifier:"target",type:F,declaration:null,usagePositions:null,isFinal:!1},{identifier:"replacement",type:F,declaration:null,usagePositions:null,isFinal:!1}]),F,i=>i[0].value.replace(i[1].value,i[2].value),!1,!1,"Ersetzt alle Vorkommen von **target** durch **replacement** und gibt die entstandene Zeichenkette zurück. Die Zeichenkette selbst wird nicht verändert.")),this.addMethod(new m("replaceAll",new g([{identifier:"regex",type:F,declaration:null,usagePositions:null,isFinal:!1},{identifier:"replacement",type:F,declaration:null,usagePositions:null,isFinal:!1}]),F,i=>{let n=i[1].value,s=new RegExp(n,"g");return i[0].value.replace(s,i[2].value)},!1,!1,"Durchsucht den String mit dem regulären Ausdruck (regex) und ersetzt **alle** Fundstellen durch **replacement**.")),this.addMethod(new m("matches",new g([{identifier:"regex",type:F,declaration:null,usagePositions:null,isFinal:!1}]),P,i=>{let n=i[1].value,s=new RegExp(n,"g");return i[0].value.match(s)!=null},!1,!1,"Gibt genau dann true zurück, wenn der Wert der Zeichenkette dem regulären Ausdruck (regex) entspricht.")),this.addMethod(new m("replaceFirst",new g([{identifier:"regex",type:F,declaration:null,usagePositions:null,isFinal:!1},{identifier:"replacement",type:F,declaration:null,usagePositions:null,isFinal:!1}]),F,i=>{let n=i[1].value,s=new RegExp(n,"");return i[0].value.replace(s,i[2].value)},!1,!1,"Durchsucht den String mit dem regulären Ausdruck (regex) und ersetzt **die erste** Fundstelle durch **replacement**.")),this.addMethod(new m("split",new g([{identifier:"regex",type:F,declaration:null,usagePositions:null,isFinal:!1}]),new ze(F),i=>{let n=i[1].value,s=new RegExp(n,""),a=i[0].value.split(s),l=[];for(let o of a)l.push({type:F,value:o});return l},!1,!1,"Teilt die Zeichenkette an den Stellen, die durch den regulären Ausdruck (regex) definiert sind, in Teile auf. Die Fundstellen des regex werden dabei weggelassen. Gibt die Teile als String-Array zurück.")),Ge.identifier="char";let t=[new ze(Ge),Ge,C,A,G,P,se,G];for(let i of t)this.addMethod(new m("valueOf",new g([{identifier:"value",type:i,declaration:null,usagePositions:null,isFinal:!1}]),F,n=>{let s=n[1].value;return s==null?"null":Array.isArray(s)?s.map(a=>a.value).join(""):""+s},!1,!0,"Wandelt den Parameter in eine Zeichenkette um",!1));this.addMethod(new m("toCharArray",new g([]),new ze(Ge),i=>{let n=Array.from(i[0].value),s=[];for(let a of n)s.push({type:Ge,value:a});return s},!1,!1,"Wandelt die Zeichenkette in ein Array von Zeichen um."))}compute(t,i,n){let s=i.value;switch(t){case f.plus:return n.type==F||n.type==Ge||n.type==P,s+n.value;case f.lower:return s.localeCompare(n.value,"de",{caseFirst:"upper"})<0;case f.greater:return s.localeCompare(n.value,"de",{caseFirst:"upper"})>0;case f.lowerOrEqual:return s.localeCompare(n.value,"de",{caseFirst:"upper"})<=0;case f.greaterOrEqual:return s.localeCompare(n.value,"de",{caseFirst:"upper"})>=0;case f.equal:return s==n.value;case f.notEqual:return s!=n.value;case f.keywordInstanceof:return super.compute(t,i,n)}}debugOutput(t){return'"'+t.value+'"'}}class $v extends ut{init(){this.initialValue="\0",this.identifier="char",this.description="ein Zeichen",this.operationTable={[f.plus]:{String:F,char:F,int:C},[f.minus]:{char:F,int:C},[f.equal]:{char:P,int:P},[f.notEqual]:{char:P,int:P},[f.lower]:{char:P,int:P},[f.greater]:{char:P,int:P},[f.lowerOrEqual]:{char:P,int:P},[f.greaterOrEqual]:{char:P,int:P},[f.modulo]:{char:C,int:C}},this.canCastToMap={int:{automatic:!0,needsStatement:!0},float:{automatic:!0,needsStatement:!0},double:{automatic:!0,needsStatement:!0},String:{automatic:!0,needsStatement:!1},char:{automatic:!0,needsStatement:!1},Character:{automatic:!0,needsStatement:!1}}}toTokenType(){return f.charConstant}castTo(e,t){if(t==F)return e;if(t==C||t==G||t==A)return{type:t,value:e.value.charCodeAt(0)}}compute(e,t,i){let n=t.value;switch(e){case f.plus:return n+i.value;case f.minus:return n-i.value;case f.lower:return n<i.value;case f.greater:return n>i.value;case f.lowerOrEqual:return n<=i.value;case f.greaterOrEqual:return n>=i.value;case f.equal:return n==i.value;case f.notEqual:return n!=i.value;case f.modulo:let s=typeof n=="number"?n:n.charCodeAt(0),a=typeof i.value=="number"?i.value:i.value.charCodeAt(0);return s%a}}debugOutput(e){return"'"+e.value+"'"}}var U=new Vv,C=new ac,se=new Nv,it=new Gv,G=new Wv,A=new Hv,P=new Uv;Iv(P);var Wi=new Ma(null),F=new Xa(Wi),Ge=new $v,Ka=new zv,lo=new jv,lc=new Dv(Wi),oc=new Fv(Wi),uc=new Rv(Wi),hc=new Bv(Wi),dc=new Ov(Wi),cc=new Lv(Wi),ah={[f.integerConstant]:C,[f.longConstant]:se,[f.floatingPointConstant]:G,[f.booleanConstant]:P,[f.stringConstant]:F,[f.charConstant]:Ge,[f.keywordNull]:Ka};class Xv{constructor(){y(this,"hexColorRegExp",/^#([a-fA-F0-9]{6})$/);y(this,"rgbColorRegExp",/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/);y(this,"rgbaColorRegExp",/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d*(?:\.\d+)?)\)$/)}getColorInfo(e){if(e.startsWith("#")){let t=e.match(this.hexColorRegExp);if(t==null)return null;let i=Number.parseInt(t[1],16);return{red:(i>>16)/255,green:(i>>8&255)/255,blue:(i&255)/255,alpha:1}}else if(e.startsWith("rgb"))if(e.startsWith("rgba")){let t=e.match(this.rgbaColorRegExp);return t==null?null:{red:Number.parseInt(t[1])/255,green:Number.parseInt(t[2])/255,blue:Number.parseInt(t[3])/255,alpha:Number.parseFloat(t[4])}}else{let t=e.match(this.rgbColorRegExp);return t==null?null:{red:Number.parseInt(t[1])/255,green:Number.parseInt(t[2])/255,blue:Number.parseInt(t[3])/255,alpha:1}}return null}}class Ot{static intColorToHexRGB(e){if(e==null)return"---";{let t=e.toString(16);for(;t.length<6;)t="0"+t;return"#"+t}}static intColorToRGB(e){return e==null?"---":"rgb("+((e&16711680)>>16)+", "+((e&65280)>>8)+", "+(e&255)+")"}static parseColorToOpenGL(e){if(e==null)return{color:null,alpha:1};let t=this.predefinedColors[e];if(t!=null)return{color:t,alpha:1};let i=e.match(/^#([0-9a-f]{6})$/i);if(i&&i.length>1){let a=i[1];if(a)return{color:65536*parseInt(a.substr(0,2),16)+256*parseInt(a.substr(2,2),16)+parseInt(a.substr(4,2),16),alpha:1}}let n=e.match(/^#([0-9a-f]{8})$/i);if(n&&n.length>1){let a=n[1];if(a)return{color:65536*parseInt(a.substr(0,2),16)+256*parseInt(a.substr(2,2),16)+parseInt(a.substr(4,2),16),alpha:parseInt(a.substr(6,2),16)/255}}let s=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);return s?{color:parseInt(s[1])*65536+parseInt(s[2])*256+parseInt(s[3]),alpha:1}:(s=e.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+\.?\d+)\s*\)$/i),s?{color:parseInt(s[1])*65536+parseInt(s[2])*256+parseInt(s[3]),alpha:parseFloat(s[4])}:{color:16711680,alpha:1})}}y(Ot,"predefinedColors",{aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedAlmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grau:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldLace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,sand:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});var Mn="►";class fc{constructor(){y(this,"tokenList");y(this,"nonSpaceLastTokenType");y(this,"errorList");y(this,"colorInformation");y(this,"colorLexer",new Xv);y(this,"pos");y(this,"line");y(this,"column");y(this,"currentChar");y(this,"nextChar");y(this,"input");y(this,"spaceTokens",[f.space,f.tab,f.newline]);y(this,"bracketStack");y(this,"bracketError");y(this,"correspondingBracket",{});y(this,"colorIndices");this.correspondingBracket[f.leftBracket]=f.rightBracket,this.correspondingBracket[f.leftCurlyBracket]=f.rightCurlyBracket,this.correspondingBracket[f.leftSquareBracket]=f.rightSquareBracket,this.correspondingBracket[f.rightBracket]=f.leftBracket,this.correspondingBracket[f.rightCurlyBracket]=f.leftCurlyBracket,this.correspondingBracket[f.rightSquareBracket]=f.leftSquareBracket}lex(e){if(this.input=e.replace("슠"," "),this.input=e.replace(" "," "),this.tokenList=[],this.errorList=[],this.bracketError=null,this.bracketStack=[],this.pos=0,this.line=1,this.column=1,this.nonSpaceLastTokenType=null,this.colorInformation=[],this.colorIndices=[],e.length==0)return{tokens:this.tokenList,errors:this.errorList,bracketError:null,colorInformation:[]};for(this.currentChar=e.charAt(0),this.nextChar=e.length>1?e.charAt(1):Mn;this.currentChar!=Mn;)this.mainState();if(this.bracketStack.length>0){let t=this.bracketStack.pop(),i=this.correspondingBracket[t];this.setBracketError(ni[t]+" "+ni[i])}return this.processColorIndices(),{tokens:this.tokenList,errors:this.errorList,bracketError:this.bracketError,colorInformation:this.colorInformation}}processColorIndices(){for(let e of this.colorIndices){let t=this.tokenList[e],i=this.getLastNonSpaceToken(e);if((i==null?void 0:i.tt)==f.keywordNew){let n=this.getNextNonSpaceTokens(e,7);this.compareTokenTypes(n,[f.leftBracket,f.integerConstant,f.comma,f.integerConstant,f.comma,f.integerConstant,f.rightBracket])&&this.colorInformation.push({color:{red:n[1].value/255,green:n[3].value/255,blue:n[5].value/255,alpha:1},range:{startLineNumber:i.position.line,startColumn:i.position.column,endLineNumber:n[6].position.line,endColumn:n[6].position.column+1}})}else{let n=this.getNextNonSpaceTokens(e,2);if(this.compareTokenTypes(n,[f.dot,f.identifier])){let s=n[1].value,a=Ot.predefinedColors[s];a!=null&&this.colorInformation.push({color:{red:(a>>16)/255,green:(a>>8&255)/255,blue:(a&255)/255,alpha:1},range:{startLineNumber:t.position.line,startColumn:t.position.column,endLineNumber:n[1].position.line,endColumn:n[1].position.column+s.length}})}}}}compareTokenTypes(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i].tt!=t[i])return!1;return!0}getNextNonSpaceTokens(e,t){let i=[],n=e;for(;i.length<t&&n+1<this.tokenList.length;){let s=this.tokenList[n+1];[f.space,f.newline].indexOf(s.tt)<0&&i.push(s),n++}return i}getLastNonSpaceToken(e){let t=e;for(;t-1>0;){let i=this.tokenList[t-1];if([f.space,f.newline].indexOf(i.tt)<0)return i;t--}return null}checkClosingBracket(e){if(this.bracketStack.length==0){let n=this.correspondingBracket[e];this.setBracketError(ni[n]+" "+ni[e]);return}let t=this.bracketStack.pop(),i=this.correspondingBracket[t];e!=i&&this.setBracketError(ni[t]+" "+ni[i])}setBracketError(e){this.bracketError==null&&(this.bracketError=e)}next(){this.pos++,this.currentChar=this.nextChar,this.pos+1<this.input.length?this.nextChar=this.input.charAt(this.pos+1):this.nextChar=Mn,this.column++}mainState(){let e=this.currentChar,t=rh[e];if(t!=null){switch(t){case f.leftSquareBracket:if(this.nextChar=="]"){this.pushToken(f.leftRightSquareBracket,"[]"),this.next(),this.next();return}else{this.pushToken(f.leftSquareBracket,"["),this.bracketStack.push(t),this.next();return}case f.rightSquareBracket:this.checkClosingBracket(t);break;case f.leftBracket:this.bracketStack.push(t);break;case f.rightBracket:this.checkClosingBracket(t);break;case f.leftCurlyBracket:this.bracketStack.push(t);break;case f.rightCurlyBracket:this.checkClosingBracket(t);break;case f.and:if(this.nextChar=="&"){this.pushToken(f.and,"&&"),this.next(),this.next();return}else if(this.nextChar=="="){this.pushToken(f.ANDAssigment,"&="),this.next(),this.next();return}else{this.pushToken(f.ampersand,"&"),this.next();return}case f.or:if(this.nextChar=="|"){this.pushToken(f.or,"||"),this.next(),this.next();return}else if(this.nextChar=="="){this.pushToken(f.ORAssigment,"&="),this.next(),this.next();return}else{this.pushToken(f.OR,"|"),this.next();return}case f.XOR:if(this.nextChar=="="){this.pushToken(f.XORAssigment,"^="),this.next(),this.next();return}else{this.pushToken(f.XOR,"^"),this.next();return}case f.multiplication:if(this.nextChar=="="){this.pushToken(f.multiplicationAssignment,"*="),this.next(),this.next();return}else{this.pushToken(f.multiplication,"*"),this.next();return}case f.not:if(this.nextChar=="="){this.pushToken(f.notEqual,"!="),this.next(),this.next();return}else{this.pushToken(f.not,"!"),this.next();return}case f.division:if(this.nextChar=="="){this.pushToken(f.divisionAssignment,"/="),this.next(),this.next();return}else if(this.nextChar=="*"){this.lexMultilineComment();return}else if(this.nextChar=="/"){this.lexEndofLineComment();return}this.pushToken(f.division,"/"),this.next();return;case f.modulo:if(this.nextChar=="="){this.pushToken(f.moduloAssignment,"%="),this.next(),this.next();return}else{this.pushToken(f.modulo,"/"),this.next();return}case f.plus:if(this.nextChar=="+"){this.pushToken(f.doublePlus,"++"),this.next(),this.next();return}else if(this.isDigit(this.nextChar,10)&&!([f.identifier,f.integerConstant,f.floatingPointConstant,f.charConstant,f.rightBracket,f.rightSquareBracket].indexOf(this.nonSpaceLastTokenType)>=0)){this.lexNumber();return}else if(this.nextChar=="="){this.pushToken(f.plusAssignment,"+="),this.next(),this.next();return}else{this.pushToken(f.plus,"+"),this.next();return}case f.lower:if(this.nextChar=="="){this.pushToken(f.lowerOrEqual,"<="),this.next(),this.next();return}else if(this.nextChar=="<"){this.lexShiftLeft();return}else{this.pushToken(f.lower,"<"),this.next();return}case f.greater:if(this.nextChar=="="){this.pushToken(f.greaterOrEqual,">="),this.next(),this.next();return}else if(this.nextChar==">"){this.lexShiftRight();return}else{this.pushToken(f.greater,">"),this.next();return}case f.dot:if(this.nextChar=="."&&this.pos+2<this.input.length&&this.input[this.pos+2]=="."){this.pushToken(f.ellipsis,"..."),this.next(),this.next(),this.next();return}else{this.pushToken(f.dot,"."),this.next();return}case f.assignment:if(this.nextChar=="="){this.pushToken(f.equal,"=="),this.next(),this.next();return}else{this.pushToken(f.assignment,"="),this.next();return}case f.minus:if(this.nextChar=="-"){this.pushToken(f.doubleMinus,"--"),this.next(),this.next();return}else if(this.isDigit(this.nextChar,10)&&!([f.identifier,f.integerConstant,f.floatingPointConstant,f.stringConstant,f.rightBracket,f.rightSquareBracket].indexOf(this.nonSpaceLastTokenType)>=0)){this.lexNumber();return}else if(this.nextChar=="="){this.pushToken(f.minusAssignment,"-="),this.next(),this.next();return}else{this.pushToken(f.minus,"-"),this.next();return}case f.singleQuote:this.lexCharacterConstant();return;case f.doubleQuote:this.nextChar=='"'&&this.pos+3<this.input.length&&this.input[this.pos+2]=='"'?this.lexTripleQuoteStringConstant():this.lexStringConstant();return;case f.newline:this.pushToken(f.newline,`
`),this.line++,this.column=0,this.next();return;case f.space:case f.tab:this.lexSpace();return;case f.linefeed:this.next();return;case f.at:this.lexAnnotation();return}this.pushToken(t,e),this.next();return}if(this.isDigit(e,10)){this.lexNumber();return}this.lexIdentifierOrKeyword()}lexShiftRight(){this.next(),this.nextChar==">"?this.lexShiftRightUnsigned():this.nextChar=="="?(this.pushToken(f.shiftRightAssigment,">>="),this.next(),this.next()):(this.pushToken(f.shiftRight,">>"),this.next())}lexShiftRightUnsigned(){this.next(),this.nextChar=="="?(this.pushToken(f.shiftRightUnsignedAssigment,">>>="),this.next(),this.next()):(this.pushToken(f.shiftRightUnsigned,">>>"),this.next())}lexShiftLeft(){this.next(),this.nextChar=="="?(this.pushToken(f.shiftLeftAssigment,"<<="),this.next(),this.next()):(this.pushToken(f.shiftLeft,"<<"),this.next())}pushToken(e,t,i=this.line,n=this.column,s=(""+t).length){let a={tt:e,value:t,position:{column:n,line:i,length:s}};this.spaceTokens.indexOf(e)>=0||(this.nonSpaceLastTokenType=e),this.tokenList.push(a)}pushError(e,t,i="error",n=this.line,s=this.column){this.errorList.push({text:e,position:{line:n,column:s,length:t},level:i})}isDigit(e,t){var i=e.charCodeAt(0);if(t==10)return i>=48&&i<=57;if(t==2)return i>=48&&i<=49;if(t==8)return i>=48&&i<=55;if(t==16)return i>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70}lexSpace(){let e=this.column,t=this.line,i=this.pos;for(;this.currentChar==" "||this.currentChar=="	";)this.next();let n=this.pos;this.pushToken(f.space,this.input.substring(i,n),t,e)}lexCharacterConstant(){let e=this.column,t=this.line;this.next();let i=this.currentChar;if(i=="\\"){let n=sh[this.nextChar];n==null?(this.pushError("Die Escape-Sequenz \\"+this.nextChar+" gibt es nicht.",2),this.nextChar!="'"&&(i=this.nextChar,this.next())):(i=n,this.next())}this.next(),this.currentChar!="'"?this.pushError("Das Ende der char-Konstante wird erwartet (').",1):this.next(),this.pushToken(f.charConstant,i,t,e)}lexStringConstant(){let e=this.line,t=this.column,i="";for(this.next();;){let s=this.currentChar;if(s=="\\"){s=this.parseStringLiteralEscapeCharacter(),i+=s;continue}else if(s=='"'){this.next();break}else if(s==`
`||s==Mn){this.pushError("Innerhalb einer String-Konstante wurde das Zeilenende erreicht.",i.length+1,"error",e,t);break}i+=s,this.next()}this.pushToken(f.stringConstant,i,e,t,i.length+2);let n=this.colorLexer.getColorInfo(i);n!=null&&this.colorInformation.push({color:n,range:{startLineNumber:e,endLineNumber:e,startColumn:t+1,endColumn:this.column-1}})}lexTripleQuoteStringConstant(){let e=this.line,t=this.column,i=[];this.next(),this.next(),this.next();let n="";for(;[`
`,"\r"].indexOf(this.currentChar)<0&&this.currentChar!=Mn;)n+=this.currentChar,this.next();n=n.trim(),n.length>0&&!n.startsWith("//")&&!n.startsWith("/*")&&this.pushError('Eine Java-Multiline-Stringkonstante beginnt immer mit """ und einem nachfolgenden Zeilenumbruch. Alle nach """ folgenden Zeichen werden überlesen!',n.length+3),this.currentChar=="\r"&&this.next(),this.currentChar==`
`&&(this.next(),this.line++,this.column=1);let s="";for(;;){let u=this.currentChar;if(u=="\\")s+=this.parseStringLiteralEscapeCharacter();else if(u=='"'&&this.nextChar=='"'&&this.pos+2<this.input.length&&this.input[this.pos+2]=='"'){this.next(),this.next(),this.next(),i.push(s);break}else if(u==Mn){let h=0;for(let d of i)h+=d.length;this.pushError("Innerhalb einer String-Konstante wurde das Textende erreicht.",h,"error",e,t),i.push(s);break}else if(u=="\r")this.next();else if(u==`
`){i.push(s),s="",this.line++,this.column=1,this.next();continue}else s+=u;this.next()}if(i.length==0)return;let a=i.pop(),l=0;for(;a.length>l&&a.charAt(l)==" ";)l++;let o="";o=i.map(u=>u.substring(l)).join(`
`),this.pushToken(f.stringConstant,o,this.line,this.column,o.length+2)}parseStringLiteralEscapeCharacter(){if(this.next(),this.currentChar=="u"){let e="";for(this.next();"abcdef0123456789".indexOf(this.currentChar)>=0&&e.length<4;)e+=this.currentChar,this.next();return e.length<4?(this.pushError("Die Escape-Sequenz \\u"+e+" gibt es nicht.",1+e.length),""):String.fromCodePoint(parseInt(e,16))}else if(sh[this.currentChar]!=null){let e=sh[this.currentChar];return this.next(),e}else return this.pushError("Die Escape-Sequenz \\"+this.currentChar+" gibt es nicht.",2),this.next(),""}lexMultilineComment(){let e=this.line,t=this.column,i=!1,n="/*";for(this.next(),this.next();;){let s=this.currentChar;if(s=="*"&&this.nextChar=="/"){this.next(),this.next(),n+="*/";break}if(s==Mn){this.pushError("Innerhalb eines Mehrzeilenkommentars (/*... */) wurde das Dateiende erreicht.",1);break}s==`
`?(this.line++,this.column=0,i=!0,n+=s):i&&s==" "||(n+=s,i=!1),this.next()}this.pushToken(f.comment,n,e,t)}lexEndofLineComment(){let e=this.line,t=this.column,i="//";for(this.next(),this.next();;){let n=this.currentChar;if(n==`
`||n==Mn)break;i+=n,this.next()}this.pushToken(f.comment,i,e,t)}lexNumber(){let e=this.line,t=this.column,i=1;this.currentChar=="-"?(i=-1,this.next()):this.currentChar=="+"&&this.next();let n=this.pos,s=this.currentChar;this.next();let a=10;for(s=="0"&&["b","x","0","1","2","3","4","5","6","7"].indexOf(this.currentChar)>=0&&(this.currentChar=="x"?(a=16,this.next()):this.currentChar=="b"?(a=2,this.next()):a=8,n=this.pos);this.isDigit(this.currentChar,a);)this.next();let l=f.integerConstant,o=0,u="";if(this.currentChar=="L")u=this.input.substring(n,this.pos),l=f.longConstant,this.next();else{if(this.currentChar=="."){for(l=f.floatingPointConstant,this.next();this.isDigit(this.currentChar,10);)this.next();a!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-n,"error",this.line,this.column-(this.pos-n))}if(u=this.input.substring(n,this.pos),n=this.pos,this.currentChar=="e"){this.next();let d=this.pos;for(this.currentChar=="-"&&this.next();this.isDigit(this.currentChar,10);)this.next();a!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-n,"error",this.line,this.column-(this.pos-n));let p=this.input.substring(d,this.pos);o=Number.parseInt(p)}(this.currentChar=="d"||this.currentChar=="f")&&(l=f.floatingPointConstant,this.next(),a!=10&&this.pushError("Eine float/double-Konstante darf nicht mit 0, 0b oder 0x beginnen.",this.pos-n,"error",this.line,this.column-(this.pos-n)))}let h=l==f.integerConstant?Number.parseInt(u,a):Number.parseFloat(u);h*=i,o!=0&&(h*=Math.pow(10,o)),this.pushToken(l,h,e,t),a==16&&this.column-t==8&&this.colorInformation.push({color:{red:(h>>16)/255,green:(h>>8&255)/255,blue:(h&255)/255,alpha:1},range:{startLineNumber:e,endLineNumber:e,startColumn:t,endColumn:this.column}})}lexAnnotation(){let e=this.line,t=this.column-1,i=this.pos;this.next();let n=this.currentChar;for(;rh[n]==null&&!this.isSpace(n)&&n!=Mn;)this.next(),n=this.currentChar;let s=this.pos,a=this.input.substring(i,s);this.pushToken(f.at,a,e,t,a.length+1)}lexIdentifierOrKeyword(){let e=this.line,t=this.column,i=this.pos,n=this.currentChar;for(;rh[n]==null&&!this.isSpace(n)&&n!=Mn;)this.next(),n=this.currentChar;let s=this.pos,a=this.input.substring(i,s),l=Pv[a];if(l!=null&&typeof l=="number"){switch(l){case f.true:this.pushToken(f.booleanConstant,!0,e,t);break;case f.false:this.pushToken(f.booleanConstant,!1,e,t);break;case f.keywordPrint:case f.keywordPrintln:this.nonSpaceLastTokenType==f.dot?this.pushToken(f.identifier,a,e,t):this.pushToken(l,a,e,t);break;default:this.pushToken(l,a,e,t);break}return}a=="Color"&&this.colorIndices.push(this.tokenList.length),this.pushToken(f.identifier,a,e,t)}isSpace(e){return e==" "||e==`
`}}class pc{constructor(){y(this,"autoFormatTriggerCharacters",[`
`]);y(this,"displayName","Java-Autoformat")}init(){monaco.languages.registerDocumentFormattingEditProvider("myJava",this),monaco.languages.registerOnTypeFormattingEditProvider("myJava",this)}provideOnTypeFormattingEdits(e,t,i,n,s){let a=this.format(e);return Promise.resolve(a)}deleteOverlappingRanges(e){for(let t=0;t<e.length-1;t++){let i=e[t],n=e[t+1];if(!(i.range.endLineNumber<n.range.startLineNumber)&&i.range.endLineNumber==n.range.startLineNumber){if(i.range.endColumn>=n.range.startColumn)e.splice(t+1,1);else if(i.range.endColumn==0&&i.text.length>0&&n.range.startColumn==1&&n.range.endColumn>n.range.startColumn&&n.text==""){let s=i.text.length-(n.range.endColumn-n.range.startColumn);s>0?(i.text=i.text.substr(0,s),e.splice(t+1,1)):s<0?(n.range.endColumn=n.range.startColumn-s,e.splice(t,1),t--):(e.splice(t,2),t--)}}}}provideDocumentFormattingEdits(e,t,i){let n=this.format(e);return Promise.resolve(n)}format(e){let t=[],i=e.getValue(monaco.editor.EndOfLinePreference.LF),n=new fc().lex(i).tokens;if(n==null)return[];let s=null,a=0,l=3,o=[],u=[],h=!1,d=0,p=0;for(let v=0;v<n.length;v++){let w=n[v];switch(d--,w.tt){case f.keywordSwitch:h=!0;break;case f.keywordCase:case f.keywordDefault:w.position.column>3&&this.deleteSpaces(t,w.position.line,1,3);break;case f.leftCurlyBracket:if(h&&(h=!1,u.push(a+2),a++),a++,o.push(w.position.line),s!=null){let T=s.tt;(T==f.rightBracket||T==f.identifier||T==f.leftRightSquareBracket)&&s.position.line==w.position.line&&this.replaceBetween(s,w,t," ")}if(v<n.length-1){let T=n[v+1];T.tt!=f.newline&&T.tt!=f.space&&this.insertSpaces(t,T.position.line,T.position.column,1)}break;case f.rightCurlyBracket:u[u.length-1]==a&&(u.pop(),a--,this.deleteSpaces(t,w.position.line,1,3)),a--;let _=o.pop();if(_!=null&&_!=w.position.line)s!=null&&s.position.line==w.position.line&&this.replace(t,w.position,w.position,`
`+" ".repeat(a*l));else if(v>0){let T=n[v-1];T.tt!=f.space&&T.tt!=f.newline&&this.insertSpaces(t,w.position.line,w.position.column,1)}break;case f.leftBracket:if(p++,v<n.length-2){let T=n[v+1],D=n[v+2];T.tt==f.space&&D.tt!=f.newline&&(this.deleteSpaces(t,T.position.line,T.position.column,T.position.length),v++,D.tt==f.rightBracket&&(v++,p--))}if(v>1){let T=n[v-1],D=n[v-2];T.tt==f.space&&[f.newline,f.keywordFor,f.keywordWhile].indexOf(D.tt)<0&&!this.isBinaryOperator(D.tt)&&T.position.length==1&&this.deleteSpaces(t,T.position.line,T.position.column,1)}break;case f.rightBracket:if(p--,v>1){let T=n[v-1],D=n[v-2];T.tt==f.space&&D.tt!=f.newline&&this.deleteSpaces(t,T.position.line,T.position.column,T.position.length)}break;case f.newline:if(d=2,v<n.length-2){let T=this.getNextNonSpaceToken(v,n),D=this.isBinaryOperator(s==null?void 0:s.tt)&&(s==null?void 0:s.tt)!=f.colon,L=this.isBinaryOperator(T.tt),O=n[v+1],z=n[v+2],V=0;if(O.tt==f.newline||T.tt==f.comment)break;let Q=0;if(O.tt==f.space){if(z.tt==f.newline)break;V=O.position.length,v++,z.tt==f.rightCurlyBracket&&(Q=-1)}O.tt==f.rightCurlyBracket&&(Q=-1),(L||D)&&(Q=1);let S=a+Q;p>0&&S++,S<0&&(S=0);let Z=S*l;Z>V?this.insertSpaces(t,w.position.line+1,0,Z-V):Z<V&&this.deleteSpaces(t,w.position.line+1,0,V-Z)}break;case f.space:v<n.length-1&&n[v+1].tt!=f.comment&&v>0&&n[v-1].tt!=f.newline&&w.position.length>1&&this.deleteSpaces(t,w.position.line,w.position.column,w.position.length-1);break;case f.keywordFor:case f.keywordWhile:if(v<n.length-1){let T=n[v+1];T.tt==f.leftBracket&&this.insertSpaces(t,T.position.line,T.position.column,1)}break;case f.comma:case f.semicolon:if(v>1){let T=n[v-1],D=n[v-2];T.tt!=f.newline&&D.tt!=f.newline&&!this.isBinaryOperator(D.tt)&&T.tt==f.space&&T.position.length==1&&this.deleteSpaces(t,T.position.line,T.position.column,1)}if(v<n.length-1){let T=n[v+1];T.tt!=f.comment&&T.tt!=f.space&&T.tt!=f.newline&&this.insertSpaces(t,T.position.line,T.position.column,1)}break;case f.rightSquareBracket:s!=null&&s.tt==f.leftSquareBracket&&this.replaceBetween(s,w,t,"");break}if(this.isBinaryOperator(w.tt)){let _=w.tt==f.lower&&this.lowerBelongsToGenericExpression(v,n),T=w.tt==f.greater&&this.greaterBelongsToGenericExpression(v,n);if(d<=0&&s!=null&&[f.leftBracket,f.assignment,f.comma].indexOf(s.tt)<0){if(v>0){let D=n[v-1],L=_||T?0:1;D.tt==f.space?D.position.length!=L&&this.insertSpaces(t,D.position.line,D.position.column,L-D.position.length):L==1&&this.insertSpaces(t,w.position.line,w.position.column,1)}if(v<n.length-1){let D=n[v+1],L=_?0:1;D.tt==f.space?(T&&v<n.length-2&&n[v+2].tt==f.leftBracket&&(L=0),D.position.length!=L&&this.insertSpaces(t,D.position.line,D.position.column,L-D.position.length)):(T&&D.tt==f.leftBracket&&(L=0),L==1&&this.insertSpaces(t,D.position.line,D.position.column,1))}}}w.tt!=f.space&&w.tt!=f.newline&&(s=w)}return this.deleteOverlappingRanges(t),t}getNextNonSpaceToken(e,t){if(e==t.length-1)return t[e];let i=e+1;for(;i<t.length-1&&(t[i].tt==f.space||t[i].tt==f.return);)i++;return t[i]}lowerBelongsToGenericExpression(e,t){let i=e+1;for(;i<t.length;){let n=t[i].tt;if(n==f.greater)return!0;if([f.space,f.comma,f.identifier].indexOf(n)<0)return!1;i++}return!1}greaterBelongsToGenericExpression(e,t){let i=e-1;for(;i>=0;){let n=t[i].tt;if(n==f.lower)return!0;if([f.space,f.comma,f.identifier].indexOf(n)<0)return!1;i--}return!1}isBinaryOperator(e){return e!=null&&e>=f.modulo&&e<=f.colon}replaceBetween(e,t,i,n){let s={line:e.position.line,column:e.position.column+e.position.length},a={line:t.position.line,column:t.position.column};(s.line!=a.line||a.column-s.column!=n.length)&&this.replace(i,s,a,n)}deleteSpaces(e,t,i,n){e.push({range:{startColumn:i,startLineNumber:t,endColumn:i+n+(i==0?1:0),endLineNumber:t},text:""})}insertSpaces(e,t,i,n){if(n<0){this.deleteSpaces(e,t,i,-n);return}e.push({range:{startColumn:i,startLineNumber:t,endColumn:i,endLineNumber:t},text:" ".repeat(n)})}replace(e,t,i,n){e.push({range:{startColumn:t.column,startLineNumber:t.line,endColumn:i.column,endLineNumber:i.line},text:n})}}class lm{constructor(){y(this,"themes",[]);this.initThemes()}switchTheme(e){for(let t of this.themes)if(t.name==e){this.internalSwitchTheme(t);break}}internalSwitchTheme(e){monaco.editor.setTheme(e.monacoTheme);let t=document.documentElement;for(const i of Object.keys(e.cssColors)){const n=e.cssColors[i];t.style.setProperty(i,n)}}initThemes(){this.themes.push({name:"dark",monacoTheme:"myCustomThemeDark",cssColors:{"--backgroundDark":"#1e1e1e","--backgroundLight":"#252526","--backgroundHeading":"#37373d","--backgroundSelected":"#2a2d2e","--fontColorNormal":"#c2cccc","--fontColorLight":"#e7e7e7","--slider":"#414141","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#1e1e1e","--scrollbar-thumb":"#3e3e3e","--scrollbar-thumb-hover":"#5e5e5e","--scrollbar-thumb-active":"#7e7e7e","--submenu-hover":"#094771","--submenu-color":"#ffffff","--menuitemsdivider":"#616162","--file-hover":"hsla(0, 0%, 38%, 0.125)","--file-active":"#094771","--file-active-hover":"rgba(9, 71, 113, 0.827)","--file-errorcount":"red","--inplace-editor":"blue","--contextmenu-background":"#3c3c3c","--contextmenu-color":"rgb(212,212,212)","--contextmenu-hover-background":"#094771","--contextmenu-hover-color":"#ffffff","--error-filename":"#2a709e","--error-line-ative":"#094771","--error-line-hover":"rgba(96, 96, 96, 0.125)","--error-position":"#c0802d","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#2b2b7d2f","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"rgb(85,85,85)","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#383838","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#252526","--editorTooltip-border":"#454545","--renameInput-color":"#ffffff","--bottomdiv-tabheading-hover":"white","--bottomdiv-tabheading-active":"rgb(97,97,255)","--noErrorMessage":"rgb(37, 211, 37)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"#1e1e1e","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"white","--consoleEntryIdentifier":"rgb(156, 156, 235)","--consoleEntryNoValue":"gray","--consoleEntryCaption":"white","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 51, 51)","--deIdentifier":"rgb(156, 156, 235)","--deValue":"white","--helper-background-color":"#383838","--helper-border-color":"#d4d4d4","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#ffffff","--runInputColor":"#ffffff","--runBackgroundColor":"rgba(255, 255, 255, 0.2)"}});let e="#8080ff";this.themes.push({name:"light",monacoTheme:"myCustomThemeLight",cssColors:{"--backgroundDark":"white","--backgroundLight":"#f3f3f3","--backgroundHeading":"#dcdcdc","--backgroundSelected":"#e8e8e8","--fontColorNormal":"#000","--fontColorLight":"#303030","--slider":"#b0b0b0","--loginButtonBackgrond":"#59a15d","--loginButtonFontColor":"#000000","--loginMessageColor":"rgb(122, 48, 48)","--loginButtonHover":"#63a867","--loginButtonActive":"#94ffd1","--scrollbar":"#e3e3e3","--scrollbar-thumb":"#bababa","--scrollbar-thumb-hover":"#8e8e8e","--scrollbar-thumb-active":"#616161","--submenu-hover":e,"--submenu-color":"#ffffff","--menuitemsdivider":"#cfcfcf","--file-hover":"#e8e8e8","--file-active":e,"--file-active-hover":"#a0a0ff","--file-errorcount":"red","--inplace-editor":"white","--contextmenu-background":"white","--contextmenu-color":"#756161","--contextmenu-hover-background":e,"--contextmenu-hover-color":"#a0a0ff","--error-filename":"#ff0000","--error-line-ative":"#ffa0a0","--error-line-hover":"#ffc0c0","--error-position":"#804040","--linecolumn":"#14c714","--reveal-error":"rgba(253, 101, 101, 0.745)","--reveal-method":"#babaec80","--reveal-errorline-background":"red","--reveal-error-whole-line":"rgba(255, 0, 0, 0.555)","--reveal-programpointer":"rgba(111, 214, 27, 0.337)","--reveal-syntaxelement":"#c0c0c0","--margin-breakpoint":"rgba(255, 0, 0, 0.623)","--speedcontrol-bar":"#9d9d9d","--speedcontrol-grip":"#588555","--speedcontrol-grip-hover":"#89d185","--speedcontrol-display-background":"#e0e0e0","--speedcontrol-display-border":"#9d9d9d","--editorTooltip-background":"#e0e0e0","--editorTooltip-border":"#9d9d9d","--renameInput-color":"#000000","--bottomdiv-tabheading-hover":"#424242","--bottomdiv-tabheading-active":"#424242","--noErrorMessage":"rgb(17, 180, 17)","--console-top-borderbottom":"#c4c4c4","--console-top-background":"white","--consoleEntry-withBorder":"#303030","--consoleEntryValue":"#0000a0","--consoleEntryIdentifier":"black","--consoleEntryNoValue":"gray","--consoleEntryCaption":"#756161","--error-Caption":"rgb(166, 165, 176)","--console-error":"rgb(155, 21, 21)","--deIdentifier":"black","--deValue":"#0000a0","--helper-background-color":"#f3f3f3","--helper-border-color":"#606060","--arrowBoxButtonOuter-background":"#59a15d","--arrowBoxButtonOuter-border":"#3d3d3d","--arrowBoxButtonOuter-color":"black","--arrowBoxButtonOuter-button-hover":"#63a867","--arrowBox-after":"rgba(136, 183, 213, 0)","--arrowBox-before":"rgba(194, 225, 245, 0)","--defaultOutputColor":"#303030","--runInputColor":"#000000","--runBackgroundColor":"rgba(0, 0, 0, 0.2)"}})}}const Na=class Na{constructor(e,t,i){y(this,"id",Na.maxId++);y(this,"parent");y(this,"positionFrom");y(this,"positionTo");y(this,"beginsNewStackframe",!1);y(this,"stackframeSize");y(this,"childSymbolTables",[]);y(this,"variableMap",new Map);y(this,"classContext",null);y(this,"method",null);this.parent=e,this.positionFrom=t,this.positionTo=i,this.classContext=e==null?null:e.classContext,this.parent!=null&&(this.parent.childSymbolTables.push(this),this.method=this.parent.method)}getImitation(){let e=new Na(null,{line:1,column:1,length:0},{line:1,column:1e4,length:0});e.beginsNewStackframe=!0;let t=this,i=-1;for(;t!=null;)t.classContext!=null&&(e.classContext=t.classContext),t.variableMap.forEach((n,s)=>{e.variableMap.get(s)==null&&e.variableMap.set(s,n),n.stackPos>i&&(i=n.stackPos)}),t=t.parent;return e.stackframeSize=i+1,e}getLocalVariableCompletionItems(e){let t=[];return this.variableMap.forEach((i,n)=>{n!=0&&(i!=null&&i.type!=null&&i.type instanceof ze&&t.push({label:n+"[]",insertText:n+"[$0]",documentation:"Element des Arrays",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:e}),t.push({label:n,insertText:n,kind:monaco.languages.CompletionItemKind.Variable,range:e}))}),this.parent!=null&&this.parent.classContext==this.classContext&&(t=t.concat(this.parent.getLocalVariableCompletionItems(e))),t}findTableAtPosition(e,t){if(!this.containsPosition(e,t))return null;let i=null,n=1e7;for(let s of this.childSymbolTables)if(s.containsPosition(e,t)){let a=s.findTableAtPosition(e,t);a.positionTo.line-a.positionFrom.line<n&&(i=a,n=a.positionTo.line-a.positionFrom.line)}return i??this}containsPosition(e,t){return e<this.positionFrom.line||e>this.positionTo.line?!1:e==this.positionFrom.line?t>=this.positionFrom.column:e==this.positionTo.line?t<=this.positionTo.column:!0}};y(Na,"maxId",0);let qa=Na;class om extends he{constructor(t,i){super(t);y(this,"enumValue");this.enumValue=i}}class $t extends ${constructor(t,i,n){super(t,i);y(this,"enumInfoList",[]);y(this,"identifierToInfoMap",{});y(this,"indexToInfoMap",{});y(this,"valueList",null);this.baseClass=Wi,this.setEnumValues(n);let s=this;this.staticClass.addMethod(new m("getValues",new g([]),new ze(this),a=>{if(this.valueList==null){let l=[];for(let o of this.enumInfoList)l.push({type:s,value:o.object});this.valueList={type:new ze(s),value:l}}return this.valueList.value},!1,!0)),this.addMethod(new m("toString",new g([]),F,a=>a[0].value.enumValue.identifier,!1,!1)),this.addMethod(new m("toOrdinal",new g([]),C,a=>a[0].value.enumValue.ordinal,!1,!1))}getOrdinal(t){let i=this.identifierToInfoMap[t];return i==null?-1:i.ordinal}debugOutput(t,i=40){let n=t.value;return this.identifier+"."+n.enumValue.identifier}setEnumValues(t){this.enumInfoList=[],this.identifierToInfoMap={},this.indexToInfoMap={},this.valueList=null,this.staticClass.attributes=this.staticClass.attributes.filter(n=>n.annotation!="@enumvalue"),this.staticClass.attributeMap=new Map,this.staticClass.attributes.forEach(n=>this.attributeMap.set(n.identifier,n));let i=0;for(let n of t){let s=new ce(n.identifier,this,null,!0,ee.public,!0);s.annotation="@enumvalue",n.position!=null&&(s.declaration={module:this.module,position:n.position},s.usagePositions.set(this.module,[n.position])),this.staticClass.addAttribute(s);let a={identifier:n.identifier,ordinal:i++};this.enumInfoList.push(a),this.identifierToInfoMap[n.identifier]=a,this.indexToInfoMap[a.ordinal]=a}if(this.module.isSystemModule){this.valueList={type:new ze(this),value:[]};for(let n of this.enumInfoList)n.object=new om(this,n),this.valueList.value.push({type:this,value:n.object})}}canCastTo(t){return t==C?!0:super.canCastTo(t)}castTo(t,i){if(i==C){let n=t.value;return{type:C,value:n.enumValue.ordinal}}return super.castTo(t,i)}}const ou=class ou{constructor(){y(this,"moduleStore");y(this,"module");y(this,"symbolTableStack");y(this,"currentSymbolTable");y(this,"heap");y(this,"currentProgram");y(this,"errorList");y(this,"nextFreeRelativeStackPos");y(this,"breakNodeStack");y(this,"continueNodeStack");y(this,"isAdhocCompilation");y(this,"lastPosition");y(this,"lastStatement");y(this,"initStackFrameNodes",[])}startAdhocCompilation(e,t,i,n){this.isAdhocCompilation=!0,this.moduleStore=t,this.module=e,this.symbolTableStack=[],this.symbolTableStack.push(i),this.currentSymbolTable=i,this.heap=n;let s=i.stackframeSize;return this.nextFreeRelativeStackPos=s,this.currentProgram=null,this.errorList=[],this.breakNodeStack=[],this.continueNodeStack=[],this.generateMain(!0),this.errorList}start(e,t){if(this.isAdhocCompilation=!1,this.moduleStore=t,this.module=e,this.symbolTableStack=[],this.currentSymbolTable=null,this.currentProgram=null,this.errorList=[],this.nextFreeRelativeStackPos=0,this.module.tokenList.length>0){let i=this.module.tokenList[this.module.tokenList.length-1];this.module.mainSymbolTable.positionTo={line:i.position.line,column:i.position.column+1,length:1}}this.symbolTableStack.push(this.module.mainSymbolTable),this.currentSymbolTable=this.module.mainSymbolTable,this.breakNodeStack=[],this.continueNodeStack=[],this.generateMain(),this.generateClasses(),this.lookForStaticVoidMain(),this.module.errors[3]=this.errorList}lookForStaticVoidMain(){let e=this.module.mainProgram;if(e!=null&&e.statements.length>2)return;let t=null,i=null;for(let n of this.module.classDefinitionsAST)if(n.type==f.keywordClass){let s=n.resolvedType;for(let a of s.staticClass.methods)if(a.identifier=="main"&&a.parameterlist.parameters.length==1){let l=a.parameterlist.parameters[0];l.type instanceof ze&&l.type.arrayOfType==F&&(t!=null?this.pushError("Es existieren mehrere Klassen mit statischen main-Methoden.",n.position):(t=a,i=s.staticClass))}}if(t!=null){let n=t.usagePositions[0];t.program!=null&&t.program.statements.length>0&&(n=t.program.statements[0].position),this.initCurrentProgram(),this.module.mainProgram=this.currentProgram,this.pushStatements([{type:f.callMainMethod,position:n,stepFinished:!1,method:t,staticClass:i},{type:f.programEnd,stepFinished:!0,pauseAfterProgramEnd:!0,position:t.usagePositions.get(this.module)[0]}],!1)}}generateClasses(){if(this.module.classDefinitionsAST!=null){for(let e of this.module.classDefinitionsAST)if(e.type==f.keywordClass&&this.generateClass(e),e.type==f.keywordEnum&&this.generateEnum(e),e.type==f.keywordInterface){let t=e.resolvedType;t!=null&&this.checkDoubleMethodDeclaration(t)}}}generateEnum(e){if(e.resolvedType==null)return;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let t=e.resolvedType;this.currentSymbolTable.classContext=t,this.currentProgram=t.attributeInitializationProgram;for(let i of e.attributes)i!=null&&!i.isStatic&&i.initialization!=null&&this.initializeAttribute(i);t.attributeInitializationProgram.statements.length>0&&this.pushStatements({type:f.return,position:this.lastStatement.position,copyReturnValueToStackframePos0:!1,stepFinished:!1,leaveThisObjectOnStack:!0}),this.currentProgram.labelManager.resolveNodes();for(let i of e.methods)i!=null&&!i.isAbstract&&!i.isStatic&&this.compileMethod(i);this.popSymbolTable(null),this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);for(let i of e.values)if(i.constructorParameters!=null){let n={module:this.module,labelManager:null,statements:[]};this.currentProgram=n,this.pushStatements({type:f.pushEnumValue,position:i.position,enumClass:t,valueIdentifier:i.identifier}),this.processEnumConstructorCall(t,i.constructorParameters,i.position,i.commaPositions,i.rightBracketPosition),this.pushStatements({type:f.programEnd,position:i.position,stepFinished:!0});let s=t.identifierToInfoMap[i.identifier];s.constructorCallProgram=n,s.position=i.position}this.popSymbolTable(null),this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo),this.currentSymbolTable.classContext=t.staticClass,this.currentProgram=t.staticClass.attributeInitializationProgram;for(let i of e.attributes)i!=null&&i.isStatic&&i.initialization!=null&&this.initializeAttribute(i);this.currentProgram.labelManager.resolveNodes();for(let i of e.methods)i!=null&&i.isStatic&&this.compileMethod(i);this.checkDoubleMethodDeclaration(t),this.popSymbolTable(null)}processEnumConstructorCall(e,t,i,n,s){let a=[];for(let d of t){let p=this.processNode(d);p!=null&&a.push(p.type)}let l=e.getMethodsThatFitWithCasting(e.identifier,a,!0,ee.private);if(this.module.pushMethodCallPosition(i,n,e.getMethods(ee.private,e.identifier),s),l.error!=null)return this.pushError(l.error,i),{type:F,isAssignable:!1};let o=l.methodList[0],u=null;for(let d=0;d<a.length;d++){d<o.getParameterCount()&&(u=o.getParameterType(d),d==o.getParameterCount()-1&&o.hasEllipsis()&&(u=u.arrayOfType));let p=a[d];p.equals(u)||p instanceof ut&&u instanceof ut&&p.getCastInformation(u).needsStatement&&this.pushStatements({type:f.castValue,position:null,newType:u,stackPosRelative:-a.length+1+d})}let h=0;if(o.hasEllipsis()){let d=a.length-o.getParameterCount()+1;h=-(d-1),this.pushStatements({type:f.makeEllipsisArray,position:t[o.getParameterCount()-1].position,parameterCount:d,stepFinished:!1,arrayType:o.getParameter(o.getParameterCount()-1).type})}this.pushStatements({type:f.callMethod,method:o,position:i,stepFinished:!0,isSuperCall:!1,stackframeBegin:-(a.length+1+h)})}generateClass(e){if(e.resolvedType==null)return;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let t=e.resolvedType,i=t.checkInheritance();i.message!=""&&this.pushError(i.message,e.position,"error",this.getInheritanceQuickFix(e.scopeTo,i));let n=t.baseClass;n!=null&&(n.module!=t.module&&n.visibility==ee.private&&this.pushError("Die Basisklasse "+n.identifier+" der Klasse "+t.identifier+" ist hier nicht sichtbar.",e.position),n.isFinal&&this.pushError("Die Basisklasse "+n.identifier+" der Klasse "+t.identifier+" ist final, daher kann sie keine Unterklasse haben.",e.position)),this.currentSymbolTable.classContext=t,this.currentProgram=t.attributeInitializationProgram;for(let s of e.attributes)s!=null&&!s.isStatic&&s.initialization!=null&&this.initializeAttribute(s);t.attributeInitializationProgram.statements.length>0&&this.pushStatements({type:f.return,position:this.lastStatement.position,copyReturnValueToStackframePos0:!1,stepFinished:!1,leaveThisObjectOnStack:!0}),this.currentProgram.labelManager.resolveNodes();for(let s of e.methods)if(s!=null&&!s.isAbstract&&!s.isStatic){this.compileMethod(s);let a=s.resolvedType;a!=null&&(a.annotation=="@Override"&&t.baseClass!=null&&t.baseClass.getMethodBySignature(a.signature)==null&&this.pushError("Die Methode "+a.signature+" ist mit @Override annotiert, überschreibt aber keine Methode gleicher Signatur einer Oberklasse.",s.position,"warning"),a.identifier==e.identifier&&!a.isConstructor&&this.pushError("Die Methode "+a.signature+" trägt den Bezeichner der Klasse, ist aber kein Konstruktor. Das ist ungünstig.",s.position,"warning"))}this.checkDoubleMethodDeclaration(t),this.popSymbolTable(null),this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo),this.currentSymbolTable.classContext=t.staticClass,this.currentProgram=t.staticClass.attributeInitializationProgram;for(let s of e.attributes)s!=null&&s.isStatic&&s.initialization!=null&&this.initializeAttribute(s);t.staticClass.attributeInitializationProgram.statements.length>0&&this.pushStatements({type:f.return,position:this.lastStatement.position,copyReturnValueToStackframePos0:!1,stepFinished:!1,leaveThisObjectOnStack:!0}),this.currentProgram.labelManager.resolveNodes();for(let s of e.methods)s!=null&&s.isStatic&&this.compileMethod(s);this.popSymbolTable(null)}checkDoubleMethodDeclaration(e){let t={};for(let i of e.methods){let n=i.getSignatureWithReturnParameter();if(t[n]!=null){let s="In der Klasse ";e instanceof Pe&&(s="Im Interface "),e instanceof $t&&(s="Im Enum "),this.pushError(s+e.identifier+" gibt es zwei Methoden mit derselben Signatur: "+n,i.usagePositions.get(this.module)[0],"error"),this.pushError(s+e.identifier+" gibt es zwei Methoden mit derselben Signatur: "+n,t[n].usagePositions.get(this.module)[0],"error")}else t[n]=i}}getInheritanceQuickFix(e,t){let i="";for(let n of t.missingMethods)i+="	public "+(n.returnType==null?" void":Ns(n.returnType))+" "+n.identifier+"(",i+=n.parameterlist.parameters.map(s=>Ns(s.type)+" "+s.identifier).join(", "),i+=`) {
		//TODO: Methode füllen
	}

`;return{title:"Fehlende Methoden einfügen",editsProvider:n=>[{resource:n,edit:{range:{startLineNumber:e.line,startColumn:e.column-1,endLineNumber:e.line,endColumn:e.column-1},text:i}}]}}getSuperconstructorCalls(e,t,i){for(let n of e)n!=null&&(n.type==f.superConstructorCall||n.type==f.constructorCall?(i||(t.length>0?this.pushError("Ein Konstruktor darf nur einen einzigen Aufruf des Superkonstruktors oder eines anderen Konstruktors enthalten.",n.position,"error"):this.pushError("Vor dem Aufruf des Superkonstruktors oder eines anderen Konstruktors darf keine andere Anweisung stehen.",n.position,"error")),t.push(n),i=!1):n.type==f.scopeNode&&n.statements!=null?i=i&&this.getSuperconstructorCalls(n.statements,t,i):i=!1);return i}compileMethod(e){var o,u,h;let t=e.resolvedType,i=this.currentSymbolTable.classContext;if(i!=null&&t!=null&&(this.checkIfMethodIsVirtual(t,i),this.checkIfMethodOverridesFinalMethod(t,i,e.position)),t==null)return;this.initCurrentProgram(),t.program=this.currentProgram,this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo),this.currentSymbolTable.method=t;let n=1;for(let d of t.getParameterList().parameters)d.stackPos=n++,this.currentSymbolTable.variableMap.set(d.identifier,d);if(this.nextFreeRelativeStackPos=e.parameters.length+1,t.isConstructor&&this.currentSymbolTable.classContext instanceof $&&e.statements!=null){let d=this.currentSymbolTable.classContext,p=[];this.getSuperconstructorCalls(e.statements,p,!0);let v=p.length>0;if(d!=null&&((o=d.baseClass)!=null&&o.hasConstructor())&&!((u=d.baseClass)!=null&&u.hasParameterlessConstructor())){let w=!1;if((e.statements==null||e.statements.length==0)&&(w=!0),w||(w=!v),w){let _=null,T=d.baseClass.methods.filter(D=>D.isConstructor);if(T.length==1){let D="super("+T[0].parameterlist.parameters.map(O=>O.identifier).join(", ")+");",L=e.position;_={title:"Aufruf des Konstruktors der Basisklasse einfügen",editsProvider:O=>[{resource:O,edit:{range:{startLineNumber:L.line+1,startColumn:0,endLineNumber:L.line+1,endColumn:0,message:"",severity:monaco.MarkerSeverity.Error},text:"		"+D+`
`}}]}}this.pushError("Die Basisklasse der Klasse "+d.identifier+" besitzt keinen parameterlosen Konstruktor, daher muss diese Konstruktordefinition mit einem Aufruf eines Konstruktors der Basisklasse (super(...)) beginnen.",e.position,"error",_)}}else if(!v&&((h=d.baseClass)!=null&&h.hasParameterlessConstructor())){let w=d.baseClass.getParameterlessConstructor();this.pushStatements([{type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:0},{type:f.callMethod,method:w,isSuperCall:!0,position:e.position,stackframeBegin:-1}])}}let s=this.moduleStore.getType("Actor").type;if(["act","onKeyTyped","onKeyDown","onKeyUp","onMouseDown","onMouseUp","onMouseMove","onMouseEnter","onMouseLeave"].indexOf(t.identifier)>=0&&this.currentSymbolTable.classContext.hasAncestorOrIs(s)&&this.pushStatements([{type:f.returnIfDestroyed,position:e.position}]),!this.generateStatements(e.statements).withReturnStatement){this.pushStatements({type:f.return,position:e.scopeTo,copyReturnValueToStackframePos0:!1,stepFinished:!0,leaveThisObjectOnStack:!1});let d=t.getReturnType();!t.isConstructor&&d!=null&&d!=U&&this.pushError("Die Deklaration der Methode verlangt die Rückgabe eines Wertes vom Typ "+d.identifier+". Es fehlt (mindestens) eine entsprechende return-Anweisung.",e.position)}t.reserveStackForLocalVariables=this.nextFreeRelativeStackPos-e.parameters.length-1,this.popSymbolTable(),this.currentProgram.labelManager.resolveNodes()}checkIfMethodIsVirtual(e,t){for(let i of this.moduleStore.getJavaModules(!1))for(let n of i.typeStore.typeList)if(n instanceof $&&n!=t&&n.hasAncestorOrIs(t)){for(let s of n.methods)if(s!=null&&e!=null&&s.signature==e.signature){e.isVirtual=!0;return}}}checkIfMethodOverridesFinalMethod(e,t,i){if(t instanceof Vt)return;let n=t.baseClass;for(;n!=null;){for(let s of n.methods)s.identifier==e.identifier&&(s.isFinal||s.visibility==ee.private)&&s.signature==e.signature&&this.pushError("Die Methode "+e.identifier+" überschreibt die gleichnamige private oder finale Methode der Oberklasse "+n.identifier,i);n=n.baseClass}}initializeAttribute(e){if(e==null||e.identifier==null||e.initialization==null||e.resolvedType==null)return;e.isStatic?this.pushStatements({type:f.pushStaticAttribute,attributeIndex:e.resolvedType.index,attributeIdentifier:e.resolvedType.identifier,position:e.initialization.position,klass:this.currentSymbolTable.classContext}):this.pushStatements({type:f.pushAttribute,attributeIndex:e.resolvedType.index,attributeIdentifier:e.identifier,position:e.initialization.position,useThisObject:!0});let t=this.processNode(e.initialization);t!=null&&t.type!=null&&(this.ensureAutomaticCasting(t.type,e.attributeType.resolvedType)||(e.attributeType.resolvedType==null?this.pushError("Der Datentyp von "+e.identifier+" konnte nicht ermittelt werden. ",e.position):this.pushError("Der Wert des Term vom Datentyp "+t.type+" kann dem Attribut "+e.identifier+" vom Typ "+e.attributeType.resolvedType.identifier+" nicht zugewiesen werden.",e.initialization.position)),this.pushStatements({type:f.assignment,position:e.initialization.position,stepFinished:!1,leaveValueOnStack:!1}))}initCurrentProgram(){this.currentProgram={module:this.module,statements:[],labelManager:null},this.currentProgram.labelManager=new sc(this.currentProgram),this.lastStatement=null}generateMain(e=!1){this.initCurrentProgram();let t={line:1,column:1,length:0},i=this.module.mainProgramAst;i!=null&&i.length>0&&i[0]!=null&&(t=this.module.mainProgramAst[0].position),e||(this.pushNewSymbolTable(!0,t,{line:1e5,column:1,length:0},this.currentProgram),this.heap={}),this.module.mainProgram=this.currentProgram;let n=!1;this.module.mainProgramAst!=null&&this.module.mainProgramAst.length>0&&(n=!0,this.generateStatements(this.module.mainProgramAst),e&&this.lastStatement!=null&&this.lastStatement.type==f.decreaseStackpointer&&this.removeLastStatement(),this.lastPosition=this.module.mainProgramEnd,this.lastPosition==null&&(this.lastPosition={line:1e5,column:0,length:0}),this.currentSymbolTable.positionTo=this.lastPosition,e||this.popSymbolTable(this.currentProgram,!0),this.heap=null,this.pushStatements({type:f.programEnd,position:this.lastPosition,stepFinished:!0,pauseAfterProgramEnd:!0},!0)),this.currentProgram.labelManager.resolveNodes(),!e&&!n&&(this.popSymbolTable(this.currentProgram),this.heap=null)}ensureAutomaticCasting(e,t,i,n,s=0){if(e==null||t==null)return!1;if(e.equals(t))return!0;if(!e.canCastTo(t))return t==P&&n!=null&&this.checkIfAssignmentInstedOfEqual(n),!1;if(e.unboxableAs!=null&&e.unboxableAs.indexOf(t)>=0)return!0;if(e instanceof $&&t==F){let a=this.getToStringStatement(e,i);return a!=null?(this.pushStatements(a),!0):!1}if(e instanceof ut&&(t instanceof ut||t==F)){let a=e.getCastInformation(t);if(!a.automatic)return!1;a.needsStatement&&this.pushStatements({type:f.castValue,newType:t,position:i,stackPosRelative:s})}return!0}getToStringStatement(e,t){let i=e.getMethodBySignature("toString()");return i!=null&&i.getReturnType()==F?{type:f.callMethod,position:t,method:i,isSuperCall:!1,stackframeBegin:-1,stepFinished:!1}:null}checkIfAssignmentInstedOfEqual(e,t){if(e!=null&&e.type==f.binaryOp&&e.operator==f.assignment){let i=e.position;this.pushError("= ist der Zuweisungsoperator. Du willst sicher zwei Werte vergleichen. Dazu benötigst Du den Vergleichsoperator ==.",i,t==P?"warning":"error",{title:"= durch == ersetzen",editsProvider:n=>[{resource:n,edit:{range:{startLineNumber:i.line,startColumn:i.column,endLineNumber:i.line,endColumn:i.column+1,message:"",severity:monaco.MarkerSeverity.Error},text:"=="}}]})}}generateStatements(e){if(e==null||e.length==0||e[0]==null)return{withReturnStatement:!1};let t=this.processStatementsInsideBlock(e),i=e[e.length-1],n;return i!=null?(i.type==f.scopeNode?n=i.positionTo:(n=Object.assign({},i.position),n!=null&&(n.column+=n.length,n.length=1)),this.lastPosition=n):n=this.lastPosition,{withReturnStatement:t,endPosition:n}}processStatementsInsideBlock(e){let t=!1;for(let i of e){if(i==null)continue;let n=this.processNode(i);n!=null&&n.withReturnStatement!=null&&n.withReturnStatement&&(t=!0),n!=null&&n.type!=null&&n.type!=U&&(this.lastStatement!=null&&this.lastStatement.type==f.assignment&&this.lastStatement.leaveValueOnStack?this.lastStatement.leaveValueOnStack=!1:this.pushStatements({type:f.decreaseStackpointer,position:null,popCount:1,stepFinished:!0},!0))}return t}insertStatements(e,t){if(t!=null){Array.isArray(t)||(t=[t]);for(let i of t)this.currentProgram.statements.splice(e++,0,i)}}pushStatements(e,t=!1){if(e!=null){if(t&&this.currentProgram.statements.length>0){let i=this.currentProgram.statements[this.currentProgram.statements.length-1];i.stepFinished=!1}if(Array.isArray(e))for(let i of e)this.currentProgram.statements.push(i),(i.type==f.return||i.type==f.jumpAlways)&&this.lastStatement!=null&&(this.lastStatement.stepFinished=!1),i.position!=null?this.lastPosition=i.position:i.position=this.lastPosition,this.lastStatement=i;else this.currentProgram.statements.push(e),(e.type==f.return||e.type==f.jumpAlways)&&this.lastStatement!=null&&this.lastStatement.type!=f.noOp&&(this.lastStatement.stepFinished=!1),e.position!=null?this.lastPosition=e.position:e.position=this.lastPosition,this.lastStatement=e}}removeLastStatement(){let e=this.currentProgram.statements.pop();this.currentProgram.labelManager!=null&&this.currentProgram.labelManager.removeNode(e)}pushNewSymbolTable(e,t,i,n){let s=new qa(this.currentSymbolTable,t,i);if(this.symbolTableStack.push(this.currentSymbolTable),e&&(s.beginsNewStackframe=!0,this.currentSymbolTable.stackframeSize=this.nextFreeRelativeStackPos,this.nextFreeRelativeStackPos=0,n!=null)){let a={type:f.initStackframe,position:t,reserveForLocalVariables:0};n.statements.push(a),this.initStackFrameNodes.push(a)}return this.currentSymbolTable=s,s}popSymbolTable(e,t=!1){let i=this.currentSymbolTable;if(this.currentSymbolTable=this.symbolTableStack.pop(),i.variableMap.forEach(n=>{n.declarationError!=null&&n.usedBeforeInitialization&&(this.errorList.push(n.declarationError),n.declarationError=null)}),i.beginsNewStackframe&&(i.stackframeSize=this.nextFreeRelativeStackPos,this.nextFreeRelativeStackPos=this.currentSymbolTable.stackframeSize,e!=null)){let n=this.initStackFrameNodes.pop();if(n!=null&&(n.reserveForLocalVariables=i.stackframeSize),e.statements.length>0&&t){let s=e.statements[e.statements.length-1];[f.jumpAlways,f.jumpIfTrue,f.jumpIfFalse,f.jumpIfFalseAndLeaveOnStack,f.jumpIfTrueAndLeaveOnStack].indexOf(s.type)==-1&&(e.statements[e.statements.length-1].stepFinished=!1)}e.statements.push({type:f.closeStackframe,position:i.positionTo})}}pushError(e,t,i="error",n){this.errorList.push({text:e,position:t,quickFix:n,level:i})}openBreakScope(){this.breakNodeStack.push([])}openContinueScope(){this.continueNodeStack.push([])}pushBreakNode(e){this.breakNodeStack.length==0?this.pushError("Eine break-Anweisung ist nur innerhalb einer umgebenden Schleife oder switch-Anweisung sinnvoll.",e.position):(this.breakNodeStack[this.breakNodeStack.length-1].push(e),this.pushStatements(e))}pushContinueNode(e){this.continueNodeStack.length==0?this.pushError("Eine continue-Anweisung ist nur innerhalb einer umgebenden Schleife oder switch-Anweisung sinnvoll.",e.position):(this.continueNodeStack[this.continueNodeStack.length-1].push(e),this.pushStatements(e))}closeBreakScope(e,t){let i=this.breakNodeStack.pop();for(let n of i)t.registerJumpNode(n,e)}closeContinueScope(e,t){let i=this.continueNodeStack.pop();for(let n of i)t.registerJumpNode(n,e)}breakOccured(){return this.breakNodeStack.length>0&&this.breakNodeStack[this.breakNodeStack.length-1].length>0}processNode(e,t=!1){if(e!=null)switch(e.type){case f.binaryOp:return this.processBinaryOp(e);case f.unaryOp:return this.processUnaryOp(e);case f.pushConstant:return this.pushConstant(e);case f.callMethod:return this.callMethod(e);case f.identifier:{let s=this.resolveIdentifier(e),a=e.variable;return a!=null&&(t?(a.initialized=!0,a.usedBeforeInitialization||(a.declarationError=null)):a.initialized!=null&&!a.initialized&&(a.usedBeforeInitialization=!0,this.pushError("Die Variable "+a.identifier+" wird hier benutzt bevor sie initialisiert wurde.",e.position,"info"))),s}case f.selectArrayElement:return this.selectArrayElement(e);case f.incrementDecrementBefore:case f.incrementDecrementAfter:return this.incrementDecrementBeforeOrAfter(e);case f.superConstructorCall:return this.superconstructorCall(e);case f.constructorCall:return this.superconstructorCall(e);case f.keywordThis:return this.pushThisOrSuper(e,!1);case f.keywordSuper:return this.pushThisOrSuper(e,!0);case f.pushAttribute:return this.pushAttribute(e);case f.newObject:return this.newObject(e);case f.keywordWhile:return this.processWhile(e);case f.keywordDo:return this.processDo(e);case f.keywordFor:return this.processFor(e);case f.forLoopOverCollection:return this.processForLoopOverCollection(e);case f.keywordIf:return this.processIf(e);case f.keywordSwitch:return this.processSwitch(e);case f.keywordReturn:return this.processReturn(e);case f.localVariableDeclaration:return this.localVariableDeclaration(e);case f.arrayInitialization:return this.processArrayLiteral(e);case f.newArray:return this.processNewArray(e);case f.keywordPrint:case f.keywordPrintln:return this.processPrint(e);case f.castValue:return this.processManualCast(e);case f.keywordBreak:return this.pushBreakNode({type:f.jumpAlways,position:e.position}),null;case f.keywordContinue:return this.pushContinueNode({type:f.jumpAlways,position:e.position}),null;case f.rightBracket:let i=this.processNode(e.termInsideBrackets);return i!=null&&i.type instanceof $&&this.pushTypePosition(e.position,i.type),i;case f.scopeNode:this.pushNewSymbolTable(!1,e.position,e.positionTo);let n=this.processStatementsInsideBlock(e.statements);return this.popSymbolTable(),{type:null,isAssignable:!1,withReturnStatement:n}}}processManualCast(e){let t=this.processNode(e.whatToCast);if(t==null||t.type==null)return;let i=t.type;if(i!=null&&e.castToType!=null&&e.castToType.resolvedType!=null){let n=e.castToType.resolvedType;if(i.canCastTo(n)){if(i instanceof ut&&n instanceof ut)i.getCastInformation(n).needsStatement&&this.pushStatements({type:f.castValue,position:e.position,newType:n});else if(i instanceof $&&n==F){let s=i.getMethodBySignature("toString()");s!=null&&s.getReturnType()==F?this.pushStatements({type:f.callMethod,position:e.position,method:s,isSuperCall:!1,stackframeBegin:-1,stepFinished:!1}):(this.pushError("Der Datentyp "+i.identifier+" kann (zumindest durch casting) nicht in den Datentyp "+n.identifier+" umgewandelt werden.",e.position),this.pushStatements({type:f.castValue,position:e.position,newType:n}))}return{isAssignable:t.isAssignable,type:n}}if((i instanceof $||i instanceof Pe)&&(n instanceof $||n instanceof Pe))return this.pushStatements({type:f.checkCast,position:e.position,newType:n,stepFinished:!1}),{isAssignable:t.isAssignable,type:n};this.pushError("Der Datentyp "+i.identifier+" kann (zumindest durch casting) nicht in den Datentyp "+n.identifier+" umgewandelt werden.",e.position)}}processPrint(e){var n;let t=e.type==f.keywordPrint?f.print:f.println;if(this.module.pushMethodCallPosition(e.position,e.commaPositions,ni[e.type],e.rightBracketPosition),e.text!=null){let s=this.processNode(e.text);s!=null&&(this.ensureAutomaticCasting(s.type,F)||this.pushError("Die Methoden print und println erwarten einen Parameter vom Typ String. Gefunden wurde ein Wert vom Typ "+((n=s.type)==null?void 0:n.identifier)+".",e.position))}let i=!1;if(e.color!=null){let s=this.processNode(e.color);s!=null&&s.type!=F&&s.type!=C&&(this.ensureAutomaticCasting(s.type,F)||this.pushError("Die Methoden print und println erwarten als Farbe einen Parameter vom Typ String oder int. Gefunden wurde ein Wert vom Typ "+s.type.identifier+".",e.position)),i=!0}return this.pushStatements({type:t,position:e.position,empty:e.text==null,stepFinished:!0,withColor:i}),null}processNewArray(e){if(e.initialization!=null)return this.processArrayLiteral(e.initialization);let t=0;for(let i of e.elementCount)if(i!=null)this.processNode(i),t++;else break;return this.pushStatements({type:f.pushEmptyArray,position:e.position,arrayType:e.arrayType.resolvedType,dimension:t}),{isAssignable:!1,type:e.arrayType.resolvedType}}processArrayLiteral(e){var i;let t={type:f.beginArray,position:e.position,arrayType:e.arrayType.resolvedType};this.pushStatements(t);for(let n of e.nodes)if(n!=null)if(n.type==f.arrayInitialization)this.processArrayLiteral(n);else{let s=this.processNode(n);if(s==null)return;let a=e.arrayType.resolvedType.arrayOfType;this.ensureAutomaticCasting(s.type,a,n.position)||this.pushError("Der Datentyp des Terms ("+((i=s.type)==null?void 0:i.identifier)+") kann nicht in den Datentyp "+(a==null?void 0:a.identifier)+" konvertiert werden.",n.position)}return this.pushStatements({type:f.addToArray,position:e.position,numberOfElementsToAdd:e.nodes.length}),{isAssignable:!1,type:e.arrayType.resolvedType}}localVariableDeclaration(e,t=!1){e.variableType.resolvedType==null&&(e.variableType.resolvedType=Ka);let i=this.heap!=null&&this.symbolTableStack.length<=2,n={identifier:e.identifier,stackPos:i?null:this.nextFreeRelativeStackPos++,type:e.variableType.resolvedType,usagePositions:new Map,declaration:{module:this.module,position:e.position},isFinal:e.isFinal};if(this.pushUsagePosition(e.position,n),i?(this.pushStatements({type:f.heapVariableDeclaration,position:e.position,pushOnTopOfStackForInitialization:e.initialization!=null,variable:n,stepFinished:e.initialization==null}),this.heap[n.identifier]&&this.pushError("Die Variable "+e.identifier+" darf im selben Sichtbarkeitsbereich (Scope) nicht mehrmals definiert werden.",e.position),this.isAdhocCompilation||(this.heap[n.identifier]=n),this.currentSymbolTable.variableMap.set(e.identifier,n)):(this.currentSymbolTable.variableMap.get(e.identifier)&&this.pushError("Die Variable "+e.identifier+" darf im selben Sichtbarkeitsbereich (Scope) nicht mehrmals definiert werden.",e.position),this.currentSymbolTable.variableMap.set(e.identifier,n),this.pushStatements({type:f.localVariableDeclaration,position:e.position,pushOnTopOfStackForInitialization:e.initialization!=null,variable:n,stepFinished:e.initialization==null})),e.initialization!=null){let s=this.processNode(e.initialization);s!=null&&(n.type==lo?n.type=s.type:s.type==null?this.pushError("Der Typ des Terms auf der rechten Seite des Zuweisungsoperators (=) konnte nicht bestimmt werden.",e.initialization.position):this.ensureAutomaticCasting(s.type,n.type)||this.pushError("Der Term vom Typ "+s.type.identifier+" kann der Variable vom Typ "+n.type.identifier+" nicht zugeordnet werden.",e.initialization.position),this.pushStatements({type:f.assignment,position:e.initialization.position,stepFinished:!0,leaveValueOnStack:!1}))}else if(n.type==lo)this.pushError("Die Verwendung von var ist nur dann zulässig, wenn eine lokale Variable in einer Anweisung deklariert und initialisiert wird, also z.B. var i = 12;",e.variableType.position);else{let s=" = null";n.type==C&&(s=" = 0"),n.type==A&&(s=" = 0.0"),n.type==P&&(s=" = false"),n.type==Ge&&(s=" = ' '"),n.type==F&&(s=' = ""'),n.declarationError={text:"Jede lokale Variable sollte vor ihrer ersten Verwendung initialisiert werden.",position:e.position,quickFix:{title:s+" ergänzen",editsProvider:a=>{let l=e.position;return[{resource:a,edit:{range:{startLineNumber:l.line,startColumn:l.column+l.length,endLineNumber:l.line,endColumn:l.column+l.length},text:s}}]}},level:"info"},n.usedBeforeInitialization=!1,n.initialized=t}return null}processReturn(e){let t=this.currentSymbolTable.method;if(t==null)return this.pushError("Eine return-Anweisung ist nur im Kontext einer Methode erlaubt.",e.position),null;if(e.term!=null){if(t.getReturnType()==null)return this.pushError("Die Methode "+t.identifier+" erwartet keinen Rückgabewert.",e.position),null;let i=this.processNode(e.term);i!=null&&(this.ensureAutomaticCasting(i.type,t.getReturnType(),null,e)||this.pushError("Die Methode "+t.identifier+" erwartet einen Rückgabewert vom Typ "+t.getReturnType().identifier+". Gefunden wurde ein Wert vom Typ "+i.type.identifier+".",e.position))}else t.getReturnType()!=null&&t.getReturnType()!=U&&this.pushError("Die Methode "+t.identifier+" erwartet einen Rückgabewert vom Typ "+t.getReturnType().identifier+", daher ist die leere Return-Anweisung (return;) nicht ausreichend.",e.position);return this.pushStatements({type:f.return,position:e.position,copyReturnValueToStackframePos0:e.term!=null,stepFinished:!0,leaveThisObjectOnStack:!1}),{type:null,isAssignable:!1,withReturnStatement:!0}}processSwitch(e){let t=this.currentProgram.labelManager;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let i=this.processNode(e.condition);if(i==null||i.type==null)return;let n=i.type,s=n==F||n==Ge,a=n==C,l=n instanceof $t;s||a||l||this.pushError("Der Unterscheidungsterms einer switch-Anweisung muss den Datentyp String, char, int oder enum besitzen. Dieser hier ist vom Typ "+n.identifier,e.condition.position),l&&this.pushStatements({type:f.castValue,position:e.condition.position,newType:C});let o={type:f.keywordSwitch,position:e.position,defaultDestination:null,switchType:s?"string":"number",destinationLabels:[],destinationMap:{}};this.pushStatements(o);let u=t.insertJumpNode(f.jumpAlways,e.position,this);o.stepFinished=!0,t.registerSwitchStatement(o),this.openBreakScope();let h=e.caseNodes.length>0;for(let d of e.caseNodes)if(d.caseTerm==null){let v=t.markJumpDestination(1),w=this.generateStatements(d.statements);((w==null?void 0:w.withReturnStatement)==null||!w.withReturnStatement)&&(h=!1),o.defaultDestination=v}else{let v=null;if(l&&d.caseTerm.type==f.identifier){let D=n.identifierToInfoMap[d.caseTerm.identifier];D==null?this.pushError("Die Enum-Klasse "+n.identifier+" hat kein Element mit dem Bezeichner "+d.caseTerm.identifier,d.position,"error"):v=D.ordinal}else{this.processNode(d.caseTerm);let T=this.lastStatement;T.type==f.pushConstant&&(v=T.value),T.type==f.pushEnumValue&&(v=T.enumClass.getOrdinal(T.valueIdentifier)),this.removeLastStatement()}v==null&&this.pushError("Der Term bei case muss konstant sein.",d.caseTerm.position);let w=t.markJumpDestination(1),_=this.generateStatements(d.statements);((_==null?void 0:_.withReturnStatement)==null||!_.withReturnStatement)&&(h=!1),o.destinationLabels.push({constant:v,label:w})}return o.defaultDestination==null&&(h=!1),t.markJumpDestination(1,u),this.closeBreakScope(u,t),this.popSymbolTable(null),{type:null,isAssignable:!1,withReturnStatement:h}}processIf(e){let t=this.currentProgram.labelManager,i=this.processNode(e.condition);this.checkIfAssignmentInstedOfEqual(e.condition,i==null?void 0:i.type),i!=null&&i.type!=P&&i.type.identifier!="Boolean"&&this.pushError("Der Wert des Terms in Klammern hinter 'if' muss den Datentyp boolean besitzen.",e.condition.position);let n=t.insertJumpNode(f.jumpIfFalse,null,this),s=this.generateStatements(e.statementsIfTrue).withReturnStatement,a;e.statementsIfFalse!=null&&(a=t.insertJumpNode(f.jumpAlways,null,this)),t.markJumpDestination(1,n);let l;return e.statementsIfFalse==null||e.statementsIfFalse.length==0?l=!1:l=this.generateStatements(e.statementsIfFalse).withReturnStatement,a!=null&&t.markJumpDestination(1,a),{type:null,isAssignable:!1,withReturnStatement:s&&l}}processFor(e){let t=this.currentProgram.labelManager;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo),this.generateStatements(e.statementsBefore);let i=t.markJumpDestination(1),n=this.processNode(e.condition);n!=null&&n.type!=P&&(this.checkIfAssignmentInstedOfEqual(e.condition),this.pushError("Der Wert der Bedingung muss den Datentyp boolean besitzen.",e.condition.position));let s=t.insertJumpNode(f.jumpIfFalse,null,this);this.openBreakScope(),this.openContinueScope();let a=this.generateStatements(e.statements),l=a.withReturnStatement,o=t.markJumpDestination(1);return this.closeContinueScope(o,t),this.generateStatements(e.statementsAfter),t.insertJumpNode(f.jumpAlways,a.endPosition,this,i),t.markJumpDestination(1,s),this.closeBreakScope(s,t),this.popSymbolTable(),{type:null,isAssignable:!1,withReturnStatement:l}}processForLoopOverCollection(e){let t=this.currentProgram.labelManager;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let i=this.nextFreeRelativeStackPos++,n=this.processNode(e.collection);if(n==null)return;let s=n.type;this.pushStatements({type:f.popAndStoreIntoVariable,position:e.collection.position,stackposOfVariable:i,stepFinished:!1});let a,l=null;if(s instanceof ze)a=s.arrayOfType,l="array";else if(s instanceof $&&s.getImplementedInterface("Iterable")!=null){let L=s;s.baseClass!=null&&s.baseClass.getImplementedInterface("Iterable")!=null&&s.baseClass.module.isSystemModule&&(L=s.baseClass),L.module.isSystemModule?l="internalList":l="userDefinedIterable",L.getImplementedInterface("Iterable"),L.typeVariables.length==0?a=Wi:a=L.typeVariables[0].type}else if(s instanceof $&&s.identifier=="Group")l="group",a=this.moduleStore.getType("Shape").type;else return this.pushError("Mit der vereinfachten for-Schleife (for identifier : collectionOrArray) kann man nur über Arrays oder Klassen, die das Interface Iterable implementieren, iterieren.",e.collection.position),null;let o=e.variableType.resolvedType;if(o==null)return null;let u=o==lo;if(u)o=a,e.variableType.resolvedType=a;else if(!a.canCastTo(o))return this.pushError("Der ElementTyp "+a.identifier+" der Collection kann nicht in den Typ "+o.identifier+" der Iterationsvariable "+e.variableIdentifier+" konvertiert werden.",e.position),null;this.localVariableDeclaration({type:f.localVariableDeclaration,identifier:e.variableIdentifier,initialization:null,isFinal:!1,position:e.variablePosition,variableType:e.variableType},!0);let h=this.nextFreeRelativeStackPos-1,d=this.nextFreeRelativeStackPos++;l=="array"||l=="internalList"||l=="group"?this.pushStatements([{type:f.extendedForLoopInit,position:e.position,stepFinished:!1,stackPosOfCollection:i,stackPosOfElement:h,typeOfElement:o,stackPosOfCounter:d}],!0):this.pushStatements([{type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:d,stepFinished:!1},{type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:i,stepFinished:!1},{type:f.callMethod,position:e.position,stepFinished:!1,isSuperCall:!1,method:s.getMethod("iterator",new g([])),stackframeBegin:-1},{type:f.assignment,position:e.position,stepFinished:!0,leaveValueOnStack:!1}],!0);let p=t.markJumpDestination(1),v,w;if(l=="array"||l=="internalList"||l=="group"){let L={type:f.extendedForLoopCheckCounterAndGetElement,kind:l,position:e.variablePosition,stepFinished:!0,stackPosOfCollection:i,stackPosOfElement:h,stackPosOfCounter:d,destination:0};w=L,v=t.registerJumpNode(L),this.pushStatements(L)}else this.pushStatements([{type:f.pushLocalVariableToStack,position:e.variablePosition,stackposOfVariable:i,stepFinished:!1},{type:f.callMethod,position:e.position,stepFinished:!1,isSuperCall:!1,method:s.getMethod("hasNext",new g([])),stackframeBegin:-1}]),v=t.insertJumpNode(f.jumpIfFalse,null,this),this.pushStatements([{type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:h,stepFinished:!1},{type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:i,stepFinished:!1},{type:f.callMethod,position:e.position,stepFinished:!1,isSuperCall:!1,method:s.getMethod("next",new g([])),stackframeBegin:-1},{type:f.assignment,position:e.position,stepFinished:!0,leaveValueOnStack:!1}]);if(!u){let L=this.currentProgram.statements.length;this.pushStatements({type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:h,stepFinished:!1}),this.ensureAutomaticCasting(a,o),this.currentProgram.statements.length<L+2?this.currentProgram.statements.pop():(this.pushStatements({type:f.popAndStoreIntoVariable,stackposOfVariable:h,position:e.position,stepFinished:!0}),w.stepFinished=!1)}this.openBreakScope(),this.openContinueScope();let _=this.generateStatements(e.statements),T=_.withReturnStatement,D=t.markJumpDestination(1);return this.closeContinueScope(D,t),t.insertJumpNode(f.jumpAlways,_.endPosition,this,p),t.markJumpDestination(1,v),this.closeBreakScope(v,t),this.popSymbolTable(),{type:null,isAssignable:!1,withReturnStatement:T}}processWhile(e){let t=this.currentProgram.labelManager;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let i=t.markJumpDestination(1),n=this.processNode(e.condition);n!=null&&n.type!=P&&(this.checkIfAssignmentInstedOfEqual(e.condition),this.pushError("Der Wert des Terms in Klammern hinter 'while' muss den Datentyp boolean besitzen.",e.condition.position));let s=e.position;e.condition!=null&&(s=e.condition.position);let a=t.insertJumpNode(f.jumpIfFalse,s,this);this.openBreakScope(),this.openContinueScope();let l=this.currentProgram.statements.length,o=this.generateStatements(e.statements),u=o.withReturnStatement;return this.currentProgram.statements.length==l&&this.insertNoOp(e.scopeTo,!1),this.closeContinueScope(i,t),t.insertJumpNode(f.jumpAlways,o.endPosition,this,i),t.markJumpDestination(1,a),this.closeBreakScope(a,t),this.popSymbolTable(),{type:null,isAssignable:!1,withReturnStatement:u}}insertNoOp(e,t){this.pushStatements({type:f.noOp,position:e,stepFinished:t})}processDo(e){let t=this.currentProgram.labelManager;this.pushNewSymbolTable(!1,e.scopeFrom,e.scopeTo);let i=t.markJumpDestination(1);this.openBreakScope(),this.openContinueScope();let n=this.currentProgram.statements.length,s=this.generateStatements(e.statements),a=s.withReturnStatement;this.currentProgram.statements.length==n&&this.insertNoOp(e.scopeTo,!1);let l=t.markJumpDestination(1);this.closeContinueScope(l,t);let o=this.processNode(e.condition);o!=null&&o.type!=P&&(this.checkIfAssignmentInstedOfEqual(e.condition),this.pushError("Der Wert des Terms in Klammern hinter 'while' muss den Datentyp boolean besitzen.",e.condition.position)),t.insertJumpNode(f.jumpIfTrue,s.endPosition,this,i);let u=t.markJumpDestination(1);return this.closeBreakScope(u,t),this.popSymbolTable(),{type:null,isAssignable:!1,withReturnStatement:a}}newObject(e){var h;if(e.classType==null||e.classType.resolvedType==null)return null;let t=e.classType.resolvedType;if(!(t instanceof $))return this.pushError(e.classType.identifier+" ist keine Klasse, daher kann davon mit 'new' kein Objekt erzeugt werden.",e.position),null;if(t.isAbstract)return this.pushError(`${e.classType.identifier} ist eine abstrakte Klasse, daher kann von ihr mit 'new' kein Objekt instanziert werden. Falls ${e.classType.identifier} nicht-abstrakte Kindklassen besitzt, könntest Du von DENEN mit new Objekte instanzieren...`,e.position),null;t.module!=this.module&&t.visibility!=ee.public&&this.pushError("Die Klasse "+t.identifier+" ist hier nicht sichtbar.",e.position);let i={type:f.newObject,position:e.position,class:t,subsequentConstructorCall:!1,stepFinished:!0};this.pushStatements(i),this.pushTypePosition(e.rightBracketPosition,t);let n=[],s=[],a=this.currentProgram.statements;if(((h=e.constructorOperands)==null?void 0:h.length)>0)for(let d=0;d<e.constructorOperands.length;d++){let p=e.constructorOperands[d],v=this.processNode(p);s.push(a.length),v==null?n.push(U):n.push(v.type)}let l=Aa(t,this.currentSymbolTable.classContext),o=t.getConstructor(n,ee.private),u=o.methodList.slice();if(o.methodList=u.filter(d=>d.visibility<=l),o.methodList.length==0&&u.length>0){let d=u[0],p=ee[d.visibility];o.error=`Es gibt zwar einen Konstruktor mit passender Signatur, dieser ist aber ${p} und daher hier nicht sichtbar.`}if(this.module.pushMethodCallPosition(e.position,e.commaPositions,t.getMethods(ee.public,t.identifier),e.rightBracketPosition),n.length>0||t.hasConstructor()){if(o.error!=null)return this.pushError(o.error,e.position),{type:t,isAssignable:!1};let d=o.methodList[0];this.pushUsagePosition(e.position,d);let p=null,v=this.currentSymbolTable.classContext;v!=null&&v instanceof $&&(p=v.staticClass),d.visibility==ee.private&&t!=v&&t!=p&&(t==v||t!=p||v instanceof Vt&&t==v.Klass||this.pushError("Die Konstruktormethode ist private und daher hier nicht sichtbar.",e.position));let w=null;for(let T=0;T<n.length;T++){T<d.getParameterCount()&&(w=d.getParameterType(T),T==d.getParameterCount()-1&&d.hasEllipsis()&&(w=w.arrayOfType));let D=n[T],L=a.length;if(this.ensureAutomaticCasting(D,w,e.constructorOperands[T].position,e.constructorOperands[T])||this.pushError("Der Wert vom Datentyp "+D.identifier+" kann nicht als Parameter (Datentyp "+w.identifier+") verwendet werden.",e.constructorOperands[T].position),a.length>L){let O=a.splice(L,a.length-L);a.splice(s[T],0,...O),this.currentProgram.labelManager.correctPositionsAfterInsert(s[T],O.length)}}let _=0;if(d.hasEllipsis()){let T=n.length-d.getParameterCount()+1;_=-(T-1),this.pushStatements({type:f.makeEllipsisArray,position:e.constructorOperands[d.getParameterCount()-1].position,parameterCount:T,stepFinished:!1,arrayType:d.getParameter(d.getParameterCount()-1).type})}this.pushStatements({type:f.callMethod,method:d,position:e.position,isSuperCall:!1,stepFinished:t.getPostConstructorCallbacks()==null,stackframeBegin:-(n.length+1+_)},!0),i.subsequentConstructorCall=!0,i.stepFinished=!1}return t.getPostConstructorCallbacks()!=null&&this.pushStatements({type:f.processPostConstructorCallbacks,position:e.position,stepFinished:!0},!0),{type:t,isAssignable:!1}}pushAttribute(e){if(e.object==null||e.identifier==null)return null;let t=this.processNode(e.object);if(t==null)return this.pushError("Links vom Punkt steht kein Objekt.",e.position),null;if(!(t.type instanceof $||t.type instanceof Vt||t.type instanceof ze))return t.type==null?this.pushError("Der Ausdruck links vom Punkt hat kein Attribut "+e.identifier+".",e.position):this.pushError("Links vom Punkt steht ein Ausdruck vom Datentyp "+t.type.identifier+". Dieser hat kein Attribut "+e.identifier+".",e.position),null;let i=t.type;if(i instanceof $){let n=Aa(i,this.currentSymbolTable.classContext),s=i.getAttribute(e.identifier,n),a=null;if(s.attribute==null&&(a=i.staticClass.getAttribute(e.identifier,n)),s.attribute==null&&a.attribute==null)return s.foundButInvisible||!a.foundButInvisible?this.pushError(s.error,e.position):this.pushError(a.error,e.position),{type:i,isAssignable:!1};{let l;return s.attribute!=null?(this.pushStatements({type:f.pushAttribute,position:e.position,attributeIndex:s.attribute.index,attributeIdentifier:s.attribute.identifier,useThisObject:!1}),l=s.attribute):(this.pushStatements([{type:f.decreaseStackpointer,position:e.position,popCount:1},{type:f.pushStaticAttribute,position:e.position,klass:a.staticClass,attributeIndex:a.attribute.index,attributeIdentifier:a.attribute.identifier}]),l=a.attribute),this.pushUsagePosition(e.position,l),{type:l.type,isAssignable:!l.isFinal}}}else if(i instanceof Vt){if(i.Klass instanceof $t)return this.removeLastStatement(),i.Klass.enumInfoList.find(s=>s.identifier==e.identifier)==null&&this.pushError("Die enum-Klasse "+i.identifier+" hat keinen enum-Wert mit dem Bezeichner "+e.identifier,e.position),this.pushStatements({type:f.pushEnumValue,position:e.position,enumClass:i.Klass,valueIdentifier:e.identifier}),{type:i.Klass,isAssignable:!1};{let n=Aa(i,this.currentSymbolTable.classContext),s=i.getAttribute(e.identifier,n);return s.attribute!=null?(this.removeLastStatement(),this.pushStatements({type:f.pushStaticAttribute,position:e.position,attributeIndex:s.attribute.index,attributeIdentifier:s.attribute.identifier,klass:s.staticClass}),this.pushUsagePosition(e.position,s.attribute),{type:s.attribute.type,isAssignable:!s.attribute.isFinal}):(this.pushError(s.error,e.position),{type:i,isAssignable:!1})}}else{if(e.identifier!="length")return this.pushError("Der Wert vom Datentyp "+t.type.identifier+" hat kein Attribut "+e.identifier,e.position),null;this.pushStatements({type:f.pushArrayLength,position:e.position});let n=new ce("length",C,null,!0,ee.public,!0,"Länge des Arrays");return this.module.addIdentifierPosition(e.position,n),{type:C,isAssignable:!1}}}pushThisOrSuper(e,t){let i=this.currentSymbolTable.classContext;t&&i!=null&&(i=i.baseClass);let n=this.currentSymbolTable.method;return i==null||n==null?(this.pushError("Das Objekt "+(t?"super":"this")+" existiert nur innerhalb einer Methodendeklaration.",e.position),null):(this.pushStatements({type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:0}),this.pushTypePosition(e.position,i),{type:i,isAssignable:!1,isSuper:t})}superconstructorCall(e){let t=this.currentSymbolTable.classContext,i=e.type==f.superConstructorCall;i&&((t==null?void 0:t.baseClass)==null||t.baseClass.identifier=="Object")&&this.pushError("Die Klasse ist nur Kindklasse der Klasse Object, daher ist der Aufruf des Superkonstruktors nicht möglich.",e.position);let n=this.currentSymbolTable.method;if(t==null||n==null||!n.isConstructor)return this.pushError("Ein Aufruf des Konstruktors oder des Superkonstructors ist nur innerhalb des Konstruktors einer Klasse möglich.",e.position),null;let s;if(i){if(s=t.baseClass,s instanceof Vt)return this.pushError("Statische Methoden haben keine super-Methodenaufrufe.",e.position),{type:null,isAssignable:!1};s==null&&(s=this.moduleStore.getType("Object").type)}else if(s=t,s instanceof Vt)return this.pushError("Statische Methoden haben keine this-Methodenaufrufe.",e.position),{type:null,isAssignable:!1};if(!e.operands||e.operands.length==0&&s.getConstructor([],ee.protected).methodList.length==0)return{type:null,isAssignable:!1};this.pushStatements({type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:0});let a=[];if(e.operands!=null){let h=!1;for(let d of e.operands){let p=this.processNode(d);p!=null?a.push(p.type):h=!0}if(h)return{type:F,isAssignable:!1}}let l=s.getConstructor(a,ee.protected);if(this.module.pushMethodCallPosition(e.position,e.commaPositions,s.getMethods(ee.protected,s.identifier),e.rightBracketPosition),l.error!=null)return this.pushError(l.error,e.position),{type:F,isAssignable:!1};let o=l.methodList[0];this.pushUsagePosition(e.position,o);let u=0;if(o.hasEllipsis()){let h=a.length-o.getParameterCount()+1;u=-(h-1),this.pushStatements({type:f.makeEllipsisArray,position:e.operands[o.getParameterCount()-1].position,parameterCount:h,stepFinished:!1,arrayType:o.getParameter(o.getParameterCount()-1).type})}return this.pushStatements({type:f.callMethod,method:o,isSuperCall:i,position:e.position,stackframeBegin:-(a.length+1+u)}),{type:null,isAssignable:!1}}incrementDecrementBeforeOrAfter(e){let t=this.processNode(e.operand);if(t!=null)return t.isAssignable?t.type.canCastTo(G)?(t.type==Ge?this.pushStatements({type:e.type==f.incrementDecrementBefore?f.incrementDecrementCharBefore:f.incrementDecrementCharAfter,position:e.position,incrementDecrementBy:e.operator==f.doubleMinus?-1:1}):this.pushStatements({type:e.type,position:e.position,incrementDecrementBy:e.operator==f.doubleMinus?-1:1}),t):(this.pushError("Die Operatoren ++ und -- können nur auf Zahlen angewendet werden, nicht auf Werte des Datentyps "+t.type.identifier,e.position),t):(this.pushError("Die Operatoren ++ und -- können nur auf Variablen angewendet werden, nicht auf konstante Werte oder Rückgabewerte von Methoden.",e.position),t)}selectArrayElement(e){let t=this.processNode(e.object),i=this.processNode(e.index);if(!(t==null||i==null))return t.type instanceof ze?(this.module.addIdentifierPosition({line:e.position.line,column:e.position.column+e.position.length,length:0},t.type.arrayOfType),this.ensureAutomaticCasting(i.type,C)?(this.pushStatements({type:f.selectArrayElement,position:e.position}),{type:t.type.arrayOfType,isAssignable:t.isAssignable}):(this.pushError("Als Index eines Arrays wird ein ganzzahliger Wert erwartet. Gefunden wurde ein Wert vom Typ "+i.type.identifier+".",e.index.position),{type:t.type.arrayOfType,isAssignable:t.isAssignable})):(this.pushError("Der Typ der Variablen ist kein Array, daher ist [] nicht zulässig. ",e.object.position),null)}pushTypePosition(e,t){e!=null&&(e.length>0&&(e={line:e.line,column:e.column+e.length,length:0}),this.module.addIdentifierPosition(e,t))}pushUsagePosition(e,t){if(this.module.addIdentifierPosition(e,t),t instanceof ut)return;let i=t.usagePositions.get(this.module);i==null&&(i=[],t.usagePositions.set(this.module,i)),i.push(e)}resolveIdentifier(e){if(e.identifier==null)return null;let t=this.findLocalVariable(e.identifier);if(t!=null)return this.pushStatements({type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:t.stackPos}),this.pushUsagePosition(e.position,t),e.variable=t,{type:t.type,isAssignable:!t.isFinal};if(this.heap!=null){let s=this.heap[e.identifier];if(s!=null)return this.pushStatements({type:f.pushFromHeapToStack,position:e.position,identifier:e.identifier}),this.pushUsagePosition(e.position,s),e.variable=s,{type:s.type,isAssignable:!s.isFinal}}let i=this.findAttribute(e.identifier,e.position);if(i!=null){if(i.isStatic){let s=this.currentSymbolTable.classContext,a=s instanceof Vt?s:s.staticClass;for(;a!=null&&a.attributes.indexOf(i)==-1;)a=a.baseClass;this.pushStatements({type:f.pushStaticAttribute,position:e.position,klass:a,attributeIndex:i.index,attributeIdentifier:i.identifier})}else this.pushStatements({type:f.pushAttribute,position:e.position,attributeIndex:i.index,attributeIdentifier:i.identifier,useThisObject:!0}),e.attribute=i;return this.pushUsagePosition(e.position,i),{type:i.type,isAssignable:!i.isFinal||this.currentSymbolTable.method.isConstructor}}let n=this.moduleStore.getType(e.identifier);if(n!=null){let s=n.type;if(!(s instanceof $||s instanceof Pe))this.pushError("Der Typ "+s.identifier+" hat keine statischen Attribute/Methoden.",e.position);else return this.pushStatements({type:f.pushStaticClassObject,position:e.position,klass:s}),this.pushUsagePosition(e.position,s),{type:s instanceof $?s.staticClass:s,isAssignable:!1};return{type:s,isAssignable:!1}}this.pushError("Der Bezeichner "+e.identifier+" ist hier nicht bekannt.",e.position)}findLocalVariable(e){let t=this.currentSymbolTable;for(;t!=null;){let i=t.variableMap.get(e);if(i!=null&&i.stackPos!=null)return i;t=t.parent}return null}findAttribute(e,t){let i=this.currentSymbolTable.classContext;if(i==null)return null;let n=i.getAttribute(e,ee.private);if(n.attribute!=null)return n.attribute;if(i instanceof $){let s=i.staticClass.getAttribute(e,ee.private);if(s.attribute!=null)return s.attribute}return null}callMethod(e){let t=null;if(e.object==null){let v=this.currentSymbolTable.classContext;if(v!=null)this.pushStatements({type:f.pushLocalVariableToStack,position:e.position,stackposOfVariable:0}),t={type:v,isAssignable:!1};else return this.pushError("Ein Methodenaufruf (hier: "+e.identifier+") ohne Punktschreibweise ist nur innerhalb anderer Methoden möglich.",e.position),null}else t=this.processNode(e.object);if(t==null)return null;if(!(t.type instanceof $||t.type instanceof Vt||t.type instanceof Pe&&(e.object.object!=null||e.object.variable!=null||e.object.attribute!=null||e.object.termInsideBrackets!=null)||t.type instanceof $t))return t.type==null?this.pushError("Werte dieses Datentyps besitzen keine Methoden.",e.position):t.type instanceof Pe?this.pushError("Methodendefinitionen eines Interfaces können nicht statisch aufgerufen werden.",e.position):this.pushError("Werte des Datentyps "+t.type.identifier+" besitzen keine Methoden.",e.position),null;let i=t.type,n=this.currentProgram.statements.length,s=[],a=[],l=this.currentProgram.statements;if(e.operands!=null)for(let v=0;v<e.operands.length;v++){let w=e.operands[v],_=this.processNode(w);a.push(l.length),_==null?s.push(U):s.push(_.type)}let o;if(i instanceof Pe)o=i.getMethodsThatFitWithCasting(e.identifier,s,!1);else{let v=Aa(i,this.currentSymbolTable.classContext);o=i.getMethodsThatFitWithCasting(e.identifier,s,!1,v)}if(this.module.pushMethodCallPosition(e.position,e.commaPositions,i.getMethods(ee.private,e.identifier),e.rightBracketPosition),o.error!=null)return this.pushError(o.error,e.position),{type:F,isAssignable:!1};let u=o.methodList[0];this.pushUsagePosition(e.position,u),u.isStatic&&i instanceof $&&i.identifier!="PrintStream"&&(this.pushError("Es ist kein guter Programmierstil, statische Methoden einer Klasse mithilfe eines Objekts aufzurufen. Besser wäre hier "+i.identifier+"."+u.identifier+"(...).",e.position,"info"),this.insertStatements(n,[{type:f.decreaseStackpointer,position:e.position,popCount:1},{type:f.pushStaticClassObject,position:e.position,klass:i}]));let h=null;for(let v=0;v<s.length;v++){v<u.getParameterCount()&&(h=u.getParameterType(v),v==u.getParameterCount()-1&&u.hasEllipsis()&&(h=h.arrayOfType));let w=s[v],_=l.length;if(this.ensureAutomaticCasting(w,h,e.operands[v].position,e.operands[v])||this.pushError("Der Wert vom Datentyp "+w.identifier+" kann nicht als Parameter (Datentyp "+h.identifier+") verwendet werden.",e.operands[v].position),l.length>_){let T=l.splice(_,l.length-_);l.splice(a[v],0,...T),this.currentProgram.labelManager.correctPositionsAfterInsert(a[v],T.length)}}let d=0;if(u.hasEllipsis()){let v=s.length-u.getParameterCount()+1;d=-(v-1),this.pushStatements({type:f.makeEllipsisArray,position:e.operands[u.getParameterCount()-1].position,parameterCount:v,stepFinished:!1,arrayType:u.getParameter(u.getParameterCount()-1).type})}if(u.visibility!=ee.public){let v=!0,w=this.currentSymbolTable.classContext;w==null?v=!1:w!=i&&!(w instanceof $&&w.implements.indexOf(i)>0)&&(u.visibility==ee.private?v=!1:v=w.hasAncestorOrIs(i)),v||this.pushError("Die Methode "+u.identifier+" ist an dieser Stelle des Programms nicht sichtbar.",e.position)}let p=!1;if(u.isStatic&&t.type!=null&&t.type instanceof Vt)switch(t.type.Klass.identifier){case"Input":this.pushStatements({type:f.callInputMethod,method:u,position:e.position,stepFinished:!0,stackframeBegin:-(s.length+1+d)}),p=!0;break;case"SystemTools":case"Robot":["pause","warten"].indexOf(u.identifier)>=0&&(this.pushStatements([{type:f.setPauseDuration,position:e.position,stepFinished:!0},{type:f.pause,position:e.position,stepFinished:!0}]),p=!0);break}return p||this.pushStatements({type:f.callMethod,method:u,position:e.position,isSuperCall:t.isSuper==null?!1:t.isSuper,stepFinished:!0,stackframeBegin:-(s.length+1+d)}),this.pushTypePosition(e.rightBracketPosition,u.getReturnType()),{type:u.getReturnType(),isAssignable:!1}}pushConstant(e){let t;switch(e.constantType){case f.integerConstant:t=C;break;case f.longConstant:t=se;break;case f.shortConstant:t=it;break;case f.booleanConstant:t=P;break;case f.floatingPointConstant:t=G;break;case f.stringConstant:t=F,this.pushTypePosition(e.position,t);break;case f.charConstant:t=Ge;break;case f.keywordNull:t=Ka;break}return this.pushStatements({type:f.pushConstant,dataType:t,position:e.position,value:e.constant}),{type:t,isAssignable:!1}}processBinaryOp(e){let t=ou.assignmentOperators.indexOf(e.operator)>=0;if(e.operator==f.ternaryOperator)return this.processTernaryOperator(e);let i=this.processNode(e.firstOperand,t),n=this.currentProgram.statements.length,s=null;e.operator==f.and?s=this.currentProgram.labelManager.insertJumpNode(f.jumpIfFalseAndLeaveOnStack,e.firstOperand.position,this):e.operator==f.or&&(s=this.currentProgram.labelManager.insertJumpNode(f.jumpIfTrueAndLeaveOnStack,e.firstOperand.position,this));let a=this.processNode(e.secondOperand);if(i==null||i.type==null||a==null||a.type==null)return null;if(t){if(!this.ensureAutomaticCasting(a.type,i.type,e.position,e.firstOperand))return this.pushError("Der Wert vom Datentyp "+a.type.identifier+" auf der rechten Seite kann der Variablen auf der linken Seite (Datentyp "+i.type.identifier+") nicht zugewiesen werden.",e.position),i;i.isAssignable||this.pushError("Dem Term/der Variablen auf der linken Seite des Zuweisungsoperators (=) kann kein Wert zugewiesen werden.",e.position),e.operator==f.divisionAssignment&&i.type==C&&(e.operator=f.divisionAssignmentInteger);let l={type:e.operator,position:e.position,stepFinished:!0,leaveValueOnStack:!0};return this.pushStatements(l),i}else{if(e.firstOperand.type==f.identifier&&e.firstOperand.variable!=null){let h=e.firstOperand.variable;h.initialized!=null&&!h.initialized&&(h.usedBeforeInitialization=!0,this.pushError("Die Variable "+h.identifier+" wird hier benutzt bevor sie initialisiert wurde.",e.position,"info"))}let l=i.type.getResultType(e.operator,a.type);i.type==Ge&&a.type==C&&this.ensureAutomaticCasting(i.type,a.type,e.position,e,-1),i.type==C&&a.type==Ge&&this.ensureAutomaticCasting(a.type,i.type,e.position,e,0);let o=i.type.unboxableAs,u=a.type.unboxableAs;if(l==null&&(o!=null||u!=null)){let h=o??[i.type],d=u??[a.type];for(let p of h){for(let v of d)if(l=p.getResultType(e.operator,v),l!=null){i.type=p,a.type=v;break}if(l!=null)break}}if(l==null&&e.operator==f.plus&&(i.type instanceof $&&a.type==F?(this.insertStatements(n,this.getToStringStatement(i.type,e.firstOperand.position)),l=F,i.type=F):a.type instanceof $&&i.type==F&&(this.pushStatements(this.getToStringStatement(a.type,e.firstOperand.position)),l=F)),e.operator in[f.and,f.or]&&(this.checkIfAssignmentInstedOfEqual(e.firstOperand),this.checkIfAssignmentInstedOfEqual(e.secondOperand)),l==null){let h=[f.ampersand,f.OR],d=["&& (boolescher UND-Operator)","|| (boolescher ODER-Operator)"],p=["& &","||"],v=h.indexOf(e.operator);return v>=0&&i.type==P&&a.type==P?this.pushError("Die Operation "+ni[e.operator]+" ist für die Operanden der Typen "+i.type.identifier+" und "+a.type.identifier+" nicht definiert. Du meintest wahrscheinlich den Operator "+d[v]+".",e.position,"error",{title:"Operator "+p[v]+" verwenden statt "+ni[e.operator],editsProvider:w=>[{resource:w,edit:{range:{startLineNumber:e.position.line,startColumn:e.position.column,endLineNumber:e.position.line,endColumn:e.position.column},text:ni[e.operator]}}]}):this.pushError("Die Operation "+ni[e.operator]+" ist für die Operanden der Typen "+i.type.identifier+" und "+a.type.identifier+" nicht definiert.",e.position),i}return this.pushStatements({type:f.binaryOp,leftType:i.type,operator:e.operator,position:e.position}),s!=null&&this.currentProgram.labelManager.markJumpDestination(1,s),{type:l,isAssignable:!1}}}processTernaryOperator(e){let t=this.processNode(e.firstOperand);if(t!=null&&this.ensureAutomaticCasting(t.type,P,null,e.firstOperand)){let i=e.secondOperand;if(i!=null)if(i.type!=f.binaryOp||i.operator!=f.colon)this.pushError("Auf den Fragezeichenoperator müssen - mit Doppelpunkt getrennt - zwei Alternativterme folgen.",e.position);else{let n=this.currentProgram.labelManager,s=n.insertJumpNode(f.jumpIfFalse,e.position,this),a=this.processNode(i.firstOperand),l=n.insertJumpNode(f.jumpAlways,i.firstOperand.position,this);n.markJumpDestination(1,s);let o=this.processNode(i.secondOperand);n.markJumpDestination(1,l);let u=a.type;return o!=null&&u!=o.type&&u.canCastTo(o.type)&&(u=o.type),{type:u,isAssignable:!1}}}}processUnaryOp(e){let t=this.processNode(e.operand);if(!(t==null||t.type==null))return e.operator==f.minus&&!t.type.canCastTo(G)?(this.pushError("Der Operator - ist für den Typ "+t.type.identifier+" nicht definiert.",e.position),t):e.operator==f.not&&t.type!=P?(this.checkIfAssignmentInstedOfEqual(e.operand),this.pushError("Der Operator ! ist für den Typ "+t.type.identifier+" nicht definiert.",e.position),t):(this.pushStatements({type:f.unaryOp,operator:e.operator,position:e.position}),t)}};y(ou,"assignmentOperators",[f.assignment,f.plusAssignment,f.minusAssignment,f.multiplicationAssignment,f.divisionAssignment,f.moduloAssignment,f.ANDAssigment,f.ORAssigment,f.XORAssigment,f.shiftLeftAssigment,f.shiftRightAssigment,f.shiftRightUnsignedAssigment]);let ko=ou;const It=class It{constructor(e){y(this,"module");y(this,"pos");y(this,"tokenList");y(this,"errorList");y(this,"typeNodes");y(this,"lookahead",7);y(this,"ct");y(this,"lastToken");y(this,"cct");y(this,"tt");y(this,"position");y(this,"lastComment");y(this,"endToken",{position:{line:0,column:0,length:1},tt:f.endofSourcecode,value:"das Ende des Programms"});y(this,"tokensNotAfterCasting",[f.multiplication,f.division,f.plus,f.minus,f.dot,f.modulo,f.semicolon,f.rightBracket]);this.isInConsoleMode=e}parse(e){if(this.module=e,this.tokenList=e.tokenList,this.errorList=[],this.tokenList.length==0){this.module.mainProgramAst=[],this.module.classDefinitionsAST=[],this.module.typeNodes=[],this.module.errors[1]=this.errorList;return}this.pos=0,this.initializeLookahead(),this.typeNodes=[];let t=this.tokenList[this.tokenList.length-1];this.endToken.position={line:t.position.line,column:t.position.column+t.position.length,length:1};let i=this.parseMain();this.module.mainProgramAst=i.mainProgramAST,this.module.classDefinitionsAST=i.classDefinitionAST,this.module.mainProgramEnd=i.mainProgramEnd,this.module.typeNodes=this.typeNodes,this.module.errors[1]=this.errorList}initializeLookahead(){this.ct=[];for(let e=0;e<this.lookahead;e++){let t=this.endToken;for(;!(this.pos>=this.tokenList.length);){let i=this.tokenList[this.pos];if(i.tt==f.comment&&(this.lastComment=i),i.tt!=f.newline&&i.tt!=f.space&&i.tt!=f.comment){t=i,this.lastComment!=null&&(t.commentBefore=this.lastComment,this.lastComment=null);break}this.pos++}this.ct.push(t),e<this.lookahead-1&&this.pos++}this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}nextToken(){let e;for(this.lastToken=this.cct;;){if(this.pos++,this.pos>=this.tokenList.length){e=this.endToken;break}if(e=this.tokenList[this.pos],e.tt==f.comment&&(this.lastComment=e),e.tt!=f.newline&&e.tt!=f.space&&e.tt!=f.comment){e.commentBefore=this.lastComment,this.lastComment=null;break}}for(let t=0;t<this.lookahead-1;t++)this.ct[t]=this.ct[t+1];this.ct[this.lookahead-1]=e,this.cct=this.ct[0],this.tt=this.cct.tt,this.position=this.cct.position}pushError(e,t="error",i,n){i==null&&(i=Object.assign({},this.position)),this.errorList.push({text:e,position:i,quickFix:n,level:t})}expect(e,t=!0,i=!1){if(this.tt!=e){if(e==f.semicolon&&this.tt==f.endofSourcecode)return!0;let n=this.cct.position;e==f.semicolon&&this.lastToken!=null&&this.lastToken.position.line<n.line&&(n={line:this.lastToken.position.line,column:this.lastToken.position.column+this.lastToken.position.length,length:1});let s=null;return e==f.semicolon&&this.lastToken.position.line<this.cct.position.line&&!this.isOperatorOrDot(this.lastToken.tt)&&(s={title:"Strichpunkt hier einfügen",editsProvider:a=>[{resource:a,edit:{range:{startLineNumber:n.line,startColumn:n.column,endLineNumber:n.line,endColumn:n.column,message:"",severity:monaco.MarkerSeverity.Error},text:";"}}]},i&&this.errorList.length<3&&this.module.main.getSemicolonAngel().register(n,this.module)),this.pushError("Erwartet wird: "+ni[e]+" - Gefunden wurde: "+ni[this.tt],"error",n,s),!1}return t&&this.nextToken(),!0}isOperatorOrDot(e){if(e==f.dot)return!0;for(let t of It.operatorPrecedence)for(let i of t)if(e==i)return!0;return!1}isEnd(){return this.cct==this.endToken}comesToken(e){return Array.isArray(e)?e.indexOf(this.tt)>=0:this.tt==e}getCurrentPosition(){return Object.assign({},this.position)}getEndOfCurrentToken(){let e=this.getCurrentPosition();return e.column=e.column+this.position.length,e.length=0,e}parseMain(){let e=[],t=[],i={column:0,line:1e4,length:1};for(;!this.isEnd();){let n=this.pos;if(this.comesToken(It.BeforeClassDefinitionTokens)){let s=this.parseClassDefinition();s!=null&&(t=t.concat(s))}else{let s=this.parseStatement();s!=null&&(e=e.concat(s)),i=this.getCurrentPosition()}this.pos==n&&(this.pos++,this.initializeLookahead())}return{mainProgramAST:e,classDefinitionAST:t,mainProgramEnd:i}}checkIfStatementHasNoEffekt(e){if(!this.isInConsoleMode)if(e.type==f.binaryOp&&It.assignmentOperators.indexOf(e.operator)<0){let t="dieses Terms";switch(e.operator){case f.plus:t="dieser Summe";break;case f.minus:t="dieser Differenz";break;case f.multiplication:t="dieses Produkts";break;case f.division:t="dieses Quotienten";break}t+=" (Operator "+ni[e.operator]+")",this.pushError(`Der Wert ${t} wird zwar berechnet, aber danach verworfen. Möchtest Du ihn vielleicht einer Variablen zuweisen?`,"info",e.position)}else[f.unaryOp,f.pushConstant,f.identifier,f.selectArrayElement].indexOf(e.type)>=0&&this.pushError("Der Wert dieses Terms wird zwar berechnet, aber danach verworfen. Möchtest Du ihn vielleicht einer Variablen zuweisen?","info",e.position)}parseStatement(e=!0){let t=null;switch(this.tt){case f.leftBracket:case f.identifier:case f.keywordThis:case f.keywordSuper:case f.keywordFinal:case f.charConstant:case f.integerConstant:case f.stringConstant:case f.booleanConstant:case f.floatingPointConstant:case f.keywordNew:case f.not:let i=this.parseVariableDeclarationOrTerm();e&&this.expect(f.semicolon,!0,!0),t=i;break;case f.leftCurlyBracket:let n=[],s=this.getCurrentPosition();for(this.nextToken();this.tt!=f.rightCurlyBracket&&this.tt!=f.endofSourcecode&&It.BeforeClassDefinitionTokens.indexOf(this.tt)<0;)n=n.concat(this.parseStatement());let a=this.getCurrentPosition();a.column=a.column+a.length,a.length=0,this.expect(f.rightCurlyBracket),t=[{type:f.scopeNode,position:s,positionTo:a,statements:n}];break;case f.keywordWhile:t=this.parseWhile();break;case f.keywordFor:t=this.parseFor();break;case f.keywordDo:t=this.parseDo();break;case f.keywordIf:t=this.parseIf();break;case f.keywordReturn:t=this.parseReturn();break;case f.keywordPrint:case f.keywordPrintln:t=this.parsePrint();break;case f.keywordSwitch:t=this.parseSwitch();break;case f.keywordBreak:let l=this.getCurrentPosition();this.nextToken(),t=[{type:f.keywordBreak,position:l}];break;case f.keywordContinue:let o=this.getCurrentPosition();this.nextToken(),t=[{type:f.keywordContinue,position:o}];break;case f.semicolon:break;default:let u=ni[this.tt];u!=this.cct.value&&(u+="("+this.cct.value+")"),u+=" wird hier nicht erwartet.",this.pushError(u),It.BeforeClassDefinitionTokens.indexOf(this.tt)>=0||this.nextToken();break}if(t==null)for(;this.tt==f.semicolon&&e;)this.nextToken();return t!=null&&t.length>0&&(t[t.length-1]!=null?this.checkIfStatementHasNoEffekt(t[t.length-1]):t=null),t}parseReturn(){let e=this.getCurrentPosition();this.nextToken();let t;return this.tt!=f.semicolon&&(t=this.parseTerm(),this.expect(f.semicolon,!0,!0)),[{type:f.keywordReturn,position:e,term:t}]}parseWhile(){let e=this.getCurrentPosition();this.nextToken();let t=this.getCurrentPosition();if(this.expect(f.leftBracket,!0)){let i=this.parseTerm(),n=this.getCurrentPosition();this.module.pushMethodCallPosition(e,[],"while",n),this.expect(f.rightBracket,!0),this.tt==f.semicolon&&this.pushError("Diese while-loop wiederholt nur den Strichpunkt (leere Anweisung).","warning");let s=this.parseStatement(),a=this.getCurrentPosition();return a.length=0,s!=null&&s.length>0&&s[0].type==f.scopeNode&&(a=s[0].positionTo),[{type:f.keywordWhile,position:e,scopeFrom:t,scopeTo:a,condition:i,statements:s}]}return[]}parseFor(){let e=this.getCurrentPosition(),t=[];this.nextToken();let i=this.getCurrentPosition();if(this.expect(f.leftBracket,!0)){let n=!1;for(let d=0;d<this.lookahead;d++)if(this.ct[d].tt==f.colon){n=!0;break}if(n)return this.parseForLoopOverCollection(e,i);let s=this.parseStatement(!1);t.push(this.getCurrentPosition()),this.expect(f.semicolon);let a=this.parseTerm();t.push(this.getCurrentPosition()),this.expect(f.semicolon,!0);let l=this.parseStatement(!1),o=this.getCurrentPosition();this.expect(f.rightBracket,!0),this.module.pushMethodCallPosition(e,t,"for",o),this.tt==f.semicolon&&this.pushError("Diese for-loop wiederholt nur den Strichpunkt (leere Anweisung).","warning");let u=this.parseStatement(),h=this.getCurrentPosition();return h.length=0,u!=null&&u.length>0&&u[0].type==f.scopeNode&&(h=u[0].positionTo),a==null&&(a={type:f.pushConstant,position:this.getCurrentPosition(),constantType:f.booleanConstant,constant:!0}),[{type:f.keywordFor,position:e,scopeFrom:i,scopeTo:h,condition:a,statementsBefore:s,statementsAfter:l,statements:u}]}return[]}parseForLoopOverCollection(e,t){let i=this.parseType(),n=this.cct.value,s=this.getCurrentPosition();this.nextToken(),this.expect(f.colon,!0);let a=this.parseTerm();this.expect(f.rightBracket,!0),this.tt==f.semicolon&&this.pushError("Diese for-loop wiederholt nur den Strichpunkt (leere Anweisung).","warning");let l=this.parseStatement(),o=this.getCurrentPosition();return o.length=0,l!=null&&l.length>0&&l[0].type==f.scopeNode&&(o=l[0].positionTo),a==null||i==null||l==null?[]:[{type:f.forLoopOverCollection,position:e,scopeFrom:t,scopeTo:o,variableIdentifier:n,variableType:i,variablePosition:s,collection:a,statements:l}]}parsePrint(){let e=this.tt,t=this.getCurrentPosition();if(this.nextToken(),this.expect(f.leftBracket,!1)){let i=this.parseMethodCallParameters(),n=i.nodes;return n.length>2&&this.pushError("Die Methoden print und println haben maximal zwei Parameter.","error",t),this.expect(f.semicolon,!0,!0),[{type:e,position:t,text:n.length==0?null:n[0],color:n.length<=1?null:n[1],commaPositions:i.commaPositions,rightBracketPosition:i.rightBracketPosition}]}return null}parseSwitch(){let e=this.getCurrentPosition();if(this.nextToken(),this.expect(f.leftBracket,!0)){let t=this.parseTerm();this.module.pushMethodCallPosition(e,[],"switch",this.getCurrentPosition()),this.expect(f.rightBracket);let i=this.getCurrentPosition();this.expect(f.leftCurlyBracket,!0);let n={type:f.keywordSwitch,position:e,scopeFrom:i,scopeTo:null,condition:t,caseNodes:[]},s=!1;for(;this.tt==f.keywordCase||this.tt==f.keywordDefault;){let a=this.getCurrentPosition(),l=this.tt==f.keywordDefault;l&&(s?this.pushError("Eine switch-Anweisung darf nur maximal einen default-Zweig haben.","error",a):s=!0),this.nextToken();let o=null;l||(o=this.parseUnary()),this.expect(f.colon,!0);let u=[];for(;this.tt!=f.rightCurlyBracket&&this.tt!=f.endofSourcecode&&this.tt!=f.keywordCase&&this.tt!=f.keywordDefault;){let d=this.pos,p=this.parseStatement();p!=null&&(u=u.concat(p)),d==this.pos&&(this.pushError(this.cct.value+" wird hier nicht erwartet."),this.nextToken())}let h={type:f.keywordCase,position:a,caseTerm:o,statements:u};n.caseNodes.push(h)}return n.scopeTo=this.getEndOfCurrentToken(),this.expect(f.rightCurlyBracket,!0),[n]}return null}parseIf(){let e=this.getCurrentPosition();if(this.nextToken(),this.expect(f.leftBracket,!0)){let t=this.parseTerm(),i=this.getCurrentPosition();this.module.pushMethodCallPosition(e,[],"if",i),this.expect(f.rightBracket,!0),this.tt==f.semicolon&&this.pushError("Falls die Bedingung zutrifft, wird nur der Strichpunkt ausgeführt (leere Anweisung).","warning");let n=this.parseStatement();this.tt==f.semicolon&&this.nextToken();let s=null;return this.comesToken(f.keywordElse)&&(this.nextToken(),s=this.parseStatement()),t==null&&this.errorList.length==0&&(t={type:f.pushConstant,position:this.getCurrentPosition(),constantType:f.booleanConstant,constant:!0}),[{type:f.keywordIf,position:e,condition:t,statementsIfTrue:n,statementsIfFalse:s}]}return[]}parseDo(){let e=this.getCurrentPosition(),t=this.getCurrentPosition();this.nextToken();let i=this.parseStatement();if(this.expect(f.keywordWhile,!0)&&this.expect(f.leftBracket,!0)){let n=this.parseTerm(),s=this.getEndOfCurrentToken();return this.expect(f.rightBracket,!0),[{type:f.keywordDo,position:e,scopeFrom:t,scopeTo:s,condition:n,statements:i}]}return[]}comesGenericType(){return this.ct[1].tt!=f.lower||this.ct[2].tt!=f.identifier?!1:[f.greater,f.lower,f.comma].indexOf(this.ct[3].tt)>=0}parseVariableDeclarationOrTerm(){return(this.tt==f.identifier||this.tt==f.keywordFinal)&&(this.ct[1].tt==f.identifier||this.ct[1].tt==f.leftRightSquareBracket||this.comesGenericType())?this.parseVariableDeclaration():[this.parseTerm()]}parseTerm(){return this.parseTermBinary(0)}parseTermBinary(e){let t;e<It.operatorPrecedence.length-1?t=this.parseTermBinary(e+1):t=this.parsePlusPlusMinusMinus();let i=It.operatorPrecedence[e];if(t==null||i.indexOf(this.tt)<0)return t;let n=!0;for(;n||i.indexOf(this.tt)>=0;){let s=this.tt;n=!1;let a=this.getCurrentPosition();this.nextToken();for(let o of[{op:f.lower,wrong:"=<",right:"<=",correctOp:f.lowerOrEqual},{op:f.greater,wrong:"=>",right:">=",correctOp:f.greaterOrEqual}])if(s==f.assignment&&this.tt==o.op){let u=this.getCurrentPosition();this.pushError(`Den Operator ${o.wrong} gibt es nicht. Du meintest sicher: ${o.right}`,"error",Object.assign({},a,{length:2}),{title:`${o.wrong} durch ${o.right} ersetzen`,editsProvider:h=>[{resource:h,edit:{range:{startLineNumber:a.line,startColumn:a.column,endLineNumber:a.line,endColumn:u.column+u.length},text:o.right}}]}),this.nextToken(),s=o.correctOp}let l;if(e<It.operatorPrecedence.length-1?l=this.parseTermBinary(e+1):l=this.parsePlusPlusMinusMinus(),l!=null){let o=!1;if(this.isConstant(t)&&this.isConstant(l)){let u=t,h=l,d=ah[u.constantType],p=ah[h.constantType],v=d.getResultType(s,p);if(v!=null){o=!0,d==Ge&&p==C&&(u.constant=u.constant.charCodeAt(0)),p==Ge&&d==C&&(h.constant=h.constant.charCodeAt(0));let w=d.compute(s,{type:d,value:u.constant},{type:p,value:h.constant});this.considerIntDivisionWarning(s,d,u.constant,p,h.constant,a),u.constantType=v.toTokenType(),u.constant=w,u.position.length=h.position.column+h.position.length-u.position.column}}o||(t={type:f.binaryOp,position:a,operator:s,firstOperand:t,secondOperand:l})}}return t}considerIntDivisionWarning(e,t,i,n,s,a){e==f.division&&this.isIntegerType(t)&&this.isIntegerType(n)&&s!=0&&i/s!=Math.floor(i/s)&&this.pushError("Da "+i+" und "+s+" ganzzahlige Werte sind, wird diese Division als Ganzzahldivision ausgeführt und ergibt den Wert "+Math.floor(i/s)+". Falls das nicht gewünscht ist, hänge '.0' an einen der Operanden.","info",a)}isIntegerType(e){return e==C}isConstant(e){return e!=null&&e.type==f.pushConstant}parsePlusPlusMinusMinus(){let e=null,t=null;this.comesToken([f.doublePlus,f.doubleMinus])&&(e=this.tt,t=this.getCurrentPosition(),this.nextToken());let i=this.parseUnary();return e!=null&&(i={type:f.incrementDecrementBefore,position:t,operator:e,operand:i}),this.comesToken([f.doublePlus,f.doubleMinus])&&(i={type:f.incrementDecrementAfter,position:this.getCurrentPosition(),operator:this.tt,operand:i},this.nextToken()),i}parseUnary(){let e,t=this.getCurrentPosition();switch(this.tt){case f.leftBracket:return this.parseDotOrArrayChains(this.bracketOrCasting());case f.minus:case f.not:case f.tilde:t=t;let i=this.tt;if(this.nextToken(),e=this.parseUnary(),this.isConstant(e)){let l=e,o=ah[l.constantType],u=o.getResultType(i);if(u!=null){let h=o.compute(i,{type:o,value:l.constant});return l.constantType=u.toTokenType(),l.constant=h,t.length=l.position.column-t.column+1,l}}return{type:f.unaryOp,position:t,operand:e,operator:i};case f.keywordSuper:if(this.ct[1].tt==f.leftBracket){this.nextToken();let l=this.parseMethodCallParameters();return e={type:f.superConstructorCall,position:t,operands:l.nodes,commaPositions:l.commaPositions,rightBracketPosition:l.rightBracketPosition},e}else e={type:f.keywordSuper,position:t};return this.nextToken(),this.parseDotOrArrayChains(e);case f.keywordThis:if(this.ct[1].tt==f.leftBracket){this.nextToken();let l=this.parseMethodCallParameters();return e={type:f.constructorCall,position:t,operands:l.nodes,commaPositions:l.commaPositions,rightBracketPosition:l.rightBracketPosition},e}else e={type:f.keywordThis,position:t};return this.nextToken(),this.parseDotOrArrayChains(e);case f.keywordNew:return this.parseDotOrArrayChains(this.parseNew());case f.integerConstant:case f.charConstant:case f.floatingPointConstant:case f.stringConstant:case f.booleanConstant:case f.longConstant:e={type:f.pushConstant,position:this.getCurrentPosition(),constantType:this.tt,constant:this.cct.value};let n=this.tt==f.stringConstant;return this.nextToken(),n?this.parseDotOrArrayChains(e):e;case f.keywordNull:return e={type:f.pushConstant,position:this.getCurrentPosition(),constantType:f.keywordNull,constant:null},this.nextToken(),e;case f.identifier:let s=this.cct.value,a=this.getCurrentPosition();if(this.nextToken(),this.tt==f.leftBracket){let l=this.parseMethodCallParameters(),o=l.rightBracketPosition;e={type:f.callMethod,position:a,rightBracketPosition:o,operands:l.nodes,object:e,identifier:s,commaPositions:l.commaPositions}}else e={type:f.identifier,identifier:s,position:t};return this.parseDotOrArrayChains(e);default:return this.pushError("Erwartet wird eine Variable, ein Methodenaufruf oder this oder super. Gefunden wurde: "+this.cct.value),null}}bracketOrCasting(){let e=this.getCurrentPosition();if(this.nextToken(),this.tt==f.identifier&&this.ct[1].tt==f.rightBracket&&this.tokensNotAfterCasting.indexOf(this.ct[2].tt)<0){let t=this.parseType(),i=this.getCurrentPosition();e.length=i.column-e.column+1,this.expect(f.rightBracket,!0);let n=this.parsePlusPlusMinusMinus();return{type:f.castValue,position:e,castToType:t,whatToCast:n}}else{let t=this.parseTerm(),i=this.getCurrentPosition();return this.expect(f.rightBracket,!0),this.isConstant(t)?t:{position:i,type:f.rightBracket,termInsideBrackets:t}}}parseNew(){this.nextToken();let e=this.getCurrentPosition();if(this.expect(f.identifier,!1)){let t=this.cct.value,i=this.getCurrentPosition();this.nextToken();let n=null;if(this.tt==f.lower){n=[];let s=!0;for(this.nextToken();s&&this.tt==f.identifier||!s&&this.tt==f.comma;)s||this.nextToken(),s=!1,n.push(this.parseType());this.tt==f.greater?this.nextToken():this.tt==f.shiftRight?this.tt=f.greater:this.tt==f.shiftRightUnsigned?this.tt=f.shiftRight:(this.pushError("Erwartet wird >, gefunden wurde "+this.cct.value+"."),this.nextToken()),n.length==0&&(n=null)}if(this.tt==f.leftSquareBracket||this.tt==f.leftRightSquareBracket){let s={type:f.type,position:e,arrayDimension:0,identifier:t,genericParameterTypes:n};this.typeNodes.push(s);let a=[];for(;this.tt==f.leftSquareBracket||this.tt==f.leftRightSquareBracket;)s.arrayDimension++,this.tt==f.leftRightSquareBracket?(a.push(null),this.nextToken()):(this.nextToken(),a.push(this.parseTerm()),this.expect(f.rightSquareBracket,!0));let l=null;return this.tt==f.leftCurlyBracket&&(l=this.parseArrayLiteral(s)),{type:f.newArray,position:e,arrayType:s,elementCount:a,initialization:l}}else if(this.tt==f.leftBracket){let s=this.parseMethodCallParameters(),a={type:f.type,position:i,arrayDimension:0,identifier:t,genericParameterTypes:n};return this.typeNodes.push(a),{type:f.newObject,position:e,classType:a,constructorOperands:s.nodes,rightBracketPosition:s.rightBracketPosition,commaPositions:s.commaPositions}}else this.pushError("Konstruktoraufruf (also runde Klammer auf) oder Array-Intanzierung (eckige Klammer auf) erwartet.","error",this.getCurrentPosition())}return null}parseArrayLiteral(e){let t=[],i=this.getCurrentPosition(),n=null;if(this.expect(f.leftCurlyBracket,!0),this.tt!=f.rightCurlyBracket){let a=!0;for(;a||this.tt==f.comma;){let l=this.getCurrentPosition();a||this.nextToken(),a=!1;let o;if(this.tt==f.leftCurlyBracket){let u={type:f.type,position:this.getCurrentPosition(),arrayDimension:e.arrayDimension-1,identifier:e.identifier};this.typeNodes.push(u);let h=this.parseArrayLiteral(u);o=h.dimension+1,t.push(h)}else t.push(this.parseTerm()),o=1;n!=null&&n!=o&&this.pushError("Die Dimension dieses Array-Literals ("+(o-1)+" ist ungleich derjenigen der vorangegangenen Array-Literale ("+(n-1)+").","error",l),n=o}}return this.expect(f.rightCurlyBracket,!0),{type:f.arrayInitialization,position:i,arrayType:e,dimension:n,nodes:t}}parseMethodCallParameters(){if(this.nextToken(),this.tt==f.rightBracket){let s=this.getCurrentPosition();return this.nextToken(),{rightBracketPosition:s,nodes:[],commaPositions:[]}}let e=[],t=[];for(;;){let s=this.pos,a=this.parseTerm();if(a!=null&&e.push(a),this.tt!=f.comma)break;t.push(this.getCurrentPosition()),this.nextToken(),this.pos==s&&this.nextToken()}let i=this.getCurrentPosition();return{rightBracketPosition:this.expect(f.rightBracket,!0)?i:null,nodes:e,commaPositions:t}}parseDotOrArrayChains(e){if(e==null)return null;for(;this.comesToken([f.dot,f.leftSquareBracket]);)if(this.tt==f.dot){if(this.nextToken(),this.tt!=f.identifier)return this.pushError("Erwartet wird der Bezeichner eines Attributs oder einer Methode, gefunden wurde: "+this.cct.value),e;let t=this.cct.value,i=this.getCurrentPosition();if(this.nextToken(),this.tt==f.leftBracket){let n=this.parseMethodCallParameters();e={type:f.callMethod,position:i,rightBracketPosition:n.rightBracketPosition,operands:n.nodes,object:e,identifier:t,commaPositions:n.commaPositions}}else e={type:f.pushAttribute,position:i,identifier:t,object:e}}else{let t=e.position;this.nextToken();let i=this.parseTerm(),n=this.getCurrentPosition(),s=Object.assign({},t);this.expect(f.rightSquareBracket,!0),n.line==t.line?s.length=n.column+n.length-s.column:s=n,e={type:f.selectArrayElement,position:s,index:i,object:e}}return e}parseVariableDeclaration(){let e=[],t=!1;this.tt==f.keywordFinal&&(t=!0,this.nextToken());let i=this.parseType();do{let n={...i};if(this.typeNodes.push(n),this.tt!=f.identifier)return this.pushError("Hier wird ein Bezeichner (Name) einer Variable erwartet.","error",this.getCurrentPosition()),[];let s=this.cct.value,a=this.getCurrentPosition();this.nextToken(),this.parseArrayBracketsAfterVariableIdentifier(n);let l=null;if(this.tt==f.assignment&&(this.nextToken(),n.arrayDimension>0&&this.tt==f.leftCurlyBracket?l=this.parseArrayLiteral(n):l=this.parseTerm()),this.tt==f.endofSourcecode&&n==null&&s==null)return[];e.push({type:f.localVariableDeclaration,position:a,identifier:s,variableType:n,initialization:l,isFinal:t})}while(this.expectAndSkipComma());return e}parseArrayBracketsAfterVariableIdentifier(e){if(this.tt==f.leftRightSquareBracket&&e!=null)for(e.arrayDimension>0&&this.pushError("Sowohl vor als auch hinter dem Bezeichner der Variablendeklaration steht []. Eines davon ist zuviel.");this.tt==f.leftRightSquareBracket;)e.arrayDimension++,this.nextToken()}parseType(){if(this.tt!=f.identifier&&this.tt!=f.keywordVoid)return this.pushError("Erwartet wird ein Datentyp. Dieser muss mit einem Bezeichner beginnen. Gefunden wurde: "+this.cct.value,"error",this.getCurrentPosition()),this.nextToken(),{type:f.type,position:this.getCurrentPosition(),arrayDimension:0,identifier:"int",genericParameterTypes:[]};let e=this.cct.value,t=this.getCurrentPosition();this.nextToken();let i=null;if(this.tt==f.lower){i=[];let a=!0;for(this.nextToken();a&&this.tt==f.identifier||!a&&this.tt==f.comma;)a||this.nextToken(),a=!1,i.push(this.parseType());this.tt==f.greater?this.nextToken():this.tt==f.shiftRight?this.tt=f.greater:this.tt==f.shiftRightUnsigned?this.tt=f.shiftRight:(this.pushError("Erwartet wird >, gefunden wurde "+this.cct.value+"."),this.nextToken())}let n=0;for(;this.tt==f.leftRightSquareBracket;)n++,t.length+=2,this.nextToken();let s={type:f.type,position:t,arrayDimension:n,identifier:e,genericParameterTypes:i};return this.typeNodes.push(s),s}parseClassDefinition(){let e=this.cct.commentBefore,t=this.collectModifiers();if(!this.comesToken(It.ClassTokens))return this.pushError("Erwartet wird class, interface oder enum. Gefunden wurde: "+this.cct.value),null;let i=this.tt;if(this.nextToken(),this.expect(f.identifier,!1)){let n=this.cct.value,s=this.getCurrentPosition();this.nextToken();let a=[];this.tt==f.lower&&(a=this.parseTypeParameterDefinition());let l=this.parseExtendsImplements(i==f.keywordInterface);if(i==f.keywordEnum)return this.parseEnum(n,l,s,t.visibility,e);let o=this.getCurrentPosition();if(this.expect(f.leftCurlyBracket,!0)){let u=this.parseClassBody(i,n),h=this.getEndOfCurrentToken();switch(this.expect(f.rightCurlyBracket,!0),i){case f.keywordClass:return{type:f.keywordClass,position:s,scopeFrom:o,scopeTo:h,identifier:n,attributes:u.attributes,methods:u.methods,isAbstract:t.isAbstract,isFinal:t.isFinal,visibility:t.visibility,extends:l.extends,implements:l.implements,typeParameters:a,commentBefore:e};case f.keywordInterface:return{type:f.keywordInterface,position:s,identifier:n,scopeFrom:o,scopeTo:h,methods:u.methods,typeParameters:a,extends:l.implements,commentBefore:e}}}}}parseTypeParameterDefinition(){let e=[],t={};this.expect(f.lower,!0);let i=!0;for(;i&&this.tt==f.identifier||!i&&this.tt==f.comma;){i||this.expect(f.comma,!0);let n={type:f.typeParameter,position:this.getCurrentPosition(),identifier:this.cct.value,extends:null,implements:null};t[n.identifier]!=null&&this.pushError("Zwei Typparameter dürfe nicht denselben Bezeichner tragen."),t[n.identifier]=!0,this.nextToken();let s=this.parseTypeParameterBounds();n.extends=s.extends,n.extends!=null&&n.extends.arrayDimension>0&&this.pushError("Der Datentyp des Typparameters "+n.identifier+" darf kein Array sein."),n.implements=s.implements,n.implements.forEach(a=>{a.arrayDimension>0&&this.pushError("Der Datentyp des Typparameters "+n.identifier+" darf kein Array sein.")}),i=!1,e.push(n)}return this.expect(f.greater,!0),e}parseEnum(e,t,i,n,s){t.extends!=null&&this.pushError("Ein enum kann nicht mit extends erweitert werden."),t.implements.length>0&&this.pushError("Ein enum kann kein Interface implementieren.");let a=this.getCurrentPosition();if(this.expect(f.leftCurlyBracket,!0)){let l=this.parseEnumValues(),o=this.parseClassBody(f.keywordEnum,e),u=this.getEndOfCurrentToken();return this.expect(f.rightCurlyBracket,!0),{type:f.keywordEnum,position:i,scopeFrom:a,scopeTo:u,attributes:o.attributes,methods:o.methods,identifier:e,values:l,visibility:n,commentBefore:s}}return null}parseEnumValues(){let e=[],t=0,i=!0;for(;i&&this.tt==f.identifier||this.tt==f.comma;){if(t=this.pos,i||this.nextToken(),i=!1,this.expect(f.identifier,!1)){let n=this.cct.value,s=this.getCurrentPosition();this.nextToken();let a=null,l=[],o=null;if(this.tt==f.leftBracket){let u=this.parseMethodCallParameters();a=u.nodes,l=u.commaPositions,o=u.rightBracketPosition}e.push({type:f.pushEnumValue,constructorParameters:a,identifier:n,position:s,commaPositions:l,rightBracketPosition:o})}this.pos==t&&this.nextToken()}return this.tt==f.semicolon&&this.nextToken(),e}parseClassBody(e,t){let i=[],n=[];for(;!(this.tt==f.rightCurlyBracket||this.tt==f.endofSourcecode);){let s=this.cct.commentBefore,a=null;this.tt==f.at&&(a=this.cct.value,this.nextToken());let l=this.collectModifiers(),o=!1,u=this.getCurrentPosition();this.tt==f.identifier&&this.cct.value==t&&this.ct[1].tt==f.leftBracket&&(o=!0);let h=this.parseType();if(o&&(h={identifier:"void",arrayDimension:0,position:h.position,type:f.type}),o||this.expect(f.identifier,!1)){let d=t;if(o||(u=this.getCurrentPosition(),d=this.cct.value,this.nextToken()),this.tt==f.leftBracket){o&&e==f.keywordEnum&&l.visibility!=ee.private&&this.pushError("Konstruktoren in enums müssen private sein.","error",u);let p=this.parseMethodDeclarationParameters(),v,w=this.getCurrentPosition(),_=w;if(l.isAbstract)this.expect(f.semicolon,!0),o&&this.pushError("Ein Konstruktor kann nicht abstrakt sein.","error",u),v=[];else if(w=this.getCurrentPosition(),v=this.parseStatement(),this.comesToken(f.leftCurlyBracket)&&(this.pushError("Der Strichpunkt direkt hinter der Methodendeklaration ist für sich genommen die einzige (leere!) Anweisung der Methode. Das ist nicht sinnvoll.","error",w),v=this.parseStatement()),_=this.getEndOfCurrentToken(),v!=null&&v.length>0&&v[0].type==f.scopeNode){let T=v[0];w=T.position,_=T.positionTo}i.push({type:f.methodDeclaration,identifier:d,position:u,scopeFrom:w,scopeTo:_,parameters:p,statements:v,visibility:l.visibility,isAbstract:l.isAbstract||e==f.keywordInterface,isStatic:l.isStatic,isFinal:l.isFinal,isConstructor:o,returnType:h,annotation:a,isTransient:l.isTransient,commentBefore:s})}else{let p=!0;do{let v={...h};this.typeNodes.push(v),p||(this.comesToken(f.identifier)?(u=this.getCurrentPosition(),d=this.cct.value,this.nextToken()):(this.pushError("Hier wird ein weiterer Attributbezeichner erwartet."),this.nextToken())),p=!1,d==t&&this.pushError("Das Attribut "+t+" darf nicht denselben Bezeichner haben wie die Klasse.","error",u),this.parseArrayBracketsAfterVariableIdentifier(v);let w=null;this.tt==f.assignment&&(this.nextToken(),v.arrayDimension>0&&this.tt==f.leftCurlyBracket?w=this.parseArrayLiteral(v):w=this.parseTerm()),n.push({type:f.attributeDeclaration,identifier:d,position:u,attributeType:v,isStatic:l.isStatic,isFinal:l.isFinal,visibility:l.visibility,initialization:w,annotation:a,isTransient:l.isTransient,commentBefore:s}),e==f.keywordInterface&&this.pushError("Interfaces dürfen keine Attribute enthalten.","error",u)}while(this.expectAndSkipComma());this.expect(f.semicolon)}}}return{methods:i,attributes:n}}expectAndSkipComma(){return this.comesToken(f.comma)?(this.nextToken(),!0):!1}parseMethodDeclarationParameters(){let e=[];if(this.nextToken(),this.tt==f.rightBracket)return this.nextToken(),[];let t=!1;for(;;){t&&this.pushError("Nur der letzte Parameter darf als Ellipsis (...) definiert werden.");let i=this.tt==f.keywordFinal;i&&this.nextToken();let n=this.parseType();if(t=this.tt==f.ellipsis,t&&(this.nextToken(),n.arrayDimension++),this.expect(f.identifier,!1)){let s=this.cct.value;e.push({type:f.parameterDeclaration,position:this.getCurrentPosition(),identifier:s,parameterType:n,isFinal:i,isEllipsis:t}),this.nextToken(),this.parseArrayBracketsAfterVariableIdentifier(n)}if(this.tt!=f.comma)break;this.nextToken()}return this.expect(f.rightBracket,!0),e}parseExtendsImplements(e){let t=null,i=[];for(;this.comesToken([f.keywordExtends,f.keywordImplements]);)if(this.comesToken(f.keywordExtends)&&!e&&(t!=null&&this.pushError("Eine Klasse kann nicht Unterklasse von zwei anderen Klassen sein, es darf also hier nur ein Mal 'extends...' stehen.","error",t.position),this.nextToken(),t=this.parseType(),t!=null&&t.arrayDimension>0&&this.pushError("Der Datentyp der Basisklasse darf kein Array sein.","error",t.position)),e&&this.comesToken(f.keywordImplements)&&this.pushError("Wenn ein Interface von einem anderen 'erbt', muss 'extends' verwendet werden.","error"),!e&&this.comesToken(f.keywordImplements)||e&&this.comesToken([f.keywordImplements,f.keywordExtends])){i.length>0&&this.pushError("Es darf hier nur ein Mal 'implements' stehen, hinter 'implements' ist aber eine kommaseparierte Liste von Interfaces erlaubt.","warning"),this.nextToken();let n=!0;for(;n&&this.tt==f.identifier||!n&&this.tt==f.comma;)n||this.nextToken(),n=!1,i.push(this.parseType())}return i.forEach(n=>{n.arrayDimension>0&&this.pushError(n.identifier+"[] ist kein Interface, sondern ein Array. Array-Datentypen sind hier nicht erlaubt.")}),{extends:t,implements:i}}parseTypeParameterBounds(){let e=null,t=[];for(this.comesToken(f.keywordExtends)&&(this.nextToken(),e=this.parseType());this.comesToken(f.ampersand);)this.nextToken(),t.push(this.parseType());return{extends:e,implements:t}}collectModifiers(){let e=ee.public,t=!1,i=!1,n=!1,s=!1,a=!1,l=!1;for(;!a;)switch(this.tt){case f.keywordPublic:e=ee.public,this.nextToken();break;case f.keywordPrivate:e=ee.private,this.nextToken();break;case f.keywordProtected:e=ee.protected,this.nextToken();break;case f.keywordStatic:i=!0,t&&!l&&(this.pushError("Die Modifier 'abstract' und 'static' können nicht kombiniert werden."),l=!0),this.nextToken();break;case f.keywordAbstract:t=!0,i&&!l&&(this.pushError("Die Modifier 'abstract' und 'static' können nicht kombiniert werden."),l=!0),this.nextToken();break;case f.keywordFinal:n=!0,this.nextToken();break;case f.keywordTransient:s=!0,this.nextToken();break;default:a=!0}return{isAbstract:t,isStatic:i,visibility:e,isFinal:n,isTransient:s}}};y(It,"assignmentOperators",[f.assignment,f.plusAssignment,f.minusAssignment,f.multiplicationAssignment,f.divisionAssignment,f.moduloAssignment,f.ANDAssigment,f.XORAssigment,f.ORAssigment,f.shiftLeftAssigment,f.shiftRightAssigment,f.shiftRightUnsignedAssigment]),y(It,"operatorPrecedence",[It.assignmentOperators,[f.ternaryOperator],[f.colon],[f.or],[f.and],[f.OR],[f.XOR],[f.ampersand],[f.equal,f.notEqual],[f.keywordInstanceof,f.lower,f.lowerOrEqual,f.greater,f.greaterOrEqual],[f.shiftLeft,f.shiftRight,f.shiftRightUnsigned],[f.plus,f.minus],[f.multiplication,f.division,f.modulo]]),y(It,"TokenTypeToVisibilityMap",{[f.keywordPublic]:ee.public,[f.keywordPrivate]:ee.private,[f.keywordProtected]:ee.protected}),y(It,"forwardToInsideClass",[f.keywordPublic,f.keywordPrivate,f.keywordProtected,f.keywordVoid,f.identifier,f.rightCurlyBracket,f.keywordStatic,f.keywordAbstract,f.keywordClass,f.keywordEnum,f.keywordInterface]),y(It,"ClassTokens",[f.keywordClass,f.keywordEnum,f.keywordInterface]),y(It,"VisibilityTokens",[f.keywordPrivate,f.keywordProtected,f.keywordPublic]),y(It,"BeforeClassDefinitionTokens",It.ClassTokens.concat(It.VisibilityTokens).concat(f.keywordAbstract).concat(It.ClassTokens).concat([f.keywordFinal]));let Ya=It;class lp{constructor(){y(this,"indexToObjectMap");y(this,"valuesToResolve");y(this,"objectToIndexMap");y(this,"nextIndex");y(this,"primitiveTypes",["String","Integer","Double","Boolean","Float","Character"])}toJson(e){this.objectToIndexMap=new Map,this.nextIndex=0;let t=JSON.stringify(this.toJsonObj(e));return this.objectToIndexMap=null,t}toJsonObj(e){let t=e.type,i=e.value;if(i==null)return null;if((t instanceof $||t instanceof Pe)&&this.primitiveTypes.indexOf(t.identifier)<0){if(t instanceof $t)return i.enumValue.ordinal;let n=i;return this.objectToJsonObj(n)}else return t instanceof ze?i.map(s=>this.toJsonObj(s)):e.value}objectToJsonObj(e){let t=this.objectToIndexMap.get(e);if(t!=null)return{"!i":t};t=this.nextIndex++,this.objectToIndexMap.set(e,t);let i=e.class,n={"!k":i.identifier,"!i":t};if(i.module.isSystemModule)return null;for(;i!=null;){let s=!0,a;for(let l of i.attributes)!l.isStatic&&!l.isTransient&&(s&&(s=!1,a={},n[i.identifier]=a),a[l.identifier]=this.toJsonObj(e.attributes[l.index]));i=i.baseClass}return n}fromJson(e,t,i,n){this.indexToObjectMap={},this.valuesToResolve=[];let s=JSON.parse(e),a=this.fromJsonObj(s,t,i,n);for(let l of this.valuesToResolve){let o=this.indexToObjectMap[l.i];o!=null&&(l.v.type=o.type,l.v.value=o.value)}return this.indexToObjectMap=null,this.valuesToResolve=null,a.value}fromJsonObj(e,t,i,n){if(e==null)return{type:t,value:null};if((t instanceof $||t instanceof Pe)&&this.primitiveTypes.indexOf(t.identifier)<0){if(t instanceof $t)return{type:t,value:t.indexToInfoMap[e].object};let s=e;return this.objectFromJsonObj(s,t,i,n)}else return t instanceof ze?{type:t,value:e.map(a=>this.fromJsonObj(a,t.arrayOfType,i,n))}:{type:t,value:e}}objectFromJsonObj(e,t,i,n){let s=e["!k"],a=e["!i"];if(s!=null){let l=i.getType(s).type,o=l,u=n.instantiateObjectImmediately(o);for(;o!=null;){let d=u.attributes,p=e[o.identifier];if(d!=null&&e!=null)for(let v of o.attributes)!v.isStatic&&!v.isTransient&&(d[v.index]=this.fromJsonObj(p[v.identifier],v.type,i,n));o=o.baseClass}let h={type:l,value:u};return this.indexToObjectMap[a]=h,h}else{let l=e["!i"],o=this.indexToObjectMap[l];return o==null?(o={type:t,value:null},this.valuesToResolve.push({v:o,i:l}),o):{type:o.type,value:o.value}}}}const uu=class uu{constructor(e){y(this,"moduleStore");y(this,"classes");y(this,"interfaces");y(this,"enums");y(this,"moduleToTypeParameterListMap",new Map);y(this,"unresolvedTypes");y(this,"genericTypes",[]);y(this,"genericTypesInClassDefinitions",[]);y(this,"typeParameterList",[]);this.main=e}start(e){this.classes=[],this.interfaces=[],this.enums=[],this.unresolvedTypes=new Map,this.moduleStore=e,this.resolveTypesInModules(),this.setupClassesAndInterfaces();let t=this.resolveTypeVariables();this.resolveUnresolvedTypes(!1),this.resolveGenericTypes(t),this.resolveExtendsImplements();let i=this.resolveGenericTypes(this.genericTypes);this.resolveUnresolvedTypes(!0),this.resolveGenericTypes(i),this.setupMethodsAndAttributes(),this.checkDoubleIdentifierDefinition(),this.checkGenericTypesAgainsTypeGuards(),this.setupAttributeIndices()}setupAttributeIndices(){for(let e of this.classes)e.resolvedType.setupAttributeIndicesRecursive(),e.resolvedType.staticClass!=null&&e.resolvedType.staticClass.setupAttributeIndicesRecursive();for(let e of this.enums)e.resolvedType.setupAttributeIndicesRecursive(),e.resolvedType.staticClass!=null&&e.resolvedType.staticClass.setupAttributeIndicesRecursive()}checkGenericTypesAgainsTypeGuards(){for(let e of this.genericTypes){if(e.typeNode.genericParameterTypes==null)continue;let t=e.typeNode.resolvedType;if(t.isGenericVariantFrom!=null){if(t.typeVariables.length!=t.isGenericVariantFrom.typeVariables.length){e.module.errors[2].push({position:e.typeNode.position,text:"Der Generische Typ "+t.isGenericVariantFrom.identifier+" hat "+t.isGenericVariantFrom.typeVariables.length+" Typparameter. Hier wurden aber "+t.typeVariables.length+" angegeben.",level:"error"});continue}for(let i=0;i<t.typeVariables.length;i++){let n=null,s=t.typeVariables[i],a=t.isGenericVariantFrom.typeVariables[i],l=e.typeNode.genericParameterTypes[i];s.scopeFrom=a.scopeFrom,s.scopeTo=a.scopeTo,s.identifier=a.identifier,n="",s.type.hasAncestorOrIs(a.type)||(n+="Die Klasse "+s.type.identifier+" ist keine Unterklasse von "+a.type.identifier+" und pass damit nicht zum Typparamter "+a.identifier+" der Klasse "+t.isGenericVariantFrom.identifier+". ");let o=[];for(let u of a.type.implements)s.type.implementsInterface(u)||o.push(u.identifier);o.length>0&&(n+="Die Klasse "+s.identifier+" implementiert nicht die Interfaces "+o.join(", ")),n!=""&&e.module.errors[2].push({position:l.position,text:"Der angegebene Wert des Typparameters passt nicht zur Definition: "+n,level:"error"})}this.adjustMethodsAndAttributesToTypeParameters(t,uu.WATCHDOG)}}}adjustMethodsAndAttributesToTypeParameters(e,t){if(!(t<=0)&&e!=null&&e.isGenericVariantFrom!=null&&e.typeVariables.length!=0){let i=!1,n=[];for(let s of e.methods){let a=this.getAdjustedMethod(s,e.typeVariables,t-1);i=i||a.altered,n.push(a.newMethod)}if(i&&(e.methods=n),e instanceof $){let s=[],a=new Map,l=!1;for(let o of e.attributes){let u=this.getAdjustedAttribute(o,e.typeVariables,t-1);l=l||u.altered,s.push(u.newAttribute),a.set(o.identifier,u.newAttribute)}l&&(e.attributes=s,e.attributeMap=a),this.adjustMethodsAndAttributesToTypeParameters(e.baseClass,t-1)}else for(let s of e.extends)this.adjustMethodsAndAttributesToTypeParameters(s,t-1)}}getAdjustedAttribute(e,t,i){let n=this.getAdjustedType(e.type,t,!0,i-1);if(n.altered){let s=Object.create(e);return s.type=n.newType,{altered:!0,newAttribute:s}}else return{altered:!1,newAttribute:e}}getAdjustedMethod(e,t,i){let n=this.getAdjustedType(e.returnType,t,!0,i-1),s=!1,a=[];for(let l of e.parameterlist.parameters){let o=this.getAdjustedType(l.type,t,!1,i-1);if(o.altered){s=!0;let u=Object.create(l);u.type=o.newType,a.push(u)}else a.push(l)}if(n.altered||s){let l=Object.create(e);return n.altered&&(l.returnType=n.newType),s&&(l.parameterlist=new g(a)),{altered:!0,newMethod:l}}else return{altered:!1,newMethod:e}}getAdjustedType(e,t,i,n){if(e==null)return{altered:!1,newType:e};if(e.isTypeVariable==!0){for(let s of t)if(s.identifier==e.identifier)return{altered:!0,newType:s.type};return{altered:!1,newType:e}}if((e instanceof $||e instanceof Pe)&&e.typeVariables.length>0){let s=[],a=!1;for(let l of e.typeVariables){let o=this.getAdjustedType(l.type,t,!1,n-1);o.altered?(s.push({identifier:l.identifier,scopeFrom:l.scopeFrom,scopeTo:l.scopeTo,type:o.newType}),a=!0):s.push(l)}if(a){let l=e.clone();return l.typeVariables=s,i&&this.adjustMethodsAndAttributesToTypeParameters(l,n-1),{altered:!0,newType:l}}else return{altered:!1,newType:e}}if(e instanceof ze){let s=this.getAdjustedType(e.arrayOfType,t,i,n-1);return{altered:s.altered,newType:s.altered?new ze(s.newType):e}}return{altered:!1,newType:e}}resolveGenericTypes(e){let t=!1,i=e.slice(0);for(;!t;){t=!0;for(let n=0;n<i.length;n++){let s=i[n];this.resolveGenericType(s)&&(t=!1),(s.typeNode.genericParameterTypes==null||s.typeNode.genericParameterTypesResolved!=null)&&(i.splice(i.indexOf(s),1),n--)}}return i}resolveGenericType(e){if(e.typeNode.genericParameterTypesResolved!=null)return!1;if(e.typeNode.genericParameterTypes==null)return!0;let t=e.typeNode.resolvedType;if(t==null||!(t instanceof Pe||t instanceof $))return e.typeNode.genericParameterTypes=null,!1;if(!t.typeVariablesReady)return!1;let i=[];for(let l=0;l<e.typeNode.genericParameterTypes.length;l++){let o=e.typeNode.genericParameterTypes[l],u=o.resolvedType;if(u==null||o.genericParameterTypes!=null&&o.genericParameterTypesResolved==null)return!1;if(!(u instanceof Pe||u instanceof $))return e.module.errors[2].push({position:o.position,text:"Hier wird ein Interface- oder Klassentyp erwartet. Der Typ "+o.identifier+" ist aber keiner.",level:"error"}),e.typeNode.genericParameterTypes=null,!0;i.push(o.resolvedType)}let n=new Map;if(t.typeVariables.length!=i.length)return e.module.errors[2].push({position:e.typeNode.position,text:(t instanceof $?"Die Klasse ":"Das Interface ")+t.identifier+" hat "+t.typeVariables.length+" Typparameter, hier sind aber "+i.length+" angegeben.",level:"error"}),e.typeNode.genericParameterTypes=null,!0;let s=0;for(let l of i){let o=t.typeVariables[s];if(l instanceof Pe){let h=Wi.clone();h.implements.push(l),l=h}let u={identifier:o.identifier,scopeFrom:o.scopeFrom,scopeTo:o.scopeTo,type:l};n.set(t.typeVariables[s].type,u.type),s++}let a=this.propagateTypeParameterToBaseClassesAndImplementedInterfaces(t,n);return e.typeNode.resolvedType=a,e.typeNode.genericParameterTypesResolved=!0,!0}propagateTypeParameterToBaseClassesAndImplementedInterfaces(e,t){if(e instanceof $){let i=e.clone();i.typeVariables=[];for(let s of e.typeVariables){let a=t.get(s.type),l=s;a!=null&&(l={identifier:s.identifier,scopeFrom:s.scopeFrom,scopeTo:s.scopeTo,type:a}),i.typeVariables.push(l)}let n=e.baseClass;n!=null&&n.isGenericVariantFrom!=null&&i.setBaseClass(this.propagateTypeParameterToBaseClassesAndImplementedInterfaces(n,t)),i.implements=[];for(let s of e.implements)s.isGenericVariantFrom==null?i.implements.push(s):i.implements.push(this.propagateTypeParameterToBaseClassesAndImplementedInterfaces(s,t));return i}else{let i=e.clone();i.typeVariables=[];for(let n of e.typeVariables){let s=t.get(n.type),a=n;s!=null&&(a={identifier:n.identifier,scopeFrom:n.scopeFrom,scopeTo:n.scopeTo,type:s}),i.typeVariables.push(a)}i.extends=[];for(let n of e.extends)n.isGenericVariantFrom==null?i.extends.push(n):i.extends.push(this.propagateTypeParameterToBaseClassesAndImplementedInterfaces(n,t));return i}}checkDoubleIdentifierDefinition(){let e=new Map,t=this.moduleStore.getJavaModules(!0);for(let n of t)for(let s of n.typeStore.typeList){let a=e.get(s.identifier);if(a!=null){n.errors[1].push({text:"Der Typbezeichner "+s.identifier+" wurde mehrfach definiert, nämlich in den Modulen "+n.file.name+" und "+a.file.name+".",position:s.declaration.position,level:"error"});let l=a.typeStore.getType(s.identifier);l!=null&&!a.isSystemModule&&a.errors[1].push({text:"Der Typbezeichner "+s.identifier+" wurde mehrfach definiert, nämlich in den Modulen "+a.file.name+" und "+n.file.name+".",position:l.declaration.position,level:"error"})}else e.set(s.identifier,n)}let i=this.moduleStore.getBaseModule();for(let n of this.typeParameterList){let s=n.ci.module,a=e.get(n.tpn.identifier);if(a==null&&i.typeStore.getType(n.tpn.identifier)!=null&&(a=i),a!=null){s.errors[1].push({text:"Der Typbezeichner "+n.tpn.identifier+" wurde mehrfach definiert, nämlich in den Modulen "+s.file.name+" und "+a.file.name+".",position:n.tpn.position,level:"error"});let l=a.typeStore.getType(n.tpn.identifier);l!=null&&a!=i&&a.errors[1].push({text:"Der Typbezeichner "+n.tpn.identifier+" wurde mehrfach definiert, nämlich in den Modulen "+a.file.name+" und "+s.file.name+".",position:l.declaration.position,level:"error"})}}}resolveUnresolvedTypes(e){for(let t of this.moduleStore.getJavaModules(!1)){let i=this.unresolvedTypes.get(t),n=[];for(let s of i)this.resolveType(s,t,e)||n.push(s);this.unresolvedTypes.set(t,n)}}addFromJsonMethod(e){let t=this.main.getInterpreter();e.addMethod(new m("fromJson",new g([{identifier:"jsonString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),e,i=>{let n=i[1].value;return new lp().fromJson(n,e,this.moduleStore,t)},!1,!0,`Konvertiert eine Json-Zeichenkette in ein ${e.identifier}-Objekt ("deserialisieren"). Vor dem Deserialisieren eines Objekts werden die Attributinitialisierer angewandt und - falls vorhanden - ein parameterloser Konstruktor ausgeführt. Der Algorithmus kommt auch mit zyklischen Objektreferenzen zurecht.`,!1))}addToJsonMethod(e){e.addMethod(new m("toJson",new g([]),F,t=>new lp().toJson(t[0]),!1,!1,"Konvertiert ein Objekt (rekursiv mitsamt referenzierter Objekte) in eine Json-Zeichenkette. Nicht konvertiert werden Systemklassen (außer: ArrayList) sowie mit dem Schlüsselwort transient ausgezeichnete Attribute."))}setupMethodsAndAttributes(){let e=[];e=e.concat(this.classes),e=e.concat(this.enums);for(let t of e){for(let i of t.methods){let n=this.setupMethod(i,t.resolvedType.module,t.resolvedType);n!=null&&(i.commentBefore!=null&&(n.documentation=""+i.commentBefore.value),t.resolvedType.addMethod(n))}this.addFromJsonMethod(t.resolvedType),this.addToJsonMethod(t.resolvedType);for(let i of t.attributes){this.resolveType(i.attributeType,t.resolvedType.module,!0);let n=i.attributeType.resolvedType;if(n==null)continue;let s=new ce(i.identifier,n,null,i.isStatic,i.visibility,i.isFinal);i.resolvedType=s,i.commentBefore!=null&&(s.documentation=""+i.commentBefore.value),s.annotation=i.annotation,s.isTransient=i.isTransient,t.resolvedType.attributeMap.get(s.identifier)!=null&&t.resolvedType.module.errors[2].push({text:"Es darf nicht mehrere Attribute mit demselben Bezeichner '"+s.identifier+"' in derselben Klassse geben.",position:i.position,level:"error"}),t.resolvedType.addAttribute(s),this.pushUsagePosition(t.resolvedType.module,i.position,s),s.declaration={module:t.resolvedType.module,position:i.position}}}for(let t of this.interfaces)for(let i of t.methods){let n=this.setupMethod(i,t.resolvedType.module,t.resolvedType);n!=null&&t.resolvedType.addMethod(n)}}setupMethod(e,t,i){let n=!0;n=n&&this.resolveType(e.returnType,t,!0);let s=[];for(let l of e.parameters)if(n=n&&this.resolveType(l.parameterType,t,!0),n){let o={definition:l.position,identifier:l.identifier,usagePositions:new Map,type:l.parameterType.resolvedType,declaration:{module:t,position:l.position},isFinal:l.isFinal,isEllipsis:l.isEllipsis};s.push(o),this.pushUsagePosition(t,l.position,o)}let a=new g(s);if(n){let l=new m(e.identifier,a,e.returnType.resolvedType,null,e.isAbstract,e.isStatic);return l.isConstructor=e.identifier==i.identifier,l.isFinal=e.isFinal,l.visibility=e.visibility,l.isConstructor=e.isConstructor,e.resolvedType=l,l.annotation=e.annotation,this.pushUsagePosition(t,e.position,l),l.declaration={module:t,position:e.position},l}return null}pushUsagePosition(e,t,i){if(e.addIdentifierPosition(t,i),i instanceof ut)return;let n=i.usagePositions.get(e);n==null&&(n=[],i.usagePositions.set(e,n)),n.push(t)}resolveType(e,t,i){if(e.resolvedType==null){let n=this.moduleStore.getType(e.identifier);if(n!=null){let a=n.type;return t.dependsOnModules.set(n.module,!0),this.pushUsagePosition(t,e.position,a),a=ad(a,e.arrayDimension),this.registerGenericType(e,t,!1),e.resolvedType=a,!0}let s=this.moduleToTypeParameterListMap.get(t);if(s!=null){for(let a of s)if(a.identifier==e.identifier){let l=e.position;if((l.line>a.scopeFrom.line||l.line==a.scopeFrom.line&&l.column>=a.scopeFrom.column)&&(l.line<a.scopeTo.line||l.line==a.scopeTo.line&&l.column<=a.scopeTo.column))return this.pushUsagePosition(t,e.position,a.type),e.resolvedType=a.type,!0}}if(i){let a=e.identifier.length>0&&e.identifier[0].toUpperCase()==e.identifier[0]?"Die Klasse":"Der Typ";t.errors[2].push({position:e.position,text:a+" "+e.identifier+" konnte nicht gefunden werden."+(e.identifier=="string"?" Meinten Sie String (großgeschrieben)?":""),level:"error",quickFix:e.identifier=="string"?{title:"String groß schreiben",editsProvider:l=>[{resource:l,edit:{range:{startLineNumber:e.position.line,startColumn:e.position.column-1,endLineNumber:e.position.line,endColumn:e.position.column+6},text:"String"}}]}:null})}return e.resolvedType=null,!1}return!0}resolveExtendsImplements(){let e=this.moduleStore.getType("Object").type;for(let t of this.classes){let i=t.resolvedType;for(let n of t.implements){this.resolveType(n,i.module,!0);let s=n.resolvedType;if(s!=null){if(!(s instanceof Pe)){i.module.errors[2].push({position:n.position,text:"Der Typ "+n.identifier+" ist kein interface, darf also nicht bei implements... stehen.",level:"error"});continue}i.implements.push(s),n.resolvedType=s}}if(t.extends!=null){this.resolveType(t.extends,i.module,!0);let n=t.extends.resolvedType;if(n==null||!(n instanceof $)){i.module.errors[2].push({position:t.extends.position,text:"Der Typ "+t.extends.identifier+" ist keine Klasse, darf also nicht hinter extends stehen.",level:"error"});continue}n.hasAncestorOrIs(i)?(i.module.errors[2].push({position:t.extends.position,text:"Der Typ "+t.identifier+" erbt von "+n.identifier+", ist aber selbst in dessen Oberklassenhierarchie enthalten.",level:"error"}),i.setBaseClass(e),t.extends.resolvedType=e):(i.setBaseClass(n),t.extends.resolvedType=n)}else i.setBaseClass(this.moduleStore.getType("Object").type)}for(let t of this.interfaces){let i=t.resolvedType;for(let n of t.extends){this.resolveType(n,i.module,!0);let s=n.resolvedType;if(s!=null){if(!(s instanceof Pe)){i.module.errors[2].push({position:n.position,text:"Der Typ "+n.identifier+" ist kein interface, darf also nicht bei extends... stehen.",level:"error"});continue}i.extends.push(s),n.resolvedType=s}}}}setupClassesAndInterfaces(){for(let e of this.moduleStore.getJavaModules(!1))if(e.classDefinitionsAST!=null)for(let t of e.classDefinitionsAST)switch(t.type){case f.keywordClass:this.classes.push(t);let i=new $(t.identifier,e);if(t.commentBefore!=null&&(i.documentation=""+t.commentBefore.value),t.resolvedType=i,i.visibility=t.visibility,i.isAbstract=t.isAbstract,i.isFinal=t.isFinal,e.typeStore.addType(i),this.pushUsagePosition(e,t.position,i),i.declaration={module:e,position:t.position},this.registerTypeVariables(t,i),t.extends!=null&&this.registerGenericType(t.extends,e,!0),t.implements!=null)for(let a of t.implements)this.registerGenericType(a,e,!0);break;case f.keywordEnum:this.enums.push(t);let n=new $t(t.identifier,e,t.values);t.commentBefore!=null&&(n.documentation=""+t.commentBefore.value),t.resolvedType=n,n.visibility=t.visibility,e.typeStore.addType(n),this.pushUsagePosition(e,t.position,n),n.declaration={module:e,position:t.position};break;case f.keywordInterface:this.interfaces.push(t);let s=new Pe(t.identifier,e);if(t.commentBefore!=null&&(s.documentation=""+t.commentBefore.value),t.resolvedType=s,e.typeStore.addType(s),this.pushUsagePosition(e,t.position,s),s.declaration={module:e,position:t.position},this.registerTypeVariables(t,s),t.extends!=null)for(let a of t.extends)this.registerGenericType(a,e,!0);break}}resolveTypeVariables(){let e=this.typeParameterList.slice(0),t=!1,i=this.genericTypesInClassDefinitions.slice(0);for(;!t;){this.resolveUnresolvedTypes(!1),i=this.resolveGenericTypes(i),t=!0;for(let n=0;n<e.length;n++){let s=e[n],a=!0,l=s.tpn.extends==null?[]:[s.tpn.extends];s.tpn.implements!=null&&(l=l.concat(s.tpn.implements));for(let o of l)o.genericParameterTypes!=null&&o.genericParameterTypesResolved!=!0&&(a=!1);a&&(this.resolveTypeVariable(s),e.splice(e.indexOf(s),1),n--,t=!1)}}return i}resolveTypeVariable(e){let t;if(e.tpn.extends!=null&&e.tpn.extends.resolvedType!=null?t=e.tpn.extends.resolvedType.clone():t=Wi.clone(),t.identifier=e.tpn.identifier,t.isTypeVariable=!0,t.declaration={module:e.ci.module,position:e.tpn.position},e.tpn.implements!=null)for(let s of e.tpn.implements)t.implements.indexOf(s.resolvedType)<0&&t.implements.push(s.resolvedType);let i={identifier:e.tpn.identifier,type:t,scopeFrom:e.cdn.position,scopeTo:e.cdn.scopeTo};e.ci.typeVariables[e.index]=i,e.ci.typeVariablesReady=!0;for(let s of e.ci.typeVariables)s==null&&(e.ci.typeVariablesReady=!1);let n=this.moduleToTypeParameterListMap.get(e.ci.module);n==null&&(n=[],this.moduleToTypeParameterListMap.set(e.ci.module,n)),n.push(i),this.pushUsagePosition(e.ci.module,e.tpn.position,t)}registerTypeVariables(e,t){let i=0;for(let n of e.typeParameters){if(n.extends!=null&&this.registerGenericType(n.extends,t.module,!0),n.implements!=null)for(let s of n.implements)this.registerGenericType(s,t.module,!0);t.typeVariablesReady=!1,t.typeVariables.push(null),this.typeParameterList.push({tpn:n,tp:{identifier:n.identifier,type:null,scopeFrom:e.position,scopeTo:e.scopeTo},ci:t,cdn:e,index:i++})}}resolveTypesInModules(){for(let e of this.moduleStore.getJavaModules(!1)){let t=[];this.unresolvedTypes.set(e,t);for(let i of e.typeNodes)if(i.resolvedType==null){let n=this.moduleStore.getType(i.identifier);if(n!=null){let s=n.type;this.pushUsagePosition(e,i.position,s),i.resolvedType=ad(s,i.arrayDimension),this.registerGenericType(i,e,!1)}else t.push(i)}}}registerGenericType(e,t,i){if(e.genericParameterTypes!=null)i?this.genericTypesInClassDefinitions.push({typeNode:e,module:t}):this.genericTypes.push({typeNode:e,module:t});else{let n=e.resolvedType;if(n!=null&&n instanceof $&&n.typeVariables.length>0){let s=n.clone();s.typeVariables=[],e.resolvedType=s}}}};y(uu,"WATCHDOG",5);let sd=uu;function ad(r,e){for(;e>0;)r=new ze(r),e--;return r}class Mi{static fileTypeToIconClass(e){for(let t of this.filetypes)if(t.file_type==e)return t.iconclass;return"java"}static suffixToFileType(e){for(let t of this.filetypes)if(t.suffix==e)return t;return this.filetypes[0]}static filenameToFileType(e){for(let t of this.filetypes)if(e.endsWith(t.suffix))return t;return this.filetypes[0]}}y(Mi,"filetypes",[{name:"Java-Quelltext",file_type:0,iconclass:"java",language:"myJava",suffix:".java"},{name:"Textdatei",file_type:1,iconclass:"text",language:"text",suffix:".txt"},{name:"JSON-Datei",file_type:1,iconclass:"json",language:"json",suffix:".json"},{name:"XML-Datei",file_type:1,iconclass:"xml",language:"xml",suffix:".xml"},{name:"CSV-Datei",file_type:1,iconclass:"csv",language:"csv",suffix:".csv"},{name:"Markup",file_type:1,iconclass:"md",language:"md",suffix:".md"}]);var Za=(r=>(r[r.compiling=0]="compiling",r[r.error=1]="error",r[r.compiledButNothingToRun=2]="compiledButNothingToRun",r[r.readyToRun=3]="readyToRun",r))(Za||{});class um{constructor(e){y(this,"compilerStatus",2);y(this,"atLeastOneModuleIsStartable");this.main=e}compile(e){var p,v;this.compilerStatus=0;let t=performance.now();e.clearUsagePositions();let i=new fc,n=e.getModules(!1).filter(w=>Mi.filenameToFileType(w.file.name).file_type==0);e.getModules(!1).filter(w=>Mi.filenameToFileType(w.file.name).file_type!=0).forEach(w=>{w.isStartable=!1,w.errors=[],w.file.dirty=!1});for(let w of n){w.file.dirty=!1,w.clear();let _=i.lex(w.getProgramTextFromMonacoModel());w.errors[0]=_.errors,w.tokenList=_.tokens,w.bracketError=_.bracketError,w.colorInformation=_.colorInformation,w.file.name==((v=(p=this.main.getCurrentlyEditedModule())==null?void 0:p.file)==null?void 0:v.name)&&this.main.getBottomDiv()!=null&&this.main.getBottomDiv().errorManager.showParenthesisWarning(_.bracketError)}this.main.getSemicolonAngel().startRegistering();let s=new Ya(!1);for(let w of n)s.parse(w);new sd(this.main).start(e);let l=new ko;for(let w of n)l.start(w,e);let o=!0;for(let w of n)w.dependsOnModulesWithErrors=w.hasErrors(),w.dependsOnModulesWithErrors&&(o=!1);let u=!1;for(;!u;){u=!0;for(let w of n)if(!w.dependsOnModulesWithErrors){for(let _ of n)if(w.dependsOnModules.get(_)&&_.dependsOnModulesWithErrors){w.dependsOnModulesWithErrors=!0,u=!1;break}}}this.atLeastOneModuleIsStartable=!1;for(let w of n)w.isStartable=w.hasMainProgram()&&!w.dependsOnModulesWithErrors,w.isStartable&&(this.atLeastOneModuleIsStartable=!0),(!(this.main instanceof Ib)||this.main.config.withFileList)&&w.renderStartButton();this.atLeastOneModuleIsStartable?this.compilerStatus=3:this.compilerStatus=o?1:2;let h=performance.now()-t;h=Math.round(h*100)/100;let d="Compiled in "+h+" ms.";return this.main.getCurrentWorkspace().compilerMessage=d,this.main.getSemicolonAngel().healSemicolons(),null}}class Ja extends ${static getIterator(e,t,i,n){let s=i.typeStore.getType("ListIteratorImpl"),a=new he(s);return a.intrinsicData.IteratorHelper=new Kv(e,t,n),{value:a,type:s}}constructor(e){super("ListIteratorImpl",e);let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Iterator").clone();s.typeVariables=[n],this.implements.push(s),this.addMethod(new m("hasNext",new g([]),P,a=>a[0].value.intrinsicData.IteratorHelper.hasNext(),!1,!1,"Gibt genau dann true zurück, wenn sich noch mindestens ein weiteres Element in der Collection befindet.")),this.addMethod(new m("next",new g([]),i,a=>a[0].value.intrinsicData.IteratorHelper.next(),!1,!1,"Gibt das nächste Element der Collection zurück.")),this.addMethod(new m("remove",new g([]),null,a=>a[0].value.intrinsicData.IteratorHelper.remove(),!1,!1,"Löscht das letzte durch next zurückgegebene Objekt. Diese Methode beeinflusst nicht, welches Element als nächstes durch next zurückgegeben wird."))}}class Kv{constructor(e,t,i){y(this,"nextPos");switch(this.listHelper=e,this.interpreter=t,this.kind=i,i){case"ascending":this.nextPos=0;break;case"descending":this.nextPos=e.objectArray.length-1;break}}remove(){switch(this.kind){case"ascending":this.nextPos==0?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl noch nie next() aufgerufen wurde."):this.nextPos>this.listHelper.objectArray.length-1?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."):(this.listHelper.valueArray.splice(this.nextPos-1,1),this.listHelper.objectArray.splice(this.nextPos-1,1),this.nextPos-=1);break;case"descending":this.nextPos==this.listHelper.objectArray.length-1?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl noch nie next() aufgerufen wurde."):this.nextPos<0?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."):(this.listHelper.valueArray.splice(this.nextPos+1,1),this.listHelper.objectArray.splice(this.nextPos+1,1),this.nextPos+=1);break}}next(){switch(this.kind){case"ascending":return this.nextPos>this.listHelper.objectArray.length-1?(this.interpreter.throwException("Die Methode next() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."),null):this.listHelper.objectArray[this.nextPos++].value;case"descending":return this.nextPos<0?(this.interpreter.throwException("Die Methode next() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."),null):this.listHelper.objectArray[this.nextPos--].value}}hasNext(){switch(this.kind){case"ascending":return this.nextPos<this.listHelper.objectArray.length;case"descending":return this.nextPos>=0}}}function qv(r){if(typeof r=="string")return F;if(typeof r=="number")return Number.isInteger(r)?C:G;if(typeof r=="boolean")return P;if(r instanceof he)return r.class}class Yv extends ${constructor(e){super("ArrayList",e,"Liste mit Zugriff auf das n-te Objekt in konstanter Zeit, Einfügen in konstanter Zeit und Suchen in linearer Zeit");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=e.typeStore.getType("Collection"),n=t.clone();n.identifier="A",n.isTypeVariable=!0;let s={identifier:"A",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:n};this.typeVariables.push(s);let a=e.typeStore.getType("List").clone();a.typeVariables=[s],this.implements.push(a);let l=e.typeStore.getType("Iterator").clone();l.typeVariables=[s],this.addMethod(new m("ArrayList",new g([]),null,o=>{let u=o[0].value,h=new cl(u,e.main.getInterpreter(),e);u.intrinsicData.ListHelper=h},!1,!1,"Instanziert eine neue ArrayList",!0)),this.addMethod(new m("iterator",new g([]),l,o=>{let h=o[0].value.intrinsicData.ListHelper;return Ja.getIterator(h,h.interpreter,e,"ascending").value},!0,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück.")),this.addMethod(new m("add",new g([{identifier:"element",type:n,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.ListHelper.add(h)},!1,!1,"Fügt der Liste ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Liste dadurch geändert hat.")),this.addMethod(new m("set",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"element",type:n,declaration:null,usagePositions:null,isFinal:!0}]),n,o=>{let u=o[0].value,h=o[1].value,d=o[2];return u.intrinsicData.ListHelper.set(h,d)},!1,!1,"Ersetzt das Element an Position index der Liste durch das übergebene Element; gibt das vorherige Element zurück.")),this.addMethod(new m("add",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"element",type:n,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1].value,d=o[2];return u.intrinsicData.ListHelper.add(d,h)},!1,!1,"Fügt das Element an der Position index der Liste ein. Tipp: Das erste Element der Liste hat index == 0.")),this.addMethod(new m("get",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),n,o=>{var p;let u=o[0].value,h=o[1].value;return(p=u.intrinsicData.ListHelper.get(h))==null?void 0:p.value},!1,!1,"Gibt das i-te Element der Liste zurück.")),this.addMethod(new m("remove",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=o[1].value;return u.intrinsicData.ListHelper.remove(h),null},!0,!1,"Entfernt das Element an der Stelle index. WICHTIG: Das erste Element hat den Index 0. Es ist 0 <= index < size()")),this.addMethod(new m("indexOf",new g([{identifier:"o",type:n,declaration:null,usagePositions:null,isFinal:!0}]),C,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.ListHelper.indexOf(h)},!0,!1,"Gibt den Index des Elements o zurück. Gibt -1 zurück, wenn die Liste das Element o nicht enthält. WICHTIG: Das erste Element hat den Index 0, das letzte den Index size() - 1. ")),this.addMethod(new m("addAll",new g([{identifier:"c",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1].value;return u.intrinsicData.ListHelper.addAll(h)},!0,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,o=>o[0].value.intrinsicData.ListHelper.clear(),!0,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:n,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.ListHelper.contains(h)},!0,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:n,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.ListHelper.removeObject(h)},!0,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,o=>o[0].value.intrinsicData.ListHelper.isEmpty(),!0,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,o=>o[0].value.intrinsicData.ListHelper.size(),!0,!1,"Gibt die Anzahl der Elemente der Collection zurück.")),this.addMethod(new m("toString",new g([]),F,o=>o[0].value.intrinsicData.ListHelper.to_String(),!1,!1))}}class cl{constructor(e,t,i){y(this,"valueArray",[]);y(this,"objectArray",[]);this.runtimeObject=e,this.interpreter=t,this.module=i}allElementsPrimitive(){for(let e of this.valueArray)if(!(e.type instanceof ut||["String","_Double","Integer","Boolean","Character"].indexOf(e.type.identifier)>=0))return!1;return!0}to_String(){if(this.allElementsPrimitive())return"["+this.objectArray.map(a=>""+a).join(", ")+"]";let e={line:1,column:1,length:1},t=[{type:f.noOp,position:e,stepFinished:!1},{type:f.pushConstant,dataType:F,value:"[",position:e,stepFinished:!1}],i=new g([]);for(let a=0;a<this.valueArray.length;a++){let l=this.valueArray[a];l.value==null||l.type instanceof ut||l.type instanceof Xa?t.push({type:f.pushConstant,dataType:F,value:l.value==null?"null":l.type.castTo(l,F).value,position:e,stepFinished:!1}):(t.push({type:f.pushConstant,dataType:l.type,value:l.value,stepFinished:!1,position:e}),t.push({type:f.callMethod,method:l.type.getMethod("toString",i),isSuperCall:!1,stackframeBegin:-1,stepFinished:!1,position:e})),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),a<this.valueArray.length-1&&(t.push({type:f.pushConstant,dataType:F,value:", ",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}))}t.push({type:f.pushConstant,dataType:F,value:"]",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),t.push({type:f.return,copyReturnValueToStackframePos0:!0,leaveThisObjectOnStack:!1,stepFinished:!1,position:e,methodWasInjected:!0});let n={module:this.module,statements:t,labelManager:null},s=new m("toString",new g([]),F,n,!1,!1);return this.interpreter.runTimer(s,[],()=>{},!0),""}addAll(e){if(e.intrinsicData.ListHelper instanceof cl){let i=e.intrinsicData.ListHelper;return i!=null&&(this.valueArray=this.valueArray.concat(i.valueArray.map(n=>({type:n.type,value:n.value}))),this.objectArray=this.objectArray.concat(i.objectArray)),!0}let t=e.class.getMethod("iterator",new g([]));if(t==null)return this.interpreter.throwException("Der an die Methode addAll übergebene Paramter besitzt keine Methode iterator()."),!1;if(t.invoke){let i=t.invoke([{value:e,type:e.class}]),n=i.class.getMethod("next",new g([])),s=i.class.getMethod("hasNext",new g([]));n.returnType;let a={value:i,type:i.class};for(;s.invoke([a]);){let l=n.invoke([a]);this.objectArray.push(l),this.valueArray.push({value:l,type:qv(l)})}return}else{let i=this.execute(t,[{value:e,type:e.class}]);if(i.error!=null)return this.interpreter.throwException("Fehler beim holen des Iterators."),!1;let n=i.value.value,s=n.class.getMethod("next",new g([])),a=n.class.getMethod("hasNext",new g([])),l=s.returnType,o={value:n,type:n.class};for(;;){let u=this.execute(a,[o]);if(u.error!=null)return this.interpreter.throwException("Fehler beim Ausführen der hasNext-Methode"),!1;if(u.value.value!=!0)break;let h=this.execute(s,[o]);if(h.error!=null)return this.interpreter.throwException("Fehler beim Ausführen der next-Methode"),!1;let d=h.value.value;this.objectArray.push(d),this.valueArray.push({value:d,type:l})}return!0}}execute(e,t){return e.invoke?{value:{value:e.invoke([]),type:e.returnType},error:null}:this.interpreter.executeImmediatelyInNewStackframe(e.program,t)}get(e){return e>=0&&e<this.valueArray.length?this.valueArray[e]:(this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". "),null)}remove(e){return e>=0&&e<this.valueArray.length?(this.valueArray.splice(e,1),this.objectArray.splice(e,1),null):(this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". "),null)}add(e,t){return t==null?(this.valueArray.push({type:e.type,value:e.value}),this.objectArray.push(e.value)):t<=this.objectArray.length&&t>=0?(this.valueArray.splice(t,0,{type:e.type,value:e.value}),this.objectArray.splice(t,0,e.value)):this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". "),!0}set(e,t){if(e<this.objectArray.length&&e>=0){let i=this.objectArray[e];return this.valueArray[e]={type:t.type,value:t.value},this.objectArray[e]=t.value,i}else this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". ");return!0}pop(){return this.objectArray.length==0?(this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". "),null):(this.valueArray.pop(),this.objectArray.pop())}peek(){return this.objectArray.length==0?(this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". "),null):this.objectArray[this.objectArray.length-1]}indexOf(e){return this.objectArray.indexOf(e.value)}size(){return this.objectArray.length}isEmpty(){return this.valueArray.length==0}removeObject(e){let t=this.objectArray.indexOf(e.value);t>=0&&(this.objectArray.splice(t,1),this.valueArray.splice(t,1))}contains(e){return this.objectArray.indexOf(e.value)>=0}clear(){this.valueArray=[],this.objectArray=[]}peek_last_or_null(){return this.objectArray.length==0?null:this.objectArray[this.objectArray.length-1]}peek_first_or_null(){return this.objectArray.length==0?null:this.objectArray[0]}removeLast_or_error(){return this.objectArray.length==0?null:(this.valueArray.pop(),this.objectArray.pop())}addLast(e){return this.valueArray.push({type:e.type,value:e.value}),this.objectArray.push(e.value),!0}addFirst(e){return this.valueArray.splice(0,0,{type:e.type,value:e.value}),this.objectArray.splice(0,0,e.value),!0}removeFirstOccurrence(e){let t=this.objectArray.indexOf(e.value);return t>=0?(this.valueArray.splice(t,1),this.objectArray.splice(t,1),!0):!1}peek_or_null(){return this.objectArray.length==0?null:this.objectArray[this.objectArray.length-1]}poll_or_null(){return this.objectArray.length==0?null:(this.valueArray.pop(),this.objectArray.pop())}removeFirst_or_error(){if(this.objectArray.length==0)this.interpreter.throwException("Der ArrayList-Index ist außerhalb des Intervalls von 0 bis "+(this.valueArray.length-1)+". ");else{let e=this.objectArray[0];return this.objectArray.splice(0,1),this.valueArray.splice(0,1),e}}}class Zv extends Pe{constructor(e){super("Collection",e,"Interface für Listen, Maps, Sets usw. mit Methoden zum Einfügen von Objekten, Zugriff auf Objekte und zur Ermittlung der Anzahl der Objekte");let t=e.typeStore.getType("Object"),i=t.clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Iterable").clone();s.typeVariables=[n],this.extends.push(s),this.addMethod(new m("add",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Fügt der Collection ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Collection dadurch geändert hat.")),this.addMethod(new m("addAll",new g([{identifier:"c",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,null,!0,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:t,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:t,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,null,!0,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,null,!0,!1,"Gibt die Anzahl der Elemente der Collection zurück."))}}class Jv extends Pe{constructor(e){super("Iterable",e,"Interface mit Funktionalität zum iterieren (d.h. Durchlaufen aller Elemente)");let t=e.typeStore.getType("Object").clone();t.identifier="E",t.isTypeVariable=!0;let i={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:t};this.typeVariables.push(i);let n=e.typeStore.getType("Iterator").clone();n.typeVariables=[i],this.addMethod(new m("iterator",new g([]),n,null,!0,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück."))}}class Qv extends Pe{constructor(e){super("Iterator",e);let t=e.typeStore.getType("Object").clone();t.identifier="E",t.isTypeVariable=!0;let i={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:t};this.typeVariables.push(i),this.addMethod(new m("hasNext",new g([]),P,null,!0,!1,"Gibt genau dann true zurück, wenn sich noch mindestens ein weiteres Element in der Collection befindet.")),this.addMethod(new m("next",new g([]),t,null,!0,!1,"Gibt das nächste Element der Collection zurück.")),this.addMethod(new m("remove",new g([]),null,null,!0,!1,"Löscht das letzte durch next zurückgegebene Objekt. Diese Methode beeinflusst nicht, welches Element als nächstes durch next zurückgegeben wird."))}}class ew extends Pe{constructor(e){super("List",e,"Interface mit Methoden einer Liste (d.h. Anfügen von Elementen nur am Ende)");let t=e.typeStore.getType("Object"),i=e.typeStore.getType("Object").clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Collection").clone();s.typeVariables=[n],this.extends.push(s),this.addMethod(new m("get",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),i,null,!0,!1,"Gibt das Element der Liste an der Stelle index zurück. WICHTIG: Das erste Element hat den Index 0. Es ist 0 <= index < size()")),this.addMethod(new m("remove",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!0,!1,"Entfernt das Element an der Stelle index. WICHTIG: Das erste Element hat den Index 0. Es ist 0 <= index < size()")),this.addMethod(new m("indexOf",new g([{identifier:"o",type:t,declaration:null,usagePositions:null,isFinal:!0}]),C,null,!0,!1,"Gibt den Index des Elements o zurück. Gibt -1 zurück, wenn die Liste das Element o nicht enthält. WICHTIG: Das erste Element hat den Index 0, das letzte den Index size() - 1. "))}}class tw extends ${constructor(e){super("Stack",e,"Stack (Stapelspeicher)"),e.typeStore.getType("Object");let t=e.typeStore.getType("Vector");this.setBaseClass(t),this.typeVariables=t.typeVariables;let i=this.typeVariables[0].type;this.addMethod(new m("push",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),i,n=>{let s=n[0].value,a=n[1];return s.intrinsicData.ListHelper.add(a),a.value},!1,!1,"Pushed ein Element oben auf den Stack. Gibt das gerade gepushte Element zurück.")),this.addMethod(new m("pop",new g([]),i,n=>n[0].value.intrinsicData.ListHelper.pop(),!1,!1,"Nimmt das oberste Element vom Stack und gibt es zurück.")),this.addMethod(new m("peek",new g([]),i,n=>n[0].value.intrinsicData.ListHelper.peek(),!1,!1,"Gibt das oberste Element des Stacks zurück, nimmt es aber nicht vom Stack herunter.")),this.addMethod(new m("empty",new g([]),P,n=>n[0].value.intrinsicData.ListHelper.isEmpty(),!0,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("search",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),C,n=>{let s=n[0].value,a=n[1],l=s.intrinsicData.ListHelper,o=l.indexOf(a);return o==-1?o:l.objectArray.length-o},!0,!1,"Gibt die Position des Objekts auf dem Stack zurück. Dabei hat das oberste Element den Index 1, das nächstunterste den Index 2 usw. . Falls sich das Objekt nicht auf dem Stack befindet, wird -1 zurückgegeben."))}}class iw extends ${constructor(e){super("Vector",e,"Liste mit Zugriff auf das n-te Element in konstanter Zeit");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="A",i.isTypeVariable=!0;let n={identifier:"A",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("List").clone();s.typeVariables=[n],this.implements.push(s);let a=e.typeStore.getType("Iterator").clone();a.typeVariables=[n],this.addMethod(new m("Vector",new g([]),null,l=>{let o=l[0].value,u=new cl(o,e.main.getInterpreter(),e);o.intrinsicData.ListHelper=u},!1,!1,"Instanziert ein neues Vector-Objekt",!0)),this.addMethod(new m("iterator",new g([]),a,l=>{let u=l[0].value.intrinsicData.ListHelper;return Ja.getIterator(u,u.interpreter,e,"ascending").value},!1,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück.")),this.addMethod(new m("add",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.add(u)},!1,!1,"Fügt der Liste ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Liste dadurch geändert hat.")),this.addMethod(new m("get",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),i,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.get(u).value},!1,!1,"Gibt das i-te Element der Liste zurück.")),this.addMethod(new m("remove",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.remove(u).value,null},!1,!1,"Entfernt das Element an der Stelle index. WICHTIG: Das erste Element hat den Index 0. Es ist 0 <= index < size()")),this.addMethod(new m("indexOf",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),C,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.indexOf(u)},!1,!1,"Gibt den Index des Elements o zurück. Gibt -1 zurück, wenn die Liste das Element o nicht enthält. WICHTIG: Das erste Element hat den Index 0, das letzte den Index size() - 1. ")),this.addMethod(new m("addAll",new g([{identifier:"c",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.addAll(u)},!1,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,l=>l[0].value.intrinsicData.ListHelper.clear(),!1,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.contains(u)},!1,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeObject(u)},!1,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,l=>l[0].value.intrinsicData.ListHelper.isEmpty(),!1,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,l=>l[0].value.intrinsicData.ListHelper.size(),!1,!1,"Gibt die Anzahl der Elemente der Collection zurück."))}}class nw extends Pe{constructor(e){super("Set",e,"Interface mit Methoden eines Set, d.h. einer Menge, die jedes Element maximal einmal enthält");let t=e.typeStore.getType("Object"),i=e.typeStore.getType("Object").clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Collection").clone();s.typeVariables=[n],this.extends.push(s),this.addMethod(new m("contains",new g([{identifier:"o",type:t,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Gibt genau dann true zurück, wenn das Set das Objekt o enthält.")),this.addMethod(new m("containsAll",new g([{identifier:"c",type:s,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Gibt genau dann true zurück, wenn das Set alle Elemente der übergebenen Collection enthält."))}}class gc extends ${static getIterator(e,t,i,n){let s=i.typeStore.getType("SetIteratorImpl"),a=new he(s);return a.intrinsicData.SetIteratorHelper=new rw(e,t,n),{value:a,type:s}}constructor(e){super("SetIteratorImpl",e);let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Iterator").clone();s.typeVariables=[n],this.implements.push(s),this.addMethod(new m("hasNext",new g([]),P,a=>a[0].value.intrinsicData.SetIteratorHelper.hasNext(),!1,!1,"Gibt genau dann true zurück, wenn sich noch mindestens ein weiteres Element in der Collection befindet.")),this.addMethod(new m("next",new g([]),i,a=>a[0].value.intrinsicData.SetIteratorHelper.next(),!1,!1,"Gibt das nächste Element der Collection zurück.")),this.addMethod(new m("remove",new g([]),null,a=>a[0].value.intrinsicData.SetIteratorHelper.remove(),!1,!1,"Löscht das letzte durch next zurückgegebene Objekt. Diese Methode beeinflusst nicht, welches Element als nächstes durch next zurückgegeben wird."))}}class rw{constructor(e,t,i){y(this,"nextPos");switch(this.MapHelper=e,this.interpreter=t,this.kind=i,i){case"ascending":this.nextPos=0;break;case"descending":this.nextPos=e.valueArray.length-1;break}}remove(){switch(this.kind){case"ascending":this.nextPos==0?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl noch nie next() aufgerufen wurde."):this.nextPos>this.MapHelper.valueArray.length-1?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."):(this.MapHelper.removeObject(this.MapHelper.valueArray[this.nextPos-1].value),this.nextPos-=1);break;case"descending":this.nextPos==this.MapHelper.valueArray.length-1?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl noch nie next() aufgerufen wurde."):this.nextPos<0?this.interpreter.throwException("Die Methode remove() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."):(this.MapHelper.removeObject(this.MapHelper.valueArray[this.nextPos+1].value),this.nextPos+=1);break}}next(){switch(this.kind){case"ascending":return this.nextPos>this.MapHelper.valueArray.length-1?(this.interpreter.throwException("Die Methode next() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."),null):this.MapHelper.valueArray[this.nextPos++].value;case"descending":return this.nextPos<0?(this.interpreter.throwException("Die Methode next() des Iterators wurde aufgerufen, obwohl das letzte Element schon beim vorherigen Aufruf zurückgegeben worden war."),null):this.MapHelper.valueArray[this.nextPos--].value}}hasNext(){switch(this.kind){case"ascending":return this.nextPos<this.MapHelper.valueArray.length;case"descending":return this.nextPos>=0}}}class hm{constructor(e,t,i){y(this,"valueArray",[]);y(this,"map",new Map);this.runtimeObject=e,this.interpreter=t,this.module=i}allElementsPrimitive(){for(let e of this.valueArray)if(!(e.type instanceof ut||["String","_Double","Integer","Boolean","Character"].indexOf(e.type.identifier)>=0))return!1;return!0}to_String(){if(this.allElementsPrimitive())return"["+this.valueArray.map(a=>""+a.value).join(", ")+"]";let e={line:1,column:1,length:1},t=[{type:f.noOp,position:e,stepFinished:!1},{type:f.pushConstant,dataType:F,value:"[",position:e,stepFinished:!1}],i=new g([]);for(let a=0;a<this.valueArray.length;a++){let l=this.valueArray[a];l.type instanceof ut||l.type instanceof Xa?t.push({type:f.pushConstant,dataType:F,value:l.type.castTo(l,F).value,position:e,stepFinished:!1}):(t.push({type:f.pushConstant,dataType:l.type,value:l.value,stepFinished:!1,position:e}),t.push({type:f.callMethod,method:l.type.getMethod("toString",i),isSuperCall:!1,stackframeBegin:-1,stepFinished:!1,position:e})),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),a<this.valueArray.length-1&&(t.push({type:f.pushConstant,dataType:F,value:", ",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}))}t.push({type:f.pushConstant,dataType:F,value:"]",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),t.push({type:f.return,copyReturnValueToStackframePos0:!0,leaveThisObjectOnStack:!1,stepFinished:!1,position:e,methodWasInjected:!0});let n={module:this.module,statements:t,labelManager:null},s=new m("toString",new g([]),F,n,!1,!1);return this.interpreter.runTimer(s,[],()=>console.log("List.toString fertig!"),!0),""}adAll(e){let t=!1,i=e.intrinsicData.ListHelper;if(i!=null)for(let n of i.valueArray)t=t||this.addToSet(n);return t}addToSet(e){return this.contains(e)?!1:(this.valueArray.push(e),this.map.set(e.value,!0),!0)}size(){return this.valueArray.length}isEmpty(){return this.valueArray.length==0}removeObject(e){if(this.map.get(e.value)==null)return!1;for(let t=0;t<this.valueArray.length;t++)this.valueArray[t].value==e.value&&this.valueArray.splice(t,1);this.map.delete(e.value)}contains(e){return this.map.get(e.value)!=null}clear(){this.valueArray=[],this.map.clear()}}class sw extends ${constructor(e){super("HashSet",e,"Set mit Zugriffszeit proportional zu log(Anzahl der Elemente)");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Set").clone();s.typeVariables=[n],this.implements.push(s);let a=e.typeStore.getType("Iterator").clone();a.typeVariables=[n],this.addMethod(new m("HashSet",new g([]),null,l=>{let o=l[0].value,u=new hm(o,e.main.getInterpreter(),e);o.intrinsicData.ListHelper=u},!1,!1,"Instanziert ein neues HashSet",!0)),this.addMethod(new m("iterator",new g([]),a,l=>{let u=l[0].value.intrinsicData.ListHelper;return gc.getIterator(u,u.interpreter,e,"ascending").value},!1,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück.")),this.addMethod(new m("add",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.addToSet(u)},!1,!1,"Fügt der Liste ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Liste dadurch geändert hat.")),this.addMethod(new m("addAll",new g([{identifier:"c",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.adAll(u)},!1,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,l=>l[0].value.intrinsicData.ListHelper.clear(),!1,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.contains(u)},!1,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeObject(u)},!1,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,l=>l[0].value.intrinsicData.ListHelper.isEmpty(),!1,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,l=>l[0].value.intrinsicData.ListHelper.size(),!1,!1,"Gibt die Anzahl der Elemente der Collection zurück.")),this.addMethod(new m("toString",new g([]),F,l=>l[0].value.intrinsicData.ListHelper.to_String(),!1,!1))}}class aw extends ${constructor(e){super("LinkedHashSet",e,"Ein LinkedHashSet speichert jedes Element nur genau ein Mal.");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Set").clone();s.typeVariables=[n],this.implements.push(s);let a=e.typeStore.getType("Iterator").clone();a.typeVariables=[n],this.addMethod(new m("LinkedHashSet",new g([]),null,l=>{let o=l[0].value,u=new hm(o,e.main.getInterpreter(),e);o.intrinsicData.MapHelper=u},!1,!1,"Instanziert ein neues LinkedHashSet",!0)),this.addMethod(new m("iterator",new g([]),a,l=>{let u=l[0].value.intrinsicData.ListHelper;return gc.getIterator(u,u.interpreter,e,"ascending").value},!1,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück.")),this.addMethod(new m("add",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.addToSet(u)},!1,!1,"Fügt der Liste ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Liste dadurch geändert hat.")),this.addMethod(new m("addAll",new g([{identifier:"c",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.adAll(u)},!1,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,l=>l[0].value.intrinsicData.ListHelper.clear(),!1,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.contains(u)},!1,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeObject(u)},!1,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,l=>l[0].value.intrinsicData.ListHelper.isEmpty(),!1,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,l=>l[0].value.intrinsicData.ListHelper.size(),!1,!1,"Gibt die Anzahl der Elemente der Collection zurück.")),this.addMethod(new m("toString",new g([]),F,l=>l[0].value.intrinsicData.ListHelper.to_String(),!1,!1))}}class lw extends Pe{constructor(e){super("Queue",e);let i=e.typeStore.getType("Object").clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Collection").clone();s.typeVariables=[n],this.extends.push(s),this.addMethod(new m("remove",new g([]),i,null,!0,!1,"Entfernt das Element am Kopf der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("poll",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),i,null,!0,!1,"Entfernt das Element am Kopf der Liste und gibt es zurück. Gibt null zurück, wenn die Liste leer ist.")),this.addMethod(new m("peek",new g([]),i,null,!0,!1,"Gibt das Element am Kopf der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist."))}}class ow extends Pe{constructor(e){super("Deque",e,"Interface für Liste mit zweiseitigem Zugriff (insbesondere Anfügen an beiden Enden)");let i=e.typeStore.getType("Object").clone();i.identifier="E",i.isTypeVariable=!0;let n={identifier:"E",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Queue").clone();s.typeVariables=[n],this.extends.push(s),this.addMethod(new m("removeFirstOccurrence",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Löscht das Erste Vorkommen des Objekts. Gibt true zurück, wenn die Liste dadurch verändert wurde.")),this.addMethod(new m("removeLastOccurrence",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Löscht das Letzte Vorkommen des Objekts. Gibt true zurück, wenn die Liste dadurch verändert wurde.")),this.addMethod(new m("addFirst",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!0,!1,"Fügt das Element am Anfang der Liste hinzu.")),this.addMethod(new m("addLast",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!0,!1,"Fügt das Element am Ende der Liste hinzu.")),this.addMethod(new m("removeFirst",new g([]),i,null,!0,!1,"Entfernt das Element am Anfang der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("removeLast",new g([]),i,null,!0,!1,"Entfernt das Element am Ende der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("peekFirst",new g([]),i,null,!0,!1,"Gibt das Element am Anfang der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist.")),this.addMethod(new m("peekLast",new g([]),i,null,!0,!1,"Gibt das Element am Ende der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist.")),this.addMethod(new m("push",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!0,!1,"Fügt das Element am Ende der Liste hinzu.")),this.addMethod(new m("pop",new g([]),i,null,!0,!1,"Gibt das Element am Ende der Liste zurück und entfernt es von der Liste. Erzeugt einen Fehler, wenn die Liste leer ist."));let a=e.typeStore.getType("Iterator").clone();a.typeVariables=[n],this.addMethod(new m("descendingIterator",new g([]),a,null,!0,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück, der die Liste in umgekehrter Reihenfolge (Ende -> Anfang) durchläuft."))}}class uw extends ${constructor(e){super("LinkedList",e,"Verkettete Liste");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="A",i.isTypeVariable=!0;let n={identifier:"A",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=e.typeStore.getType("Deque").clone();s.typeVariables=[n],this.implements.push(s);let a=e.typeStore.getType("Iterator").clone();a.typeVariables=[n],this.addMethod(new m("LinkedList",new g([]),null,l=>{let o=l[0].value,u=new cl(o,e.main.getInterpreter(),e);o.intrinsicData.ListHelper=u},!1,!1,"Instanziert eine neue LinkedList",!0)),this.addMethod(new m("iterator",new g([]),a,l=>{let u=l[0].value.intrinsicData.ListHelper;return Ja.getIterator(u,u.interpreter,e,"ascending").value},!1,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück.")),this.addMethod(new m("descendingIterator",new g([]),a,l=>{let u=l[0].value.intrinsicData.ListHelper;return Ja.getIterator(u,u.interpreter,e,"descending").value},!1,!1,"Gibt einen Iterator über die Elemente dieser Collection zurück, der die Liste in umgekehrter Reihenfolge durchläuft (Ende -> Anfang).")),this.addMethod(new m("add",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.add(u)},!1,!1,"Fügt der Liste am Ende ein Element hinzu. Gibt genau dann true zurück, wenn sich der Zustand der Liste dadurch geändert hat.")),this.addMethod(new m("addAll",new g([{identifier:"c",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1].value;return o.intrinsicData.ListHelper.addAll(u)},!1,!1,"Fügt alle Elemente von c dieser Collection hinzu.")),this.addMethod(new m("clear",new g([]),null,l=>l[0].value.intrinsicData.ListHelper.clear(),!1,!1,"Entfernt alle Element aus dieser Collection.")),this.addMethod(new m("contains",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.contains(u)},!1,!1,"Testet, ob die Collection das Element enthält.")),this.addMethod(new m("remove",new g([{identifier:"o",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeObject(u)},!1,!1,"Entfernt das Element o aus der Collection. Gibt true zurück, wenn die Collection das Element enthalten hatte.")),this.addMethod(new m("isEmpty",new g([]),P,l=>l[0].value.intrinsicData.ListHelper.isEmpty(),!1,!1,"Testet, ob die Collection das leer ist.")),this.addMethod(new m("size",new g([]),C,l=>l[0].value.intrinsicData.ListHelper.size(),!1,!1,"Gibt die Anzahl der Elemente der Collection zurück.")),this.addMethod(new m("toString",new g([]),F,l=>l[0].value.intrinsicData.ListHelper.to_String(),!1,!1)),this.addMethod(new m("remove",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.removeFirst_or_error(),!1,!1,"Entfernt das Element am Kopf der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("poll",new g([]),i,l=>{let o=l[0].value;return l[1],o.intrinsicData.ListHelper.poll_or_null()},!1,!1,"Entfernt das Element am Kopf der Liste und gibt es zurück. Gibt null zurück, wenn die Liste leer ist.")),this.addMethod(new m("peek",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.peek_or_null(),!1,!1,"Gibt das Element am Kopf der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist.")),this.addMethod(new m("removeFirstOccurrence",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeFirstOccurrence(u)},!1,!1,"Löscht das Erste Vorkommen des Objekts. Gibt true zurück, wenn die Liste dadurch verändert wurde.")),this.addMethod(new m("removeLastOccurrence",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.removeFirstOccurrence(u)},!1,!1,"Löscht das Letzte Vorkommen des Objekts. Gibt true zurück, wenn die Liste dadurch verändert wurde.")),this.addMethod(new m("addFirst",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.addFirst(u)},!1,!1,"Fügt das Element am Anfang der Liste hinzu.")),this.addMethod(new m("addLast",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.addLast(u)},!1,!1,"Fügt das Element am Ende der Liste hinzu.")),this.addMethod(new m("removeFirst",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.removeFirst_or_error(),!1,!1,"Entfernt das Element am Anfang der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("removeLast",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.removeLast_or_error(),!1,!1,"Entfernt das Element am Ende der Liste und gibt es zurück. Führt zum Fehler, wenn die Liste leer ist.")),this.addMethod(new m("peekFirst",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.peek_first_or_null(),!1,!1,"Gibt das Element am Anfang der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist.")),this.addMethod(new m("peekLast",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.peek_last_or_null(),!1,!1,"Gibt das Element am Ende der Liste zurück, entfernt es aber nicht. Gib null zurück, wenn die Liste leer ist.")),this.addMethod(new m("push",new g([{identifier:"element",type:i,declaration:null,usagePositions:null,isFinal:!0}]),null,l=>{let o=l[0].value,u=l[1];return o.intrinsicData.ListHelper.add(u)},!1,!1,"Fügt das Element am Ende der Liste hinzu.")),this.addMethod(new m("pop",new g([]),i,l=>l[0].value.intrinsicData.ListHelper.pop(),!1,!1,"Gibt das Element am Ende der Liste zurück und entfernt es von der Liste. Erzeugt einen Fehler, wenn die Liste leer ist."))}}class hw extends ${constructor(e){super("Console",e,"Klasse zur Textausgabe in der Konsole."),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("log",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!1}]),null,t=>{var i;(i=e.main.getBottomDiv())==null||i.console.$consoleTab.find(".jo_console-top").append("<div>"+t[1].value+"</div>")},!1,!0))}}var Gs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mc(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function dw(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var n=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return r[i]}})}),t}var dm={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */(function(r){(function(e,t){r.exports=e.document?t(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a window with a document");return t(i)}})(typeof window<"u"?window:Gs,function(e,t){var i=[],n=Object.getPrototypeOf,s=i.slice,a=i.flat?function(c){return i.flat.call(c)}:function(c){return i.concat.apply([],c)},l=i.push,o=i.indexOf,u={},h=u.toString,d=u.hasOwnProperty,p=d.toString,v=p.call(Object),w={},_=function(b){return typeof b=="function"&&typeof b.nodeType!="number"&&typeof b.item!="function"},T=function(b){return b!=null&&b===b.window},D=e.document,L={type:!0,src:!0,nonce:!0,noModule:!0};function O(c,b,x){x=x||D;var k,M,E=x.createElement("script");if(E.text=c,b)for(k in L)M=b[k]||b.getAttribute&&b.getAttribute(k),M&&E.setAttribute(k,M);x.head.appendChild(E).parentNode.removeChild(E)}function z(c){return c==null?c+"":typeof c=="object"||typeof c=="function"?u[h.call(c)]||"object":typeof c}var V="3.7.1",Q=/HTML$/i,S=function(c,b){return new S.fn.init(c,b)};S.fn=S.prototype={jquery:V,constructor:S,length:0,toArray:function(){return s.call(this)},get:function(c){return c==null?s.call(this):c<0?this[c+this.length]:this[c]},pushStack:function(c){var b=S.merge(this.constructor(),c);return b.prevObject=this,b},each:function(c){return S.each(this,c)},map:function(c){return this.pushStack(S.map(this,function(b,x){return c.call(b,x,b)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(S.grep(this,function(c,b){return(b+1)%2}))},odd:function(){return this.pushStack(S.grep(this,function(c,b){return b%2}))},eq:function(c){var b=this.length,x=+c+(c<0?b:0);return this.pushStack(x>=0&&x<b?[this[x]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:i.sort,splice:i.splice},S.extend=S.fn.extend=function(){var c,b,x,k,M,E,R=arguments[0]||{},N=1,j=arguments.length,H=!1;for(typeof R=="boolean"&&(H=R,R=arguments[N]||{},N++),typeof R!="object"&&!_(R)&&(R={}),N===j&&(R=this,N--);N<j;N++)if((c=arguments[N])!=null)for(b in c)k=c[b],!(b==="__proto__"||R===k)&&(H&&k&&(S.isPlainObject(k)||(M=Array.isArray(k)))?(x=R[b],M&&!Array.isArray(x)?E=[]:!M&&!S.isPlainObject(x)?E={}:E=x,M=!1,R[b]=S.extend(H,E,k)):k!==void 0&&(R[b]=k));return R},S.extend({expando:"jQuery"+(V+Math.random()).replace(/\D/g,""),isReady:!0,error:function(c){throw new Error(c)},noop:function(){},isPlainObject:function(c){var b,x;return!c||h.call(c)!=="[object Object]"?!1:(b=n(c),b?(x=d.call(b,"constructor")&&b.constructor,typeof x=="function"&&p.call(x)===v):!0)},isEmptyObject:function(c){var b;for(b in c)return!1;return!0},globalEval:function(c,b,x){O(c,{nonce:b&&b.nonce},x)},each:function(c,b){var x,k=0;if(Z(c))for(x=c.length;k<x&&b.call(c[k],k,c[k])!==!1;k++);else for(k in c)if(b.call(c[k],k,c[k])===!1)break;return c},text:function(c){var b,x="",k=0,M=c.nodeType;if(!M)for(;b=c[k++];)x+=S.text(b);return M===1||M===11?c.textContent:M===9?c.documentElement.textContent:M===3||M===4?c.nodeValue:x},makeArray:function(c,b){var x=b||[];return c!=null&&(Z(Object(c))?S.merge(x,typeof c=="string"?[c]:c):l.call(x,c)),x},inArray:function(c,b,x){return b==null?-1:o.call(b,c,x)},isXMLDoc:function(c){var b=c&&c.namespaceURI,x=c&&(c.ownerDocument||c).documentElement;return!Q.test(b||x&&x.nodeName||"HTML")},merge:function(c,b){for(var x=+b.length,k=0,M=c.length;k<x;k++)c[M++]=b[k];return c.length=M,c},grep:function(c,b,x){for(var k,M=[],E=0,R=c.length,N=!x;E<R;E++)k=!b(c[E],E),k!==N&&M.push(c[E]);return M},map:function(c,b,x){var k,M,E=0,R=[];if(Z(c))for(k=c.length;E<k;E++)M=b(c[E],E,x),M!=null&&R.push(M);else for(E in c)M=b(c[E],E,x),M!=null&&R.push(M);return a(R)},guid:1,support:w}),typeof Symbol=="function"&&(S.fn[Symbol.iterator]=i[Symbol.iterator]),S.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(c,b){u["[object "+b+"]"]=b.toLowerCase()});function Z(c){var b=!!c&&"length"in c&&c.length,x=z(c);return _(c)||T(c)?!1:x==="array"||b===0||typeof b=="number"&&b>0&&b-1 in c}function re(c,b){return c.nodeName&&c.nodeName.toLowerCase()===b.toLowerCase()}var me=i.pop,le=i.sort,oe=i.splice,X="[\\x20\\t\\r\\n\\f]",K=new RegExp("^"+X+"+|((?:^|[^\\\\])(?:\\\\.)*)"+X+"+$","g");S.contains=function(c,b){var x=b&&b.parentNode;return c===x||!!(x&&x.nodeType===1&&(c.contains?c.contains(x):c.compareDocumentPosition&&c.compareDocumentPosition(x)&16))};var _e=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Se(c,b){return b?c==="\0"?"�":c.slice(0,-1)+"\\"+c.charCodeAt(c.length-1).toString(16)+" ":"\\"+c}S.escapeSelector=function(c){return(c+"").replace(_e,Se)};var de=D,De=l;(function(){var c,b,x,k,M,E=De,R,N,j,H,te,ne=S.expando,Y=0,ue=0,We=Il(),at=Il(),qe=Il(),ti=Il(),Ht=function(B,W){return B===W&&(M=!0),0},_n="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",kn="(?:\\\\[\\da-fA-F]{1,6}"+X+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",rt="\\["+X+"*("+kn+")(?:"+X+"*([*^$|!~]?=)"+X+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+kn+"))|)"+X+"*\\]",Or=":("+kn+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+rt+")*)|.*)\\)|)",ot=new RegExp(X+"+","g"),Pt=new RegExp("^"+X+"*,"+X+"*"),pa=new RegExp("^"+X+"*([>+~]|"+X+")"+X+"*"),Zu=new RegExp(X+"|>"),Tn=new RegExp(Or),ga=new RegExp("^"+kn+"$"),Cn={ID:new RegExp("^#("+kn+")"),CLASS:new RegExp("^\\.("+kn+")"),TAG:new RegExp("^("+kn+"|[*])"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+Or),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+X+"*(even|odd|(([+-]|)(\\d*)n|)"+X+"*(?:([+-]|)"+X+"*(\\d+)|))"+X+"*\\)|)","i"),bool:new RegExp("^(?:"+_n+")$","i"),needsContext:new RegExp("^"+X+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+X+"*((?:-\\d)?\\d*)"+X+"*\\)|)(?=[^-]|$)","i")},or=/^(?:input|select|textarea|button)$/i,ur=/^h\d$/i,Xi=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ju=/[+~]/,Gn=new RegExp("\\\\[\\da-fA-F]{1,6}"+X+"?|\\\\([^\\r\\n\\f])","g"),Wn=function(B,W){var q="0x"+B.slice(1)-65536;return W||(q<0?String.fromCharCode(q+65536):String.fromCharCode(q>>10|55296,q&1023|56320))},wv=function(){hr()},xv=Fl(function(B){return B.disabled===!0&&re(B,"fieldset")},{dir:"parentNode",next:"legend"});function Sv(){try{return R.activeElement}catch{}}try{E.apply(i=s.call(de.childNodes),de.childNodes),i[de.childNodes.length].nodeType}catch{E={apply:function(W,q){De.apply(W,s.call(q))},call:function(W){De.apply(W,s.call(arguments,1))}}}function ct(B,W,q,J){var ie,pe,ve,Te,we,Qe,Ne,He=W&&W.ownerDocument,et=W?W.nodeType:9;if(q=q||[],typeof B!="string"||!B||et!==1&&et!==9&&et!==11)return q;if(!J&&(hr(W),W=W||R,j)){if(et!==11&&(we=Xi.exec(B)))if(ie=we[1]){if(et===9)if(ve=W.getElementById(ie)){if(ve.id===ie)return E.call(q,ve),q}else return q;else if(He&&(ve=He.getElementById(ie))&&ct.contains(W,ve)&&ve.id===ie)return E.call(q,ve),q}else{if(we[2])return E.apply(q,W.getElementsByTagName(B)),q;if((ie=we[3])&&W.getElementsByClassName)return E.apply(q,W.getElementsByClassName(ie)),q}if(!ti[B+" "]&&(!H||!H.test(B))){if(Ne=B,He=W,et===1&&(Zu.test(B)||pa.test(B))){for(He=Ju.test(B)&&Qu(W.parentNode)||W,(He!=W||!w.scope)&&((Te=W.getAttribute("id"))?Te=S.escapeSelector(Te):W.setAttribute("id",Te=ne)),Qe=ma(B),pe=Qe.length;pe--;)Qe[pe]=(Te?"#"+Te:":scope")+" "+Dl(Qe[pe]);Ne=Qe.join(",")}try{return E.apply(q,He.querySelectorAll(Ne)),q}catch{ti(B,!0)}finally{Te===ne&&W.removeAttribute("id")}}}return ap(B.replace(K,"$1"),W,q,J)}function Il(){var B=[];function W(q,J){return B.push(q+" ")>b.cacheLength&&delete W[B.shift()],W[q+" "]=J}return W}function an(B){return B[ne]=!0,B}function ws(B){var W=R.createElement("fieldset");try{return!!B(W)}catch{return!1}finally{W.parentNode&&W.parentNode.removeChild(W),W=null}}function _v(B){return function(W){return re(W,"input")&&W.type===B}}function kv(B){return function(W){return(re(W,"input")||re(W,"button"))&&W.type===B}}function rp(B){return function(W){return"form"in W?W.parentNode&&W.disabled===!1?"label"in W?"label"in W.parentNode?W.parentNode.disabled===B:W.disabled===B:W.isDisabled===B||W.isDisabled!==!B&&xv(W)===B:W.disabled===B:"label"in W?W.disabled===B:!1}}function Lr(B){return an(function(W){return W=+W,an(function(q,J){for(var ie,pe=B([],q.length,W),ve=pe.length;ve--;)q[ie=pe[ve]]&&(q[ie]=!(J[ie]=q[ie]))})})}function Qu(B){return B&&typeof B.getElementsByTagName<"u"&&B}function hr(B){var W,q=B?B.ownerDocument||B:de;return q==R||q.nodeType!==9||!q.documentElement||(R=q,N=R.documentElement,j=!S.isXMLDoc(R),te=N.matches||N.webkitMatchesSelector||N.msMatchesSelector,N.msMatchesSelector&&de!=R&&(W=R.defaultView)&&W.top!==W&&W.addEventListener("unload",wv),w.getById=ws(function(J){return N.appendChild(J).id=S.expando,!R.getElementsByName||!R.getElementsByName(S.expando).length}),w.disconnectedMatch=ws(function(J){return te.call(J,"*")}),w.scope=ws(function(){return R.querySelectorAll(":scope")}),w.cssHas=ws(function(){try{return R.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),w.getById?(b.filter.ID=function(J){var ie=J.replace(Gn,Wn);return function(pe){return pe.getAttribute("id")===ie}},b.find.ID=function(J,ie){if(typeof ie.getElementById<"u"&&j){var pe=ie.getElementById(J);return pe?[pe]:[]}}):(b.filter.ID=function(J){var ie=J.replace(Gn,Wn);return function(pe){var ve=typeof pe.getAttributeNode<"u"&&pe.getAttributeNode("id");return ve&&ve.value===ie}},b.find.ID=function(J,ie){if(typeof ie.getElementById<"u"&&j){var pe,ve,Te,we=ie.getElementById(J);if(we){if(pe=we.getAttributeNode("id"),pe&&pe.value===J)return[we];for(Te=ie.getElementsByName(J),ve=0;we=Te[ve++];)if(pe=we.getAttributeNode("id"),pe&&pe.value===J)return[we]}return[]}}),b.find.TAG=function(J,ie){return typeof ie.getElementsByTagName<"u"?ie.getElementsByTagName(J):ie.querySelectorAll(J)},b.find.CLASS=function(J,ie){if(typeof ie.getElementsByClassName<"u"&&j)return ie.getElementsByClassName(J)},H=[],ws(function(J){var ie;N.appendChild(J).innerHTML="<a id='"+ne+"' href='' disabled='disabled'></a><select id='"+ne+"-\r\\' disabled='disabled'><option selected=''></option></select>",J.querySelectorAll("[selected]").length||H.push("\\["+X+"*(?:value|"+_n+")"),J.querySelectorAll("[id~="+ne+"-]").length||H.push("~="),J.querySelectorAll("a#"+ne+"+*").length||H.push(".#.+[+~]"),J.querySelectorAll(":checked").length||H.push(":checked"),ie=R.createElement("input"),ie.setAttribute("type","hidden"),J.appendChild(ie).setAttribute("name","D"),N.appendChild(J).disabled=!0,J.querySelectorAll(":disabled").length!==2&&H.push(":enabled",":disabled"),ie=R.createElement("input"),ie.setAttribute("name",""),J.appendChild(ie),J.querySelectorAll("[name='']").length||H.push("\\["+X+"*name"+X+"*="+X+`*(?:''|"")`)}),w.cssHas||H.push(":has"),H=H.length&&new RegExp(H.join("|")),Ht=function(J,ie){if(J===ie)return M=!0,0;var pe=!J.compareDocumentPosition-!ie.compareDocumentPosition;return pe||(pe=(J.ownerDocument||J)==(ie.ownerDocument||ie)?J.compareDocumentPosition(ie):1,pe&1||!w.sortDetached&&ie.compareDocumentPosition(J)===pe?J===R||J.ownerDocument==de&&ct.contains(de,J)?-1:ie===R||ie.ownerDocument==de&&ct.contains(de,ie)?1:k?o.call(k,J)-o.call(k,ie):0:pe&4?-1:1)}),R}ct.matches=function(B,W){return ct(B,null,null,W)},ct.matchesSelector=function(B,W){if(hr(B),j&&!ti[W+" "]&&(!H||!H.test(W)))try{var q=te.call(B,W);if(q||w.disconnectedMatch||B.document&&B.document.nodeType!==11)return q}catch{ti(W,!0)}return ct(W,R,null,[B]).length>0},ct.contains=function(B,W){return(B.ownerDocument||B)!=R&&hr(B),S.contains(B,W)},ct.attr=function(B,W){(B.ownerDocument||B)!=R&&hr(B);var q=b.attrHandle[W.toLowerCase()],J=q&&d.call(b.attrHandle,W.toLowerCase())?q(B,W,!j):void 0;return J!==void 0?J:B.getAttribute(W)},ct.error=function(B){throw new Error("Syntax error, unrecognized expression: "+B)},S.uniqueSort=function(B){var W,q=[],J=0,ie=0;if(M=!w.sortStable,k=!w.sortStable&&s.call(B,0),le.call(B,Ht),M){for(;W=B[ie++];)W===B[ie]&&(J=q.push(ie));for(;J--;)oe.call(B,q[J],1)}return k=null,B},S.fn.uniqueSort=function(){return this.pushStack(S.uniqueSort(s.apply(this)))},b=S.expr={cacheLength:50,createPseudo:an,match:Cn,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(B){return B[1]=B[1].replace(Gn,Wn),B[3]=(B[3]||B[4]||B[5]||"").replace(Gn,Wn),B[2]==="~="&&(B[3]=" "+B[3]+" "),B.slice(0,4)},CHILD:function(B){return B[1]=B[1].toLowerCase(),B[1].slice(0,3)==="nth"?(B[3]||ct.error(B[0]),B[4]=+(B[4]?B[5]+(B[6]||1):2*(B[3]==="even"||B[3]==="odd")),B[5]=+(B[7]+B[8]||B[3]==="odd")):B[3]&&ct.error(B[0]),B},PSEUDO:function(B){var W,q=!B[6]&&B[2];return Cn.CHILD.test(B[0])?null:(B[3]?B[2]=B[4]||B[5]||"":q&&Tn.test(q)&&(W=ma(q,!0))&&(W=q.indexOf(")",q.length-W)-q.length)&&(B[0]=B[0].slice(0,W),B[2]=q.slice(0,W)),B.slice(0,3))}},filter:{TAG:function(B){var W=B.replace(Gn,Wn).toLowerCase();return B==="*"?function(){return!0}:function(q){return re(q,W)}},CLASS:function(B){var W=We[B+" "];return W||(W=new RegExp("(^|"+X+")"+B+"("+X+"|$)"))&&We(B,function(q){return W.test(typeof q.className=="string"&&q.className||typeof q.getAttribute<"u"&&q.getAttribute("class")||"")})},ATTR:function(B,W,q){return function(J){var ie=ct.attr(J,B);return ie==null?W==="!=":W?(ie+="",W==="="?ie===q:W==="!="?ie!==q:W==="^="?q&&ie.indexOf(q)===0:W==="*="?q&&ie.indexOf(q)>-1:W==="$="?q&&ie.slice(-q.length)===q:W==="~="?(" "+ie.replace(ot," ")+" ").indexOf(q)>-1:W==="|="?ie===q||ie.slice(0,q.length+1)===q+"-":!1):!0}},CHILD:function(B,W,q,J,ie){var pe=B.slice(0,3)!=="nth",ve=B.slice(-4)!=="last",Te=W==="of-type";return J===1&&ie===0?function(we){return!!we.parentNode}:function(we,Qe,Ne){var He,et,Oe,wt,ki,li=pe!==ve?"nextSibling":"previousSibling",Ki=we.parentNode,An=Te&&we.nodeName.toLowerCase(),xs=!Ne&&!Te,ci=!1;if(Ki){if(pe){for(;li;){for(Oe=we;Oe=Oe[li];)if(Te?re(Oe,An):Oe.nodeType===1)return!1;ki=li=B==="only"&&!ki&&"nextSibling"}return!0}if(ki=[ve?Ki.firstChild:Ki.lastChild],ve&&xs){for(et=Ki[ne]||(Ki[ne]={}),He=et[B]||[],wt=He[0]===Y&&He[1],ci=wt&&He[2],Oe=wt&&Ki.childNodes[wt];Oe=++wt&&Oe&&Oe[li]||(ci=wt=0)||ki.pop();)if(Oe.nodeType===1&&++ci&&Oe===we){et[B]=[Y,wt,ci];break}}else if(xs&&(et=we[ne]||(we[ne]={}),He=et[B]||[],wt=He[0]===Y&&He[1],ci=wt),ci===!1)for(;(Oe=++wt&&Oe&&Oe[li]||(ci=wt=0)||ki.pop())&&!((Te?re(Oe,An):Oe.nodeType===1)&&++ci&&(xs&&(et=Oe[ne]||(Oe[ne]={}),et[B]=[Y,ci]),Oe===we)););return ci-=ie,ci===J||ci%J===0&&ci/J>=0}}},PSEUDO:function(B,W){var q,J=b.pseudos[B]||b.setFilters[B.toLowerCase()]||ct.error("unsupported pseudo: "+B);return J[ne]?J(W):J.length>1?(q=[B,B,"",W],b.setFilters.hasOwnProperty(B.toLowerCase())?an(function(ie,pe){for(var ve,Te=J(ie,W),we=Te.length;we--;)ve=o.call(ie,Te[we]),ie[ve]=!(pe[ve]=Te[we])}):function(ie){return J(ie,0,q)}):J}},pseudos:{not:an(function(B){var W=[],q=[],J=nh(B.replace(K,"$1"));return J[ne]?an(function(ie,pe,ve,Te){for(var we,Qe=J(ie,null,Te,[]),Ne=ie.length;Ne--;)(we=Qe[Ne])&&(ie[Ne]=!(pe[Ne]=we))}):function(ie,pe,ve){return W[0]=ie,J(W,null,ve,q),W[0]=null,!q.pop()}}),has:an(function(B){return function(W){return ct(B,W).length>0}}),contains:an(function(B){return B=B.replace(Gn,Wn),function(W){return(W.textContent||S.text(W)).indexOf(B)>-1}}),lang:an(function(B){return ga.test(B||"")||ct.error("unsupported lang: "+B),B=B.replace(Gn,Wn).toLowerCase(),function(W){var q;do if(q=j?W.lang:W.getAttribute("xml:lang")||W.getAttribute("lang"))return q=q.toLowerCase(),q===B||q.indexOf(B+"-")===0;while((W=W.parentNode)&&W.nodeType===1);return!1}}),target:function(B){var W=e.location&&e.location.hash;return W&&W.slice(1)===B.id},root:function(B){return B===N},focus:function(B){return B===Sv()&&R.hasFocus()&&!!(B.type||B.href||~B.tabIndex)},enabled:rp(!1),disabled:rp(!0),checked:function(B){return re(B,"input")&&!!B.checked||re(B,"option")&&!!B.selected},selected:function(B){return B.parentNode&&B.parentNode.selectedIndex,B.selected===!0},empty:function(B){for(B=B.firstChild;B;B=B.nextSibling)if(B.nodeType<6)return!1;return!0},parent:function(B){return!b.pseudos.empty(B)},header:function(B){return ur.test(B.nodeName)},input:function(B){return or.test(B.nodeName)},button:function(B){return re(B,"input")&&B.type==="button"||re(B,"button")},text:function(B){var W;return re(B,"input")&&B.type==="text"&&((W=B.getAttribute("type"))==null||W.toLowerCase()==="text")},first:Lr(function(){return[0]}),last:Lr(function(B,W){return[W-1]}),eq:Lr(function(B,W,q){return[q<0?q+W:q]}),even:Lr(function(B,W){for(var q=0;q<W;q+=2)B.push(q);return B}),odd:Lr(function(B,W){for(var q=1;q<W;q+=2)B.push(q);return B}),lt:Lr(function(B,W,q){var J;for(q<0?J=q+W:q>W?J=W:J=q;--J>=0;)B.push(J);return B}),gt:Lr(function(B,W,q){for(var J=q<0?q+W:q;++J<W;)B.push(J);return B})}},b.pseudos.nth=b.pseudos.eq;for(c in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[c]=_v(c);for(c in{submit:!0,reset:!0})b.pseudos[c]=kv(c);function sp(){}sp.prototype=b.filters=b.pseudos,b.setFilters=new sp;function ma(B,W){var q,J,ie,pe,ve,Te,we,Qe=at[B+" "];if(Qe)return W?0:Qe.slice(0);for(ve=B,Te=[],we=b.preFilter;ve;){(!q||(J=Pt.exec(ve)))&&(J&&(ve=ve.slice(J[0].length)||ve),Te.push(ie=[])),q=!1,(J=pa.exec(ve))&&(q=J.shift(),ie.push({value:q,type:J[0].replace(K," ")}),ve=ve.slice(q.length));for(pe in b.filter)(J=Cn[pe].exec(ve))&&(!we[pe]||(J=we[pe](J)))&&(q=J.shift(),ie.push({value:q,type:pe,matches:J}),ve=ve.slice(q.length));if(!q)break}return W?ve.length:ve?ct.error(B):at(B,Te).slice(0)}function Dl(B){for(var W=0,q=B.length,J="";W<q;W++)J+=B[W].value;return J}function Fl(B,W,q){var J=W.dir,ie=W.next,pe=ie||J,ve=q&&pe==="parentNode",Te=ue++;return W.first?function(we,Qe,Ne){for(;we=we[J];)if(we.nodeType===1||ve)return B(we,Qe,Ne);return!1}:function(we,Qe,Ne){var He,et,Oe=[Y,Te];if(Ne){for(;we=we[J];)if((we.nodeType===1||ve)&&B(we,Qe,Ne))return!0}else for(;we=we[J];)if(we.nodeType===1||ve)if(et=we[ne]||(we[ne]={}),ie&&re(we,ie))we=we[J]||we;else{if((He=et[pe])&&He[0]===Y&&He[1]===Te)return Oe[2]=He[2];if(et[pe]=Oe,Oe[2]=B(we,Qe,Ne))return!0}return!1}}function eh(B){return B.length>1?function(W,q,J){for(var ie=B.length;ie--;)if(!B[ie](W,q,J))return!1;return!0}:B[0]}function Tv(B,W,q){for(var J=0,ie=W.length;J<ie;J++)ct(B,W[J],q);return q}function Rl(B,W,q,J,ie){for(var pe,ve=[],Te=0,we=B.length,Qe=W!=null;Te<we;Te++)(pe=B[Te])&&(!q||q(pe,J,ie))&&(ve.push(pe),Qe&&W.push(Te));return ve}function th(B,W,q,J,ie,pe){return J&&!J[ne]&&(J=th(J)),ie&&!ie[ne]&&(ie=th(ie,pe)),an(function(ve,Te,we,Qe){var Ne,He,et,Oe,wt=[],ki=[],li=Te.length,Ki=ve||Tv(W||"*",we.nodeType?[we]:we,[]),An=B&&(ve||!W)?Rl(Ki,wt,B,we,Qe):Ki;if(q?(Oe=ie||(ve?B:li||J)?[]:Te,q(An,Oe,we,Qe)):Oe=An,J)for(Ne=Rl(Oe,ki),J(Ne,[],we,Qe),He=Ne.length;He--;)(et=Ne[He])&&(Oe[ki[He]]=!(An[ki[He]]=et));if(ve){if(ie||B){if(ie){for(Ne=[],He=Oe.length;He--;)(et=Oe[He])&&Ne.push(An[He]=et);ie(null,Oe=[],Ne,Qe)}for(He=Oe.length;He--;)(et=Oe[He])&&(Ne=ie?o.call(ve,et):wt[He])>-1&&(ve[Ne]=!(Te[Ne]=et))}}else Oe=Rl(Oe===Te?Oe.splice(li,Oe.length):Oe),ie?ie(null,Te,Oe,Qe):E.apply(Te,Oe)})}function ih(B){for(var W,q,J,ie=B.length,pe=b.relative[B[0].type],ve=pe||b.relative[" "],Te=pe?1:0,we=Fl(function(He){return He===W},ve,!0),Qe=Fl(function(He){return o.call(W,He)>-1},ve,!0),Ne=[function(He,et,Oe){var wt=!pe&&(Oe||et!=x)||((W=et).nodeType?we(He,et,Oe):Qe(He,et,Oe));return W=null,wt}];Te<ie;Te++)if(q=b.relative[B[Te].type])Ne=[Fl(eh(Ne),q)];else{if(q=b.filter[B[Te].type].apply(null,B[Te].matches),q[ne]){for(J=++Te;J<ie&&!b.relative[B[J].type];J++);return th(Te>1&&eh(Ne),Te>1&&Dl(B.slice(0,Te-1).concat({value:B[Te-2].type===" "?"*":""})).replace(K,"$1"),q,Te<J&&ih(B.slice(Te,J)),J<ie&&ih(B=B.slice(J)),J<ie&&Dl(B))}Ne.push(q)}return eh(Ne)}function Cv(B,W){var q=W.length>0,J=B.length>0,ie=function(pe,ve,Te,we,Qe){var Ne,He,et,Oe=0,wt="0",ki=pe&&[],li=[],Ki=x,An=pe||J&&b.find.TAG("*",Qe),xs=Y+=Ki==null?1:Math.random()||.1,ci=An.length;for(Qe&&(x=ve==R||ve||Qe);wt!==ci&&(Ne=An[wt])!=null;wt++){if(J&&Ne){for(He=0,!ve&&Ne.ownerDocument!=R&&(hr(Ne),Te=!j);et=B[He++];)if(et(Ne,ve||R,Te)){E.call(we,Ne);break}Qe&&(Y=xs)}q&&((Ne=!et&&Ne)&&Oe--,pe&&ki.push(Ne))}if(Oe+=wt,q&&wt!==Oe){for(He=0;et=W[He++];)et(ki,li,ve,Te);if(pe){if(Oe>0)for(;wt--;)ki[wt]||li[wt]||(li[wt]=me.call(we));li=Rl(li)}E.apply(we,li),Qe&&!pe&&li.length>0&&Oe+W.length>1&&S.uniqueSort(we)}return Qe&&(Y=xs,x=Ki),ki};return q?an(ie):ie}function nh(B,W){var q,J=[],ie=[],pe=qe[B+" "];if(!pe){for(W||(W=ma(B)),q=W.length;q--;)pe=ih(W[q]),pe[ne]?J.push(pe):ie.push(pe);pe=qe(B,Cv(ie,J)),pe.selector=B}return pe}function ap(B,W,q,J){var ie,pe,ve,Te,we,Qe=typeof B=="function"&&B,Ne=!J&&ma(B=Qe.selector||B);if(q=q||[],Ne.length===1){if(pe=Ne[0]=Ne[0].slice(0),pe.length>2&&(ve=pe[0]).type==="ID"&&W.nodeType===9&&j&&b.relative[pe[1].type]){if(W=(b.find.ID(ve.matches[0].replace(Gn,Wn),W)||[])[0],W)Qe&&(W=W.parentNode);else return q;B=B.slice(pe.shift().value.length)}for(ie=Cn.needsContext.test(B)?0:pe.length;ie--&&(ve=pe[ie],!b.relative[Te=ve.type]);)if((we=b.find[Te])&&(J=we(ve.matches[0].replace(Gn,Wn),Ju.test(pe[0].type)&&Qu(W.parentNode)||W))){if(pe.splice(ie,1),B=J.length&&Dl(pe),!B)return E.apply(q,J),q;break}}return(Qe||nh(B,Ne))(J,W,!j,q,!W||Ju.test(B)&&Qu(W.parentNode)||W),q}w.sortStable=ne.split("").sort(Ht).join("")===ne,hr(),w.sortDetached=ws(function(B){return B.compareDocumentPosition(R.createElement("fieldset"))&1}),S.find=ct,S.expr[":"]=S.expr.pseudos,S.unique=S.uniqueSort,ct.compile=nh,ct.select=ap,ct.setDocument=hr,ct.tokenize=ma,ct.escape=S.escapeSelector,ct.getText=S.text,ct.isXML=S.isXMLDoc,ct.selectors=S.expr,ct.support=S.support,ct.uniqueSort=S.uniqueSort})();var Ve=function(c,b,x){for(var k=[],M=x!==void 0;(c=c[b])&&c.nodeType!==9;)if(c.nodeType===1){if(M&&S(c).is(x))break;k.push(c)}return k},ae=function(c,b){for(var x=[];c;c=c.nextSibling)c.nodeType===1&&c!==b&&x.push(c);return x},Ie=S.expr.match.needsContext,Xe=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function Je(c,b,x){return _(b)?S.grep(c,function(k,M){return!!b.call(k,M,k)!==x}):b.nodeType?S.grep(c,function(k){return k===b!==x}):typeof b!="string"?S.grep(c,function(k){return o.call(b,k)>-1!==x}):S.filter(b,c,x)}S.filter=function(c,b,x){var k=b[0];return x&&(c=":not("+c+")"),b.length===1&&k.nodeType===1?S.find.matchesSelector(k,c)?[k]:[]:S.find.matches(c,S.grep(b,function(M){return M.nodeType===1}))},S.fn.extend({find:function(c){var b,x,k=this.length,M=this;if(typeof c!="string")return this.pushStack(S(c).filter(function(){for(b=0;b<k;b++)if(S.contains(M[b],this))return!0}));for(x=this.pushStack([]),b=0;b<k;b++)S.find(c,M[b],x);return k>1?S.uniqueSort(x):x},filter:function(c){return this.pushStack(Je(this,c||[],!1))},not:function(c){return this.pushStack(Je(this,c||[],!0))},is:function(c){return!!Je(this,typeof c=="string"&&Ie.test(c)?S(c):c||[],!1).length}});var Ze,pt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,mt=S.fn.init=function(c,b,x){var k,M;if(!c)return this;if(x=x||Ze,typeof c=="string")if(c[0]==="<"&&c[c.length-1]===">"&&c.length>=3?k=[null,c,null]:k=pt.exec(c),k&&(k[1]||!b))if(k[1]){if(b=b instanceof S?b[0]:b,S.merge(this,S.parseHTML(k[1],b&&b.nodeType?b.ownerDocument||b:D,!0)),Xe.test(k[1])&&S.isPlainObject(b))for(k in b)_(this[k])?this[k](b[k]):this.attr(k,b[k]);return this}else return M=D.getElementById(k[2]),M&&(this[0]=M,this.length=1),this;else return!b||b.jquery?(b||x).find(c):this.constructor(b).find(c);else{if(c.nodeType)return this[0]=c,this.length=1,this;if(_(c))return x.ready!==void 0?x.ready(c):c(S)}return S.makeArray(c,this)};mt.prototype=S.fn,Ze=S(D);var vt=/^(?:parents|prev(?:Until|All))/,zt={children:!0,contents:!0,next:!0,prev:!0};S.fn.extend({has:function(c){var b=S(c,this),x=b.length;return this.filter(function(){for(var k=0;k<x;k++)if(S.contains(this,b[k]))return!0})},closest:function(c,b){var x,k=0,M=this.length,E=[],R=typeof c!="string"&&S(c);if(!Ie.test(c)){for(;k<M;k++)for(x=this[k];x&&x!==b;x=x.parentNode)if(x.nodeType<11&&(R?R.index(x)>-1:x.nodeType===1&&S.find.matchesSelector(x,c))){E.push(x);break}}return this.pushStack(E.length>1?S.uniqueSort(E):E)},index:function(c){return c?typeof c=="string"?o.call(S(c),this[0]):o.call(this,c.jquery?c[0]:c):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(c,b){return this.pushStack(S.uniqueSort(S.merge(this.get(),S(c,b))))},addBack:function(c){return this.add(c==null?this.prevObject:this.prevObject.filter(c))}});function Kt(c,b){for(;(c=c[b])&&c.nodeType!==1;);return c}S.each({parent:function(c){var b=c.parentNode;return b&&b.nodeType!==11?b:null},parents:function(c){return Ve(c,"parentNode")},parentsUntil:function(c,b,x){return Ve(c,"parentNode",x)},next:function(c){return Kt(c,"nextSibling")},prev:function(c){return Kt(c,"previousSibling")},nextAll:function(c){return Ve(c,"nextSibling")},prevAll:function(c){return Ve(c,"previousSibling")},nextUntil:function(c,b,x){return Ve(c,"nextSibling",x)},prevUntil:function(c,b,x){return Ve(c,"previousSibling",x)},siblings:function(c){return ae((c.parentNode||{}).firstChild,c)},children:function(c){return ae(c.firstChild)},contents:function(c){return c.contentDocument!=null&&n(c.contentDocument)?c.contentDocument:(re(c,"template")&&(c=c.content||c),S.merge([],c.childNodes))}},function(c,b){S.fn[c]=function(x,k){var M=S.map(this,b,x);return c.slice(-5)!=="Until"&&(k=x),k&&typeof k=="string"&&(M=S.filter(k,M)),this.length>1&&(zt[c]||S.uniqueSort(M),vt.test(c)&&M.reverse()),this.pushStack(M)}});var ht=/[^\x20\t\r\n\f]+/g;function st(c){var b={};return S.each(c.match(ht)||[],function(x,k){b[k]=!0}),b}S.Callbacks=function(c){c=typeof c=="string"?st(c):S.extend({},c);var b,x,k,M,E=[],R=[],N=-1,j=function(){for(M=M||c.once,k=b=!0;R.length;N=-1)for(x=R.shift();++N<E.length;)E[N].apply(x[0],x[1])===!1&&c.stopOnFalse&&(N=E.length,x=!1);c.memory||(x=!1),b=!1,M&&(x?E=[]:E="")},H={add:function(){return E&&(x&&!b&&(N=E.length-1,R.push(x)),function te(ne){S.each(ne,function(Y,ue){_(ue)?(!c.unique||!H.has(ue))&&E.push(ue):ue&&ue.length&&z(ue)!=="string"&&te(ue)})}(arguments),x&&!b&&j()),this},remove:function(){return S.each(arguments,function(te,ne){for(var Y;(Y=S.inArray(ne,E,Y))>-1;)E.splice(Y,1),Y<=N&&N--}),this},has:function(te){return te?S.inArray(te,E)>-1:E.length>0},empty:function(){return E&&(E=[]),this},disable:function(){return M=R=[],E=x="",this},disabled:function(){return!E},lock:function(){return M=R=[],!x&&!b&&(E=x=""),this},locked:function(){return!!M},fireWith:function(te,ne){return M||(ne=ne||[],ne=[te,ne.slice?ne.slice():ne],R.push(ne),b||j()),this},fire:function(){return H.fireWith(this,arguments),this},fired:function(){return!!k}};return H};function dt(c){return c}function yt(c){throw c}function di(c,b,x,k){var M;try{c&&_(M=c.promise)?M.call(c).done(b).fail(x):c&&_(M=c.then)?M.call(c,b,x):b.apply(void 0,[c].slice(k))}catch(E){x.apply(void 0,[E])}}S.extend({Deferred:function(c){var b=[["notify","progress",S.Callbacks("memory"),S.Callbacks("memory"),2],["resolve","done",S.Callbacks("once memory"),S.Callbacks("once memory"),0,"resolved"],["reject","fail",S.Callbacks("once memory"),S.Callbacks("once memory"),1,"rejected"]],x="pending",k={state:function(){return x},always:function(){return M.done(arguments).fail(arguments),this},catch:function(E){return k.then(null,E)},pipe:function(){var E=arguments;return S.Deferred(function(R){S.each(b,function(N,j){var H=_(E[j[4]])&&E[j[4]];M[j[1]](function(){var te=H&&H.apply(this,arguments);te&&_(te.promise)?te.promise().progress(R.notify).done(R.resolve).fail(R.reject):R[j[0]+"With"](this,H?[te]:arguments)})}),E=null}).promise()},then:function(E,R,N){var j=0;function H(te,ne,Y,ue){return function(){var We=this,at=arguments,qe=function(){var Ht,_n;if(!(te<j)){if(Ht=Y.apply(We,at),Ht===ne.promise())throw new TypeError("Thenable self-resolution");_n=Ht&&(typeof Ht=="object"||typeof Ht=="function")&&Ht.then,_(_n)?ue?_n.call(Ht,H(j,ne,dt,ue),H(j,ne,yt,ue)):(j++,_n.call(Ht,H(j,ne,dt,ue),H(j,ne,yt,ue),H(j,ne,dt,ne.notifyWith))):(Y!==dt&&(We=void 0,at=[Ht]),(ue||ne.resolveWith)(We,at))}},ti=ue?qe:function(){try{qe()}catch(Ht){S.Deferred.exceptionHook&&S.Deferred.exceptionHook(Ht,ti.error),te+1>=j&&(Y!==yt&&(We=void 0,at=[Ht]),ne.rejectWith(We,at))}};te?ti():(S.Deferred.getErrorHook?ti.error=S.Deferred.getErrorHook():S.Deferred.getStackHook&&(ti.error=S.Deferred.getStackHook()),e.setTimeout(ti))}}return S.Deferred(function(te){b[0][3].add(H(0,te,_(N)?N:dt,te.notifyWith)),b[1][3].add(H(0,te,_(E)?E:dt)),b[2][3].add(H(0,te,_(R)?R:yt))}).promise()},promise:function(E){return E!=null?S.extend(E,k):k}},M={};return S.each(b,function(E,R){var N=R[2],j=R[5];k[R[1]]=N.add,j&&N.add(function(){x=j},b[3-E][2].disable,b[3-E][3].disable,b[0][2].lock,b[0][3].lock),N.add(R[3].fire),M[R[0]]=function(){return M[R[0]+"With"](this===M?void 0:this,arguments),this},M[R[0]+"With"]=N.fireWith}),k.promise(M),c&&c.call(M,M),M},when:function(c){var b=arguments.length,x=b,k=Array(x),M=s.call(arguments),E=S.Deferred(),R=function(N){return function(j){k[N]=this,M[N]=arguments.length>1?s.call(arguments):j,--b||E.resolveWith(k,M)}};if(b<=1&&(di(c,E.done(R(x)).resolve,E.reject,!b),E.state()==="pending"||_(M[x]&&M[x].then)))return E.then();for(;x--;)di(M[x],R(x),E.reject);return E.promise()}});var Me=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;S.Deferred.exceptionHook=function(c,b){e.console&&e.console.warn&&c&&Me.test(c.name)&&e.console.warn("jQuery.Deferred exception: "+c.message,c.stack,b)},S.readyException=function(c){e.setTimeout(function(){throw c})};var ei=S.Deferred();S.fn.ready=function(c){return ei.then(c).catch(function(b){S.readyException(b)}),this},S.extend({isReady:!1,readyWait:1,ready:function(c){(c===!0?--S.readyWait:S.isReady)||(S.isReady=!0,!(c!==!0&&--S.readyWait>0)&&ei.resolveWith(D,[S]))}}),S.ready.then=ei.then;function lr(){D.removeEventListener("DOMContentLoaded",lr),e.removeEventListener("load",lr),S.ready()}D.readyState==="complete"||D.readyState!=="loading"&&!D.documentElement.doScroll?e.setTimeout(S.ready):(D.addEventListener("DOMContentLoaded",lr),e.addEventListener("load",lr));var wi=function(c,b,x,k,M,E,R){var N=0,j=c.length,H=x==null;if(z(x)==="object"){M=!0;for(N in x)wi(c,b,N,x[N],!0,E,R)}else if(k!==void 0&&(M=!0,_(k)||(R=!0),H&&(R?(b.call(c,k),b=null):(H=b,b=function(te,ne,Y){return H.call(S(te),Y)})),b))for(;N<j;N++)b(c[N],x,R?k:k.call(c[N],N,b(c[N],x)));return M?c:H?b.call(c):j?b(c[0],x):E},Db=/^-ms-/,Fb=/-([a-z])/g;function Rb(c,b){return b.toUpperCase()}function Sn(c){return c.replace(Db,"ms-").replace(Fb,Rb)}var aa=function(c){return c.nodeType===1||c.nodeType===9||!+c.nodeType};function la(){this.expando=S.expando+la.uid++}la.uid=1,la.prototype={cache:function(c){var b=c[this.expando];return b||(b={},aa(c)&&(c.nodeType?c[this.expando]=b:Object.defineProperty(c,this.expando,{value:b,configurable:!0}))),b},set:function(c,b,x){var k,M=this.cache(c);if(typeof b=="string")M[Sn(b)]=x;else for(k in b)M[Sn(k)]=b[k];return M},get:function(c,b){return b===void 0?this.cache(c):c[this.expando]&&c[this.expando][Sn(b)]},access:function(c,b,x){return b===void 0||b&&typeof b=="string"&&x===void 0?this.get(c,b):(this.set(c,b,x),x!==void 0?x:b)},remove:function(c,b){var x,k=c[this.expando];if(k!==void 0){if(b!==void 0)for(Array.isArray(b)?b=b.map(Sn):(b=Sn(b),b=b in k?[b]:b.match(ht)||[]),x=b.length;x--;)delete k[b[x]];(b===void 0||S.isEmptyObject(k))&&(c.nodeType?c[this.expando]=void 0:delete c[this.expando])}},hasData:function(c){var b=c[this.expando];return b!==void 0&&!S.isEmptyObject(b)}};var Ee=new la,xi=new la,Ob=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Lb=/[A-Z]/g;function Bb(c){return c==="true"?!0:c==="false"?!1:c==="null"?null:c===+c+""?+c:Ob.test(c)?JSON.parse(c):c}function Af(c,b,x){var k;if(x===void 0&&c.nodeType===1)if(k="data-"+b.replace(Lb,"-$&").toLowerCase(),x=c.getAttribute(k),typeof x=="string"){try{x=Bb(x)}catch{}xi.set(c,b,x)}else x=void 0;return x}S.extend({hasData:function(c){return xi.hasData(c)||Ee.hasData(c)},data:function(c,b,x){return xi.access(c,b,x)},removeData:function(c,b){xi.remove(c,b)},_data:function(c,b,x){return Ee.access(c,b,x)},_removeData:function(c,b){Ee.remove(c,b)}}),S.fn.extend({data:function(c,b){var x,k,M,E=this[0],R=E&&E.attributes;if(c===void 0){if(this.length&&(M=xi.get(E),E.nodeType===1&&!Ee.get(E,"hasDataAttrs"))){for(x=R.length;x--;)R[x]&&(k=R[x].name,k.indexOf("data-")===0&&(k=Sn(k.slice(5)),Af(E,k,M[k])));Ee.set(E,"hasDataAttrs",!0)}return M}return typeof c=="object"?this.each(function(){xi.set(this,c)}):wi(this,function(N){var j;if(E&&N===void 0)return j=xi.get(E,c),j!==void 0||(j=Af(E,c),j!==void 0)?j:void 0;this.each(function(){xi.set(this,c,N)})},null,b,arguments.length>1,null,!0)},removeData:function(c){return this.each(function(){xi.remove(this,c)})}}),S.extend({queue:function(c,b,x){var k;if(c)return b=(b||"fx")+"queue",k=Ee.get(c,b),x&&(!k||Array.isArray(x)?k=Ee.access(c,b,S.makeArray(x)):k.push(x)),k||[]},dequeue:function(c,b){b=b||"fx";var x=S.queue(c,b),k=x.length,M=x.shift(),E=S._queueHooks(c,b),R=function(){S.dequeue(c,b)};M==="inprogress"&&(M=x.shift(),k--),M&&(b==="fx"&&x.unshift("inprogress"),delete E.stop,M.call(c,R,E)),!k&&E&&E.empty.fire()},_queueHooks:function(c,b){var x=b+"queueHooks";return Ee.get(c,x)||Ee.access(c,x,{empty:S.Callbacks("once memory").add(function(){Ee.remove(c,[b+"queue",x])})})}}),S.fn.extend({queue:function(c,b){var x=2;return typeof c!="string"&&(b=c,c="fx",x--),arguments.length<x?S.queue(this[0],c):b===void 0?this:this.each(function(){var k=S.queue(this,c,b);S._queueHooks(this,c),c==="fx"&&k[0]!=="inprogress"&&S.dequeue(this,c)})},dequeue:function(c){return this.each(function(){S.dequeue(this,c)})},clearQueue:function(c){return this.queue(c||"fx",[])},promise:function(c,b){var x,k=1,M=S.Deferred(),E=this,R=this.length,N=function(){--k||M.resolveWith(E,[E])};for(typeof c!="string"&&(b=c,c=void 0),c=c||"fx";R--;)x=Ee.get(E[R],c+"queueHooks"),x&&x.empty&&(k++,x.empty.add(N));return N(),M.promise(b)}});var Mf=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,oa=new RegExp("^(?:([+-])=|)("+Mf+")([a-z%]*)$","i"),Nn=["Top","Right","Bottom","Left"],Dr=D.documentElement,ps=function(c){return S.contains(c.ownerDocument,c)},zb={composed:!0};Dr.getRootNode&&(ps=function(c){return S.contains(c.ownerDocument,c)||c.getRootNode(zb)===c.ownerDocument});var Cl=function(c,b){return c=b||c,c.style.display==="none"||c.style.display===""&&ps(c)&&S.css(c,"display")==="none"};function Ef(c,b,x,k){var M,E,R=20,N=k?function(){return k.cur()}:function(){return S.css(c,b,"")},j=N(),H=x&&x[3]||(S.cssNumber[b]?"":"px"),te=c.nodeType&&(S.cssNumber[b]||H!=="px"&&+j)&&oa.exec(S.css(c,b));if(te&&te[3]!==H){for(j=j/2,H=H||te[3],te=+j||1;R--;)S.style(c,b,te+H),(1-E)*(1-(E=N()/j||.5))<=0&&(R=0),te=te/E;te=te*2,S.style(c,b,te+H),x=x||[]}return x&&(te=+te||+j||0,M=x[1]?te+(x[1]+1)*x[2]:+x[2],k&&(k.unit=H,k.start=te,k.end=M)),M}var Pf={};function jb(c){var b,x=c.ownerDocument,k=c.nodeName,M=Pf[k];return M||(b=x.body.appendChild(x.createElement(k)),M=S.css(b,"display"),b.parentNode.removeChild(b),M==="none"&&(M="block"),Pf[k]=M,M)}function gs(c,b){for(var x,k,M=[],E=0,R=c.length;E<R;E++)k=c[E],k.style&&(x=k.style.display,b?(x==="none"&&(M[E]=Ee.get(k,"display")||null,M[E]||(k.style.display="")),k.style.display===""&&Cl(k)&&(M[E]=jb(k))):x!=="none"&&(M[E]="none",Ee.set(k,"display",x)));for(E=0;E<R;E++)M[E]!=null&&(c[E].style.display=M[E]);return c}S.fn.extend({show:function(){return gs(this,!0)},hide:function(){return gs(this)},toggle:function(c){return typeof c=="boolean"?c?this.show():this.hide():this.each(function(){Cl(this)?S(this).show():S(this).hide()})}});var ua=/^(?:checkbox|radio)$/i,If=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Df=/^$|^module$|\/(?:java|ecma)script/i;(function(){var c=D.createDocumentFragment(),b=c.appendChild(D.createElement("div")),x=D.createElement("input");x.setAttribute("type","radio"),x.setAttribute("checked","checked"),x.setAttribute("name","t"),b.appendChild(x),w.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",w.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,b.innerHTML="<option></option>",w.option=!!b.lastChild})();var $i={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};$i.tbody=$i.tfoot=$i.colgroup=$i.caption=$i.thead,$i.th=$i.td,w.option||($i.optgroup=$i.option=[1,"<select multiple='multiple'>","</select>"]);function Si(c,b){var x;return typeof c.getElementsByTagName<"u"?x=c.getElementsByTagName(b||"*"):typeof c.querySelectorAll<"u"?x=c.querySelectorAll(b||"*"):x=[],b===void 0||b&&re(c,b)?S.merge([c],x):x}function Bu(c,b){for(var x=0,k=c.length;x<k;x++)Ee.set(c[x],"globalEval",!b||Ee.get(b[x],"globalEval"))}var Nb=/<|&#?\w+;/;function Ff(c,b,x,k,M){for(var E,R,N,j,H,te,ne=b.createDocumentFragment(),Y=[],ue=0,We=c.length;ue<We;ue++)if(E=c[ue],E||E===0)if(z(E)==="object")S.merge(Y,E.nodeType?[E]:E);else if(!Nb.test(E))Y.push(b.createTextNode(E));else{for(R=R||ne.appendChild(b.createElement("div")),N=(If.exec(E)||["",""])[1].toLowerCase(),j=$i[N]||$i._default,R.innerHTML=j[1]+S.htmlPrefilter(E)+j[2],te=j[0];te--;)R=R.lastChild;S.merge(Y,R.childNodes),R=ne.firstChild,R.textContent=""}for(ne.textContent="",ue=0;E=Y[ue++];){if(k&&S.inArray(E,k)>-1){M&&M.push(E);continue}if(H=ps(E),R=Si(ne.appendChild(E),"script"),H&&Bu(R),x)for(te=0;E=R[te++];)Df.test(E.type||"")&&x.push(E)}return ne}var Rf=/^([^.]*)(?:\.(.+)|)/;function ms(){return!0}function ys(){return!1}function zu(c,b,x,k,M,E){var R,N;if(typeof b=="object"){typeof x!="string"&&(k=k||x,x=void 0);for(N in b)zu(c,N,x,k,b[N],E);return c}if(k==null&&M==null?(M=x,k=x=void 0):M==null&&(typeof x=="string"?(M=k,k=void 0):(M=k,k=x,x=void 0)),M===!1)M=ys;else if(!M)return c;return E===1&&(R=M,M=function(j){return S().off(j),R.apply(this,arguments)},M.guid=R.guid||(R.guid=S.guid++)),c.each(function(){S.event.add(this,b,M,k,x)})}S.event={global:{},add:function(c,b,x,k,M){var E,R,N,j,H,te,ne,Y,ue,We,at,qe=Ee.get(c);if(aa(c))for(x.handler&&(E=x,x=E.handler,M=E.selector),M&&S.find.matchesSelector(Dr,M),x.guid||(x.guid=S.guid++),(j=qe.events)||(j=qe.events=Object.create(null)),(R=qe.handle)||(R=qe.handle=function(ti){return typeof S<"u"&&S.event.triggered!==ti.type?S.event.dispatch.apply(c,arguments):void 0}),b=(b||"").match(ht)||[""],H=b.length;H--;)N=Rf.exec(b[H])||[],ue=at=N[1],We=(N[2]||"").split(".").sort(),ue&&(ne=S.event.special[ue]||{},ue=(M?ne.delegateType:ne.bindType)||ue,ne=S.event.special[ue]||{},te=S.extend({type:ue,origType:at,data:k,handler:x,guid:x.guid,selector:M,needsContext:M&&S.expr.match.needsContext.test(M),namespace:We.join(".")},E),(Y=j[ue])||(Y=j[ue]=[],Y.delegateCount=0,(!ne.setup||ne.setup.call(c,k,We,R)===!1)&&c.addEventListener&&c.addEventListener(ue,R)),ne.add&&(ne.add.call(c,te),te.handler.guid||(te.handler.guid=x.guid)),M?Y.splice(Y.delegateCount++,0,te):Y.push(te),S.event.global[ue]=!0)},remove:function(c,b,x,k,M){var E,R,N,j,H,te,ne,Y,ue,We,at,qe=Ee.hasData(c)&&Ee.get(c);if(!(!qe||!(j=qe.events))){for(b=(b||"").match(ht)||[""],H=b.length;H--;){if(N=Rf.exec(b[H])||[],ue=at=N[1],We=(N[2]||"").split(".").sort(),!ue){for(ue in j)S.event.remove(c,ue+b[H],x,k,!0);continue}for(ne=S.event.special[ue]||{},ue=(k?ne.delegateType:ne.bindType)||ue,Y=j[ue]||[],N=N[2]&&new RegExp("(^|\\.)"+We.join("\\.(?:.*\\.|)")+"(\\.|$)"),R=E=Y.length;E--;)te=Y[E],(M||at===te.origType)&&(!x||x.guid===te.guid)&&(!N||N.test(te.namespace))&&(!k||k===te.selector||k==="**"&&te.selector)&&(Y.splice(E,1),te.selector&&Y.delegateCount--,ne.remove&&ne.remove.call(c,te));R&&!Y.length&&((!ne.teardown||ne.teardown.call(c,We,qe.handle)===!1)&&S.removeEvent(c,ue,qe.handle),delete j[ue])}S.isEmptyObject(j)&&Ee.remove(c,"handle events")}},dispatch:function(c){var b,x,k,M,E,R,N=new Array(arguments.length),j=S.event.fix(c),H=(Ee.get(this,"events")||Object.create(null))[j.type]||[],te=S.event.special[j.type]||{};for(N[0]=j,b=1;b<arguments.length;b++)N[b]=arguments[b];if(j.delegateTarget=this,!(te.preDispatch&&te.preDispatch.call(this,j)===!1)){for(R=S.event.handlers.call(this,j,H),b=0;(M=R[b++])&&!j.isPropagationStopped();)for(j.currentTarget=M.elem,x=0;(E=M.handlers[x++])&&!j.isImmediatePropagationStopped();)(!j.rnamespace||E.namespace===!1||j.rnamespace.test(E.namespace))&&(j.handleObj=E,j.data=E.data,k=((S.event.special[E.origType]||{}).handle||E.handler).apply(M.elem,N),k!==void 0&&(j.result=k)===!1&&(j.preventDefault(),j.stopPropagation()));return te.postDispatch&&te.postDispatch.call(this,j),j.result}},handlers:function(c,b){var x,k,M,E,R,N=[],j=b.delegateCount,H=c.target;if(j&&H.nodeType&&!(c.type==="click"&&c.button>=1)){for(;H!==this;H=H.parentNode||this)if(H.nodeType===1&&!(c.type==="click"&&H.disabled===!0)){for(E=[],R={},x=0;x<j;x++)k=b[x],M=k.selector+" ",R[M]===void 0&&(R[M]=k.needsContext?S(M,this).index(H)>-1:S.find(M,this,null,[H]).length),R[M]&&E.push(k);E.length&&N.push({elem:H,handlers:E})}}return H=this,j<b.length&&N.push({elem:H,handlers:b.slice(j)}),N},addProp:function(c,b){Object.defineProperty(S.Event.prototype,c,{enumerable:!0,configurable:!0,get:_(b)?function(){if(this.originalEvent)return b(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[c]},set:function(x){Object.defineProperty(this,c,{enumerable:!0,configurable:!0,writable:!0,value:x})}})},fix:function(c){return c[S.expando]?c:new S.Event(c)},special:{load:{noBubble:!0},click:{setup:function(c){var b=this||c;return ua.test(b.type)&&b.click&&re(b,"input")&&Al(b,"click",!0),!1},trigger:function(c){var b=this||c;return ua.test(b.type)&&b.click&&re(b,"input")&&Al(b,"click"),!0},_default:function(c){var b=c.target;return ua.test(b.type)&&b.click&&re(b,"input")&&Ee.get(b,"click")||re(b,"a")}},beforeunload:{postDispatch:function(c){c.result!==void 0&&c.originalEvent&&(c.originalEvent.returnValue=c.result)}}}};function Al(c,b,x){if(!x){Ee.get(c,b)===void 0&&S.event.add(c,b,ms);return}Ee.set(c,b,!1),S.event.add(c,b,{namespace:!1,handler:function(k){var M,E=Ee.get(this,b);if(k.isTrigger&1&&this[b]){if(E)(S.event.special[b]||{}).delegateType&&k.stopPropagation();else if(E=s.call(arguments),Ee.set(this,b,E),this[b](),M=Ee.get(this,b),Ee.set(this,b,!1),E!==M)return k.stopImmediatePropagation(),k.preventDefault(),M}else E&&(Ee.set(this,b,S.event.trigger(E[0],E.slice(1),this)),k.stopPropagation(),k.isImmediatePropagationStopped=ms)}})}S.removeEvent=function(c,b,x){c.removeEventListener&&c.removeEventListener(b,x)},S.Event=function(c,b){if(!(this instanceof S.Event))return new S.Event(c,b);c&&c.type?(this.originalEvent=c,this.type=c.type,this.isDefaultPrevented=c.defaultPrevented||c.defaultPrevented===void 0&&c.returnValue===!1?ms:ys,this.target=c.target&&c.target.nodeType===3?c.target.parentNode:c.target,this.currentTarget=c.currentTarget,this.relatedTarget=c.relatedTarget):this.type=c,b&&S.extend(this,b),this.timeStamp=c&&c.timeStamp||Date.now(),this[S.expando]=!0},S.Event.prototype={constructor:S.Event,isDefaultPrevented:ys,isPropagationStopped:ys,isImmediatePropagationStopped:ys,isSimulated:!1,preventDefault:function(){var c=this.originalEvent;this.isDefaultPrevented=ms,c&&!this.isSimulated&&c.preventDefault()},stopPropagation:function(){var c=this.originalEvent;this.isPropagationStopped=ms,c&&!this.isSimulated&&c.stopPropagation()},stopImmediatePropagation:function(){var c=this.originalEvent;this.isImmediatePropagationStopped=ms,c&&!this.isSimulated&&c.stopImmediatePropagation(),this.stopPropagation()}},S.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},S.event.addProp),S.each({focus:"focusin",blur:"focusout"},function(c,b){function x(k){if(D.documentMode){var M=Ee.get(this,"handle"),E=S.event.fix(k);E.type=k.type==="focusin"?"focus":"blur",E.isSimulated=!0,M(k),E.target===E.currentTarget&&M(E)}else S.event.simulate(b,k.target,S.event.fix(k))}S.event.special[c]={setup:function(){var k;if(Al(this,c,!0),D.documentMode)k=Ee.get(this,b),k||this.addEventListener(b,x),Ee.set(this,b,(k||0)+1);else return!1},trigger:function(){return Al(this,c),!0},teardown:function(){var k;if(D.documentMode)k=Ee.get(this,b)-1,k?Ee.set(this,b,k):(this.removeEventListener(b,x),Ee.remove(this,b));else return!1},_default:function(k){return Ee.get(k.target,c)},delegateType:b},S.event.special[b]={setup:function(){var k=this.ownerDocument||this.document||this,M=D.documentMode?this:k,E=Ee.get(M,b);E||(D.documentMode?this.addEventListener(b,x):k.addEventListener(c,x,!0)),Ee.set(M,b,(E||0)+1)},teardown:function(){var k=this.ownerDocument||this.document||this,M=D.documentMode?this:k,E=Ee.get(M,b)-1;E?Ee.set(M,b,E):(D.documentMode?this.removeEventListener(b,x):k.removeEventListener(c,x,!0),Ee.remove(M,b))}}}),S.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(c,b){S.event.special[c]={delegateType:b,bindType:b,handle:function(x){var k,M=this,E=x.relatedTarget,R=x.handleObj;return(!E||E!==M&&!S.contains(M,E))&&(x.type=R.origType,k=R.handler.apply(this,arguments),x.type=b),k}}}),S.fn.extend({on:function(c,b,x,k){return zu(this,c,b,x,k)},one:function(c,b,x,k){return zu(this,c,b,x,k,1)},off:function(c,b,x){var k,M;if(c&&c.preventDefault&&c.handleObj)return k=c.handleObj,S(c.delegateTarget).off(k.namespace?k.origType+"."+k.namespace:k.origType,k.selector,k.handler),this;if(typeof c=="object"){for(M in c)this.off(M,b,c[M]);return this}return(b===!1||typeof b=="function")&&(x=b,b=void 0),x===!1&&(x=ys),this.each(function(){S.event.remove(this,c,x,b)})}});var Gb=/<script|<style|<link/i,Wb=/checked\s*(?:[^=]|=\s*.checked.)/i,Hb=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Of(c,b){return re(c,"table")&&re(b.nodeType!==11?b:b.firstChild,"tr")&&S(c).children("tbody")[0]||c}function Ub(c){return c.type=(c.getAttribute("type")!==null)+"/"+c.type,c}function Vb(c){return(c.type||"").slice(0,5)==="true/"?c.type=c.type.slice(5):c.removeAttribute("type"),c}function Lf(c,b){var x,k,M,E,R,N,j;if(b.nodeType===1){if(Ee.hasData(c)&&(E=Ee.get(c),j=E.events,j)){Ee.remove(b,"handle events");for(M in j)for(x=0,k=j[M].length;x<k;x++)S.event.add(b,M,j[M][x])}xi.hasData(c)&&(R=xi.access(c),N=S.extend({},R),xi.set(b,N))}}function $b(c,b){var x=b.nodeName.toLowerCase();x==="input"&&ua.test(c.type)?b.checked=c.checked:(x==="input"||x==="textarea")&&(b.defaultValue=c.defaultValue)}function bs(c,b,x,k){b=a(b);var M,E,R,N,j,H,te=0,ne=c.length,Y=ne-1,ue=b[0],We=_(ue);if(We||ne>1&&typeof ue=="string"&&!w.checkClone&&Wb.test(ue))return c.each(function(at){var qe=c.eq(at);We&&(b[0]=ue.call(this,at,qe.html())),bs(qe,b,x,k)});if(ne&&(M=Ff(b,c[0].ownerDocument,!1,c,k),E=M.firstChild,M.childNodes.length===1&&(M=E),E||k)){for(R=S.map(Si(M,"script"),Ub),N=R.length;te<ne;te++)j=M,te!==Y&&(j=S.clone(j,!0,!0),N&&S.merge(R,Si(j,"script"))),x.call(c[te],j,te);if(N)for(H=R[R.length-1].ownerDocument,S.map(R,Vb),te=0;te<N;te++)j=R[te],Df.test(j.type||"")&&!Ee.access(j,"globalEval")&&S.contains(H,j)&&(j.src&&(j.type||"").toLowerCase()!=="module"?S._evalUrl&&!j.noModule&&S._evalUrl(j.src,{nonce:j.nonce||j.getAttribute("nonce")},H):O(j.textContent.replace(Hb,""),j,H))}return c}function Bf(c,b,x){for(var k,M=b?S.filter(b,c):c,E=0;(k=M[E])!=null;E++)!x&&k.nodeType===1&&S.cleanData(Si(k)),k.parentNode&&(x&&ps(k)&&Bu(Si(k,"script")),k.parentNode.removeChild(k));return c}S.extend({htmlPrefilter:function(c){return c},clone:function(c,b,x){var k,M,E,R,N=c.cloneNode(!0),j=ps(c);if(!w.noCloneChecked&&(c.nodeType===1||c.nodeType===11)&&!S.isXMLDoc(c))for(R=Si(N),E=Si(c),k=0,M=E.length;k<M;k++)$b(E[k],R[k]);if(b)if(x)for(E=E||Si(c),R=R||Si(N),k=0,M=E.length;k<M;k++)Lf(E[k],R[k]);else Lf(c,N);return R=Si(N,"script"),R.length>0&&Bu(R,!j&&Si(c,"script")),N},cleanData:function(c){for(var b,x,k,M=S.event.special,E=0;(x=c[E])!==void 0;E++)if(aa(x)){if(b=x[Ee.expando]){if(b.events)for(k in b.events)M[k]?S.event.remove(x,k):S.removeEvent(x,k,b.handle);x[Ee.expando]=void 0}x[xi.expando]&&(x[xi.expando]=void 0)}}}),S.fn.extend({detach:function(c){return Bf(this,c,!0)},remove:function(c){return Bf(this,c)},text:function(c){return wi(this,function(b){return b===void 0?S.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=b)})},null,c,arguments.length)},append:function(){return bs(this,arguments,function(c){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=Of(this,c);b.appendChild(c)}})},prepend:function(){return bs(this,arguments,function(c){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var b=Of(this,c);b.insertBefore(c,b.firstChild)}})},before:function(){return bs(this,arguments,function(c){this.parentNode&&this.parentNode.insertBefore(c,this)})},after:function(){return bs(this,arguments,function(c){this.parentNode&&this.parentNode.insertBefore(c,this.nextSibling)})},empty:function(){for(var c,b=0;(c=this[b])!=null;b++)c.nodeType===1&&(S.cleanData(Si(c,!1)),c.textContent="");return this},clone:function(c,b){return c=c??!1,b=b??c,this.map(function(){return S.clone(this,c,b)})},html:function(c){return wi(this,function(b){var x=this[0]||{},k=0,M=this.length;if(b===void 0&&x.nodeType===1)return x.innerHTML;if(typeof b=="string"&&!Gb.test(b)&&!$i[(If.exec(b)||["",""])[1].toLowerCase()]){b=S.htmlPrefilter(b);try{for(;k<M;k++)x=this[k]||{},x.nodeType===1&&(S.cleanData(Si(x,!1)),x.innerHTML=b);x=0}catch{}}x&&this.empty().append(b)},null,c,arguments.length)},replaceWith:function(){var c=[];return bs(this,arguments,function(b){var x=this.parentNode;S.inArray(this,c)<0&&(S.cleanData(Si(this)),x&&x.replaceChild(b,this))},c)}}),S.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(c,b){S.fn[c]=function(x){for(var k,M=[],E=S(x),R=E.length-1,N=0;N<=R;N++)k=N===R?this:this.clone(!0),S(E[N])[b](k),l.apply(M,k.get());return this.pushStack(M)}});var ju=new RegExp("^("+Mf+")(?!px)[a-z%]+$","i"),Nu=/^--/,Ml=function(c){var b=c.ownerDocument.defaultView;return(!b||!b.opener)&&(b=e),b.getComputedStyle(c)},zf=function(c,b,x){var k,M,E={};for(M in b)E[M]=c.style[M],c.style[M]=b[M];k=x.call(c);for(M in b)c.style[M]=E[M];return k},Xb=new RegExp(Nn.join("|"),"i");(function(){function c(){if(H){j.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",H.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Dr.appendChild(j).appendChild(H);var te=e.getComputedStyle(H);x=te.top!=="1%",N=b(te.marginLeft)===12,H.style.right="60%",E=b(te.right)===36,k=b(te.width)===36,H.style.position="absolute",M=b(H.offsetWidth/3)===12,Dr.removeChild(j),H=null}}function b(te){return Math.round(parseFloat(te))}var x,k,M,E,R,N,j=D.createElement("div"),H=D.createElement("div");H.style&&(H.style.backgroundClip="content-box",H.cloneNode(!0).style.backgroundClip="",w.clearCloneStyle=H.style.backgroundClip==="content-box",S.extend(w,{boxSizingReliable:function(){return c(),k},pixelBoxStyles:function(){return c(),E},pixelPosition:function(){return c(),x},reliableMarginLeft:function(){return c(),N},scrollboxSize:function(){return c(),M},reliableTrDimensions:function(){var te,ne,Y,ue;return R==null&&(te=D.createElement("table"),ne=D.createElement("tr"),Y=D.createElement("div"),te.style.cssText="position:absolute;left:-11111px;border-collapse:separate",ne.style.cssText="box-sizing:content-box;border:1px solid",ne.style.height="1px",Y.style.height="9px",Y.style.display="block",Dr.appendChild(te).appendChild(ne).appendChild(Y),ue=e.getComputedStyle(ne),R=parseInt(ue.height,10)+parseInt(ue.borderTopWidth,10)+parseInt(ue.borderBottomWidth,10)===ne.offsetHeight,Dr.removeChild(te)),R}}))})();function ha(c,b,x){var k,M,E,R,N=Nu.test(b),j=c.style;return x=x||Ml(c),x&&(R=x.getPropertyValue(b)||x[b],N&&R&&(R=R.replace(K,"$1")||void 0),R===""&&!ps(c)&&(R=S.style(c,b)),!w.pixelBoxStyles()&&ju.test(R)&&Xb.test(b)&&(k=j.width,M=j.minWidth,E=j.maxWidth,j.minWidth=j.maxWidth=j.width=R,R=x.width,j.width=k,j.minWidth=M,j.maxWidth=E)),R!==void 0?R+"":R}function jf(c,b){return{get:function(){if(c()){delete this.get;return}return(this.get=b).apply(this,arguments)}}}var Nf=["Webkit","Moz","ms"],Gf=D.createElement("div").style,Wf={};function Kb(c){for(var b=c[0].toUpperCase()+c.slice(1),x=Nf.length;x--;)if(c=Nf[x]+b,c in Gf)return c}function Gu(c){var b=S.cssProps[c]||Wf[c];return b||(c in Gf?c:Wf[c]=Kb(c)||c)}var qb=/^(none|table(?!-c[ea]).+)/,Yb={position:"absolute",visibility:"hidden",display:"block"},Hf={letterSpacing:"0",fontWeight:"400"};function Uf(c,b,x){var k=oa.exec(b);return k?Math.max(0,k[2]-(x||0))+(k[3]||"px"):b}function Wu(c,b,x,k,M,E){var R=b==="width"?1:0,N=0,j=0,H=0;if(x===(k?"border":"content"))return 0;for(;R<4;R+=2)x==="margin"&&(H+=S.css(c,x+Nn[R],!0,M)),k?(x==="content"&&(j-=S.css(c,"padding"+Nn[R],!0,M)),x!=="margin"&&(j-=S.css(c,"border"+Nn[R]+"Width",!0,M))):(j+=S.css(c,"padding"+Nn[R],!0,M),x!=="padding"?j+=S.css(c,"border"+Nn[R]+"Width",!0,M):N+=S.css(c,"border"+Nn[R]+"Width",!0,M));return!k&&E>=0&&(j+=Math.max(0,Math.ceil(c["offset"+b[0].toUpperCase()+b.slice(1)]-E-j-N-.5))||0),j+H}function Vf(c,b,x){var k=Ml(c),M=!w.boxSizingReliable()||x,E=M&&S.css(c,"boxSizing",!1,k)==="border-box",R=E,N=ha(c,b,k),j="offset"+b[0].toUpperCase()+b.slice(1);if(ju.test(N)){if(!x)return N;N="auto"}return(!w.boxSizingReliable()&&E||!w.reliableTrDimensions()&&re(c,"tr")||N==="auto"||!parseFloat(N)&&S.css(c,"display",!1,k)==="inline")&&c.getClientRects().length&&(E=S.css(c,"boxSizing",!1,k)==="border-box",R=j in c,R&&(N=c[j])),N=parseFloat(N)||0,N+Wu(c,b,x||(E?"border":"content"),R,k,N)+"px"}S.extend({cssHooks:{opacity:{get:function(c,b){if(b){var x=ha(c,"opacity");return x===""?"1":x}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(c,b,x,k){if(!(!c||c.nodeType===3||c.nodeType===8||!c.style)){var M,E,R,N=Sn(b),j=Nu.test(b),H=c.style;if(j||(b=Gu(N)),R=S.cssHooks[b]||S.cssHooks[N],x!==void 0){if(E=typeof x,E==="string"&&(M=oa.exec(x))&&M[1]&&(x=Ef(c,b,M),E="number"),x==null||x!==x)return;E==="number"&&!j&&(x+=M&&M[3]||(S.cssNumber[N]?"":"px")),!w.clearCloneStyle&&x===""&&b.indexOf("background")===0&&(H[b]="inherit"),(!R||!("set"in R)||(x=R.set(c,x,k))!==void 0)&&(j?H.setProperty(b,x):H[b]=x)}else return R&&"get"in R&&(M=R.get(c,!1,k))!==void 0?M:H[b]}},css:function(c,b,x,k){var M,E,R,N=Sn(b),j=Nu.test(b);return j||(b=Gu(N)),R=S.cssHooks[b]||S.cssHooks[N],R&&"get"in R&&(M=R.get(c,!0,x)),M===void 0&&(M=ha(c,b,k)),M==="normal"&&b in Hf&&(M=Hf[b]),x===""||x?(E=parseFloat(M),x===!0||isFinite(E)?E||0:M):M}}),S.each(["height","width"],function(c,b){S.cssHooks[b]={get:function(x,k,M){if(k)return qb.test(S.css(x,"display"))&&(!x.getClientRects().length||!x.getBoundingClientRect().width)?zf(x,Yb,function(){return Vf(x,b,M)}):Vf(x,b,M)},set:function(x,k,M){var E,R=Ml(x),N=!w.scrollboxSize()&&R.position==="absolute",j=N||M,H=j&&S.css(x,"boxSizing",!1,R)==="border-box",te=M?Wu(x,b,M,H,R):0;return H&&N&&(te-=Math.ceil(x["offset"+b[0].toUpperCase()+b.slice(1)]-parseFloat(R[b])-Wu(x,b,"border",!1,R)-.5)),te&&(E=oa.exec(k))&&(E[3]||"px")!=="px"&&(x.style[b]=k,k=S.css(x,b)),Uf(x,k,te)}}}),S.cssHooks.marginLeft=jf(w.reliableMarginLeft,function(c,b){if(b)return(parseFloat(ha(c,"marginLeft"))||c.getBoundingClientRect().left-zf(c,{marginLeft:0},function(){return c.getBoundingClientRect().left}))+"px"}),S.each({margin:"",padding:"",border:"Width"},function(c,b){S.cssHooks[c+b]={expand:function(x){for(var k=0,M={},E=typeof x=="string"?x.split(" "):[x];k<4;k++)M[c+Nn[k]+b]=E[k]||E[k-2]||E[0];return M}},c!=="margin"&&(S.cssHooks[c+b].set=Uf)}),S.fn.extend({css:function(c,b){return wi(this,function(x,k,M){var E,R,N={},j=0;if(Array.isArray(k)){for(E=Ml(x),R=k.length;j<R;j++)N[k[j]]=S.css(x,k[j],!1,E);return N}return M!==void 0?S.style(x,k,M):S.css(x,k)},c,b,arguments.length>1)}});function _i(c,b,x,k,M){return new _i.prototype.init(c,b,x,k,M)}S.Tween=_i,_i.prototype={constructor:_i,init:function(c,b,x,k,M,E){this.elem=c,this.prop=x,this.easing=M||S.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=k,this.unit=E||(S.cssNumber[x]?"":"px")},cur:function(){var c=_i.propHooks[this.prop];return c&&c.get?c.get(this):_i.propHooks._default.get(this)},run:function(c){var b,x=_i.propHooks[this.prop];return this.options.duration?this.pos=b=S.easing[this.easing](c,this.options.duration*c,0,1,this.options.duration):this.pos=b=c,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),x&&x.set?x.set(this):_i.propHooks._default.set(this),this}},_i.prototype.init.prototype=_i.prototype,_i.propHooks={_default:{get:function(c){var b;return c.elem.nodeType!==1||c.elem[c.prop]!=null&&c.elem.style[c.prop]==null?c.elem[c.prop]:(b=S.css(c.elem,c.prop,""),!b||b==="auto"?0:b)},set:function(c){S.fx.step[c.prop]?S.fx.step[c.prop](c):c.elem.nodeType===1&&(S.cssHooks[c.prop]||c.elem.style[Gu(c.prop)]!=null)?S.style(c.elem,c.prop,c.now+c.unit):c.elem[c.prop]=c.now}}},_i.propHooks.scrollTop=_i.propHooks.scrollLeft={set:function(c){c.elem.nodeType&&c.elem.parentNode&&(c.elem[c.prop]=c.now)}},S.easing={linear:function(c){return c},swing:function(c){return .5-Math.cos(c*Math.PI)/2},_default:"swing"},S.fx=_i.prototype.init,S.fx.step={};var vs,El,Zb=/^(?:toggle|show|hide)$/,Jb=/queueHooks$/;function Hu(){El&&(D.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(Hu):e.setTimeout(Hu,S.fx.interval),S.fx.tick())}function $f(){return e.setTimeout(function(){vs=void 0}),vs=Date.now()}function Pl(c,b){var x,k=0,M={height:c};for(b=b?1:0;k<4;k+=2-b)x=Nn[k],M["margin"+x]=M["padding"+x]=c;return b&&(M.opacity=M.width=c),M}function Xf(c,b,x){for(var k,M=(sn.tweeners[b]||[]).concat(sn.tweeners["*"]),E=0,R=M.length;E<R;E++)if(k=M[E].call(x,b,c))return k}function Qb(c,b,x){var k,M,E,R,N,j,H,te,ne="width"in b||"height"in b,Y=this,ue={},We=c.style,at=c.nodeType&&Cl(c),qe=Ee.get(c,"fxshow");x.queue||(R=S._queueHooks(c,"fx"),R.unqueued==null&&(R.unqueued=0,N=R.empty.fire,R.empty.fire=function(){R.unqueued||N()}),R.unqueued++,Y.always(function(){Y.always(function(){R.unqueued--,S.queue(c,"fx").length||R.empty.fire()})}));for(k in b)if(M=b[k],Zb.test(M)){if(delete b[k],E=E||M==="toggle",M===(at?"hide":"show"))if(M==="show"&&qe&&qe[k]!==void 0)at=!0;else continue;ue[k]=qe&&qe[k]||S.style(c,k)}if(j=!S.isEmptyObject(b),!(!j&&S.isEmptyObject(ue))){ne&&c.nodeType===1&&(x.overflow=[We.overflow,We.overflowX,We.overflowY],H=qe&&qe.display,H==null&&(H=Ee.get(c,"display")),te=S.css(c,"display"),te==="none"&&(H?te=H:(gs([c],!0),H=c.style.display||H,te=S.css(c,"display"),gs([c]))),(te==="inline"||te==="inline-block"&&H!=null)&&S.css(c,"float")==="none"&&(j||(Y.done(function(){We.display=H}),H==null&&(te=We.display,H=te==="none"?"":te)),We.display="inline-block")),x.overflow&&(We.overflow="hidden",Y.always(function(){We.overflow=x.overflow[0],We.overflowX=x.overflow[1],We.overflowY=x.overflow[2]})),j=!1;for(k in ue)j||(qe?"hidden"in qe&&(at=qe.hidden):qe=Ee.access(c,"fxshow",{display:H}),E&&(qe.hidden=!at),at&&gs([c],!0),Y.done(function(){at||gs([c]),Ee.remove(c,"fxshow");for(k in ue)S.style(c,k,ue[k])})),j=Xf(at?qe[k]:0,k,Y),k in qe||(qe[k]=j.start,at&&(j.end=j.start,j.start=0))}}function ev(c,b){var x,k,M,E,R;for(x in c)if(k=Sn(x),M=b[k],E=c[x],Array.isArray(E)&&(M=E[1],E=c[x]=E[0]),x!==k&&(c[k]=E,delete c[x]),R=S.cssHooks[k],R&&"expand"in R){E=R.expand(E),delete c[k];for(x in E)x in c||(c[x]=E[x],b[x]=M)}else b[k]=M}function sn(c,b,x){var k,M,E=0,R=sn.prefilters.length,N=S.Deferred().always(function(){delete j.elem}),j=function(){if(M)return!1;for(var ne=vs||$f(),Y=Math.max(0,H.startTime+H.duration-ne),ue=Y/H.duration||0,We=1-ue,at=0,qe=H.tweens.length;at<qe;at++)H.tweens[at].run(We);return N.notifyWith(c,[H,We,Y]),We<1&&qe?Y:(qe||N.notifyWith(c,[H,1,0]),N.resolveWith(c,[H]),!1)},H=N.promise({elem:c,props:S.extend({},b),opts:S.extend(!0,{specialEasing:{},easing:S.easing._default},x),originalProperties:b,originalOptions:x,startTime:vs||$f(),duration:x.duration,tweens:[],createTween:function(ne,Y){var ue=S.Tween(c,H.opts,ne,Y,H.opts.specialEasing[ne]||H.opts.easing);return H.tweens.push(ue),ue},stop:function(ne){var Y=0,ue=ne?H.tweens.length:0;if(M)return this;for(M=!0;Y<ue;Y++)H.tweens[Y].run(1);return ne?(N.notifyWith(c,[H,1,0]),N.resolveWith(c,[H,ne])):N.rejectWith(c,[H,ne]),this}}),te=H.props;for(ev(te,H.opts.specialEasing);E<R;E++)if(k=sn.prefilters[E].call(H,c,te,H.opts),k)return _(k.stop)&&(S._queueHooks(H.elem,H.opts.queue).stop=k.stop.bind(k)),k;return S.map(te,Xf,H),_(H.opts.start)&&H.opts.start.call(c,H),H.progress(H.opts.progress).done(H.opts.done,H.opts.complete).fail(H.opts.fail).always(H.opts.always),S.fx.timer(S.extend(j,{elem:c,anim:H,queue:H.opts.queue})),H}S.Animation=S.extend(sn,{tweeners:{"*":[function(c,b){var x=this.createTween(c,b);return Ef(x.elem,c,oa.exec(b),x),x}]},tweener:function(c,b){_(c)?(b=c,c=["*"]):c=c.match(ht);for(var x,k=0,M=c.length;k<M;k++)x=c[k],sn.tweeners[x]=sn.tweeners[x]||[],sn.tweeners[x].unshift(b)},prefilters:[Qb],prefilter:function(c,b){b?sn.prefilters.unshift(c):sn.prefilters.push(c)}}),S.speed=function(c,b,x){var k=c&&typeof c=="object"?S.extend({},c):{complete:x||!x&&b||_(c)&&c,duration:c,easing:x&&b||b&&!_(b)&&b};return S.fx.off?k.duration=0:typeof k.duration!="number"&&(k.duration in S.fx.speeds?k.duration=S.fx.speeds[k.duration]:k.duration=S.fx.speeds._default),(k.queue==null||k.queue===!0)&&(k.queue="fx"),k.old=k.complete,k.complete=function(){_(k.old)&&k.old.call(this),k.queue&&S.dequeue(this,k.queue)},k},S.fn.extend({fadeTo:function(c,b,x,k){return this.filter(Cl).css("opacity",0).show().end().animate({opacity:b},c,x,k)},animate:function(c,b,x,k){var M=S.isEmptyObject(c),E=S.speed(b,x,k),R=function(){var N=sn(this,S.extend({},c),E);(M||Ee.get(this,"finish"))&&N.stop(!0)};return R.finish=R,M||E.queue===!1?this.each(R):this.queue(E.queue,R)},stop:function(c,b,x){var k=function(M){var E=M.stop;delete M.stop,E(x)};return typeof c!="string"&&(x=b,b=c,c=void 0),b&&this.queue(c||"fx",[]),this.each(function(){var M=!0,E=c!=null&&c+"queueHooks",R=S.timers,N=Ee.get(this);if(E)N[E]&&N[E].stop&&k(N[E]);else for(E in N)N[E]&&N[E].stop&&Jb.test(E)&&k(N[E]);for(E=R.length;E--;)R[E].elem===this&&(c==null||R[E].queue===c)&&(R[E].anim.stop(x),M=!1,R.splice(E,1));(M||!x)&&S.dequeue(this,c)})},finish:function(c){return c!==!1&&(c=c||"fx"),this.each(function(){var b,x=Ee.get(this),k=x[c+"queue"],M=x[c+"queueHooks"],E=S.timers,R=k?k.length:0;for(x.finish=!0,S.queue(this,c,[]),M&&M.stop&&M.stop.call(this,!0),b=E.length;b--;)E[b].elem===this&&E[b].queue===c&&(E[b].anim.stop(!0),E.splice(b,1));for(b=0;b<R;b++)k[b]&&k[b].finish&&k[b].finish.call(this);delete x.finish})}}),S.each(["toggle","show","hide"],function(c,b){var x=S.fn[b];S.fn[b]=function(k,M,E){return k==null||typeof k=="boolean"?x.apply(this,arguments):this.animate(Pl(b,!0),k,M,E)}}),S.each({slideDown:Pl("show"),slideUp:Pl("hide"),slideToggle:Pl("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(c,b){S.fn[c]=function(x,k,M){return this.animate(b,x,k,M)}}),S.timers=[],S.fx.tick=function(){var c,b=0,x=S.timers;for(vs=Date.now();b<x.length;b++)c=x[b],!c()&&x[b]===c&&x.splice(b--,1);x.length||S.fx.stop(),vs=void 0},S.fx.timer=function(c){S.timers.push(c),S.fx.start()},S.fx.interval=13,S.fx.start=function(){El||(El=!0,Hu())},S.fx.stop=function(){El=null},S.fx.speeds={slow:600,fast:200,_default:400},S.fn.delay=function(c,b){return c=S.fx&&S.fx.speeds[c]||c,b=b||"fx",this.queue(b,function(x,k){var M=e.setTimeout(x,c);k.stop=function(){e.clearTimeout(M)}})},function(){var c=D.createElement("input"),b=D.createElement("select"),x=b.appendChild(D.createElement("option"));c.type="checkbox",w.checkOn=c.value!=="",w.optSelected=x.selected,c=D.createElement("input"),c.value="t",c.type="radio",w.radioValue=c.value==="t"}();var Kf,da=S.expr.attrHandle;S.fn.extend({attr:function(c,b){return wi(this,S.attr,c,b,arguments.length>1)},removeAttr:function(c){return this.each(function(){S.removeAttr(this,c)})}}),S.extend({attr:function(c,b,x){var k,M,E=c.nodeType;if(!(E===3||E===8||E===2)){if(typeof c.getAttribute>"u")return S.prop(c,b,x);if((E!==1||!S.isXMLDoc(c))&&(M=S.attrHooks[b.toLowerCase()]||(S.expr.match.bool.test(b)?Kf:void 0)),x!==void 0){if(x===null){S.removeAttr(c,b);return}return M&&"set"in M&&(k=M.set(c,x,b))!==void 0?k:(c.setAttribute(b,x+""),x)}return M&&"get"in M&&(k=M.get(c,b))!==null?k:(k=S.find.attr(c,b),k??void 0)}},attrHooks:{type:{set:function(c,b){if(!w.radioValue&&b==="radio"&&re(c,"input")){var x=c.value;return c.setAttribute("type",b),x&&(c.value=x),b}}}},removeAttr:function(c,b){var x,k=0,M=b&&b.match(ht);if(M&&c.nodeType===1)for(;x=M[k++];)c.removeAttribute(x)}}),Kf={set:function(c,b,x){return b===!1?S.removeAttr(c,x):c.setAttribute(x,x),x}},S.each(S.expr.match.bool.source.match(/\w+/g),function(c,b){var x=da[b]||S.find.attr;da[b]=function(k,M,E){var R,N,j=M.toLowerCase();return E||(N=da[j],da[j]=R,R=x(k,M,E)!=null?j:null,da[j]=N),R}});var tv=/^(?:input|select|textarea|button)$/i,iv=/^(?:a|area)$/i;S.fn.extend({prop:function(c,b){return wi(this,S.prop,c,b,arguments.length>1)},removeProp:function(c){return this.each(function(){delete this[S.propFix[c]||c]})}}),S.extend({prop:function(c,b,x){var k,M,E=c.nodeType;if(!(E===3||E===8||E===2))return(E!==1||!S.isXMLDoc(c))&&(b=S.propFix[b]||b,M=S.propHooks[b]),x!==void 0?M&&"set"in M&&(k=M.set(c,x,b))!==void 0?k:c[b]=x:M&&"get"in M&&(k=M.get(c,b))!==null?k:c[b]},propHooks:{tabIndex:{get:function(c){var b=S.find.attr(c,"tabindex");return b?parseInt(b,10):tv.test(c.nodeName)||iv.test(c.nodeName)&&c.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),w.optSelected||(S.propHooks.selected={get:function(c){var b=c.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(c){var b=c.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),S.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){S.propFix[this.toLowerCase()]=this});function Fr(c){var b=c.match(ht)||[];return b.join(" ")}function Rr(c){return c.getAttribute&&c.getAttribute("class")||""}function Uu(c){return Array.isArray(c)?c:typeof c=="string"?c.match(ht)||[]:[]}S.fn.extend({addClass:function(c){var b,x,k,M,E,R;return _(c)?this.each(function(N){S(this).addClass(c.call(this,N,Rr(this)))}):(b=Uu(c),b.length?this.each(function(){if(k=Rr(this),x=this.nodeType===1&&" "+Fr(k)+" ",x){for(E=0;E<b.length;E++)M=b[E],x.indexOf(" "+M+" ")<0&&(x+=M+" ");R=Fr(x),k!==R&&this.setAttribute("class",R)}}):this)},removeClass:function(c){var b,x,k,M,E,R;return _(c)?this.each(function(N){S(this).removeClass(c.call(this,N,Rr(this)))}):arguments.length?(b=Uu(c),b.length?this.each(function(){if(k=Rr(this),x=this.nodeType===1&&" "+Fr(k)+" ",x){for(E=0;E<b.length;E++)for(M=b[E];x.indexOf(" "+M+" ")>-1;)x=x.replace(" "+M+" "," ");R=Fr(x),k!==R&&this.setAttribute("class",R)}}):this):this.attr("class","")},toggleClass:function(c,b){var x,k,M,E,R=typeof c,N=R==="string"||Array.isArray(c);return _(c)?this.each(function(j){S(this).toggleClass(c.call(this,j,Rr(this),b),b)}):typeof b=="boolean"&&N?b?this.addClass(c):this.removeClass(c):(x=Uu(c),this.each(function(){if(N)for(E=S(this),M=0;M<x.length;M++)k=x[M],E.hasClass(k)?E.removeClass(k):E.addClass(k);else(c===void 0||R==="boolean")&&(k=Rr(this),k&&Ee.set(this,"__className__",k),this.setAttribute&&this.setAttribute("class",k||c===!1?"":Ee.get(this,"__className__")||""))}))},hasClass:function(c){var b,x,k=0;for(b=" "+c+" ";x=this[k++];)if(x.nodeType===1&&(" "+Fr(Rr(x))+" ").indexOf(b)>-1)return!0;return!1}});var nv=/\r/g;S.fn.extend({val:function(c){var b,x,k,M=this[0];return arguments.length?(k=_(c),this.each(function(E){var R;this.nodeType===1&&(k?R=c.call(this,E,S(this).val()):R=c,R==null?R="":typeof R=="number"?R+="":Array.isArray(R)&&(R=S.map(R,function(N){return N==null?"":N+""})),b=S.valHooks[this.type]||S.valHooks[this.nodeName.toLowerCase()],(!b||!("set"in b)||b.set(this,R,"value")===void 0)&&(this.value=R))})):M?(b=S.valHooks[M.type]||S.valHooks[M.nodeName.toLowerCase()],b&&"get"in b&&(x=b.get(M,"value"))!==void 0?x:(x=M.value,typeof x=="string"?x.replace(nv,""):x??"")):void 0}}),S.extend({valHooks:{option:{get:function(c){var b=S.find.attr(c,"value");return b??Fr(S.text(c))}},select:{get:function(c){var b,x,k,M=c.options,E=c.selectedIndex,R=c.type==="select-one",N=R?null:[],j=R?E+1:M.length;for(E<0?k=j:k=R?E:0;k<j;k++)if(x=M[k],(x.selected||k===E)&&!x.disabled&&(!x.parentNode.disabled||!re(x.parentNode,"optgroup"))){if(b=S(x).val(),R)return b;N.push(b)}return N},set:function(c,b){for(var x,k,M=c.options,E=S.makeArray(b),R=M.length;R--;)k=M[R],(k.selected=S.inArray(S.valHooks.option.get(k),E)>-1)&&(x=!0);return x||(c.selectedIndex=-1),E}}}}),S.each(["radio","checkbox"],function(){S.valHooks[this]={set:function(c,b){if(Array.isArray(b))return c.checked=S.inArray(S(c).val(),b)>-1}},w.checkOn||(S.valHooks[this].get=function(c){return c.getAttribute("value")===null?"on":c.value})});var ca=e.location,qf={guid:Date.now()},Vu=/\?/;S.parseXML=function(c){var b,x;if(!c||typeof c!="string")return null;try{b=new e.DOMParser().parseFromString(c,"text/xml")}catch{}return x=b&&b.getElementsByTagName("parsererror")[0],(!b||x)&&S.error("Invalid XML: "+(x?S.map(x.childNodes,function(k){return k.textContent}).join(`
`):c)),b};var Yf=/^(?:focusinfocus|focusoutblur)$/,Zf=function(c){c.stopPropagation()};S.extend(S.event,{trigger:function(c,b,x,k){var M,E,R,N,j,H,te,ne,Y=[x||D],ue=d.call(c,"type")?c.type:c,We=d.call(c,"namespace")?c.namespace.split("."):[];if(E=ne=R=x=x||D,!(x.nodeType===3||x.nodeType===8)&&!Yf.test(ue+S.event.triggered)&&(ue.indexOf(".")>-1&&(We=ue.split("."),ue=We.shift(),We.sort()),j=ue.indexOf(":")<0&&"on"+ue,c=c[S.expando]?c:new S.Event(ue,typeof c=="object"&&c),c.isTrigger=k?2:3,c.namespace=We.join("."),c.rnamespace=c.namespace?new RegExp("(^|\\.)"+We.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=void 0,c.target||(c.target=x),b=b==null?[c]:S.makeArray(b,[c]),te=S.event.special[ue]||{},!(!k&&te.trigger&&te.trigger.apply(x,b)===!1))){if(!k&&!te.noBubble&&!T(x)){for(N=te.delegateType||ue,Yf.test(N+ue)||(E=E.parentNode);E;E=E.parentNode)Y.push(E),R=E;R===(x.ownerDocument||D)&&Y.push(R.defaultView||R.parentWindow||e)}for(M=0;(E=Y[M++])&&!c.isPropagationStopped();)ne=E,c.type=M>1?N:te.bindType||ue,H=(Ee.get(E,"events")||Object.create(null))[c.type]&&Ee.get(E,"handle"),H&&H.apply(E,b),H=j&&E[j],H&&H.apply&&aa(E)&&(c.result=H.apply(E,b),c.result===!1&&c.preventDefault());return c.type=ue,!k&&!c.isDefaultPrevented()&&(!te._default||te._default.apply(Y.pop(),b)===!1)&&aa(x)&&j&&_(x[ue])&&!T(x)&&(R=x[j],R&&(x[j]=null),S.event.triggered=ue,c.isPropagationStopped()&&ne.addEventListener(ue,Zf),x[ue](),c.isPropagationStopped()&&ne.removeEventListener(ue,Zf),S.event.triggered=void 0,R&&(x[j]=R)),c.result}},simulate:function(c,b,x){var k=S.extend(new S.Event,x,{type:c,isSimulated:!0});S.event.trigger(k,null,b)}}),S.fn.extend({trigger:function(c,b){return this.each(function(){S.event.trigger(c,b,this)})},triggerHandler:function(c,b){var x=this[0];if(x)return S.event.trigger(c,b,x,!0)}});var rv=/\[\]$/,Jf=/\r?\n/g,sv=/^(?:submit|button|image|reset|file)$/i,av=/^(?:input|select|textarea|keygen)/i;function $u(c,b,x,k){var M;if(Array.isArray(b))S.each(b,function(E,R){x||rv.test(c)?k(c,R):$u(c+"["+(typeof R=="object"&&R!=null?E:"")+"]",R,x,k)});else if(!x&&z(b)==="object")for(M in b)$u(c+"["+M+"]",b[M],x,k);else k(c,b)}S.param=function(c,b){var x,k=[],M=function(E,R){var N=_(R)?R():R;k[k.length]=encodeURIComponent(E)+"="+encodeURIComponent(N??"")};if(c==null)return"";if(Array.isArray(c)||c.jquery&&!S.isPlainObject(c))S.each(c,function(){M(this.name,this.value)});else for(x in c)$u(x,c[x],b,M);return k.join("&")},S.fn.extend({serialize:function(){return S.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var c=S.prop(this,"elements");return c?S.makeArray(c):this}).filter(function(){var c=this.type;return this.name&&!S(this).is(":disabled")&&av.test(this.nodeName)&&!sv.test(c)&&(this.checked||!ua.test(c))}).map(function(c,b){var x=S(this).val();return x==null?null:Array.isArray(x)?S.map(x,function(k){return{name:b.name,value:k.replace(Jf,`\r
`)}}):{name:b.name,value:x.replace(Jf,`\r
`)}}).get()}});var lv=/%20/g,ov=/#.*$/,uv=/([?&])_=[^&]*/,hv=/^(.*?):[ \t]*([^\r\n]*)$/mg,dv=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,cv=/^(?:GET|HEAD)$/,fv=/^\/\//,Qf={},Xu={},ep="*/".concat("*"),Ku=D.createElement("a");Ku.href=ca.href;function tp(c){return function(b,x){typeof b!="string"&&(x=b,b="*");var k,M=0,E=b.toLowerCase().match(ht)||[];if(_(x))for(;k=E[M++];)k[0]==="+"?(k=k.slice(1)||"*",(c[k]=c[k]||[]).unshift(x)):(c[k]=c[k]||[]).push(x)}}function ip(c,b,x,k){var M={},E=c===Xu;function R(N){var j;return M[N]=!0,S.each(c[N]||[],function(H,te){var ne=te(b,x,k);if(typeof ne=="string"&&!E&&!M[ne])return b.dataTypes.unshift(ne),R(ne),!1;if(E)return!(j=ne)}),j}return R(b.dataTypes[0])||!M["*"]&&R("*")}function qu(c,b){var x,k,M=S.ajaxSettings.flatOptions||{};for(x in b)b[x]!==void 0&&((M[x]?c:k||(k={}))[x]=b[x]);return k&&S.extend(!0,c,k),c}function pv(c,b,x){for(var k,M,E,R,N=c.contents,j=c.dataTypes;j[0]==="*";)j.shift(),k===void 0&&(k=c.mimeType||b.getResponseHeader("Content-Type"));if(k){for(M in N)if(N[M]&&N[M].test(k)){j.unshift(M);break}}if(j[0]in x)E=j[0];else{for(M in x){if(!j[0]||c.converters[M+" "+j[0]]){E=M;break}R||(R=M)}E=E||R}if(E)return E!==j[0]&&j.unshift(E),x[E]}function gv(c,b,x,k){var M,E,R,N,j,H={},te=c.dataTypes.slice();if(te[1])for(R in c.converters)H[R.toLowerCase()]=c.converters[R];for(E=te.shift();E;)if(c.responseFields[E]&&(x[c.responseFields[E]]=b),!j&&k&&c.dataFilter&&(b=c.dataFilter(b,c.dataType)),j=E,E=te.shift(),E){if(E==="*")E=j;else if(j!=="*"&&j!==E){if(R=H[j+" "+E]||H["* "+E],!R){for(M in H)if(N=M.split(" "),N[1]===E&&(R=H[j+" "+N[0]]||H["* "+N[0]],R)){R===!0?R=H[M]:H[M]!==!0&&(E=N[0],te.unshift(N[1]));break}}if(R!==!0)if(R&&c.throws)b=R(b);else try{b=R(b)}catch(ne){return{state:"parsererror",error:R?ne:"No conversion from "+j+" to "+E}}}}return{state:"success",data:b}}S.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ca.href,type:"GET",isLocal:dv.test(ca.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ep,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":S.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(c,b){return b?qu(qu(c,S.ajaxSettings),b):qu(S.ajaxSettings,c)},ajaxPrefilter:tp(Qf),ajaxTransport:tp(Xu),ajax:function(c,b){typeof c=="object"&&(b=c,c=void 0),b=b||{};var x,k,M,E,R,N,j,H,te,ne,Y=S.ajaxSetup({},b),ue=Y.context||Y,We=Y.context&&(ue.nodeType||ue.jquery)?S(ue):S.event,at=S.Deferred(),qe=S.Callbacks("once memory"),ti=Y.statusCode||{},Ht={},_n={},kn="canceled",rt={readyState:0,getResponseHeader:function(ot){var Pt;if(j){if(!E)for(E={};Pt=hv.exec(M);)E[Pt[1].toLowerCase()+" "]=(E[Pt[1].toLowerCase()+" "]||[]).concat(Pt[2]);Pt=E[ot.toLowerCase()+" "]}return Pt==null?null:Pt.join(", ")},getAllResponseHeaders:function(){return j?M:null},setRequestHeader:function(ot,Pt){return j==null&&(ot=_n[ot.toLowerCase()]=_n[ot.toLowerCase()]||ot,Ht[ot]=Pt),this},overrideMimeType:function(ot){return j==null&&(Y.mimeType=ot),this},statusCode:function(ot){var Pt;if(ot)if(j)rt.always(ot[rt.status]);else for(Pt in ot)ti[Pt]=[ti[Pt],ot[Pt]];return this},abort:function(ot){var Pt=ot||kn;return x&&x.abort(Pt),Or(0,Pt),this}};if(at.promise(rt),Y.url=((c||Y.url||ca.href)+"").replace(fv,ca.protocol+"//"),Y.type=b.method||b.type||Y.method||Y.type,Y.dataTypes=(Y.dataType||"*").toLowerCase().match(ht)||[""],Y.crossDomain==null){N=D.createElement("a");try{N.href=Y.url,N.href=N.href,Y.crossDomain=Ku.protocol+"//"+Ku.host!=N.protocol+"//"+N.host}catch{Y.crossDomain=!0}}if(Y.data&&Y.processData&&typeof Y.data!="string"&&(Y.data=S.param(Y.data,Y.traditional)),ip(Qf,Y,b,rt),j)return rt;H=S.event&&Y.global,H&&S.active++===0&&S.event.trigger("ajaxStart"),Y.type=Y.type.toUpperCase(),Y.hasContent=!cv.test(Y.type),k=Y.url.replace(ov,""),Y.hasContent?Y.data&&Y.processData&&(Y.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(Y.data=Y.data.replace(lv,"+")):(ne=Y.url.slice(k.length),Y.data&&(Y.processData||typeof Y.data=="string")&&(k+=(Vu.test(k)?"&":"?")+Y.data,delete Y.data),Y.cache===!1&&(k=k.replace(uv,"$1"),ne=(Vu.test(k)?"&":"?")+"_="+qf.guid+++ne),Y.url=k+ne),Y.ifModified&&(S.lastModified[k]&&rt.setRequestHeader("If-Modified-Since",S.lastModified[k]),S.etag[k]&&rt.setRequestHeader("If-None-Match",S.etag[k])),(Y.data&&Y.hasContent&&Y.contentType!==!1||b.contentType)&&rt.setRequestHeader("Content-Type",Y.contentType),rt.setRequestHeader("Accept",Y.dataTypes[0]&&Y.accepts[Y.dataTypes[0]]?Y.accepts[Y.dataTypes[0]]+(Y.dataTypes[0]!=="*"?", "+ep+"; q=0.01":""):Y.accepts["*"]);for(te in Y.headers)rt.setRequestHeader(te,Y.headers[te]);if(Y.beforeSend&&(Y.beforeSend.call(ue,rt,Y)===!1||j))return rt.abort();if(kn="abort",qe.add(Y.complete),rt.done(Y.success),rt.fail(Y.error),x=ip(Xu,Y,b,rt),!x)Or(-1,"No Transport");else{if(rt.readyState=1,H&&We.trigger("ajaxSend",[rt,Y]),j)return rt;Y.async&&Y.timeout>0&&(R=e.setTimeout(function(){rt.abort("timeout")},Y.timeout));try{j=!1,x.send(Ht,Or)}catch(ot){if(j)throw ot;Or(-1,ot)}}function Or(ot,Pt,pa,Zu){var Tn,ga,Cn,or,ur,Xi=Pt;j||(j=!0,R&&e.clearTimeout(R),x=void 0,M=Zu||"",rt.readyState=ot>0?4:0,Tn=ot>=200&&ot<300||ot===304,pa&&(or=pv(Y,rt,pa)),!Tn&&S.inArray("script",Y.dataTypes)>-1&&S.inArray("json",Y.dataTypes)<0&&(Y.converters["text script"]=function(){}),or=gv(Y,or,rt,Tn),Tn?(Y.ifModified&&(ur=rt.getResponseHeader("Last-Modified"),ur&&(S.lastModified[k]=ur),ur=rt.getResponseHeader("etag"),ur&&(S.etag[k]=ur)),ot===204||Y.type==="HEAD"?Xi="nocontent":ot===304?Xi="notmodified":(Xi=or.state,ga=or.data,Cn=or.error,Tn=!Cn)):(Cn=Xi,(ot||!Xi)&&(Xi="error",ot<0&&(ot=0))),rt.status=ot,rt.statusText=(Pt||Xi)+"",Tn?at.resolveWith(ue,[ga,Xi,rt]):at.rejectWith(ue,[rt,Xi,Cn]),rt.statusCode(ti),ti=void 0,H&&We.trigger(Tn?"ajaxSuccess":"ajaxError",[rt,Y,Tn?ga:Cn]),qe.fireWith(ue,[rt,Xi]),H&&(We.trigger("ajaxComplete",[rt,Y]),--S.active||S.event.trigger("ajaxStop")))}return rt},getJSON:function(c,b,x){return S.get(c,b,x,"json")},getScript:function(c,b){return S.get(c,void 0,b,"script")}}),S.each(["get","post"],function(c,b){S[b]=function(x,k,M,E){return _(k)&&(E=E||M,M=k,k=void 0),S.ajax(S.extend({url:x,type:b,dataType:E,data:k,success:M},S.isPlainObject(x)&&x))}}),S.ajaxPrefilter(function(c){var b;for(b in c.headers)b.toLowerCase()==="content-type"&&(c.contentType=c.headers[b]||"")}),S._evalUrl=function(c,b,x){return S.ajax({url:c,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(k){S.globalEval(k,b,x)}})},S.fn.extend({wrapAll:function(c){var b;return this[0]&&(_(c)&&(c=c.call(this[0])),b=S(c,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var x=this;x.firstElementChild;)x=x.firstElementChild;return x}).append(this)),this},wrapInner:function(c){return _(c)?this.each(function(b){S(this).wrapInner(c.call(this,b))}):this.each(function(){var b=S(this),x=b.contents();x.length?x.wrapAll(c):b.append(c)})},wrap:function(c){var b=_(c);return this.each(function(x){S(this).wrapAll(b?c.call(this,x):c)})},unwrap:function(c){return this.parent(c).not("body").each(function(){S(this).replaceWith(this.childNodes)}),this}}),S.expr.pseudos.hidden=function(c){return!S.expr.pseudos.visible(c)},S.expr.pseudos.visible=function(c){return!!(c.offsetWidth||c.offsetHeight||c.getClientRects().length)},S.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var mv={0:200,1223:204},fa=S.ajaxSettings.xhr();w.cors=!!fa&&"withCredentials"in fa,w.ajax=fa=!!fa,S.ajaxTransport(function(c){var b,x;if(w.cors||fa&&!c.crossDomain)return{send:function(k,M){var E,R=c.xhr();if(R.open(c.type,c.url,c.async,c.username,c.password),c.xhrFields)for(E in c.xhrFields)R[E]=c.xhrFields[E];c.mimeType&&R.overrideMimeType&&R.overrideMimeType(c.mimeType),!c.crossDomain&&!k["X-Requested-With"]&&(k["X-Requested-With"]="XMLHttpRequest");for(E in k)R.setRequestHeader(E,k[E]);b=function(N){return function(){b&&(b=x=R.onload=R.onerror=R.onabort=R.ontimeout=R.onreadystatechange=null,N==="abort"?R.abort():N==="error"?typeof R.status!="number"?M(0,"error"):M(R.status,R.statusText):M(mv[R.status]||R.status,R.statusText,(R.responseType||"text")!=="text"||typeof R.responseText!="string"?{binary:R.response}:{text:R.responseText},R.getAllResponseHeaders()))}},R.onload=b(),x=R.onerror=R.ontimeout=b("error"),R.onabort!==void 0?R.onabort=x:R.onreadystatechange=function(){R.readyState===4&&e.setTimeout(function(){b&&x()})},b=b("abort");try{R.send(c.hasContent&&c.data||null)}catch(N){if(b)throw N}},abort:function(){b&&b()}}}),S.ajaxPrefilter(function(c){c.crossDomain&&(c.contents.script=!1)}),S.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(c){return S.globalEval(c),c}}}),S.ajaxPrefilter("script",function(c){c.cache===void 0&&(c.cache=!1),c.crossDomain&&(c.type="GET")}),S.ajaxTransport("script",function(c){if(c.crossDomain||c.scriptAttrs){var b,x;return{send:function(k,M){b=S("<script>").attr(c.scriptAttrs||{}).prop({charset:c.scriptCharset,src:c.url}).on("load error",x=function(E){b.remove(),x=null,E&&M(E.type==="error"?404:200,E.type)}),D.head.appendChild(b[0])},abort:function(){x&&x()}}}});var np=[],Yu=/(=)\?(?=&|$)|\?\?/;S.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var c=np.pop()||S.expando+"_"+qf.guid++;return this[c]=!0,c}}),S.ajaxPrefilter("json jsonp",function(c,b,x){var k,M,E,R=c.jsonp!==!1&&(Yu.test(c.url)?"url":typeof c.data=="string"&&(c.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Yu.test(c.data)&&"data");if(R||c.dataTypes[0]==="jsonp")return k=c.jsonpCallback=_(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,R?c[R]=c[R].replace(Yu,"$1"+k):c.jsonp!==!1&&(c.url+=(Vu.test(c.url)?"&":"?")+c.jsonp+"="+k),c.converters["script json"]=function(){return E||S.error(k+" was not called"),E[0]},c.dataTypes[0]="json",M=e[k],e[k]=function(){E=arguments},x.always(function(){M===void 0?S(e).removeProp(k):e[k]=M,c[k]&&(c.jsonpCallback=b.jsonpCallback,np.push(k)),E&&_(M)&&M(E[0]),E=M=void 0}),"script"}),w.createHTMLDocument=function(){var c=D.implementation.createHTMLDocument("").body;return c.innerHTML="<form></form><form></form>",c.childNodes.length===2}(),S.parseHTML=function(c,b,x){if(typeof c!="string")return[];typeof b=="boolean"&&(x=b,b=!1);var k,M,E;return b||(w.createHTMLDocument?(b=D.implementation.createHTMLDocument(""),k=b.createElement("base"),k.href=D.location.href,b.head.appendChild(k)):b=D),M=Xe.exec(c),E=!x&&[],M?[b.createElement(M[1])]:(M=Ff([c],b,E),E&&E.length&&S(E).remove(),S.merge([],M.childNodes))},S.fn.load=function(c,b,x){var k,M,E,R=this,N=c.indexOf(" ");return N>-1&&(k=Fr(c.slice(N)),c=c.slice(0,N)),_(b)?(x=b,b=void 0):b&&typeof b=="object"&&(M="POST"),R.length>0&&S.ajax({url:c,type:M||"GET",dataType:"html",data:b}).done(function(j){E=arguments,R.html(k?S("<div>").append(S.parseHTML(j)).find(k):j)}).always(x&&function(j,H){R.each(function(){x.apply(this,E||[j.responseText,H,j])})}),this},S.expr.pseudos.animated=function(c){return S.grep(S.timers,function(b){return c===b.elem}).length},S.offset={setOffset:function(c,b,x){var k,M,E,R,N,j,H,te=S.css(c,"position"),ne=S(c),Y={};te==="static"&&(c.style.position="relative"),N=ne.offset(),E=S.css(c,"top"),j=S.css(c,"left"),H=(te==="absolute"||te==="fixed")&&(E+j).indexOf("auto")>-1,H?(k=ne.position(),R=k.top,M=k.left):(R=parseFloat(E)||0,M=parseFloat(j)||0),_(b)&&(b=b.call(c,x,S.extend({},N))),b.top!=null&&(Y.top=b.top-N.top+R),b.left!=null&&(Y.left=b.left-N.left+M),"using"in b?b.using.call(c,Y):ne.css(Y)}},S.fn.extend({offset:function(c){if(arguments.length)return c===void 0?this:this.each(function(M){S.offset.setOffset(this,c,M)});var b,x,k=this[0];if(k)return k.getClientRects().length?(b=k.getBoundingClientRect(),x=k.ownerDocument.defaultView,{top:b.top+x.pageYOffset,left:b.left+x.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var c,b,x,k=this[0],M={top:0,left:0};if(S.css(k,"position")==="fixed")b=k.getBoundingClientRect();else{for(b=this.offset(),x=k.ownerDocument,c=k.offsetParent||x.documentElement;c&&(c===x.body||c===x.documentElement)&&S.css(c,"position")==="static";)c=c.parentNode;c&&c!==k&&c.nodeType===1&&(M=S(c).offset(),M.top+=S.css(c,"borderTopWidth",!0),M.left+=S.css(c,"borderLeftWidth",!0))}return{top:b.top-M.top-S.css(k,"marginTop",!0),left:b.left-M.left-S.css(k,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var c=this.offsetParent;c&&S.css(c,"position")==="static";)c=c.offsetParent;return c||Dr})}}),S.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,b){var x=b==="pageYOffset";S.fn[c]=function(k){return wi(this,function(M,E,R){var N;if(T(M)?N=M:M.nodeType===9&&(N=M.defaultView),R===void 0)return N?N[b]:M[E];N?N.scrollTo(x?N.pageXOffset:R,x?R:N.pageYOffset):M[E]=R},c,k,arguments.length)}}),S.each(["top","left"],function(c,b){S.cssHooks[b]=jf(w.pixelPosition,function(x,k){if(k)return k=ha(x,b),ju.test(k)?S(x).position()[b]+"px":k})}),S.each({Height:"height",Width:"width"},function(c,b){S.each({padding:"inner"+c,content:b,"":"outer"+c},function(x,k){S.fn[k]=function(M,E){var R=arguments.length&&(x||typeof M!="boolean"),N=x||(M===!0||E===!0?"margin":"border");return wi(this,function(j,H,te){var ne;return T(j)?k.indexOf("outer")===0?j["inner"+c]:j.document.documentElement["client"+c]:j.nodeType===9?(ne=j.documentElement,Math.max(j.body["scroll"+c],ne["scroll"+c],j.body["offset"+c],ne["offset"+c],ne["client"+c])):te===void 0?S.css(j,H,N):S.style(j,H,te,N)},b,R?M:void 0,R)}})}),S.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(c,b){S.fn[b]=function(x){return this.on(b,x)}}),S.fn.extend({bind:function(c,b,x){return this.on(c,null,b,x)},unbind:function(c,b){return this.off(c,null,b)},delegate:function(c,b,x,k){return this.on(b,c,x,k)},undelegate:function(c,b,x){return arguments.length===1?this.off(c,"**"):this.off(b,c||"**",x)},hover:function(c,b){return this.on("mouseenter",c).on("mouseleave",b||c)}}),S.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(c,b){S.fn[b]=function(x,k){return arguments.length>0?this.on(b,null,x,k):this.trigger(b)}});var yv=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;S.proxy=function(c,b){var x,k,M;if(typeof b=="string"&&(x=c[b],b=c,c=x),!!_(c))return k=s.call(arguments,2),M=function(){return c.apply(b||this,k.concat(s.call(arguments)))},M.guid=c.guid=c.guid||S.guid++,M},S.holdReady=function(c){c?S.readyWait++:S.ready(!0)},S.isArray=Array.isArray,S.parseJSON=JSON.parse,S.nodeName=re,S.isFunction=_,S.isWindow=T,S.camelCase=Sn,S.type=z,S.now=Date.now,S.isNumeric=function(c){var b=S.type(c);return(b==="number"||b==="string")&&!isNaN(c-parseFloat(c))},S.trim=function(c){return c==null?"":(c+"").replace(yv,"$1")};var bv=e.jQuery,vv=e.$;return S.noConflict=function(c){return e.$===S&&(e.$=vv),c&&e.jQuery===S&&(e.jQuery=bv),S},typeof t>"u"&&(e.jQuery=e.$=S),S})})(dm);var cw=dm.exports;const I=mc(cw);class fw{constructor(e,t){y(this,"color","");y(this,"lastSpan","");y(this,"$lastSpan");y(this,"$lastDiv");y(this,"$outputDiv");y(this,"maxLines",2e3);y(this,"$lines",[]);y(this,"newLines",0);y(this,"printCommands",[]);y(this,"currentLinelength",0);y(this,"beginOfLineState",!0);this.$runDiv=e,this.main=t,I(()=>{this.$outputDiv=e.find(".jo_output"),this.clear();let i=this,n=0,s=!1,a=performance.now();setInterval(()=>{i.printCommands.length>0&&(i.doPrinting(),performance.now()-a>200?i.$outputDiv[0].scrollTop=i.$outputDiv[0].scrollHeight:s=!0,a=performance.now()),n++%20==0&&s&&setTimeout(()=>{i.$outputDiv[0].scrollTop=i.$outputDiv[0].scrollHeight,s=!1},200)},50)})}getGraphicsDiv(){return this.$runDiv.find(".jo_graphics")}showProgramEnd(){let e=this.$runDiv.find(".jo_run-programend");e.show(),e.addClass("jo_programendkf"),setTimeout(()=>{e.removeClass("jo_programendkf"),e.hide()},3e3)}doPrinting(){if(this.newLines>=this.maxLines){this.$outputDiv.empty();let e=this.printCommands.length-1,t=0;for(;e>=0;){if(this.printCommands[e].newLine&&(t++,t>=this.maxLines)){this.printCommands.splice(0,e+1);break}e--}}this.newLines=0,this.$lastSpan!=null&&(this.$lastSpan.remove(),this.lastSpan.endsWith("</span>")&&(this.lastSpan=this.lastSpan.substring(0,this.lastSpan.length-7)));for(let e of this.printCommands)if(this.beginOfLineState&&e.text.startsWith(" ")?e.text.match(/^( *)(.*)$/)[2].length>0&&(this.beginOfLineState=!1):e.text.length>0&&(this.beginOfLineState=!1),e.text=e.text.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.color==null&&(e.color="var(--defaultOutputColor)"),(this.lastSpan==""||this.color!=e.color)&&(this.lastSpan!=""&&(this.lastSpan+="</span>"),this.lastSpan+='<span style="color: '+e.color+'">',e.newLine&&e.text==""&&(this.lastSpan+="​"),this.color=e.color),this.currentLinelength<=1e4&&(this.lastSpan+=e.text,this.currentLinelength+=e.text.length),e.newLine){this.beginOfLineState=!0,this.lastSpan.endsWith("</span>")||(this.lastSpan+="</span>"),this.$lastSpan=I(this.lastSpan),this.$lastDiv.append(this.$lastSpan),this.lastSpan="",this.$lastSpan=null,this.$lastDiv=I("<div></div>");let t=this.main.getInterpreter().inputManager.$input;t!=null?this.$lastDiv.insertBefore(t):this.$outputDiv.append(this.$lastDiv),this.$lines.push(this.$lastDiv),this.currentLinelength=0}if(this.lastSpan!=""&&(this.lastSpan.endsWith("</span>")||(this.lastSpan+="</span>"),this.$lastSpan=I(this.lastSpan),this.$lastDiv.append(this.$lastSpan)),this.$lines.length>this.maxLines*1.5){let e=this,t=e.$lines.length-e.maxLines,i=e.$lines.splice(0,t);for(let n of i)n.remove()}this.printCommands=[]}clear(){this.$outputDiv.empty(),this.$lastDiv=I("<div></div>"),this.$lines.push(this.$lastDiv),this.$outputDiv.append(this.$lastDiv),this.currentLinelength=0,this.color="",this.lastSpan="",this.printCommands=[]}print(e,t){if(e!=null){if(typeof t=="number"){for(t=t.toString(16);t.length<6;)t="0"+t;t="#"+t}if(e=e.toString(),e.indexOf(`
`)>=0){let i=e.split(`
`);for(let n=0;n<i.length;n++){let s=i[n],a=n<i.length-1;s==""&&n==i.length-1||(this.printCommands.push({text:s,color:t,newLine:a}),a&&this.newLines++)}}else this.printCommands.push({text:e,color:t,newLine:!1})}}println(e,t){e==null&&(e=""),this.print(e+`
`,t)}}class pw{constructor(e,t){y(this,"$input");this.$runDiv=e,this.main=t}readInput(e,t,i){let n=e.getReturnType(),s=t[1].value,a=t.length==3?t[2].value:null,l=this.main.getInterpreter().printManager;s!=null&&s!=""&&(l.beginOfLineState=!0,l.println(`
`+s),l.doPrinting()),this.$input=I('<input class="jo_newInput" type="text"/>'),l.$outputDiv.append(this.$input);let u=a??"";this.$input.val(u);let h=this;this.$input.on("keydown",d=>{d.key=="Enter"&&h.onSubmit(n,i)}),setTimeout(()=>{h.$input.focus()},200),l.$outputDiv.on("mousedown.inputmanager",d=>{setTimeout(()=>{var p;(p=h.$input)==null||p.focus()},200)})}onSubmit(e,t){let i=this.$input.val(),n=this.main.getInterpreter().printManager,s=this.parse(i,e);if(s.error!=null){this.$input.detach(),n.println(s.error,"#ff0000"),n.doPrinting(),n.$outputDiv.append(this.$input),this.$input[0].scrollIntoView(),this.$input.focus();return}n.$outputDiv.off("mousedown.inputmanager"),n.println(i),this.$input.off("keydown"),this.hide(),t(s.value)}parse(e,t){if(t==F)return{error:null,value:{value:e,type:t}};if(t==Ge)return e.length==0?{error:"Leere Eingabe. Erwartet wird ein Zeichen.",value:null}:e.length>1?{error:"Zu lange Eingabe. Erwartet wird ein Zeichen.",value:null}:{error:null,value:{value:e,type:t}};if(t==P)return e!="true"&&e!="false"?{error:"Erwartet wird true oder false.",value:null}:{error:null,value:{value:e=="true",type:t}};e=e.replace(",",".");let i=Number(e);return i==null?{error:"Erwartet wird eine Zahl.",value:null}:t==C?i!=Math.round(i)?{error:"Erwartet wird eine ganze Zahl.",value:null}:{error:null,value:{value:Math.round(i),type:t}}:{error:null,value:{value:i,type:t}}}hide(){this.$input!=null&&(this.$input.remove(),this.$input=null)}}class Kr{}y(Kr,"sqlIdeURL","");let gw=class{fetchTemplateFromCache(e,t){if(e==null){t(null);return}let i=this;this.cacheAvailable()||t(null),this.getCache(n=>{n.match(i.databaseIdToCacheIdentifier(e)).then(s=>{s.arrayBuffer().then(a=>t(new Uint8Array(a)))}).catch(()=>t(null))})}saveTemplateToCache(e,t){if(!this.cacheAvailable())return;let i=this;this.getCache(n=>{n.put(i.databaseIdToCacheIdentifier(e),new Response(t))})}cacheAvailable(){return"caches"in self}getCache(e){caches.open("my-cache").then(e)}databaseIdToCacheIdentifier(e){return"/onlineIdeTemplateDb"+e}};class cm{constructor(e,t){y(this,"nextStrategy");this.name=e,this.manager=t}}class mw extends cm{constructor(t){super("long-polling strategy",t);y(this,"isClosed");y(this,"csrfToken");y(this,"shortestTimeoutMs",6e4);y(this,"timeOpened",null);y(this,"abortController");this.isClosed=!1}open(){this.isClosed=!1,this.abortController=new AbortController,this.timeOpened=performance.now();let t=[["content-type","text/json"]];t.push(["x-token-pm",Bt]),this.csrfToken=Bt,t.push(["x-timeout",this.shortestTimeoutMs+""]);try{fetch("/servlet/registerLongpollingListener",{signal:this.abortController.signal,method:"POST",headers:t,body:JSON.stringify({})}).then(i=>{if(i.status!=200){console.log(`Long-polling listener got http-status: ${i.status} (${i.statusText})`);let n=Math.round(performance.now()-this.timeOpened)-4e3;n<this.shortestTimeoutMs&&(this.shortestTimeoutMs=n)}switch(i.status){case 200:i.json().then(n=>{this.manager.onMessage(n)}),this.reopen();break;case 502:case 504:this.reopen(1e3,!1);break;case 401:console.log("PushClientLongPollingStrategy: Got http status code 401, therefore stopping.");break;default:this.reopen(1e4,!1);break}}).catch(i=>{console.log(`Long-polling listener failed due to reason: ${i}`),this.reopen(1e4,!1)}).finally(()=>{this.abortController=null})}catch{this.reopen(1e4,!1)}}reopen(t=500,i=!0){this.isClosed||(t>500&&console.log(`Reopen long-polling listener in ${t/1e3} seconds...`),setTimeout(()=>{this.isClosed||this.open()},t))}async close(){var i;this.isClosed=!0,(i=this.abortController)==null||i.abort();let t=[["content-type","text/json"]];t.push(["x-token-pm",this.csrfToken]),await fetch("/servlet/unregisterLongpollingListener",{method:"POST",headers:t,body:JSON.stringify({})})}}class yw extends cm{constructor(t){super("websocket strategy",t);y(this,"csrfToken");y(this,"websocket");y(this,"isClosed");y(this,"openedTimestamp");y(this,"currentTimer")}open(){this.isClosed=!1;try{let t=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/pushWebsocket?csrfToken="+Bt;this.websocket=new WebSocket(t),this.websocket.onopen=i=>{this.openedTimestamp=performance.now()},this.websocket.onclose=i=>{console.log("Websocket has been closed, code: "+i.code+", reason: "+i.reason),this.isClosed=!0,i.code==1001&&performance.now()-this.openedTimestamp>1e4?(console.log("Reason was timeout, dt > 10s => Reopen!"),this.open()):(this.manager.onStrategyFailed(this),this.isClosed=!0)},this.websocket.onerror=i=>{console.log("Error on websocket, type: "+i.type),this.websocket.close(),this.manager.onStrategyFailed(this),this.isClosed=!0},this.websocket.onmessage=i=>{if(i.data=="pong")return;const n=JSON.parse(i.data);this.manager.onMessage(n)},this.currentTimer!=null&&clearTimeout(this.currentTimer),this.doPing()}catch{this.manager.onStrategyFailed(this),this.isClosed=!0}}doPing(){this.currentTimer=setTimeout(()=>{this.isClosed?this.currentTimer=null:(this.websocket.send("ping"),this.doPing())},25e3)}async close(){this.isClosed=!0,this.websocket.close()}}class bw{constructor(e){y(this,"strategies",[]);y(this,"currentStrategy");y(this,"eventTypeToSubscriberInfoMap",new Map);this.baseURL=e,this.strategies=[new yw(this),new mw(this)];for(let t=this.strategies.length-2;t>=0;t--)this.strategies[t].nextStrategy=this.strategies[t+1]}subscribe(e,t){this.eventTypeToSubscriberInfoMap.set(e,{eventType:e,handler:t})}unsubscribe(e){this.eventTypeToSubscriberInfoMap.delete(e)}open(){this.currentStrategy==null&&(this.currentStrategy=this.strategies[0],console.log(`Opening ${this.currentStrategy.name}`),this.currentStrategy.open())}onMessage(e){var t;for(let i of e){if(i.eventType=="keepAlive")return;(t=this.eventTypeToSubscriberInfoMap.get(i.eventType))==null||t.handler(i.data)}}onStrategyFailed(e){if(e!=this.currentStrategy)return;let t=this.currentStrategy;this.currentStrategy=this.currentStrategy.nextStrategy;let i=`${t.name} failed. `;this.currentStrategy!=null?(i+=`=> Trying ${this.currentStrategy.name} in 3 seconds...`,setTimeout(()=>{console.log(`Opening ${this.currentStrategy.name}`),this.currentStrategy.open()},3e3)):i+="It was the last resort, unfortunately this client has no means to receive push-messages from server.",console.log(i)}close(){this.currentStrategy!=null&&(this.currentStrategy.close(),this.currentStrategy=null)}}const Xn=class Xn extends bw{static subscribe(e,t){Xn.getInstance().subscribe(e,t)}static unsubscribe(e){Xn.getInstance().unsubscribe(e)}static getInstance(){return Xn.instance==null&&(Xn.instance=new Xn("")),Xn.instance}};y(Xn,"instance");let Li=Xn;const Ii=class Ii{static registerPerformanceEntry(e,t){let i=Ii.performanceData.find(s=>s.url==e);i==null&&(i={count:0,sumTime:0,url:e},Ii.performanceData.push(i)),i.count++;let n=Math.round(performance.now()-t);i.sumTime+=n,Ii.performanceDataCount++}static sendDataToServer(){if(performance.now()-Ii.lastTimeSent>3*60*1e3){let e={data:Ii.performanceData};Ii.performanceData=[],Ii.performanceDataCount=0,Ii.lastTimeSent=performance.now(),Nt("collectPerformanceData",e,()=>{})}}};y(Ii,"performanceData",[]),y(Ii,"performanceDataCount",0),y(Ii,"lastTimeSent",performance.now());let To=Ii;var Bt="";function Nt(r,e,t,i){r.startsWith("http")||(r="servlet/"+r),lh(!0);let n=performance.now(),s={};Bt!=null&&(s={"x-token-pm":Bt}),I.ajax({type:"POST",async:!0,data:JSON.stringify(e),contentType:"application/json",headers:s,url:r,success:function(a){if(To.registerPerformanceEntry(r,n),a.csrfToken!=null&&(Bt=a.csrfToken,Li.getInstance().open()),lh(!1),a.success!=null&&a.success==!1||typeof a=="string"&&a==""){let l="Fehler bei der Bearbeitung der Anfrage";a.message!=null&&(l=a.message),a.error!=null&&(l=a.error),l.indexOf("Not logged in")>=0,console.log("Netzwerkfehler: "+l),i&&i(l)}else t(a)},error:function(a,l){if(lh(!1),i){let o="Server nicht erreichbar.";a.status!=0&&(o=""+a.status),i(l+": "+o);return}}})}function lh(r){r?I(".jo_network-busy").show():I(".jo_network-busy").hide()}async function yc(r,e){let t=[["content-type","text/json"]];Bt!=null&&t.push(["x-token-pm",Bt]);try{let n=await(await fetch(r,{method:"POST",headers:t,body:JSON.stringify(e)})).json();return n.token!=null&&(Bt=n.token,Li.getInstance().open()),n==null?alert("Fehler beim Übertragen der Daten."):n.success!=!0&&alert(`Fehler beim Übertragen der Daten:
`+n.message),n}catch(i){return{status:"Error",message:"Es ist ein Fehler aufgetreten: "+i}}}class vw{constructor(e,t){y(this,"timerhandle");y(this,"ownUpdateFrequencyInSeconds",25);y(this,"teacherUpdateFrequencyInSeconds",5);y(this,"updateFrequencyInSeconds",25);y(this,"forcedUpdateEvery",25);y(this,"forcedUpdatesInARow",0);y(this,"secondsTillNextUpdate",this.updateFrequencyInSeconds);y(this,"errorHappened",!1);y(this,"interval");y(this,"counterTillForcedUpdate");this.main=e,this.$updateTimerDiv=t}initializeTimer(){let e=this;this.$updateTimerDiv.find("svg").attr("width",e.updateFrequencyInSeconds),this.interval!=null&&clearInterval(this.interval),this.counterTillForcedUpdate=this.forcedUpdateEvery,this.interval=setInterval(()=>{if(e.main.user==null)return;if(e.secondsTillNextUpdate--,e.secondsTillNextUpdate<0){e.secondsTillNextUpdate=e.updateFrequencyInSeconds,e.counterTillForcedUpdate--;let i=e.counterTillForcedUpdate==0;i&&(this.forcedUpdatesInARow++,e.counterTillForcedUpdate=this.forcedUpdateEvery,this.forcedUpdatesInARow>50&&(e.counterTillForcedUpdate=this.forcedUpdateEvery*10)),e.sendUpdates(()=>{},i,!1)}let t=this.$updateTimerDiv.find(".jo_updateTimerRect");t.attr("width",e.secondsTillNextUpdate+"px"),e.errorHappened?(t.css("fill","#c00000"),this.$updateTimerDiv.attr("title","Fehler beim letzten Speichervorgang -> Werd's wieder versuchen")):(t.css("fill","#008000"),this.$updateTimerDiv.attr("title",e.secondsTillNextUpdate+" Sekunden bis zum nächsten Speichern")),To.sendDataToServer()},1e3)}initializeSSE(){Li.getInstance().subscribe("doFileUpdate",e=>{this.sendUpdates(()=>{},!0,!1,!0)})}sendUpdatesAsync(e=!1,t=!1){return new Promise((n,s)=>{this.sendUpdates(n,e,t)})}sendUpdates(e,t=!1,i=!1,n=!1){var d,p,v;if(this.main.user==null||this.main.user.is_testuser){e!=null&&e();return}this.main.projectExplorer.writeEditorTextToFile();let s=(d=this.main.rightDiv)==null?void 0:d.classDiagram,a=this.main.user.settings;(s!=null&&s.dirty||this.main.userDataDirty)&&(this.main.userDataDirty=!1,a.classDiagram=s==null?void 0:s.serialize(),this.sendUpdateUserSettings(()=>{},i),this.forcedUpdatesInARow=0),s.dirty=!1;let l=[],o=[];for(let w of this.main.workspaceList){w.saved||(l.push(w.getWorkspaceData(!1)),w.saved=!0,this.forcedUpdatesInARow=0);for(let _ of w.moduleStore.getModules(!1))_.file.saved||(this.forcedUpdatesInARow=0,_.file.text=_.getProgramTextFromMonacoModel(),o.push(_.getFileData(w)),_.file.saved=!0)}let u={workspacesWithoutFiles:l,files:o,owner_id:this.main.workspacesOwnerId,userId:this.main.user.id,currentWorkspaceId:((p=this.main.currentWorkspace)==null?void 0:p.pruefung_id)==null?(v=this.main.currentWorkspace)==null?void 0:v.id:null,getModifiedWorkspaces:t},h=this;if(l.length>0||o.length>0||t||this.errorHappened)i?navigator.sendBeacon("sendUpdates",JSON.stringify(u)):Nt("sendUpdates",u,w=>{if(h.errorHappened=!w.success,h.errorHappened){let _="Fehler beim Senden der Daten: ";w.message&&(_+=w.message),console.log(_)}else if(w.workspaces!=null&&h.updateWorkspaces(u,w,n),w.filesToForceUpdate!=null&&h.updateFiles(w.filesToForceUpdate),e!=null){e();return}},w=>{h.errorHappened=!0,console.log("Fehler beim Ajax-call: "+w)});else if(e!=null){e();return}}sendCreateWorkspace(e,t,i){if(this.main.user.is_testuser){e.id=Math.round(Math.random()*1e7),i(null);return}let s={type:"create",entity:"workspace",data:e.getWorkspaceData(!1),owner_id:t,userId:this.main.user.id};Nt("createOrDeleteFileOrWorkspace",s,a=>{e.id=a.id,i(null)},i)}sendCreateFile(e,t,i,n){if(this.main.user.is_testuser){e.file.id=Math.round(Math.random()*1e7),n(null);return}let a={type:"create",entity:"file",data:e.getFileData(t),owner_id:i,userId:this.main.user.id};Nt("createOrDeleteFileOrWorkspace",a,l=>{e.file.id=l.id,n(null)},n)}sendDuplicateWorkspace(e,t){if(this.main.user.is_testuser){t("Diese Aktion ist für den Testuser nicht möglich.",null);return}let i={workspace_id:e.id};Nt("duplicateWorkspace",i,n=>{t(n.message,n.workspace)},t)}sendDistributeWorkspace(e,t,i,n){if(this.main.user.is_testuser){n("Diese Aktion ist für den Testuser nicht möglich.");return}this.sendUpdates(()=>{let s={workspace_id:e.id,class_id:t==null?void 0:t.id,student_ids:i};Nt("distributeWorkspace",s,a=>{n(a.message)},n)},!1)}sendSetSecret(e,t,i,n){Nt("setRepositorySecret",{repository_id:e,newSecretRead:t,newSecretWrite:i},a=>{n(a)},a=>{alert(a)})}sendCreateRepository(e,t,i,n,s){if(this.main.user.is_testuser){s("Diese Aktion ist für den Testuser nicht möglich.");return}this.sendUpdates(()=>{let a={workspace_id:e.id,publish_to:t,name:i,description:n};Nt("createRepository",a,l=>{e.moduleStore.getModules(!1).forEach(o=>{o.file.is_copy_of_id=o.file.id,o.file.repository_file_version=1}),e.repository_id=l.repository_id,e.has_write_permission_to_repository=!0,s(l.message,l.repository_id)},s)},!0)}sendDeleteWorkspaceOrFile(e,t,i){if(this.main.user.is_testuser){i(null);return}let n={type:"delete",entity:e,id:t,userId:this.main.user.id};Nt("createOrDeleteFileOrWorkspace",n,s=>{s.success?i(null):i("Netzwerkfehler!")},i)}sendUpdateUserSettings(e,t=!1){if(this.main.user.is_testuser){e(null);return}let i={settings:this.main.user.settings,userId:this.main.user.id};t?navigator.sendBeacon("updateUserSettings",JSON.stringify(i)):Nt("updateUserSettings",i,n=>{n.success?e(null):e("Netzwerkfehler!")},e)}updateWorkspaces(e,t,i=!1){let n=new Map,s=[];e.files.forEach(l=>s.push(l.id)),t.workspaces.workspaces.forEach(l=>n.set(l.id,l));let a=[];for(let l of t.workspaces.workspaces)this.main.workspaceList.filter(u=>u.id==l.id).length==0&&(l.pruefung_id==null&&a.push(l.name),this.createNewWorkspaceFromWorkspaceData(l));for(let l of this.main.workspaceList){let o=n.get(l.id);if(o!=null){let u=new Map;o.files.forEach(d=>u.set(d.id,d));let h=new Map;for(let d of l.moduleStore.getModules(!1)){let p=d.file.id;h.set(p,d);let v=u.get(p);v==null?(this.main.projectExplorer.fileListPanel.removeElement(d),this.main.currentWorkspace.moduleStore.removeModule(d)):(s.indexOf(p)<0&&d.file.text!=v.text&&(d.file.text=v.text,d.model.setValue(v.text),d.file.saved=!0,d.lastSavedVersionId=d.model.getAlternativeVersionId()),d.file.version=v.version)}for(let d of o.files)h.get(d.id)==null&&this.createFile(l,d)}}if(a.length>0&&i){let l=a.length>1?"Folgende Workspaces hat Deine Lehrkraft Dir gesendet: ":"Folgenden Workspace hat Deine Lehrkraft Dir gesendet: ";l+=a.join(", "),alert(l)}this.main.projectExplorer.workspaceListPanel.sortElements(),this.main.projectExplorer.fileListPanel.sortElements()}updateFiles(e){let t=new Map;for(let i of this.main.workspaceList)for(let n of i.moduleStore.getModules(!1))t[n.file.id]=n;for(let i of e){let n=t.get(i.id);n!=null&&n.file.text!=i.text&&(n.file.text=i.text,n.model.setValue(i.text),n.file.saved=!0,n.lastSavedVersionId=n.model.getAlternativeVersionId(),n.file.version=i.version)}}createNewWorkspaceFromWorkspaceData(e,t=!1){let i=this.main.restoreWorkspaceFromData(e);this.main.workspaceList.push(i);let n=e.path.split("/");n.length==1&&n[0]==""&&(n=[]);let s={name:e.name,externalElement:i,iconClass:e.repository_id==null?"workspace":"repository",isFolder:e.isFolder,path:n,readonly:e.readonly,isPruefungFolder:!1};return this.main.projectExplorer.workspaceListPanel.addElement(s,!0),i.panelElement=s,i.repository_id!=null&&i.renderSynchronizeButton(s),t&&this.main.projectExplorer.workspaceListPanel.sortElements(),i}createFile(e,t){let i=this.main.projectExplorer.getNewModule(t),n=i.file,s=null;e==this.main.currentWorkspace&&(s={name:t.name,externalElement:null},this.main.projectExplorer.fileListPanel.addElement(s,!0),n.panelElement=s,s.externalElement=i),e.moduleStore.putModule(i)}fetchDatabaseAndToken(e,t){Nt("obtainSqlToken",{code:e},n=>{n.success?this.fetchDatabase(n.token,(s,a)=>{t(s,n.token,a)}):t(null,null,n.message)},n=>{t(null,null,n)})}fetchDatabase(e,t){let i=new gw,n={token:e};Nt(Kr.sqlIdeURL+"jGetDatabase",n,s=>{if(s.success){let a=s.database;i.fetchTemplateFromCache(a.based_on_template_id,l=>{if(l!=null){a.templateDump=pako.inflate(l),t(a,null);return}else{if(a.based_on_template_id==null){t(a,null);return}this.fetchTemplate(e,o=>{if(o!=null){i.saveTemplateToCache(a.based_on_template_id,o),a.templateDump=pako.inflate(o),t(a,null);return}else{t(null,"Konnte das Template nicht laden.");return}})}})}else t(null,"Netzwerkfehler!")})}fetchTemplate(e,t){let i={token:e},n={};Bt!=null&&(n={"x-token-pm":Bt}),I.ajax({type:"POST",async:!0,headers:n,data:JSON.stringify(i),contentType:"application/json",url:Kr.sqlIdeURL+"jGetTemplate",xhrFields:{responseType:"arraybuffer"},success:function(s){t(new Uint8Array(s))},error:function(s,a){alert("Konnte das Template nicht laden."),t(null)}})}addDatabaseStatement(e,t,i,n){let s={token:e,version_before:t,statements:i};Nt(Kr.sqlIdeURL+"jAddDatabaseStatement",s,a=>{n(a.statements_before,a.new_version,a.message)},a=>{n([],0,a)})}rollbackDatabaseStatement(e,t,i){let n={token:e,current_version:t};Nt(Kr.sqlIdeURL+"jRollbackDatabaseStatement",n,s=>{i(s.message)})}}class qn{constructor(e,t,i,n,s,a){y(this,"caption");y(this,"parent");y(this,"children",[]);y(this,"canOpen");y(this,"isOpen",!1);y(this,"value");y(this,"variable");y(this,"type");y(this,"identifier");y(this,"$debuggerElement");this.caption=e,this.parent=t,t!=null&&t.children.push(this),this.value=n,this.type=s,this.variable=a,this.identifier=i}getLevel(){return this.parent==null?0:this.parent.getLevel()+1}getIndent(){return this.getLevel()==0?0:15}render(){this.renderValue()}initHtml(){var t;if(this.$debuggerElement==null){this.$debuggerElement=I("<div>"),this.$debuggerElement.addClass("jo_debuggerElement"),this.$debuggerElement.css("margin-left",""+this.getIndent()+"px");let i=I('<div class="jo_deFirstline"><span class="jo_deIdentifier">'+this.identifier+'</span>:&nbsp;<span class="jo_deValue"></span></div>');this.$debuggerElement.append(i)}let e=(t=this.value)==null?void 0:t.type;e!=null&&(e instanceof ze||e instanceof $&&!(e instanceof $t)&&e!=F&&e.hasAttributes()||e instanceof Vt||e instanceof Pe?(!this.canOpen||this.type!=e)&&(this.type=e,this.$debuggerElement.find(".jo_deChildContainer").remove(),this.canOpen=!0,this.$debuggerElement.addClass("jo_canOpen"),this.$debuggerElement.append(I('<div class="jo_deChildContainer"></div>')),this.$debuggerElement.find(".jo_deFirstline").on("mousedown",i=>{this.value!=null&&this.value.value!=null?(this.children.length==0&&this.onFirstOpening(),this.$debuggerElement.toggleClass("jo_expanded"),this.isOpen=!this.isOpen):this.children=[],i.stopPropagation()})):(this.canOpen=!1,this.$debuggerElement.removeClass("jo_canOpen"),this.$debuggerElement.find(".jo_deChildContainer").remove()))}updateChildValues(){if(this.type instanceof $&&this.children.length>0){let e=this.value.value;if((e.intrinsicData==null?null:e.intrinsicData.ListHelper)==null){let i=0;for(let n of this.value.type.getAttributes(ee.private))this.children[i++].value=e.getValue(n.index)}}}onFirstOpening(){if(this.children=[],this.type instanceof $){let e=this.value.value,t=e.intrinsicData==null?null:e.intrinsicData.ListHelper;if(t!=null)this.renderListElements(t);else for(let i of this.value.type.getAttributes(ee.private)){let n=new qn(null,this,i.identifier,e.getValue(i.index),i.type,null);n.render(),this.$debuggerElement.find(".jo_deChildContainer").first().append(n.$debuggerElement)}}else if(this.type instanceof ze){let e=this.value.value,t=this.$debuggerElement.find(".jo_deChildContainer");for(let i=0;i<e.length&&i<100;i++){let n=new qn(null,this,"["+i+"]",e[i],this.type.arrayOfType,null);n.render(),t.append(n.$debuggerElement)}}else if(this.type instanceof Vt)for(let e of this.type.getAttributes(ee.private)){let t=this.type.classObject,i=new qn(null,this,e.identifier,t.getValue(e.index),e.type,null);i.render(),this.$debuggerElement.find(".jo_deChildContainer").append(i.$debuggerElement)}else if(this.type instanceof Pe)if(this.value.value!=null&&this.value.value instanceof he){let e=this.value.value;for(let t of e.class.getAttributes(ee.private)){let i=new qn(null,this,t.identifier,e.getValue(t.index),t.type,null);i.render(),this.$debuggerElement.find(".jo_deChildContainer").append(i.$debuggerElement)}}else this.children=[]}renderListElements(e){let t=e.valueArray;if(this.children.length>t.length){for(let i=t.length;i<this.children.length;i++)this.children[i].$debuggerElement.remove();this.children.splice(t.length)}if(this.children.length<t.length&&this.children.length<100)for(let i=this.children.length;i<t.length&&i<=100;i++){let n=t[i],s=""+i;i==100&&(n={type:F,value:""+(e.valueArray.length-100)+" weitere..."},s="...");let a=new qn(null,this,s,n,n.type,null);a.render(),this.$debuggerElement.find(".jo_deChildContainer").first().append(a.$debuggerElement)}}renderValue(){var i,n,s;this.initHtml();let e,t=this.value;if(t==null){this.$debuggerElement.hide();return}if(this.$debuggerElement.show(),t.value==null)e="null",this.removeAllChildren();else if(t.updateValue!=null&&t.updateValue(t),e=(i=t.type)==null?void 0:i.debugOutput(t),this.type instanceof $){let a=(s=(n=this.value)==null?void 0:n.type)==null?void 0:s.identifier;a!=null&&["String","Integer","Boolean","Double","Float"].indexOf(a)<0&&(e="<span class='jo_debugger_classidentifier'>"+a+"</span>");let l=this.value.value,o=l.intrinsicData==null?null:l.intrinsicData.ListHelper;o!=null&&(this.renderListElements(o),o.allElementsPrimitive()?(e=""+o.valueArray.length+" El: ",e+="["+o.objectArray.slice(0,20).map(u=>""+u).join(", ")+"]"):e=t.type.identifier+" ("+o.valueArray.length+" Elemente)")}this.$debuggerElement.find(".jo_deValue").first().html(e??""),this.updateChildValues();for(let a of this.children)a.renderValue()}removeAllChildren(){for(let e of this.children)e.$debuggerElement.remove();this.children=[]}}function ww(r){let e=0,t;for(let i=0;i<r.length;i++)t=r.charCodeAt(i),e=(e<<5)-e+t,e|=0;return e}function Co(r){return r.replace(/['"]+/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function xw(r){return`${Rs(r.getDate())}.${Rs(r.getMonth()+1)}.${r.getFullYear()}, ${Rs(r.getHours())}:${Rs(r.getMinutes())}`}function Sw(r){return`${Rs(r.getDate())}.${Rs(r.getMonth()+1)}.${r.getFullYear()}`}function Rs(r){return r<10?"0"+r:""+r}function _w(r){let e=r.match(/^(\d{2})\.(\d{2})\.(\d{4}), (\d{2}):(\d{2})$/);return new Date(Number.parseInt(e[3]),Number.parseInt(e[2])-1,Number.parseInt(e[1]),Number.parseInt(e[4]),Number.parseInt(e[5]))}function kw(r,e){return r.replace(new RegExp(`(?![^\\n]{1,${e}}$)([^\\n]{1,${e}})\\s`,"g"),`$1
`)}function Ol(r,e=""){let t="";if(typeof e=="string")t=e;else for(let i=0;i<e;i++)t+=" ";return r=kw(r,60),r.length>0&&(r=`
`+r),r=t+"/**"+r.replace(/\n/g,`
`+t+" * ")+`
`+t+" */",r}function fm(r,e,t,i=null){let n=window.PointerEvent?"pointer":"mouse";e==null&&(e=r);let s=I('<input type="text" class="jo_inplaceeditor" spellcheck="false">');s.css({width:e.css("width"),height:e.css("height"),color:e.css("color"),position:e.css("position"),"background-color":e.css("background-color"),"font-size":e.css("font-size"),"font-weight":e.css("font-weight"),"box-sizing":"border-box"}),s.val(r.text()),s.on(n+"down",a=>{a.stopPropagation()}),i!=null&&s[0].setSelectionRange(i.start,i.end),e.after(s),e.hide(),setTimeout(()=>{s.focus()},300),s.on("keydown.me",a=>{if(a.key=="Enter"||a.key=="Escape"){s.off("keydown.me"),s.off("focusout.me"),s.remove(),e.show();let l=Co(s.val());t(l);return}}),s.on("focusout.me",a=>{s.off("keydown.me"),s.off("focusout.me"),s.remove(),e.show();let l=Co(s.val());t(l)})}function wr(r,e,t){let i=window.PointerEvent?"pointer":"mouse",n=I('<div class="jo_contextmenu"></div>'),s=null,a=null;for(let p of r){let v=p.caption;p.link!=null&&(v=`<a href="${p.link}" target="_blank" class="jo_menulink">${p.caption}</a>`);let w=I("<div>"+v+(p.subMenu!=null?'<span style="float: right"> &nbsp; &nbsp; &gt;</span>':"")+"</div>");if(p.color!=null&&w.css("color",p.color),p.link==null)w.on(i+"up.contextmenu",_=>{_.stopPropagation(),I(".jo_contextmenu").remove(),I(document).off(i+"up.contextmenu"),I(document).off(i+"down.contextmenu"),I(document).off("keydown.contextmenu"),p.callback()}),w.on(i+"down.contextmenu",_=>{_.stopPropagation()});else{let _=w.find("a");_.on(i+"up",T=>{T.stopPropagation(),setTimeout(()=>{w.hide()},500)}),_.on(i+"down",T=>{T.stopPropagation()})}w.on(i+"move.contextmenu",()=>{p!=a&&s!=null&&(s.remove(),a=null,s=null),p.subMenu!=null&&(s=wr(p.subMenu,w.offset().left+w.width(),w.offset().top))}),n.append(w)}I(document).on(i+"down.contextmenu",p=>{I(document).off(i+"down.contextmenu"),I(document).off("keydown.contextmenu"),I(".jo_contextmenu").remove()}),I(document).on("keydown.contextmenu",p=>{p.key=="Escape"&&(I(document).off(i+"up.contextmenu"),I(document).off("keydown.contextmenu"),I(".jo_contextmenu").remove())});let l=e>window.innerWidth*.8?"right":"left",o=e>window.innerWidth*.8?window.innerWidth-e:e,u=t>window.innerHeight*.8?"bottom":"top",h=t>window.innerHeight*.8?window.innerHeight-t:t,d={};return d[l]=o+"px",d[u]=h+"px",n.css(d),I("body").append(n),n.show(),n}function Ao(r){let e=r.find(".jo_tabheadings>div").not(".jo_noHeading"),t=r.find(".jo_tabs>div"),i=window.PointerEvent?"pointer":"mouse";e.on(i+"down",n=>{let s=I(n.target);e.removeClass("jo_active"),s.addClass("jo_active");let a=r.find("."+s.data("target"));t.removeClass("jo_active"),t.trigger("myhide"),a.addClass("jo_active"),a.trigger("myshow")})}function Mo(r){return r=r.replace("px","").trim(),Number.parseInt(r)}function Ri(r,e="",t="",i,n){let s="";r!=null&&r!=""&&(s+=` id="${r}"`),e!=null&&e!=""&&(s+=` class="${e}"`);let a=I(`<div${s}></div>`);return i!=null&&a.css(i),t!=null&&t!=""&&a.text(t),n!=null&&n.append(a),a}var oo=!1;function Tw(){matchMedia("(pointer:fine)").matches&&(oo=!0)}function op(r,e,t,i){let n="rgba("+t[0]+", "+t[1]+", "+t[2]+", ",s=1,a=s/(i/20),l=()=>{r.css(e,n+s+")"),s-=a,s<0?r.css(e,""):setTimeout(l,20)};l()}function bc(r,e,t=!1){var i=t?r:new Blob([JSON.stringify(r)],{type:"text/plain"});if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(i,e);else{var n=document.createEvent("MouseEvents"),s=document.createElement("a");s.download=e,s.href=window.URL.createObjectURL(i),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),n.initEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),s.dispatchEvent(n),s.remove()}}function Cw(r){var e=document.createElement("textarea");e.value=r,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{var t=document.execCommand("copy")}catch(i){console.error("Fallback: Oops, unable to copy",i)}document.body.removeChild(e)}function Aw(r){if(!navigator.clipboard){Cw(r);return}navigator.clipboard.writeText(r).then(function(){},function(e){console.error("Async: Could not copy text: ",e)})}function Mw(r,e){var t=r>>16,i=r>>8&255,n=r&255;t=Math.round((255-t)*e)+t&255,i=Math.round((255-i)*e)+i&255,n=Math.round((255-n)*e)+n&255;var s=n|i<<8|t<<16;return s}function Ew(r){var e=null,t=[];return location.search.substring(1).split("&").forEach(function(i){t=i.split("="),t[0]===r&&(e=decodeURIComponent(t[1]))}),e}class pm{constructor(e){y(this,"moduleStore");y(this,"lexer");y(this,"module");y(this,"parser");y(this,"codeGenerator");this.main=e,this.moduleStore=new Lu(this.main,!0),this.lexer=new fc,this.parser=new Ya(!0),this.codeGenerator=new ko,this.module=new Ni(null,e)}compile(e,t,i,n){let s=performance.now(),a=[];this.module.clear(),n==null?(n=new qa(null,{column:1,line:1,length:0},{column:1,line:100,length:0}),n.beginsNewStackframe=!0):n=n.getImitation();let l=this.lexer.lex(e);a=l.errors,this.module.tokenList=l.tokens,new Ya(!0).parse(this.module),a=a.concat(this.module.errors[1]);for(let h of this.module.typeNodes)if(h.resolvedType==null){let d=t.getType(h.identifier);d==null?a.push({text:"Der Datentyp "+h.identifier+" ist nicht bekannt.",position:h.position,level:"error"}):h.resolvedType=ad(d.type,h.arrayDimension)}let u=this.codeGenerator.startAdhocCompilation(this.module,t,n,i);if(a=a.concat(u),a.find(h=>h.level=="error")==null){let h=this.module.mainProgram.statements;for(let d of h)d.stepFinished=!1;h.length>0&&h[h.length-1].type==f.programEnd&&h.splice(h.length-1,1)}return performance.now()-s,{program:this.module.mainProgram,errors:a,symbolTable:n}}}class Pw{constructor(e,t){y(this,"programMap",new Map);y(this,"compiler");this.workspace=e,this.main=t,this.compiler=new pm(t)}compile(e,t){if(t==null)return;let i=this.programMap.get(e);if(i!=null){let a=i.get(t.id);if(a!=null)return{error:null,program:a}}else i=new Map,this.programMap.set(e,i);let n=this.workspace.moduleStore,s=this.main.getInterpreter().heap;if(e.length>0&&n!=null){let a=this.compiler.compile(e,n,s,t);return a.errors.length>0?{error:a.errors[0].text,program:null}:(i.set(t.id,a.program),{error:null,program:a.program})}else return{error:"Leerer Ausdruck",program:null}}evaluate(e,t){t==null&&(t=this.main.getDebugger().lastSymboltable);let i=this.compile(e,t);return(i==null?void 0:i.error)!=null?{error:i.error,value:null}:i==null?{error:"Fehler beim Kompilieren",value:null}:this.main.getInterpreter().evaluate(i.program)}}class mn{constructor(e,t,i){y(this,"name");y(this,"path");y(this,"isFolder");y(this,"readonly");y(this,"id");y(this,"owner_id");y(this,"version");y(this,"published_to");y(this,"repository_id");y(this,"has_write_permission_to_repository");y(this,"spritesheetId");y(this,"grade");y(this,"points");y(this,"comment");y(this,"attended_exam");y(this,"moduleStore");y(this,"panelElement");y(this,"currentlyOpenModule");y(this,"saved",!0);y(this,"pruefung_id");y(this,"compilerMessage");y(this,"evaluator");y(this,"settings",{libraries:[]});this.main=t,this.name=e,this.owner_id=i,this.path="",this.moduleStore=new Lu(t,!0,this.settings.libraries),this.evaluator=new Pw(this,t)}toExportedWorkspace(){return{name:this.name,modules:this.moduleStore.getModules(!1).map(e=>e.toExportedModule()),settings:this.settings}}alterAdditionalLibraries(){this.moduleStore.setAdditionalLibraries(this.settings.libraries),this.moduleStore.dirty=!0}getWorkspaceData(e){let t={name:this.name,path:this.path,isFolder:this.isFolder,id:this.id,owner_id:this.owner_id,currentFileId:this.currentlyOpenModule==null?null:this.currentlyOpenModule.file.id,files:[],version:this.version,repository_id:this.repository_id,has_write_permission_to_repository:this.has_write_permission_to_repository,settings:JSON.stringify(this.settings),spritesheet_id:this.spritesheetId,pruefung_id:this.pruefung_id,readonly:this.readonly,grade:this.grade,points:this.points,comment:this.comment,attended_exam:this.attended_exam};if(e)for(let i of this.moduleStore.getModules(!1))t.files.push(i.getFileData(this));return t}renderSynchronizeButton(e){var n;let t=(n=e==null?void 0:e.$htmlFirstLine)==null?void 0:n.find(".jo_additionalButtonRepository");if(t==null)return;let i=this.main;if(this.repository_id!=null&&this.owner_id==i.user.id){let s=I('<div class="jo_startButton img_open-change jo_button jo_active" title="Workspace mit Repository synchronisieren"></div>');t.append(s);let a=this;s.on("pointerdown",l=>l.stopPropagation()),s.on("pointerup",l=>{l.stopPropagation(),a.synchronizeWithRepository()}),s[0].addEventListener("contextmenu",l=>{l.preventDefault(),l.stopPropagation()},!1)}else t.find(".jo_startButton").remove()}synchronizeWithRepository(){let e=this.main;this.repository_id!=null&&this.owner_id==e.user.id&&e.networkManager.sendUpdates(()=>{e.synchronizationManager.synchronizeWithWorkspace(this)},!0)}static restoreFromData(e,t){let i=e.settings!=null&&e.settings.startsWith("{")?JSON.parse(e.settings):{libraries:[]};i.libaries&&(i.libraries=i.libaries);let n=new mn(e.name,t,e.owner_id);n.id=e.id,n.path=e.path,n.isFolder=e.isFolder,n.owner_id=e.owner_id,n.version=e.version,n.repository_id=e.repository_id,n.has_write_permission_to_repository=e.has_write_permission_to_repository,n.settings=i,n.pruefung_id=e.pruefung_id,n.spritesheetId=e.spritesheet_id,n.readonly=e.readonly,n.grade=e.grade,n.points=e.points,n.comment=e.comment,n.attended_exam=e.attended_exam,n.settings.libraries==null&&(n.settings.libraries=[]),n.settings.libraries.length>0&&n.moduleStore.setAdditionalLibraries(n.settings.libraries);for(let s of e.files){let a=Ni.restoreFromData(s,t);n.moduleStore.putModule(a),s.id==e.currentFileId&&(n.currentlyOpenModule=a)}return n}hasErrors(){return this.moduleStore.hasErrors()}getModuleByMonacoModel(e){for(let t of this.moduleStore.getModules(!1))if(t.model==e)return t;return null}}class vc{constructor(){y(this,"$dialog");y(this,"$dialogMain");y(this,"$dialogFooter")}init(){this.$dialog=I("#dialog"),this.$dialog.empty(),I("#main").css("visibility","hidden"),this.$dialog.append(I('<div style="height: 20px"></div><div class="dialog-main"></div><div class="dialog-footer"></div>')),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialogFooter=this.$dialog.find(".dialog-footer"),this.$dialog.css("visibility","visible"),this.$dialogMain.empty(),this.$dialogFooter.empty()}heading(e){let t=I('<div class="dialog-heading">'+e+"</div>");return this.$dialogMain.append(t),t}addDiv(e){this.$dialogMain.append(e)}subHeading(e){let t=I('<div class="dialog-subheading">'+e+"</div>");return this.$dialogMain.append(t),t}description(e,t){let i=t==null?"":`style="color: ${t}"`,n=I(`<div class="dialog-description" ${i}>${e}</div>`);return this.$dialogMain.append(n),n}input(e,t){let i=I(`<input class="dialog-input" type="${e}" placeholder="${t}"></input>`);return this.$dialogMain.append(i),i}buttons(e){let t=I('<div class="dialog-buttonRow"></div>');this.$dialogMain.append(t);for(let i of e){let n=I(`<button style="background-color: ${i.color};margin-left: 20px">${i.caption}</button>`);n.on("click",()=>{i.callback()}),t.append(n)}}waitMessage(e){let t=I(`<div class="dialog-wait">${e}<img src="assets/graphics/ball-triangle.svg"></div>`);return this.$dialogMain.append(t),i=>{let n=i?"visible":"hidden";t.css("visibility",n)}}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),I("#main").css("visibility","visible")}addCheckbox(e,t,i){let n='<input type="checkbox" name="'+i+'"'+(t?" checked":"")+">",s=I(n),a=I('<label for="'+i+'">'+e+"</label>"),l=I('<div class="jo_checkbox_div"></div>');return l.append(s,a),a.on("click",()=>{s.prop("checked",!s.prop("checked"))}),this.$dialogMain.append(l),()=>s.is(":checked")}}class gm{constructor(e,t=[]){y(this,"dialog");this.main=e,this.path=t,this.dialog=new vc}show(){let e=this;this.dialog.init(),this.dialog.heading("Workspace importieren"),this.dialog.description("Bitte klicken Sie auf den Button 'Datei auswählen...' oder ziehen Sie eine Datei auf das gestrichelt umrahmte Feld.");let t="Dieser Workspace wird auf unterster Ordnerebene in der Workspaceliste importiert.";this.path.length>0&&(t="Dieser Workspace wird in den Ordner "+this.path.join("/")+" importiert."),this.dialog.description(t);let i=I('<input type="file" id="file" name="file" multiple />');this.dialog.addDiv(i);let n=[],s=this.dialog.description("","red"),a=I('<div class="jo_scrollable" style="flex-basis: 20px; flex-grow: 1; overflow: auto; background-color: #ffffff60"></div>'),l=I("<ul></ul>");a.append(l);let o=h=>{for(let p=0;p<h.length;p++){let v=h[p];var d=new FileReader;d.onload=w=>{let _=w.target.result;if(!_.startsWith("{")){s.append(I(`<div>Das Format der Datei ${v.name} passt nicht.</div>`));return}let T=JSON.parse(_);if(T.modules==null||T.name==null||T.settings==null){s.append(I(`<div>Das Format der Datei ${v.name} passt nicht.</div>`));return}n.push(T),l.append(I(`<li>Workspace ${T.name} mit ${T.modules.length} Dateien</li>`))},d.readAsText(v)}};i.on("change",h=>{var d=h.originalEvent.target.files;o(d)});let u=I('<div class="jo_workspaceimport_dropzone">Dateien hierhin ziehen</div>');this.dialog.addDiv(u),this.dialog.description("<b>Diese Workspaces werden importiert:</b>"),u.on("dragover",h=>{h.stopPropagation(),h.preventDefault(),h.originalEvent.dataTransfer.dropEffect="copy"}),u.on("drop",h=>{h.stopPropagation(),h.preventDefault();var d=h.originalEvent.dataTransfer.files;o(d)}),this.dialog.addDiv(a),this.dialog.waitMessage("Bitte warten..."),this.dialog.buttons([{caption:"Abbrechen",color:"#a00000",callback:()=>{this.dialog.close()}},{caption:"Importieren",color:"green",callback:()=>{let h=this.main.networkManager,d=this.main.projectExplorer,p=this.main.user.id;this.main.workspacesOwnerId!=null&&(p=this.main.workspacesOwnerId);let v=0;for(let _ of n)v+=1+_.modules.length;let w;for(let _ of n){let T=new mn(_.name,this.main,p);w==null&&(w=T),T.isFolder=!1,T.path=this.path.join("/"),T.settings=_.settings,this.main.workspaceList.push(T),T.alterAdditionalLibraries(),h.sendCreateWorkspace(T,p,D=>{if(v--,D==null){d.workspaceListPanel.addElement({name:T.name,externalElement:T,iconClass:"workspace",isFolder:!1,path:e.path,readonly:!1,isPruefungFolder:!1},!0);for(let L of _.modules){let O={name:L.name,dirty:!1,saved:!0,text:L.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,is_copy_of_id:null,repository_file_version:null,identical_to_repository_version:!0},z=new Ni(O,this.main);T.moduleStore.putModule(z),h.sendCreateFile(z,T,p,V=>{v--,V==null?(d.workspaceListPanel.sortElements(),this.dialog.close(),w!=null&&d.setWorkspaceActive(w,!0)):alert("Der Server ist nicht erreichbar!")})}}else alert("Der Server ist nicht erreichbar!")})}}}])}}const ii=class ii{constructor(e,t,i,n,s,a,l,o,u,h,d){y(this,"elements",[]);y(this,"$captionElement");y(this,"$buttonNew");y(this,"$listElement");y(this,"$listOuter");y(this,"fixed");y(this,"dontSortElements",!1);y(this,"newElementCallback");y(this,"newFolderCallback");y(this,"renameCallback");y(this,"deleteCallback");y(this,"selectCallback");y(this,"addElementActionCallback");y(this,"contextMenuProvider");y(this,"moveCallback");y(this,"dropElementCallback");y(this,"$newFolderAction");y(this,"_$caption");this.accordion=e,this.flexWeight=i,this.newButtonClass=n,this.buttonNewTitle=s,this.defaultIconClass=a,this.withDeleteButton=l,this.withFolders=o,this.kind=u,this.enableDrag=h,this.acceptDropKinds=d,this._$caption=typeof t=="string"?I(`<div class="jo_captiontext">${t}</div>`):t,e.addPanel(this);let p=window.PointerEvent?"pointer":"mouse";if(o){let v=this;this.$newFolderAction=I('<div class="img_add-folder-dark jo_button jo_active" style="margin-right: 4px" title="Neuen Ordner auf oberster Ebene anlegen">'),this.$newFolderAction.on(p+"down",_=>{_.stopPropagation(),_.preventDefault();let T=[];this.addFolder("Neuer Ordner",T,D=>{this.newFolderCallback(D,()=>{this.sortElements(),D.$htmlFirstLine[0].scrollIntoView(),op(D.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)})})}),this.addAction(this.$newFolderAction);let w=I('<div class="img_collapse-all-dark jo_button jo_active" style="margin-right: 4px" title="Alle Ordner zusammenfalten">');w.on(p+"down",_=>{_.stopPropagation(),_.preventDefault(),v.collapseAll()}),this.addAction(w)}}hide(){this.$listOuter.animate({"flex-grow":.001},1e3,()=>{this.$listOuter.hide(),this.$captionElement.hide()})}show(){let e=this.$listOuter.data("grow");this.$listOuter.show(),this.$captionElement.show(),this.$listOuter.animate({"flex-grow":e},1e3)}collapseAll(){for(let e of this.elements)e.isFolder&&e.$htmlFirstLine.hasClass("jo_expanded")&&(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")),e.path.length>0&&e.$htmlFirstLine.slideUp(200)}remove(){this.$captionElement.remove(),this.$listElement.remove()}setFixed(e){this.fixed=e,this.fixed?(this.grow(),this.$captionElement.addClass("jo_fixed")):this.$captionElement.removeClass("jo_fixed")}enableNewButton(e){this.$buttonNew!=null&&(e?this.$buttonNew.show():this.$buttonNew.hide())}getCurrentlySelectedPath(){let e=[],t=this.getSelectedElement();return t!=null&&(e=t.path.slice(0),t.isFolder&&e.push(t.name)),e}compareWithPath(e,t,i,n,s,a){if(t=t.slice(),t.push(e),e="",s=s.slice(),s.push(n),n="",t[0]=="_Prüfungen"&&s[0]!="_Prüfungen")return 1;if(s[0]=="_Prüfungen"&&t[0]!="_Prüfungen")return-1;let l=0;for(;l<t.length&&l<s.length;){let o=t[l].localeCompare(s[l]);if(o!=0)return o;l++}return t.length<s.length?-1:t.length>s.length?1:e.localeCompare(n)}getElementIndex(e,t,i){for(let n=0;n<this.elements.length;n++){let s=this.elements[n];if(this.compareWithPath(e,t,i,s.name,s.path,s.isFolder)<0)return n}return this.elements.length}insertElement(e){let t=this.getElementIndex(e.name,e.path,e.isFolder);this.elements.splice(t,0,e);let i=this.$listElement.find(".jo_file");if(t==0)this.$listElement.prepend(e.$htmlFirstLine);else if(t==i.length)this.$listElement.append(e.$htmlFirstLine);else{let n=i.get(t);I(n).before(e.$htmlFirstLine)}}addFolder(e,t,i){let n={name:e,isFolder:!0,path:t,readonly:!1,isPruefungFolder:!1},s=this.renderElement(n,!0);this.insertElement(n),s[0].scrollIntoView(),this.renameElement(n,()=>{i(n)})}renderOuterHtmlElements(e){let t=this;if(this.$captionElement=I('<div class="jo_leftpanelcaption jo_expanded"><div class="jo_actions"></div></div>'),this.$captionElement.prepend(this._$caption),this.$captionElement.prepend(I('<div class="jo_expandIcon"></div>')),this.newButtonClass!=null){this.$buttonNew=I('<div class="jo_button jo_active '+this.newButtonClass+'" title="'+this.buttonNewTitle+'">'),this.$captionElement.find(".jo_actions").append(this.$buttonNew);let a=window.PointerEvent?"pointer":"mouse";this.$buttonNew.on(a+"down",l=>{rn.close(),l.stopPropagation();let o=t.getCurrentlySelectedPath(),u={name:"Neu",isFolder:!1,path:o,readonly:!1,isPruefungFolder:!1},h=this.getElementIndex("",o,!1);this.elements.splice(h,0,u);let d=this.renderElement(u,!0);if(h==0)this.$listElement.prepend(d);else{let p=this.$listElement.find(".jo_file").get(h-1);I(p).after(d)}d[0].scrollIntoView(),t.renameElement(u,()=>{t.newElementCallback(u,p=>{u.externalElement=p,u.$htmlSecondLine!=null&&u.$htmlSecondLine.insertAfter(d),t.selectCallback!=null&&t.select(u.externalElement)})})})}this.$listOuter=I('<div class="jo_projectexplorerdiv jo_scrollable" data-grow="'+this.flexWeight+'" style="flex-grow: '+this.flexWeight+'"></div>'),this.$listElement=I('<div class="jo_filelist"></div>'),this.$listOuter.append(this.$listElement),e.append(this.$captionElement),e.append(this.$listOuter);let i=this.$captionElement,n=this.$listElement.parent(),s=window.PointerEvent?"pointer":"mouse";i.on(s+"down",a=>{if(a.button==0&&!this.fixed){let l=n.data("grow");i.hasClass("jo_expanded")?t.accordion.parts.length>1&&n.animate({"flex-grow":.001},1e3,()=>{i.toggleClass("jo_expanded")}):(i.toggleClass("jo_expanded"),n.animate({"flex-grow":l},1e3))}}),i.on("dragover",a=>{ii.currentlyDraggedElementKind==t.kind&&(i.addClass("jo_file_dragover"),a.preventDefault())}),i.on("dragleave",a=>{i.removeClass("jo_file_dragover")}),i.on("drop",a=>{if(ii.currentlyDraggedElementKind==t.kind){a.preventDefault(),i.removeClass("jo_file_dragover");let l=ii.currentlyDraggedElement;l!=null&&t.moveElement(l,null)}})}grow(){let e=this.$listElement.parent(),t=e.data("grow");e.css("flex-grow",t),this.$captionElement.addClass("jo_expanded")}addElement(e,t){e.$htmlFirstLine=this.renderElement(e,t),this.insertElement(e)}sortElements(){this.dontSortElements||(this.elements.sort((e,t)=>{let i=e.sortName?e.sortName:e.name,n=t.sortName?t.sortName:t.name;return this.compareWithPath(i,e.path,e.isFolder,n,t.path,t.isFolder)}),this.elements.forEach(e=>{this.$listElement.append(e.$htmlFirstLine)}))}setTextAfterFilename(e,t,i){let n=e.$htmlFirstLine.find(".jo_textAfterName");n.addClass(i),n.html(t)}addAction(e){this.$captionElement.find(".jo_actions").prepend(e)}renderElement(e,t){let i=window.PointerEvent?"pointer":"mouse",n=this,s="";e.iconClass==null&&(e.iconClass=this.defaultIconClass),e.isFolder&&(e.iconClass="folder",s=t?" jo_expanded":" jo_collapsed");let a="";e.path==null&&(e.path=[]);for(let d=0;d<e.path.length;d++)a+='<div class="jo_folderline"></div>';e.$htmlFirstLine=I(`<div class="jo_file jo_${e.iconClass} ${s}">
        <div class="jo_folderlines">${a}</div>
        <div class="jo_fileimage"></div>
        <div class="jo_filename"></div>
        <div class="jo_textAfterName"></div>
        <div class="jo_additionalButtonHomework"></div>
        <div class="jo_additionalButtonStart"></div>
        <div class="jo_additionalButtonRepository"></div>
        ${this.withDeleteButton&&!e.readonly?'<div class="jo_delete img_delete jo_button jo_active"></div>':""}
        ${oo?"":'<div class="jo_settings_button img_ellipsis-dark jo_button jo_active"></div>'}
        </div>`);let l=Co(e.name),o=e.$htmlFirstLine.find(".jo_filename");if(l=="_Prüfungen"&&e.isFolder&&(l="Prüfungen",e.isPruefungFolder=!0,o.addClass("joe_pruefungfolder")),o.text(l),!t&&e.path.length>0&&e.$htmlFirstLine.hide(),this.addElementActionCallback!=null){let d=this.addElementActionCallback(e);e.$htmlFirstLine.append(d)}if(this.withFolders&&e.isFolder&&!e.readonly&&(e.$htmlFirstLine.on("dragover",d=>{ii.currentlyDraggedElementKind==n.kind&&(e.$htmlFirstLine.addClass("jo_file_dragover"),d.preventDefault())}),e.$htmlFirstLine.on("dragleave",d=>{e.$htmlFirstLine.removeClass("jo_file_dragover")}),e.$htmlFirstLine.on("drop",d=>{if(ii.currentlyDraggedElementKind==n.kind){d.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let p=ii.currentlyDraggedElement;ii.currentlyDraggedElement=null,p!=null&&n.moveElement(p,e)}})),this.withFolders||this.enableDrag){let d=e.$htmlFirstLine.find(".jo_filename");d.attr("draggable","true"),d.on("dragstart",p=>{ii.currentlyDraggedElement=e,ii.currentlyDraggedElementKind=n.kind,p.originalEvent.dataTransfer.effectAllowed=e.isFolder?"move":"copyMove"})}this.acceptDropKinds!=null&&this.acceptDropKinds.length>0&&(e.isFolder||(e.$htmlFirstLine.on("dragover",d=>{this.acceptDropKinds.indexOf(ii.currentlyDraggedElementKind)>=0&&(e.$htmlFirstLine.addClass("jo_file_dragover"),d.ctrlKey?d.originalEvent.dataTransfer.dropEffect="copy":d.originalEvent.dataTransfer.dropEffect="move",d.preventDefault())}),e.$htmlFirstLine.on("dragleave",d=>{e.$htmlFirstLine.removeClass("jo_file_dragover")}),e.$htmlFirstLine.on("drop",d=>{if(this.acceptDropKinds.indexOf(ii.currentlyDraggedElementKind)>=0){d.preventDefault(),e.$htmlFirstLine.removeClass("jo_file_dragover");let p=ii.currentlyDraggedElement;ii.currentlyDraggedElement=null,p!=null&&n.dropElementCallback!=null&&n.dropElementCallback(e,p,d.ctrlKey?"copy":"move")}}))),e.$htmlFirstLine.on(i+"up",d=>{if(d.button==0&&n.selectCallback!=null){n.selectCallback(e.externalElement);for(let p of n.elements)p!=e&&p.$htmlFirstLine.hasClass("jo_active")&&p.$htmlFirstLine.removeClass("jo_active");if(e.$htmlFirstLine.addClass("jo_active"),e.isFolder){e.$htmlFirstLine.hasClass("jo_expanded")?(e.$htmlFirstLine.removeClass("jo_expanded"),e.$htmlFirstLine.addClass("jo_collapsed")):(e.$htmlFirstLine.addClass("jo_expanded"),e.$htmlFirstLine.removeClass("jo_collapsed"));let p={};for(let v of this.elements)if(v.isFolder){let w=v.path.join("/");w!=""&&(w+="/"),w+=v.name,p[w]=v.$htmlFirstLine.hasClass("jo_collapsed"),p[v.path.join("/")]&&(p[w]=!0)}p[""]=!1;for(let v of this.elements)p[v.path.join("/")]?v.$htmlFirstLine.slideUp(200):v.$htmlFirstLine.slideDown(200)}}});let u=function(d){let p=[];n.renameCallback!=null&&!e.readonly&&p.push({caption:"Umbenennen",callback:()=>{n.renameElement(e)}});let v=window.PointerEvent?"pointer":"mouse";if(e.isFolder&&!e.readonly&&(p=p.concat([{caption:"Neuen Unterordner anlegen (unterhalb '"+e.name+"')...",callback:()=>{n.select(e.externalElement);let w=n.getCurrentlySelectedPath();n.addFolder("Neuer Ordner",w,_=>{n.newFolderCallback(_,()=>{n.sortElements(),_.$htmlFirstLine[0].scrollIntoView(),op(_.$htmlFirstLine.find(".jo_filename"),"background-color",[0,255,0],2e3)})})}},{caption:"Neuer Workspace...",callback:()=>{n.select(e.externalElement),n.$buttonNew.trigger(v+"down")}},{caption:"Workspace importieren...",callback:()=>{new gm(n.accordion.main,e.path.concat([e.name])).show()}}])),n.contextMenuProvider!=null&&!e.isFolder)for(let w of n.contextMenuProvider(e))p.push({caption:w.caption,callback:()=>{w.callback(e)},color:w.color,subMenu:w.subMenu==null?null:w.subMenu.map(_=>({caption:_.caption,callback:()=>{_.callback(e)},color:_.color}))});p.length>0&&(d.preventDefault(),d.stopPropagation(),wr(p,d.pageX,d.pageY))};e.$htmlFirstLine[0].addEventListener("contextmenu",d=>{u(d)},!1);let h;return oo||e.$htmlFirstLine.on("pointerup",()=>(clearTimeout(h),!1)).on("pointerdown",d=>(h=window.setTimeout(()=>{u(d)},500),!1)),oo||(e.$htmlFirstLine.find(".jo_settings_button").on("pointerdown",d=>{u(d)}),e.$htmlFirstLine.find(".jo_settings_button").on("mousedown click",d=>{d.preventDefault(),d.stopPropagation()})),n.withDeleteButton&&!e.readonly&&(e.$htmlFirstLine.find(".jo_delete")[0].addEventListener("contextmenu",d=>{d.preventDefault(),d.stopPropagation()},!1),e.$htmlFirstLine.find(".jo_delete").on(i+"down",d=>{d.preventDefault(),wr([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{if(e.isFolder&&n.getChildElements(e).length>0){alert("Dieser Ordner kann nicht gelöscht werden, da er nicht leer ist.");return}n.deleteCallback(e.externalElement,()=>{e.$htmlFirstLine.remove(),e.$htmlSecondLine!=null&&e.$htmlSecondLine.remove(),n.elements.splice(n.elements.indexOf(e),1),n.selectCallback!=null&&(n.elements.find(v=>!v.isFolder)?n.select(n.elements[0].externalElement):n.select(null))})}}],d.pageX+2,d.pageY+2),d.stopPropagation()})),e.$htmlFirstLine}moveElement(e,t){let i=t==null?[]:t.path.slice(0).concat([t.name]);if(e.isFolder){let n=[e],s=e.path.concat([e.name]).join("/");if(i.join("/").indexOf(s)==0)return;let a=e.path.length;e.path=i.slice(0);for(let l of this.elements)l.path.join("/").startsWith(s)&&(l.path.splice(0,a),l.path=i.concat(l.path),n.push(l));for(let l of n)l.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(l),1);for(let l of n)this.renderElement(l,!0),this.insertElement(l);this.moveCallback(n)}else e.path=i,e.$htmlFirstLine.remove(),this.elements.splice(this.elements.indexOf(e),1),this.renderElement(e,!0),this.insertElement(e),this.select(e.externalElement),e.$htmlFirstLine[0].scrollIntoView(),this.moveCallback(e)}getChildElements(e){let t=e.path.slice(0).concat(e.name).join("/");return this.elements.filter(i=>i.path.join("/").startsWith(t))}pathStartsWith(e,t){if(e.length<t.length)return!1;for(let i=0;i<t.length;i++)if(e[i]!=t[i])return!1;return!0}renameElement(e,t){let i=this,n=e.$htmlFirstLine.find(".jo_filename"),s=e.name.indexOf("."),a=s==null?null:{start:0,end:s};this.dontSortElements=!0,fm(n,n,l=>{e.externalElement!=null&&(l=i.renameCallback(e.externalElement,l,e));let o=e.name;if(e.name=l,n.html(e.name),e.isFolder){let u=e.path.slice().concat([o]),h=[];for(let d of this.elements)this.pathStartsWith(d.path,u)&&(d.path[u.length-1]=e.name,h.push(d));h.length>0&&this.moveCallback(h)}t!=null&&t(),i.sortElements(),n[0].scrollIntoView(),this.dontSortElements=!1},a)}select(e,t=!0,i=!1){if(e==null)for(let n of this.elements)n.$htmlFirstLine.hasClass("jo_active")&&n.$htmlFirstLine.removeClass("jo_active");else{let n=this.findElement(e);if(n!=null){for(let s of this.elements)s.$htmlFirstLine.hasClass("jo_active")&&s.$htmlFirstLine.removeClass("jo_active");if(n.$htmlFirstLine.addClass("jo_active"),i){let s=n.path.join("/");for(let a of this.elements){let l=a.path.slice(0);s.startsWith(l.join("/"))&&(a.isFolder&&(l.push(a.name),s.startsWith(l.join("/"))&&(a.$htmlFirstLine.removeClass("jo_collapsed"),a.$htmlFirstLine.addClass("jo_expanded"))),a.$htmlFirstLine.show())}n.$htmlFirstLine[0].scrollIntoView()}}}t&&this.selectCallback!=null&&this.selectCallback(e)}getPathString(e){let t=e.path.join("/");return e.isFolder&&(t!=""&&(t+="/"),t+=e.name),t}setElementClass(e,t,i){var n;e!=null&&((n=e.$htmlFirstLine)==null||n.removeClass("jo_"+e.iconClass).addClass("jo_"+t),e.iconClass=t,i!=null&&e.$htmlFirstLine.find(".jo_fileimage").attr("title",i))}findElement(e){for(let t of this.elements)if(t.externalElement==e)return t;return null}removeElement(e){for(let t of this.elements)if(t.externalElement==e){t.$htmlFirstLine.remove(),t.$htmlSecondLine!=null&&t.$htmlSecondLine.remove(),this.elements.splice(this.elements.indexOf(t),1),this.selectCallback!=null&&(this.elements.length>0?this.select(this.elements[0].externalElement):this.select(null));return}}clear(){this.$listElement.empty(),this.elements=[]}setCaption(e){this.$captionElement.find(".jo_captiontext").html(e)}getSelectedElement(){for(let e of this.elements)if(e.$htmlFirstLine.hasClass("jo_active"))return e;return null}};y(ii,"currentlyDraggedElement"),y(ii,"currentlyDraggedElementKind");let xr=ii;class mm{constructor(e,t){y(this,"parts",[]);y(this,"$html");this.main=e,this.$html=t,t.addClass("jo_leftpanelinner")}addPanel(e){e.renderOuterHtmlElements(this.$html),this.parts.push(e)}}class Iw{constructor(e,t,i,n,s){this.expression=e,this.accordionElement=t,this.main=i,this.$secondLine=n,this.$rightTextInFirstLine=s}setError(e){this.$secondLine.empty(),this.$secondLine.append(jQuery('<div class="jo_watcherResult">---</div>'))}evaluate(){let t=this.main.getCurrentWorkspace().evaluator.evaluate(this.expression);if(t.error!=null)this.setError(t.error);else{let i="---";t.value!=null&&(i=t.value.type.debugOutput(t.value)),this.$secondLine.empty(),this.$rightTextInFirstLine.empty(),monaco.editor.colorize(i,"myJava",{tabSize:3}).then(n=>{let s=jQuery('<div class="jo_watcherResult">'+n+"</div>");this.expression.length+i.length<20?this.$rightTextInFirstLine.append(s):this.$secondLine.append(s)})}}}class ym{constructor(e,t,i){y(this,"lastSymboltable");y(this,"lastDebuggerElements",[]);y(this,"accordion");y(this,"variablePanel");y(this,"watchPanel");y(this,"isBlurred",!1);this.main=e,this.$debuggerDiv=t,this.$projectexplorerDiv=i,this.accordion=new mm(e,t),this.variablePanel=new xr(this.accordion,"Variablen","3",null,null,"",!1,!1,"file",!1,[]),this.variablePanel.$listElement.css("margin-left","4px"),this.watchPanel=new xr(this.accordion,"Beobachten","2","img_add-dark","Beobachtungsterm hinzufügen","watcher",!0,!1,"file",!1,[]),this.watchPanel.$listElement.css("margin-left","4px");let n=this;this.watchPanel.newElementCallback=(s,a)=>(n.addWatchExpression(s),a(s.externalElement),null),this.watchPanel.deleteCallback=(s,a)=>{n.deleteWatchExpression(s),a()},this.watchPanel.renameCallback=(s,a)=>(n.renameWatchExpression(s,a),a),this.$debuggerDiv.hide()}enable(){this.$projectexplorerDiv!=null&&this.$projectexplorerDiv.hide(),this.$debuggerDiv.show(),this.$debuggerDiv.parent().find(".jo_alternativeText").hide()}disable(){this.$projectexplorerDiv!=null&&this.$projectexplorerDiv.show(),this.$debuggerDiv.hide(),this.$debuggerDiv.parent().find(".jo_alternativeText").show()}showData(e,t,i,n,s){if(this.$debuggerDiv.is(":hidden")||e.module.file==null)return;let a=[],o=e.module.findSymbolTableAtPosition(t.line,t.column),u=this.lastDebuggerElements;this.lastDebuggerElements=[];let h=this.variablePanel.$listElement,d=o;if(o==null)return;if(d.classContext!=null){let v=i[n];if(u.length>0&&u[0].value==v&&u[0].variable==null)this.lastDebuggerElements.push(u[0]),a.push(this.lastDebuggerElements[0].$debuggerElement[0]);else{let w=d.classContext instanceof Vt?d.classContext.identifier:"this",_=new qn(null,null,w,v,d.classContext,null);this.lastDebuggerElements.push(_)}}let p={};for(;d!=null;)d.variableMap.forEach((v,w)=>{if(p[v.identifier]==null){p[v.identifier]=!0;let _;for(let T of u)T.variable==v&&T.$debuggerElement!=null&&(_=T,a.push(_.$debuggerElement[0]),_.value==null&&_.variable!=null&&(_.value=i[n+_.variable.stackPos]));if(_==null){let T=i[n+v.stackPos];_=new qn(null,null,w,T,v.type,v)}this.lastDebuggerElements.push(_)}},this),d=d.parent;if(o.classContext==null)for(let v in s){let w=s[v];if(p[w.identifier]!=!0){p[w.identifier]=!0;let _;for(let T of u)T.variable==w&&(_=T,a.push(_.$debuggerElement[0]),_.value=_.variable.value);if(_==null){let T=w.value;_=new qn(null,null,v,T,w.type,w)}this.lastDebuggerElements.push(_)}}for(let v of h.children())a.indexOf(v)>=0||v.remove();for(let v of this.lastDebuggerElements)v.variable!=null&&(v.variable.stackPos!=null?v.value=i[n+v.variable.stackPos]:v.value=v.variable.value),v.render(),a.indexOf(v.$debuggerElement[0])<0&&h.append(v.$debuggerElement);this.lastSymboltable=o,this.evaluateWatcherExpressions()}renameWatchExpression(e,t){e.expression=t,monaco.editor.colorize(t,"myJava",{tabSize:3}).then(i=>{let n=e.accordionElement.$htmlFirstLine.find(".jo_filename");i='<span class="jo_watcherExpression">'+i+"</span>",n.html(i),n.attr("title",e.expression)}),this.main.getInterpreter().state==Re.paused&&e.evaluate()}deleteWatchExpression(e){}addWatchExpression(e){e.$htmlSecondLine=I("<div></div>");let t=e.$htmlFirstLine.parent().find(".jo_textAfterName").first(),i=new Iw(e.name,e,this.main,e.$htmlSecondLine,t);e.externalElement=i,monaco.editor.colorize(e.name,"myJava",{tabSize:3}).then(n=>{let s=e.$htmlFirstLine.find(".jo_filename");n='<span class="jo_watcherExpression">'+n+"</span>",s.html(n),s.attr("title",e.externalElement.expression)}),i.evaluate()}evaluateWatcherExpressions(){for(let e of this.watchPanel.elements)e.externalElement.evaluate()}blur(e){this.isBlurred!=e&&(this.$debuggerDiv.find(".jo_projectexplorerdiv").css("filter",e?"blur(2px)":"none"),this.isBlurred=e)}}const oi=class oi{static init(){let e="";if(window.javaOnlineDir!=null&&(e=window.javaOnlineDir),!oi.isInitialized){oi.isInitialized=!0;for(let t of oi.sounds)t.player=new Howl({src:[e+t.url],preload:!0}),oi.soundMap.set(t.name,t)}}static play(e){let t=oi.soundMap.get(e);t!=null&&t.player.play()}static startDetectingVolume(){oi.volumeDetectionRunning||(oi.volumeDetectionRunning=!0,console.log("starting..."),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(e){let t=new AudioContext,i=t.createAnalyser(),n=t.createMediaStreamSource(e);i.smoothingTimeConstant=.8,i.fftSize=1024,n.connect(i),oi.getVolume=()=>{if(!oi.volumeDetectionRunning)return 0;var s=new Float32Array(i.frequencyBinCount);i.getFloatTimeDomainData(s);let a=0;for(let l=0;l<s.length;l++)a+=Math.abs(s[l]);return a=a/s.length,a}},function(e){console.log("The following error occured: "+e.name)}):console.log("getUserMedia not supported"))}};y(oi,"sounds",[{url:"assets/mp3/nearby_explosion_with_debris.mp3",name:"nearby_explosion_with_debris",description:"nahe Explosion mit herabfallenden Trümmern"},{url:"assets/mp3/nearby_explosion.mp3",name:"nearby_explosion",description:"nahe Explosion"},{url:"assets/mp3/far_bomb.mp3",name:"far_bomb",description:"fernes Geräusch einer Bombe"},{url:"assets/mp3/cannon_boom.mp3",name:"cannon_boom",description:"einzelner Kanonendonner"},{url:"assets/mp3/far_explosion.mp3",name:"far_explosion",description:"ferne Explosion"},{url:"assets/mp3/laser_shoot.mp3",name:"laser_shoot",description:"Laserschuss (oder was man dafür hält...)"},{url:"assets/mp3/short_bell.mp3",name:"short_bell",description:"kurzes Klingeln (wie bei alter Landenkasse)"},{url:"assets/mp3/flamethrower.mp3",name:"flamethrower",description:"Flammenwerfer"},{url:"assets/mp3/digging.mp3",name:"digging",description:"Geräusch beim Sandschaufeln"},{url:"assets/mp3/short_digging.mp3",name:"short_digging",description:"kurzes Geräusch beim Sandschaufeln"},{url:"assets/mp3/shoot.mp3",name:"shoot",description:"Schussgeräusch"},{url:"assets/mp3/short_shoot.mp3",name:"short_shoot",description:"ein kurzer Schuss"},{url:"assets/mp3/step.mp3",name:"step",description:"ein Schritt"},{url:"assets/mp3/boulder.mp3",name:"boulder",description:"Geräusch eines Steins, der auf einen zweiten fällt"},{url:"assets/mp3/pong_d5.wav",name:"pong_d",description:"Tiefer Pong-Ton"},{url:"assets/mp3/pong_f5.wav",name:"pong_f",description:"Hoher Pong-Ton"}]),y(oi,"soundMap",new Map),y(oi,"getVolume",()=>-1),y(oi,"isInitialized",!1),y(oi,"volumeDetectionRunning",!1);let Yn=oi;class bm{constructor(e,t){y(this,"actions",{});y(this,"keyEntries",{});y(this,"buttons",{});this.$mainElement=e,this.main=t}init(){let e=this.$mainElement;e==null&&(e=I(document));let t=this;e.on("keydown",function(i){i!=null&&(t.executeKeyDownEvent(i),i.key==" "&&t.main.isEmbedded()&&t.main.getInterpreter().state==Re.running&&!t.main.getMonacoEditor().hasTextFocus()&&i.preventDefault())})}trigger(e){let t=this.actions[e];t!=null&&t.action(e,null,"")}registerAction(e,t,i,n="",s){let a={action:i,identifier:e,keys:t,text:n,active:!0};this.actions[e]=a;for(let l of t)this.keyEntries[l.toLowerCase()]==null&&(this.keyEntries[l.toLowerCase()]=[]),this.keyEntries[l.toLowerCase()].push(a);if(s!=null){this.buttons[e]==null&&(this.buttons[e]=[]),this.buttons[e].push(s);let l=n;t.length>0&&(l+=" ["+t.join(", ")+"]"),s.attr("title",l);let o=window.PointerEvent?"pointer":"mouse";s.on(o+"down",()=>{a.active&&i(e,null,"mousedown"),e=="interpreter.start"&&Yn.init()})}}isActive(e){let t=this.actions[e];return t==null?!1:t.active}setActive(e,t){let i=this.actions[e];i!=null&&(i.active=t);let n=this.buttons[e];if(n!=null)for(let s of n)t?s.addClass("jo_active"):s.removeClass("jo_active")}executeKeyDownEvent(e){if(document.activeElement.tagName.toLowerCase()=="input"||e.keyCode<=18&&e.keyCode>=16)return;let t="";e.ctrlKey&&(t+="ctrl+"),e.shiftKey&&(t+="shift+"),e.altKey&&(t+="alt+"),e.key!=null&&(t+=e.key.toLowerCase());let i=this.keyEntries[t];if(i!=null){for(let n of i)if(n.active){e.stopPropagation(),e.preventDefault(),n.action(n.identifier,null,t);break}}}}class Dw{constructor(e,t){y(this,"$pcodeTab");this.main=e,this.$bottomDiv=t,this.$pcodeTab=this.$bottomDiv.find(".jo_tabs>.jo_pcodeTab")}showNode(e){if(!this.$pcodeTab.hasClass("jo_active"))return;this.$bottomDiv.find(".jo_tabs>.jo_pcodeTab").find("div").removeClass("jo_revealProgramPointer");let i=e.$div;if(i!=null){i.addClass("jo_revealProgramPointer");let n=i.position().top+this.$pcodeTab.scrollTop();n-=this.$pcodeTab.height()/2,this.$pcodeTab.scrollTop(n)}}initGUI(){this.$pcodeTab.on("myshow",()=>{this.main.printProgram()})}printModuleToBottomDiv(e,t){if(t==null||!this.$pcodeTab.hasClass("jo_active"))return;let i=this.$bottomDiv.find(".jo_tabs>.jo_pcodeTab");i.html(""),i.append(this.printModule(t)),e!=null&&e.compilerMessage!=null&&i.prepend("<div>"+e.compilerMessage+"</div>"),i.find(".jo_label_destination").on("click",n=>{let s=I(n.target).data("destination");s==null&&(s=I(n.target).parent().data("destination")),s!=null&&this.$pcodeTab.find("."+s)[0].scrollIntoView()})}printModule(e){if(e==null)return[I("<div></div>")];let t=[];if(e.mainProgram!=null&&(t.push(I("<h3>Main Program: </h3>")),t=t.concat(this.print(e.mainProgram.statements))),e.typeStore!=null&&e.typeStore.typeList!=null){for(let i of e.typeStore.typeList)if(i instanceof $){t.push(I("<h2>Class "+i.identifier+":</h2>")),i.attributeInitializationProgram.statements.length>0&&(t.push(I("<h3>Attribute-initialization:</h3>")),t=t.concat(this.print(i.attributeInitializationProgram.statements)));for(let n of i.methods)n.program!=null&&(t.push(I("<h3>Method "+n.signature+":</h3>")),t=t.concat(this.print(n.program.statements)));for(let n of i.staticClass.methods)n.program!=null&&(t.push(I("<h3>Static Method "+n.signature+":</h3>")),t=t.concat(this.print(n.program.statements)))}}return t}print(e,t=""){let i=new Map,n=0;for(let l of e){if(l.type==f.jumpAlways||l.type==f.jumpIfFalse||l.type==f.jumpIfTrue||l.type==f.jumpIfFalseAndLeaveOnStack||l.type==f.jumpIfTrueAndLeaveOnStack||l.type==f.extendedForLoopCheckCounterAndGetElement){let o=l.destination;i.get(o)==null&&i.set(o,{number:n++})}if(l.type==f.keywordSwitch){for(let o in l.destinationMap){let u=l.destinationMap[o];i.get(u)==null&&i.set(u,{number:n++})}l.defaultDestination!=null&&i.get(l.defaultDestination)==null&&i.set(l.defaultDestination,{number:n++})}}let s=[],a=0;for(let l of e)s.push(this.printNode(l,t,a,i)),a++;return s}printNode(e,t,i,n){let s=t,a=n.get(i);a!=null&&(s+="<span style='font-weight: bold' class='label"+a.number+"'>Label&nbsp;<span style='color: green'>"+a.number+":</span></span><br>"),e.position!=null?s+="(l"+this.format3(e.position.line)+",&nbsp;c"+this.format3(e.position.column)+"): ":s+="(l&nbsp;xxx,&nbsp;c&nbsp;xxx):",s+="<span style='fontweight: bold; color: #8080ff'>"+f[e.type]+"</span>&nbsp;";let l="";switch(e.type){case f.localVariableDeclaration:l+="V: "+this.printVariable(e.variable)+"&nbsp;&nbsp;pushToStackTop: "+e.pushOnTopOfStackForInitialization;break;case f.heapVariableDeclaration:l+="V: "+this.printVariable(e.variable)+"&nbsp;&nbsp;pushToStackTop: "+e.pushOnTopOfStackForInitialization;break;case f.pushLocalVariableToStack:l+="StackPos: "+e.stackposOfVariable;break;case f.pushFromHeapToStack:l+="v: "+e.identifier;break;case f.pushAttribute:l+="Attribut: "+e.attributeIdentifier+", use THIS-Object: "+e.useThisObject;break;case f.assignment:case f.plusAssignment:case f.minusAssignment:case f.multiplicationAssignment:case f.divisionAssignment:l+="Assignmenttype: "+ni[e.type]+"&nbsp;&nbsp;",e.type==f.assignment&&(l+=", leaveValueOnStack: "+e.leaveValueOnStack);break;case f.binaryOp:case f.unaryOp:l+="Operator: "+ni[e.operator];break;case f.pushConstant:l+="Value: "+(e.value+"").replace(/</g,"&lt;").replace(/>/g,"&gt;");break;case f.pushStaticClassObject:l+="Static class: "+e.klass.identifier;break;case f.castValue:l+="New Type: "+e.newType.identifier;break;case f.selectArrayElement:break;case f.callMethod:l+=e.method.identifier,l+=", StackframeBegin: "+e.stackframeBegin;break;case f.decreaseStackpointer:l+="count: "+e.popCount;break;case f.return:l+="copyReturnValueToStackframePos0: "+e.copyReturnValueToStackframePos0;break;case f.extendedForLoopCheckCounterAndGetElement:case f.jumpAlways:case f.jumpIfFalse:case f.jumpIfTrue:case f.jumpIfFalseAndLeaveOnStack:case f.jumpIfTrueAndLeaveOnStack:let u=n.get(e.destination).number;l+="destination: <span style='font-weight: bold' class='jo_label_destination' data-destination='label"+u+"'>Label<span style='color: green'>&nbsp;"+u+"</span></span>";break;case f.incrementDecrementBefore:case f.incrementDecrementAfter:l+="amount: "+e.incrementDecrementBy;break;case f.beginArray:l+="type: "+e.arrayType.identifier;break;case f.addToArray:l+="count: "+e.numberOfElementsToAdd;break;case f.pushEmptyArray:l+="type: "+e.arrayType.identifier,l+=", dimension: "+e.dimension;break;case f.keywordSwitch:l+="destinationMap: {";for(let h in e.destinationMap){let d=n.get(e.destinationMap[h]).number;l+=h+": <span style='font-weight: bold' class='jo_label_destination' data-destination='label"+d+"'>Label<span style='color: green'>&nbsp;"+d+"</span></span>, "}if(l.endsWith(", ")&&(l=l.substring(0,l.length-2)),l+="}",e.defaultDestination!=null){let h=n.get(e.defaultDestination).number;l+=", defaultDestination: <span style='font-weight: bold' class='jo_label_destination' data-destination='label"+h+"'>Label<span style='color: green'>&nbsp;"+h+"</span></span>"}break;case f.pushStaticAttribute:e.klass!=null&&(l+="class: "+e.klass.identifier+", attribute: "+e.attributeIdentifier);break;case f.newObject:l+="class: "+e.class.identifier;break}l!=""&&(s+=` [${l}]`),e.stepFinished==!0&&(s+="::"),s="<div>"+s+"</div>";let o=I(s);return e.$div=o,o}printVariable(e){return e.type.identifier+" "+e.identifier+(e.stackPos==null?"":" (sp: "+e.stackPos+")")}format3(e){return e>=100?""+e:e>=10?"&nbsp;"+e:"&nbsp;&nbsp;"+e}}class qr{constructor(e,t,i,n,s,a=null){y(this,"caption");y(this,"parent");y(this,"children");y(this,"canOpen");y(this,"isOpen",!1);y(this,"identifier");y(this,"value");y(this,"$consoleEntry");this.withBottomBorder=s,this.color=a,this.caption=e,this.parent=n,n!=null&&n.children.push(this),this.value=t,this.identifier=i,this.render()}getLevel(){return this.parent==null?0:this.parent.getLevel()+1}getIndent(){return this.getLevel()==0?0:15}render(){this.$consoleEntry=I("<div>"),this.$consoleEntry.addClass("jo_consoleEntry"),this.$consoleEntry.css("margin-left",""+this.getIndent()+"px"),this.color!=null&&this.$consoleEntry.css("background-color",this.color),this.withBottomBorder&&this.$consoleEntry.addClass("jo_withBorder");let e=I('<div class="jo_ceFirstline"></div>');this.$consoleEntry.append(e),this.value!=null&&this.value.type!=null&&(this.value.type instanceof ze||this.value.type instanceof $&&!(this.value.type instanceof $t)&&this.value.type!=F||this.value.type instanceof Pe)?(this.canOpen=!0,this.$consoleEntry.addClass("jo_canOpen"),this.$consoleEntry.append(I('<div class="jo_ceChildContainer"></div>')),this.$consoleEntry.find(".jo_ceFirstline").on("mousedown",t=>{this.value!=null&&this.value.value!=null?(this.children==null&&this.onFirstOpening(),this.$consoleEntry.toggleClass("jo_expanded"),this.isOpen=!this.isOpen):this.children=null,t.stopPropagation()})):this.caption==null&&this.getLevel()==0&&this.$consoleEntry.addClass("jo_cannotOpen"),this.renderValue()}onFirstOpening(){this.children=[];let e=this.value.type;if(e instanceof $)for(let t of this.value.type.getAttributes(ee.private)){let i=this.value.value,n=new qr(null,i.getValue(t.index),t.identifier,this,!1);n.render(),this.$consoleEntry.find(".jo_ceChildContainer").append(n.$consoleEntry)}else if(e instanceof ze){let t=this.value.value,i=this.$consoleEntry.find(".jo_ceChildContainer");for(let n=0;n<t.length&&n<100;n++){let s=new qr(null,t[n],"["+n+"]",this,!1);s.render(),i.append(s.$consoleEntry)}}else if(e instanceof Vt){let t=this.$consoleEntry.find(".jo_ceChildContainer");for(let i of e.getAttributes(ee.private)){let n=e.classObject,s=new qr(null,n.getValue(i.index),i.identifier,this,!1);s.render(),t.append(s.$consoleEntry)}}else if(e instanceof Pe)if(this.value.value!=null&&this.value.value instanceof he){let t=this.$consoleEntry.find(".jo_ceChildContainer"),i=this.value.value;for(let n of i.class.getAttributes(ee.private)){let s=new qr(null,i.getValue(n.index),n.identifier,this,!1);s.render(),t.append(s.$consoleEntry)}}else this.children==null}renderValue(){let e=this.$consoleEntry.find(".jo_ceFirstline"),t=this.value;if(t==null){if(this.caption!=null)if(typeof this.caption=="string")e.append(I('<span class="jo_ceCaption">'+this.caption+"</span>"));else{let n=I('<span class="jo_ceCaption"></span>');n.append(this.caption),e.append(n)}else e.append(I('<span class="jo_ceNoValue">Kein Wert zurückgegeben.</span>'));return}let i="";t.value==null?i="null":i=t.type.debugOutput(t,400),this.identifier!=null&&e.append(I('<span class="jo_ceIdentifier">'+this.identifier+":&nbsp;</span>")),e.append(I('<span class="jo_ceValue">'+i+"</span>"))}detachValue(){this.value=void 0,this.$consoleEntry.removeClass("jo_canOpen"),this.getLevel()==0&&this.caption==null&&this.$consoleEntry.addClass("jo_cannotOpen")}}class up{constructor(e,t){y(this,"editor");y(this,"history",[]);y(this,"historyPos",0);y(this,"timerHandle");y(this,"isDirty",!1);y(this,"readyToExecute",!1);y(this,"compiler");y(this,"consoleEntries",[]);y(this,"errorDecoration",[]);y(this,"$consoleTabHeading");y(this,"$consoleTab");this.main=e,this.$bottomDiv=t,t!=null&&(this.$consoleTabHeading=t.find(".jo_tabheadings>.jo_console-tab"),this.$consoleTab=t.find(".jo_tabs>.jo_consoleTab"))}initConsoleClearButton(){let e=this,t=this.$consoleTabHeading.parent().find(".jo_console-clear");this.$consoleTab.on("myshow",()=>{t.show(),e.editor.layout()}),this.$consoleTab.on("myhide",()=>{t.hide()}),t.on("mousedown",i=>{i.stopPropagation(),e.clear()})}initGUI(){if(this.$bottomDiv==null)return;this.initConsoleClearButton();let e=this.$consoleTab.find(".jo_commandline");this.editor=monaco.editor.create(e[0],{value:[""].join(`
`),automaticLayout:!1,renderLineHighlight:"none",guides:{bracketPairs:!1,highlightActiveIndentation:!1,indentation:!1},overviewRulerLanes:0,lineNumbers:"off",glyphMargin:!1,folding:!1,lineDecorationsWidth:0,lineNumbersMinChars:0,fixedOverflowWidgets:!0,language:"myJava",fontSize:14,fontFamily:window.javaOnlineFont==null?"Consolas, Roboto Mono":window.javaOnlineFont,fontWeight:"500",roundedSelection:!0,occurrencesHighlight:!1,suggest:{localityBonus:!0,snippetsPreventQuickSuggestions:!1},minimap:{enabled:!1},scrollbar:{vertical:"hidden",horizontal:"hidden"},theme:"myCustomThemeDark"}),this.editor.layout();let t=this;this.editor.addCommand(monaco.KeyCode.Enter,()=>{if(t.compileIfDirty(),t.readyToExecute){let s=t.editor.getModel().getValue(monaco.editor.EndOfLinePreference.LF,!1);if(s=="")return;t.history.push(s),t.historyPos=0,t.execute(),t.editor.setValue("")}},"!suggestWidgetVisible"),this.editor.addCommand(monaco.KeyCode.UpArrow,()=>{let s=t.history.length-(t.historyPos+1);if(s>=0){t.historyPos++;let a=t.history[s];t.editor.setValue(a),t.editor.setPosition({lineNumber:1,column:a.length+1})}},"!suggestWidgetVisible"),this.editor.addCommand(monaco.KeyCode.DownArrow,()=>{let s=t.history.length-(t.historyPos-1);if(s<=t.history.length-1){t.historyPos--;let a=t.history[s];t.editor.setValue(a),t.editor.setPosition({lineNumber:1,column:a.length+1})}else t.editor.setValue(""),t.historyPos=0},"!suggestWidgetVisible"),this.compiler=new pm(this.main);let i=this.editor.getModel(),n=0;i.onDidChangeContent(()=>{let s=i.getAlternativeVersionId();s!=n&&(t.isDirty=!0,n=s)}),this.startTimer(),this.$consoleTabHeading.on("mousedown",()=>{rn.showHelper("consoleHelper",this.main),setTimeout(()=>{t.editor.focus()},500)})}startTimer(){this.stopTimer();let e=this;this.timerHandle=setInterval(()=>{e.compileIfDirty()},500)}stopTimer(){this.timerHandle!=null&&(clearInterval(this.timerHandle),this.timerHandle=null)}compileIfDirty(){if(this.isDirty){let e=this.editor.getModel().getValue(monaco.editor.EndOfLinePreference.LF,!1),t=this.main.getCurrentWorkspace().moduleStore,i=this.main.getDebugger().lastSymboltable,n=this.main.getInterpreter().heap;if(e.length>0&&t!=null){let s=this.compiler.compile(e,t,n,i);this.readyToExecute=s.errors.find(a=>a.level=="error")==null,this.showErrors(s.errors),this.isDirty=!1}else this.showErrors([])}}showErrors(e){let t=[],i={info:monaco.MarkerSeverity.Info,warning:monaco.MarkerSeverity.Warning,error:monaco.MarkerSeverity.Error};for(let n of e)t.push({startLineNumber:n.position.line,startColumn:n.position.column,endLineNumber:n.position.line,endColumn:n.position.column+n.position.length,message:n.text,severity:i[n.level]});monaco.editor.setModelMarkers(this.editor.getModel(),"Fehler",t)}execute(){let e=this.main.getInterpreter(),t=this.compiler.module,i=this.editor.getModel().getValue(monaco.editor.EndOfLinePreference.LF,!1),n=t.mainProgram;monaco.editor.colorize(i,"myJava",{tabSize:3}).then(s=>{this.executeRapidly(e,n,s),e.showProgramPointerAndVariables()})}programHasMethodCalls(e){for(let t of e.statements)if(t.type==f.callMethod&&t.method.invoke==null)return!0;return!1}executeInStepMode(e,t,i){e.pushCurrentProgram(),e.currentProgram=t,e.currentProgramPosition=0;let n=e.stack.length,s=e.state;e.setState(Re.paused),e.start(()=>{let a;if(e.stack.length>n)for(a=e.stack.pop();e.stack.length>n;)e.stack.pop();this.writeConsoleEntry(i,a),e.setState(s),s==Re.paused&&e.showProgramPointerAndVariables()})}executeRapidly(e,t,i){let n=e.evaluate(t);if(n.error==null)this.writeConsoleEntry(i,n.value);else{let s=jQuery("<div><div>"+i+"</div></div>");s.append(jQuery('<div class="jo_console-error"> '+n.error+"</div>")),this.writeConsoleEntry(s,null)}}showTab(){let e=window.PointerEvent?"pointer":"mouse";this.$consoleTabHeading.trigger(e+"down")}writeConsoleEntry(e,t,i=null){if(this.$consoleTab==null)return;let n=this.$consoleTab.find(".jo_console-top"),s=new qr(e,null,null,null,t==null,i);if(this.consoleEntries.push(s),n.append(s.$consoleEntry),t!=null){let l=new qr(null,t,null,null,!0,i);this.consoleEntries.push(l),n.append(l.$consoleEntry)}var a=n[0].scrollHeight;n.scrollTop(a)}clear(){this.$consoleTab.find(".jo_console-top").children().remove(),this.consoleEntries=[]}detachValues(){for(let e of this.consoleEntries)e.detachValue()}showError(e,t){var n,s,a;this.main instanceof ul&&((n=e==null?void 0:e.file)==null?void 0:n.name)!=((a=(s=this.main.projectExplorer.getCurrentlyEditedModule())==null?void 0:s.file)==null?void 0:a.name)&&(this.main.editor.dontDetectLastChange(),this.main.projectExplorer.setModuleActive(e));let i={startColumn:t.column,startLineNumber:t.line,endColumn:t.column+t.length,endLineNumber:t.line};this.main.getMonacoEditor().revealRangeInCenter(i),this.errorDecoration=this.main.getMonacoEditor().deltaDecorations(this.errorDecoration,[{range:i,options:{className:"jo_revealError"}},{range:i,options:{className:"jo_revealErrorWholeLine",isWholeLine:!0}}])}clearErrors(){this.errorDecoration=this.main.getMonacoEditor().deltaDecorations(this.errorDecoration,[])}clearExceptions(){if(this.$bottomDiv==null)return;this.$consoleTab.find(".jo_console-top").find(".jo_exception").parents(".jo_consoleEntry").remove()}}class Fw{constructor(e,t,i){y(this,"oldDecorations",[]);y(this,"oldErrorDecorations",[]);y(this,"$errorDiv");y(this,"$bracket_warning");y(this,"minimapColor",{});y(this,"lightBulbOnClickFunctionList",[]);this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.minimapColor.error="#bc1616",this.minimapColor.warning="#cca700",this.minimapColor.info="#75beff",this.$bracket_warning=i.find(".jo_parenthesis_warning"),this.$bracket_warning.attr("title","Klammeralarm!"),this.$bracket_warning.children().attr("title","Klammeralarm!");let n=this;i.find(".jo_pw_undo").on("click",()=>{n.main.getMonacoEditor().trigger(".","undo",{})}).attr("title","Undo")}showParenthesisWarning(e){e!=null?(this.$bracket_warning.css("visibility","visible"),this.$bracket_warning.find(".jo_pw_heading").text(e)):this.$bracket_warning.css("visibility","hidden")}showErrors(e){this.lightBulbOnClickFunctionList=[];let t=new Map;this.$errorDiv=this.$bottomDiv.find(".jo_tabs>.jo_errorsTab"),this.$errorDiv.empty();let i=!1,n=e.moduleStore,s=this.main.getMonacoEditor();for(let a of n.getModules(!1)){let l=[],o=[],u=[],h=a.getSortedAndFilteredErrors();t.set(a,a.getErrorCount());for(let d of h){let p,v,w=this.minimapColor[d.level];switch(d.level){case"error":p="jo_revealErrorLine",v="jo_borderLeftError";break;case"warning":p="jo_revealWarningLine",v="jo_borderLeftWarning";break;case"info":p="jo_revealInfoLine",v="jo_borderLeftInfo";break}if(d.quickFix!=null){let T=d.quickFix,D="lb_"+Math.trunc(Math.random()*1e6);p="jo_yellowLightBulb "+v+" "+D,this.lightBulbOnClickFunctionList.push({class:"."+D,onClickFunction:()=>{let L=T.editsProvider(a.model.uri);s.executeEdits("",L.map(O=>{let z=O.edit.range;return{range:new monaco.Range(z.startLineNumber,z.startColumn,z.endLineNumber,z.endColumn),text:O.edit.text,forceMoveMarkers:!0}}))},title:T.title})}this.processError(d,a,u);let _;switch(d.level){case"error":_=monaco.MarkerSeverity.Error;break;case"warning":_=monaco.MarkerSeverity.Warning;break;case"info":_=monaco.MarkerSeverity.Info;break}l.push({startLineNumber:d.position.line,startColumn:d.position.column,endLineNumber:d.position.line,endColumn:d.position.column+d.position.length,message:d.text,severity:_,relatedInformation:d.quickFix}),o.push({range:{startLineNumber:d.position.line,startColumn:d.position.column,endLineNumber:d.position.line,endColumn:d.position.column+d.position.length},options:{linesDecorationsClassName:p,minimap:{position:monaco.editor.MinimapPosition.Inline,color:w}}})}if(monaco.editor.setModelMarkers(a.model,"test",l),a.oldErrorDecorations=a.model.deltaDecorations(a.oldErrorDecorations,o),this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[]),u.length>0&&this.$errorDiv.length>0){i=!0;let d=I('<div class="jo_error-filename">'+a.file.name+"&nbsp;</div>");this.$errorDiv.append(d);for(let p of u)this.$errorDiv.append(p)}}return!i&&this.$errorDiv.length>0&&this.$errorDiv.append(I('<div class="jo_noErrorMessage">Keine Fehler gefunden :-)</div>')),this.registerLightbulbOnClickFunctions(),t}registerLightbulbOnClickFunctions(){let e=this;setTimeout(()=>{for(let t of e.lightBulbOnClickFunctionList)I(t.class).off("click",t.onClickFunction),I(t.class).on("click",t.onClickFunction).attr("title",t.title)},800)}processError(e,t,i){let n=I('<div class="jo_error-line"></div>'),s=I('<span class="jo_error-position">[Z&nbsp;<span class="jo_linecolumn">'+e.position.line+'</span> Sp&nbsp;<span class="jo_linecolumn">'+e.position.column+"</span>]</span>:&nbsp;"),a="";switch(e.level){case"error":break;case"warning":a='<span class="jo_warning_category">Warnung: </span>';break;case"info":a='<span class="jo_info_category">Info: </span>';break}let l=I('<div class="jo_error-text">'+a+e.text+"</div>");n.append(s).append(l);let o=this;n.on("mousedown",u=>{this.$errorDiv.find(".jo_error-line").removeClass("jo_active"),n.addClass("jo_active"),o.showError(t,e)}),i.push(n)}showError(e,t){this.main instanceof ul&&e!=this.main.projectExplorer.getCurrentlyEditedModule()&&(this.main.editor.dontDetectLastChange(),this.main.projectExplorer.setModuleActive(e));let i=t.position,n={startColumn:i.column,startLineNumber:i.line,endColumn:i.column+i.length,endLineNumber:i.line};this.main.getMonacoEditor().revealRangeInCenter(n);let s="";switch(t.level){case"error":s="jo_revealError";break;case"warning":s="jo_revealWarning";break;case"info":s="jo_revealInfo";break}this.oldDecorations=this.main.getMonacoEditor().deltaDecorations(this.oldDecorations,[{range:n,options:{className:s}}])}}class Rw{constructor(e,t){y(this,"$homeworkTab");y(this,"$homeworkTabLeft");y(this,"$homeworkTabRight");y(this,"$showRevisionButton");y(this,"showRevisionActive",!1);y(this,"diffEditor");this.main=e,this.$bottomDiv=t,this.$homeworkTab=t.find(".jo_tabs>.jo_homeworkTab")}initGUI(){let e=this;this.$homeworkTab.append(this.$homeworkTabLeft=Ri("","jo_homeworkTabLeft jo_scrollable")),this.$homeworkTab.append(this.$homeworkTabRight=Ri("","jo_homeworkTabRight jo_scrollable")),this.$showRevisionButton=Ri("","jo_button jo_active jo_homeworkRevisionButton",""),I("#view-mode").prepend(this.$showRevisionButton),this.$showRevisionButton.on("click",()=>{this.showRevisionActive?this.hideRevision():this.showRevision(e.main.getCurrentlyEditedModule())}),this.$showRevisionButton.hide(),I("#diffEditor").hide()}showHomeWorkRevisionButton(){this.$showRevisionButton.text(this.showRevisionActive?"Normalansicht":"Korrekturen zeigen"),this.$showRevisionButton.show()}hideHomeworkRevisionButton(){this.$showRevisionButton.hide()}showRevision(e){e.file.text=e.getProgramTextFromMonacoModel();let t=e.file;I("#editor").hide(),I("#diffEditor").show();var i=monaco.editor.createModel(t.text_before_revision,"myJava"),n=monaco.editor.createModel(t.text,"myJava");this.diffEditor=monaco.editor.createDiffEditor(document.getElementById("diffEditor"),{enableSplitViewResizing:!0,originalEditable:!1,readOnly:!0,renderSideBySide:!0}),this.diffEditor.setModel({original:i,modified:n}),this.showRevisionActive=!0,this.showHomeWorkRevisionButton()}hideRevision(){this.showRevisionActive&&(I("#diffEditor").hide(),this.diffEditor.dispose(),this.diffEditor=null,I("#editor").show(),this.showRevisionActive=!1,this.showHomeWorkRevisionButton())}attachToWorkspaces(e){let t=[],i={};e.forEach(a=>{a.moduleStore.getModules(!1).forEach(l=>{let o=l.file.submitted_date;if(o!=null){let u=_w(o),h=Sw(u),d=i[h];d==null&&(d={date:u,day:h,modules:[]},i[h]=d,t.push(d)),d.modules.push({module:l,workspace:a})}})}),this.$homeworkTabLeft.empty(),this.$homeworkTabRight.empty();let n=this;this.$homeworkTabLeft.append(Ri("","jo_homeworkHeading","Abgabetage:")),t.sort((a,l)=>a.date.getFullYear()!=l.date.getFullYear()?-Math.sign(a.date.getFullYear()-l.date.getFullYear()):a.date.getMonth()!=l.date.getMonth()?-Math.sign(a.date.getMonth()-l.date.getMonth()):a.date.getDate()!=l.date.getDate()?-Math.sign(a.date.getDate()-l.date.getDate()):0);let s=!0;t.forEach(a=>{a.modules.sort((o,u)=>o.module.file.name.localeCompare(u.module.file.name));let l=Ri("","jo_homeworkDate",a.day);this.$homeworkTabLeft.append(l),l.on("click",o=>{this.$homeworkTabLeft.find(".jo_homeworkDate").removeClass("jo_active"),l.addClass("jo_active"),n.select(a)}),s&&(s=!1,l.addClass("jo_active"),n.select(a))})}select(e){this.$homeworkTabRight.empty(),this.$homeworkTabRight.append(Ri("","jo_homeworkHeading","Abgegebene Dateien:"));let t=this;e.modules.forEach(i=>{let n=I(`<div class="jo_homeworkEntry">Workspace <span class="jo_homework-workspace">
                    ${i.workspace.name}</span>, Datei <span class="jo_homework-file">
                    ${i.module.file.name}</span> (Abgabe: ${i.module.file.submitted_date} )</div>`);t.$homeworkTabRight.append(n),n.on("click",()=>{t.main.projectExplorer.setWorkspaceActive(i.workspace,!0),t.main.projectExplorer.setModuleActive(i.module),t.main.projectExplorer.fileListPanel.select(i.module,!1)})})}}class Ow{constructor(e,t,i){y(this,"$gradingTab");y(this,"$gradingMark");y(this,"$gradingPoints");y(this,"$gradingCommentMarkdown");y(this,"$attendedExam");y(this,"dontFireOnChange",!1);this.main=e,this.$tabHeading=i,this.$gradingTab=t.find(".jo_tabs>.jo_gradingTab"),Li.getInstance().subscribe("onGradeChangedInPruefungAdministration",()=>{this.setValues(this.main.currentWorkspace)})}initGUI(){let e=this;this.$gradingTab.empty();let t=Ri(null,"jo_grading_markcolumn");this.$gradingMark=I('<input type="text" class="jo_grading_mark"></input>'),this.$gradingPoints=I('<input type="text" class="jo_grading_points"></input>'),this.$attendedExam=I('<input type="checkbox" class="jo_grading_attended_exam"></input>'),this.$gradingMark.on("input",()=>{e.onChange()}),this.$gradingPoints.on("input",()=>{e.onChange()}),this.$attendedExam.on("input",()=>{e.onChange()});let i=Ri(null,"jo_grading_markdiv"),n=Ri(null,"jo_grading_markdiv"),s=Ri(null,"jo_grading_markdiv");i.append(Ri(null,null,"Punkte:"),this.$gradingPoints),n.append(Ri(null,null,"Note:",{"margin-top":"3px"}),this.$gradingMark),s.append(Ri(null,null,"Anwesend:",{"margin-top":"3px"}),this.$attendedExam),t.append(i,n,s),this.$gradingCommentMarkdown=I('<textarea class="jo_grading_commentmarkdown" placeholder="Bemerkung..."></textarea>'),this.$gradingCommentMarkdown.on("input",()=>{e.onChange()}),e.main.user.is_teacher?(this.$gradingCommentMarkdown.removeAttr("readonly"),this.$gradingMark.removeAttr("readonly"),this.$gradingPoints.removeAttr("readonly"),s.css("display","block")):(this.$gradingCommentMarkdown.attr("readonly","readonly"),this.$gradingMark.attr("readonly","readonly"),this.$gradingPoints.attr("readonly","readonly"),s.css("display","none")),this.$gradingTab.append(t,this.$gradingCommentMarkdown)}setValues(e){if(e==null)return;let t=!1;this.main.user.is_teacher?t=this.main.workspacesOwnerId==this.main.user.id:t=this.isEmptyOrNull(e.grade)&&this.isEmptyOrNull(e.points)&&this.isEmptyOrNull(e.comment)&&e.attended_exam!=!0,t&&this.$gradingTab.removeClass("jo_active"),this.$tabHeading.css("display",t?"none":"block"),this.dontFireOnChange=!0,this.$gradingMark.val(e.grade==null?"":e.grade),this.$gradingPoints.val(e.points==null?"":e.points),this.$gradingCommentMarkdown.val(e.comment==null?"":e.comment),this.$attendedExam.prop("checked",e.attended_exam==!0),this.dontFireOnChange=!1}onChange(){var t,i,n;if(this.dontFireOnChange)return;let e=this.main.currentWorkspace;e!=null&&(e.grade=(t=this.$gradingMark.val())==null?void 0:t.trim(),e.points=(i=this.$gradingPoints.val())==null?void 0:i.trim(),e.comment=(n=this.$gradingCommentMarkdown.val())==null?void 0:n.trim(),e.attended_exam=this.$attendedExam.is(":checked"),e.saved=!1)}isEmptyOrNull(e){return e==null||e.trim().length==0}}class vm{constructor(e,t,i){y(this,"programPrinter");y(this,"console");y(this,"errorManager");y(this,"homeworkManager");y(this,"gradingManager");this.main=e,this.$bottomDiv=t,this.$mainDiv=i,this.$bottomDiv.find(".jo_tabs>.jo_pcodeTab").length>0&&(this.programPrinter=new Dw(e,t)),this.$bottomDiv.find(".jo_tabheadings>.jo_console-tab").length>0?this.console=new up(e,t):this.console=new up(e,null),this.$bottomDiv.find(".jo_tabheadings>.jo_homeworkTabheading").length>0&&(this.homeworkManager=new Rw(e,t));let n=this.$bottomDiv.find(".jo_tabheadings>.jo_gradingTabheading");n.length>0&&(this.gradingManager=new Ow(e,t,n)),this.errorManager=new Fw(e,t,i)}initGUI(){Ao(this.$bottomDiv),this.programPrinter!=null&&this.programPrinter.initGUI(),this.console!=null&&this.console.initGUI(),this.homeworkManager!=null&&this.homeworkManager.initGUI(),this.$bottomDiv.find(".jo_tabs").children().first().trigger("click");let e=this;I(".jo_pcodeTab").on("myshow",()=>{e.printCurrentlyExecutedModule()})}printCurrentlyExecutedModule(){var t;let e=this.main.getInterpreter();if(e.state==Re.running||e.state==Re.paused){let i=(t=e.currentProgram)==null?void 0:t.module;this.printModuleToBottomDiv(null,i)}}printModuleToBottomDiv(e,t){this.programPrinter!=null&&this.programPrinter.printModuleToBottomDiv(e,t)}showHomeworkTab(){I(".jo_homeworkTabheading").css("display","block");let e=window.PointerEvent?"pointer":"mouse";I(".jo_homeworkTabheading").trigger(e+"down")}hideHomeworkTab(){I(".jo_homeworkTabheading").css("display","none");let e=window.PointerEvent?"pointer":"mouse";I(".jo_tabheadings").children().first().trigger(e+"down")}showHideDbBusyIcon(e){let t=e?"block":"none";I(".jo_db-busy").css("display",t)}}class Lw{constructor(e){y(this,"isConsole");y(this,"triggerCharacters",[".","abcdefghijklmnopqrstuvwxyzäöüß_ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜ"," "]);y(this,"first",!0);this.main=e}provideCompletionItems(e,t,i,n){var D,L,O,z,V,Q,S;setTimeout(()=>{var re;let Z=(re=this.main.getMonacoEditor()._contentWidgets["editor.widget.suggestWidget"])==null?void 0:re.widget;Z!=null&&Z._widget!=null&&this.first&&(Z._widget.toggleDetails(),this.first=!1)},300);let s=(O=(L=(D=this.main.getBottomDiv())==null?void 0:D.console)==null?void 0:L.editor)==null?void 0:O.getModel();this.isConsole=e==s;let a=e==this.main.getMonacoEditor().getModel();if(!(this.isConsole||a))return;let l=this.isConsole?(V=(z=this.main.getBottomDiv())==null?void 0:z.console)==null?void 0:V.compiler.module:this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(l==null||this.isStringLiteral(l,t))return null;let o=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column}),u=e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:t.lineNumber+5,endColumn:1});if(i.triggerCharacter==" "){if(o.match(/.*(new )$/)!=null)return this.getCompletionItemsAfterNew(l);if(o.match(/.*(class )[\wöäüÖÄÜß<> ,]*[\wöäüÖÄÜß<> ] $/)!=null){let me=o.lastIndexOf("class"),le=0,oe=0;for(let X=me;X<o.length;X++)switch(o.charAt(X)){case"<":le++;break;case">":oe++;break}return this.getCompletionItemsAfterClass(l,le>oe,u)}return null}let h=u.match(/^([\wöäüÖÄÜß]*\(?)/),d="";h!=null&&h.length>0&&(d=h[0]);let p=d.endsWith("("),v=o.match(/.*(\.)([\wöäüÖÄÜß]*)$/);v!=null&&(this.isConsole?(S=(Q=this.main.getBottomDiv())==null?void 0:Q.console)==null||S.compileIfDirty():this.main.compileIfDirty());let w=this.isConsole?this.main.getDebugger().lastSymboltable:l.findSymbolTableAtPosition(t.lineNumber,t.column),_=w==null?null:w.classContext;if(v!=null)return this.getCompletionItemsAfterDot(v,t,l,d,_,p);let T=o.match(/.*[^\wöäüÖÄÜß]([\wöäüÖÄÜß]*)$/);if(T==null&&(T=o.match(/^([\wöäüÖÄÜß]*)$/)),T!=null)return this.getCompletionItemsInsideIdentifier(T,t,l,d,_,p,w)}isStringLiteral(e,t){let i=e.tokenList;if(i==null||i.length==0)return!1;let n=0,s=i.length-1,a,l=1e3;for(;;){let o=a;if(a=Math.round((s+n)/2),o==a||(l--,l==0))return!1;let u=i[a],h=u.position;if(h.line<t.lineNumber||h.line==t.lineNumber&&h.column+h.length<t.column){n=a;continue}if(h.line>t.lineNumber||h.line==t.lineNumber&&h.column>t.column){s=a;continue}return u.tt==f.stringConstant}}getCompletionItemsAfterNew(e){let t=[];t=t.concat(this.main.getCurrentWorkspace().moduleStore.getTypeCompletionItems(e,void 0));for(let i=0;i<t.length;i++){let n=t[i];if(n.detail.match("Primitiv")){t.splice(i,1),i--;continue}n.generic?n.insertText+="<>($0)":n.insertText+="($0)",n.insertTextRules=monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,n.command={id:"editor.action.triggerParameterHints",title:"123",arguments:[]}}return Promise.resolve({suggestions:t})}getCompletionItemsAfterClass(e,t,i){let n=[],s=i.trimLeft().startsWith("{");return n=n.concat([{label:"extends",insertText:"extends $1"+(t||s?"":` {
	$0
}`),detail:"extends-Operator",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0,command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]}},{label:"implements",insertText:"implements $1"+(t||s?"":` {
	$0
}`),detail:"implements-Operator",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0,command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]}},{label:"{}",insertText:`{
	$0
}`,detail:"Klassenrumpf",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}]),Promise.resolve({suggestions:n})}getCompletionItemsInsideIdentifier(e,t,i,n,s,a,l){var d;let o=e[1],u={startLineNumber:t.lineNumber,startColumn:t.column-o.length,endLineNumber:t.lineNumber,endColumn:t.column+n.length},h=[];if((l==null?void 0:l.classContext)!=null&&(l==null?void 0:l.method)==null&&l.classContext instanceof $&&(h=h.concat(this.getOverridableMethodsCompletion(l.classContext))),l!=null&&(h=h.concat(l.getLocalVariableCompletionItems(u).map(p=>(p.sortText="aaa"+p.label,p)))),h=h.concat(this.main.getCurrentWorkspace().moduleStore.getTypeCompletionItems(i,u)),s!=null&&(l==null?void 0:l.method)!=null)h=h.concat(s.getCompletionItems(ee.private,a,n,u,l.method).map(p=>(p.sortText="aa"+p.label,p))),h.push({label:"super",filterText:"super",insertText:"super.",detail:"Aufruf einer Methode einer Basisklasse",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0,command:{id:"editor.action.triggerSuggest",title:"123",arguments:[]}});else{let p=(d=i.file)==null?void 0:d.name;if(p!=null){p.endsWith(".java")&&(p=p.substr(0,p.indexOf(".java")));let v=p.match(/([\wöäüÖÄÜß]*)$/);i.classDefinitionsAST.length==0&&v!=null&&v.length>0&&v[0]==p&&p.length>0&&(p=p.charAt(0).toUpperCase()+p.substring(1),h.push({label:"class "+p,filterText:"class",insertText:"class ${1:"+p+`} {
	$0
}
`,detail:"Definition der Klasse "+p,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}))}}return h=h.concat(this.getKeywordCompletion(l)),Promise.resolve({suggestions:h})}getCompletionItemsAfterDot(e,t,i,n,s,a){let l=e[2],o=t.column-l.length-1,u=i.getTypeAtPosition(t.lineNumber,o),h={startLineNumber:t.lineNumber,startColumn:t.column-l.length,endLineNumber:t.lineNumber,endColumn:t.column+n.length};if(u==null)return null;let{type:d,isStatic:p}=u;if(d instanceof $){let v=Aa(d,s);return p?Promise.resolve({suggestions:d.staticClass.getCompletionItems(v,a,n,h)}):Promise.resolve({suggestions:d.getCompletionItems(v,a,n,h,null)})}return d instanceof Pe?Promise.resolve({suggestions:d.getCompletionItems(a,n,h)}):d instanceof ze?Promise.resolve({suggestions:[{label:"length",filterText:"length",kind:monaco.languages.CompletionItemKind.Field,insertText:"length",range:h,documentation:{value:"Anzahl der Elemente des Arrays"}}]}):null}getKeywordCompletion(e){let t=[];return!this.isConsole&&((e==null?void 0:e.classContext)==null||(e==null?void 0:e.method)!=null)&&(t=t.concat([{label:"while(Bedingung){Anweisungen}",detail:"while-Wiederholung",filterText:"while",insertText:`while($1){
	$0
}`,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"for(){}",insertText:`for( $1 ; $2 ; $3 ){
	$0
}`,detail:"for-Wiederholung",filterText:"for",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"for(int i = 0; i < 10; i++){}",insertText:"for(int ${1:i} = 0; ${1:i} < ${2:10}; ${1:i}++){\n	$0\n}",detail:"Zähl-Wiederholung",filterText:"for",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"switch(){case...}",insertText:`switch($1){
	case $2:
		 $3
		break;
	case $4:
		 $5
		break;
	default:
		 $0
}`,detail:"switch-Anweisung",filterText:"switch",command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"if(){}",insertText:`if($1){
	$0
}`,detail:"Bedingung",filterText:"if",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"if(){} else {}",insertText:`if($1){
	$2
}
else {
	$0
}`,detail:"Zweiseitige Bedingung",filterText:"if",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"else {}",insertText:`else {
	$0
}`,detail:"else-Zweig",filterText:"else",sortText:"aelse",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}])),((e==null?void 0:e.classContext)==null||(e==null?void 0:e.method)!=null)&&(t=t.concat([{label:"instanceof",insertText:"instanceof $0",detail:"instanceof-Operator",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"print",insertText:"print($1);$0",detail:`Ausgabe (ggf. mit Farbe 
als zweitem Parameter)`,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"println",insertText:"println($1);$0",detail:`Ausgabe mit Zeilenumbruch (ggf. mit 
Farbe als zweitem Parameter)`,command:{id:"editor.action.triggerParameterHints",title:"123",arguments:[]},insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}])),this.isConsole||(e==null||e.classContext==null?t=t.concat([{label:"class",filterText:"class",insertText:`class \${1:Bezeichner} {
	$0
}
`,detail:"Klassendefinition",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"public class",filterText:"public class",insertText:`public class \${1:Bezeichner} {
	$0
}
`,detail:"Öffentliche Klassendefinition",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}]):(e==null?void 0:e.classContext)!=null&&(e==null?void 0:e.method)==null&&(t=t.concat([{label:"public",filterText:"public",insertText:"public ",detail:"Schlüsselwort public",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"public void method(){}",filterText:"public",insertText:"public ${1:void} ${2:Bezeichner}(${3:Parameter}) {\n	$0\n}\n",detail:"Methodendefinition",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0,sortText:"aaMethod"},{label:"public "+e.classContext.identifier+"(){}  // Konstruktor",filterText:"public",insertText:"public "+e.classContext.identifier+`(\${1:Parameter}) {
	$0
}
`,detail:"Konstruktor",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0,sortText:"aaConstructor"},{label:"protected",filterText:"protected",insertText:"protected ",detail:"Schlüsselwort protected",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"static",filterText:"static",insertText:"static ",detail:"Schlüsselwort static",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0},{label:"private",filterText:"private",insertText:"private ",detail:"Schlüsselwort private",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}]))),e!=null&&e.method!=null&&(t=t.concat([{label:"return",filterText:"return",insertText:"return",detail:"Schlüsselwort return",insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0}])),t}getOverridableMethodsCompletion(e){let t=[],i=[],n=e.baseClass;for(;n!=null;)i=i.concat(n.methods.filter(s=>!!(s.isAbstract||s.program==null&&s.invoke==null||s.identifier.startsWith("onMouse")||s.identifier.startsWith("onKey")||s.identifier.startsWith("onChange")))),n=n.baseClass;for(let s of e.implements)i=i.concat(s.getMethods());for(let s of i){let a=!1;for(let h of e.methods)if(h.signature==s.signature){a=!0;break}if(a)continue;let l=(s.isAbstract?"implement ":"override ")+s.getCompletionLabel(),o=s.identifier,u=ee[s.visibility]+" "+(s.getReturnType()==null?"void":s.getReturnType().identifier)+" ";u+=s.identifier+"(";for(let h=0;h<s.getParameterList().parameters.length;h++){let d=s.getParameterList().parameters[h];u+=s.getParameterType(h).identifier+" "+d.identifier,h<s.getParameterCount()-1&&(u+=", ")}u+=`) {
	$0
}`,t.push({label:l,detail:(s.isAbstract?"Implementiere ":"Überschreibe ")+"die Methode "+l+" der Basisklasse.",filterText:o,insertText:u,insertTextRules:monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,kind:monaco.languages.CompletionItemKind.Snippet,range:void 0})}return t}}function Bw(){monaco.languages.register({id:"myJava",extensions:[".learnJava"]});let r={indentationRules:{decreaseIndentPattern:/^(.*\*\/)?\s*\}.*$/,increaseIndentPattern:/^.*\{[^}"']*$/},onEnterRules:[{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,afterText:/^\s*\*\/$/,action:{indentAction:monaco.languages.IndentAction.IndentOutdent,appendText:" * "}},{beforeText:/^\s*\/\*\*(?!\/)([^\*]|\*(?!\/))*$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:" * "}},{beforeText:/^(\t|(\ ))*\ \*(\ ([^\*]|\*(?!\/))*)?$/,action:{indentAction:monaco.languages.IndentAction.None,appendText:"* "}},{beforeText:/^(\t|(\ \ ))*\ \*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}},{beforeText:/^(\t|(\ \ ))*\ \*[^/]*\*\/\s*$/,action:{indentAction:monaco.languages.IndentAction.None,removeText:1}}],wordPattern:/(-?\d*\.\d\w*)|([^\`\~\!\#\%\^\&\*\(\)\-\=\+\[\{\]\}\\\|\;\:\'\"\,\.\<\>\/\?\s]+)/g,comments:{lineComment:"//",blockComment:["/*","*/"]},brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"'",close:"'"}],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"<",close:">"}],folding:{markers:{start:new RegExp("^\\s*//\\s*(?:(?:#?region\\b)|(?:<editor-fold\\b))"),end:new RegExp("^\\s*//\\s*(?:(?:#?endregion\\b)|(?:</editor-fold>))")}}},e={defaultToken:"",tokenPostfix:".java",keywords:["abstract","continue","new","switch","assert","default","goto","package","synchronized","private","this","implements","protected","throw","import","public","throws","case","instanceof","return","transient","catch","extends","try","final","static","finally","strictfp","volatile","const","native","super","true","false","null"],print:["print","println"],statements:["for","while","if","then","else","do","break","continue"],types:["int","boolean","char","float","double","long","void","byte","short","class","enum","interface","var"],operators:["=",">","<","!","~","?",":","==","<=",">=","!=","&&","||","++","--","+","-","*","/","&","|","^","%","<<",">>",">>>","+=","-=","*=","/=","&=","|=","^=","%=","<<=",">>=",">>>="],symbols:/[=><!~?:&|+\-*\/\^%]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,digits:/\d+(_+\d+)*/,octaldigits:/[0-7]+(_+[0-7]+)*/,binarydigits:/[0-1]+(_+[0-1]+)*/,hexdigits:/[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,tokenizer:{root:[[/\.[A-Z$ÄÖÜ][\w$äöüßÄÖÜ]*(?=\()/,{cases:{"@default":"method"}}],[/[a-z_$äöü][\w$äöüßÄÖÜ]*(?=\()/,{cases:{"@keywords":{token:"keyword.$0"},"@statements":{token:"statement.$0"},"@types":{token:"type.$0"},"@print":{token:"print.$0"},"@default":"method"}}],[/[a-z_$äöüß][\w$äöüßÄÖÜ]*/,{cases:{"@keywords":{token:"keyword.$0"},"@statements":{token:"statement.$0"},"@types":{token:"type.$0"},"@default":"identifier"}}],[/[A-Z$ÄÖÜ][\w$äöüßÄÖÜ]*/,"class"],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"delimiter","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,"annotation"],[/(@digits)[eE]([\-+]?(@digits))?[fFdD]?/,"number.float"],[/(@digits)\.(@digits)([eE][\-+]?(@digits))?[fFdD]?/,"number.float"],[/0[xX](@hexdigits)[Ll]?/,"number.hex"],[/0(@octaldigits)[Ll]?/,"number.octal"],[/0[bB](@binarydigits)[Ll]?/,"number.binary"],[/(@digits)[fFdD]/,"number.float"],[/(@digits)[lL]?/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"""/,"string","@multilineString"],[/"/,"string","@string"],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],whitespace:[[/[ \t\r\n]+/,""],[/\/\*\*(?!\/)/,"comment.doc","@javadoc"],[/\/\*/,"comment","@comment"],[/\/\/.*$/,"comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]],javadoc:[[/[^\/*]+/,"comment.doc"],[/\/\*/,"comment.doc.invalid"],[/\*\//,"comment.doc","@pop"],[/[\/*]/,"comment.doc"]],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"""/,"string","@pop"],[/"/,"string","@pop"]],multilineString:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"""/,"string","@pop"],[/"/,"string"]]}};monaco.languages.setLanguageConfiguration("myJava",r),monaco.languages.setMonarchTokensProvider("myJava",e)}function Zn(r,e="",t=!1){if(r instanceof $){if(r.isTypeVariable)return zw(r);let i="";if(r.documentation!=null&&r.documentation!=""&&(r.documentation.startsWith("/*")?i+=(e+r.documentation).replace(/\n/g,`
`+e)+`
`:i+=Ol(r.documentation,e)+`
`),r.visibility!=null&&(i+=ee[r.visibility]+" "),r.isAbstract&&(i+="abstract "),i+="class "+r.identifier+" ",r.typeVariables.length>0&&(i+=As(r)),r.baseClass!=null&&r.baseClass.identifier!="Object"&&(i+="extends "+r.baseClass.identifier+" ",r.baseClass.typeVariables.length>0&&(i+=As(r.baseClass))),r.implements!=null&&r.implements.length>0){i+="implements ";for(let n=0;n<r.implements.length;n++)i+=r.implements[n].identifier,r.implements[n].typeVariables.length>0&&(i+=As(r.implements[n])),n<r.implements.length-1&&(i+=", ")}if(t)return i;i+=e+`{
  `;for(let n of r.getAttributes(ee.protected))i+=e+`
`+Zn(n,"  ")+`;
`;if(r.staticClass!=null)for(let n of r.staticClass.getAttributes(ee.protected))i+=e+`
`+Zn(n,"  ")+`;
`;for(let n of r.getMethods(ee.protected))i+=e+`
`+Zn(n,"  ")+`;
`;if(r.staticClass!=null)for(let n of r.staticClass.getMethods(ee.protected))i+=e+`
`+Zn(n,"  ")+`;
`;return i+=`
}`,i}if(r instanceof Pe){let i="";if(r.documentation!=null&&r.documentation!=""&&!t&&(r.documentation.startsWith("/*")?i+=(e+r.documentation).replace(/\n/g,`
`+e)+`
`:i+=Ol(r.documentation,e)+`
`),i+=e+"interface "+r.identifier,r.typeVariables.length>0&&(i+=As(r)),r.extends!=null&&r.extends.length>0){i+="extends ";for(let n=0;n<r.extends.length;n++)i+=r.extends[n].identifier,r.extends[n].typeVariables.length>0&&(i+=As(r.extends[n])),n<r.extends.length-1&&(i+=", ")}if(!t){i+=`{
`;for(let n of r.methods)i+=e+`
`+Zn(n,"  ")+`;
`;i+=`
}`}return i}if(r instanceof ce){let i="";return r.documentation!=null&&r.documentation!=""&&!t&&(r.documentation.startsWith("/*")?i+=e+r.documentation.replace(/\n/g,`
`+e)+`
`:i+=Ol(r.documentation,e)+`
`),i+=e,r.visibility!=null&&(i+=ee[r.visibility]+" "),r.isStatic&&(i+="static "),i+=yn(r.type)+" "+r.identifier,i}if(r instanceof m){let i="";r.documentation!=null&&r.documentation!=""&&!t&&(r.documentation.startsWith("/*")?i+=e+r.documentation.replace(/\n/g,`
`+e)+`
`:i+=Ol(r.documentation,e)+`
`),i+=e,r.visibility!=null&&(i+=ee[r.visibility]+" "),r.isStatic&&(i+="static "),r.getReturnType()!=null?i+=yn(r.getReturnType())+" ":i+=r.isConstructor?"":"void ",i+=r.identifier+"(";let n=r.getParameterList().parameters;for(let s=0;s<n.length;s++){let a=n[s],l=r.getParameterType(s);a.isEllipsis&&(l=l.arrayOfType),i+=yn(l)+(a.isEllipsis?"...":"")+" "+a.identifier,s<n.length-1&&(i+=", ")}return i+=")",i}return""}function zw(r){let e=r.identifier;if(r.isGenericVariantFrom!=Wi&&(e+=" extends "+yn(r.isGenericVariantFrom)),r.implements.length>0){let t=r.implements.filter(i=>r.isGenericVariantFrom.implements.indexOf(i)<0).map(i=>yn(i)).join(", ");t!=""&&(e+=" implements "+t)}return e}function yn(r){var e,t;if((r instanceof $||r instanceof Pe)&&r.typeVariables.length>0){let i=(r.isTypeVariable?r.identifier+" extends "+((e=r.isGenericVariantFrom)==null?void 0:e.identifier):r.identifier)+"<";return i+=r.typeVariables.map(n=>yn(n.type)).join(", "),i+">"}return r.isTypeVariable?r.identifier+" extends "+((t=r.isGenericVariantFrom)==null?void 0:t.identifier):r.identifier}function As(r){let e="";if(r.typeVariables.length>0){e="<";let t=[];for(let i of r.typeVariables){let n=i.type.identifier,s=i.type;if(s.isGenericVariantFrom!=null&&s.isGenericVariantFrom.identifier!="Object"&&(n+=" extends "+s.isGenericVariantFrom.identifier),s.implements!=null){let a=s.implements;s.isGenericVariantFrom!=null&&(a=a.filter(l=>s.isGenericVariantFrom.implements.indexOf(l)<0));for(let l of a)n+=" & "+l.identifier}t.push(n)}e+=t.join(", "),e+="> "}return e}class jw{constructor(e){y(this,"signatureHelpTriggerCharacters",["(",",",";","<",">","="]);y(this,"signatureHelpRetriggerCharacters",[]);this.main=e}provideSignatureHelp(e,t,i,n){var l,o,u;let s=e==((u=(o=(l=this.main.getBottomDiv())==null?void 0:l.console)==null?void 0:o.editor)==null?void 0:u.getModel());if(!s&&e!=this.main.getMonacoEditor().getModel())return;let a=this;return new Promise((h,d)=>{setTimeout(()=>{var p,v;s?(v=(p=this.main.getBottomDiv())==null?void 0:p.console)==null||v.compileIfDirty():this.main.compileIfDirty(),h(a.provideSignatureHelpLater(e,t,i,n))},300)})}provideSignatureHelpLater(e,t,i,n){var h,d;let a=e!=this.main.getMonacoEditor().getModel()?(d=(h=this.main.getBottomDiv())==null?void 0:h.console)==null?void 0:d.compiler.module:this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(a==null)return null;let l=a.methodCallPositions[t.lineNumber];if(l==null)return null;let o=null,u=-1;for(let p=l.length-1;p>=0;p--){let v=l[p];v.identifierPosition.column+v.identifierPosition.length<t.column&&v.identifierPosition.column>u&&(v.rightBracketPosition==null||t.lineNumber<=v.rightBracketPosition.line&&t.column<=v.rightBracketPosition.column||t.lineNumber<v.rightBracketPosition.line)&&(o=v,u=v.identifierPosition.column)}return o==null?null:this.getSignatureHelp(o,t)}getSignatureHelp(e,t){let i=0;for(let s of e.commaPositions)(s.line<t.lineNumber||s.line==t.lineNumber&&s.column<t.column)&&i++;let n=[];if(typeof e.possibleMethods=="string")n=n.concat(this.makeIntrinsicSignatureInformation(e.possibleMethods,i));else for(let s of e.possibleMethods){let a=s;a.getParameterCount()>i&&(n=n.concat(this.makeSignatureInformation(a)))}return Promise.resolve({value:{activeParameter:i,activeSignature:0,signatures:n},dispose:()=>{}})}makeIntrinsicSignatureInformation(e,t){switch(e){case"while":return[{label:"while(Bedingung){ Anweisungen }",documentation:"Wiederholung mit Anfangsbedingung (while-loop)",parameters:[{label:"Bedingung",documentation:"Die Bedingung wird vor jeder Wiederholung ausgewertet. Ist sie erfüllt ist (d.h. hat sie den Wert true), so werden die Anweisungen in {} erneut ausgeführt, ansonsten wird mit der nächsten Anweisung nach { } fortgefahren."}]}];case"if":return[{label:"if(Bedingung){ Anweisungen1 } else { Anweisungen2 }",documentation:"Bedingung (else... ist optional)",parameters:[{label:"Bedingung",documentation:"Ist die Bedingung erfüllt (d.h. hat sie den Wert true), so werden die Anweisungen1 ausgeführt. Trifft die Bedingung nicht zu (d.h. hat sie den Wert false), so werden die Anweisungen2 ausgeführt."}]}];case"switch":return[{label:"switch(Selektor){case Wert_1: Anweisungen1; break; case Wert_2 Anweisungen2; break; default: Defaultanweisungen; break;}",documentation:"Bedingung (else... ist optional)",parameters:[{label:"Selektor",documentation:"Der Wert des Selektor-Terms wird ausgewertet. Hat er den Wert Wert_1, so werden die Anweisungen1 ausgeführt. Hat er den Wert Wert_2, so werden die Anweisungen2 ausgeführt usw. Hat er keinen der bei case... aufgeführten Werte, so werden die Defaultanweisungen ausgeführt."}]}];case"for":return[{label:"for(Startanweisung; Bedingung; Anweisung am Ende jeder Wiederholung){ Anweisungen }",documentation:"Wiederholung mit for (for-loop)",parameters:[{label:"Startanweisung",documentation:"Diese Anweisung wird vor der ersten Wiederholung einmal ausgeführt."},{label:"Bedingung",documentation:"Die Bedingung wird vor jeder Wiederholung ausgewertet. Ist sie erfüllt ist (d.h. hat sie den Wert true), so werden die Anweisungen in {} erneut ausgeführt, ansonsten wird mit der nächsten Anweisung nach { } fortgefahren."},{label:"Anweisung am Ende jeder Wiederholung",documentation:"Diese Anweisung wird stets am Ende jeder Wiederholung ausgeführt."}]}];case"print":return[{label:"print(text: String, color: String)",documentation:"Gibt Text farbig in der Ausgabe aus",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"},{label:"color: String",documentation:"Farbe (englischer Name oder #ffffff oder rgb(255,255,255)) oder statisches Attribut der Klasse Color, z.B. Color.red"}]},{label:"print(text: String, color: int)",documentation:"Gibt Text farbig in der Ausgabe aus",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"},{label:"color: String",documentation:"Farbe als int-Wert kodiert, z.B. 0xff00ff"}]},{label:"print(text: String)",documentation:"Gibt Text in der Ausgabe aus",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"}]}];case"println":return[{label:"println(text: String, color: String)",documentation:"Gibt Text farbig in der Ausgabe aus. Der nächste Text landet eine Zeile tiefer.",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"},{label:"color: String",documentation:"Farbe (englischer Name oder #ffffff oder rgb(255,255,255) oder statisches Attribut der Klasse Color, z.B. Color.red)"}]},{label:"println(text: String, color: int)",documentation:"Gibt Text farbig in der Ausgabe aus. Der nächste Text landet eine Zeile tiefer.",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"},{label:"color: int",documentation:"Farbe als int-kodierter Wert, z.B. 0xffffff"}]},{label:"println(text: String)",documentation:"Gibt Text farbig in der Ausgabe aus. Der nächste Text landet eine Zeile tiefer.",parameters:[{label:"text: String",documentation:"text: Text, der ausgegeben werden soll"}]}]}}makeSignatureInformation(e){let t="";e.getReturnType()!=null&&!e.isConstructor&&(t+=yn(e.getReturnType())+" "),t+=e.identifier+"(";let i=[],n=e.getParameterList().parameters;for(let s=0;s<n.length;s++){let a=n[s],l=t.length,o=a.type;a.isEllipsis&&(o=o.arrayOfType);let u=yn(o)+(a.isEllipsis?"...":"")+" "+a.identifier;t+=u;let h=t.length;s<n.length-1&&(t+=", ");let d={label:[l,h],documentation:""};i.push(d)}return t+=")",[{label:t,parameters:i,documentation:e.documentation==null?"":e.documentation}]}}const hu=class hu{constructor(e){this.editor=e}provideHover(e,t,i){var p,v;let n=this.editor.editor.getSelection();if(n!=null&&(n.startLineNumber!=n.endLineNumber||n.startColumn!=n.endColumn)&&(n.startLineNumber<t.lineNumber||n.startLineNumber==t.lineNumber&&n.startColumn<=t.column)&&(n.endLineNumber>t.lineNumber||n.endLineNumber==t.lineNumber&&n.endColumn>=t.column))return;let s=(p=this.editor.main.getCurrentWorkspace())==null?void 0:p.getModuleByMonacoModel(e);if(s==null)return null;for(let w of s.errors)for(let _ of w)if(_.position.line==t.lineNumber&&_.position.column<=t.column&&_.position.column+_.position.length>=t.column)return null;let a=s.getElementAtPosition(t.lineNumber,t.column),l="";if(a!=null&&a.identifier!="var")if(a instanceof $||a instanceof m||a instanceof Pe||a instanceof ce)l=Zn(a);else{if(a instanceof ut)return l="```\n"+a.identifier+"\n```  \nprimitiver Datentyp: "+a.description,{range:null,contents:[{value:l}]};{let w=(v=a==null?void 0:a.type)==null?void 0:v.identifier;((a==null?void 0:a.type)instanceof $||(a==null?void 0:a.type)instanceof Pe)&&(w+=" "+As(a.type)),w==null?w="":w+=" ",l=w+(a==null?void 0:a.identifier)}}else{let w=this.getWordUnderCursor(e,t),_=hu.keywordDescriptions[w];if(_!=null)return{range:null,contents:[{value:_}]}}let o=this.editor.main.getInterpreter().state,u=null;if(o==Re.paused){let w=this.editor.main.getCurrentWorkspace().evaluator,_=this.widenDeclaration(e,t,a==null?void 0:a.identifier);if(_==null)return null;let T=w.evaluate(_);T.error==null&&T.value!=null&&(u=T.value.type.debugOutput(T.value),l=_)}let h=[];return u==null&&l.length==0?null:(u!=null?u.length+l.length>40?(h.push({value:"```\n"+l+" ==\n```"}),h.push({value:"```\n"+u.replace(/&nbsp;/g," ")+"\n```"})):h.push({value:"```\n"+l+" == "+u.replace(/&nbsp;/g," ")+"\n```"}):h.push({value:"```\n"+l+"\n```"}),{range:null,contents:h})}getWordUnderCursor(e,t){let i=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),n=e.getValue(),s="",a=i;for(;a<n.length&&this.isInsideIdentifierOrArrayDescriptor(n.charAt(a));)a++;let l=i;for(;l>0&&this.isInsideIdentifierOrArrayDescriptor(n.charAt(l-1));)l--;if(a-l>1)s=n.substring(l,a);else{for(a=i;a<n.length&&this.isInsideOperator(n.charAt(a));)a++;for(l=i;l>0&&this.isInsideOperator(n.charAt(l-1));)l--;a-l>0&&(s=n.substring(l,a))}return s}widenDeclaration(e,t,i){let n=e.getValueLengthInRange({startColumn:0,startLineNumber:0,endLineNumber:t.lineNumber,endColumn:t.column}),s=e.getValue(),a=n;for(;a<s.length&&this.isInsideIdentifierOrArrayDescriptor(s.charAt(a));)a++;let l=n;for(;l>0&&this.isInsideIdentifierChain(s.charAt(l-1));)l--;return(i==null?void 0:i.length)==null||i.length,a-l>length?s.substring(l,a):i}isInsideIdentifierChain(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß_\[\]\.]/i)}isInsideOperator(e){return e.toLocaleLowerCase().match(/[!%<>=\+\-\*\/]/i)}isInsideIdentifierOrArrayDescriptor(e){return e.toLocaleLowerCase().match(/[a-z0-9äöüß\[\]]/i)}};y(hu,"keywordDescriptions",{print:"Die Anweisung ```print``` gibt eine Zeichenkette aus.",new:'Das Schlüsselwort ```new``` bewirkt die Instanzierung ("Erschaffung") eines neuen Objektes einer Klasse.',println:"Die Anweisung ```println``` gibt eine Zeichenkette gefolgt von einem Zeilenumbruch aus.",while:"```\nwhile (Bedingung) {Anweisungen}\n```  \nbewirkt die Wiederholung der Anweisungen solange ```Bedingung == true``` ist.",for:"```\nfor(Startanweisung;Solange-Bedingung;Nach_jeder_Wiederholung){Anweisungen}\n```  \nführt zunächst die Startanweisung aus und wiederholt dann die Anweisungen solange ```Bedingung == true``` ist. Am Ende jeder wiederholung wird Nach_jeder_Wiederholung ausgeführt.",if:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.  \nDer ```else```-Teil kann auch weggelassen werden.",else:"```\nif(Bedingung){Anweisungen_1} else {Anweisungen_2}\n```  \nwertet die Bedingung aus und führt Anweisungen_1 nur dann aus, wenn die Bedingung ```true``` ergibt, Anweisungen_2 nur dann, wenn die Bedingung ```false``` ergibt.",switch:"```\nswitch(Selektor){ case Wert_1: Anweisungen_1; break; case Wert_2: Anweisungen_2; break; default: Default-Anweisungen } \n```  \nwertet den Selektor-Term aus und führt abhängig vom Termwert Anweisungen_1, Anweisungen_2, ... aus. Entspricht der Termwert keinem der Werte Wert_1, Wert_2, ..., so werden die Default-Anweisungen ausgeführt.","%":"```\na % b\n```  \n (sprich: 'a modulo b') berechnet den **Rest** der ganzzahligen Division a/b.","|":"```\na | b\n```  \n (sprich: 'a or b') berechnet die **bitweise oder-Verknüpfung** der Werte a und b.","&":"```\na & b\n```  \n (sprich: 'a und b') berechnet die **bitweise und-Verknüpfung** der Werte a und b.","^":"```\na ^ b\n```  \n (sprich: 'a xor b') berechnet die **bitweise exklusiv-oder-Verknüpfung** der Werte a und b.",">>":"```\na >> b\n```  \n (sprich: 'a right shift b') berechnet den Wert, der entsteht, wenn man den Wert von a **bitweise um b Stellen nach rechts verschiebt**. Dieser Wert ist identisch mit dem nach unten abgerundeten Wert von a/(2 hoch b).","<<":"```\na >> b\n```  \n (sprich: 'a left shift b') berechnet den Wert, der entsteht, wenn man den Wert von a **bitweise um b Stellen nach links verschiebt**. Dieser Wert ist identisch mit dem nach unten abgerundeten Wert von a*(2 hoch b).","~":"```\n~a\n```  \n (sprich: 'nicht a') berechnet den Wert, der entsteht, wenn man **alle Bits von a umkehrt**.","==":"```\na == b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` gleich sind.  \nSind a und b **Objekte**, so ergibt ```a == b``` nur dann ```true```, wenn ```a``` und ```b``` auf das **identische** Objekt zeigen.  \n```==``` nennt man **Vergleichsoperator**.","<=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` kleiner oder gleich dem Wert von ```b``` ist.",">=":"```\na <= b\n```  \nergibt genau dann ```true```, wenn der Wert von ```a``` größer oder gleich dem Wert von ```b``` ist.","!=":"```\na != b\n```  \nergibt genau dann ```true```, wenn ```a``` und ```b``` **un**gleich sind.  \nSind ```a``` und ```b``` **Objekte**, so ergibt ```a != b``` dann ```true```, wenn ```a``` und ```b``` **nicht** auf das **identische** Objekt zeigen.  \n```!=``` nennt man **Ungleich-Operator**.","+=":"```\na += b\n(Kurzschreibweise für a = a + b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erhöht** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","-=":"```\na -= b\n(Kurzschreibweise für a = a - b)\n```  \nbewirkt, dass der Wert von ```a``` um den Wert von ```b``` **erniedrigt** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","*=":"```\na *= b\n(Kurzschreibweise für a = a * b)\n```  \nbewirkt, dass der Wert von ```a``` mit dem Wert von ```b``` **multipliziert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","/=":"```\na /= b\n(Kurzschreibweise für a = a / b)\n```  \nbewirkt, dass der Wert von ```a``` durch den Wert von ```b``` **dividiert** wird. Das Ergebnis wird in die Variable ```a``` geschrieben.","++":"```\na++\n(Kurzschreibweise für a = a + 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins erhöht wird.","--":"```\na--\n(Kurzschreibweise für a = a - 1)\n```  \nbewirkt, dass der Wert von ```a``` um eins eniedrigt wird.","=":"```\na = Term\n```  \nberechnet den Wert des Terms und weist ihn der Variablen ```a``` zu.  \n**Vorsicht:**  \nVerwechsle ```=```(**Zuweisungsoperator**) nicht mit ```==```(**Vergleichsoperator**)!","!":"```\n!a\n```  \nergibt genau dann ```true```, wenn ```a``` ```false``` ergibt.  \n```!``` spricht man '**nicht**'.",public:"```\npublic\n```  \nAttribute und Methoden, die als ```public``` deklariert werden, sind überall (auch außerhalb der Klasse) sichtbar.",private:"```\nprivate\n```  \nAttribute und Methoden, die als ```private``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse sichtbar.",protected:"```\nprotected\n```  \nAttribute und Methoden, die als ```protected``` deklariert werden, sind nur innerhalb von Methoden derselben Klasse oder innerhalb von Methoden von Kindklassen sichtbar.",return:"```\nreturn Term\n```  \nbewirkt, dass die Methode verlassen wird und der Wert des Terms an die aufrufende Stelle zurückgegeben wird.",break:"```\nbreak;\n```  \ninnerhalb einer Schleife bewirkt, dass die Schleife sofort verlassen und mit den Anweisungen nach der Schleife fortgefahren wird.  \n```break``` innerhalb einer ```switch```-Anweisung bewirkt, dass der Block der ```switch```-Anweisung verlassen wird.",class:"```\nclass\n```  \nMit dem Schlüsselwort ```class``` werden Klassen definiert.",extends:"```\nextends\n```  \n```class A extends B { ... }``` bedeutet, dass die Klasse A Unterklasse der Klasse B ist.",implements:"```\nimplements\n```  \n```class A implements B { ... }``` bedeutet, dass die Klasse A das Interface B implementiert, d.h., dass sie alle Methoden besitzen muss, die in B definiert sind.",this:"```\nthis\n```  \nInnerhalb einer Methodendefinition bezeichnet das Schlüsselwort ```this``` immer dasjenige Objekt, für das die Methode gerade ausgeführt wird.",var:"```\nvar\n```  \nWird einer Variable beim Deklarieren sofort ein Startwert zugewiesen (z.B. Circle c = new Circle(100, 100, 10)), so kann statt des Datentyps das Schlüsselwort ```var``` verwendet werden (also var c = new Circle(100, 100, 10))."});let ld=hu;class Nw{constructor(e){this.main=e}provideCodeActions(e,t,i,n){return{actions:i.markers.map(a=>{let l=a.relatedInformation;return l==null?null:{title:l.title,diagnostics:[a],kind:"quickfix",edit:{edits:l.editsProvider(e.uri)},isPreferred:!0}}),dispose:()=>{}}}}class Gw{constructor(e){this.main=e}provideReferences(e,t,i,n){let s=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(s==null)return null;let a=s.getElementAtPosition(t.lineNumber,t.column);if(a==null)return;let l=a.usagePositions,o=[];return l.forEach((u,h)=>{if(u!=null)for(let d of u)o.push({uri:h.uri,range:{startColumn:d.column,startLineNumber:d.line,endLineNumber:d.line,endColumn:d.column+d.length}})}),o}}class Ww{constructor(e){this.main=e}provideDocumentColors(e,t){var l,o,u,h,d,p;let i=(u=(o=(l=this.main.getBottomDiv())==null?void 0:l.console)==null?void 0:o.editor)==null?void 0:u.getModel(),n=e==i,s=e==this.main.getMonacoEditor().getModel();if(!(n||s))return;let a=n?(d=(h=this.main.getBottomDiv())==null?void 0:h.console)==null?void 0:d.compiler.module:(p=this.main.getCurrentWorkspace())==null?void 0:p.getModuleByMonacoModel(e);if(a==null)return null;if(this.main.getCompiler()==null){let v=this,w=3;return new Promise(function(_,T){let D=()=>{v.main.getCompiler()!=null?(v.main.compileIfDirty(),_(a.colorInformation)):(w--,w==0?_([]):setTimeout(D,500))};setTimeout(D,500)})}return this.main.compileIfDirty(),a.colorInformation}provideColorPresentations(e,t,i){var n=t.color,s=e.getValueInRange(t.range),a=Math.round(n.red*255),l=Math.round(n.green*255),o=Math.round(n.blue*255),u;let h=this.toHex2Digits(a)+this.toHex2Digits(l)+this.toHex2Digits(o),d=a+", "+l+", "+o;return s.startsWith("#")?u="#"+h:s.startsWith("0x")?u="0x"+h:s.startsWith("rgb")?n.alpha<.999?u="rgba("+d+", "+n.alpha+")":u="rgb("+d+")":(s.startsWith("new")||s.startsWith("Color"))&&(u="new Color("+d+")"),[{label:u}]}toHex2Digits(e){let t=e.toString(16);for(;t.length<2;)t="0"+t;return t}}class wm{constructor(e,t,i){y(this,"editor");y(this,"highlightCurrentMethod",!0);y(this,"cw",null);y(this,"lastPosition");y(this,"dontPushNextCursorMove",0);y(this,"lastPushTime",0);y(this,"lastTime",0);y(this,"elementDecoration",[]);this.main=e,this.showMinimap=t,this.isEmbedded=i}currentlyEditedModuleIsJava(){let e=this.getCurrentlyEditedModule().file.name;return Mi.filenameToFileType(e).file_type==0}initGUI(e){Bw(),monaco.editor.defineTheme("myCustomThemeDark",{base:"vs-dark",inherit:!0,rules:[{token:"method",foreground:"dcdcaa",fontStyle:"italic"},{token:"print",foreground:"dcdcaa",fontStyle:"italic bold"},{token:"class",foreground:"3DC9B0"},{token:"number",foreground:"b5cea8"},{token:"type",foreground:"499cd6"},{token:"identifier",foreground:"9cdcfe"},{token:"statement",foreground:"bb96c0",fontStyle:"bold"},{token:"keyword",foreground:"68bed4",fontStyle:"bold"},{token:"string3",foreground:"ff0000"},{token:"property",foreground:"ffffff",fontStyle:"bold"}],colors:{"editor.background":"#1e1e1e",jo_highlightMethod:"#2b2b7d"}}),monaco.editor.defineTheme("myCustomThemeLight",{base:"vs",inherit:!0,rules:[{token:"method",foreground:"694E16",fontStyle:"italic bold"},{token:"print",foreground:"811f3f",fontStyle:"italic bold"},{token:"class",foreground:"a03030"},{token:"number",foreground:"404040"},{token:"type",foreground:"0000ff",fontStyle:"bold"},{token:"identifier",foreground:"001080"},{token:"statement",foreground:"8000e0",fontStyle:"bold"},{token:"keyword",foreground:"00a000",fontStyle:"bold"},{token:"comment",foreground:"808080",fontStyle:"italic"}],colors:{"editor.background":"#FFFFFF","editor.foreground":"#000000","editor.inactiveSelectionBackground":"#E5EBF1","editorIndentGuide.background":"#D3D3D3","editorIndentGuide.activeBackground":"#939393","editor.selectionHighlightBackground":"#ADD6FF80","editorSuggestWidget.background":"#F3F3F3","activityBarBadge.background":"#007ACC","sideBarTitle.foreground":"#6F6F6F","list.hoverBackground":"#E8E8E8","input.placeholderForeground":"#767676","searchEditor.textInputBorder":"#CECECE","settings.textInputBorder":"#CECECE","settings.numberInputBorder":"#CECECE","statusBarItem.remoteForeground":"#FFF","statusBarItem.remoteBackground":"#16825D",jo_highlightMethod:"#babaec"}}),this.editor=monaco.editor.create(e[0],{language:"myJava","semanticHighlighting.enabled":!0,lightbulb:{enabled:!0},lineDecorationsWidth:0,peekWidgetDefaultFocus:"tree",fixedOverflowWidgets:!0,quickSuggestions:!0,quickSuggestionsDelay:10,fontSize:14,fontFamily:window.javaOnlineFont==null?"Consolas, Roboto Mono":window.javaOnlineFont,fontWeight:"500",roundedSelection:!0,selectOnLineNumbers:!1,automaticLayout:!0,scrollBeyondLastLine:!1,occurrencesHighlight:!1,autoIndent:"advanced",dragAndDrop:!0,formatOnType:!0,formatOnPaste:!0,suggestFontSize:16,suggestLineHeight:22,suggest:{localityBonus:!0,insertMode:"replace"},parameterHints:{enabled:!0,cycle:!0},mouseWheelZoom:this.isEmbedded,tabSize:3,insertSpaces:!0,detectIndentation:!1,minimap:{enabled:this.showMinimap},scrollbar:{vertical:"auto",horizontal:"auto"},theme:"myCustomThemeDark",wrappingIndent:"same"});let t=["Arrow","Page","ControlLeft","ControlRight"];this.editor.onKeyDown(s=>{let a=this.main.getInterpreter().state;if([Re.done,Re.error,Re.not_initialized].indexOf(a)<0){for(let l of t)if(s.code.indexOf(l)>=0)return;if(s.code=="KeyC"&&s.ctrlKey)return;this.main.getActionManager().trigger("interpreter.stop")}});let i=this,n=s=>{s.ctrlKey===!0&&(i.changeEditorFontSize(Math.sign(-s.deltaY),!0),s.preventDefault())};if(!this.isEmbedded){let s=this.main;s.windowStateManager.registerBackButtonListener(a=>{let l=a.state;if(a.state==null)return;let o=s.workspaceList.find(h=>h.id==l.workspace_id);if(o==null)return;let u=o.moduleStore.findModuleById(l.module_id);u!=null&&(o!=s.currentWorkspace&&(i.dontPushNextCursorMove++,s.projectExplorer.setWorkspaceActive(o),i.dontPushNextCursorMove--),u!=s.getCurrentlyEditedModule()&&(i.dontPushNextCursorMove++,s.projectExplorer.setModuleActive(u),i.dontPushNextCursorMove--),i.dontPushNextCursorMove++,i.editor.setPosition(l.position),i.editor.revealPosition(l.position),i.dontPushNextCursorMove--,i.pushHistoryState(!0,l))})}return this.editor.onDidChangeConfiguration(s=>{s.hasChanged(monaco.editor.EditorOption.fontInfo)&&this.isEmbedded&&this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()}),this.editor.onDidChangeCursorPosition(s=>{var o,u,h;let a=(u=(o=this.main.getCurrentlyEditedModule())==null?void 0:o.file)==null?void 0:u.id;if(a==null)return;(this.lastPosition==null||s.source=="api"||a!=this.lastPosition.module_id||Math.abs(this.lastPosition.position.lineNumber-s.position.lineNumber)>20)&&this.dontPushNextCursorMove==0?this.pushHistoryState(!1,this.getPositionForHistory()):a==((h=history.state)==null?void 0:h.module_id)&&this.pushHistoryState(!0,this.getPositionForHistory()),i.onDidChangeCursorPosition(s.position),i.onEvaluateSelectedText(s)}),this.editor.onDidChangeModel(s=>{let a=e.find(".monaco-editor")[0];if(a!=null&&(a.removeEventListener("wheel",n),a.addEventListener("wheel",n,{passive:!1})),this.main.getCurrentWorkspace()==null)return;let l=this.main.getCurrentWorkspace().getModuleByMonacoModel(this.editor.getModel());this.main instanceof ul&&l!=null&&(this.main.projectExplorer.setActiveAfterExternalModelSet(l),(this.lastPosition==null||l.file.id!=this.lastPosition.module_id)&&this.dontPushNextCursorMove==0&&this.pushHistoryState(!1,this.getPositionForHistory()))}),monaco.languages.registerRenameProvider("myJava",this),monaco.languages.registerColorProvider("myJava",new Ww(this.main)),monaco.languages.registerDefinitionProvider("myJava",{provideDefinition:(s,a,l)=>i.provideDefinition(s,a,l)}),monaco.languages.registerHoverProvider("myJava",new ld(this)),monaco.languages.registerCompletionItemProvider("myJava",new Lw(this.main)),monaco.languages.registerCodeActionProvider("myJava",new Nw(this.main)),monaco.languages.registerReferenceProvider("myJava",new Gw(this.main)),monaco.languages.registerSignatureHelpProvider("myJava",new jw(this.main)),this.editor.onMouseDown(s=>{const a=s.target.detail;s.target.type!==monaco.editor.MouseTargetType.GUTTER_GLYPH_MARGIN&&s.target.type!==monaco.editor.MouseTargetType.GUTTER_LINE_NUMBERS||a.isAfterLines||i.onMarginMouseDown(s.target.position.lineNumber)}),setTimeout(()=>{monaco.editor.remeasureFonts()},2e3),this.addActions(),this.editor.onDidType(s=>{i.onDidType(s)}),this.editor}getPositionForHistory(){if(this.main.getCurrentlyEditedModule()!=null)return{position:this.editor.getPosition(),workspace_id:this.main.getCurrentWorkspace().id,module_id:this.main.getCurrentlyEditedModule().file.id}}pushHistoryState(e,t){if(!(this.main.isEmbedded()||t==null)){if(e)history.replaceState(t,"");else{let i=new Date().getTime();i-this.lastPushTime>200?history.pushState(t,""):history.replaceState(t,""),this.lastPushTime=i}this.lastPosition=t}}onDidType(e){const t=(i,n,s,a)=>{const l=new monaco.Range(i.lineNumber,i.column,i.lineNumber,i.column);this.editor.executeEdits("new-bullets",[{range:l,text:n}]),this.editor.setPosition({lineNumber:s,column:a})};if(e===`
`){const i=this.editor.getModel(),n=this.editor.getPosition(),s=i.getLineContent(n.lineNumber-1);if(s.trim().indexOf("/*")===0&&!s.trimRight().endsWith("*/")&&!(n.lineNumber<i.getLineCount()?i.getLineContent(n.lineNumber+1):"").trim().startsWith("*")){let l=s.substr(0,s.length-s.trimLeft().length);s.trim().indexOf("/**")===0?t(n,`
`+l+" */",n.lineNumber,n.column+3+l.length):t(n,` * 
`+l+" */",n.lineNumber,n.column+3+l.length)}}else if(e=='"'&&this.currentlyEditedModuleIsJava()){const i=this.editor.getModel(),n=this.editor.getPosition(),s=this.editor.getSelection(),a=s.startColumn!=s.endColumn||s.startLineNumber!=s.endLineNumber,l=i.getLineContent(n.lineNumber);let o="x";n.column>3&&(o=l.charAt(n.column-3));let u="x";if(n.column-1<l.length&&(u=l.charAt(n.column-1)),!a){if(o!='"'&&u!='"')t(n,'"',n.lineNumber,n.column);else if(u=='"'){let h={...n,column:n.column+1};const d=new monaco.Range(h.lineNumber,h.column-1,h.lineNumber,h.column+2);this.editor.executeEdits("new-bullets",[{range:d,text:""}])}}}}setFontSize(e){let t=new Date().getTime();if(t-this.lastTime<150)return;this.lastTime=t;let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);if(this.main instanceof ul&&this.main.viewModeController.saveFontSize(e),e!=i){this.editor.updateOptions({fontSize:e});let a=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize)/e;this.editor.updateOptions({fontSize:e/a});let l=this.main.getBottomDiv();l!=null&&l.console!=null&&l.console.editor.updateOptions({fontSize:e/a})}let n=this.main.getBottomDiv();n!=null&&n.console!=null&&(n.$bottomDiv.find(".jo_commandline").css({height:e*1.1+4+"px","line-height":e*1.1+4+"px"}),n.console.editor.layout()),I(".jo_editorFontSize").css("font-size",e+"px"),I(".jo_editorFontSize").css("line-height",e+2+"px"),document.documentElement.style.setProperty("--breakpoint-size",e+"px"),document.documentElement.style.setProperty("--breakpoint-radius",e/2+"px"),this.main.getBottomDiv().errorManager.registerLightbulbOnClickFunctions()}changeEditorFontSize(e,t=!0){let i=this.editor.getOptions().get(monaco.editor.EditorOption.fontSize);t&&(i<10?e*=1:i<20?e*=2:e*=4);let n=i+e;n>=6&&n<=80&&this.setFontSize(n)}addActions(){this.editor.addAction({id:"Find bracket",label:"Finde korrespondierende Klammer",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_K],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){return e.getAction("editor.action.jumpToBracket").run(),null}}),this.editor.addAction({id:"Toggle line comment",label:"Zeilenkommentar ein-/ausschalten",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.US_COMMA],precondition:null,keybindingContext:null,contextMenuGroupId:"insert",contextMenuOrder:1.5,run:function(e){return console.log("Hier!"),e.getAction("editor.action.commentLine").run(),null}})}onEvaluateSelectedText(e){let t=this;if(t.cw!=null&&(t.editor.removeContentWidget(t.cw),t.cw=null),t.main.getInterpreter().state==Re.paused){let n=t.editor.getModel().getValueInRange(t.editor.getSelection());if(n!=null&&n.length>0){let a=this.main.getCurrentWorkspace().evaluator.evaluate(n);if(a.error==null&&a.value!=null){let l=a.value.type.debugOutput(a.value);monaco.editor.colorize(n+": ","myJava",{tabSize:3}).then(o=>{o.endsWith("<br/>")&&(o=o.substr(0,o.length-5)),t.cw={getId:function(){return"my.content.widget"},getDomNode:function(){return I('<div class="jo_editorTooltip jo_codeFont">'+o+l+"</div>")[0]},getPosition:function(){return{position:e.position,preference:[monaco.editor.ContentWidgetPositionPreference.ABOVE,monaco.editor.ContentWidgetPositionPreference.BELOW]}}},t.editor.addContentWidget(t.cw)})}}}}onMarginMouseDown(e){if(!this.currentlyEditedModuleIsJava())return;let t=this.getCurrentlyEditedModule();if(t!=null&&(t.toggleBreakpoint(e,!0),this.main.getInterpreter().moduleStore!=null)){let i=this.main.getInterpreter().moduleStore.findModuleByFile(t.file);i!=null&&i.toggleBreakpoint(e,!1)}}onDidChangeCursorPosition(e){e==null&&(e=this.editor.getPosition());let t=this.getCurrentlyEditedModule();if(t==null){this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,[]);return}let i=t.getElementAtPosition(e.lineNumber,e.column),n=[];if(i!=null){let a=i.usagePositions.get(t);if(a!=null)for(let l of a)n.push({range:{startColumn:l.column,startLineNumber:l.line,endColumn:l.column+l.length,endLineNumber:l.line},options:{className:"jo_revealSyntaxElement",isWholeLine:!1,overviewRuler:{color:{id:"editorIndentGuide.background"},darkColor:{id:"editorIndentGuide.activeBackground"},position:monaco.editor.OverviewRulerLane.Left}}})}if(this.highlightCurrentMethod){let s=t.getMethodDeclarationAtPosition(e);s!=null&&n.push({range:{startColumn:0,startLineNumber:s.position.line,endColumn:100,endLineNumber:s.scopeTo.line},options:{className:"jo_highlightMethod",isWholeLine:!0,overviewRuler:{color:{id:"jo_highlightMethod"},darkColor:{id:"jo_highlightMethod"},position:monaco.editor.OverviewRulerLane.Left},minimap:{color:{id:"jo_highlightMethod"},position:monaco.editor.MinimapPosition.Inline},zIndex:-100}})}this.elementDecoration=this.editor.deltaDecorations(this.elementDecoration,n)}getCurrentlyEditedModule(){return this.main.getCurrentlyEditedModule()}dontDetectLastChange(){}resolveRenameLocation(e,t,i){let n=this.getCurrentlyEditedModule();if(n==null)return{range:null,text:"Dieses Symbol kann nicht umbenannt werden.",rejectReason:"Dieses Symbol kann nicht umbenannt werden."};let s=n.getElementAtPosition(t.lineNumber,t.column);if(s==null||s.declaration==null)return{range:null,text:"Dieses Symbol kann nicht umbenannt werden.",rejectReason:"Dieses Symbol kann nicht umbenannt werden."};let a=s.declaration.position;return{range:{startColumn:t.column,startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,endColumn:t.column+a.length},text:s.identifier}}provideRenameEdits(e,t,i,n){let s=this.getCurrentlyEditedModule();if(s==null)return null;let a=s.getElementAtPosition(t.lineNumber,t.column);if(a==null)return;let l=a.usagePositions,o=[];return l.forEach((u,h)=>{if(u!=null){let d=[];for(let p of u)o.push({resource:h.uri,edit:{range:{startColumn:p.column,startLineNumber:p.line,endLineNumber:p.line,endColumn:p.column+p.length},text:i}});d.length>0&&(h.file.dirty=!0,h.file.saved=!1,h.file.identical_to_repository_version=!1)}}),{edits:o}}provideDefinition(e,t,i){let n=this.main.getCurrentWorkspace().getModuleByMonacoModel(e);if(n==null)return null;let s=n.getElementAtPosition(t.lineNumber,t.column);if(s==null)return null;let a=s.declaration;return a==null?s instanceof $||s instanceof $t||s instanceof Pe||s instanceof m||s instanceof ce?Promise.resolve({range:{startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:t.column,endColumn:t.column+s.identifier.length},uri:n.uri}):null:Promise.resolve({range:{startLineNumber:a.position.line,endLineNumber:a.position.line,startColumn:a.position.column,endColumn:a.position.column+a.position.length},uri:a.module.uri})}}class Hw{constructor(e){this.main=e}init(){let e=I("#buttonUserSettings"),t=this;e.on("click",i=>{wr([{caption:"Passwort ändern...",callback:()=>{new xm(t.main).show()}}],e.offset().left,e.offset().top+e.height())})}}class xm{constructor(e){y(this,"dialog");this.main=e,this.dialog=new vc}show(){this.dialog.init(),this.dialog.heading("Passwort ändern"),this.dialog.description("Bitte geben Sie Ihr bisheriges Passwort und darunter zweimal Ihr neues Passwort ein. <br>Das Passwort muss mindestens 8 Zeichen lang sein und sowohl Buchstaben als auch Zahlen oder Sonderzeichen enthalten.");let e=this.dialog.input("password","Altes Passwort"),t=this.dialog.input("password","Neues Passwort"),i=this.dialog.input("password","Neues Passwort wiederholen"),n=this.dialog.description("","red"),s=this.dialog.waitMessage("Bitte warten...");this.dialog.buttons([{caption:"Abbrechen",color:"#a00000",callback:()=>{this.dialog.close()}},{caption:"OK",color:"green",callback:()=>{t.val()!=i.val()?n.text("Die zwei eingegebenen neuen Passwörter stimmen nicht überein."):(s(!0),Nt("changePassword",{oldPassword:e.val(),newPassword:t.val()},()=>{s(!1),alert("Das Passwort wurde erfolgreich geändert."),this.dialog.close()},a=>{s(!1),n.text(a)}))}}])}}class Uw{constructor(e){y(this,"currentSubmenu",{});y(this,"openSubmenusOnMousemove",!1);this.main=e}initGUI(e,t){let i=this,n=this.main.getMonacoEditor(),s={items:[{identifier:"Datei",subMenu:{items:[{identifier:"Workspace importieren",action:()=>{new gm(this.main).show()}},{identifier:"Aktuellen Workspace exportieren",action:()=>{var h;let a=this.main.currentWorkspace;a==null&&alert("Kein Workspace ausgewählt.");let l=a.name.replace(/\//g,"_"),o=(h=this.main.pruefungManagerForStudents)==null?void 0:h.pruefung,u=this.main.user;o!=null&&(l=o.name.replace(/\//g,"_")+" ("+u.familienname+" "+u.rufname+"; "+u.username+")"),bc(a.toExportedWorkspace(),l+".json")}},{identifier:"Speichern und Beenden",action:()=>{I("#buttonLogout").trigger("click")}}]}},{identifier:"Bearbeiten",subMenu:{items:[{identifier:"Rückgängig (Strg + z)",action:()=>{n.trigger(".","undo",{})}},{identifier:"Wiederholen (Strg + y)",action:()=>{n.trigger(".","redo",{})}},{identifier:"-"},{identifier:"Kopieren (Strg + c)",action:()=>{n.getAction("editor.action.clipboardCopyAction").run()}},{identifier:"Ausschneiden (Strg + x)",action:()=>{n.getAction("editor.action.clipboardCutAction").run()}},{identifier:"Nach oben kopieren (Alt + Shift + Pfeil rauf)",action:()=>{n.getAction("editor.action.copyLinesUpAction").run()}},{identifier:"Nach unten kopieren (Alt + Shift + Pfeil runter)",action:()=>{n.getAction("editor.action.copyLinesDownAction").run()}},{identifier:"Nach oben verschieben (Alt + Pfeil rauf)",action:()=>{n.getAction("editor.action.moveLinesUpAction").run()}},{identifier:"Nach unten verschieben (Alt + Pfeil runter)",action:()=>{n.getAction("editor.action.moveLinesDownAction").run()}},{identifier:"-"},{identifier:"Suchen... (Strg + f)",action:()=>{n.getAction("actions.find").run()}},{identifier:"Ersetzen... (Strg + h)",action:()=>{n.getAction("editor.action.startFindReplaceAction").run()}},{identifier:"-"},{identifier:"Aus-/Einkommentieren (Strg + #)",action:()=>{n.getAction("editor.action.commentLine").run()}},{identifier:"Dokument formatieren (Alt + Shift + f)",action:()=>{n.getAction("editor.action.formatDocument").run()}},{identifier:"-"},{identifier:"Finde zugehörige Klammer (Strg + k)",action:()=>{n.getAction("editor.action.jumpToBracket").run()}},{identifier:"-"},{identifier:"Alles zusammenfalten",action:()=>{n.getAction("editor.foldAll").run()}},{identifier:"Alles auffalten",action:()=>{n.getAction("editor.unfoldAll").run()}},{identifier:"-"},{identifier:"Vorschlag auslösen (Strg + Leertaste)",action:()=>{n.focus(),setTimeout(()=>{n.getAction("editor.action.triggerSuggest").run()},200)}},{identifier:"Parameterhilfe (Strg + Shift + Leertaste)",action:()=>{n.getAction("editor.action.triggerParameterHints").run()}},{identifier:"Gehe zur Definition (Strg + Click)",action:()=>{n.focus(),setTimeout(()=>{n.getAction("editor.action.revealDefinition").run()},200)}}]}},{identifier:"Ansicht",subMenu:{items:[{identifier:"Theme",subMenu:{items:[{identifier:"Dark",action:()=>{i.switchTheme("dark")}},{identifier:"Light",action:()=>{i.switchTheme("light")}}]}},{identifier:"-"},{identifier:"Hoher Kontrast im Editor ein/aus",action:()=>{n.getAction("editor.action.toggleHighContrast").run()}},{identifier:"-"},{identifier:"Zoom out (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(-4)}},{identifier:"Zoom normal",action:()=>{this.main.editor.setFontSize(14)}},{identifier:"Zoom in (Strg + Mausrad)",action:()=>{this.main.editor.changeEditorFontSize(4)}},{identifier:"-"},{identifier:"Automatischer Zeilenumbruch ein/aus",action:()=>{let a=this.main.editor.editor.getOption(monaco.editor.EditorOption.wordWrap);a=a=="on"?"off":"on",this.main.editor.editor.updateOptions({wordWrap:a})}}]}},{identifier:"Repository",subMenu:{items:[{identifier:"Eigene Repositories verwalten ...",action:()=>{this.main.repositoryUpdateManager.show(null)}},{identifier:"Workspace mit Repository verbinden (checkout) ...",action:()=>{this.main.repositoryCheckoutManager.show(null)}}]}},{identifier:"Sprites",subMenu:{items:[{identifier:"Spritesheet ergänzen ...",action:()=>{this.main.spriteManager.show()}},{identifier:"-"},{identifier:"Sprite-Bilderübersicht",link:t+"spriteLibrary.html?csrfToken="+Bt}]}},{identifier:"Hilfe",subMenu:{items:[{identifier:"Kurze Video-Tutorials zur Bedienung dieser IDE",link:"https://www.learnj.de/doku.php?id=api:ide_manual:start"},{identifier:"Interaktives Java-Tutorial mit vielen Beispielen",link:"https://www.learnj.de/doku.php"},{identifier:"-"},{identifier:"API-Dokumentation",link:"https://www.learnj.de/doku.php?id=api:documentation:start"},{identifier:"API-Verzeichnis",link:t+"api_documentation.html?csrfToken="+Bt},{identifier:"-"},{identifier:"Tastaturkommandos (Shortcuts)",link:t+"shortcuts.html?csrfToken="+Bt},{identifier:"-"},{identifier:"Java-Online Changelog",link:"https://www.learnj.de/doku.php?id=javaonline:changelog"},{identifier:"Java-Online Roadmap",link:"https://www.learnj.de/doku.php?id=javaonline:roadmap"},{identifier:"-"},{identifier:"Befehlspalette (F1)",action:()=>{setTimeout(()=>{i.main.getMonacoEditor().focus(),n.getAction("editor.action.quickCommand").run()},500)}},{identifier:"-"},{identifier:"Passwort ändern...",action:()=>{new xm(i.main).show()}},{identifier:"-"},{identifier:"Über die Online-IDE...",link:"https://www.learnj.de/doku.php?id=javaonline:ueber"},{identifier:"Impressum...",link:"https://www.learnj.de/doku.php?id=ide:impressum"},{identifier:"Datenschutzerklärung...",link:"https://www.learnj.de/doku.php?id=ide:datenschutzerklaerung"},{identifier:"<div class='jo_menu_version'>Version 1.3.0 vom 23.5.2025, 21:13 Uhr </div>",noHoverAnimation:!0}]}}]};e!=null&&(e.is_admin||e.is_schooladmin||e.is_teacher)&&s.items[0].subMenu.items.push({identifier:"Klassen/Benutzer/Prüfungen ...",link:t+"administration_mc.html?csrfToken="+Bt}),e!=null&&e.is_admin&&s.items[0].subMenu.items.push({identifier:"Serverauslastung ...",link:t+"statistics.html?csrfToken="+Bt},{identifier:"Shutdown server...",action:()=>{confirm("Server wirklich herunterfahren?")&&Nt("shutdown",{},()=>{alert("Server erfolgreich heruntergefahren.")},a=>{alert(a)})}}),I("#mainmenu").empty(),this.initMenu(s,0)}switchTheme(e){this.main.viewModeController.setTheme(e)}initMenu(e,t){e.level=t,t==0?e.$element=I("#mainmenu"):(e.$element=I('<div class="jo_submenu"></div>'),I("body").append(e.$element)),e.$element.data("model",e);for(let n of e.items){if(n.identifier=="-")n.$element=I('<div class="jo_menuitemdivider"></div>');else{let s=n.noHoverAnimation?' class="jo_menuitem_nohover"':"";if(n.$element=I(`<div${s}>${n.identifier}</div>`),n.link!=null){let a=I('<a href="'+n.link+'" target="_blank" class="jo_menulink"></a>');a.on("pointerdown",l=>{l.stopPropagation()}),a.on("pointerup",l=>{l.stopPropagation(),setTimeout(()=>{e.$element.hide()},500)}),a.append(n.$element),n.$element=a}n.subMenu!=null&&this.initMenu(n.subMenu,t+1),this.initMenuitemCallbacks(e,n),t==0&&n.$element.addClass("jo_mainmenuitem")}e.$element.append(n.$element),n.$element.data("model",n)}let i=this;I(document).on("pointerdown",()=>{for(let n=0;n<5;n++)i.currentSubmenu[n]!=null&&(i.currentSubmenu[n].hide(),i.currentSubmenu[n]=null);i.openSubmenusOnMousemove=!1})}initMenuitemCallbacks(e,t){let i=this;t.action!=null&&(t.$element.on("pointerdown",n=>{n.stopPropagation()}),t.$element.on("pointerup",n=>{n.stopPropagation(),t.action(t.identifier);for(let s=0;s<5;s++)i.currentSubmenu[s]!=null&&(i.currentSubmenu[s].hide(),i.currentSubmenu[s]=null);i.openSubmenusOnMousemove=!1})),t.subMenu!=null?(t.$element.on("mousedown",n=>{i.opensubmenu(t),i.openSubmenusOnMousemove=!0,n.stopPropagation()}),t.$element.on("mousemove.mainmenu",()=>{i.openSubmenusOnMousemove?i.opensubmenu(t):i.currentSubmenu[e.level+1]!=null&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)})):t.$element.on("mousemove.mainmenu",()=>{i.currentSubmenu[e.level+1]!=null&&(i.currentSubmenu[e.level+1].hide(),i.currentSubmenu[e.level+1]=null)})}opensubmenu(e){let t=e.subMenu,i,n;t.level==1?(i=e.$element.position().left,n=30):(i=e.$element.offset().left+e.$element.width(),n=e.$element.offset().top),t.$element.css({top:""+n+"px",left:""+i+"px"}),this.currentSubmenu[t.level]!=null&&this.currentSubmenu[t.level].hide(),t.$element.show(),this.currentSubmenu[t.level]=t.$element}}class Vw{constructor(e){y(this,"position",0);y(this,"xMax");y(this,"$grip");y(this,"$bar");y(this,"$display");y(this,"$outer");y(this,"gripWidth",10);y(this,"overallWidth",100);y(this,"interpreter");this.$outer=I('<div class="jo_speedcontrol-outer" title="Geschwindigkeitsregler" draggable="false"></div>'),this.$bar=I('<div class="jo_speedcontrol-bar" draggable="false"></div>'),this.$grip=I('<div class="jo_speedcontrol-grip" draggable="false"></div>'),this.$display=I('<div class="jo_speedcontrol-display" draggable="false">100 Schritte/s</div>'),this.$grip.append(this.$display),this.$outer.append(this.$bar,this.$grip),e.append(this.$outer)}setInterpreter(e){this.interpreter=e}initGUI(){let e,t,i=this;i.overallWidth=Mo(this.$outer.css("width")),i.gripWidth=Mo(i.$grip.css("width")),i.xMax=i.overallWidth-i.gripWidth;let n=window.PointerEvent?"pointer":"mouse";i.$outer.on(n+"down",s=>{let a=s.pageX-i.$outer.offset().left-4;i.setSpeed(a),i.$grip.css("left",a+"px"),i.$grip.trigger(n+"down",[s.clientX])}),this.$grip.on(n+"down",(s,a)=>{a==null&&(a=s.clientX),e=a,t=i.position,I(".joe_controlPanel_top").css("z-index","1000"),i.$display.show(),I(document).on(n+"move.speedcontrol",l=>{let o=l.clientX-e;i.setSpeed(t+o)}),I(document).on(n+"up.speedcontrol",()=>{I(document).off(n+"up.speedcontrol"),I(document).off(n+"move.speedcontrol"),i.$display.hide(),I(".joe_controlPanel_top").css("z-index","0")}),s.stopPropagation()})}getSpeedInStepsPerSecond(){return this.interpreter.stepsPerSecond}setSpeedInStepsPerSecond(e){let t=[1,10,100,1e3,1e4,1e5,this.interpreter.maxStepsPerSecond];e=="max"&&(e=this.interpreter.maxStepsPerSecond),e=Math.min(e,this.interpreter.maxStepsPerSecond),e=Math.max(e,1);for(let i=0;i<t.length-1;i++){let n=t[i],s=t[i+1];if(e>=n&&e<=s){let a=this.xMax/(t.length-1),l=Math.round(a*i+a*(e-n)/(s-n));this.$grip.css("left",l+"px"),this.position=l;break}}this.setInterpreterSpeed(e)}setSpeed(e){e<0&&(e=0),e>this.xMax&&(e=this.xMax),this.position=e,this.$grip.css("left",e+"px");let t=[1,10,100,1e3,1e4,1e5,this.interpreter.maxStepsPerSecond],i=this.xMax/(t.length-1),n=Math.floor(e/i);n==t.length-1&&n--;let s=(e-n*i)/i,a=t[n],l=t[n+1],o=a+(l-a)*s;this.setInterpreterSpeed(o)}setInterpreterSpeed(e){this.interpreter.setStepsPerSecond(e),this.interpreter.hideProgrampointerPosition();let t=""+Math.ceil(e);e>=this.interpreter.maxStepsPerSecond-10&&(t="Maximale Geschwindigkeit"),this.$display.html(t+" Schritte/s")}}class Sm{constructor(e,t){y(this,"speedControl");y(this,"$buttonStart");y(this,"$buttonPause");y(this,"$buttonStop");y(this,"$buttonStepOver");y(this,"$buttonStepInto");y(this,"$buttonStepOut");y(this,"$buttonRestart");y(this,"interpreter");y(this,"buttonActiveMatrix",{start:[!1,!1,!0,!0,!0,!1],pause:[!1,!0,!1,!1,!1,!1],stop:[!1,!0,!0,!1,!1,!0],stepOver:[!1,!1,!0,!0,!0,!1],stepInto:[!1,!1,!0,!0,!0,!1],stepOut:[!1,!1,!0,!1,!1,!1],restart:[!1,!0,!0,!0,!0,!0]});this.$buttonsContainer=e,this.$editorContainer=t,this.speedControl=new Vw(e),this.speedControl.initGUI(),this.$buttonStart=I('<div title="Start" class="img_start-dark jo_button"></div>'),this.$buttonPause=I('<div title="Pause" class="img_pause-dark jo_button"></div>'),this.$buttonStop=I('<div title="Stop" class="img_stop-dark jo_button"></div>'),this.$buttonStepOver=I('<div title="Step over" class="img_step-over-dark jo_button"></div>'),this.$buttonStepInto=I('<div title="Step into" class="img_step-into-dark jo_button"></div>'),this.$buttonStepOut=I('<div title="Step out" class="img_step-out-dark jo_button"></div>'),this.$buttonRestart=I('<div title="Restart" class="img_restart-dark jo_button"></div>'),e.append(this.$buttonStart,this.$buttonPause,this.$buttonStop,this.$buttonStepOver,this.$buttonStepInto,this.$buttonStepOut,this.$buttonRestart)}setInterpreter(e){this.interpreter=e,this.speedControl.setInterpreter(e),this.speedControl.setSpeed(this.interpreter.maxStepsPerSecond)}}class $w{constructor(e,t,i){y(this,"$dialog");y(this,"$dialogMain");y(this,"studentCount",0);this.classes=e,this.workspace=t,this.main=i,this.init()}init(){this.$dialog=I("#dialog"),I("#main").css("visibility","hidden"),this.$dialog.append(I(`<div class="jo_ds_heading">Austeilen eines Workspace an einzelne Schüler/innen</div>
             <div class="jo_ds_settings">
                <div class="jo_ds_settings_caption">Workspace:</div><div class="jo_ds_workspacename">${this.workspace.name}</div>
                <div class="jo_ds_settings_caption">Liste filtern:</div><div class="jo_ds_filterdiv"><input class="dialog-input"></input></div>
             </div>
             <div class="jo_ds_student_list jo_scrollable">
             </div>
             <div class="jo_ds_selected_message"></div>
             <div class="dialog-buttonRow jo_ds_buttonRow">
                <button id="jo_ds_cancel_button">Abbrechen</button>
                <button id="jo_ds_distribute_button">Austeilen</button>
             </div>
            `));let e=I(".jo_ds_student_list"),t=this,i=[];for(let n of this.classes)for(let s of n.students)i.push(s),s.klass=n;i.sort((n,s)=>n.klasse_id!=s.klasse_id?n.klasse_id-s.klasse_id:n.familienname!=s.familienname?n.familienname.localeCompare(s.familienname):n.rufname.localeCompare(s.rufname));for(let n of i){let s=I('<div class="jo_ds_student_line">'),a=I(`<div class="jo_ds_student_class">${n.klass.name}</div>`),l=I(`<div class="jo_ds_student_name">${n.rufname} ${n.familienname}</div>`);s.append(a,l),e.append(s),s.on("mousedown",()=>{s.toggleClass("jo_active"),t.studentCount+=s.hasClass("jo_active")?1:-1,I(".jo_ds_selected_message").text(`${t.studentCount} Schüler/inn/en selektiert`)}),s.data("student",n),s.data("klass",n.klass)}I(".jo_ds_filterdiv>input").on("input",()=>{let n=I(".jo_ds_filterdiv>input").val();if(n==null||n=="")I(".jo_ds_student_line").show();else{let s=n.toLocaleLowerCase();I(".jo_ds_student_line").each((a,l)=>{let o=I(l),u=o.data("klass"),h=o.data("student");(u.name+" "+h.rufname+" "+h.familienname).toLocaleLowerCase().indexOf(s)>=0?o.show():o.hide()})}}),this.$dialogMain=this.$dialog.find(".dialog-main"),this.$dialog.css("visibility","visible"),I("#jo_ds_cancel_button").on("click",()=>{window.history.back()}),I("#jo_ds_distribute_button").on("click",()=>{t.distributeWorkspace()}),this.main.windowStateManager.registerOneTimeBackButtonListener(()=>{t.close()}),I(".jo_ds_filterdiv>input")[0].focus()}distributeWorkspace(){let e=[];I(".jo_ds_student_line").each((t,i)=>{let n=I(i);if(n.hasClass("jo_active")){let s=n.data("student");e.push(s.id)}}),window.history.back(),this.main.networkManager.sendDistributeWorkspace(this.workspace,null,e,t=>{if(t==null){let n=this.main.networkManager.updateFrequencyInSeconds;alert(`Der Workspace ${this.workspace.name} wurde an ${e.length} Schüler/innen ausgeteilt. Er wird in maximal ${n} s bei jedem Schüler ankommen.`)}else alert(t)})}close(){this.$dialog.css("visibility","hidden"),this.$dialog.empty(),I("#main").css("visibility","visible")}}class Xw{constructor(e,t){y(this,"libraries",[{identifier:"gng",description:"Graphics'n Games-Bibliothek zu den Informatikbüchern des Cornelsen-Verlages für das Land Bayern (Bemerkung: Die Klassen Turtle und Text heißen hier GTurtle und GText)"}]);this.workspace=e,this.main=t}open(){let e=new vc;e.init(),e.heading("Einstellungen zum Workspace "+this.workspace.name),e.subHeading("A. Verwendete Bibliotheken:");let t=this.workspace.settings.libraries;for(let i of this.libraries){let n=e.addCheckbox(i.description,t.indexOf(i.identifier)>=0,i.identifier);i.checkboxState=n}e.buttons([{caption:"Abbrechen",color:"#a00000",callback:()=>{e.close()}},{caption:"OK",color:"green",callback:()=>{let i=!1,n=[];for(let s of this.libraries){let a=s.checkboxState();i=i||a!=t.indexOf(s.identifier)>=0,a&&n.push(s.identifier)}i&&(this.workspace.settings.libraries=n,this.workspace.saved=!1,this.workspace.alterAdditionalLibraries(),this.main.networkManager.sendUpdates(null,!0)),e.close()}}])}}class Kw{async fetchStringFromCache(e){if(!this.cacheAvailable())return null;let i=await(await this.getCache()).match(e);return i!=null?await i.text():null}async fetchUint8ArrayFromCache(e){if(!this.cacheAvailable())return null;let i=await(await this.getCache()).match(e);return i!=null?new Uint8Array(await i.arrayBuffer()):null}async store(e,t){if(!this.cacheAvailable())return;(await this.getCache()).put(e,new Response(t))}cacheAvailable(){return"caches"in self}async getCache(){return caches.open("my-cache")}databaseIdToCacheIdentifier(e){return"/onlineIdeTemplateDb"+e}}var Ar=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Ar||{}),wc=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(wc||{}),Eo=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Eo||{}),Le=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(Le||{}),Bi=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(Bi||{}),fe=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(fe||{}),er=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(er||{}),ke=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(ke||{}),Po=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(Po||{}),Xt=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(Xt||{}),gi=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(gi||{}),Ei=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(Ei||{}),hi=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(hi||{}),pn=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(pn||{}),cu=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(cu||{}),zi=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(zi||{}),jt=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(jt||{}),_m=(r=>(r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA",r))(_m||{}),Tt=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(Tt||{}),bn=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(bn||{});const km={createCanvas:(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,e)=>fetch(r,e),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},ge={ADAPTER:km,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var oh=/iPhone/i,hp=/iPod/i,dp=/iPad/i,cp=/\biOS-universal(?:.+)Mac\b/i,uh=/\bAndroid(?:.+)Mobile\b/i,fp=/Android/i,Ss=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ll=/Silk/i,Hn=/Windows Phone/i,pp=/\bWindows(?:.+)ARM\b/i,gp=/BlackBerry/i,mp=/BB10/i,yp=/Opera Mini/i,bp=/\b(CriOS|Chrome)(?:.+)Mobile/i,vp=/Mobile(?:.+)Firefox\b/i,wp=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function qw(r){return function(e){return e.test(r)}}function xp(r){var e={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?e.userAgent=r:r&&r.userAgent&&(e={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var n=qw(t),s={apple:{phone:n(oh)&&!n(Hn),ipod:n(hp),tablet:!n(oh)&&(n(dp)||wp(e))&&!n(Hn),universal:n(cp),device:(n(oh)||n(hp)||n(dp)||n(cp)||wp(e))&&!n(Hn)},amazon:{phone:n(Ss),tablet:!n(Ss)&&n(Ll),device:n(Ss)||n(Ll)},android:{phone:!n(Hn)&&n(Ss)||!n(Hn)&&n(uh),tablet:!n(Hn)&&!n(Ss)&&!n(uh)&&(n(Ll)||n(fp)),device:!n(Hn)&&(n(Ss)||n(Ll)||n(uh)||n(fp))||n(/\bokhttp\b/i)},windows:{phone:n(Hn),tablet:n(pp),device:n(Hn)||n(pp)},other:{blackberry:n(gp),blackberry10:n(mp),opera:n(yp),firefox:n(vp),chrome:n(bp),device:n(gp)||n(mp)||n(yp)||n(vp)||n(bp)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const Yw=xp.default??xp,gn=Yw(globalThis.navigator);ge.RETINA_PREFIX=/@([0-9\.]+)x/;ge.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Tm={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function n(o,u,h){this.fn=o,this.context=u,this.once=h||!1}function s(o,u,h,d,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var v=new n(h,d||o,p),w=t?t+u:u;return o._events[w]?o._events[w].fn?o._events[w]=[o._events[w],v]:o._events[w].push(v):(o._events[w]=v,o._eventsCount++),o}function a(o,u){--o._eventsCount===0?o._events=new i:delete o._events[u]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],h,d;if(this._eventsCount===0)return u;for(d in h=this._events)e.call(h,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},l.prototype.listeners=function(u){var h=t?t+u:u,d=this._events[h];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,v=d.length,w=new Array(v);p<v;p++)w[p]=d[p].fn;return w},l.prototype.listenerCount=function(u){var h=t?t+u:u,d=this._events[h];return d?d.fn?1:d.length:0},l.prototype.emit=function(u,h,d,p,v,w){var _=t?t+u:u;if(!this._events[_])return!1;var T=this._events[_],D=arguments.length,L,O;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),D){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,h),!0;case 3:return T.fn.call(T.context,h,d),!0;case 4:return T.fn.call(T.context,h,d,p),!0;case 5:return T.fn.call(T.context,h,d,p,v),!0;case 6:return T.fn.call(T.context,h,d,p,v,w),!0}for(O=1,L=new Array(D-1);O<D;O++)L[O-1]=arguments[O];T.fn.apply(T.context,L)}else{var z=T.length,V;for(O=0;O<z;O++)switch(T[O].once&&this.removeListener(u,T[O].fn,void 0,!0),D){case 1:T[O].fn.call(T[O].context);break;case 2:T[O].fn.call(T[O].context,h);break;case 3:T[O].fn.call(T[O].context,h,d);break;case 4:T[O].fn.call(T[O].context,h,d,p);break;default:if(!L)for(V=1,L=new Array(D-1);V<D;V++)L[V-1]=arguments[V];T[O].fn.apply(T[O].context,L)}}return!0},l.prototype.on=function(u,h,d){return s(this,u,h,d,!1)},l.prototype.once=function(u,h,d){return s(this,u,h,d,!0)},l.prototype.removeListener=function(u,h,d,p){var v=t?t+u:u;if(!this._events[v])return this;if(!h)return a(this,v),this;var w=this._events[v];if(w.fn)w.fn===h&&(!p||w.once)&&(!d||w.context===d)&&a(this,v);else{for(var _=0,T=[],D=w.length;_<D;_++)(w[_].fn!==h||p&&!w[_].once||d&&w[_].context!==d)&&T.push(w[_]);T.length?this._events[v]=T.length===1?T[0]:T:a(this,v)}return this},l.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&a(this,h)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,r.exports=l})(Tm);var Zw=Tm.exports;const Mr=mc(Zw);var xc={exports:{}};xc.exports=fu;xc.exports.default=fu;function fu(r,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:r.length,s=Cm(r,0,n,t,!0),a=[];if(!s||s.next===s.prev)return a;var l,o,u,h,d,p,v;if(i&&(s=i0(r,e,s,t)),r.length>80*t){l=u=r[0],o=h=r[1];for(var w=t;w<n;w+=t)d=r[w],p=r[w+1],d<l&&(l=d),p<o&&(o=p),d>u&&(u=d),p>h&&(h=p);v=Math.max(u-l,h-o),v=v!==0?32767/v:0}return Qa(s,a,t,l,o,v,0),a}function Cm(r,e,t,i,n){var s,a;if(n===hd(r,e,t,i)>0)for(s=e;s<t;s+=i)a=Sp(s,r[s],r[s+1],a);else for(s=t-i;s>=e;s-=i)a=Sp(s,r[s],r[s+1],a);return a&&pu(a,a.next)&&(tl(a),a=a.next),a}function ls(r,e){if(!r)return r;e||(e=r);var t=r,i;do if(i=!1,!t.steiner&&(pu(t,t.next)||At(t.prev,t,t.next)===0)){if(tl(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Qa(r,e,t,i,n,s,a){if(r){!a&&s&&l0(r,i,n,s);for(var l=r,o,u;r.prev!==r.next;){if(o=r.prev,u=r.next,s?Qw(r,i,n,s):Jw(r)){e.push(o.i/t|0),e.push(r.i/t|0),e.push(u.i/t|0),tl(r),r=u.next,l=u.next;continue}if(r=u,r===l){a?a===1?(r=e0(ls(r),e,t),Qa(r,e,t,i,n,s,2)):a===2&&t0(r,e,t,i,n,s):Qa(ls(r),e,t,i,n,s,1);break}}}}function Jw(r){var e=r.prev,t=r,i=r.next;if(At(e,t,i)>=0)return!1;for(var n=e.x,s=t.x,a=i.x,l=e.y,o=t.y,u=i.y,h=n<s?n<a?n:a:s<a?s:a,d=l<o?l<u?l:u:o<u?o:u,p=n>s?n>a?n:a:s>a?s:a,v=l>o?l>u?l:u:o>u?o:u,w=i.next;w!==e;){if(w.x>=h&&w.x<=p&&w.y>=d&&w.y<=v&&Os(n,l,s,o,a,u,w.x,w.y)&&At(w.prev,w,w.next)>=0)return!1;w=w.next}return!0}function Qw(r,e,t,i){var n=r.prev,s=r,a=r.next;if(At(n,s,a)>=0)return!1;for(var l=n.x,o=s.x,u=a.x,h=n.y,d=s.y,p=a.y,v=l<o?l<u?l:u:o<u?o:u,w=h<d?h<p?h:p:d<p?d:p,_=l>o?l>u?l:u:o>u?o:u,T=h>d?h>p?h:p:d>p?d:p,D=od(v,w,e,t,i),L=od(_,T,e,t,i),O=r.prevZ,z=r.nextZ;O&&O.z>=D&&z&&z.z<=L;){if(O.x>=v&&O.x<=_&&O.y>=w&&O.y<=T&&O!==n&&O!==a&&Os(l,h,o,d,u,p,O.x,O.y)&&At(O.prev,O,O.next)>=0||(O=O.prevZ,z.x>=v&&z.x<=_&&z.y>=w&&z.y<=T&&z!==n&&z!==a&&Os(l,h,o,d,u,p,z.x,z.y)&&At(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;O&&O.z>=D;){if(O.x>=v&&O.x<=_&&O.y>=w&&O.y<=T&&O!==n&&O!==a&&Os(l,h,o,d,u,p,O.x,O.y)&&At(O.prev,O,O.next)>=0)return!1;O=O.prevZ}for(;z&&z.z<=L;){if(z.x>=v&&z.x<=_&&z.y>=w&&z.y<=T&&z!==n&&z!==a&&Os(l,h,o,d,u,p,z.x,z.y)&&At(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function e0(r,e,t){var i=r;do{var n=i.prev,s=i.next.next;!pu(n,s)&&Am(n,i,i.next,s)&&el(n,s)&&el(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),tl(i),tl(i.next),i=r=s),i=i.next}while(i!==r);return ls(i)}function t0(r,e,t,i,n,s){var a=r;do{for(var l=a.next.next;l!==a.prev;){if(a.i!==l.i&&h0(a,l)){var o=Mm(a,l);a=ls(a,a.next),o=ls(o,o.next),Qa(a,e,t,i,n,s,0),Qa(o,e,t,i,n,s,0);return}l=l.next}a=a.next}while(a!==r)}function i0(r,e,t,i){var n=[],s,a,l,o,u;for(s=0,a=e.length;s<a;s++)l=e[s]*i,o=s<a-1?e[s+1]*i:r.length,u=Cm(r,l,o,i,!1),u===u.next&&(u.steiner=!0),n.push(u0(u));for(n.sort(n0),s=0;s<n.length;s++)t=r0(n[s],t);return t}function n0(r,e){return r.x-e.x}function r0(r,e){var t=s0(r,e);if(!t)return e;var i=Mm(t,r);return ls(i,i.next),ls(t,t.next)}function s0(r,e){var t=e,i=r.x,n=r.y,s=-1/0,a;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var l=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(l<=i&&l>s&&(s=l,a=t.x<t.next.x?t:t.next,l===i))return a}t=t.next}while(t!==e);if(!a)return null;var o=a,u=a.x,h=a.y,d=1/0,p;t=a;do i>=t.x&&t.x>=u&&i!==t.x&&Os(n<h?i:s,n,u,h,n<h?s:i,n,t.x,t.y)&&(p=Math.abs(n-t.y)/(i-t.x),el(t,r)&&(p<d||p===d&&(t.x>a.x||t.x===a.x&&a0(a,t)))&&(a=t,d=p)),t=t.next;while(t!==o);return a}function a0(r,e){return At(r.prev,r,e.prev)<0&&At(e.next,r,r.next)<0}function l0(r,e,t,i){var n=r;do n.z===0&&(n.z=od(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,o0(n)}function o0(r){var e,t,i,n,s,a,l,o,u=1;do{for(t=r,r=null,s=null,a=0;t;){for(a++,i=t,l=0,e=0;e<u&&(l++,i=i.nextZ,!!i);e++);for(o=u;l>0||o>0&&i;)l!==0&&(o===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,l--):(n=i,i=i.nextZ,o--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,u*=2}while(a>1);return r}function od(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function u0(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function Os(r,e,t,i,n,s,a,l){return(n-a)*(e-l)>=(r-a)*(s-l)&&(r-a)*(i-l)>=(t-a)*(e-l)&&(t-a)*(s-l)>=(n-a)*(i-l)}function h0(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!d0(r,e)&&(el(r,e)&&el(e,r)&&c0(r,e)&&(At(r.prev,r,e.prev)||At(r,e.prev,e))||pu(r,e)&&At(r.prev,r,r.next)>0&&At(e.prev,e,e.next)>0)}function At(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function pu(r,e){return r.x===e.x&&r.y===e.y}function Am(r,e,t,i){var n=zl(At(r,e,t)),s=zl(At(r,e,i)),a=zl(At(t,i,r)),l=zl(At(t,i,e));return!!(n!==s&&a!==l||n===0&&Bl(r,t,e)||s===0&&Bl(r,i,e)||a===0&&Bl(t,r,i)||l===0&&Bl(t,e,i))}function Bl(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function zl(r){return r>0?1:r<0?-1:0}function d0(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&Am(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function el(r,e){return At(r.prev,r,r.next)<0?At(r,e,r.next)>=0&&At(r,r.prev,e)>=0:At(r,e,r.prev)<0||At(r,r.next,e)<0}function c0(r,e){var t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function Mm(r,e){var t=new ud(r.i,r.x,r.y),i=new ud(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function Sp(r,e,t,i){var n=new ud(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function tl(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ud(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}fu.deviation=function(r,e,t,i){var n=e&&e.length,s=n?e[0]*t:r.length,a=Math.abs(hd(r,0,s,t));if(n)for(var l=0,o=e.length;l<o;l++){var u=e[l]*t,h=l<o-1?e[l+1]*t:r.length;a-=Math.abs(hd(r,u,h,t))}var d=0;for(l=0;l<i.length;l+=3){var p=i[l]*t,v=i[l+1]*t,w=i[l+2]*t;d+=Math.abs((r[p]-r[w])*(r[v+1]-r[p+1])-(r[p]-r[v])*(r[w+1]-r[p+1]))}return a===0&&d===0?0:Math.abs((d-a)/a)};function hd(r,e,t,i){for(var n=0,s=e,a=t-i;s<t;s+=i)n+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return n}fu.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var a=0;a<e;a++)t.vertices.push(r[n][s][a]);n>0&&(i+=r[n-1].length,t.holes.push(i))}return t};var f0=xc.exports;const Em=mc(f0);var Io={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Io.exports;(function(r,e){(function(t){var i=e&&!e.nodeType&&e,n=r&&!r.nodeType&&r,s=typeof Gs=="object"&&Gs;(s.global===s||s.window===s||s.self===s)&&(t=s);var a,l=2147483647,o=36,u=1,h=26,d=38,p=700,v=72,w=128,_="-",T=/^xn--/,D=/[^\x20-\x7E]/,L=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},z=o-u,V=Math.floor,Q=String.fromCharCode,S;function Z(ae){throw new RangeError(O[ae])}function re(ae,Ie){for(var Xe=ae.length,Je=[];Xe--;)Je[Xe]=Ie(ae[Xe]);return Je}function me(ae,Ie){var Xe=ae.split("@"),Je="";Xe.length>1&&(Je=Xe[0]+"@",ae=Xe[1]),ae=ae.replace(L,".");var Ze=ae.split("."),pt=re(Ze,Ie).join(".");return Je+pt}function le(ae){for(var Ie=[],Xe=0,Je=ae.length,Ze,pt;Xe<Je;)Ze=ae.charCodeAt(Xe++),Ze>=55296&&Ze<=56319&&Xe<Je?(pt=ae.charCodeAt(Xe++),(pt&64512)==56320?Ie.push(((Ze&1023)<<10)+(pt&1023)+65536):(Ie.push(Ze),Xe--)):Ie.push(Ze);return Ie}function oe(ae){return re(ae,function(Ie){var Xe="";return Ie>65535&&(Ie-=65536,Xe+=Q(Ie>>>10&1023|55296),Ie=56320|Ie&1023),Xe+=Q(Ie),Xe}).join("")}function X(ae){return ae-48<10?ae-22:ae-65<26?ae-65:ae-97<26?ae-97:o}function K(ae,Ie){return ae+22+75*(ae<26)-((Ie!=0)<<5)}function _e(ae,Ie,Xe){var Je=0;for(ae=Xe?V(ae/p):ae>>1,ae+=V(ae/Ie);ae>z*h>>1;Je+=o)ae=V(ae/z);return V(Je+(z+1)*ae/(ae+d))}function Se(ae){var Ie=[],Xe=ae.length,Je,Ze=0,pt=w,mt=v,vt,zt,Kt,ht,st,dt,yt,di,Me;for(vt=ae.lastIndexOf(_),vt<0&&(vt=0),zt=0;zt<vt;++zt)ae.charCodeAt(zt)>=128&&Z("not-basic"),Ie.push(ae.charCodeAt(zt));for(Kt=vt>0?vt+1:0;Kt<Xe;){for(ht=Ze,st=1,dt=o;Kt>=Xe&&Z("invalid-input"),yt=X(ae.charCodeAt(Kt++)),(yt>=o||yt>V((l-Ze)/st))&&Z("overflow"),Ze+=yt*st,di=dt<=mt?u:dt>=mt+h?h:dt-mt,!(yt<di);dt+=o)Me=o-di,st>V(l/Me)&&Z("overflow"),st*=Me;Je=Ie.length+1,mt=_e(Ze-ht,Je,ht==0),V(Ze/Je)>l-pt&&Z("overflow"),pt+=V(Ze/Je),Ze%=Je,Ie.splice(Ze++,0,pt)}return oe(Ie)}function de(ae){var Ie,Xe,Je,Ze,pt,mt,vt,zt,Kt,ht,st,dt=[],yt,di,Me,ei;for(ae=le(ae),yt=ae.length,Ie=w,Xe=0,pt=v,mt=0;mt<yt;++mt)st=ae[mt],st<128&&dt.push(Q(st));for(Je=Ze=dt.length,Ze&&dt.push(_);Je<yt;){for(vt=l,mt=0;mt<yt;++mt)st=ae[mt],st>=Ie&&st<vt&&(vt=st);for(di=Je+1,vt-Ie>V((l-Xe)/di)&&Z("overflow"),Xe+=(vt-Ie)*di,Ie=vt,mt=0;mt<yt;++mt)if(st=ae[mt],st<Ie&&++Xe>l&&Z("overflow"),st==Ie){for(zt=Xe,Kt=o;ht=Kt<=pt?u:Kt>=pt+h?h:Kt-pt,!(zt<ht);Kt+=o)ei=zt-ht,Me=o-ht,dt.push(Q(K(ht+ei%Me,0))),zt=V(ei/Me);dt.push(Q(K(zt,0))),pt=_e(Xe,di,Je==Ze),Xe=0,++Je}++Xe,++Ie}return dt.join("")}function De(ae){return me(ae,function(Ie){return T.test(Ie)?Se(Ie.slice(4).toLowerCase()):Ie})}function Ve(ae){return me(ae,function(Ie){return D.test(Ie)?"xn--"+de(Ie):Ie})}if(a={version:"1.4.1",ucs2:{decode:le,encode:oe},decode:Se,encode:de,toASCII:Ve,toUnicode:De},i&&n)if(r.exports==i)n.exports=a;else for(S in a)a.hasOwnProperty(S)&&(i[S]=a[S]);else t.punycode=a})(Gs)})(Io,Io.exports);var p0=Io.exports,na=TypeError;const g0={},m0=Object.freeze(Object.defineProperty({__proto__:null,default:g0},Symbol.toStringTag,{value:"Module"})),y0=dw(m0);var Sc=typeof Map=="function"&&Map.prototype,hh=Object.getOwnPropertyDescriptor&&Sc?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Do=Sc&&hh&&typeof hh.get=="function"?hh.get:null,_p=Sc&&Map.prototype.forEach,_c=typeof Set=="function"&&Set.prototype,dh=Object.getOwnPropertyDescriptor&&_c?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Fo=_c&&dh&&typeof dh.get=="function"?dh.get:null,kp=_c&&Set.prototype.forEach,b0=typeof WeakMap=="function"&&WeakMap.prototype,Fa=b0?WeakMap.prototype.has:null,v0=typeof WeakSet=="function"&&WeakSet.prototype,Ra=v0?WeakSet.prototype.has:null,w0=typeof WeakRef=="function"&&WeakRef.prototype,Tp=w0?WeakRef.prototype.deref:null,x0=Boolean.prototype.valueOf,S0=Object.prototype.toString,_0=Function.prototype.toString,k0=String.prototype.match,kc=String.prototype.slice,gr=String.prototype.replace,T0=String.prototype.toUpperCase,Cp=String.prototype.toLowerCase,Pm=RegExp.prototype.test,Ap=Array.prototype.concat,Fn=Array.prototype.join,C0=Array.prototype.slice,Mp=Math.floor,dd=typeof BigInt=="function"?BigInt.prototype.valueOf:null,ch=Object.getOwnPropertySymbols,cd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ks=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Oa=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ks||"symbol")?Symbol.toStringTag:null,Im=Object.prototype.propertyIsEnumerable,Ep=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function Pp(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Pm.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var i=r<0?-Mp(-r):Mp(r);if(i!==r){var n=String(i),s=kc.call(e,n.length+1);return gr.call(n,t,"$&_")+"."+gr.call(gr.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return gr.call(e,t,"$&_")}var fd=y0,Ip=fd.custom,Dp=Rm(Ip)?Ip:null,Dm={__proto__:null,double:'"',single:"'"},A0={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},gu=function r(e,t,i,n){var s=t||{};if($n(s,"quoteStyle")&&!$n(Dm,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if($n(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=$n(s,"customInspect")?s.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if($n(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if($n(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var l=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Lm(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var o=String(e);return l?Pp(e,o):o}if(typeof e=="bigint"){var u=String(e)+"n";return l?Pp(e,u):u}var h=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=h&&h>0&&typeof e=="object")return pd(e)?"[Array]":"[Object]";var d=V0(s,i);if(typeof n>"u")n=[];else if(Om(n,e)>=0)return"[Circular]";function p(X,K,_e){if(K&&(n=C0.call(n),n.push(K)),_e){var Se={depth:s.depth};return $n(s,"quoteStyle")&&(Se.quoteStyle=s.quoteStyle),r(X,Se,i+1,n)}return r(X,s,i+1,n)}if(typeof e=="function"&&!Fp(e)){var v=L0(e),w=jl(e,p);return"[Function"+(v?": "+v:" (anonymous)")+"]"+(w.length>0?" { "+Fn.call(w,", ")+" }":"")}if(Rm(e)){var _=Ks?gr.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):cd.call(e);return typeof e=="object"&&!Ks?ya(_):_}if(W0(e)){for(var T="<"+Cp.call(String(e.nodeName)),D=e.attributes||[],L=0;L<D.length;L++)T+=" "+D[L].name+"="+Fm(M0(D[L].value),"double",s);return T+=">",e.childNodes&&e.childNodes.length&&(T+="..."),T+="</"+Cp.call(String(e.nodeName))+">",T}if(pd(e)){if(e.length===0)return"[]";var O=jl(e,p);return d&&!U0(O)?"["+gd(O,d)+"]":"[ "+Fn.call(O,", ")+" ]"}if(P0(e)){var z=jl(e,p);return!("cause"in Error.prototype)&&"cause"in e&&!Im.call(e,"cause")?"{ ["+String(e)+"] "+Fn.call(Ap.call("[cause]: "+p(e.cause),z),", ")+" }":z.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+Fn.call(z,", ")+" }"}if(typeof e=="object"&&a){if(Dp&&typeof e[Dp]=="function"&&fd)return fd(e,{depth:h-i});if(a!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(B0(e)){var V=[];return _p&&_p.call(e,function(X,K){V.push(p(K,e,!0)+" => "+p(X,e))}),Rp("Map",Do.call(e),V,d)}if(N0(e)){var Q=[];return kp&&kp.call(e,function(X){Q.push(p(X,e))}),Rp("Set",Fo.call(e),Q,d)}if(z0(e))return fh("WeakMap");if(G0(e))return fh("WeakSet");if(j0(e))return fh("WeakRef");if(D0(e))return ya(p(Number(e)));if(R0(e))return ya(p(dd.call(e)));if(F0(e))return ya(x0.call(e));if(I0(e))return ya(p(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(typeof globalThis<"u"&&e===globalThis||typeof Gs<"u"&&e===Gs)return"{ [object globalThis] }";if(!E0(e)&&!Fp(e)){var S=jl(e,p),Z=Ep?Ep(e)===Object.prototype:e instanceof Object||e.constructor===Object,re=e instanceof Object?"":"null prototype",me=!Z&&Oa&&Object(e)===e&&Oa in e?kc.call(Er(e),8,-1):re?"Object":"",le=Z||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",oe=le+(me||re?"["+Fn.call(Ap.call([],me||[],re||[]),": ")+"] ":"");return S.length===0?oe+"{}":d?oe+"{"+gd(S,d)+"}":oe+"{ "+Fn.call(S,", ")+" }"}return String(e)};function Fm(r,e,t){var i=t.quoteStyle||e,n=Dm[i];return n+r+n}function M0(r){return gr.call(String(r),/"/g,"&quot;")}function ds(r){return!Oa||!(typeof r=="object"&&(Oa in r||typeof r[Oa]<"u"))}function pd(r){return Er(r)==="[object Array]"&&ds(r)}function E0(r){return Er(r)==="[object Date]"&&ds(r)}function Fp(r){return Er(r)==="[object RegExp]"&&ds(r)}function P0(r){return Er(r)==="[object Error]"&&ds(r)}function I0(r){return Er(r)==="[object String]"&&ds(r)}function D0(r){return Er(r)==="[object Number]"&&ds(r)}function F0(r){return Er(r)==="[object Boolean]"&&ds(r)}function Rm(r){if(Ks)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!cd)return!1;try{return cd.call(r),!0}catch{}return!1}function R0(r){if(!r||typeof r!="object"||!dd)return!1;try{return dd.call(r),!0}catch{}return!1}var O0=Object.prototype.hasOwnProperty||function(r){return r in this};function $n(r,e){return O0.call(r,e)}function Er(r){return S0.call(r)}function L0(r){if(r.name)return r.name;var e=k0.call(_0.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Om(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,i=r.length;t<i;t++)if(r[t]===e)return t;return-1}function B0(r){if(!Do||!r||typeof r!="object")return!1;try{Do.call(r);try{Fo.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function z0(r){if(!Fa||!r||typeof r!="object")return!1;try{Fa.call(r,Fa);try{Ra.call(r,Ra)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function j0(r){if(!Tp||!r||typeof r!="object")return!1;try{return Tp.call(r),!0}catch{}return!1}function N0(r){if(!Fo||!r||typeof r!="object")return!1;try{Fo.call(r);try{Do.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function G0(r){if(!Ra||!r||typeof r!="object")return!1;try{Ra.call(r,Ra);try{Fa.call(r,Fa)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function W0(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Lm(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return Lm(kc.call(r,0,e.maxStringLength),e)+i}var n=A0[e.quoteStyle||"single"];n.lastIndex=0;var s=gr.call(gr.call(r,n,"\\$1"),/[\x00-\x1f]/g,H0);return Fm(s,"single",e)}function H0(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+T0.call(e.toString(16))}function ya(r){return"Object("+r+")"}function fh(r){return r+" { ? }"}function Rp(r,e,t,i){var n=i?gd(t,i):Fn.call(t,", ");return r+" ("+e+") {"+n+"}"}function U0(r){for(var e=0;e<r.length;e++)if(Om(r[e],`
`)>=0)return!1;return!0}function V0(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=Fn.call(Array(r.indent+1)," ");else return null;return{base:t,prev:Fn.call(Array(e+1),t)}}function gd(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+Fn.call(r,","+t)+`
`+e.prev}function jl(r,e){var t=pd(r),i=[];if(t){i.length=r.length;for(var n=0;n<r.length;n++)i[n]=$n(r,n)?e(r[n],r):""}var s=typeof ch=="function"?ch(r):[],a;if(Ks){a={};for(var l=0;l<s.length;l++)a["$"+s[l]]=s[l]}for(var o in r)$n(r,o)&&(t&&String(Number(o))===o&&o<r.length||Ks&&a["$"+o]instanceof Symbol||(Pm.call(/[^\w$]/,o)?i.push(e(o,r)+": "+e(r[o],r)):i.push(o+": "+e(r[o],r))));if(typeof ch=="function")for(var u=0;u<s.length;u++)Im.call(r,s[u])&&i.push("["+e(s[u])+"]: "+e(r[s[u]],r));return i}var $0=gu,X0=na,mu=function(r,e,t){for(var i=r,n;(n=i.next)!=null;i=n)if(n.key===e)return i.next=n.next,t||(n.next=r.next,r.next=n),n},K0=function(r,e){if(r){var t=mu(r,e);return t&&t.value}},q0=function(r,e,t){var i=mu(r,e);i?i.value=t:r.next={key:e,next:r.next,value:t}},Y0=function(r,e){return r?!!mu(r,e):!1},Z0=function(r,e){if(r)return mu(r,e,!0)},J0=function(){var e,t={assert:function(i){if(!t.has(i))throw new X0("Side channel does not contain "+$0(i))},delete:function(i){var n=e&&e.next,s=Z0(e,i);return s&&n&&n===s&&(e=void 0),!!s},get:function(i){return K0(e,i)},has:function(i){return Y0(e,i)},set:function(i,n){e||(e={next:void 0}),q0(e,i,n)}};return t},Bm=Object,Q0=Error,ex=EvalError,tx=RangeError,ix=ReferenceError,nx=SyntaxError,rx=URIError,sx=Math.abs,ax=Math.floor,lx=Math.max,ox=Math.min,ux=Math.pow,hx=Math.round,dx=Number.isNaN||function(e){return e!==e},cx=dx,fx=function(e){return cx(e)||e===0?e:e<0?-1:1},px=Object.getOwnPropertyDescriptor,uo=px;if(uo)try{uo([],"length")}catch{uo=null}var zm=uo,ho=Object.defineProperty||!1;if(ho)try{ho({},"a",{value:1})}catch{ho=!1}var gx=ho,ph,Op;function mx(){return Op||(Op=1,ph=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var l=Object.getOwnPropertyDescriptor(e,t);if(l.value!==n||l.enumerable!==!0)return!1}return!0}),ph}var gh,Lp;function yx(){if(Lp)return gh;Lp=1;var r=typeof Symbol<"u"&&Symbol,e=mx();return gh=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},gh}var mh,Bp;function jm(){return Bp||(Bp=1,mh=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),mh}var yh,zp;function Nm(){if(zp)return yh;zp=1;var r=Bm;return yh=r.getPrototypeOf||null,yh}var bx="Function.prototype.bind called on incompatible ",vx=Object.prototype.toString,wx=Math.max,xx="[object Function]",jp=function(e,t){for(var i=[],n=0;n<e.length;n+=1)i[n]=e[n];for(var s=0;s<t.length;s+=1)i[s+e.length]=t[s];return i},Sx=function(e,t){for(var i=[],n=t||0,s=0;n<e.length;n+=1,s+=1)i[s]=e[n];return i},_x=function(r,e){for(var t="",i=0;i<r.length;i+=1)t+=r[i],i+1<r.length&&(t+=e);return t},kx=function(e){var t=this;if(typeof t!="function"||vx.apply(t)!==xx)throw new TypeError(bx+t);for(var i=Sx(arguments,1),n,s=function(){if(this instanceof n){var h=t.apply(this,jp(i,arguments));return Object(h)===h?h:this}return t.apply(e,jp(i,arguments))},a=wx(0,t.length-i.length),l=[],o=0;o<a;o++)l[o]="$"+o;if(n=Function("binder","return function ("+_x(l,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var u=function(){};u.prototype=t.prototype,n.prototype=new u,u.prototype=null}return n},Tx=kx,yu=Function.prototype.bind||Tx,bh,Np;function Tc(){return Np||(Np=1,bh=Function.prototype.call),bh}var vh,Gp;function Gm(){return Gp||(Gp=1,vh=Function.prototype.apply),vh}var Cx=typeof Reflect<"u"&&Reflect&&Reflect.apply,Ax=yu,Mx=Gm(),Ex=Tc(),Px=Cx,Ix=Px||Ax.call(Ex,Mx),Dx=yu,Fx=na,Rx=Tc(),Ox=Ix,Wm=function(e){if(e.length<1||typeof e[0]!="function")throw new Fx("a function is required");return Ox(Dx,Rx,e)},wh,Wp;function Lx(){if(Wp)return wh;Wp=1;var r=Wm,e=zm,t;try{t=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var i=!!t&&e&&e(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return wh=i&&typeof i.get=="function"?r([i.get]):typeof s=="function"?function(l){return s(l==null?l:n(l))}:!1,wh}var xh,Hp;function Bx(){if(Hp)return xh;Hp=1;var r=jm(),e=Nm(),t=Lx();return xh=r?function(n){return r(n)}:e?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return e(n)}:t?function(n){return t(n)}:null,xh}var Sh,Up;function zx(){if(Up)return Sh;Up=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=yu;return Sh=t.call(r,e),Sh}var tt,jx=Bm,Nx=Q0,Gx=ex,Wx=tx,Hx=ix,qs=nx,Ws=na,Ux=rx,Vx=sx,$x=ax,Xx=lx,Kx=ox,qx=ux,Yx=hx,Zx=fx,Hm=Function,_h=function(r){try{return Hm('"use strict"; return ('+r+").constructor;")()}catch{}},il=zm,Jx=gx,kh=function(){throw new Ws},Qx=il?function(){try{return arguments.callee,kh}catch{try{return il(arguments,"callee").get}catch{return kh}}}():kh,_s=yx()(),Yt=Bx(),e1=Nm(),t1=jm(),Um=Gm(),fl=Tc(),Ms={},i1=typeof Uint8Array>"u"||!Yt?tt:Yt(Uint8Array),es={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?tt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?tt:ArrayBuffer,"%ArrayIteratorPrototype%":_s&&Yt?Yt([][Symbol.iterator]()):tt,"%AsyncFromSyncIteratorPrototype%":tt,"%AsyncFunction%":Ms,"%AsyncGenerator%":Ms,"%AsyncGeneratorFunction%":Ms,"%AsyncIteratorPrototype%":Ms,"%Atomics%":typeof Atomics>"u"?tt:Atomics,"%BigInt%":typeof BigInt>"u"?tt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?tt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?tt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?tt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Nx,"%eval%":eval,"%EvalError%":Gx,"%Float16Array%":typeof Float16Array>"u"?tt:Float16Array,"%Float32Array%":typeof Float32Array>"u"?tt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?tt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?tt:FinalizationRegistry,"%Function%":Hm,"%GeneratorFunction%":Ms,"%Int8Array%":typeof Int8Array>"u"?tt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?tt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?tt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":_s&&Yt?Yt(Yt([][Symbol.iterator]())):tt,"%JSON%":typeof JSON=="object"?JSON:tt,"%Map%":typeof Map>"u"?tt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!_s||!Yt?tt:Yt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":jx,"%Object.getOwnPropertyDescriptor%":il,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?tt:Promise,"%Proxy%":typeof Proxy>"u"?tt:Proxy,"%RangeError%":Wx,"%ReferenceError%":Hx,"%Reflect%":typeof Reflect>"u"?tt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?tt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!_s||!Yt?tt:Yt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?tt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":_s&&Yt?Yt(""[Symbol.iterator]()):tt,"%Symbol%":_s?Symbol:tt,"%SyntaxError%":qs,"%ThrowTypeError%":Qx,"%TypedArray%":i1,"%TypeError%":Ws,"%Uint8Array%":typeof Uint8Array>"u"?tt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?tt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?tt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?tt:Uint32Array,"%URIError%":Ux,"%WeakMap%":typeof WeakMap>"u"?tt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?tt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?tt:WeakSet,"%Function.prototype.call%":fl,"%Function.prototype.apply%":Um,"%Object.defineProperty%":Jx,"%Object.getPrototypeOf%":e1,"%Math.abs%":Vx,"%Math.floor%":$x,"%Math.max%":Xx,"%Math.min%":Kx,"%Math.pow%":qx,"%Math.round%":Yx,"%Math.sign%":Zx,"%Reflect.getPrototypeOf%":t1};if(Yt)try{null.error}catch(r){var n1=Yt(Yt(r));es["%Error.prototype%"]=n1}var r1=function r(e){var t;if(e==="%AsyncFunction%")t=_h("async function () {}");else if(e==="%GeneratorFunction%")t=_h("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=_h("async function* () {}");else if(e==="%AsyncGenerator%"){var i=r("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var n=r("%AsyncGenerator%");n&&Yt&&(t=Yt(n.prototype))}return es[e]=t,t},Vp={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},pl=yu,Ro=zx(),s1=pl.call(fl,Array.prototype.concat),a1=pl.call(Um,Array.prototype.splice),$p=pl.call(fl,String.prototype.replace),Oo=pl.call(fl,String.prototype.slice),l1=pl.call(fl,RegExp.prototype.exec),o1=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,u1=/\\(\\)?/g,h1=function(e){var t=Oo(e,0,1),i=Oo(e,-1);if(t==="%"&&i!=="%")throw new qs("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&t!=="%")throw new qs("invalid intrinsic syntax, expected opening `%`");var n=[];return $p(e,o1,function(s,a,l,o){n[n.length]=l?$p(o,u1,"$1"):a||s}),n},d1=function(e,t){var i=e,n;if(Ro(Vp,i)&&(n=Vp[i],i="%"+n[0]+"%"),Ro(es,i)){var s=es[i];if(s===Ms&&(s=r1(i)),typeof s>"u"&&!t)throw new Ws("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new qs("intrinsic "+e+" does not exist!")},Cc=function(e,t){if(typeof e!="string"||e.length===0)throw new Ws("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Ws('"allowMissing" argument must be a boolean');if(l1(/^%?[^%]*%?$/,e)===null)throw new qs("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=h1(e),n=i.length>0?i[0]:"",s=d1("%"+n+"%",t),a=s.name,l=s.value,o=!1,u=s.alias;u&&(n=u[0],a1(i,s1([0,1],u)));for(var h=1,d=!0;h<i.length;h+=1){var p=i[h],v=Oo(p,0,1),w=Oo(p,-1);if((v==='"'||v==="'"||v==="`"||w==='"'||w==="'"||w==="`")&&v!==w)throw new qs("property names with quotes must have matching quotes");if((p==="constructor"||!d)&&(o=!0),n+="."+p,a="%"+n+"%",Ro(es,a))l=es[a];else if(l!=null){if(!(p in l)){if(!t)throw new Ws("base intrinsic for "+e+" exists, but the property is not available.");return}if(il&&h+1>=i.length){var _=il(l,p);d=!!_,d&&"get"in _&&!("originalValue"in _.get)?l=_.get:l=l[p]}else d=Ro(l,p),l=l[p];d&&!o&&(es[a]=l)}}return l},Vm=Cc,$m=Wm,c1=$m([Vm("%String.prototype.indexOf%")]),Xm=function(e,t){var i=Vm(e,!!t);return typeof i=="function"&&c1(e,".prototype.")>-1?$m([i]):i},f1=Cc,gl=Xm,p1=gu,g1=na,Xp=f1("%Map%",!0),m1=gl("Map.prototype.get",!0),y1=gl("Map.prototype.set",!0),b1=gl("Map.prototype.has",!0),v1=gl("Map.prototype.delete",!0),w1=gl("Map.prototype.size",!0),Km=!!Xp&&function(){var e,t={assert:function(i){if(!t.has(i))throw new g1("Side channel does not contain "+p1(i))},delete:function(i){if(e){var n=v1(e,i);return w1(e)===0&&(e=void 0),n}return!1},get:function(i){if(e)return m1(e,i)},has:function(i){return e?b1(e,i):!1},set:function(i,n){e||(e=new Xp),y1(e,i,n)}};return t},x1=Cc,bu=Xm,S1=gu,Nl=Km,_1=na,ks=x1("%WeakMap%",!0),k1=bu("WeakMap.prototype.get",!0),T1=bu("WeakMap.prototype.set",!0),C1=bu("WeakMap.prototype.has",!0),A1=bu("WeakMap.prototype.delete",!0),M1=ks?function(){var e,t,i={assert:function(n){if(!i.has(n))throw new _1("Side channel does not contain "+S1(n))},delete:function(n){if(ks&&n&&(typeof n=="object"||typeof n=="function")){if(e)return A1(e,n)}else if(Nl&&t)return t.delete(n);return!1},get:function(n){return ks&&n&&(typeof n=="object"||typeof n=="function")&&e?k1(e,n):t&&t.get(n)},has:function(n){return ks&&n&&(typeof n=="object"||typeof n=="function")&&e?C1(e,n):!!t&&t.has(n)},set:function(n,s){ks&&n&&(typeof n=="object"||typeof n=="function")?(e||(e=new ks),T1(e,n,s)):Nl&&(t||(t=Nl()),t.set(n,s))}};return i}:Nl,E1=na,P1=gu,I1=J0,D1=Km,F1=M1,R1=F1||D1||I1,O1=function(){var e,t={assert:function(i){if(!t.has(i))throw new E1("Side channel does not contain "+P1(i))},delete:function(i){return!!e&&e.delete(i)},get:function(i){return e&&e.get(i)},has:function(i){return!!e&&e.has(i)},set:function(i,n){e||(e=R1()),e.set(i,n)}};return t},L1=String.prototype.replace,B1=/%20/g,Th={RFC1738:"RFC1738",RFC3986:"RFC3986"},Ac={default:Th.RFC3986,formatters:{RFC1738:function(r){return L1.call(r,B1,"+")},RFC3986:function(r){return String(r)}},RFC1738:Th.RFC1738,RFC3986:Th.RFC3986},z1=Ac,Ch=Object.prototype.hasOwnProperty,Ur=Array.isArray,En=function(){for(var r=[],e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r}(),j1=function(e){for(;e.length>1;){var t=e.pop(),i=t.obj[t.prop];if(Ur(i)){for(var n=[],s=0;s<i.length;++s)typeof i[s]<"u"&&n.push(i[s]);t.obj[t.prop]=n}}},qm=function(e,t){for(var i=t&&t.plainObjects?{__proto__:null}:{},n=0;n<e.length;++n)typeof e[n]<"u"&&(i[n]=e[n]);return i},N1=function r(e,t,i){if(!t)return e;if(typeof t!="object"&&typeof t!="function"){if(Ur(e))e.push(t);else if(e&&typeof e=="object")(i&&(i.plainObjects||i.allowPrototypes)||!Ch.call(Object.prototype,t))&&(e[t]=!0);else return[e,t];return e}if(!e||typeof e!="object")return[e].concat(t);var n=e;return Ur(e)&&!Ur(t)&&(n=qm(e,i)),Ur(e)&&Ur(t)?(t.forEach(function(s,a){if(Ch.call(e,a)){var l=e[a];l&&typeof l=="object"&&s&&typeof s=="object"?e[a]=r(l,s,i):e.push(s)}else e[a]=s}),e):Object.keys(t).reduce(function(s,a){var l=t[a];return Ch.call(s,a)?s[a]=r(s[a],l,i):s[a]=l,s},n)},G1=function(e,t){return Object.keys(t).reduce(function(i,n){return i[n]=t[n],i},e)},W1=function(r,e,t){var i=r.replace(/\+/g," ");if(t==="iso-8859-1")return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch{return i}},Ah=1024,H1=function(e,t,i,n,s){if(e.length===0)return e;var a=e;if(typeof e=="symbol"?a=Symbol.prototype.toString.call(e):typeof e!="string"&&(a=String(e)),i==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(v){return"%26%23"+parseInt(v.slice(2),16)+"%3B"});for(var l="",o=0;o<a.length;o+=Ah){for(var u=a.length>=Ah?a.slice(o,o+Ah):a,h=[],d=0;d<u.length;++d){var p=u.charCodeAt(d);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||s===z1.RFC1738&&(p===40||p===41)){h[h.length]=u.charAt(d);continue}if(p<128){h[h.length]=En[p];continue}if(p<2048){h[h.length]=En[192|p>>6]+En[128|p&63];continue}if(p<55296||p>=57344){h[h.length]=En[224|p>>12]+En[128|p>>6&63]+En[128|p&63];continue}d+=1,p=65536+((p&1023)<<10|u.charCodeAt(d)&1023),h[h.length]=En[240|p>>18]+En[128|p>>12&63]+En[128|p>>6&63]+En[128|p&63]}l+=h.join("")}return l},U1=function(e){for(var t=[{obj:{o:e},prop:"o"}],i=[],n=0;n<t.length;++n)for(var s=t[n],a=s.obj[s.prop],l=Object.keys(a),o=0;o<l.length;++o){var u=l[o],h=a[u];typeof h=="object"&&h!==null&&i.indexOf(h)===-1&&(t.push({obj:a,prop:u}),i.push(h))}return j1(t),e},V1=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},$1=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},X1=function(e,t){return[].concat(e,t)},K1=function(e,t){if(Ur(e)){for(var i=[],n=0;n<e.length;n+=1)i.push(t(e[n]));return i}return t(e)},Ym={arrayToObject:qm,assign:G1,combine:X1,compact:U1,decode:W1,encode:H1,isBuffer:$1,isRegExp:V1,maybeMap:K1,merge:N1},Zm=O1,co=Ym,La=Ac,q1=Object.prototype.hasOwnProperty,Jm={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},Dn=Array.isArray,Y1=Array.prototype.push,Qm=function(r,e){Y1.apply(r,Dn(e)?e:[e])},Z1=Date.prototype.toISOString,Kp=La.default,Ut={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:co.encode,encodeValuesOnly:!1,filter:void 0,format:Kp,formatter:La.formatters[Kp],indices:!1,serializeDate:function(e){return Z1.call(e)},skipNulls:!1,strictNullHandling:!1},J1=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},Mh={},Q1=function r(e,t,i,n,s,a,l,o,u,h,d,p,v,w,_,T,D,L){for(var O=e,z=L,V=0,Q=!1;(z=z.get(Mh))!==void 0&&!Q;){var S=z.get(e);if(V+=1,typeof S<"u"){if(S===V)throw new RangeError("Cyclic object value");Q=!0}typeof z.get(Mh)>"u"&&(V=0)}if(typeof h=="function"?O=h(t,O):O instanceof Date?O=v(O):i==="comma"&&Dn(O)&&(O=co.maybeMap(O,function(ae){return ae instanceof Date?v(ae):ae})),O===null){if(a)return u&&!T?u(t,Ut.encoder,D,"key",w):t;O=""}if(J1(O)||co.isBuffer(O)){if(u){var Z=T?t:u(t,Ut.encoder,D,"key",w);return[_(Z)+"="+_(u(O,Ut.encoder,D,"value",w))]}return[_(t)+"="+_(String(O))]}var re=[];if(typeof O>"u")return re;var me;if(i==="comma"&&Dn(O))T&&u&&(O=co.maybeMap(O,u)),me=[{value:O.length>0?O.join(",")||null:void 0}];else if(Dn(h))me=h;else{var le=Object.keys(O);me=d?le.sort(d):le}var oe=o?String(t).replace(/\./g,"%2E"):String(t),X=n&&Dn(O)&&O.length===1?oe+"[]":oe;if(s&&Dn(O)&&O.length===0)return X+"[]";for(var K=0;K<me.length;++K){var _e=me[K],Se=typeof _e=="object"&&_e&&typeof _e.value<"u"?_e.value:O[_e];if(!(l&&Se===null)){var de=p&&o?String(_e).replace(/\./g,"%2E"):String(_e),De=Dn(O)?typeof i=="function"?i(X,de):X:X+(p?"."+de:"["+de+"]");L.set(e,V);var Ve=Zm();Ve.set(Mh,L),Qm(re,r(Se,De,i,n,s,a,l,o,i==="comma"&&T&&Dn(O)?null:u,h,d,p,v,w,_,T,D,Ve))}}return re},eS=function(e){if(!e)return Ut;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var t=e.charset||Ut.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=La.default;if(typeof e.format<"u"){if(!q1.call(La.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var n=La.formatters[i],s=Ut.filter;(typeof e.filter=="function"||Dn(e.filter))&&(s=e.filter);var a;if(e.arrayFormat in Jm?a=e.arrayFormat:"indices"in e?a=e.indices?"indices":"repeat":a=Ut.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:Ut.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:Ut.addQueryPrefix,allowDots:l,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Ut.allowEmptyArrays,arrayFormat:a,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Ut.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?Ut.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:Ut.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:Ut.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:Ut.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:Ut.encodeValuesOnly,filter:s,format:i,formatter:n,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:Ut.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:Ut.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Ut.strictNullHandling}},tS=function(r,e){var t=r,i=eS(e),n,s;typeof i.filter=="function"?(s=i.filter,t=s("",t)):Dn(i.filter)&&(s=i.filter,n=s);var a=[];if(typeof t!="object"||t===null)return"";var l=Jm[i.arrayFormat],o=l==="comma"&&i.commaRoundTrip;n||(n=Object.keys(t)),i.sort&&n.sort(i.sort);for(var u=Zm(),h=0;h<n.length;++h){var d=n[h],p=t[d];i.skipNulls&&p===null||Qm(a,Q1(p,d,l,o,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,u))}var v=a.join(i.delimiter),w=i.addQueryPrefix===!0?"?":"";return i.charsetSentinel&&(i.charset==="iso-8859-1"?w+="utf8=%26%2310003%3B&":w+="utf8=%E2%9C%93&"),v.length>0?w+v:""},os=Ym,md=Object.prototype.hasOwnProperty,qp=Array.isArray,Dt={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:os.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},iS=function(r){return r.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},ey=function(r,e,t){if(r&&typeof r=="string"&&e.comma&&r.indexOf(",")>-1)return r.split(",");if(e.throwOnLimitExceeded&&t>=e.arrayLimit)throw new RangeError("Array limit exceeded. Only "+e.arrayLimit+" element"+(e.arrayLimit===1?"":"s")+" allowed in an array.");return r},nS="utf8=%26%2310003%3B",rS="utf8=%E2%9C%93",sS=function(e,t){var i={__proto__:null},n=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=t.parameterLimit===1/0?void 0:t.parameterLimit,a=n.split(t.delimiter,t.throwOnLimitExceeded?s+1:s);if(t.throwOnLimitExceeded&&a.length>s)throw new RangeError("Parameter limit exceeded. Only "+s+" parameter"+(s===1?"":"s")+" allowed.");var l=-1,o,u=t.charset;if(t.charsetSentinel)for(o=0;o<a.length;++o)a[o].indexOf("utf8=")===0&&(a[o]===rS?u="utf-8":a[o]===nS&&(u="iso-8859-1"),l=o,o=a.length);for(o=0;o<a.length;++o)if(o!==l){var h=a[o],d=h.indexOf("]="),p=d===-1?h.indexOf("="):d+1,v,w;p===-1?(v=t.decoder(h,Dt.decoder,u,"key"),w=t.strictNullHandling?null:""):(v=t.decoder(h.slice(0,p),Dt.decoder,u,"key"),w=os.maybeMap(ey(h.slice(p+1),t,qp(i[v])?i[v].length:0),function(T){return t.decoder(T,Dt.decoder,u,"value")})),w&&t.interpretNumericEntities&&u==="iso-8859-1"&&(w=iS(String(w))),h.indexOf("[]=")>-1&&(w=qp(w)?[w]:w);var _=md.call(i,v);_&&t.duplicates==="combine"?i[v]=os.combine(i[v],w):(!_||t.duplicates==="last")&&(i[v]=w)}return i},aS=function(r,e,t,i){var n=0;if(r.length>0&&r[r.length-1]==="[]"){var s=r.slice(0,-1).join("");n=Array.isArray(e)&&e[s]?e[s].length:0}for(var a=i?e:ey(e,t,n),l=r.length-1;l>=0;--l){var o,u=r[l];if(u==="[]"&&t.parseArrays)o=t.allowEmptyArrays&&(a===""||t.strictNullHandling&&a===null)?[]:os.combine([],a);else{o=t.plainObjects?{__proto__:null}:{};var h=u.charAt(0)==="["&&u.charAt(u.length-1)==="]"?u.slice(1,-1):u,d=t.decodeDotInKeys?h.replace(/%2E/g,"."):h,p=parseInt(d,10);!t.parseArrays&&d===""?o={0:a}:!isNaN(p)&&u!==d&&String(p)===d&&p>=0&&t.parseArrays&&p<=t.arrayLimit?(o=[],o[p]=a):d!=="__proto__"&&(o[d]=a)}a=o}return a},lS=function(e,t,i,n){if(e){var s=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/,l=/(\[[^[\]]*])/g,o=i.depth>0&&a.exec(s),u=o?s.slice(0,o.index):s,h=[];if(u){if(!i.plainObjects&&md.call(Object.prototype,u)&&!i.allowPrototypes)return;h.push(u)}for(var d=0;i.depth>0&&(o=l.exec(s))!==null&&d<i.depth;){if(d+=1,!i.plainObjects&&md.call(Object.prototype,o[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(o[1])}if(o){if(i.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+i.depth+" and strictDepth is true");h.push("["+s.slice(o.index)+"]")}return aS(h,t,i,n)}},oS=function(e){if(!e)return Dt;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof e.throwOnLimitExceeded<"u"&&typeof e.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var t=typeof e.charset>"u"?Dt.charset:e.charset,i=typeof e.duplicates>"u"?Dt.duplicates:e.duplicates;if(i!=="combine"&&i!=="first"&&i!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:Dt.allowDots:!!e.allowDots;return{allowDots:n,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:Dt.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:Dt.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:Dt.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:Dt.arrayLimit,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:Dt.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:Dt.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:Dt.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:Dt.decoder,delimiter:typeof e.delimiter=="string"||os.isRegExp(e.delimiter)?e.delimiter:Dt.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:Dt.depth,duplicates:i,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:Dt.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:Dt.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:Dt.plainObjects,strictDepth:typeof e.strictDepth=="boolean"?!!e.strictDepth:Dt.strictDepth,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:Dt.strictNullHandling,throwOnLimitExceeded:typeof e.throwOnLimitExceeded=="boolean"?e.throwOnLimitExceeded:!1}},uS=function(r,e){var t=oS(e);if(r===""||r===null||typeof r>"u")return t.plainObjects?{__proto__:null}:{};for(var i=typeof r=="string"?sS(r,t):r,n=t.plainObjects?{__proto__:null}:{},s=Object.keys(i),a=0;a<s.length;++a){var l=s[a],o=lS(l,i[l],t,typeof r=="string");n=os.merge(n,o,t)}return t.allowSparse===!0?n:os.compact(n)},hS=tS,dS=uS,cS=Ac,fS={formats:cS,parse:dS,stringify:hS},pS=p0;function vn(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var gS=/^([a-z0-9.+-]+:)/i,mS=/:[0-9]*$/,yS=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,bS=["<",">",'"',"`"," ","\r",`
`,"	"],vS=["{","}","|","\\","^","`"].concat(bS),yd=["'"].concat(vS),Yp=["%","/","?",";","#"].concat(yd),Zp=["/","?","#"],wS=255,Jp=/^[+a-z0-9A-Z_-]{0,63}$/,xS=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,SS={javascript:!0,"javascript:":!0},bd={javascript:!0,"javascript:":!0},Hs={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},vd=fS;function vu(r,e,t){if(r&&typeof r=="object"&&r instanceof vn)return r;var i=new vn;return i.parse(r,e,t),i}vn.prototype.parse=function(r,e,t){if(typeof r!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof r);var i=r.indexOf("?"),n=i!==-1&&i<r.indexOf("#")?"?":"#",s=r.split(n),a=/\\/g;s[0]=s[0].replace(a,"/"),r=s.join(n);var l=r;if(l=l.trim(),!t&&r.split("#").length===1){var o=yS.exec(l);if(o)return this.path=l,this.href=l,this.pathname=o[1],o[2]?(this.search=o[2],e?this.query=vd.parse(this.search.substr(1)):this.query=this.search.substr(1)):e&&(this.search="",this.query={}),this}var u=gS.exec(l);if(u){u=u[0];var h=u.toLowerCase();this.protocol=h,l=l.substr(u.length)}if(t||u||l.match(/^\/\/[^@/]+@[^@/]+/)){var d=l.substr(0,2)==="//";d&&!(u&&bd[u])&&(l=l.substr(2),this.slashes=!0)}if(!bd[u]&&(d||u&&!Hs[u])){for(var p=-1,v=0;v<Zp.length;v++){var w=l.indexOf(Zp[v]);w!==-1&&(p===-1||w<p)&&(p=w)}var _,T;p===-1?T=l.lastIndexOf("@"):T=l.lastIndexOf("@",p),T!==-1&&(_=l.slice(0,T),l=l.slice(T+1),this.auth=decodeURIComponent(_)),p=-1;for(var v=0;v<Yp.length;v++){var w=l.indexOf(Yp[v]);w!==-1&&(p===-1||w<p)&&(p=w)}p===-1&&(p=l.length),this.host=l.slice(0,p),l=l.slice(p),this.parseHost(),this.hostname=this.hostname||"";var D=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!D)for(var L=this.hostname.split(/\./),v=0,O=L.length;v<O;v++){var z=L[v];if(z&&!z.match(Jp)){for(var V="",Q=0,S=z.length;Q<S;Q++)z.charCodeAt(Q)>127?V+="x":V+=z[Q];if(!V.match(Jp)){var Z=L.slice(0,v),re=L.slice(v+1),me=z.match(xS);me&&(Z.push(me[1]),re.unshift(me[2])),re.length&&(l="/"+re.join(".")+l),this.hostname=Z.join(".");break}}}this.hostname.length>wS?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=pS.toASCII(this.hostname));var le=this.port?":"+this.port:"",oe=this.hostname||"";this.host=oe+le,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),l[0]!=="/"&&(l="/"+l))}if(!SS[h])for(var v=0,O=yd.length;v<O;v++){var X=yd[v];if(l.indexOf(X)!==-1){var K=encodeURIComponent(X);K===X&&(K=escape(X)),l=l.split(X).join(K)}}var _e=l.indexOf("#");_e!==-1&&(this.hash=l.substr(_e),l=l.slice(0,_e));var Se=l.indexOf("?");if(Se!==-1?(this.search=l.substr(Se),this.query=l.substr(Se+1),e&&(this.query=vd.parse(this.query)),l=l.slice(0,Se)):e&&(this.search="",this.query={}),l&&(this.pathname=l),Hs[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var le=this.pathname||"",de=this.search||"";this.path=le+de}return this.href=this.format(),this};function _S(r){return typeof r=="string"&&(r=vu(r)),r instanceof vn?r.format():vn.prototype.format.call(r)}vn.prototype.format=function(){var r=this.auth||"";r&&(r=encodeURIComponent(r),r=r.replace(/%3A/i,":"),r+="@");var e=this.protocol||"",t=this.pathname||"",i=this.hash||"",n=!1,s="";this.host?n=r+this.host:this.hostname&&(n=r+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=vd.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||Hs[e])&&n!==!1?(n="//"+(n||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):n||(n=""),i&&i.charAt(0)!=="#"&&(i="#"+i),a&&a.charAt(0)!=="?"&&(a="?"+a),t=t.replace(/[?#]/g,function(l){return encodeURIComponent(l)}),a=a.replace("#","%23"),e+n+t+a+i};function kS(r,e){return vu(r,!1,!0).resolve(e)}vn.prototype.resolve=function(r){return this.resolveObject(vu(r,!1,!0)).format()};vn.prototype.resolveObject=function(r){if(typeof r=="string"){var e=new vn;e.parse(r,!1,!0),r=e}for(var t=new vn,i=Object.keys(this),n=0;n<i.length;n++){var s=i[n];t[s]=this[s]}if(t.hash=r.hash,r.href==="")return t.href=t.format(),t;if(r.slashes&&!r.protocol){for(var a=Object.keys(r),l=0;l<a.length;l++){var o=a[l];o!=="protocol"&&(t[o]=r[o])}return Hs[t.protocol]&&t.hostname&&!t.pathname&&(t.pathname="/",t.path=t.pathname),t.href=t.format(),t}if(r.protocol&&r.protocol!==t.protocol){if(!Hs[r.protocol]){for(var u=Object.keys(r),h=0;h<u.length;h++){var d=u[h];t[d]=r[d]}return t.href=t.format(),t}if(t.protocol=r.protocol,!r.host&&!bd[r.protocol]){for(var O=(r.pathname||"").split("/");O.length&&!(r.host=O.shift()););r.host||(r.host=""),r.hostname||(r.hostname=""),O[0]!==""&&O.unshift(""),O.length<2&&O.unshift(""),t.pathname=O.join("/")}else t.pathname=r.pathname;if(t.search=r.search,t.query=r.query,t.host=r.host||"",t.auth=r.auth,t.hostname=r.hostname||r.host,t.port=r.port,t.pathname||t.search){var p=t.pathname||"",v=t.search||"";t.path=p+v}return t.slashes=t.slashes||r.slashes,t.href=t.format(),t}var w=t.pathname&&t.pathname.charAt(0)==="/",_=r.host||r.pathname&&r.pathname.charAt(0)==="/",T=_||w||t.host&&r.pathname,D=T,L=t.pathname&&t.pathname.split("/")||[],O=r.pathname&&r.pathname.split("/")||[],z=t.protocol&&!Hs[t.protocol];if(z&&(t.hostname="",t.port=null,t.host&&(L[0]===""?L[0]=t.host:L.unshift(t.host)),t.host="",r.protocol&&(r.hostname=null,r.port=null,r.host&&(O[0]===""?O[0]=r.host:O.unshift(r.host)),r.host=null),T=T&&(O[0]===""||L[0]==="")),_)t.host=r.host||r.host===""?r.host:t.host,t.hostname=r.hostname||r.hostname===""?r.hostname:t.hostname,t.search=r.search,t.query=r.query,L=O;else if(O.length)L||(L=[]),L.pop(),L=L.concat(O),t.search=r.search,t.query=r.query;else if(r.search!=null){if(z){t.host=L.shift(),t.hostname=t.host;var V=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;V&&(t.auth=V.shift(),t.hostname=V.shift(),t.host=t.hostname)}return t.search=r.search,t.query=r.query,(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t}if(!L.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var Q=L.slice(-1)[0],S=(t.host||r.host||L.length>1)&&(Q==="."||Q==="..")||Q==="",Z=0,re=L.length;re>=0;re--)Q=L[re],Q==="."?L.splice(re,1):Q===".."?(L.splice(re,1),Z++):Z&&(L.splice(re,1),Z--);if(!T&&!D)for(;Z--;Z)L.unshift("..");T&&L[0]!==""&&(!L[0]||L[0].charAt(0)!=="/")&&L.unshift(""),S&&L.join("/").substr(-1)!=="/"&&L.push("");var me=L[0]===""||L[0]&&L[0].charAt(0)==="/";if(z){t.hostname=me?"":L.length?L.shift():"",t.host=t.hostname;var V=t.host&&t.host.indexOf("@")>0?t.host.split("@"):!1;V&&(t.auth=V.shift(),t.hostname=V.shift(),t.host=t.hostname)}return T=T||t.host&&L.length,T&&!me&&L.unshift(""),L.length>0?t.pathname=L.join("/"):(t.pathname=null,t.path=null),(t.pathname!==null||t.search!==null)&&(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=r.auth||t.auth,t.slashes=t.slashes||r.slashes,t.href=t.format(),t};vn.prototype.parseHost=function(){var r=this.host,e=mS.exec(r);e&&(e=e[0],e!==":"&&(this.port=e.substr(1)),r=r.substr(0,r.length-e.length)),r&&(this.hostname=r)};var TS=vu,CS=kS,AS=_S;const ty={parse:TS,format:AS,resolve:CS};function ln(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function ba(r){return r.split("?")[0].split("#")[0]}function MS(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ES(r,e,t){return r.replace(new RegExp(MS(e),"g"),t)}function PS(r,e){let t="",i=0,n=-1,s=0,a=-1;for(let l=0;l<=r.length;++l){if(l<r.length)a=r.charCodeAt(l);else{if(a===47)break;a=47}if(a===47){if(!(n===l-1||s===1))if(n!==l-1&&s===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const o=t.lastIndexOf("/");if(o!==t.length-1){o===-1?(t="",i=0):(t=t.slice(0,o),i=t.length-1-t.lastIndexOf("/")),n=l,s=0;continue}}else if(t.length===2||t.length===1){t="",i=0,n=l,s=0;continue}}e&&(t.length>0?t+="/..":t="..",i=2)}else t.length>0?t+=`/${r.slice(n+1,l)}`:t=r.slice(n+1,l),i=l-n-1;n=l,s=0}else a===46&&s!==-1?++s:s=-1}return t}const ai={toPosix(r){return ES(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},hasProtocol(r){return/^[^/:]+:\//.test(this.toPosix(r))},getProtocol(r){ln(r),r=this.toPosix(r);let e="";const t=/^file:\/\/\//.exec(r),i=/^[^/:]+:\/\//.exec(r),n=/^[^/:]+:\//.exec(r);if(t||i||n){const s=(t==null?void 0:t[0])||(i==null?void 0:i[0])||(n==null?void 0:n[0]);e=s,r=r.slice(s.length)}return e},toAbsolute(r,e,t){if(this.isDataUrl(r))return r;const i=ba(this.toPosix(e??ge.ADAPTER.getBaseUrl())),n=ba(this.toPosix(t??this.rootname(i)));return ln(r),r=this.toPosix(r),r.startsWith("/")?ai.join(n,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(r=this.toPosix(r),ln(r),r.length===0)return".";let e="";const t=r.startsWith("/");this.hasProtocol(r)&&(e=this.rootname(r),r=r.slice(e.length));const i=r.endsWith("/");return r=PS(r,!1),r.length>0&&i&&(r+="/"),t?`/${r}`:e+r},isAbsolute(r){return ln(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){const i=r[t];if(ln(i),i.length>0)if(e===void 0)e=i;else{const n=r[t-1]??"";this.extname(n)?e+=`/../${i}`:e+=`/${i}`}}return e===void 0?".":this.normalize(e)},dirname(r){if(ln(r),r.length===0)return".";r=this.toPosix(r);let e=r.charCodeAt(0);const t=e===47;let i=-1,n=!0;const s=this.getProtocol(r),a=r;r=r.slice(s.length);for(let l=r.length-1;l>=1;--l)if(e=r.charCodeAt(l),e===47){if(!n){i=l;break}}else n=!1;return i===-1?t?"/":this.isUrl(a)?s+r:s:t&&i===1?"//":s+r.slice(0,i)},rootname(r){ln(r),r=this.toPosix(r);let e="";if(r.startsWith("/")?e="/":e=this.getProtocol(r),this.isUrl(r)){const t=r.indexOf("/",e.length);t!==-1?e=r.slice(0,t):e=r,e.endsWith("/")||(e+="/")}return e},basename(r,e){ln(r),e&&ln(e),r=ba(this.toPosix(r));let t=0,i=-1,n=!0,s;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e.length===r.length&&e===r)return"";let a=e.length-1,l=-1;for(s=r.length-1;s>=0;--s){const o=r.charCodeAt(s);if(o===47){if(!n){t=s+1;break}}else l===-1&&(n=!1,l=s+1),a>=0&&(o===e.charCodeAt(a)?--a===-1&&(i=s):(a=-1,i=l))}return t===i?i=l:i===-1&&(i=r.length),r.slice(t,i)}for(s=r.length-1;s>=0;--s)if(r.charCodeAt(s)===47){if(!n){t=s+1;break}}else i===-1&&(n=!1,i=s+1);return i===-1?"":r.slice(t,i)},extname(r){ln(r),r=ba(this.toPosix(r));let e=-1,t=0,i=-1,n=!0,s=0;for(let a=r.length-1;a>=0;--a){const l=r.charCodeAt(a);if(l===47){if(!n){t=a+1;break}continue}i===-1&&(n=!1,i=a+1),l===46?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||i===-1||s===0||s===1&&e===i-1&&e===t+1?"":r.slice(e,i)},parse(r){ln(r);const e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;r=ba(this.toPosix(r));let t=r.charCodeAt(0);const i=this.isAbsolute(r);let n;e.root=this.rootname(r),i||this.hasProtocol(r)?n=1:n=0;let s=-1,a=0,l=-1,o=!0,u=r.length-1,h=0;for(;u>=n;--u){if(t=r.charCodeAt(u),t===47){if(!o){a=u+1;break}continue}l===-1&&(o=!1,l=u+1),t===46?s===-1?s=u:h!==1&&(h=1):s!==-1&&(h=-1)}return s===-1||l===-1||h===0||h===1&&s===l-1&&s===a+1?l!==-1&&(a===0&&i?e.base=e.name=r.slice(1,l):e.base=e.name=r.slice(a,l)):(a===0&&i?(e.name=r.slice(1,s),e.base=r.slice(1,l)):(e.name=r.slice(a,s),e.base=r.slice(a,l)),e.ext=r.slice(s,l)),e.dir=this.dirname(r),e},sep:"/",delimiter:":"},Qp={};function $e(r,e,t=3){if(Qp[e])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`),console.warn(i))),Qp[e]=!0}function IS(){$e("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function DS(){$e("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let Eh;function iy(){return typeof Eh>"u"&&(Eh=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:ge.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ge.ADAPTER.getWebGLRenderingContext())return!1;const i=ge.ADAPTER.createCanvas();let n=i.getContext("webgl",e)||i.getContext("experimental-webgl",e);const s=!!((t=n==null?void 0:n.getContextAttributes())!=null&&t.stencil);if(n){const a=n.getExtension("WEBGL_lose_context");a&&a.loseContext()}return n=null,s}catch{return!1}}()),Eh}var FS={grad:.9,turn:360,rad:360/(2*Math.PI)},Un=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Zt=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},en=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},ny=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},eg=function(r){return{r:en(r.r,0,255),g:en(r.g,0,255),b:en(r.b,0,255),a:en(r.a)}},Ph=function(r){return{r:Zt(r.r),g:Zt(r.g),b:Zt(r.b),a:Zt(r.a,3)}},RS=/^#([0-9a-f]{3,8})$/i,Gl=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},ry=function(r){var e=r.r,t=r.g,i=r.b,n=r.a,s=Math.max(e,t,i),a=s-Math.min(e,t,i),l=a?s===e?(t-i)/a:s===t?2+(i-e)/a:4+(e-t)/a:0;return{h:60*(l<0?l+6:l),s:s?a/s*100:0,v:s/255*100,a:n}},sy=function(r){var e=r.h,t=r.s,i=r.v,n=r.a;e=e/360*6,t/=100,i/=100;var s=Math.floor(e),a=i*(1-t),l=i*(1-(e-s)*t),o=i*(1-(1-e+s)*t),u=s%6;return{r:255*[i,l,a,a,o,i][u],g:255*[o,i,i,l,a,a][u],b:255*[a,a,o,i,i,l][u],a:n}},tg=function(r){return{h:ny(r.h),s:en(r.s,0,100),l:en(r.l,0,100),a:en(r.a)}},ig=function(r){return{h:Zt(r.h),s:Zt(r.s),l:Zt(r.l),a:Zt(r.a,3)}},ng=function(r){return sy((t=(e=r).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},Ba=function(r){return{h:(e=ry(r)).h,s:(n=(200-(t=e.s))*(i=e.v)/100)>0&&n<200?t*i/100/(n<=100?n:200-n)*100:0,l:n/2,a:e.a};var e,t,i,n},OS=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,LS=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,BS=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zS=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wd={string:[[function(r){var e=RS.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Zt(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Zt(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=BS.exec(r)||zS.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:eg({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=OS.exec(r)||LS.exec(r);if(!e)return null;var t,i,n=tg({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(FS[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return ng(n)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,i=r.b,n=r.a,s=n===void 0?1:n;return Un(e)&&Un(t)&&Un(i)?eg({r:Number(e),g:Number(t),b:Number(i),a:Number(s)}):null},"rgb"],[function(r){var e=r.h,t=r.s,i=r.l,n=r.a,s=n===void 0?1:n;if(!Un(e)||!Un(t)||!Un(i))return null;var a=tg({h:Number(e),s:Number(t),l:Number(i),a:Number(s)});return ng(a)},"hsl"],[function(r){var e=r.h,t=r.s,i=r.v,n=r.a,s=n===void 0?1:n;if(!Un(e)||!Un(t)||!Un(i))return null;var a=function(l){return{h:ny(l.h),s:en(l.s,0,100),v:en(l.v,0,100),a:en(l.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(s)});return sy(a)},"hsv"]]},rg=function(r,e){for(var t=0;t<e.length;t++){var i=e[t][0](r);if(i)return[i,e[t][1]]}return[null,void 0]},jS=function(r){return typeof r=="string"?rg(r.trim(),wd.string):typeof r=="object"&&r!==null?rg(r,wd.object):[null,void 0]},Ih=function(r,e){var t=Ba(r);return{h:t.h,s:en(t.s+100*e,0,100),l:t.l,a:t.a}},Dh=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},sg=function(r,e){var t=Ba(r);return{h:t.h,s:t.s,l:en(t.l+100*e,0,100),a:t.a}},xd=function(){function r(e){this.parsed=jS(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Zt(Dh(this.rgba),2)},r.prototype.isDark=function(){return Dh(this.rgba)<.5},r.prototype.isLight=function(){return Dh(this.rgba)>=.5},r.prototype.toHex=function(){return e=Ph(this.rgba),t=e.r,i=e.g,n=e.b,a=(s=e.a)<1?Gl(Zt(255*s)):"","#"+Gl(t)+Gl(i)+Gl(n)+a;var e,t,i,n,s,a},r.prototype.toRgb=function(){return Ph(this.rgba)},r.prototype.toRgbString=function(){return e=Ph(this.rgba),t=e.r,i=e.g,n=e.b,(s=e.a)<1?"rgba("+t+", "+i+", "+n+", "+s+")":"rgb("+t+", "+i+", "+n+")";var e,t,i,n,s},r.prototype.toHsl=function(){return ig(Ba(this.rgba))},r.prototype.toHslString=function(){return e=ig(Ba(this.rgba)),t=e.h,i=e.s,n=e.l,(s=e.a)<1?"hsla("+t+", "+i+"%, "+n+"%, "+s+")":"hsl("+t+", "+i+"%, "+n+"%)";var e,t,i,n,s},r.prototype.toHsv=function(){return e=ry(this.rgba),{h:Zt(e.h),s:Zt(e.s),v:Zt(e.v),a:Zt(e.a,3)};var e},r.prototype.invert=function(){return Pn({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),Pn(Ih(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),Pn(Ih(this.rgba,-e))},r.prototype.grayscale=function(){return Pn(Ih(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),Pn(sg(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),Pn(sg(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?Pn({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Zt(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=Ba(this.rgba);return typeof e=="number"?Pn({h:e,s:t.s,l:t.l,a:t.a}):Zt(t.h)},r.prototype.isEqual=function(e){return this.toHex()===Pn(e).toHex()},r}(),Pn=function(r){return r instanceof xd?r:new xd(r)},ag=[],NS=function(r){r.forEach(function(e){ag.indexOf(e)<0&&(e(xd,wd),ag.push(e))})};function GS(r,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var n in t)i[t[n]]=n;var s={};r.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var l,o,u=i[this.toHex()];if(u)return u;if(a!=null&&a.closest){var h=this.toRgb(),d=1/0,p="black";if(!s.length)for(var v in t)s[v]=new r(t[v]).toRgb();for(var w in t){var _=(l=h,o=s[w],Math.pow(l.r-o.r,2)+Math.pow(l.g-o.g,2)+Math.pow(l.b-o.b,2));_<d&&(d=_,p=w)}return p}},e.string.push([function(a){var l=a.toLowerCase(),o=l==="transparent"?"#0000":t[l];return o?new r(o).toRgb():null},"name"])}NS([GS]);const Us=class{constructor(r=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=r}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(r){return this.value=r,this}set value(r){if(r instanceof Us)this._value=r._value,this._int=r._int,this._components.set(r._components);else{if(r===null)throw new Error("Cannot set PIXI.Color#value to null");this._value!==r&&(this.normalize(r),this._value=r)}}get value(){return this._value}toRgba(){const[r,e,t,i]=this._components;return{r,g:e,b:t,a:i}}toRgb(){const[r,e,t]=this._components;return{r,g:e,b:t}}toRgbaString(){const[r,e,t]=this.toUint8RgbArray();return`rgba(${r},${e},${t},${this.alpha})`}toUint8RgbArray(r){const[e,t,i]=this._components;return r=r??[],r[0]=Math.round(e*255),r[1]=Math.round(t*255),r[2]=Math.round(i*255),r}toRgbArray(r){r=r??[];const[e,t,i]=this._components;return r[0]=e,r[1]=t,r[2]=i,r}toNumber(){return this._int}toLittleEndianNumber(){const r=this._int;return(r>>16)+(r&65280)+((r&255)<<16)}multiply(r){const[e,t,i,n]=Us.temp.setValue(r)._components;return this._components[0]*=e,this._components[1]*=t,this._components[2]*=i,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(r,e=!0){return e&&(this._components[0]*=r,this._components[1]*=r,this._components[2]*=r),this._components[3]=r,this.refreshInt(),this._value=null,this}toPremultiplied(r){if(r===1)return(r*255<<24)+this._int;if(r===0)return 0;let e=this._int>>16&255,t=this._int>>8&255,i=this._int&255;return e=e*r+.5|0,t=t*r+.5|0,i=i*r+.5|0,(r*255<<24)+(e<<16)+(t<<8)+i}toHex(){const r=this._int.toString(16);return`#${"000000".substring(0,6-r.length)+r}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(r){return this._components[3]=r,this}round(r){const[e,t,i]=this._components;return this._components.set([Math.min(255,e/r*r),Math.min(255,t/r*r),Math.min(255,i/r*r)]),this.refreshInt(),this._value=null,this}toArray(r){r=r??[];const[e,t,i,n]=this._components;return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}normalize(r){let e;if((typeof r=="number"||r instanceof Number)&&r>=0&&r<=16777215){const t=r;e=[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255,1]}else if((Array.isArray(r)||r instanceof Float32Array)&&r.length>=3&&r.length<=4&&r.every(t=>t<=1&&t>=0)){const[t,i,n,s=1]=r;e=[t,i,n,s]}else if((r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&r.length>=3&&r.length<=4){const[t,i,n,s=255]=r;e=[t/255,i/255,n/255,s/255]}else if(typeof r=="string"||typeof r=="object"){if(typeof r=="string"){const i=Us.HEX_PATTERN.exec(r);i&&(r=`#${i[2]}`)}const t=Pn(r);if(t.isValid()){const{r:i,g:n,b:s,a}=t.rgba;e=[i/255,n/255,s/255,a]}}if(e)this._components.set(e),this.refreshInt();else throw new Error(`Unable to convert color ${r}`)}refreshInt(){const[r,e,t]=this._components;this._int=(r*255<<16)+(e*255<<8)+(t*255|0)}};let lt=Us;lt.shared=new Us;lt.temp=new Us;lt.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function WS(r,e=[]){return $e("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),lt.shared.setValue(r).toRgbArray(e)}function ay(r){return $e("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),lt.shared.setValue(r).toHex()}function HS(r){return $e("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),lt.shared.setValue(r).toNumber()}function ly(r){return $e("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),lt.shared.setValue(r).toNumber()}function US(){const r=[],e=[];for(let i=0;i<32;i++)r[i]=i,e[i]=i;r[Le.NORMAL_NPM]=Le.NORMAL,r[Le.ADD_NPM]=Le.ADD,r[Le.SCREEN_NPM]=Le.SCREEN,e[Le.NORMAL]=Le.NORMAL_NPM,e[Le.ADD]=Le.ADD_NPM,e[Le.SCREEN]=Le.SCREEN_NPM;const t=[];return t.push(e),t.push(r),t}const Mc=US();function Ec(r,e){return Mc[e?1:0][r]}function VS(r,e,t,i=!0){return $e("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),lt.shared.setValue(r).premultiply(e,i).toArray(t??new Float32Array(4))}function oy(r,e){return $e("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),lt.shared.setValue(r).toPremultiplied(e)}function $S(r,e,t,i=!0){return $e("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),lt.shared.setValue(r).premultiply(e,i).toArray(t??new Float32Array(4))}const uy=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function hy(r,e=null){const t=r*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let i=0,n=0;i<t;i+=6,n+=4)e[i+0]=n+0,e[i+1]=n+1,e[i+2]=n+2,e[i+3]=n+0,e[i+4]=n+2,e[i+5]=n+3;return e}function wu(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}const XS={Float32Array,Uint32Array,Int32Array,Uint8Array};function KS(r,e){let t=0,i=0;const n={};for(let o=0;o<r.length;o++)i+=e[o],t+=r[o].length;const s=new ArrayBuffer(t*4);let a=null,l=0;for(let o=0;o<r.length;o++){const u=e[o],h=r[o],d=wu(h);n[d]||(n[d]=new XS[d](s)),a=n[d];for(let p=0;p<h.length;p++){const v=(p/u|0)*i+l,w=p%u;a[v+w]=h[p]}l+=u}return new Float32Array(s)}function nl(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Sd(r){return!(r&r-1)&&!!r}function _d(r){let e=(r>65535?1:0)<<4;r>>>=e;let t=(r>255?1:0)<<3;return r>>>=t,e|=t,t=(r>15?1:0)<<2,r>>>=t,e|=t,t=(r>3?1:0)<<1,r>>>=t,e|=t,e|r>>1}function ts(r,e,t){const i=r.length;let n;if(e>=i||t===0)return;t=e+t>i?i-e:t;const s=i-t;for(n=e;n<s;++n)r[n]=r[n+t];r.length=s}function Qn(r){return r===0?0:r<0?-1:1}let qS=0;function Sr(){return++qS}const dy=class{constructor(r,e,t,i){this.left=r,this.top=e,this.right=t,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Lo=dy;Lo.EMPTY=new dy(0,0,0,0);const kd={},pi=Object.create(null),Fi=Object.create(null);function YS(){let r;for(r in pi)pi[r].destroy();for(r in Fi)Fi[r].destroy()}function ZS(){let r;for(r in pi)delete pi[r];for(r in Fi)delete Fi[r]}class Td{constructor(e,t,i){this._canvas=ge.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||ge.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function lg(r,e,t){for(let i=0,n=4*t*e;i<e;++i,n+=4)if(r[n+3]!==0)return!1;return!0}function og(r,e,t,i,n){const s=4*e;for(let a=i,l=i*s+4*t;a<=n;++a,l+=s)if(r[l+3]!==0)return!1;return!0}function cy(r){const{width:e,height:t}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,e,t).data;let a=0,l=0,o=e-1,u=t-1;for(;l<t&&lg(s,e,l);)++l;if(l===t)return Lo.EMPTY;for(;lg(s,e,u);)--u;for(;og(s,e,a,l,u);)++a;for(;og(s,e,o,l,u);)--o;return++o,++u,new Lo(a,l,o,u)}function fy(r){const e=cy(r),{width:t,height:i}=e;let n=null;if(!e.isEmpty()){const s=r.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(e.left,e.top,t,i)}return{width:t,height:i,data:n}}function JS(r){const e=uy.exec(r);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}let Wl;function py(r,e=globalThis.location){if(r.startsWith("data:"))return"";e=e||globalThis.location,Wl||(Wl=document.createElement("a")),Wl.href=r;const t=ty.parse(Wl.href),i=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!i||t.protocol!==e.protocol?"anonymous":""}function nr(r,e=1){var i;const t=(i=ge.RETINA_PREFIX)==null?void 0:i.exec(r);return t?parseFloat(t[1]):e}const QS=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:Fi,BoundingBox:Lo,CanvasRenderTarget:Td,DATA_URI:uy,EventEmitter:Mr,ProgramCache:kd,TextureCache:pi,clearTextureCache:ZS,correctBlendMode:Ec,createIndicesForQuads:hy,decomposeDataUri:JS,deprecation:$e,destroyTextureCache:YS,determineCrossOrigin:py,earcut:Em,getBufferType:wu,getCanvasBoundingBox:cy,getResolutionOfUrl:nr,hex2rgb:WS,hex2string:ay,interleaveTypedArrays:KS,isMobile:gn,isPow2:Sd,isWebGLSupported:iy,log2:_d,nextPow2:nl,path:ai,premultiplyBlendMode:Mc,premultiplyRgba:VS,premultiplyTint:oy,premultiplyTintToRgba:$S,removeItems:ts,rgb2hex:ly,sayHello:DS,sign:Qn,skipHello:IS,string2hex:HS,trimCanvas:fy,uid:Sr,url:ty},Symbol.toStringTag,{value:"Module"}));var be=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(be||{});const Cd=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},ug=(r,e)=>Cd(r).priority??e,Ae={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Cd).forEach(e=>{e.type.forEach(t=>{var i,n;return(n=(i=this._removeHandlers)[t])==null?void 0:n.call(i,e)})}),this},add(...r){return r.map(Cd).forEach(e=>{e.type.forEach(t=>{const i=this._addHandlers,n=this._queue;i[t]?i[t](e):(n[t]=n[t]||[],n[t].push(e))})}),this},handle(r,e,t){const i=this._addHandlers,n=this._removeHandlers;if(i[r]||n[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=e,n[r]=t;const s=this._queue;return s[r]&&(s[r].forEach(a=>e(a)),delete s[r]),this},handleByMap(r,e){return this.handle(r,t=>{e[t.name]=t.ref},t=>{delete e[t.name]})},handleByList(r,e,t=-1){return this.handle(r,i=>{e.includes(i.ref)||(e.push(i.ref),e.sort((n,s)=>ug(s,t)-ug(n,t)))},i=>{const n=e.indexOf(i.ref);n!==-1&&e.splice(n,1)})}};class Bo{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const e_=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function t_(r){let e="";for(let t=0;t<r;++t)t>0&&(e+=`
else `),t<r-1&&(e+=`if(test == ${t}.0){}`);return e}function gy(r,e){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=e_.replace(/%forloop%/gi,t_(r));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))r=r/2|0;else break}return r}const Fh=0,Rh=1,Oh=2,Lh=3,Bh=4,zh=5;class Vi{constructor(){this.data=0,this.blendMode=Le.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Fh)}set blend(e){!!(this.data&1<<Fh)!==e&&(this.data^=1<<Fh)}get offsets(){return!!(this.data&1<<Rh)}set offsets(e){!!(this.data&1<<Rh)!==e&&(this.data^=1<<Rh)}get culling(){return!!(this.data&1<<Oh)}set culling(e){!!(this.data&1<<Oh)!==e&&(this.data^=1<<Oh)}get depthTest(){return!!(this.data&1<<Lh)}set depthTest(e){!!(this.data&1<<Lh)!==e&&(this.data^=1<<Lh)}get depthMask(){return!!(this.data&1<<zh)}set depthMask(e){!!(this.data&1<<zh)!==e&&(this.data^=1<<zh)}get clockwiseFrontFace(){return!!(this.data&1<<Bh)}set clockwiseFrontFace(e){!!(this.data&1<<Bh)!==e&&(this.data^=1<<Bh)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==Le.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const e=new Vi;return e.depthTest=!1,e.blend=!0,e}}const zo=[];function Pc(r,e){if(!r)return null;let t="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(t=i[1].toLowerCase())}for(let i=zo.length-1;i>=0;--i){const n=zo[i];if(n.test&&n.test(r,t))return new n(r,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Gi{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,n,s,a,l,o){if(arguments.length>8)throw new Error("max arguments reached");const{name:u,items:h}=this;this._aliasCount++;for(let d=0,p=h.length;d<p;d++)h[d][u](e,t,i,n,s,a,l,o);return h===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Gi.prototype,{dispatch:{value:Gi.prototype.emit},run:{value:Gi.prototype.emit}});class Ys{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Gi("setRealSize"),this.onUpdate=new Gi("update"),this.onError=new Gi("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}let cs=class extends Ys{constructor(e,t){const{width:i,height:n}=t||{};if(!i||!n)throw new Error("BufferResource width or height invalid");super(i,n),this.data=e}upload(e,t,i){const n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===hi.UNPACK);const s=t.realWidth,a=t.realHeight;return i.width===s&&i.height===a?n.texSubImage2D(t.target,0,0,0,s,a,t.format,i.type,this.data):(i.width=s,i.height=a,n.texImage2D(t.target,0,i.internalFormat,s,a,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array}};const i_={scaleMode:Xt.NEAREST,format:fe.RGBA,alphaMode:hi.NPM},Es=class extends Mr{constructor(r=null,e=null){super(),e=Object.assign({},Es.defaultOptions,e);const{alphaMode:t,mipmap:i,anisotropicLevel:n,scaleMode:s,width:a,height:l,wrapMode:o,format:u,type:h,target:d,resolution:p,resourceOptions:v}=e;r&&!(r instanceof Ys)&&(r=Pc(r,v),r.internal=!0),this.resolution=p||ge.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=i,this.anisotropicLevel=n,this._wrapMode=o,this._scaleMode=s,this.format=u,this.type=h,this.target=d,this.alphaMode=t,this.uid=Sr(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(r)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(r){this._mipmap!==r&&(this._mipmap=r,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(r){this._scaleMode!==r&&(this._scaleMode=r,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(r){this._wrapMode!==r&&(this._wrapMode=r,this.dirtyStyleId++)}setStyle(r,e){let t;return r!==void 0&&r!==this.scaleMode&&(this.scaleMode=r,t=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,t=!0),t&&this.dirtyStyleId++,this}setSize(r,e,t){return t=t||this.resolution,this.setRealSize(r*t,e*t,t)}setRealSize(r,e,t){return this.resolution=t||this.resolution,this.width=Math.round(r)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Sd(this.realWidth)&&Sd(this.realHeight)}setResolution(r){const e=this.resolution;return e===r?this:(this.resolution=r,this.valid&&(this.width=Math.round(this.width*e)/r,this.height=Math.round(this.height*e)/r,this.emit("update",this)),this._refreshPOT(),this)}setResource(r){if(this.resource===r)return this;if(this.resource)throw new Error("Resource can be set only once");return r.bind(this),this.resource=r,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(r){this.emit("error",this,r)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Fi[this.cacheId],delete pi[this.cacheId],this.cacheId=null),this.dispose(),Es.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(r,e,t=ge.STRICT_TEXTURE_CACHE){const i=typeof r=="string";let n=null;if(i)n=r;else{if(!r._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";r._pixiId=`${a}_${Sr()}`}n=r._pixiId}let s=Fi[n];if(i&&t&&!s)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return s||(s=new Es(r,e),s.cacheId=n,Es.addToCache(s,n)),s}static fromBuffer(r,e,t,i){r=r||new Float32Array(e*t*4);const n=new cs(r,{width:e,height:t}),s=r instanceof Float32Array?ke.FLOAT:ke.UNSIGNED_BYTE;return new Es(n,Object.assign({},i_,i||{width:e,height:t,type:s}))}static addToCache(r,e){e&&(r.textureCacheIds.includes(e)||r.textureCacheIds.push(e),Fi[e]&&Fi[e]!==r&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Fi[e]=r)}static removeFromCache(r){if(typeof r=="string"){const e=Fi[r];if(e){const t=e.textureCacheIds.indexOf(r);return t>-1&&e.textureCacheIds.splice(t,1),delete Fi[r],e}}else if(r!=null&&r.textureCacheIds){for(let e=0;e<r.textureCacheIds.length;++e)delete Fi[r.textureCacheIds[e]];return r.textureCacheIds.length=0,r}return null}};let Be=Es;Be.defaultOptions={mipmap:Ei.POW2,anisotropicLevel:0,scaleMode:Xt.LINEAR,wrapMode:gi.CLAMP,alphaMode:hi.UNPACK,target:er.TEXTURE_2D,format:fe.RGBA,type:ke.UNSIGNED_BYTE};Be._globalBatch=0;class jo{constructor(){this.texArray=null,this.blend=0,this.type=Bi.TRIANGLES,this.start=0,this.size=0,this.data=null}}let n_=0;class Fe{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=n_++,this.disposeRunner=new Gi("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?bn.ELEMENT_ARRAY_BUFFER:bn.ARRAY_BUFFER}get index(){return this.type===bn.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Fe(e)}}class rl{constructor(e,t=0,i=!1,n=ke.FLOAT,s,a,l,o=1){this.buffer=e,this.size=t,this.normalized=i,this.type=n,this.stride=s,this.start=a,this.instance=l,this.divisor=o}destroy(){this.buffer=null}static from(e,t,i,n,s){return new rl(e,t,i,n,s)}}const r_={Float32Array,Uint32Array,Int32Array,Uint8Array};function s_(r,e){let t=0,i=0;const n={};for(let o=0;o<r.length;o++)i+=e[o],t+=r[o].length;const s=new ArrayBuffer(t*4);let a=null,l=0;for(let o=0;o<r.length;o++){const u=e[o],h=r[o],d=wu(h);n[d]||(n[d]=new r_[d](s)),a=n[d];for(let p=0;p<h.length;p++){const v=(p/u|0)*i+l,w=p%u;a[v+w]=h[p]}l+=u}return new Float32Array(s)}const hg={5126:4,5123:2,5121:1};let a_=0;const l_={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class wn{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=a_++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Gi("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,n=!1,s,a,l,o=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Fe||(t instanceof Array&&(t=new Float32Array(t)),t=new Fe(t));const u=e.split("|");if(u.length>1){for(let d=0;d<u.length;d++)this.addAttribute(u[d],t,i,n,s);return this}let h=this.buffers.indexOf(t);return h===-1&&(this.buffers.push(t),h=this.buffers.length-1),this.attributes[e]=new rl(h,i,n,s,a,l,o),this.instanced=this.instanced||o,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Fe||(e instanceof Array&&(e=new Uint16Array(e)),e=new Fe(e)),e.type=bn.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],i=new Fe;let n;for(n in this.attributes){const s=this.attributes[n],a=this.buffers[s.buffer];e.push(a.data),t.push(s.size*hg[s.type]/4),s.buffer=0}for(i.data=s_(e,t),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new wn;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Fe(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new rl(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=bn.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new wn,i=[],n=[],s=[];let a;for(let l=0;l<e.length;l++){a=e[l];for(let o=0;o<a.buffers.length;o++)n[o]=n[o]||0,n[o]+=a.buffers[o].data.length,s[o]=0}for(let l=0;l<a.buffers.length;l++)i[l]=new l_[wu(a.buffers[l].data)](n[l]),t.buffers[l]=new Fe(i[l]);for(let l=0;l<e.length;l++){a=e[l];for(let o=0;o<a.buffers.length;o++)i[o].set(a.buffers[o].data,s[o]),s[o]+=a.buffers[o].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=bn.ELEMENT_ARRAY_BUFFER;let l=0,o=0,u=0,h=0;for(let d=0;d<a.buffers.length;d++)if(a.buffers[d]!==a.indexBuffer){h=d;break}for(const d in a.attributes){const p=a.attributes[d];(p.buffer|0)===h&&(o+=p.size*hg[p.type]/4)}for(let d=0;d<e.length;d++){const p=e[d].indexBuffer.data;for(let v=0;v<p.length;v++)t.indexBuffer.data[v+u]+=l;l+=e[d].buffers[h].data.length/o,u+=p.length}}return t}}class xu extends wn{constructor(e=!1){super(),this._buffer=new Fe(null,e,!1),this._indexBuffer=new Fe(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ke.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ke.FLOAT).addAttribute("aColor",this._buffer,4,!0,ke.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ke.FLOAT).addIndex(this._indexBuffer)}}const sl=Math.PI*2,my=180/Math.PI,us=Math.PI/180;var Jt=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(Jt||{});class xe{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new xe(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const Hl=[new xe,new xe,new xe,new xe];class Ke{constructor(e=0,t=0,i=0,n=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(n),this.type=Jt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ke(0,0,0,0)}clone(){return new Ke(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const Z=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=Z)return!1;const me=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>me}const i=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=i||a<=s)return!1;const l=Hl[0].set(e.left,e.top),o=Hl[1].set(e.left,e.bottom),u=Hl[2].set(e.right,e.top),h=Hl[3].set(e.right,e.bottom);if(u.x<=l.x||o.y<=l.y)return!1;const d=Math.sign(t.a*t.d-t.b*t.c);if(d===0||(t.apply(l,l),t.apply(o,o),t.apply(u,u),t.apply(h,h),Math.max(l.x,o.x,u.x,h.x)<=i||Math.min(l.x,o.x,u.x,h.x)>=n||Math.max(l.y,o.y,u.y,h.y)<=s||Math.min(l.y,o.y,u.y,h.y)>=a))return!1;const p=d*(o.y-l.y),v=d*(l.x-o.x),w=p*i+v*s,_=p*n+v*s,T=p*i+v*a,D=p*n+v*a;if(Math.max(w,_,T,D)<=p*l.x+v*l.y||Math.min(w,_,T,D)>=p*h.x+v*h.y)return!1;const L=d*(l.y-u.y),O=d*(u.x-l.x),z=L*i+O*s,V=L*n+O*s,Q=L*i+O*a,S=L*n+O*a;return!(Math.max(z,V,Q,S)<=L*l.x+O*l.y||Math.min(z,V,Q,S)>=L*h.x+O*h.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=n-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=n,this.height=s-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class Su{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=Jt.CIRC}clone(){return new Su(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let n=this.x-e,s=this.y-t;return n*=n,s*=s,n+s<=i}getBounds(){return new Ke(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class _u{constructor(e=0,t=0,i=0,n=0){this.x=e,this.y=t,this.width=i,this.height=n,this.type=Jt.ELIP}clone(){return new _u(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,n=(t-this.y)/this.height;return i*=i,n*=n,i+n<=1}getBounds(){return new Ke(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class is{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const i=[];for(let n=0,s=t.length;n<s;n++)i.push(t[n].x,t[n].y);t=i}this.points=t,this.type=Jt.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new is(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const l=this.points[s*2],o=this.points[s*2+1],u=this.points[a*2],h=this.points[a*2+1];o>t!=h>t&&e<(u-l)*((t-o)/(h-o))+l&&(i=!i)}return i}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((e,t)=>`${e}, ${t}`,"")}]`}}class ku{constructor(e=0,t=0,i=0,n=0,s=20){this.x=e,this.y=t,this.width=i,this.height=n,this.radius=s,this.type=Jt.RREC}clone(){return new ku(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let n=e-(this.x+i),s=t-(this.y+i);const a=i*i;if(n*n+s*s<=a||(n=e-(this.x+this.width-i),n*n+s*s<=a)||(s=t-(this.y+this.height-i),n*n+s*s<=a)||(n=e-(this.x+i),n*n+s*s<=a))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Ye{constructor(e=1,t=0,i=0,n=1,s=0,a=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,n,s,a){return this.a=e,this.b=t,this.c=i,this.d=n,this.tx=s,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new xe;const i=e.x,n=e.y;return t.x=this.a*i+this.c*n+this.tx,t.y=this.b*i+this.d*n+this.ty,t}applyInverse(e,t){t=t||new xe;const i=1/(this.a*this.d+this.c*-this.b),n=e.x,s=e.y;return t.x=this.d*i*n+-this.c*i*s+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*s+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.a,s=this.c,a=this.tx;return this.a=n*t-this.b*i,this.b=n*i+this.b*t,this.c=s*t-this.d*i,this.d=s*i+this.d*t,this.tx=a*t-this.ty*i,this.ty=a*i+this.ty*t,this}append(e){const t=this.a,i=this.b,n=this.c,s=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*i+e.b*s,this.c=e.c*t+e.d*n,this.d=e.c*i+e.d*s,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*i+e.ty*s+this.ty,this}setTransform(e,t,i,n,s,a,l,o,u){return this.a=Math.cos(l+u)*s,this.b=Math.sin(l+u)*s,this.c=-Math.sin(l-o)*a,this.d=Math.cos(l-o)*a,this.tx=e-(i*this.a+n*this.c),this.ty=t-(i*this.b+n*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const i=this.a,n=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,n=this.c,s=this.d,a=e.pivot,l=-Math.atan2(-n,s),o=Math.atan2(i,t),u=Math.abs(l+o);return u<1e-5||Math.abs(sl-u)<1e-5?(e.rotation=o,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=l,e.skew.y=o),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(n*n+s*s),e.position.x=this.tx+(a.x*t+a.y*n),e.position.y=this.ty+(a.x*i+a.y*s),e}invert(){const e=this.a,t=this.b,i=this.c,n=this.d,s=this.tx,a=e*n-t*i;return this.a=n/a,this.b=-t/a,this.c=-i/a,this.d=e/a,this.tx=(i*this.ty-n*s)/a,this.ty=-(e*this.ty-t*s)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Ye;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Ye}static get TEMP_MATRIX(){return new Ye}}const Nr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Gr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Wr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Hr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ad=[],yy=[],Ul=Math.sign;function o_(){for(let r=0;r<16;r++){const e=[];Ad.push(e);for(let t=0;t<16;t++){const i=Ul(Nr[r]*Nr[t]+Wr[r]*Gr[t]),n=Ul(Gr[r]*Nr[t]+Hr[r]*Gr[t]),s=Ul(Nr[r]*Wr[t]+Wr[r]*Hr[t]),a=Ul(Gr[r]*Wr[t]+Hr[r]*Hr[t]);for(let l=0;l<16;l++)if(Nr[l]===i&&Gr[l]===n&&Wr[l]===s&&Hr[l]===a){e.push(l);break}}}for(let r=0;r<16;r++){const e=new Ye;e.set(Nr[r],Gr[r],Wr[r],Hr[r],0,0),yy.push(e)}}o_();const _t={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>Nr[r],uY:r=>Gr[r],vX:r=>Wr[r],vY:r=>Hr[r],inv:r=>r&8?r&15:-r&7,add:(r,e)=>Ad[r][e],sub:(r,e)=>Ad[r][_t.inv(e)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,e)=>Math.abs(r)*2<=Math.abs(e)?e>=0?_t.S:_t.N:Math.abs(e)*2<=Math.abs(r)?r>0?_t.E:_t.W:e>0?r>0?_t.SE:_t.SW:r>0?_t.NE:_t.NW,matrixAppendRotationInv:(r,e,t=0,i=0)=>{const n=yy[_t.inv(e)];n.tx=t,n.ty=i,r.append(n)}};class mi{constructor(e,t,i=0,n=0){this._x=i,this._y=n,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new mi(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}const by=class{constructor(){this.worldTransform=new Ye,this.localTransform=new Ye,this.position=new mi(this.onChange,this,0,0),this.scale=new mi(this.onChange,this,1,1),this.pivot=new mi(this.onChange,this,0,0),this.skew=new mi(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const t=r.worldTransform,i=this.worldTransform;i.a=e.a*t.a+e.b*t.c,i.b=e.a*t.b+e.b*t.d,i.c=e.c*t.a+e.d*t.c,i.d=e.c*t.b+e.d*t.d,i.tx=e.tx*t.a+e.ty*t.c+t.tx,i.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};let Pr=by;Pr.IDENTITY=new by;var u_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,h_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function dg(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}function jh(r){const e=new Array(r);for(let t=0;t<e.length;t++)e[t]=!1;return e}function vy(r,e){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return jh(2*e);case"bvec3":return jh(3*e);case"bvec4":return jh(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ns=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,e)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(e==null||e.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,e)=>r.type==="mat3"&&r.size===1&&!r.isArray&&e.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,e)=>r.type==="vec2"&&r.size===1&&!r.isArray&&e.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,e)=>r.type==="vec3"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],d_={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},c_={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function f_(r,e){var i;const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in r.uniforms){const s=e[n];if(!s){(i=r.uniforms[n])!=null&&i.group&&(r.uniforms[n].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const a=r.uniforms[n];let l=!1;for(let o=0;o<ns.length;o++)if(ns[o].test(s,a)){t.push(ns[o].code(n,a)),l=!0;break}if(!l){const u=(s.size===1&&!s.isArray?d_:c_)[s.type].replace("location",`ud["${n}"].location`);t.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const wy={};let Ts=wy;function xy(){if(Ts===wy||Ts!=null&&Ts.isContextLost()){const r=ge.ADAPTER.createCanvas();let e;ge.PREFER_ENV>=Ar.WEBGL2&&(e=r.getContext("webgl2",{})),e||(e=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Ts=e}return Ts}let Vl;function p_(){if(!Vl){Vl=zi.MEDIUM;const r=xy();r&&r.getShaderPrecisionFormat&&(Vl=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision?zi.HIGH:zi.MEDIUM)}return Vl}function cg(r,e){const t=r.getShaderSource(e).split(`
`).map((u,h)=>`${h}: ${u}`),i=r.getShaderInfoLog(e),n=i.split(`
`),s={},a=n.map(u=>parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(u=>u&&!s[u]?(s[u]=!0,!0):!1),l=[""];a.forEach(u=>{t[u-1]=`%c${t[u-1]}%c`,l.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const o=t.join(`
`);l[0]=o,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...l),console.groupEnd()}function g_(r,e,t,i){r.getProgramParameter(e,r.LINK_STATUS)||(r.getShaderParameter(t,r.COMPILE_STATUS)||cg(r,t),r.getShaderParameter(i,r.COMPILE_STATUS)||cg(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(e)))}const m_={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Sy(r){return m_[r]}let $l=null;const fg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function _y(r,e){if(!$l){const t=Object.keys(fg);$l={};for(let i=0;i<t.length;++i){const n=t[i];$l[r[n]]=fg[n]}}return $l[e]}function pg(r,e,t){if(r.substring(0,9)!=="precision"){let i=e;return e===zi.HIGH&&t!==zi.HIGH&&(i=zi.MEDIUM),`precision ${i} float;
${r}`}else if(t!==zi.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let va;function ky(){if(typeof va=="boolean")return va;try{va=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{va=!1}return va}let y_=0;const Xl={},Ps=class{constructor(r,e,t="pixi-shader",i={}){this.extra={},this.id=y_++,this.vertexSrc=r||Ps.defaultVertexSrc,this.fragmentSrc=e||Ps.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=i,this.vertexSrc.substring(0,8)!=="#version"&&(t=t.replace(/\s+/g,"-"),Xl[t]?(Xl[t]++,t+=`-${Xl[t]}`):Xl[t]=1,this.vertexSrc=`#define SHADER_NAME ${t}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${t}
${this.fragmentSrc}`,this.vertexSrc=pg(this.vertexSrc,Ps.defaultVertexPrecision,zi.HIGH),this.fragmentSrc=pg(this.fragmentSrc,Ps.defaultFragmentPrecision,p_())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return h_}static get defaultFragmentSrc(){return u_}static from(r,e,t){const i=r+e;let n=kd[i];return n||(kd[i]=n=new Ps(r,e,t)),n}};let si=Ps;si.defaultVertexPrecision=zi.HIGH;si.defaultFragmentPrecision=gn.apple.device?zi.HIGH:zi.MEDIUM;let b_=0;class nn{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=b_++,this.static=!!t,this.ubo=!!i,e instanceof Fe?(this.buffer=e,this.buffer.type=bn.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Fe(new Float32Array(1)),this.buffer.type=bn.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(!this.ubo)this.uniforms[e]=new nn(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,i){return new nn(e,t,i)}static uboFrom(e,t){return new nn(e,t??!0,!0)}}let Ln=class Ty{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof nn?this.uniformGroup=t:this.uniformGroup=new nn(t):this.uniformGroup=new nn({}),this.disposeRunner=new Gi("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const n=t.uniforms[i];if(n.group&&this.checkUniformExists(e,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const n=si.from(e,t);return new Ty(n,i)}};class Ic{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const i=new Int32Array(e);for(let s=0;s<e;s++)i[s]=s;this.defaultGroupCache[e]=nn.from({uSamplers:i},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${e}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new si(this.vertexSrc,n)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ye,default:this.defaultGroupCache[e]};return new Ln(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class No{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function v_(){return!gn.apple.device}function w_(r){let e=!0;const t=ge.ADAPTER.getNavigator();if(gn.tablet||gn.phone){if(gn.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(gn.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?r:4}class ra{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var x_=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,S_=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const hn=class extends ra{constructor(r){super(r),this.setShaderGenerator(),this.geometryClass=xu,this.vertexSize=6,this.state=Vi.for2d(),this.size=hn.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),r.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??w_(32),this._defaultMaxTextures}static set defaultMaxTextures(r){this._defaultMaxTextures=r}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??v_(),this._canUploadSameBuffer}static set canUploadSameBuffer(r){this._canUploadSameBuffer=r}get MAX_TEXTURES(){return $e("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return S_}static get defaultFragmentTemplate(){return x_}setShaderGenerator({vertex:r=hn.defaultVertexSrc,fragment:e=hn.defaultFragmentTemplate}={}){this.shaderGenerator=new Ic(r,e)}contextChange(){const r=this.renderer.gl;ge.PREFER_ENV===Ar.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),hn.defaultMaxTextures),this.maxTextures=gy(this.maxTextures,r)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:r,_textureArrayPool:e}=hn,t=this.size/4,i=Math.floor(t/this.maxTextures)+1;for(;r.length<t;)r.push(new jo);for(;e.length<i;)e.push(new No);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(r){r._texture.valid&&(this._vertexCount+r.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=r.vertexData.length/2,this._indexCount+=r.indices.length,this._bufferedTextures[this._bufferSize]=r._texture.baseTexture,this._bufferedElements[this._bufferSize++]=r)}buildTexturesAndDrawCalls(){const{_bufferedTextures:r,maxTextures:e}=this,t=hn._textureArrayPool,i=this.renderer.batch,n=this._tempBoundTextures,s=this.renderer.textureGC.count;let a=++Be._globalBatch,l=0,o=t[0],u=0;i.copyBoundTextures(n,e);for(let h=0;h<this._bufferSize;++h){const d=r[h];r[h]=null,d._batchEnabled!==a&&(o.count>=e&&(i.boundArray(o,n,a,e),this.buildDrawCalls(o,u,h),u=h,o=t[++l],++a),d._batchEnabled=a,d.touched=s,o.elements[o.count++]=d)}o.count>0&&(i.boundArray(o,n,a,e),this.buildDrawCalls(o,u,this._bufferSize),++l,++a);for(let h=0;h<n.length;h++)n[h]=null;Be._globalBatch=a}buildDrawCalls(r,e,t){const{_bufferedElements:i,_attributeBuffer:n,_indexBuffer:s,vertexSize:a}=this,l=hn._drawCallPool;let o=this._dcIndex,u=this._aIndex,h=this._iIndex,d=l[o];d.start=this._iIndex,d.texArray=r;for(let p=e;p<t;++p){const v=i[p],w=v._texture.baseTexture,_=Mc[w.alphaMode?1:0][v.blendMode];i[p]=null,e<p&&d.blend!==_&&(d.size=h-d.start,e=p,d=l[++o],d.texArray=r,d.start=h),this.packInterleavedGeometry(v,n,s,u,h),u+=v.vertexData.length/2*a,h+=v.indices.length,d.blend=_}e<t&&(d.size=h-d.start,++o),this._dcIndex=o,this._aIndex=u,this._iIndex=h}bindAndClearTexArray(r){const e=this.renderer.texture;for(let t=0;t<r.count;t++)e.bind(r.elements[t],r.ids[t]),r.elements[t]=null;r.count=0}updateGeometry(){const{_packedGeometries:r,_attributeBuffer:e,_indexBuffer:t}=this;hn.canUploadSameBuffer?(r[this._flushId]._buffer.update(e.rawBinaryData),r[this._flushId]._indexBuffer.update(t),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(e.rawBinaryData),r[this._flushId]._indexBuffer.update(t),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const r=this._dcIndex,{gl:e,state:t}=this.renderer,i=hn._drawCallPool;let n=null;for(let s=0;s<r;s++){const{texArray:a,type:l,size:o,start:u,blend:h}=i[s];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=h,t.set(this.state),e.drawElements(l,o,e.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),hn.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]&&this._packedGeometries[r].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(r){const e=nl(Math.ceil(r/8)),t=_d(e),i=e*8;this._aBuffers.length<=t&&(this._iBuffers.length=t+1);let n=this._aBuffers[i];return n||(this._aBuffers[i]=n=new Bo(i*this.vertexSize*4)),n}getIndexBuffer(r){const e=nl(Math.ceil(r/12)),t=_d(e),i=e*12;this._iBuffers.length<=t&&(this._iBuffers.length=t+1);let n=this._iBuffers[t];return n||(this._iBuffers[t]=n=new Uint16Array(i)),n}packInterleavedGeometry(r,e,t,i,n){const{uint32View:s,float32View:a}=e,l=i/this.vertexSize,o=r.uvs,u=r.indices,h=r.vertexData,d=r._texture.baseTexture._batchLocation,p=Math.min(r.worldAlpha,1),v=lt.shared.setValue(r._tintRGB).toPremultiplied(p);for(let w=0;w<h.length;w+=2)a[i++]=h[w],a[i++]=h[w+1],a[i++]=o[w],a[i++]=o[w+1],s[i++]=v,a[i++]=d;for(let w=0;w<u.length;w++)t[n++]=l+u[w]}};let Ji=hn;Ji.defaultBatchSize=4096;Ji.extension={name:"batch",type:be.RendererPlugin};Ji._drawCallPool=[];Ji._textureArrayPool=[];Ae.add(Ji);var __=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,k_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Ea=class extends Ln{constructor(r,e,t){const i=si.from(r||Ea.defaultVertexSrc,e||Ea.defaultFragmentSrc);super(i,t),this.padding=0,this.resolution=Ea.defaultResolution,this.multisample=Ea.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Vi}apply(r,e,t,i,n){r.applyFilter(this,e,t,i)}get blendMode(){return this.state.blendMode}set blendMode(r){this.state.blendMode=r}get resolution(){return this._resolution}set resolution(r){this._resolution=r}static get defaultVertexSrc(){return k_}static get defaultFragmentSrc(){return __}};let Qt=Ea;Qt.defaultResolution=1;Qt.defaultMultisample=Tt.NONE;class ml{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new lt(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:n}=e,s=i??t;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}ml.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};ml.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"background"};Ae.add(ml);class Dc{constructor(e){this.renderer=e,this.emptyRenderer=new ra(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let n=t-1;n>=0;--n)e[n]=i[n]||null,e[n]&&(e[n]._batchLocation=n)}boundArray(e,t,i,n){const{elements:s,ids:a,count:l}=e;let o=0;for(let u=0;u<l;u++){const h=s[u],d=h._batchLocation;if(d>=0&&d<n&&t[d]===h){a[u]=d;continue}for(;o<n;){const p=t[o];if(p&&p._batchEnabled===i&&p._batchLocation===o){o++;continue}a[u]=o,h._batchLocation=o,t[o]=h;break}}}destroy(){this.renderer=null}}Dc.extension={type:be.RendererSystem,name:"batch"};Ae.add(Dc);let gg=0;class yl{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=gg++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=gg++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(ge.PREFER_ENV>=Ar.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}yl.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};yl.extension={type:be.RendererSystem,name:"context"};Ae.add(yl);class T_ extends cs{upload(e,t,i){const n=e.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===hi.UNPACK);const s=t.realWidth,a=t.realHeight;return i.width===s&&i.height===a?n.texSubImage2D(t.target,0,0,0,s,a,t.format,i.type,this.data):(i.width=s,i.height=a,n.texImage2D(t.target,0,i.internalFormat,s,a,0,t.format,i.type,this.data)),!0}}class Go{constructor(e,t){this.width=Math.round(e||100),this.height=Math.round(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Gi("disposeFramebuffer"),this.multisample=Tt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new Be(null,{scaleMode:Xt.NEAREST,resolution:1,mipmap:Ei.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new Be(new T_(null,{width:this.width,height:this.height}),{scaleMode:Xt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ei.OFF,format:fe.DEPTH_COMPONENT,type:ke.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const n=this.colorTextures[i],s=n.resolution;n.setSize(e/s,t/s)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class bl extends Be{constructor(e={}){if(typeof e=="number"){const t=arguments[0],i=arguments[1],n=arguments[2],s=arguments[3];e={width:t,height:i,scaleMode:n,resolution:s}}e.width=e.width||100,e.height=e.height||100,e.multisample??(e.multisample=Tt.NONE),super(null,e),this.mipmap=Ei.OFF,this.valid=!0,this._clear=new lt([0,0,0,0]),this.framebuffer=new Go(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}let rr=class extends Ys{constructor(e){const t=e,i=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;super(i,n),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){i===void 0&&!t.startsWith("data:")?e.crossOrigin=py(t):i!==!1&&(e.crossOrigin=typeof i=="string"?i:"anonymous")}upload(e,t,i,n){const s=e.gl,a=t.realWidth,l=t.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===hi.UNPACK),!this.noSubImage&&t.target===s.TEXTURE_2D&&i.width===a&&i.height===l?s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,i.type,n):(i.width=a,i.height=l,s.texImage2D(t.target,0,i.internalFormat,t.format,i.type,n)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}};class Fc extends rr{constructor(e,t){if(t=t||{},typeof e=="string"){const i=new Image;rr.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??ge.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,i)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?t(this.process()):t(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then(n=>n.blob()).then(n=>t(n,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===hi.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,i){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let n=!0;const s=t._glTextures;for(const a in s){const l=s[a];if(l!==i&&l.dirtyId!==t.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class Rc{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const n=t.width,s=t.height;if(i){const a=e.width/2/n,l=e.height/2/s,o=e.x/n+a,u=e.y/s+l;i=_t.add(i,_t.NW),this.x0=o+a*_t.uX(i),this.y0=u+l*_t.uY(i),i=_t.add(i,2),this.x1=o+a*_t.uX(i),this.y1=u+l*_t.uY(i),i=_t.add(i,2),this.x2=o+a*_t.uX(i),this.y2=u+l*_t.uY(i),i=_t.add(i,2),this.x3=o+a*_t.uX(i),this.y3=u+l*_t.uY(i)}else this.x0=e.x/n,this.y0=e.y/s,this.x1=(e.x+e.width)/n,this.y1=e.y/s,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/s,this.x3=e.x/n,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const mg=new Rc;function Kl(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class ye extends Mr{constructor(e,t,i,n,s,a,l){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Ke(0,0,1,1)),e instanceof ye&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=n,this.valid=!1,this._uvs=mg,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new xe(a.x,a.y):new xe(0,0),this.defaultBorders=l,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&pi[t.url]&&ye.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,ye.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),i=new ye(this.baseTexture,!this.noFrame&&e,t,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=e),i}updateUvs(){this._uvs===mg&&(this._uvs=new Rc),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=ge.STRICT_TEXTURE_CACHE){const n=typeof e=="string";let s=null;if(n)s=e;else if(e instanceof Be){if(!e.cacheId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${l}-${Sr()}`,Be.addToCache(e,e.cacheId)}s=e.cacheId}else{if(!e._pixiId){const l=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${l}_${Sr()}`}s=e._pixiId}let a=pi[s];if(n&&i&&!a)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!a&&!(e instanceof Be)?(t.resolution||(t.resolution=nr(e)),a=new ye(new Be(e,t)),a.baseTexture.cacheId=s,Be.addToCache(a.baseTexture,s),ye.addToCache(a,s)):!a&&e instanceof Be&&(a=new ye(e),ye.addToCache(a,s)),a}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),n=ye.from(e,Object.assign({resourceOptions:i},t),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(e,t,i,n){return new ye(Be.fromBuffer(e,t,i,n))}static fromLoader(e,t,i,n){const s=new Be(e,Object.assign({scaleMode:Be.defaultOptions.scaleMode,resolution:nr(t)},n)),{resource:a}=s;a instanceof Fc&&(a.url=t);const l=new ye(s);return i||(i=t),Be.addToCache(l.baseTexture,i),ye.addToCache(l,i),i!==t&&(Be.addToCache(l.baseTexture,t),ye.addToCache(l,t)),l.baseTexture.valid?Promise.resolve(l):new Promise(o=>{l.baseTexture.once("loaded",()=>o(l))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),pi[t]&&pi[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),pi[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=pi[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete pi[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)pi[e.textureCacheIds[t]]===e&&delete pi[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:n,height:s}=e,a=t+n>this.baseTexture.width,l=i+s>this.baseTexture.height;if(a||l){const o=a&&l?"and":"or",u=`X: ${t} + ${n} = ${t+n} > ${this.baseTexture.width}`,h=`Y: ${i} + ${s} = ${i+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${u} ${o} ${h}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return ye._EMPTY||(ye._EMPTY=new ye(new Be),Kl(ye._EMPTY),Kl(ye._EMPTY.baseTexture)),ye._EMPTY}static get WHITE(){if(!ye._WHITE){const e=ge.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),ye._WHITE=new ye(Be.from(e)),Kl(ye._WHITE),Kl(ye._WHITE.baseTexture)}return ye._WHITE}}class bi extends ye{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const n=this.baseTexture.resolution,s=Math.round(e*n)/n,a=Math.round(t*n)/n;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(s,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new bi(new bl(e))}}class Oc{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=Tt.NONE){const n=new bl(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new bi(n)}getOptimalTexture(e,t,i=1,n=Tt.NONE){let s;e=Math.ceil(e*i-1e-6),t=Math.ceil(t*i-1e-6),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=nl(e),t=nl(t),s=((e&65535)<<16|t&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let a=this.texturePool[s].pop();return a||(a=this.createTexture(e,t,n)),a.filterPoolKey=s,a.setResolution(i),a}getFilterTexture(e,t,i){const n=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||Tt.NONE);return n.filterFrame=e.filterFrame,n}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const i=this.texturePool[t];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const i=this.texturePool[t];if(i)for(let n=0;n<i.length;n++)i[n].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Oc.SCREEN_KEY=-1;class Cy extends wn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Lc extends wn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Fe(this.vertices),this.uvBuffer=new Fe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,n=0;return this.uvs[0]=i,this.uvs[1]=n,this.uvs[2]=i+t.width/e.width,this.uvs[3]=n,this.uvs[4]=i+t.width/e.width,this.uvs[5]=n+t.height/e.height,this.uvs[6]=i,this.uvs[7]=n+t.height/e.height,i=t.x,n=t.y,this.vertices[0]=i,this.vertices[1]=n,this.vertices[2]=i+t.width,this.vertices[3]=n,this.vertices[4]=i+t.width,this.vertices[5]=n+t.height,this.vertices[6]=i,this.vertices[7]=n+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Ay{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Tt.NONE,this.sourceFrame=new Ke,this.destinationFrame=new Ke,this.bindingSourceFrame=new Ke,this.bindingDestinationFrame=new Ke,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ql=[new xe,new xe,new xe,new xe],Nh=new Ye;class Bc{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Oc,this.statePool=[],this.quad=new Cy,this.quadUv=new Lc,this.tempRect=new Ke,this.activeState={},this.globalUniforms=new nn({outputFrame:new Ke,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new Ay,a=this.renderer.renderTexture;let l=t[0].resolution,o=t[0].multisample,u=t[0].padding,h=t[0].autoFit,d=t[0].legacy??!0;for(let w=1;w<t.length;w++){const _=t[w];l=Math.min(l,_.resolution),o=Math.min(o,_.multisample),u=this.useMaxPadding?Math.max(u,_.padding):u+_.padding,h=h&&_.autoFit,d=d||(_.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(s),s.resolution=l,s.multisample=o,s.legacy=d,s.target=e,s.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),s.sourceFrame.pad(u);const p=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(Nh.copyFrom(i.projection.transform).invert(),p),h?(s.sourceFrame.fit(p),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(p)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,l,o),s.filters=t,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const v=this.tempRect;v.x=0,v.y=0,v.width=s.sourceFrame.width,v.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=i.projection.transform,i.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,v),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const n=this.globalUniforms.uniforms;n.outputFrame=t.sourceFrame,n.resolution=t.resolution;const s=n.inputSize,a=n.inputPixel,l=n.inputClamp;if(s[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*t.resolution),a[1]=Math.round(s[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=t.sourceFrame.width*s[2]-.5*a[2],l[3]=t.sourceFrame.height*s[3]-.5*a[3],t.legacy){const u=n.filterArea;u[0]=t.destinationFrame.width,u[1]=t.destinationFrame.height,u[2]=t.sourceFrame.x,u[3]=t.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const o=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,o.renderTexture,pn.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let u=t.renderTexture,h=this.getOptimalFilterTexture(u.width,u.height,t.resolution);h.filterFrame=u.filterFrame;let d=0;for(d=0;d<i.length-1;++d){d===1&&t.multisample>1&&(h=this.getOptimalFilterTexture(u.width,u.height,t.resolution),h.filterFrame=u.filterFrame),i[d].apply(this,u,h,pn.CLEAR,t);const p=u;u=h,h=p}i[d].apply(this,u,o.renderTexture,pn.BLEND,t),d>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(u),this.returnFilterTexture(h)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=pn.CLEAR){const{renderTexture:i,state:n}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e!=null&&e.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,i.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(t===pn.CLEAR||t===pn.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,n){const s=this.renderer;s.state.set(e.state),this.bindAndClear(i,n),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(Bi.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(Bi.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:n}=this.activeState,{orig:s}=t._texture,a=e.set(n.width,0,0,n.height,i.x,i.y),l=t.worldTransform.copyTo(Ye.TEMP_MATRIX);return l.invert(),a.prepend(l),a.scale(1/s.width,1/s.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,n=Tt.NONE){return this.texturePool.getOptimalTexture(e,t,i,n)}getFilterTexture(e,t,i){if(typeof e=="number"){const s=e;e=t,t=s}e=e||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||Tt.NONE);return n.filterFrame=e.filterFrame,n}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=ql[0],n=ql[1],s=ql[2],a=ql[3];i.set(t.left,t.top),n.set(t.left,t.bottom),s.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(i,i),e.apply(n,n),e.apply(s,s),e.apply(a,a);const l=Math.min(i.x,n.x,s.x,a.x),o=Math.min(i.y,n.y,s.y,a.y),u=Math.max(i.x,n.x,s.x,a.x),h=Math.max(i.y,n.y,s.y,a.y);t.x=l,t.y=o,t.width=u-l,t.height=h-o}roundFrame(e,t,i,n,s){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(s){const{a,b:l,c:o,d:u}=s;if((Math.abs(l)>1e-4||Math.abs(o)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(u)>1e-4))return}s=s?Nh.copyFrom(s):Nh.identity(),s.translate(-i.x,-i.y).scale(n.width/i.width,n.height/i.height).translate(n.x,n.y),this.transformAABB(s,e),e.ceil(t),this.transformAABB(s.invert(),e)}}}Bc.extension={type:be.RendererSystem,name:"filter"};Ae.add(Bc);class My{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Tt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const C_=new Ke;class zc{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new Go(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ke,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;ge.PREFER_ENV===Ar.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=n=>t.drawBuffersWEBGL(n):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:n}=this;if(e){const s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,s.mipLevel=i),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,s.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let a=0;a<e.colorTextures.length;a++){const l=e.colorTextures[a];this.renderer.texture.unbind(l.parentTextureArray||l)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const a=t.width>>i,l=t.height>>i,o=a/t.width;this.setViewport(t.x*o,t.y*o,a,l)}else{const a=e.width>>i,l=e.height>>i;this.setViewport(0,0,a,l)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,n){const s=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),n=Math.round(n),(s.width!==i||s.height!==n||s.x!==e||s.y!==t)&&(s.x=e,s.y=t,s.width=i,s.height=n,this.gl.viewport(e,t,i,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,n,s=Eo.COLOR|Eo.DEPTH){const{gl:a}=this;a.clearColor(e,t,i,n),a.clear(s)}initFramebuffer(e){const{gl:t}=this,i=new My(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];i.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,t.DEPTH24_STENCIL8,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));const n=e.colorTextures;let s=n.length;t.drawBuffers||(s=Math.min(s,1));for(let a=0;a<s;a++){const l=n[a],o=l.parentTextureArray||l;this.renderer.texture.bind(o,0),a===0&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,n=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures;let a=s.length;i.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(e)?n.msaaBuffer=n.msaaBuffer||i.createRenderbuffer():n.msaaBuffer&&(i.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const l=[];for(let o=0;o<a;o++){const u=s[o],h=u.parentTextureArray||u;this.renderer.texture.bind(h,0),o===0&&n.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,n.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,n.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,u.target,h._glTextures[this.CONTEXT_UID].texture,t),l.push(i.COLOR_ATTACHMENT0+o))}if(l.length>1&&i.drawBuffers(l),e.depthTexture&&this.writeDepthTexture){const u=e.depthTexture;this.renderer.texture.bind(u,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,t)}(e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,n.stencil),n.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,n.multisample,i.DEPTH24_STENCIL8,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,n.stencil)):n.stencil&&(i.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=Tt.NONE;if(e<=1||t===null)return i;for(let n=0;n<t.length;n++)if(t[n]<=e){i=t[n];break}return i===1&&(i=Tt.NONE),i}blit(e,t,i){const{current:n,renderer:s,gl:a,CONTEXT_UID:l}=this;if(s.context.webGLVersion!==2||!n)return;const o=n.glFramebuffers[l];if(!o)return;if(!e){if(!o.msaaBuffer)return;const h=n.colorTextures[0];if(!h)return;o.blitFramebuffer||(o.blitFramebuffer=new Go(n.width,n.height),o.blitFramebuffer.addColorTexture(0,h)),e=o.blitFramebuffer,e.colorTextures[0]!==h&&(e.colorTextures[0]=h,e.dirtyId++,e.dirtyFormat++),(e.width!==n.width||e.height!==n.height)&&(e.width=n.width,e.height=n.height,e.dirtyId++,e.dirtySize++)}t||(t=C_,t.width=n.width,t.height=n.height),i||(i=t);const u=t.width===i.width&&t.height===i.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,o.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,u?a.NEAREST:a.LINEAR)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(e);s>=0&&this.managedFramebuffers.splice(s,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&n.deleteRenderbuffer(i.msaaBuffer),i.stencil&&n.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil)return;e.stencil=!0;const i=e.width,n=e.height,s=this.gl,a=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a),t.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,t.multisample,s.DEPTH24_STENCIL8,i,n):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,i,n),t.stencil=a,s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ke}destroy(){this.renderer=null}}zc.extension={type:be.RendererSystem,name:"framebuffer"};Ae.add(zc);const Gh={5126:4,5123:2,5121:1};class jc{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;ge.PREFER_ENV===Ar.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=n=>i.bindVertexArrayOES(n),e.deleteVertexArray=n=>i.deleteVertexArrayOES(n)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=(n,s)=>i.vertexAttribDivisorANGLE(n,s),e.drawElementsInstanced=(n,s,a,l,o)=>i.drawElementsInstancedANGLE(n,s,a,l,o),e.drawArraysInstanced=(n,s,a,l)=>i.drawArraysInstancedANGLE(n,s,a,l)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let n=e.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const a=n[t.program.id]||this.initGeometryVao(e,t,s);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const n=e.buffers[i];t.update(n)}}checkCompatibility(e,t){const i=e.attributes,n=t.attributeData;for(const s in n)if(!i[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,t){const i=e.attributes,n=t.attributeData,s=["g",e.id];for(const a in i)n[a]&&s.push(a,n[a].location);return s.join("-")}initGeometryVao(e,t,i=!0){const n=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,l=t.program;l.glPrograms[s]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,l);const o=this.getSignature(e,l),u=e.glVertexArrayObjects[this.CONTEXT_UID];let h=u[o];if(h)return u[l.id]=h,h;const d=e.buffers,p=e.attributes,v={},w={};for(const _ in d)v[_]=0,w[_]=0;for(const _ in p)!p[_].size&&l.attributeData[_]?p[_].size=l.attributeData[_].size:p[_].size||console.warn(`PIXI Geometry attribute '${_}' size cannot be determined (likely the bound shader does not have the attribute)`),v[p[_].buffer]+=p[_].size*Gh[p[_].type];for(const _ in p){const T=p[_],D=T.size;T.stride===void 0&&(v[T.buffer]===D*Gh[T.type]?T.stride=0:T.stride=v[T.buffer]),T.start===void 0&&(T.start=w[T.buffer],w[T.buffer]+=D*Gh[T.type])}h=n.createVertexArray(),n.bindVertexArray(h);for(let _=0;_<d.length;_++){const T=d[_];a.bind(T),i&&T._glBuffers[s].refCount++}return this.activateVao(e,l),u[l.id]=h,u[o]=h,n.bindVertexArray(null),a.unbind(bn.ARRAY_BUFFER),h}disposeGeometry(e,t){var l;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const i=e.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=e.buffers,a=(l=this.renderer)==null?void 0:l.buffer;if(e.disposeRunner.remove(this),!!i){if(a)for(let o=0;o<s.length;o++){const u=s[o]._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!t&&a.dispose(s[o],t))}if(!t){for(const o in i)if(o[0]==="g"){const u=i[o];this._activeVao===u&&this.unbind(),n.deleteVertexArray(u)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,a=e.buffers,l=e.attributes;e.indexBuffer&&s.bind(e.indexBuffer);let o=null;for(const u in l){const h=l[u],d=a[h.buffer],p=d._glBuffers[n];if(t.attributeData[u]){o!==p&&(s.bind(d),o=p);const v=t.attributeData[u].location;if(i.enableVertexAttribArray(v),i.vertexAttribPointer(v,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance)if(this.hasInstance)i.vertexAttribDivisor(v,h.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,i,n){const{gl:s}=this,a=this._activeGeometry;if(a.indexBuffer){const l=a.indexBuffer.data.BYTES_PER_ELEMENT,o=l===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(e,t||a.indexBuffer.data.length,o,(i||0)*l,n||1):s.drawElements(e,t||a.indexBuffer.data.length,o,(i||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(e,i,t||a.getSize(),n||1):s.drawArrays(e,i,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}jc.extension={type:be.RendererSystem,name:"geometry"};Ae.add(jc);const yg=new Ye;class Tu{constructor(e,t){this._texture=e,this.mapCoord=new Ye,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const i=this.mapCoord;for(let n=0;n<e.length;n+=2){const s=e[n],a=e[n+1];t[n]=s*i.a+a*i.c+i.tx,t[n+1]=s*i.b+a*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const n=t.orig,s=t.trim;s&&(yg.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(yg));const a=t.baseTexture,l=this.uClampFrame,o=this.clampMargin/a.resolution,u=this.clampOffset;return l[0]=(t._frame.x+o+u)/a.width,l[1]=(t._frame.y+o+u)/a.height,l[2]=(t._frame.x+t._frame.width-o+u)/a.width,l[3]=(t._frame.y+t._frame.height-o+u)/a.height,this.uClampOffset[0]=u/a.realWidth,this.uClampOffset[1]=u/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0}}var A_=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,M_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Ey extends Qt{constructor(e,t,i){let n=null;typeof e!="string"&&t===void 0&&i===void 0&&(n=e,e=void 0,t=void 0,i=void 0),super(e||M_,t||A_,i),this.maskSprite=n,this.maskMatrix=new Ye}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,n){const s=this._maskSprite,a=s._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Tu(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,i,n))}}class Py{constructor(e=null){this.type=jt.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Qt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=jt.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Nc{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const s=this.maskDataPool.pop()||new Py;s.pooled=!0,s.maskObject=t,i=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(n),i._colorMask=n?n._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==jt.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case jt.SCISSOR:this.renderer.scissor.push(i);break;case jt.STENCIL:this.renderer.stencil.push(i);break;case jt.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case jt.COLOR:this.pushColorMask(i);break}i.type===jt.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case jt.SCISSOR:this.renderer.scissor.pop(t);break;case jt.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case jt.SPRITE:this.popSpriteMask(t);break;case jt.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===jt.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=jt.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=jt.SCISSOR:e.type=jt.STENCIL:e.type=jt.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let n=e._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new Ey]));const s=this.renderer,a=s.renderTexture;let l,o;if(a.current){const h=a.current;l=e.resolution||h.resolution,o=e.multisample??h.multisample}else l=e.resolution||s.resolution,o=e.multisample??s.multisample;n[0].resolution=l,n[0].multisample=o,n[0].maskSprite=t;const u=i.filterArea;i.filterArea=t.getBounds(!0),s.filter.push(i,n),i.filterArea=u,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Nc.extension={type:be.RendererSystem,name:"mask"};Ae.add(Nc);class Iy{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const n=this.getStackLength();n!==i&&(n===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const bg=new Ye,vg=[],fo=class extends Iy{constructor(r){super(r),this.glConst=ge.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const r=this.maskStack[this.maskStack.length-1];return r?r._scissorCounter:0}calcScissorRect(r){if(r._scissorRectLocal)return;const e=r._scissorRect,{maskObject:t}=r,{renderer:i}=this,n=i.renderTexture,s=t.getBounds(!0,vg.pop()??new Ke);this.roundFrameToPixels(s,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),e&&s.fit(e),r._scissorRectLocal=s}static isMatrixRotated(r){if(!r)return!1;const{a:e,b:t,c:i,d:n}=r;return(Math.abs(t)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(n)>1e-4)}testScissor(r){const{maskObject:e}=r;if(!e.isFastRect||!e.isFastRect()||fo.isMatrixRotated(e.worldTransform)||fo.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(r);const t=r._scissorRectLocal;return t.width>0&&t.height>0}roundFrameToPixels(r,e,t,i,n){fo.isMatrixRotated(n)||(n=n?bg.copyFrom(n):bg.identity(),n.translate(-t.x,-t.y).scale(i.width/t.width,i.height/t.height).translate(i.x,i.y),this.renderer.filter.transformAABB(n,r),r.fit(i),r.x=Math.round(r.x*e),r.y=Math.round(r.y*e),r.width=Math.round(r.width*e),r.height=Math.round(r.height*e))}push(r){r._scissorRectLocal||this.calcScissorRect(r);const{gl:e}=this.renderer;r._scissorRect||e.enable(e.SCISSOR_TEST),r._scissorCounter++,r._scissorRect=r._scissorRectLocal,this._useCurrent()}pop(r){const{gl:e}=this.renderer;r&&vg.push(r._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const r=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=r.y:e=this.renderer.height-r.height-r.y,this.renderer.gl.scissor(r.x,e,r.width,r.height)}};let Gc=fo;Gc.extension={type:be.RendererSystem,name:"scissor"};Ae.add(Gc);class Wc extends Iy{constructor(e){super(e),this.glConst=ge.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,n=e._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const s=e._colorMask;s!==0&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,n,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,s!==0&&(e._colorMask=s,i.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=i?i._colorMask:15;n!==0&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,n!==0&&(i._colorMask=n,t.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Wc.extension={type:be.RendererSystem,name:"stencil"};Ae.add(Wc);class Hc{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return $e("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return $e("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return $e("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Hc.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"_plugin"};Ae.add(Hc);class Uc{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ye,this.transform=null}update(e,t,i,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(e,t,i,n){const s=this.projectionMatrix,a=n?-1:1;s.identity(),s.a=1/t.width*2,s.d=a*(1/t.height*2),s.tx=-1-t.x*s.a,s.ty=-a-t.y*s.d}setTransform(e){}destroy(){this.renderer=null}}Uc.extension={type:be.RendererSystem,name:"projection"};Ae.add(Uc);const E_=new Pr;class Vc{constructor(e){this.renderer=e,this._tempMatrix=new Ye}generateTexture(e,t){const{region:i,...n}=t||{},s=i||e.getLocalBounds(null,!0);s.width===0&&(s.width=1),s.height===0&&(s.height=1);const a=bi.create({width:s.width,height:s.height,...n});this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const l=e.transform;return e.transform=E_,this.renderer.render(e,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=l,a}destroy(){}}Vc.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"textureGenerator"};Ae.add(Vc);const Br=new Ke,wa=new Ke;class $c{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ke,this.destinationFrame=new Ke,this.viewportFrame=new Ke}bind(e=null,t,i){const n=this.renderer;this.current=e;let s,a,l;e?(s=e.baseTexture,l=s.resolution,t||(Br.width=e.frame.width,Br.height=e.frame.height,t=Br),i||(wa.x=e.frame.x,wa.y=e.frame.y,wa.width=t.width,wa.height=t.height,i=wa),a=s.framebuffer):(l=n.resolution,t||(Br.width=n._view.screen.width,Br.height=n._view.screen.height,t=Br),i||(i=Br,i.width=t.width,i.height=t.height));const o=this.viewportFrame;o.x=i.x*l,o.y=i.y*l,o.width=i.width*l,o.height=i.height*l,e||(o.y=n.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(a,o),this.renderer.projection.update(i,t,l,!a),e?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=e?lt.shared.setValue(e):i,s=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,l=s.width!==a.width||s.height!==a.height;if(l){let{x:o,y:u,width:h,height:d}=this.viewportFrame;o=Math.round(o),u=Math.round(u),h=Math.round(h),d=Math.round(d),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(o,u,h,d)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,t),l&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}$c.extension={type:be.RendererSystem,name:"renderTexture"};Ae.add($c);class P_{}class Dy{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function I_(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=e.getActiveAttrib(r,n);if(s.name.startsWith("gl_"))continue;const a=_y(e,s.type),l={type:a,name:s.name,size:Sy(a),location:e.getAttribLocation(r,s.name)};t[s.name]=l}return t}function D_(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const s=e.getActiveUniform(r,n),a=s.name.replace(/\[.*?\]$/,""),l=!!s.name.match(/\[.*?\]$/),o=_y(e,s.type);t[a]={name:a,index:n,type:o,size:s.size,isArray:l,value:vy(o,s.size)}}return t}function Fy(r,e){var o;const t=dg(r,r.VERTEX_SHADER,e.vertexSrc),i=dg(r,r.FRAGMENT_SHADER,e.fragmentSrc),n=r.createProgram();r.attachShader(n,t),r.attachShader(n,i);const s=(o=e.extra)==null?void 0:o.transformFeedbackVaryings;if(s&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS)||g_(r,n,t,i),e.attributeData=I_(n,r),e.uniformData=D_(n,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const u=Object.keys(e.attributeData);u.sort((h,d)=>h>d?1:-1);for(let h=0;h<u.length;h++)e.attributeData[u[h]].location=h,r.bindAttribLocation(n,h,u[h]);r.linkProgram(n)}r.deleteShader(t),r.deleteShader(i);const a={};for(const u in e.uniformData){const h=e.uniformData[u];a[u]={location:r.getUniformLocation(n,u),value:vy(h.type,h.size)}}return new Dy(n,a)}function F_(r,e,t,i,n){t.buffer.update(n)}const R_={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Ry={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Oy(r){const e=r.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let t=0,i=0,n=0;for(let s=0;s<e.length;s++){const a=e[s];if(t=Ry[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,i%t!==0&&i<16){const l=i%t%16;i+=l,n+=l}i+t>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=t,i=t):(a.offset=n,i+=t,n+=t)}return n=Math.ceil(n/16)*16,{uboElements:e,size:n}}function Ly(r,e){const t=[];for(const i in r)e[i]&&t.push(e[i]);return t.sort((i,n)=>i.index-n.index),t}function By(r,e){if(!r.autoManage)return{size:0,syncFunc:F_};const t=Ly(r.uniforms,e),{uboElements:i,size:n}=Oy(t),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const l=i[a],o=r.uniforms[l.data.name],u=l.data.name;let h=!1;for(let d=0;d<ns.length;d++){const p=ns[d];if(p.codeUbo&&p.test(l.data,o)){s.push(`offset = ${l.offset/4};`,ns[d].codeUbo(l.data.name,o)),h=!0;break}}if(!h)if(l.data.size>1){const d=Sy(l.data.type),p=Math.max(Ry[l.data.type]/16,1),v=d/p,w=(4-v%4)%4;s.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${l.offset/4};

                t = 0;

                for(var i=0; i < ${l.data.size*p}; i++)
                {
                    for(var j = 0; j < ${v}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${w};
                }

                `)}else{const d=R_[l.data.type];s.push(`
                cv = ud.${u}.value;
                v = uv.${u};
                offset = ${l.offset/4};
                ${d};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let O_=0;const Yl={textureCount:0,uboCount:0};class Xc{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=O_++}systemCheck(){if(!ky())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,n=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(n.program)),t||(Yl.textureCount=0,Yl.uboCount=0,this.syncUniformGroup(e.uniformGroup,Yl)),n}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=f_(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;const n=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),n(i.uniformData,e.uniforms,this.renderer,Yl,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:n}=this.renderer;this.renderer.buffer.bind(e.buffer);const s=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,n.uniformBlockBinding(t.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let l=this._uboCache[a];if(l||(l=this._uboCache[a]=By(e,this.shader.program.uniformData)),e.autoManage){const o=new Float32Array(l.size/4);e.buffer.update(o)}return t.uniformGroups[e.id]=l.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const n=e.uniforms,s=[`${i}-`];for(const a in n)s.push(a),t[a]&&s.push(t[a].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,n=Fy(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Xc.extension={type:be.RendererSystem,name:"shader"};Ae.add(Xc);class vl{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.2.0 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}vl.defaultOptions={hello:!1};vl.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"startup"};Ae.add(vl);function L_(r,e=[]){return e[Le.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.ADD]=[r.ONE,r.ONE],e[Le.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.NONE]=[0,0],e[Le.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],e[Le.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[Le.SRC_IN]=[r.DST_ALPHA,r.ZERO],e[Le.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],e[Le.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[Le.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],e[Le.DST_IN]=[r.ZERO,r.SRC_ALPHA],e[Le.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],e[Le.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],e[Le.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[Le.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],e}const B_=0,z_=1,j_=2,N_=3,G_=4,W_=5,Md=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Le.NONE,this._blendEq=!1,this.map=[],this.map[B_]=this.setBlend,this.map[z_]=this.setOffset,this.map[j_]=this.setCullFace,this.map[N_]=this.setDepthTest,this.map[G_]=this.setFrontFace,this.map[W_]=this.setDepthMask,this.checks=[],this.defaultState=new Vi,this.defaultState.blend=!0}contextChange(r){this.gl=r,this.blendModes=L_(r),this.set(this.defaultState),this.reset()}set(r){if(r=r||this.defaultState,this.stateId!==r.data){let e=this.stateId^r.data,t=0;for(;e;)e&1&&this.map[t].call(this,!!(r.data&1<<t)),e=e>>1,t++;this.stateId=r.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,r)}forceState(r){r=r||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(r.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,r);this.stateId=r.data}setBlend(r){this.updateCheck(Md.checkBlendMode,r),this.gl[r?"enable":"disable"](this.gl.BLEND)}setOffset(r){this.updateCheck(Md.checkPolygonOffset,r),this.gl[r?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(r){this.gl[r?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(r){this.gl.depthMask(r)}setCullFace(r){this.gl[r?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(r){this.gl.frontFace(this.gl[r?"CW":"CCW"])}setBlendMode(r){if(r===this.blendMode)return;this.blendMode=r;const e=this.blendModes[r],t=this.gl;e.length===2?t.blendFunc(e[0],e[1]):t.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,t.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD))}setPolygonOffset(r,e){this.gl.polygonOffset(r,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(r,e){const t=this.checks.indexOf(r);e&&t===-1?this.checks.push(r):!e&&t!==-1&&this.checks.splice(t,1)}static checkBlendMode(r,e){r.setBlendMode(e.blendMode)}static checkPolygonOffset(r,e){r.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let Kc=Md;Kc.extension={type:be.RendererSystem,name:"state"};Ae.add(Kc);class zy extends Mr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(n=>e.systems[n]),i=[...t,...Object.keys(e.systems).filter(n=>!t.includes(n))];for(const n of i)this.addSystem(e.systems[n],n)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Gi(t)})}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const n in this.runners)this.runners[n].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach(n=>{const s=i.find(a=>this._systemsHash[a]===n);n[e.name](t[s])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const po=class{constructor(r){this.renderer=r,this.count=0,this.checkCount=0,this.maxIdle=po.defaultMaxIdle,this.checkCountMax=po.defaultCheckCountMax,this.mode=po.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==cu.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const r=this.renderer.texture,e=r.managedTextures;let t=!1;for(let i=0;i<e.length;i++){const n=e[i];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(r.destroyTexture(n,!0),e[i]=null,t=!0)}if(t){let i=0;for(let n=0;n<e.length;n++)e[n]!==null&&(e[i++]=e[n]);e.length=i}}unload(r){const e=this.renderer.texture,t=r._texture;t&&!t.framebuffer&&e.destroyTexture(t);for(let i=r.children.length-1;i>=0;i--)this.unload(r.children[i])}destroy(){this.renderer=null}};let Qi=po;Qi.defaultMode=cu.AUTO;Qi.defaultMaxIdle=60*60;Qi.defaultCheckCountMax=60*10;Qi.extension={type:be.RendererSystem,name:"textureGC"};Ae.add(Qi);class go{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ke.UNSIGNED_BYTE,this.internalFormat=fe.RGBA,this.samplerType=0}}function H_(r){let e;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?e={[ke.UNSIGNED_BYTE]:{[fe.RGBA]:r.RGBA8,[fe.RGB]:r.RGB8,[fe.RG]:r.RG8,[fe.RED]:r.R8,[fe.RGBA_INTEGER]:r.RGBA8UI,[fe.RGB_INTEGER]:r.RGB8UI,[fe.RG_INTEGER]:r.RG8UI,[fe.RED_INTEGER]:r.R8UI,[fe.ALPHA]:r.ALPHA,[fe.LUMINANCE]:r.LUMINANCE,[fe.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ke.BYTE]:{[fe.RGBA]:r.RGBA8_SNORM,[fe.RGB]:r.RGB8_SNORM,[fe.RG]:r.RG8_SNORM,[fe.RED]:r.R8_SNORM,[fe.RGBA_INTEGER]:r.RGBA8I,[fe.RGB_INTEGER]:r.RGB8I,[fe.RG_INTEGER]:r.RG8I,[fe.RED_INTEGER]:r.R8I},[ke.UNSIGNED_SHORT]:{[fe.RGBA_INTEGER]:r.RGBA16UI,[fe.RGB_INTEGER]:r.RGB16UI,[fe.RG_INTEGER]:r.RG16UI,[fe.RED_INTEGER]:r.R16UI,[fe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[ke.SHORT]:{[fe.RGBA_INTEGER]:r.RGBA16I,[fe.RGB_INTEGER]:r.RGB16I,[fe.RG_INTEGER]:r.RG16I,[fe.RED_INTEGER]:r.R16I},[ke.UNSIGNED_INT]:{[fe.RGBA_INTEGER]:r.RGBA32UI,[fe.RGB_INTEGER]:r.RGB32UI,[fe.RG_INTEGER]:r.RG32UI,[fe.RED_INTEGER]:r.R32UI,[fe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[ke.INT]:{[fe.RGBA_INTEGER]:r.RGBA32I,[fe.RGB_INTEGER]:r.RGB32I,[fe.RG_INTEGER]:r.RG32I,[fe.RED_INTEGER]:r.R32I},[ke.FLOAT]:{[fe.RGBA]:r.RGBA32F,[fe.RGB]:r.RGB32F,[fe.RG]:r.RG32F,[fe.RED]:r.R32F,[fe.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[ke.HALF_FLOAT]:{[fe.RGBA]:r.RGBA16F,[fe.RGB]:r.RGB16F,[fe.RG]:r.RG16F,[fe.RED]:r.R16F},[ke.UNSIGNED_SHORT_5_6_5]:{[fe.RGB]:r.RGB565},[ke.UNSIGNED_SHORT_4_4_4_4]:{[fe.RGBA]:r.RGBA4},[ke.UNSIGNED_SHORT_5_5_5_1]:{[fe.RGBA]:r.RGB5_A1},[ke.UNSIGNED_INT_2_10_10_10_REV]:{[fe.RGBA]:r.RGB10_A2,[fe.RGBA_INTEGER]:r.RGB10_A2UI},[ke.UNSIGNED_INT_10F_11F_11F_REV]:{[fe.RGB]:r.R11F_G11F_B10F},[ke.UNSIGNED_INT_5_9_9_9_REV]:{[fe.RGB]:r.RGB9_E5},[ke.UNSIGNED_INT_24_8]:{[fe.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[ke.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[fe.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:e={[ke.UNSIGNED_BYTE]:{[fe.RGBA]:r.RGBA,[fe.RGB]:r.RGB,[fe.ALPHA]:r.ALPHA,[fe.LUMINANCE]:r.LUMINANCE,[fe.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ke.UNSIGNED_SHORT_5_6_5]:{[fe.RGB]:r.RGB},[ke.UNSIGNED_SHORT_4_4_4_4]:{[fe.RGBA]:r.RGBA},[ke.UNSIGNED_SHORT_5_5_5_1]:{[fe.RGBA]:r.RGBA}},e}class qc{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Be,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=H_(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let n=0;n<t;n++)this.boundTextures[n]=null;this.emptyTextures={};const i=new go(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new go(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(e,t=0){const{gl:i}=this;if(e=e==null?void 0:e.castToBaseTexture(),e!=null&&e.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,n.texture)),n.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):n.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<i.length;n++)i[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<i.length;n++)i[n]===e&&(this.currentLocation!==n&&(t.activeTexture(t.TEXTURE0+n),this.currentLocation=n),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[n]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:n}=this;if(i)for(let s=e-1;s>=0;--s){const a=t[s];a&&a._glTextures[n].samplerType!==Po.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(e){const t=new go(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var i;t.internalFormat=((i=this.internalFormats[e.type])==null?void 0:i[e.format])??e.format,this.webGLVersion===2&&e.type===ke.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var n;const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const i=this.renderer;if(this.initTextureType(e,t),(n=e.resource)!=null&&n.upload(i,e,t))t.samplerType!==Po.FLOAT&&(this.hasIntegerTextures=!0);else{const s=e.realWidth,a=e.realHeight,l=i.gl;(t.width!==s||t.height!==a||t.dirtyId<0)&&(t.width=s,t.height=a,l.texImage2D(e.target,0,t.internalFormat,s,a,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const n=this.managedTextures.indexOf(e);n!==-1&&ts(this.managedTextures,n,1)}}updateTextureStyle(e){var i;const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===Ei.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=gi.CLAMP:t.wrapMode=e.wrapMode,(i=e.resource)!=null&&i.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==Ei.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Xt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===Xt.LINEAR){const s=Math.min(e.anisotropicLevel,i.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Xt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===Xt.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}qc.extension={type:be.RendererSystem,name:"texture"};Ae.add(qc);class Yc{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:n}=this;t&&n.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:n}=this,s=t.createTransformFeedback();e._glTransformFeedbacks[n]=s,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s);for(let a=0;a<e.buffers.length;a++){const l=e.buffers[a];l&&(i.buffer.update(l),l._glBuffers[n].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,l._glBuffers[n].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),s}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let a=0;a<e.buffers.length;a++){const l=e.buffers[a];if(!l)continue;const o=l._glBuffers[this.CONTEXT_UID];o&&(o.refCount--,o.refCount===0&&!t&&s.dispose(l,t))}i&&(t||n.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Yc.extension={type:be.RendererSystem,name:"transformFeedback"};Ae.add(Yc);class wl{constructor(e){this.renderer=e}init(e){this.screen=new Ke(0,0,e.width,e.height),this.element=e.view||ge.ADAPTER.createCanvas(),this.resolution=e.resolution||ge.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=i,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",i,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}wl.defaultOptions={width:800,height:600,resolution:ge.RESOLUTION,autoDensity:!1};wl.extension={type:[be.RendererSystem,be.CanvasRendererSystem],name:"_view"};Ae.add(wl);ge.PREFER_ENV=Ar.WEBGL2;ge.STRICT_TEXTURE_CACHE=!1;ge.RENDER_OPTIONS={...yl.defaultOptions,...ml.defaultOptions,...wl.defaultOptions,...vl.defaultOptions};Object.defineProperties(ge,{WRAP_MODE:{get(){return Be.defaultOptions.wrapMode},set(r){$e("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Be.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return Be.defaultOptions.scaleMode},set(r){$e("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Be.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return Be.defaultOptions.mipmap},set(r){$e("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Be.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return Be.defaultOptions.anisotropicLevel},set(r){$e("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Be.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return $e("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Qt.defaultResolution},set(r){Qt.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return $e("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Qt.defaultMultisample},set(r){Qt.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Ji.defaultMaxTextures},set(r){$e("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Ji.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Ji.defaultBatchSize},set(r){$e("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Ji.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Ji.canUploadSameBuffer},set(r){$e("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Ji.canUploadSameBuffer=r}},GC_MODE:{get(){return Qi.defaultMode},set(r){$e("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Qi.defaultMode=r}},GC_MAX_IDLE:{get(){return Qi.defaultMaxIdle},set(r){$e("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Qi.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return Qi.defaultCheckCountMax},set(r){$e("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Qi.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return si.defaultVertexPrecision},set(r){$e("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),si.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return si.defaultFragmentPrecision},set(r){$e("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),si.defaultFragmentPrecision=r}}});var sr=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(sr||{});class Wh{constructor(e,t=null,i=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=n}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const Pi=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Wh(null,null,1/0),this.deltaMS=1/Pi.targetFPMS,this.elapsedMS=1/Pi.targetFPMS,this._tick=r=>{this._requestId=null,this.started&&(this.update(r),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(r,e,t=sr.NORMAL){return this._addListener(new Wh(r,e,t))}addOnce(r,e,t=sr.NORMAL){return this._addListener(new Wh(r,e,t,!0))}_addListener(r){let e=this._head.next,t=this._head;if(!e)r.connect(t);else{for(;e;){if(r.priority>e.priority){r.connect(t);break}t=e,e=e.next}r.previous||r.connect(t)}return this._startIfPossible(),this}remove(r,e){let t=this._head.next;for(;t;)t.match(r,e)?t=t.destroy():t=t.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let r=0,e=this._head;for(;e=e.next;)r++;return r}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let r=this._head.next;for(;r;)r=r.destroy(!0);this._head.destroy(),this._head=null}}update(r=performance.now()){let e;if(r>this.lastTime){if(e=this.elapsedMS=r-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const n=r-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=r-n%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Pi.targetFPMS;const t=this._head;let i=t.next;for(;i;)i=i.emit(this.deltaTime);t.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=r}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(r){const e=Math.min(this.maxFPS,r),t=Math.min(Math.max(0,e)/1e3,Pi.targetFPMS);this._maxElapsedMS=1/t}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(r){if(r===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,r);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Pi._shared){const r=Pi._shared=new Pi;r.autoStart=!0,r._protected=!0}return Pi._shared}static get system(){if(!Pi._system){const r=Pi._system=new Pi;r.autoStart=!0,r._protected=!0}return Pi._system}};let Lt=Pi;Lt.targetFPMS=.06;Object.defineProperties(ge,{TARGET_FPMS:{get(){return Lt.targetFPMS},set(r){$e("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Lt.targetFPMS=r}}});class Zc{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,sr.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Lt.shared:new Lt,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Zc.extension=be.Application;Ae.add(Zc);const jy=[];Ae.handleByList(be.Renderer,jy);function Ny(r){for(const e of jy)if(e.test(r))return new e(r);throw new Error("Unable to auto-detect a suitable renderer.")}var U_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,V_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Gy=U_,Jc=V_;class Qc{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=Tt.HIGH?this.multisample=Tt.HIGH:t>=Tt.MEDIUM?this.multisample=Tt.MEDIUM:t>=Tt.LOW?this.multisample=Tt.LOW:this.multisample=Tt.NONE}destroy(){}}Qc.extension={type:be.RendererSystem,name:"_multisample"};Ae.add(Qc);class $_{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class ef{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,n.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:n}=this;if(this.boundBufferBases[t]!==e){const s=e._glBuffers[n]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,s.buffer)}}bindBufferRange(e,t,i){const{gl:n,CONTEXT_UID:s}=this;i=i||0;const a=e._glBuffers[s]||this.createGLBuffer(e);n.bindBufferRange(n.UNIFORM_BUFFER,t||0,a.buffer,i*256,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,n=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==n.updateID)if(n.updateID=e._updateID,t.bindBuffer(e.type,n.buffer),n.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const s=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;n.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,s)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),i&&(t||n.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new $_(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}ef.extension={type:be.RendererSystem,name:"buffer"};Ae.add(ef);class tf{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let n,s,a,l;if(t&&(n=t.renderTexture,s=t.clear,a=t.transform,l=t.skipUpdateTransform),this.renderingToScreen=!n,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(n||(this.lastObjectRendered=e),!l){const o=e.enableTempParent();e.updateTransform(),e.disableTempParent(o)}i.renderTexture.bind(n),i.batch.currentRenderer.start(),(s??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),n&&(t.blit&&i.framebuffer.blit(),n.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}tf.extension={type:be.RendererSystem,name:"objectRenderer"};Ae.add(tf);const Ed=class extends zy{constructor(r){super(),this.type=wc.WEBGL,r=Object.assign({},ge.RENDER_OPTIONS,r),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new nn({projectionMatrix:new Ye},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Ed.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in r&&($e("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),r.premultipliedAlpha=r.useContextAlpha&&r.useContextAlpha!=="notMultiplied",r.backgroundAlpha=r.useContextAlpha===!1?1:r.backgroundAlpha),this._plugin.rendererPlugins=Ed.__plugins,this.options=r,this.startup.run(this.options)}static test(r){return r!=null&&r.forceCanvas?!1:iy()}render(r,e){this.objectRenderer.render(r,e)}resize(r,e){this._view.resizeView(r,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(r=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:r}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(r){this._view.resolution=r,this.runners.resolutionChange.emit(r)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return $e("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return $e("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return $e("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return $e("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(r){$e("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=r}get backgroundAlpha(){return $e("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(r){$e("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=r}get powerPreference(){return $e("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(r,e){return this.textureGenerator.generateTexture(r,e)}};let Ir=Ed;Ir.extension={type:be.Renderer,priority:1};Ir.__plugins={};Ir.__systems={};Ae.handleByMap(be.RendererPlugin,Ir.__plugins);Ae.handleByMap(be.RendererSystem,Ir.__systems);Ae.add(Ir);class nf extends Ys{constructor(e,t){const{width:i,height:n}=t||{};super(i,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<e;s++){const a=new Be;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof Ys?this.addResourceAt(e[i],i):this.addResourceAt(Pc(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const t=this.items.map(i=>i.resource).filter(i=>i).map(i=>i.load());return this._load=Promise.all(t).then(()=>{const{realWidth:i,realHeight:n}=this.items[0];return this.resize(i,n),Promise.resolve(this)}),this._load}}let Wy=class extends nf{constructor(e,t){const{width:i,height:n}=t||{};let s,a;Array.isArray(e)?(s=e,a=e.length):a=e,super(a,{width:i,height:n}),s&&this.initFromArray(s,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=er.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:n,itemDirtyIds:s,items:a}=this,{gl:l}=e;i.dirtyId<0&&l.texImage3D(l.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,n,0,t.format,i.type,null);for(let o=0;o<n;o++){const u=a[o];s[o]<u.dirtyId&&(s[o]=u.dirtyId,u.valid&&l.texSubImage3D(l.TEXTURE_2D_ARRAY,0,0,0,o,u.resource.width,u.resource.height,1,t.format,i.type,u.resource.source))}return!0}};class Hy extends rr{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Pa=class extends nf{constructor(r,e){const{width:t,height:i,autoLoad:n,linkBaseTexture:s}=e||{};if(r&&r.length!==Pa.SIDES)throw new Error(`Invalid length. Got ${r.length}, expected 6`);super(6,{width:t,height:i});for(let a=0;a<Pa.SIDES;a++)this.items[a].target=er.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=s!==!1,r&&this.initFromArray(r,e),n!==!1&&this.load()}bind(r){super.bind(r),r.target=er.TEXTURE_CUBE_MAP}addBaseTextureAt(r,e,t){if(t===void 0&&(t=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||r.parentTextureArray||Object.keys(r._glTextures).length>0)if(r.resource)this.addResourceAt(r.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else r.target=er.TEXTURE_CUBE_MAP_POSITIVE_X+e,r.parentTextureArray=this.baseTexture,this.items[e]=r;return r.valid&&!this.valid&&this.resize(r.realWidth,r.realHeight),this.items[e]=r,this}upload(r,e,t){const i=this.itemDirtyIds;for(let n=0;n<Pa.SIDES;n++){const s=this.items[n];(i[n]<s.dirtyId||t.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(r,s,t),i[n]=s.dirtyId):i[n]<-1&&(r.gl.texImage2D(s.target,0,t.internalFormat,e.realWidth,e.realHeight,0,e.format,t.type,null),i[n]=-1))}return!0}static test(r){return Array.isArray(r)&&r.length===Pa.SIDES}};let rf=Pa;rf.SIDES=6;class Yr extends rr{constructor(e,t){t=t||{};let i,n;typeof e=="string"?(i=Yr.EMPTY,n=e):(i=e,n=null),super(i),this.url=n,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const i=await ge.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await i.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===hi.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),e(this)}catch(i){if(this.destroyed)return;t(i),this.onError.emit(i)}}),this._load)}upload(e,t,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return Yr._EMPTY=Yr._EMPTY??ge.ADAPTER.createCanvas(0,0),Yr._EMPTY}}const mo=class extends rr{constructor(r,e){e=e||{},super(ge.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=r,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(r=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),r(this)},mo.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const r=new Image;rr.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=e=>{this._resolve&&(r.onerror=null,this.onError.emit(e))},r.onload=()=>{if(!this._resolve)return;const e=r.width,t=r.height;if(!e||!t)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let i=e*this.scale,n=t*this.scale;(this._overrideWidth||this._overrideHeight)&&(i=this._overrideWidth||this._overrideHeight/t*e,n=this._overrideHeight||this._overrideWidth/e*t),i=Math.round(i),n=Math.round(n);const s=this.source;s.width=i,s.height=n,s._pixiId=`canvas_${Sr()}`,s.getContext("2d").drawImage(r,0,0,e,t,0,0,i,n),this._resolve(),this._resolve=null}}static getSize(r){const e=mo.SVG_SIZE.exec(r),t={};return e&&(t[e[1]]=Math.round(parseFloat(e[3])),t[e[5]]=Math.round(parseFloat(e[7]))),t}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(r,e){return e==="svg"||typeof r=="string"&&r.startsWith("data:image/svg+xml")||typeof r=="string"&&mo.SVG_XML.test(r)}};let Zs=mo;Zs.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;Zs.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Pd=class extends rr{constructor(r,e){if(e=e||{},!(r instanceof HTMLVideoElement)){const t=document.createElement("video");t.setAttribute("preload","auto"),t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""),typeof r=="string"&&(r=[r]);const i=r[0].src||r[0];rr.crossOrigin(t,i,e.crossorigin);for(let n=0;n<r.length;++n){const s=document.createElement("source");let{src:a,mime:l}=r[n];a=a||r[n];const o=a.split("?").shift().toLowerCase(),u=o.slice(o.lastIndexOf(".")+1);l=l||Pd.MIME_TYPES[u]||`video/${u}`,s.src=a,s.type=l,t.appendChild(s)}r=t}super(r),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),e.autoLoad!==!1&&this.load()}update(r=0){if(!this.destroyed){const e=Lt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(e=>{this.valid?e(this):(this._resolve=e,r.load())}),this._load}_onError(r){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(r)}_isSourcePlaying(){const r=this.source;return!r.paused&&!r.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Lt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(Lt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const r=this.source;r.removeEventListener("canplay",this._onCanPlay),r.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(r.videoWidth,r.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&r.play()}dispose(){this._isConnectedToTicker&&(Lt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const r=this.source;r&&(r.removeEventListener("error",this._onError,!0),r.pause(),r.src="",r.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(r){r!==this._autoUpdate&&(this._autoUpdate=r,!this._autoUpdate&&this._isConnectedToTicker?(Lt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Lt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(r){r!==this._updateFPS&&(this._updateFPS=r)}static test(r,e){return globalThis.HTMLVideoElement&&r instanceof HTMLVideoElement||Pd.TYPES.includes(e)}};let Cu=Pd;Cu.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Cu.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};zo.push(Yr,Fc,Hy,Cu,Zs,cs,rf,Wy);class X_{constructor(){this._glTransformFeedbacks={},this.buffers=[],this.disposeRunner=new Gi("disposeTransformFeedback")}bindBuffer(e,t){this.buffers[e]=t}destroy(){this.disposeRunner.emit(this,!1)}}const K_="7.2.0",Mt=Object.freeze(Object.defineProperty({__proto__:null,ALPHA_MODES:hi,AbstractMultiResource:nf,ArrayResource:Wy,Attribute:rl,BLEND_MODES:Le,BUFFER_BITS:Eo,BUFFER_TYPE:bn,BackgroundSystem:ml,BaseImageResource:rr,BaseRenderTexture:bl,BaseTexture:Be,BatchDrawCall:jo,BatchGeometry:xu,BatchRenderer:Ji,BatchShaderGenerator:Ic,BatchSystem:Dc,BatchTextureArray:No,BrowserAdapter:km,Buffer:Fe,BufferResource:cs,BufferSystem:ef,CLEAR_MODES:pn,COLOR_MASK_BITS:_m,CanvasResource:Hy,Circle:Su,Color:lt,ContextSystem:yl,CubeResource:rf,DEG_TO_RAD:us,DRAW_MODES:Bi,ENV:Ar,Ellipse:_u,ExtensionType:be,FORMATS:fe,Filter:Qt,FilterState:Ay,FilterSystem:Bc,Framebuffer:Go,FramebufferSystem:zc,GC_MODES:cu,GLFramebuffer:My,GLProgram:Dy,GLTexture:go,GenerateTextureSystem:Vc,Geometry:wn,GeometrySystem:jc,IGLUniformData:P_,INSTALLED:zo,ImageBitmapResource:Yr,ImageResource:Fc,MASK_TYPES:jt,MIPMAP_MODES:Ei,MSAA_QUALITY:Tt,MaskData:Py,MaskSystem:Nc,Matrix:Ye,MultisampleSystem:Qc,ObjectRenderer:ra,ObjectRendererSystem:tf,ObservablePoint:mi,PI_2:sl,PRECISION:zi,PluginSystem:Hc,Point:xe,Polygon:is,Program:si,ProjectionSystem:Uc,Quad:Cy,QuadUv:Lc,RAD_TO_DEG:my,RENDERER_TYPE:wc,Rectangle:Ke,RenderTexture:bi,RenderTexturePool:Oc,RenderTextureSystem:$c,Renderer:Ir,Resource:Ys,RoundedRectangle:ku,Runner:Gi,SAMPLER_TYPES:Po,SCALE_MODES:Xt,SHAPES:Jt,SVGResource:Zs,ScissorSystem:Gc,Shader:Ln,ShaderSystem:Xc,SpriteMaskFilter:Ey,StartupSystem:vl,State:Vi,StateSystem:Kc,StencilSystem:Wc,SystemManager:zy,TARGETS:er,TYPES:ke,Texture:ye,TextureGCSystem:Qi,TextureMatrix:Tu,TextureSystem:qc,TextureUvs:Rc,Ticker:Lt,TickerPlugin:Zc,Transform:Pr,TransformFeedback:X_,TransformFeedbackSystem:Yc,UPDATE_PRIORITY:sr,UniformGroup:nn,VERSION:K_,VideoResource:Cu,ViewSystem:wl,ViewableBuffer:Bo,WRAP_MODES:gi,autoDetectRenderer:Ny,autoDetectResource:Pc,checkMaxIfStatementsInShader:gy,createUBOElements:Oy,defaultFilterVertex:Jc,defaultVertex:Gy,extensions:Ae,generateProgram:Fy,generateUniformBufferSync:By,getTestContext:xy,getUBOData:Ly,groupD8:_t,isMobile:gn,settings:ge,uniformParsers:ns,unsafeEvalSupported:ky,utils:QS},Symbol.toStringTag,{value:"Module"}));class Wo{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Ke.EMPTY:(e=e||new Ke(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:n,c:s,d:a,tx:l,ty:o}=e,u=i*t.x+s*t.y+l,h=n*t.x+a*t.y+o;this.minX=Math.min(this.minX,u),this.maxX=Math.max(this.maxX,u),this.minY=Math.min(this.minY,h),this.maxY=Math.max(this.maxY,h)}addQuad(e){let t=this.minX,i=this.minY,n=this.maxX,s=this.maxY,a=e[0],l=e[1];t=a<t?a:t,i=l<i?l:i,n=a>n?a:n,s=l>s?l:s,a=e[2],l=e[3],t=a<t?a:t,i=l<i?l:i,n=a>n?a:n,s=l>s?l:s,a=e[4],l=e[5],t=a<t?a:t,i=l<i?l:i,n=a>n?a:n,s=l>s?l:s,a=e[6],l=e[7],t=a<t?a:t,i=l<i?l:i,n=a>n?a:n,s=l>s?l:s,this.minX=t,this.minY=i,this.maxX=n,this.maxY=s}addFrame(e,t,i,n,s){this.addFrameMatrix(e.worldTransform,t,i,n,s)}addFrameMatrix(e,t,i,n,s){const a=e.a,l=e.b,o=e.c,u=e.d,h=e.tx,d=e.ty;let p=this.minX,v=this.minY,w=this.maxX,_=this.maxY,T=a*t+o*i+h,D=l*t+u*i+d;p=T<p?T:p,v=D<v?D:v,w=T>w?T:w,_=D>_?D:_,T=a*n+o*i+h,D=l*n+u*i+d,p=T<p?T:p,v=D<v?D:v,w=T>w?T:w,_=D>_?D:_,T=a*t+o*s+h,D=l*t+u*s+d,p=T<p?T:p,v=D<v?D:v,w=T>w?T:w,_=D>_?D:_,T=a*n+o*s+h,D=l*n+u*s+d,p=T<p?T:p,v=D<v?D:v,w=T>w?T:w,_=D>_?D:_,this.minX=p,this.minY=v,this.maxX=w,this.maxY=_}addVertexData(e,t,i){let n=this.minX,s=this.minY,a=this.maxX,l=this.maxY;for(let o=t;o<i;o+=2){const u=e[o],h=e[o+1];n=u<n?u:n,s=h<s?h:s,a=u>a?u:a,l=h>l?h:l}this.minX=n,this.minY=s,this.maxX=a,this.maxY=l}addVertices(e,t,i,n){this.addVerticesMatrix(e.worldTransform,t,i,n)}addVerticesMatrix(e,t,i,n,s=0,a=s){const l=e.a,o=e.b,u=e.c,h=e.d,d=e.tx,p=e.ty;let v=this.minX,w=this.minY,_=this.maxX,T=this.maxY;for(let D=i;D<n;D+=2){const L=t[D],O=t[D+1],z=l*L+u*O+d,V=h*O+o*L+p;v=Math.min(v,z-s),_=Math.max(_,z+s),w=Math.min(w,V-a),T=Math.max(T,V+a)}this.minX=v,this.minY=w,this.maxX=_,this.maxY=T}addBounds(e){const t=this.minX,i=this.minY,n=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>s?e.maxY:s}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=s&&n<=a){const l=this.minX,o=this.minY,u=this.maxX,h=this.maxY;this.minX=i<l?i:l,this.minY=n<o?n:o,this.maxX=s>u?s:u,this.maxY=a>h?a:h}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=s&&n<=a){const l=this.minX,o=this.minY,u=this.maxX,h=this.maxY;this.minX=i<l?i:l,this.minY=n<o?n:o,this.maxX=s>u?s:u,this.maxY=a>h?a:h}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,n,s,a){e-=s,t-=a,i+=s,n+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>n?this.maxY:n}}class Et extends Mr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Pr,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Wo,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const n=t[i];Object.defineProperty(Et.prototype,n,Object.getOwnPropertyDescriptor(e,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Ke),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Ke),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Wo);const t=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=n,this._bounds.updateID+=this._boundsID-s,a}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,n){return t&&(e=t.toGlobal(e,i,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,i=1,n=1,s=0,a=0,l=0,o=0,u=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=n||1,this.rotation=s,this.skew.x=a,this.skew.y=l,this.pivot.x=o,this.pivot.y=u,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new q_),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*my}set angle(e){this.transform.rotation=e*us}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class q_ extends Et{constructor(){super(...arguments),this.sortDirty=null}}Et.prototype.displayObjectUpdateTransform=Et.prototype.updateTransform;const Y_=new Ye;function Z_(r,e){return r.zIndex===e.zIndex?r._lastSortedIndex-e._lastSortedIndex:r.zIndex-e.zIndex}const Id=class extends Et{constructor(){super(),this.children=[],this.sortableChildren=Id.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(r){}addChild(...r){if(r.length>1)for(let e=0;e<r.length;e++)this.addChild(r[e]);else{const e=r[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return r[0]}addChildAt(r,e){if(e<0||e>this.children.length)throw new Error(`${r}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return r.parent&&r.parent.removeChild(r),r.parent=this,this.sortDirty=!0,r.transform._parentID=-1,this.children.splice(e,0,r),this._boundsID++,this.onChildrenChange(e),r.emit("added",this),this.emit("childAdded",r,this,e),r}swapChildren(r,e){if(r===e)return;const t=this.getChildIndex(r),i=this.getChildIndex(e);this.children[t]=e,this.children[i]=r,this.onChildrenChange(t<i?t:i)}getChildIndex(r){const e=this.children.indexOf(r);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(r,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const t=this.getChildIndex(r);ts(this.children,t,1),this.children.splice(e,0,r),this.onChildrenChange(e)}getChildAt(r){if(r<0||r>=this.children.length)throw new Error(`getChildAt: Index (${r}) does not exist.`);return this.children[r]}removeChild(...r){if(r.length>1)for(let e=0;e<r.length;e++)this.removeChild(r[e]);else{const e=r[0],t=this.children.indexOf(e);if(t===-1)return null;e.parent=null,e.transform._parentID=-1,ts(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t)}return r[0]}removeChildAt(r){const e=this.getChildAt(r);return e.parent=null,e.transform._parentID=-1,ts(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r),e}removeChildren(r=0,e=this.children.length){const t=r,i=e,n=i-t;let s;if(n>0&&n<=i){s=this.children.splice(t,n);for(let a=0;a<s.length;++a)s[a].parent=null,s[a].transform&&(s[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(r);for(let a=0;a<s.length;++a)s[a].emit("removed",this),this.emit("childRemoved",s[a],this,a);return s}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let r=!1;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i._lastSortedIndex=e,!r&&i.zIndex!==0&&(r=!0)}r&&this.children.length>1&&this.children.sort(Z_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let r=0,e=this.children.length;r<e;++r){const t=this.children[r];t.visible&&t.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let r=0;r<this.children.length;r++){const e=this.children[r];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(r,e=!1){const t=super.getLocalBounds(r);if(!e)for(let i=0,n=this.children.length;i<n;++i){const s=this.children[i];s.visible&&s.updateTransform()}return t}_calculateBounds(){}_renderWithCulling(r){const e=r.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let t,i;this.cullArea?(t=this.cullArea,i=this.worldTransform):this._render!==Id.prototype._render&&(t=this.getBounds(!0));const n=r.projection.transform;if(n&&(i?(i=Y_.copyFrom(i),i.prepend(n)):i=n),t&&e.intersects(t,i))this._render(r);else if(this.cullArea)return;for(let s=0,a=this.children.length;s<a;++s){const l=this.children[s],o=l.cullable;l.cullable=o||!this.cullArea,l.render(r),l.cullable=o}}render(r){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(r);else if(this.cullable)this._renderWithCulling(r);else{this._render(r);for(let t=0,i=this.children.length;t<i;++t)this.children[t].render(r)}}renderAdvanced(r){var n,s,a;const e=this.filters,t=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<e.length;l++)e[l].enabled&&this._enabledFilters.push(e[l])}const i=e&&((n=this._enabledFilters)==null?void 0:n.length)||t&&(!t.isMaskData||t.enabled&&(t.autoDetect||t.type!==jt.NONE));if(i&&r.batch.flush(),e&&((s=this._enabledFilters)!=null&&s.length)&&r.filter.push(this,this._enabledFilters),t&&r.mask.push(this,this._mask),this.cullable)this._renderWithCulling(r);else{this._render(r);for(let l=0,o=this.children.length;l<o;++l)this.children[l].render(r)}i&&r.batch.flush(),t&&r.mask.pop(this),e&&((a=this._enabledFilters)!=null&&a.length)&&r.filter.pop()}_render(r){}destroy(r){super.destroy(),this.sortDirty=!1;const e=typeof r=="boolean"?r:r==null?void 0:r.children,t=this.removeChildren(0,this.children.length);if(e)for(let i=0;i<t.length;++i)t[i].destroy(r)}get width(){return this.scale.x*this.getLocalBounds().width}set width(r){const e=this.getLocalBounds().width;e!==0?this.scale.x=r/e:this.scale.x=1,this._width=r}get height(){return this.scale.y*this.getLocalBounds().height}set height(r){const e=this.getLocalBounds().height;e!==0?this.scale.y=r/e:this.scale.y=1,this._height=r}};let Rt=Id;Rt.defaultSortableChildren=!1;Rt.prototype.containerUpdateTransform=Rt.prototype.updateTransform;Object.defineProperties(ge,{SORTABLE_CHILDREN:{get(){return Rt.defaultSortableChildren},set(r){$e("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Rt.defaultSortableChildren=r}}});const xa=new xe,J_=new Uint16Array([0,1,2,0,2,3]);class Wt extends Rt{constructor(e){super(),this._anchor=new mi(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new lt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Le.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||ye.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=J_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ge.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Qn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Qn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,n=t.b,s=t.c,a=t.d,l=t.tx,o=t.ty,u=this.vertexData,h=e.trim,d=e.orig,p=this._anchor;let v=0,w=0,_=0,T=0;if(h?(w=h.x-p._x*d.width,v=w+h.width,T=h.y-p._y*d.height,_=T+h.height):(w=-p._x*d.width,v=w+d.width,T=-p._y*d.height,_=T+d.height),u[0]=i*w+s*T+l,u[1]=a*T+n*w+o,u[2]=i*v+s*T+l,u[3]=a*T+n*v+o,u[4]=i*v+s*_+l,u[5]=a*_+n*v+o,u[6]=i*w+s*_+l,u[7]=a*_+n*w+o,this._roundPixels){const D=ge.RESOLUTION;for(let L=0;L<u.length;++L)u[L]=Math.round(u[L]*D)/D}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,n=this._anchor,s=this.transform.worldTransform,a=s.a,l=s.b,o=s.c,u=s.d,h=s.tx,d=s.ty,p=-n._x*i.width,v=p+i.width,w=-n._y*i.height,_=w+i.height;t[0]=a*p+o*w+h,t[1]=u*w+l*p+d,t[2]=a*v+o*w+h,t[3]=u*w+l*v+d,t[4]=a*v+o*_+h,t[5]=u*_+l*v+d,t[6]=a*p+o*_+h,t[7]=u*_+l*p+d}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Wo),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ke),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,xa);const t=this._texture.orig.width,i=this._texture.orig.height,n=-t*this.anchor.x;let s=0;return xa.x>=n&&xa.x<n+t&&(s=-i*this.anchor.y,xa.y>=s&&xa.y<s+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const i=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!i)}this._texture=null}static from(e,t){const i=e instanceof ye?e:ye.from(e,t);return new Wt(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Qn(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Qn(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||ye.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const Uy=new Ye;Et.prototype._cacheAsBitmap=!1;Et.prototype._cacheData=null;Et.prototype._cacheAsBitmapResolution=null;Et.prototype._cacheAsBitmapMultisample=null;class Q_{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Et.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let e;r?(this._cacheData||(this._cacheData=new Q_),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});Et.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};Et.prototype._initCachedDisplayObject=function(e){var p,v;if((p=this._cacheData)!=null&&p.sprite)return;const t=this.alpha;this.alpha=1,e.batch.flush();const i=this.getLocalBounds(null,!0).clone();if((v=this.filters)!=null&&v.length){const w=this.filters[0].padding;i.pad(w)}i.ceil(ge.RESOLUTION);const n=e.renderTexture.current,s=e.renderTexture.sourceFrame.clone(),a=e.renderTexture.destinationFrame.clone(),l=e.projection.transform,o=bi.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||e.resolution,multisample:this.cacheAsBitmapMultisample??e.multisample}),u=`cacheAsBitmap_${Sr()}`;this._cacheData.textureCacheId=u,Be.addToCache(o.baseTexture,u),ye.addToCache(o,u);const h=this.transform.localTransform.copyTo(Uy).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,e.render(this,{renderTexture:o,clear:!0,transform:h,skipUpdateTransform:!1}),e.framebuffer.blit(),e.projection.transform=l,e.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const d=new Wt(o);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-(i.x/i.width),d.anchor.y=-(i.y/i.height),d.alpha=t,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)};Et.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};Et.prototype._initCachedDisplayObjectCanvas=function(e){var h;if((h=this._cacheData)!=null&&h.sprite)return;const t=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const n=e.canvasContext.activeContext,s=e._projTransform;t.ceil(ge.RESOLUTION);const a=bi.create({width:t.width,height:t.height}),l=`cacheAsBitmap_${Sr()}`;this._cacheData.textureCacheId=l,Be.addToCache(a.baseTexture,l),ye.addToCache(a,l);const o=Uy;this.transform.localTransform.copyTo(o),o.invert(),o.tx-=t.x,o.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,{renderTexture:a,clear:!0,transform:o,skipUpdateTransform:!1}),e.canvasContext.activeContext=n,e._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new Wt(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(t.x/t.width),u.anchor.y=-(t.y/t.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)};Et.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Et.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Et.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Be.removeFromCache(this._cacheData.textureCacheId),ye.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Et.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};Et.prototype.name=null;Rt.prototype.getChildByName=function(e,t){for(let i=0,n=this.children.length;i<n;i++)if(this.children[i].name===e)return this.children[i];if(t)for(let i=0,n=this.children.length;i<n;i++){const s=this.children[i];if(!s.getChildByName)continue;const a=s.getChildByName(e,!0);if(a)return a}return null};Et.prototype.getGlobalPosition=function(e=new xe,t=!1){return this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};var ek=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class tk extends Qt{constructor(e=1){super(Gy,ek,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const ik={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},nk=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function rk(r){const e=ik[r],t=e.length;let i=nk,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let l=0;l<r;l++){let o=s.replace("%index%",l.toString());a=l,l>=t&&(a=r-l-1),o=o.replace("%value%",e[a].toString()),n+=o,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}const sk=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function ak(r,e){const t=Math.ceil(r/2);let i=sk,n="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<r;a++){let l=s.replace("%index%",a.toString());l=l.replace("%sampleIndex%",`${a-(t-1)}.0`),n+=l,n+=`
`}return i=i.replace("%blur%",n),i=i.replace("%size%",r.toString()),i}class Dd extends Qt{constructor(e,t=8,i=4,n=Qt.defaultResolution,s=5){const a=ak(s,e),l=rk(s);super(a,l),this.horizontal=e,this.resolution=n,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,n){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,i,n);else{const s=e.getFilterTexture(),a=e.renderer;let l=t,o=s;this.state.blend=!1,e.applyFilter(this,l,o,pn.CLEAR);for(let u=1;u<this.passes-1;u++){e.bindAndClear(l,pn.BLIT),this.uniforms.uSampler=o;const h=o;o=l,l=h,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,o,i,n),e.returnFilterTexture(s)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class lk extends Qt{constructor(e=8,t=4,i=Qt.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Dd(!0,e,t,i,n),this.blurYFilter=new Dd(!1,e,t,i,n),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,n){const s=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(s&&a){const l=e.getFilterTexture();this.blurXFilter.apply(e,t,l,pn.CLEAR),this.blurYFilter.apply(e,l,i,n),e.returnFilterTexture(l)}else a?this.blurYFilter.apply(e,t,i,n):this.blurXFilter.apply(e,t,i,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var ok=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Fd extends Qt{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Jc,ok,e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,n,s]=lt.shared.setValue(e).toArray(),a=[i,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),n=Math.sin(e),s=Math.sqrt,a=1/3,l=s(a),o=i+(1-i)*a,u=a*(1-i)-l*n,h=a*(1-i)+l*n,d=a*(1-i)+l*n,p=i+a*(1-i),v=a*(1-i)-l*n,w=a*(1-i)-l*n,_=a*(1-i)+l*n,T=i+a*(1-i),D=[o,u,h,0,0,d,p,v,0,0,w,_,T,0,0,0,0,0,1,0];this._loadMatrix(D,t)}contrast(e,t){const i=(e||0)+1,n=-.5*(i-1),s=[i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0];this._loadMatrix(s,t)}saturate(e=0,t){const i=e*2/3+1,n=(i-1)*-.5,s=[i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0];this._loadMatrix(s,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,i,n,s){e=e||.2,t=t||.15,i=i||16770432,n=n||3375104;const a=lt.shared,[l,o,u]=a.setValue(i).toArray(),[h,d,p]=a.setValue(n).toArray(),v=[.3,.59,.11,0,0,l,o,u,e,0,h,d,p,t,0,l-h,o-d,u-p,0,0];this._loadMatrix(v,s)}night(e,t){e=e||.1;const i=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Fd.prototype.grayscale=Fd.prototype.greyscale;var uk=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,hk=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class dk extends Qt{constructor(e,t){const i=new Ye;e.renderable=!1,super(hk,uk,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,t==null&&(t=20),this.scale=new xe(t,t)}apply(e,t,i,n){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,a=Math.sqrt(s.a*s.a+s.b*s.b),l=Math.sqrt(s.c*s.c+s.d*s.d);a!==0&&l!==0&&(this.uniforms.rotation[0]=s.a/a,this.uniforms.rotation[1]=s.b/a,this.uniforms.rotation[2]=s.c/l,this.uniforms.rotation[3]=s.d/l),e.applyFilter(this,t,i,n)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var ck=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,fk=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class pk extends Qt{constructor(){super(fk,ck)}}var gk=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class mk extends Qt{constructor(e=.5,t=Math.random()){super(Jc,gk,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const wg={AlphaFilter:tk,BlurFilter:lk,BlurFilterPass:Dd,ColorMatrixFilter:Fd,DisplacementFilter:dk,FXAAFilter:pk,NoiseFilter:mk};Object.entries(wg).forEach(([r,e])=>{Object.defineProperty(wg,r,{get(){return $e("7.1.0",`filters.${r} has moved to ${r}`),e}})});class yk{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Lt.system.add(this.tickerUpdate,this,sr.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Lt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Vr=new yk;class xl{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=xl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new xe,this.page=new xe,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Ho extends xl{constructor(){super(...arguments),this.client=new xe,this.movement=new xe,this.offset=new xe,this.global=new xe,this.screen=new xe}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,n,s,a,l,o,u,h,d,p,v,w,_){throw new Error("Method not implemented.")}}class dn extends Ho{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Js extends Ho{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Js.DOM_DELTA_PIXEL=0;Js.DOM_DELTA_LINE=1;Js.DOM_DELTA_PAGE=2;const bk=2048,vk=new xe,Hh=new xe;class wk{constructor(e){this.dispatch=new Mr,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._collectInteractiveElements=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,n)=>i.priority-n.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,n=t.length;i<n;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Vr.pauseUpdate=!0;const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.eventMode,vk.set(e,t),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let n=0,s=i.length-1;n<s;n++)if(e.currentTarget=i[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let n=i.length-2;n>=0;n--)if(e.currentTarget=i[n],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(i.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const n=Array.isArray(t)?t:[t];for(let s=i.length-1;s>=0;s--)n.forEach(a=>{e.currentTarget=i[s],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let i=0;i<bk&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestRecursive(e,t,i,n,s){if(s(e,i))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Vr.pauseUpdate=!1),e.interactiveChildren&&e.children){const o=e.children;for(let u=o.length-1;u>=0;u--){const h=o[u],d=this.hitTestRecursive(h,this._isInteractive(t)?t:h.eventMode,i,n,s);if(d){if(d.length>0&&!d[d.length-1].parent)continue;const p=e.isInteractive();if((d.length>0||p)&&(this._collectInteractiveElements&&p&&this._allInteractiveElements.push(e),d.push(e)),this._collectInteractiveElements&&this._hitElements.length===0&&(this._hitElements=d),!this._collectInteractiveElements)return d}}}const a=this._isInteractive(t),l=e.isInteractive();return this._collectInteractiveElements&&(a&&l&&this._allInteractiveElements.push(e),this._hitElements.length>0)?null:a&&n(e,i)?l?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}hitPruneFn(e,t){var i;if(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)return!0;if(this._collectInteractiveElements&&this._hitElements.length>0)return!1;if(e.hitArea&&(e.worldTransform.applyInverse(t,Hh),!e.hitArea.contains(Hh.x,Hh.y)))return!0;if(e._mask){const n=e._mask.isMaskData?e._mask.maskObject:e._mask;if(n&&!((i=n.containsPoint)!=null&&i.call(n,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var s,a;t=t??e.type;const i=`on${t}`;(a=(s=e.currentTarget)[i])==null||a.call(s,e);const n=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,n),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const n=t.button===2;this.dispatchEvent(t,n?"rightdown":"mousedown")}const i=this.trackingData(e.pointerId);i.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var o,u;if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._collectInteractiveElements=!0;const t=this.createPointerEvent(e);this._collectInteractiveElements=!1;const i=t.pointerType==="mouse"||t.pointerType==="pen",n=this.trackingData(e.pointerId),s=this.findMountedTarget(n.overTargets);if(((o=n.overTargets)==null?void 0:o.length)>0&&s!==t.target){const h=e.type==="mousemove"?"mouseout":"pointerout",d=this.createPointerEvent(e,h,s);if(this.dispatchEvent(d,"pointerout"),i&&this.dispatchEvent(d,"mouseout"),!t.composedPath().includes(s)){const p=this.createPointerEvent(e,"pointerleave",s);for(p.eventPhase=p.AT_TARGET;p.target&&!t.composedPath().includes(p.target);)p.currentTarget=p.target,this.notifyTarget(p),i&&this.notifyTarget(p,"mouseleave"),p.target=p.target.parent;this.freeEvent(p)}this.freeEvent(d)}if(s!==t.target){const h=e.type==="mousemove"?"mouseover":"pointerover",d=this.clonePointerEvent(t,h);this.dispatchEvent(d,"pointerover"),i&&this.dispatchEvent(d,"mouseover");let p=s==null?void 0:s.parent;for(;p&&p!==this.rootTarget.parent&&p!==t.target;)p=p.parent;if(!p||p===this.rootTarget.parent){const w=this.clonePointerEvent(t,"pointerenter");for(w.eventPhase=w.AT_TARGET;w.target&&w.target!==s&&w.target!==this.rootTarget.parent;)w.currentTarget=w.target,this.notifyTarget(w),i&&this.notifyTarget(w,"mouseenter"),w.target=w.target.parent;this.freeEvent(w)}this.freeEvent(d)}const a=[],l=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(t,"pointermove"),l&&a.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),l&&a.push("globaltouchmove")),i&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),l&&a.push("globalmousemove"),this.cursor=(u=t.target)==null?void 0:u.cursor),a.length>0&&this.all(t,a),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){var a;if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.createPointerEvent(e),n=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),n&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(a=i.target)==null?void 0:a.cursor);const s=this.clonePointerEvent(i,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;t.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(s)}mapPointerOut(e){if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const i=e.pointerType==="mouse"||e.pointerType==="pen",n=this.findMountedTarget(t.overTargets),s=this.createPointerEvent(e,"pointerout",n);this.dispatchEvent(s),i&&this.dispatchEvent(s,"mouseout");const a=this.createPointerEvent(e,"pointerleave",n);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(s),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.dispatchEvent(i,l?"rightup":"mouseup")}const n=this.trackingData(e.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[e.button]);let a=s;if(s&&!i.composedPath().includes(s)){let l=s;for(;l&&!i.composedPath().includes(l);){if(i.currentTarget=l,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const o=i.button===2;this.notifyTarget(i,o?"rightupoutside":"mouseupoutside")}l=l.parent}delete n.pressTargetsByButton[e.button],a=l}if(a){const l=this.clonePointerEvent(i,"click");l.target=a,l.path=null,n.clicksByButton[e.button]||(n.clicksByButton[e.button]={clickCount:0,target:l.target,timeStamp:t});const o=n.clicksByButton[e.button];if(o.target===l.target&&t-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=l.target,o.timeStamp=t,l.detail=o.clickCount,l.pointerType==="mouse"){const u=l.button===2;this.dispatchEvent(l,u?"rightclick":"click")}else l.pointerType==="touch"&&this.dispatchEvent(l,"tap");this.dispatchEvent(l,"pointertap"),this.freeEvent(l)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof dn)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),n=this.createPointerEvent(e);if(i){let s=i;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(n)}mapWheel(e){if(!(e instanceof Js)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const n=this.allocateEvent(dn);return this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.nativeEvent=e.nativeEvent,n.originalEvent=e,n.target=i??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof t=="string"&&(n.type=t),n}createWheelEvent(e){const t=this.allocateEvent(Js);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(dn);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof dn&&t instanceof dn&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Ho&&t instanceof Ho&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let n=0,s=i.length;n<s&&!e.propagationImmediatelyStopped;n++)i[n].once&&e.currentTarget.removeListener(t,i[n].fn,void 0,!0),i[n].fn.call(i[n].context,e)}}const xk=1,Sk={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Rd=class{constructor(r){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=r,this.rootBoundary=new wk(null),Vr.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new dn(null),this.rootWheelEvent=new Js(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...Rd.defaultEventFeatures},{set:(e,t,i)=>(t==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=i),e[t]=i,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(r){const{view:e,resolution:t}=this.renderer;this.setTargetElement(e),this.resolution=t,Rd._defaultEventMode=r.eventMode??"auto",Object.assign(this.features,r.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(r){this.resolution=r}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(r){r=r||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===r)return;this.currentCursor=r;const t=this.cursorStyles[r];if(t)switch(typeof t){case"string":e&&(this.domElement.style.cursor=t);break;case"function":t(r);break;case"object":e&&Object.assign(this.domElement.style,t);break}else e&&typeof r=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,r)&&(this.domElement.style.cursor=r)}get pointer(){return this.rootPointerEvent}onPointerDown(r){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&r.pointerType==="touch"))return;const e=this.normalizeToPointerData(r);this.autoPreventDefault&&e[0].isNormalized&&(r.cancelable||!("cancelable"in r))&&r.preventDefault();for(let t=0,i=e.length;t<i;t++){const n=e[t],s=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(r){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&r.pointerType==="touch"))return;Vr.pointerMoved();const e=this.normalizeToPointerData(r);for(let t=0,i=e.length;t<i;t++){const n=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(r){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&r.pointerType==="touch"))return;let e=r.target;r.composedPath&&r.composedPath().length>0&&(e=r.composedPath()[0]);const t=e!==this.domElement?"outside":"",i=this.normalizeToPointerData(r);for(let n=0,s=i.length;n<s;n++){const a=this.bootstrapEvent(this.rootPointerEvent,i[n]);a.type+=t,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(r){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&r.pointerType==="touch"))return;const e=this.normalizeToPointerData(r);for(let t=0,i=e.length;t<i;t++){const n=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(r){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(r);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(r){this.removeEvents(),this.domElement=r,Vr.domElement=r,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Vr.addTickerListener();const r=this.domElement.style;r&&(globalThis.navigator.msPointerEnabled?(r.msContentZooming="none",r.msTouchAction="none"):this.supportsPointerEvents&&(r.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Vr.removeTickerListener();const r=this.domElement.style;globalThis.navigator.msPointerEnabled?(r.msContentZooming="",r.msTouchAction=""):this.supportsPointerEvents&&(r.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(r,e,t){let i;this.domElement.parentElement?i=this.domElement.getBoundingClientRect():i={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;r.x=(e-i.left)*(this.domElement.width/i.width)*n,r.y=(t-i.top)*(this.domElement.height/i.height)*n}normalizeToPointerData(r){const e=[];if(this.supportsTouchEvents&&r instanceof TouchEvent)for(let t=0,i=r.changedTouches.length;t<i;t++){const n=r.changedTouches[t];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=r.touches.length===1&&r.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=r.type,e.push(n)}else if(!globalThis.MouseEvent||r instanceof MouseEvent&&(!this.supportsPointerEvents||!(r instanceof globalThis.PointerEvent))){const t=r;typeof t.isPrimary>"u"&&(t.isPrimary=!0),typeof t.width>"u"&&(t.width=1),typeof t.height>"u"&&(t.height=1),typeof t.tiltX>"u"&&(t.tiltX=0),typeof t.tiltY>"u"&&(t.tiltY=0),typeof t.pointerType>"u"&&(t.pointerType="mouse"),typeof t.pointerId>"u"&&(t.pointerId=xk),typeof t.pressure>"u"&&(t.pressure=.5),typeof t.twist>"u"&&(t.twist=0),typeof t.tangentialPressure>"u"&&(t.tangentialPressure=0),t.isNormalized=!0,e.push(t)}else e.push(r);return e}normalizeWheelEvent(r){const e=this.rootWheelEvent;return this.transferMouseData(e,r),e.deltaX=r.deltaX,e.deltaY=r.deltaY,e.deltaZ=r.deltaZ,e.deltaMode=r.deltaMode,this.mapPositionToPoint(e.screen,r.clientX,r.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=r,e.type=r.type,e}bootstrapEvent(r,e){return r.originalEvent=null,r.nativeEvent=e,r.pointerId=e.pointerId,r.width=e.width,r.height=e.height,r.isPrimary=e.isPrimary,r.pointerType=e.pointerType,r.pressure=e.pressure,r.tangentialPressure=e.tangentialPressure,r.tiltX=e.tiltX,r.tiltY=e.tiltY,r.twist=e.twist,this.transferMouseData(r,e),this.mapPositionToPoint(r.screen,e.clientX,e.clientY),r.global.copyFrom(r.screen),r.offset.copyFrom(r.screen),r.isTrusted=e.isTrusted,r.type==="pointerleave"&&(r.type="pointerout"),r.type.startsWith("mouse")&&(r.type=r.type.replace("mouse","pointer")),r.type.startsWith("touch")&&(r.type=Sk[r.type]||r.type),r}transferMouseData(r,e){r.isTrusted=e.isTrusted,r.srcElement=e.srcElement,r.timeStamp=performance.now(),r.type=e.type,r.altKey=e.altKey,r.button=e.button,r.buttons=e.buttons,r.client.x=e.clientX,r.client.y=e.clientY,r.ctrlKey=e.ctrlKey,r.metaKey=e.metaKey,r.movement.x=e.movementX,r.movement.y=e.movementY,r.page.x=e.pageX,r.page.y=e.pageY,r.relatedTarget=null,r.shiftKey=e.shiftKey}};let al=Rd;al.extension={name:"events",type:[be.RendererSystem,be.CanvasRendererSystem]};al.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};Ae.add(al);function xg(r){return r==="dynamic"||r==="static"}const _k={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??xg(al.defaultEventMode)},set interactive(r){$e("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??al.defaultEventMode},set eventMode(r){this._internalInteractive=xg(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof e=="function"?void 0:e;r=i?`${r}capture`:r,e=typeof e=="function"?e:e.handleEvent,this.on(r,e,n)},removeEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,n=typeof e=="function"?void 0:e;r=i?`${r}capture`:r,e=typeof e=="function"?e:e.handleEvent,this.off(r,e,n)},dispatchEvent(r){if(!(r instanceof xl))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};Et.mixin(_k);const kk={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Et.mixin(kk);const Tk=9,Zl=100,Ck=0,Ak=0,Sg=2,_g=1,Mk=-1e3,Ek=-1e3,Pk=2;class Vy{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(gn.tablet||gn.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${Zl}px`,t.style.height=`${Zl}px`,t.style.position="absolute",t.style.top=`${Ck}px`,t.style.left=`${Ak}px`,t.style.zIndex=Sg.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${_g}px`,e.style.height=`${_g}px`,e.style.position="absolute",e.style.top=`${Mk}px`,e.style.left=`${Ek}px`,e.style.zIndex=Pk.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}update(){const e=performance.now();if(gn.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:a,height:l,resolution:o}=this.renderer,u=n/a*o,h=s/l*o;let d=this.div;d.style.left=`${t}px`,d.style.top=`${i}px`,d.style.width=`${a}px`,d.style.height=`${l}px`;for(let p=0;p<this.children.length;p++){const v=this.children[p];if(v.renderId!==this.renderId)v._accessibleActive=!1,ts(this.children,p,1),this.div.removeChild(v._accessibleDiv),this.pool.push(v._accessibleDiv),v._accessibleDiv=null,p--;else{d=v._accessibleDiv;let w=v.hitArea;const _=v.worldTransform;v.hitArea?(d.style.left=`${(_.tx+w.x*_.a)*u}px`,d.style.top=`${(_.ty+w.y*_.d)*h}px`,d.style.width=`${w.width*_.a*u}px`,d.style.height=`${w.height*_.d*h}px`):(w=v.getBounds(),this.capHitArea(w),d.style.left=`${w.x*u}px`,d.style.top=`${w.y*h}px`,d.style.width=`${w.width*u}px`,d.style.height=`${w.height*h}px`,d.title!==v.accessibleTitle&&v.accessibleTitle!==null&&(d.title=v.accessibleTitle),d.getAttribute("aria-label")!==v.accessibleHint&&v.accessibleHint!==null&&d.setAttribute("aria-label",v.accessibleHint)),(v.accessibleTitle!==d.title||v.tabIndex!==d.tabIndex)&&(d.title=v.accessibleTitle,d.tabIndex=v.tabIndex,this.debug&&this.updateDebugHTML(d))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${Zl}px`,t.style.height=`${Zl}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=Sg.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,n=this.renderer.events.rootBoundary,s=Object.assign(new xl(n),{target:i});n.rootTarget=this.renderer.lastObjectRendered,t.forEach(a=>n.dispatchEvent(s,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===Tk&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Vy.extension={name:"accessibility",type:[be.RendererPlugin,be.CanvasRendererPlugin]};Ae.add(Vy);const Od=class{constructor(r){this.stage=new Rt,r=Object.assign({forceCanvas:!1},r),this.renderer=Ny(r),Od._plugins.forEach(e=>{e.init.call(this,r)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(r,e){const t=Od._plugins.slice(0);t.reverse(),t.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(r),this.renderer=null}};let sf=Od;sf._plugins=[];Ae.handleByList(be.Application,sf._plugins);class $y{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,i;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;t=n,i=s}this.renderer.resize(t,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}$y.extension=be.Application;Ae.add($y);const kg={loader:be.LoadParser,resolver:be.ResolveParser,cache:be.CacheParser,detection:be.DetectionParser};Ae.handle(be.Asset,r=>{const e=r.ref;Object.entries(kg).filter(([t])=>!!e[t]).forEach(([t,i])=>Ae.add(Object.assign(e[t],{extension:e[t].extension??i})))},r=>{const e=r.ref;Object.keys(kg).filter(t=>!!e[t]).forEach(t=>Ae.remove(e[t]))});class Ik{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Sl(r,e){if(Array.isArray(e)){for(const t of e)if(r.startsWith(`data:${t}`))return!0;return!1}return r.startsWith(`data:${e}`)}function fs(r,e){const t=r.split("?")[0],i=ai.extname(t).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const tr=(r,e)=>(Array.isArray(r)||(r=[r]),e?r.map(t=>typeof t=="string"?e(t):t):r),Ld=(r,e)=>{const t=e.split("?")[1];return t&&(r+=`?${t}`),r};function Xy(r,e,t,i,n){const s=e[t];for(let a=0;a<s.length;a++){const l=s[a];t<e.length-1?Xy(r.replace(i[t],l),e,t+1,i,n):n.push(r.replace(i[t],l))}}function Dk(r){const e=/\{(.*?)\}/g,t=r.match(e),i=[];if(t){const n=[];t.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),Xy(r,n,0,t,i)}else i.push(r);return i}const Uo=r=>!Array.isArray(r);class Fk{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=tr(e);let n;for(let l=0;l<this.parsers.length;l++){const o=this.parsers[l];if(o.test(t)){n=o.getCacheableAssets(i,t);break}}n||(n={},i.forEach(l=>{n[l]=t}));const s=Object.keys(n),a={cacheKeys:s,keys:i};if(i.forEach(l=>{this._cacheMap.set(l,a)}),s.forEach(l=>{this._cache.has(l)&&this._cache.get(l)!==t&&console.warn("[Cache] already has key:",l),this._cache.set(l,n[l])}),t instanceof ye){const l=t;i.forEach(o=>{l.baseTexture!==ye.EMPTY.baseTexture&&Be.addToCache(l.baseTexture,o),ye.addToCache(l,o)})}}remove(e){if(this._cacheMap.get(e),!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(n=>{this._cache.delete(n)}),t.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Sa=new Fk;let Rk=class{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{var a,l;let n=null,s=null;if(t.loadParser&&(s=this._parserHash[t.loadParser],s||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!s){for(let o=0;o<this.parsers.length;o++){const u=this.parsers[o];if(u.load&&((a=u.test)!=null&&a.call(u,e,t,this))){s=u;break}}if(!s)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(e,t,this),i.parser=s;for(let o=0;o<this.parsers.length;o++){const u=this.parsers[o];u.parse&&u.parse&&await((l=u.testParse)==null?void 0:l.call(u,n,t,this))&&(n=await u.parse(n,t,this)||n,i.parser=u)}return n})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const n={},s=Uo(e),a=tr(e,u=>({src:u})),l=a.length,o=a.map(async u=>{const h=ai.toAbsolute(u.src);if(!n[u.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,u)),n[u.src]=await this.promiseCache[h].promise,t&&t(++i/l)}catch(d){throw delete this.promiseCache[h],delete n[u.src],new Error(`[Loader.load] Failed to load ${h}.
${d}`)}});return await Promise.all(o),s?n[a[0].src]:n}async unload(e){const i=tr(e,n=>({src:n})).map(async n=>{var l,o;const s=ai.toAbsolute(n.src),a=this.promiseCache[s];if(a){const u=await a.promise;(o=(l=a.parser)==null?void 0:l.unload)==null||o.call(l,u,n,this),delete this.promiseCache[s]}});await Promise.all(i)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}};var zn=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(zn||{});const Ok=".json",Lk="application/json",Bk={extension:{type:be.LoadParser,priority:zn.Low},name:"loadJson",test(r){return Sl(r,Lk)||fs(r,Ok)},async load(r){return await(await ge.ADAPTER.fetch(r)).json()}};Ae.add(Bk);const zk=".txt",jk="text/plain",Nk={name:"loadTxt",extension:{type:be.LoadParser,priority:zn.Low},test(r){return Sl(r,jk)||fs(r,zk)},async load(r){return await(await ge.ADAPTER.fetch(r)).text()}};Ae.add(Nk);const Gk=["normal","bold","100","200","300","400","500","600","700","800","900"],Wk=[".ttf",".otf",".woff",".woff2"],Hk=["font/ttf","font/otf","font/woff","font/woff2"];function Uk(r){const e=ai.extname(r);return ai.basename(r,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}const Vk={extension:{type:be.LoadParser,priority:zn.Low},name:"loadWebFont",test(r){return Sl(r,Hk)||fs(r,Wk)},async load(r,e){var i,n,s;const t=ge.ADAPTER.getFontFaceSet();if(t){const a=[],l=((i=e.data)==null?void 0:i.family)??Uk(r),o=((s=(n=e.data)==null?void 0:n.weights)==null?void 0:s.filter(h=>Gk.includes(h)))??["normal"],u=e.data??{};for(let h=0;h<o.length;h++){const d=o[h],p=new FontFace(l,`url(${encodeURI(r)})`,{...u,weight:d});await p.load(),t.add(p),a.push(p)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(e=>ge.ADAPTER.getFontFaceSet().delete(e))}};Ae.add(Vk);let Tg=0,Uh;const $k="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",Xk={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${$k}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},Kk={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let Vh;class qk{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const t=URL.createObjectURL(new Blob([Xk.code],{type:"application/javascript"})),i=new Worker(t);i.addEventListener("message",n=>{i.terminate(),URL.revokeObjectURL(t),e(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){Uh===void 0&&(Uh=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<Uh&&(Vh||(Vh=URL.createObjectURL(new Blob([Kk.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(Vh),e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise((n,s)=>{this.queue.push({id:e,arguments:t,resolve:n,reject:s})});return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[Tg]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Tg++,id:i})}}const Cg=new qk;function Au(r,e,t){const i=new ye(r);return i.baseTexture.on("dispose",()=>{delete e.promiseCache[t]}),i}const Yk=[".jpeg",".jpg",".png",".webp",".avif"],Zk=["image/jpeg","image/png","image/webp","image/avif"];async function Jk(r){const e=await ge.ADAPTER.fetch(r);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const Mu={name:"loadTextures",extension:{type:be.LoadParser,priority:zn.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Sl(r,Zk)||fs(r,Yk)},async load(r,e,t){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Cg.isImageBitmapSupported()?i=await Cg.loadImageBitmap(r):i=await Jk(r):i=await new Promise(s=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=r,i.complete?s(i):i.onload=()=>{s(i)}});const n=new Be(i,{resolution:nr(r),...e.data});return n.resource.src=r,Au(n,t,r)},unload(r){r.destroy(!0)}};Ae.add(Mu);const Qk=".svg",eT="image/svg+xml",tT={extension:{type:be.LoadParser,priority:zn.High},name:"loadSVG",test(r){return Sl(r,eT)||fs(r,Qk)},async testParse(r){return Zs.test(r)},async parse(r,e,t){var a,l,o;const i=new Zs(r,(a=e==null?void 0:e.data)==null?void 0:a.resourceOptions),n=new Be(i,{resolution:nr(r),...e==null?void 0:e.data});n.resource.src=r;const s=Au(n,t,r);return(o=(l=e==null?void 0:e.data)==null?void 0:l.resourceOptions)!=null&&o.autoLoad||await i.load(),s},async load(r,e){return(await ge.ADAPTER.fetch(r)).text()},unload:Mu.unload};Ae.add(tT);class iT{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`).join("&")}}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach(n=>{if(typeof n.name=="string"){const s=this._createBundleAssetId(e,n.name);i.push(s),this.add([n.name,s],n.srcs,n.data)}else{const s=n.name.map(a=>this._createBundleAssetId(e,a));s.forEach(a=>{i.push(a)}),this.add([...n.name,...s],n.srcs)}}):Object.keys(t).forEach(n=>{i.push(this._createBundleAssetId(e,n)),this.add([n,this._createBundleAssetId(e,n)],t[n])}),this._bundles[e]=i}add(e,t,i){const n=tr(e);n.forEach(a=>{this.hasKey(a)&&console.warn(`[Resolver] already has key: ${a} overwriting`)}),Array.isArray(t)||(typeof t=="string"?t=Dk(t):t=[t]);const s=t.map(a=>{let l=a;if(typeof a=="string"){let o=!1;for(let u=0;u<this._parsers.length;u++){const h=this._parsers[u];if(h.test(a)){l=h.parse(a),o=!0;break}}o||(l={src:a})}return l.format||(l.format=l.src.split(".").pop()),l.alias||(l.alias=n),(this._basePath||this._rootPath)&&(l.src=ai.toAbsolute(l.src,this._basePath,this._rootPath)),l.src=this._appendDefaultSearchParams(l.src),l.data=l.data??i,l});n.forEach(a=>{this._assetMap[a]=s})}resolveBundle(e){const t=Uo(e);e=tr(e);const i={};return e.forEach(n=>{const s=this._bundles[n];if(s){const a=this.resolve(s),l={};for(const o in a){const u=a[o];l[this._extractAssetIdFromBundle(n,o)]=u}i[n]=l}}),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const i={};for(const n in t)i[n]=t[n].src;return i}return t.src}resolve(e){const t=Uo(e);e=tr(e);const i={};return e.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const a=this._getPreferredOrder(s),l=s[0];a==null||a.priority.forEach(o=>{a.params[o].forEach(u=>{const h=s.filter(d=>d[o]?d[o]===u:!1);h.length&&(s=h)})}),this._resolverHash[n]=s[0]??l}else{let s=n;(this._basePath||this._rootPath)&&(s=ai.toAbsolute(s,this._basePath,this._rootPath)),s=this._appendDefaultSearchParams(s),this._resolverHash[n]={src:s}}i[n]=this._resolverHash[n]}),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[0],n=this._preferredOrder.find(s=>s.params.format.includes(i.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}}class nT{constructor(){this._detections=[],this._initialized=!1,this.resolver=new iT,this.loader=new Rk,this.cache=Sa,this._backgroundLoader=new Ik(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var s,a,l;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let o=e.manifest;typeof o=="string"&&(o=await this.load(o)),this.resolver.addManifest(o)}const t=((s=e.texturePreference)==null?void 0:s.resolution)??1,i=typeof t=="number"?[t]:t;let n=[];if((a=e.texturePreference)!=null&&a.format){const o=(l=e.texturePreference)==null?void 0:l.format;n=typeof o=="string"?[o]:o;for(const u of this._detections)await u.test()||(n=await u.remove(n))}else for(const o of this._detections)await o.test()&&(n=await o.add(n));this.resolver.prefer({params:{format:n,resolution:i}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i){this.resolver.add(e,t,i)}async load(e,t){this._initialized||await this.init();const i=Uo(e),n=tr(e).map(l=>typeof l!="string"?(this.resolver.add(l.src,l),l.src):(this.resolver.hasKey(l)||this.resolver.add(l,l),l)),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,t);return i?a[n[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;typeof e=="string"&&(i=!0,e=[e]);const n=this.resolver.resolveBundle(e),s={},a=Object.keys(n);let l=0,o=0;const u=()=>{t==null||t(++l/o)},h=a.map(d=>{const p=n[d];return o+=Object.keys(p).length,this._mapLoadToResolve(p,u).then(v=>{s[d]=v})});return await Promise.all(h),i?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return Sa.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=Sa.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),n=Object.keys(e);this._backgroundLoader.active=!1;const s=await this.loader.load(i,t);this._backgroundLoader.active=!0;const a={};return i.forEach((l,o)=>{const u=s[l.src],h=[l.src];l.alias&&h.push(...l.alias),a[n[o]]=u,Sa.set(h,u)}),a}async unload(e){this._initialized||await this.init();const t=tr(e).map(n=>typeof n!="string"?n.src:n),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=tr(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map(n=>this._unloadFromResolved(t[n]));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(i=>{Sa.remove(i.src)}),await this.loader.unload(t)}get detections(){return this._detections}get preferWorkers(){return Mu.config.preferWorkers}set preferWorkers(e){$e("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(i=>i in e).forEach(i=>{t.config[i]=e[i]})})}}const yi=new nT;Ae.handleByList(be.LoadParser,yi.loader.parsers).handleByList(be.ResolveParser,yi.resolver.parsers).handleByList(be.CacheParser,yi.cache.parsers).handleByList(be.DetectionParser,yi.detections);const rT={extension:be.CacheParser,test:r=>Array.isArray(r)&&r.every(e=>e instanceof ye),getCacheableAssets:(r,e)=>{const t={};return r.forEach(i=>{e.forEach((n,s)=>{t[i+(s===0?"":s+1)]=n})}),t}};Ae.add(rT);const sT={extension:{type:be.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const r="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",e=await ge.ADAPTER.fetch(r).then(t=>t.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async r=>[...r,"avif"],remove:async r=>r.filter(e=>e!=="avif")};Ae.add(sT);const aT={extension:{type:be.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const r="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",e=await ge.ADAPTER.fetch(r).then(t=>t.blob());return createImageBitmap(e).then(()=>!0,()=>!1)},add:async r=>[...r,"webp"],remove:async r=>r.filter(e=>e!=="webp")};Ae.add(aT);const Ag=["png","jpg","jpeg"],lT={extension:{type:be.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...Ag],remove:async r=>r.filter(e=>!Ag.includes(e))};Ae.add(lT);const oT={extension:be.ResolveParser,test:Mu.test,parse:r=>{var e;return{resolution:parseFloat(((e=ge.RETINA_PREFIX.exec(r))==null?void 0:e[1])??"1"),format:r.split(".").pop(),src:r}}};Ae.add(oT);var Di=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r))(Di||{});const Vo={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let Vn,Is;function Mg(){Is={s3tc:Vn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Vn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Vn.getExtension("WEBGL_compressed_texture_etc"),etc1:Vn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Vn.getExtension("WEBGL_compressed_texture_pvrtc")||Vn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Vn.getExtension("WEBGL_compressed_texture_atc"),astc:Vn.getExtension("WEBGL_compressed_texture_astc")}}const uT={extension:{type:be.DetectionParser,priority:2},test:async()=>{const e=ge.ADAPTER.createCanvas().getContext("webgl");return e?(Vn=e,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{Is||Mg();const e=[];for(const t in Is)Is[t]&&e.push(t);return[...e,...r]},remove:async r=>(Is||Mg(),r.filter(e=>!(e in Is)))};Ae.add(uT);class hT extends cs{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,n;typeof e=="string"?(i=e,n=new Uint8Array):(i=null,n=e),super(n,t),this.origin=i,this.buffer=n?new Bo(n):null,this.origin&&t.autoLoad!==!1&&this.load(),n!=null&&n.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}async load(){const i=await(await(await fetch(this.origin)).blob()).arrayBuffer();return this.data=new Uint32Array(i),this.buffer=new Bo(i),this.loaded=!0,this.onBlobLoaded(i),this.update(),this}}class rs extends hT{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=rs._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||rs._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const n=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let a=0,l=this.levels;a<l;a++){const{levelID:o,levelWidth:u,levelHeight:h,levelBuffer:d}=this._levelBuffers[a];n.compressedTexImage2D(n.TEXTURE_2D,o,this.format,u,h,0,d)}return!0}onBlobLoaded(){this._levelBuffers=rs._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e>=36196)return"etc1";if(e>=35986&&e<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(e,t,i,n,s,a,l){const o=new Array(i);let u=e.byteOffset,h=a,d=l,p=h+n-1&~(n-1),v=d+s-1&~(s-1),w=p*v*Vo[t];for(let _=0;_<i;_++)o[_]={levelID:_,levelWidth:i>1?h:p,levelHeight:i>1?d:v,levelBuffer:new Uint8Array(e.buffer,u,w)},u+=w,h=h>>1||1,d=d>>1||1,p=h+n-1&~(n-1),v=d+s-1&~(s-1),w=p*v*Vo[t];return o}}const $h=4,Jl=124,dT=32,Eg=20,cT=542327876,Ql={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},fT={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},eo={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},pT=1,gT=2,mT=4,yT=64,bT=512,vT=131072,wT=827611204,xT=861165636,ST=894720068,_T=808540228,kT=4,TT={[wT]:Di.COMPRESSED_RGBA_S3TC_DXT1_EXT,[xT]:Di.COMPRESSED_RGBA_S3TC_DXT3_EXT,[ST]:Di.COMPRESSED_RGBA_S3TC_DXT5_EXT},CT={70:Di.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Di.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Di.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Di.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Di.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Di.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Di.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Di.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Di.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function AT(r){const e=new Uint32Array(r);if(e[0]!==cT)throw new Error("Invalid DDS file magic word");const i=new Uint32Array(r,0,Jl/Uint32Array.BYTES_PER_ELEMENT),n=i[Ql.HEIGHT],s=i[Ql.WIDTH],a=i[Ql.MIPMAP_COUNT],l=new Uint32Array(r,Ql.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,dT/Uint32Array.BYTES_PER_ELEMENT),o=l[pT];if(o&mT){const u=l[fT.FOURCC];if(u!==_T){const O=TT[u],z=$h+Jl,V=new Uint8Array(r,z);return[new rs(V,{format:O,width:s,height:n,levels:a})]}const h=$h+Jl,d=new Uint32Array(e.buffer,h,Eg/Uint32Array.BYTES_PER_ELEMENT),p=d[eo.DXGI_FORMAT],v=d[eo.RESOURCE_DIMENSION],w=d[eo.MISC_FLAG],_=d[eo.ARRAY_SIZE],T=CT[p];if(T===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${p}`);if(w===kT)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const D=new Array,L=$h+Jl+Eg;if(_===1)D.push(new Uint8Array(r,L));else{const O=Vo[T];let z=0,V=s,Q=n;for(let Z=0;Z<a;Z++){const re=Math.max(1,V+3&-4),me=Math.max(1,Q+3&-4),le=re*me*O;z+=le,V=V>>>1,Q=Q>>>1}let S=L;for(let Z=0;Z<_;Z++)D.push(new Uint8Array(r,S,z)),S+=z}return D.map(O=>new rs(O,{format:T,width:s,height:n,levels:a}))}throw o&yT?new Error("DDSParser does not support uncompressed texture data."):o&bT?new Error("DDSParser does not supported YUV uncompressed texture data."):o&vT?new Error("DDSParser does not support single-channel (lumninance) texture data!"):o&gT?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Pg=[171,75,84,88,32,49,49,187,13,10,26,10],MT=67305985,on={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},Bd=64,Ig={[ke.UNSIGNED_BYTE]:1,[ke.UNSIGNED_SHORT]:2,[ke.INT]:4,[ke.UNSIGNED_INT]:4,[ke.FLOAT]:4,[ke.HALF_FLOAT]:8},ET={[fe.RGBA]:4,[fe.RGB]:3,[fe.RG]:2,[fe.RED]:1,[fe.LUMINANCE]:1,[fe.LUMINANCE_ALPHA]:2,[fe.ALPHA]:1},PT={[ke.UNSIGNED_SHORT_4_4_4_4]:2,[ke.UNSIGNED_SHORT_5_5_5_1]:2,[ke.UNSIGNED_SHORT_5_6_5]:2};function IT(r,e,t=!1){const i=new DataView(e);if(!DT(r,i))return null;const n=i.getUint32(on.ENDIANNESS,!0)===MT,s=i.getUint32(on.GL_TYPE,n),a=i.getUint32(on.GL_FORMAT,n),l=i.getUint32(on.GL_INTERNAL_FORMAT,n),o=i.getUint32(on.PIXEL_WIDTH,n),u=i.getUint32(on.PIXEL_HEIGHT,n)||1,h=i.getUint32(on.PIXEL_DEPTH,n)||1,d=i.getUint32(on.NUMBER_OF_ARRAY_ELEMENTS,n)||1,p=i.getUint32(on.NUMBER_OF_FACES,n),v=i.getUint32(on.NUMBER_OF_MIPMAP_LEVELS,n),w=i.getUint32(on.BYTES_OF_KEY_VALUE_DATA,n);if(u===0||h!==1)throw new Error("Only 2D textures are supported");if(p!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(d!==1)throw new Error("WebGL does not support array textures");const _=4,T=4,D=o+3&-4,L=u+3&-4,O=new Array(d);let z=o*u;s===0&&(z=D*L);let V;if(s!==0?Ig[s]?V=Ig[s]*ET[a]:V=PT[s]:V=Vo[l],V===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const Q=t?RT(i,w,n):null;let Z=z*V,re=o,me=u,le=D,oe=L,X=Bd+w;for(let K=0;K<v;K++){const _e=i.getUint32(X,n);let Se=X+4;for(let de=0;de<d;de++){let De=O[de];De||(De=O[de]=new Array(v)),De[K]={levelID:K,levelWidth:v>1||s!==0?re:le,levelHeight:v>1||s!==0?me:oe,levelBuffer:new Uint8Array(e,Se,Z)},Se+=Z}X+=_e+4,X=X%4!==0?X+4-X%4:X,re=re>>1||1,me=me>>1||1,le=re+_-1&~(_-1),oe=me+T-1&~(T-1),Z=le*oe*V}return s!==0?{uncompressed:O.map(K=>{let _e=K[0].levelBuffer,Se=!1;return s===ke.FLOAT?_e=new Float32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4):s===ke.UNSIGNED_INT?(Se=!0,_e=new Uint32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)):s===ke.INT&&(Se=!0,_e=new Int32Array(K[0].levelBuffer.buffer,K[0].levelBuffer.byteOffset,K[0].levelBuffer.byteLength/4)),{resource:new cs(_e,{width:K[0].levelWidth,height:K[0].levelHeight}),type:s,format:Se?FT(a):a}}),kvData:Q}:{compressed:O.map(K=>new rs(null,{format:l,width:o,height:u,levels:v,levelBuffers:K})),kvData:Q}}function DT(r,e){for(let t=0;t<Pg.length;t++)if(e.getUint8(t)!==Pg[t])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function FT(r){switch(r){case fe.RGBA:return fe.RGBA_INTEGER;case fe.RGB:return fe.RGB_INTEGER;case fe.RG:return fe.RG_INTEGER;case fe.RED:return fe.RED_INTEGER;default:return r}}function RT(r,e,t){const i=new Map;let n=0;for(;n<e;){const s=r.getUint32(Bd+n,t),a=Bd+n+4,l=3-(s+3)%4;if(s===0||s>e-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let o=0;for(;o<s&&r.getUint8(a+o)!==0;o++);if(o===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const u=new TextDecoder().decode(new Uint8Array(r.buffer,a,o)),h=new DataView(r.buffer,a+o+1,s-o-1);i.set(u,h),n+=4+s+l}return i}const OT={extension:{type:be.LoadParser,priority:zn.High},name:"loadDDS",test(r){return fs(r,".dds")},async load(r,e,t){const n=await(await ge.ADAPTER.fetch(r)).arrayBuffer(),a=AT(n).map(l=>{const o=new Be(l,{mipmap:Ei.OFF,alphaMode:hi.NO_PREMULTIPLIED_ALPHA,resolution:nr(r),...e.data});return Au(o,t,r)});return a.length===1?a[0]:a},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Ae.add(OT);const LT={extension:{type:be.LoadParser,priority:zn.High},name:"loadKTX",test(r){return fs(r,".ktx")},async load(r,e,t){const n=await(await ge.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:a,kvData:l}=IT(r,n),o=s??a,u={mipmap:Ei.OFF,alphaMode:hi.NO_PREMULTIPLIED_ALPHA,resolution:nr(r),...e.data},h=o.map(d=>{o===a&&Object.assign(u,{type:d.type,format:d.format});const p=new Be(d,u);return p.ktxKeyValueData=l,Au(p,t,r)});return h.length===1?h[0]:h},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Ae.add(LT);const BT={extension:be.ResolveParser,test:r=>{const t=r.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(t)},parse:r=>{var i,n;if(r.split("?")[0].split(".").pop()==="ktx"){const s=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(s.some(a=>r.endsWith(a)))return{resolution:parseFloat(((i=ge.RETINA_PREFIX.exec(r))==null?void 0:i[1])??"1"),format:s.find(a=>r.endsWith(a)),src:r}}return{resolution:parseFloat(((n=ge.RETINA_PREFIX.exec(r))==null?void 0:n[1])??"1"),format:r.split(".").pop(),src:r}}};Ae.add(BT);const zT=new Ke,jT=4,zd=class{constructor(r){this.renderer=r}async image(r,e,t){const i=new Image;return i.src=await this.base64(r,e,t),i}async base64(r,e,t){const i=this.canvas(r);if(i.toDataURL!==void 0)return i.toDataURL(e,t);if(i.convertToBlob!==void 0){const n=await i.convertToBlob({type:e,quality:t});return await new Promise(s=>{const a=new FileReader;a.onload=()=>s(a.result),a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(r,e){const{pixels:t,width:i,height:n,flipY:s}=this._rawPixels(r,e);let a=new Td(i,n,1);const l=a.context.getImageData(0,0,i,n);if(zd.arrayPostDivide(t,l.data),a.context.putImageData(l,0,0),s){const o=new Td(a.width,a.height,1);o.context.scale(1,-1),o.context.drawImage(a.canvas,0,-n),a.destroy(),a=o}return a.canvas}pixels(r,e){const{pixels:t}=this._rawPixels(r,e);return zd.arrayPostDivide(t,t),t}_rawPixels(r,e){const t=this.renderer;if(!t)throw new Error("The Extract has already been destroyed");let i,n=!1,s,a=!1;if(r)if(r instanceof bi)s=r;else{const d=t.context.webGLVersion>=2?t.multisample:Tt.NONE;if(s=t.generateTexture(r,{multisample:d}),d!==Tt.NONE){const p=bi.create({width:s.width,height:s.height});t.framebuffer.bind(s.framebuffer),t.framebuffer.blit(p.framebuffer),t.framebuffer.bind(),s.destroy(!0),s=p}a=!0}s?(i=s.baseTexture.resolution,e=e??s.frame,n=!1,t.renderTexture.bind(s)):(i=t.resolution,e||(e=zT,e.width=t.width,e.height=t.height),n=!0,t.renderTexture.bind());const l=Math.round(e.width*i),o=Math.round(e.height*i),u=new Uint8Array(jT*l*o),h=t.gl;return h.readPixels(Math.round(e.x*i),Math.round(e.y*i),l,o,h.RGBA,h.UNSIGNED_BYTE,u),a&&(s==null||s.destroy(!0)),{pixels:u,width:l,height:o,flipY:n}}destroy(){this.renderer=null}static arrayPostDivide(r,e){for(let t=0;t<r.length;t+=4){const i=e[t+3]=r[t+3];i!==0?(e[t]=Math.round(Math.min(r[t]*255/i,255)),e[t+1]=Math.round(Math.min(r[t+1]*255/i,255)),e[t+2]=Math.round(Math.min(r[t+2]*255/i,255))):(e[t]=r[t],e[t+1]=r[t+1],e[t+2]=r[t+2])}}};let Ky=zd;Ky.extension={name:"extract",type:be.RendererSystem};Ae.add(Ky);const $o={build(r){const e=r.points;let t,i,n,s,a,l;if(r.type===Jt.CIRC){const w=r.shape;t=w.x,i=w.y,a=l=w.radius,n=s=0}else if(r.type===Jt.ELIP){const w=r.shape;t=w.x,i=w.y,a=w.width,l=w.height,n=s=0}else{const w=r.shape,_=w.width/2,T=w.height/2;t=w.x+_,i=w.y+T,a=l=Math.max(0,Math.min(w.radius,Math.min(_,T))),n=_-a,s=T-l}if(!(a>=0&&l>=0&&n>=0&&s>=0)){e.length=0;return}const o=Math.ceil(2.3*Math.sqrt(a+l)),u=o*8+(n?4:0)+(s?4:0);if(e.length=u,u===0)return;if(o===0){e.length=8,e[0]=e[6]=t+n,e[1]=e[3]=i+s,e[2]=e[4]=t-n,e[5]=e[7]=i-s;return}let h=0,d=o*4+(n?2:0)+2,p=d,v=u;{const w=n+a,_=s,T=t+w,D=t-w,L=i+_;if(e[h++]=T,e[h++]=L,e[--d]=L,e[--d]=D,s){const O=i-_;e[p++]=D,e[p++]=O,e[--v]=O,e[--v]=T}}for(let w=1;w<o;w++){const _=Math.PI/2*(w/o),T=n+Math.cos(_)*a,D=s+Math.sin(_)*l,L=t+T,O=t-T,z=i+D,V=i-D;e[h++]=L,e[h++]=z,e[--d]=z,e[--d]=O,e[p++]=O,e[p++]=V,e[--v]=V,e[--v]=L}{const w=n,_=s+l,T=t+w,D=t-w,L=i+_,O=i-_;e[h++]=T,e[h++]=L,e[--v]=O,e[--v]=T,n&&(e[h++]=D,e[h++]=L,e[--v]=O,e[--v]=D)}},triangulate(r,e){const t=r.points,i=e.points,n=e.indices;if(t.length===0)return;let s=i.length/2;const a=s;let l,o;if(r.type!==Jt.RREC){const h=r.shape;l=h.x,o=h.y}else{const h=r.shape;l=h.x+h.width/2,o=h.y+h.height/2}const u=r.matrix;i.push(r.matrix?u.a*l+u.c*o+u.tx:l,r.matrix?u.b*l+u.d*o+u.ty:o),s++,i.push(t[0],t[1]);for(let h=2;h<t.length;h+=2)i.push(t[h],t[h+1]),n.push(s++,a,s);n.push(a+1,a,s)}};function Dg(r,e=!1){const t=r.length;if(t<6)return;let i=0;for(let n=0,s=r[t-2],a=r[t-1];n<t;n+=2){const l=r[n],o=r[n+1];i+=(l-s)*(o+a),s=l,a=o}if(!e&&i>0||e&&i<=0){const n=t/2;for(let s=n+n%2;s<t;s+=2){const a=t-s-2,l=t-s-1,o=s,u=s+1;[r[a],r[o]]=[r[o],r[a]],[r[l],r[u]]=[r[u],r[l]]}}}const qy={build(r){r.points=r.shape.points.slice()},triangulate(r,e){let t=r.points;const i=r.holes,n=e.points,s=e.indices;if(t.length>=6){Dg(t,!1);const a=[];for(let u=0;u<i.length;u++){const h=i[u];Dg(h.points,!0),a.push(t.length/2),t=t.concat(h.points)}const l=Em(t,a,2);if(!l)return;const o=n.length/2;for(let u=0;u<l.length;u+=3)s.push(l[u]+o),s.push(l[u+1]+o),s.push(l[u+2]+o);for(let u=0;u<t.length;u++)n.push(t[u])}}},NT={build(r){const e=r.shape,t=e.x,i=e.y,n=e.width,s=e.height,a=r.points;a.length=0,n>=0&&s>=0&&a.push(t,i,t+n,i,t+n,i+s,t,i+s)},triangulate(r,e){const t=r.points,i=e.points;if(t.length===0)return;const n=i.length/2;i.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},GT={build(r){$o.build(r)},triangulate(r,e){$o.triangulate(r,e)}};var fn=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))(fn||{}),mr=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(mr||{});const Qs={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,e=20){if(!this.adaptive||!r||isNaN(r))return e;let t=Math.ceil(r/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class Fg{static curveTo(e,t,i,n,s,a){const l=a[a.length-2],u=a[a.length-1]-t,h=l-e,d=n-t,p=i-e,v=Math.abs(u*p-h*d);if(v<1e-8||s===0)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;const w=u*u+h*h,_=d*d+p*p,T=u*d+h*p,D=s*Math.sqrt(w)/v,L=s*Math.sqrt(_)/v,O=D*T/w,z=L*T/_,V=D*p+L*h,Q=D*d+L*u,S=h*(L+O),Z=u*(L+O),re=p*(D+z),me=d*(D+z),le=Math.atan2(Z-Q,S-V),oe=Math.atan2(me-Q,re-V);return{cx:V+e,cy:Q+t,radius:s,startAngle:le,endAngle:oe,anticlockwise:h*d>p*u}}static arc(e,t,i,n,s,a,l,o,u){const h=l-a,d=Qs._segmentsCount(Math.abs(h)*s,Math.ceil(Math.abs(h)/sl)*40),p=h/(d*2),v=p*2,w=Math.cos(p),_=Math.sin(p),T=d-1,D=T%1/T;for(let L=0;L<=T;++L){const O=L+D*L,z=p+a+v*O,V=Math.cos(z),Q=-Math.sin(z);u.push((w*V+_*Q)*s+i,(w*-Q+_*V)*s+n)}}}class WT{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class af{static curveLength(e,t,i,n,s,a,l,o){let h=0,d=0,p=0,v=0,w=0,_=0,T=0,D=0,L=0,O=0,z=0,V=e,Q=t;for(let S=1;S<=10;++S)d=S/10,p=d*d,v=p*d,w=1-d,_=w*w,T=_*w,D=T*e+3*_*d*i+3*w*p*s+v*l,L=T*t+3*_*d*n+3*w*p*a+v*o,O=V-D,z=Q-L,V=D,Q=L,h+=Math.sqrt(O*O+z*z);return h}static curveTo(e,t,i,n,s,a,l){const o=l[l.length-2],u=l[l.length-1];l.length-=2;const h=Qs._segmentsCount(af.curveLength(o,u,e,t,i,n,s,a));let d=0,p=0,v=0,w=0,_=0;l.push(o,u);for(let T=1,D=0;T<=h;++T)D=T/h,d=1-D,p=d*d,v=p*d,w=D*D,_=w*D,l.push(v*o+3*p*D*e+3*d*w*i+_*s,v*u+3*p*D*t+3*d*w*n+_*a)}}function Rg(r,e,t,i,n,s,a,l){const o=r-t*n,u=e-i*n,h=r+t*s,d=e+i*s;let p,v;a?(p=i,v=-t):(p=-i,v=t);const w=o+p,_=u+v,T=h+p,D=d+v;return l.push(w,_,T,D),2}function zr(r,e,t,i,n,s,a,l){const o=t-r,u=i-e;let h=Math.atan2(o,u),d=Math.atan2(n-r,s-e);l&&h<d?h+=Math.PI*2:!l&&h>d&&(d+=Math.PI*2);let p=h;const v=d-h,w=Math.abs(v),_=Math.sqrt(o*o+u*u),T=(15*w*Math.sqrt(_)/Math.PI>>0)+1,D=v/T;if(p+=D,l){a.push(r,e,t,i);for(let L=1,O=p;L<T;L++,O+=D)a.push(r,e,r+Math.sin(O)*_,e+Math.cos(O)*_);a.push(r,e,n,s)}else{a.push(t,i,r,e);for(let L=1,O=p;L<T;L++,O+=D)a.push(r+Math.sin(O)*_,e+Math.cos(O)*_,r,e);a.push(n,s,r,e)}return T*2}function HT(r,e){const t=r.shape;let i=r.points||t.points.slice();const n=e.closePointEps;if(i.length===0)return;const s=r.lineStyle,a=new xe(i[0],i[1]),l=new xe(i[i.length-2],i[i.length-1]),o=t.type!==Jt.POLY||t.closeStroke,u=Math.abs(a.x-l.x)<n&&Math.abs(a.y-l.y)<n;if(o){i=i.slice(),u&&(i.pop(),i.pop(),l.set(i[i.length-2],i[i.length-1]));const de=(a.x+l.x)*.5,De=(l.y+a.y)*.5;i.unshift(de,De),i.push(de,De)}const h=e.points,d=i.length/2;let p=i.length;const v=h.length/2,w=s.width/2,_=w*w,T=s.miterLimit*s.miterLimit;let D=i[0],L=i[1],O=i[2],z=i[3],V=0,Q=0,S=-(L-z),Z=D-O,re=0,me=0,le=Math.sqrt(S*S+Z*Z);S/=le,Z/=le,S*=w,Z*=w;const oe=s.alignment,X=(1-oe)*2,K=oe*2;o||(s.cap===mr.ROUND?p+=zr(D-S*(X-K)*.5,L-Z*(X-K)*.5,D-S*X,L-Z*X,D+S*K,L+Z*K,h,!0)+2:s.cap===mr.SQUARE&&(p+=Rg(D,L,S,Z,X,K,!0,h))),h.push(D-S*X,L-Z*X,D+S*K,L+Z*K);for(let de=1;de<d-1;++de){D=i[(de-1)*2],L=i[(de-1)*2+1],O=i[de*2],z=i[de*2+1],V=i[(de+1)*2],Q=i[(de+1)*2+1],S=-(L-z),Z=D-O,le=Math.sqrt(S*S+Z*Z),S/=le,Z/=le,S*=w,Z*=w,re=-(z-Q),me=O-V,le=Math.sqrt(re*re+me*me),re/=le,me/=le,re*=w,me*=w;const De=O-D,Ve=L-z,ae=O-V,Ie=Q-z,Xe=De*ae+Ve*Ie,Je=Ve*ae-Ie*De,Ze=Je<0;if(Math.abs(Je)<.001*Math.abs(Xe)){h.push(O-S*X,z-Z*X,O+S*K,z+Z*K),Xe>=0&&(s.join===fn.ROUND?p+=zr(O,z,O-S*X,z-Z*X,O-re*X,z-me*X,h,!1)+4:p+=2,h.push(O-re*K,z-me*K,O+re*X,z+me*X));continue}const pt=(-S+D)*(-Z+z)-(-S+O)*(-Z+L),mt=(-re+V)*(-me+z)-(-re+O)*(-me+Q),vt=(De*mt-ae*pt)/Je,zt=(Ie*pt-Ve*mt)/Je,Kt=(vt-O)*(vt-O)+(zt-z)*(zt-z),ht=O+(vt-O)*X,st=z+(zt-z)*X,dt=O-(vt-O)*K,yt=z-(zt-z)*K,di=Math.min(De*De+Ve*Ve,ae*ae+Ie*Ie),Me=Ze?X:K,ei=di+Me*Me*_,lr=Kt<=ei;let wi=s.join;if(wi===fn.MITER&&Kt/_>T&&(wi=fn.BEVEL),lr)switch(wi){case fn.MITER:{h.push(ht,st,dt,yt);break}case fn.BEVEL:{Ze?h.push(ht,st,O+S*K,z+Z*K,ht,st,O+re*K,z+me*K):h.push(O-S*X,z-Z*X,dt,yt,O-re*X,z-me*X,dt,yt),p+=2;break}case fn.ROUND:{Ze?(h.push(ht,st,O+S*K,z+Z*K),p+=zr(O,z,O+S*K,z+Z*K,O+re*K,z+me*K,h,!0)+4,h.push(ht,st,O+re*K,z+me*K)):(h.push(O-S*X,z-Z*X,dt,yt),p+=zr(O,z,O-S*X,z-Z*X,O-re*X,z-me*X,h,!1)+4,h.push(O-re*X,z-me*X,dt,yt));break}}else{switch(h.push(O-S*X,z-Z*X,O+S*K,z+Z*K),wi){case fn.MITER:{Ze?h.push(dt,yt,dt,yt):h.push(ht,st,ht,st),p+=2;break}case fn.ROUND:{Ze?p+=zr(O,z,O+S*K,z+Z*K,O+re*K,z+me*K,h,!0)+2:p+=zr(O,z,O-S*X,z-Z*X,O-re*X,z-me*X,h,!1)+2;break}}h.push(O-re*X,z-me*X,O+re*K,z+me*K),p+=2}}D=i[(d-2)*2],L=i[(d-2)*2+1],O=i[(d-1)*2],z=i[(d-1)*2+1],S=-(L-z),Z=D-O,le=Math.sqrt(S*S+Z*Z),S/=le,Z/=le,S*=w,Z*=w,h.push(O-S*X,z-Z*X,O+S*K,z+Z*K),o||(s.cap===mr.ROUND?p+=zr(O-S*(X-K)*.5,z-Z*(X-K)*.5,O-S*X,z-Z*X,O+S*K,z+Z*K,h,!1)+2:s.cap===mr.SQUARE&&(p+=Rg(O,z,S,Z,X,K,!1,h)));const _e=e.indices,Se=Qs.epsilon*Qs.epsilon;for(let de=v;de<p+v-2;++de)D=h[de*2],L=h[de*2+1],O=h[(de+1)*2],z=h[(de+1)*2+1],V=h[(de+2)*2],Q=h[(de+2)*2+1],!(Math.abs(D*(z-Q)+O*(Q-L)+V*(L-z))<Se)&&_e.push(de,de+1,de+2)}function UT(r,e){let t=0;const i=r.shape,n=r.points||i.points,s=i.type!==Jt.POLY||i.closeStroke;if(n.length===0)return;const a=e.points,l=e.indices,o=n.length/2,u=a.length/2;let h=u;for(a.push(n[0],n[1]),t=1;t<o;t++)a.push(n[t*2],n[t*2+1]),l.push(h,h+1),h++;s&&l.push(h,u)}function Og(r,e){r.lineStyle.native?UT(r,e):HT(r,e)}class lf{static curveLength(e,t,i,n,s,a){const l=e-2*i+s,o=t-2*n+a,u=2*i-2*e,h=2*n-2*t,d=4*(l*l+o*o),p=4*(l*u+o*h),v=u*u+h*h,w=2*Math.sqrt(d+p+v),_=Math.sqrt(d),T=2*d*_,D=2*Math.sqrt(v),L=p/_;return(T*w+_*p*(w-D)+(4*v*d-p*p)*Math.log((2*_+L+w)/(L+D)))/(4*T)}static curveTo(e,t,i,n,s){const a=s[s.length-2],l=s[s.length-1],o=Qs._segmentsCount(lf.curveLength(a,l,e,t,i,n));let u=0,h=0;for(let d=1;d<=o;++d){const p=d/o;u=a+(e-a)*p,h=l+(t-l)*p,s.push(u+(e+(i-e)*p-u)*p,h+(t+(n-t)*p-h)*p)}}}const Xh={[Jt.POLY]:qy,[Jt.CIRC]:$o,[Jt.ELIP]:$o,[Jt.RECT]:NT,[Jt.RREC]:GT},Lg=[],to=[];class Xo{constructor(e,t=null,i=null,n=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=n,this.type=e.type}clone(){return new Xo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Cs=new xe,Yy=class extends xu{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Wo,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),to.push(this.drawCalls[r]);this.drawCalls.length=0;for(let r=0;r<this.batches.length;r++){const e=this.batches[r];e.reset(),Lg.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(r,e=null,t=null,i=null){const n=new Xo(r,e,t,i);return this.graphicsData.push(n),this.dirty++,this}drawHole(r,e=null){if(!this.graphicsData.length)return null;const t=new Xo(r,null,null,e),i=this.graphicsData[this.graphicsData.length-1];return t.lineStyle=i.lineStyle,i.holes.push(t),this.dirty++,this}destroy(){super.destroy();for(let r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(r){const e=this.graphicsData;for(let t=0;t<e.length;++t){const i=e[t];if(i.fillStyle.visible&&i.shape&&(i.matrix?i.matrix.applyInverse(r,Cs):Cs.copyFrom(r),i.shape.contains(Cs.x,Cs.y))){let n=!1;if(i.holes){for(let s=0;s<i.holes.length;s++)if(i.holes[s].shape.contains(Cs.x,Cs.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const r=this.uvs,e=this.graphicsData;let t=null,i=null;this.batches.length>0&&(t=this.batches[this.batches.length-1],i=t.style);for(let l=this.shapeIndex;l<e.length;l++){this.shapeIndex++;const o=e[l],u=o.fillStyle,h=o.lineStyle;Xh[o.type].build(o),o.matrix&&this.transformPoints(o.points,o.matrix),(u.visible||h.visible)&&this.processHoles(o.holes);for(let p=0;p<2;p++){const v=p===0?u:h;if(!v.visible)continue;const w=v.texture.baseTexture,_=this.indices.length,T=this.points.length/2;w.wrapMode=gi.REPEAT,p===0?this.processFill(o):this.processLine(o);const D=this.points.length/2-T;D!==0&&(t&&!this._compareStyles(i,v)&&(t.end(_,T),t=null),t||(t=Lg.pop()||new WT,t.begin(v,_,T),this.batches.push(t),i=v),this.addUvs(this.points,r,v.texture,T,D,v.matrix))}}const n=this.indices.length,s=this.points.length/2;if(t&&t.end(n,s),this.batches.length===0){this.batchable=!0;return}const a=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(r,e){return!(!r||!e||r.texture.baseTexture!==e.texture.baseTexture||r.color+r.alpha!==e.color+e.alpha||!!r.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let r=0,e=this.graphicsData.length;r<e;r++){const t=this.graphicsData[r],i=t.fillStyle,n=t.lineStyle;if(i&&!i.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const r=this.batches;for(let e=0,t=r.length;e<t;e++){const i=r[e];for(let n=0;n<i.size;n++){const s=i.start+n;this.indicesUint16[s]=this.indicesUint16[s]-i.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const r=this.batches;for(let e=0;e<r.length;e++)if(r[e].style.native)return!1;return this.points.length<Yy.BATCHABLE_SIZE*2}buildDrawCalls(){let r=++Be._globalBatch;for(let h=0;h<this.drawCalls.length;h++)this.drawCalls[h].texArray.clear(),to.push(this.drawCalls[h]);this.drawCalls.length=0;const e=this.colors,t=this.textureIds;let i=to.pop();i||(i=new jo,i.texArray=new No),i.texArray.count=0,i.start=0,i.size=0,i.type=Bi.TRIANGLES;let n=0,s=null,a=0,l=!1,o=Bi.TRIANGLES,u=0;this.drawCalls.push(i);for(let h=0;h<this.batches.length;h++){const d=this.batches[h],p=8,v=d.style,w=v.texture.baseTexture;l!==!!v.native&&(l=!!v.native,o=l?Bi.LINES:Bi.TRIANGLES,s=null,n=p,r++),s!==w&&(s=w,w._batchEnabled!==r&&(n===p&&(r++,n=0,i.size>0&&(i=to.pop(),i||(i=new jo,i.texArray=new No),this.drawCalls.push(i)),i.start=u,i.size=0,i.texArray.count=0,i.type=o),w.touched=1,w._batchEnabled=r,w._batchLocation=n,w.wrapMode=gi.REPEAT,i.texArray.elements[i.texArray.count++]=w,n++)),i.size+=d.size,u+=d.size,a=w._batchLocation,this.addColors(e,v.color,v.alpha,d.attribSize,d.attribStart),this.addTextureIds(t,a,d.attribSize,d.attribStart)}Be._globalBatch=r,this.packAttributes()}packAttributes(){const r=this.points,e=this.uvs,t=this.colors,i=this.textureIds,n=new ArrayBuffer(r.length*3*4),s=new Float32Array(n),a=new Uint32Array(n);let l=0;for(let o=0;o<r.length/2;o++)s[l++]=r[o*2],s[l++]=r[o*2+1],s[l++]=e[o*2],s[l++]=e[o*2+1],a[l++]=t[o],s[l++]=i[o];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(r){r.holes.length?qy.triangulate(r,this):Xh[r.type].triangulate(r,this)}processLine(r){Og(r,this);for(let e=0;e<r.holes.length;e++)Og(r.holes[e],this)}processHoles(r){for(let e=0;e<r.length;e++){const t=r[e];Xh[t.type].build(t),t.matrix&&this.transformPoints(t.points,t.matrix)}}calculateBounds(){const r=this._bounds;r.clear(),r.addVertexData(this.points,0,this.points.length),r.pad(this.boundsPadding,this.boundsPadding)}transformPoints(r,e){for(let t=0;t<r.length/2;t++){const i=r[t*2],n=r[t*2+1];r[t*2]=e.a*i+e.c*n+e.tx,r[t*2+1]=e.b*i+e.d*n+e.ty}}addColors(r,e,t,i,n=0){const s=lt.shared.setValue(e).toLittleEndianNumber(),a=lt.shared.setValue(s).toPremultiplied(t);r.length=Math.max(r.length,n+i);for(let l=0;l<i;l++)r[n+l]=a}addTextureIds(r,e,t,i=0){r.length=Math.max(r.length,i+t);for(let n=0;n<t;n++)r[i+n]=e}addUvs(r,e,t,i,n,s=null){let a=0;const l=e.length,o=t.frame;for(;a<n;){let h=r[(i+a)*2],d=r[(i+a)*2+1];if(s){const p=s.a*h+s.c*d+s.tx;d=s.b*h+s.d*d+s.ty,h=p}a++,e.push(h/o.width,d/o.height)}const u=t.baseTexture;(o.width<u.width||o.height<u.height)&&this.adjustUvs(e,t,l,n)}adjustUvs(r,e,t,i){const n=e.baseTexture,s=1e-6,a=t+i*2,l=e.frame,o=l.width/n.width,u=l.height/n.height;let h=l.x/l.width,d=l.y/l.height,p=Math.floor(r[t]+s),v=Math.floor(r[t+1]+s);for(let w=t+2;w<a;w+=2)p=Math.min(p,Math.floor(r[w]+s)),v=Math.min(v,Math.floor(r[w+1]+s));h-=p,d-=v;for(let w=t;w<a;w+=2)r[w]=(r[w]+h)*o,r[w+1]=(r[w+1]+d)*u}};let Zy=Yy;Zy.BATCHABLE_SIZE=100;class Eu{constructor(){this.color=16777215,this.alpha=1,this.texture=ye.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Eu;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=ye.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class of extends Eu{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=mr.BUTT,this.join=fn.MITER,this.miterLimit=10}clone(){const e=new of;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const Kh={},yo=class extends Rt{constructor(r=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Eu,this._lineStyle=new of,this._matrix=null,this._holeMode=!1,this.state=Vi.for2d(),this._geometry=r||new Zy,this._geometry.refCount++,this._transformID=-1,this._tintColor=new lt(16777215),this.blendMode=Le.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new yo(this._geometry)}set blendMode(r){this.state.blendMode=r}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(r){this._tintColor.setValue(r)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(r=null,e=0,t,i=.5,n=!1){return typeof r=="number"&&(r={width:r,color:e,alpha:t,alignment:i,native:n}),this.lineTextureStyle(r)}lineTextureStyle(r){const e={width:0,texture:ye.WHITE,color:r!=null&&r.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:mr.BUTT,join:fn.MITER,miterLimit:10};r=Object.assign(e,r),this.normalizeColor(r),this.currentPath&&this.startPoly();const t=r.width>0&&r.alpha>0;return t?(r.matrix&&(r.matrix=r.matrix.clone(),r.matrix.invert()),Object.assign(this._lineStyle,{visible:t},r)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const r=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new is,this.currentPath.closeStroke=!1,this.currentPath.points.push(r[e-2],r[e-1]))}else this.currentPath=new is,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(r,e){return this.startPoly(),this.currentPath.points[0]=r,this.currentPath.points[1]=e,this}lineTo(r,e){this.currentPath||this.moveTo(0,0);const t=this.currentPath.points,i=t[t.length-2],n=t[t.length-1];return(i!==r||n!==e)&&t.push(r,e),this}_initCurve(r=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[r,e]):this.moveTo(r,e)}quadraticCurveTo(r,e,t,i){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),lf.curveTo(r,e,t,i,n),this}bezierCurveTo(r,e,t,i,n,s){return this._initCurve(),af.curveTo(r,e,t,i,n,s,this.currentPath.points),this}arcTo(r,e,t,i,n){this._initCurve(r,e);const s=this.currentPath.points,a=Fg.curveTo(r,e,t,i,n,s);if(a){const{cx:l,cy:o,radius:u,startAngle:h,endAngle:d,anticlockwise:p}=a;this.arc(l,o,u,h,d,p)}return this}arc(r,e,t,i,n,s=!1){if(i===n)return this;if(!s&&n<=i?n+=sl:s&&i<=n&&(i+=sl),n-i===0)return this;const l=r+Math.cos(i)*t,o=e+Math.sin(i)*t,u=this._geometry.closePointEps;let h=this.currentPath?this.currentPath.points:null;if(h){const d=Math.abs(h[h.length-2]-l),p=Math.abs(h[h.length-1]-o);d<u&&p<u||h.push(l,o)}else this.moveTo(l,o),h=this.currentPath.points;return Fg.arc(l,o,r,e,t,i,n,s,h),this}beginFill(r=0,e){return this.beginTextureFill({texture:ye.WHITE,color:r,alpha:e})}normalizeColor(r){const e=lt.shared.setValue(r.color??0);r.color=e.toNumber(),r.alpha??(r.alpha=e.alpha)}beginTextureFill(r){const e={texture:ye.WHITE,color:16777215,matrix:null};r=Object.assign(e,r),this.normalizeColor(r),this.currentPath&&this.startPoly();const t=r.alpha>0;return t?(r.matrix&&(r.matrix=r.matrix.clone(),r.matrix.invert()),Object.assign(this._fillStyle,{visible:t},r)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(r,e,t,i){return this.drawShape(new Ke(r,e,t,i))}drawRoundedRect(r,e,t,i,n){return this.drawShape(new ku(r,e,t,i,n))}drawCircle(r,e,t){return this.drawShape(new Su(r,e,t))}drawEllipse(r,e,t,i){return this.drawShape(new _u(r,e,t,i))}drawPolygon(...r){let e,t=!0;const i=r[0];i.points?(t=i.closeStroke,e=i.points):Array.isArray(r[0])?e=r[0]:e=r;const n=new is(e);return n.closeStroke=t,this.drawShape(n),this}drawShape(r){return this._holeMode?this._geometry.drawHole(r,this._matrix):this._geometry.drawShape(r,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const r=this._geometry.graphicsData;return r.length===1&&r[0].shape.type===Jt.RECT&&!r[0].matrix&&!r[0].holes.length&&!(r[0].lineStyle.visible&&r[0].lineStyle.width)}_render(r){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(r)):(r.batch.flush(),this._renderDirect(r))}_populateBatches(){const r=this._geometry,e=this.blendMode,t=r.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=r.batchDirty,this.batches.length=t,this.vertexData=new Float32Array(r.points);for(let i=0;i<t;i++){const n=r.batches[i],s=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),l=new Float32Array(r.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),o=new Uint16Array(r.indicesUint16.buffer,n.start*2,n.size),u={vertexData:a,blendMode:e,indices:o,uvs:l,_batchRGB:lt.shared.setValue(s).toRgbArray(),_tintRGB:s,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[i]=u}}_renderBatched(r){if(this.batches.length){r.batch.setObjectRenderer(r.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,t=this.batches.length;e<t;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,r.plugins[this.pluginName].render(i)}}}_renderDirect(r){const e=this._resolveDirectShader(r),t=this._geometry,i=this.worldAlpha,n=e.uniforms,s=t.drawCalls;n.translationMatrix=this.transform.worldTransform,lt.shared.setValue(this._tintColor).multiply([i,i,i]).setAlpha(i).toArray(n.tint),r.shader.bind(e),r.geometry.bind(t,e),r.state.set(this.state);for(let a=0,l=s.length;a<l;a++)this._renderDrawCallDirect(r,t.drawCalls[a])}_renderDrawCallDirect(r,e){const{texArray:t,type:i,size:n,start:s}=e,a=t.count;for(let l=0;l<a;l++)r.texture.bind(t.elements[l],l);r.geometry.draw(i,n,s)}_resolveDirectShader(r){let e=this.shader;const t=this.pluginName;if(!e){if(!Kh[t]){const{maxTextures:i}=r.plugins[t],n=new Int32Array(i);for(let l=0;l<i;l++)n[l]=l;const s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ye,default:nn.from({uSamplers:n},!0)},a=r.plugins[t]._shader.program;Kh[t]=new Ln(a,s)}e=Kh[t]}return e}_calculateBounds(){this.finishPoly();const r=this._geometry;if(!r.graphicsData.length)return;const{minX:e,minY:t,maxX:i,maxY:n}=r.bounds;this._bounds.addFrame(this.transform,e,t,i,n)}containsPoint(r){return this.worldTransform.applyInverse(r,yo._TEMP_POINT),this._geometry.containsPoint(yo._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let r=0;r<this.batches.length;r++){const e=this.batches[r];e._tintRGB=lt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const r=this.transform._worldID;if(this._transformID===r)return;this._transformID=r;const e=this.transform.worldTransform,t=e.a,i=e.b,n=e.c,s=e.d,a=e.tx,l=e.ty,o=this._geometry.points,u=this.vertexData;let h=0;for(let d=0;d<o.length;d+=2){const p=o[d],v=o[d+1];u[h++]=t*p+n*v+a,u[h++]=s*v+i*p+l}}closePath(){const r=this.currentPath;return r&&(r.closeStroke=!0,this.finishPoly()),this}setMatrix(r){return this._matrix=r,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(r){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(r)}};let gt=yo;gt.curves=Qs;gt._TEMP_POINT=new xe;class VT{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const qh=new xe,Bg=new is,Jy=class extends Rt{constructor(r,e,t,i=Bi.TRIANGLES){super(),this.geometry=r,this.shader=e,this.state=t||Vi.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ge.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(r){this._geometry!==r&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=r,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(r){this.shader=r}get material(){return this.shader}set blendMode(r){this.state.blendMode=r}get blendMode(){return this.state.blendMode}set roundPixels(r){this._roundPixels!==r&&(this._transformID=-1),this._roundPixels=r}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(r){this.shader.tint=r}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(r){this.shader.texture=r}_render(r){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Bi.TRIANGLES&&e.length<Jy.BATCHABLE_SIZE*2?this._renderToBatch(r):this._renderDefault(r)}_renderDefault(r){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),r.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),r.shader.bind(e),r.state.set(this.state),r.geometry.bind(this.geometry,e),r.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(r){const e=this.geometry,t=this.shader;t.uvMatrix&&(t.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=t._tintRGB,this._texture=t.texture;const i=this.material.pluginName;r.batch.setObjectRenderer(r.plugins[i]),r.plugins[i].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const n=this.transform.worldTransform,s=n.a,a=n.b,l=n.c,o=n.d,u=n.tx,h=n.ty,d=this.vertexData;for(let p=0;p<d.length/2;p++){const v=t[p*2],w=t[p*2+1];d[p*2]=s*v+l*w+u,d[p*2+1]=a*v+o*w+h}if(this._roundPixels){const p=ge.RESOLUTION;for(let v=0;v<d.length;++v)d[v]=Math.round(d[v]*p)/p}this.vertexDirty=i}calculateUvs(){const r=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=r.data:(this.batchUvs||(this.batchUvs=new VT(r,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(r){if(!this.getBounds().contains(r.x,r.y))return!1;this.worldTransform.applyInverse(r,qh);const e=this.geometry.getBuffer("aVertexPosition").data,t=Bg.points,i=this.geometry.getIndex().data,n=i.length,s=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=s){const l=i[a]*2,o=i[a+1]*2,u=i[a+2]*2;if(t[0]=e[l],t[1]=e[l+1],t[2]=e[o],t[3]=e[o+1],t[4]=e[u],t[5]=e[u+1],Bg.contains(qh.x,qh.y))return!0}return!1}destroy(r){super.destroy(r),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let jd=Jy;jd.BATCHABLE_SIZE=100;class $T extends wn{constructor(e,t,i){super();const n=new Fe(e),s=new Fe(t,!0),a=new Fe(i,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,ke.FLOAT).addAttribute("aTextureCoord",s,2,!1,ke.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var XT=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,KT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class zg extends Ln{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:Ye.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(i,t.uniforms),super(t.program||si.from(KT,XT),i),this._colorDirty=!1,this.uvMatrix=new Tu(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new lt(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;lt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class jg{constructor(e,t,i){this.geometry=new wn,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<e.length;++n){let s=e[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||ke.FLOAT,offset:s.offset},t[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new Fe(hy(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const l=this.dynamicProperties[a];l.offset=t,t+=l.size,this.dynamicStride+=l.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Fe(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const l=this.staticProperties[a];l.offset=n,n+=l.size,this.staticStride+=l.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new Fe(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const l=this.dynamicProperties[a];e.addAttribute(l.attributeName,this.dynamicBuffer,0,l.type===ke.UNSIGNED_BYTE,l.type,this.dynamicStride*4,l.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const l=this.staticProperties[a];e.addAttribute(l.attributeName,this.staticBuffer,0,l.type===ke.UNSIGNED_BYTE,l.type,this.staticStride*4,l.offset*4)}}uploadDynamic(e,t,i){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(e,t,i,s.type===ke.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(e,t,i,s.type===ke.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var qT=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,YT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Qy extends ra{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Ye,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ke.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Ln.from(YT,qT,{}),this.state=Vi.for2d()}render(e){const t=e.children,i=e._maxSize,n=e._batchSize,s=this.renderer;let a=t.length;if(a===0)return;a>i&&!e.autoResize&&(a=i);let l=e._buffers;l||(l=e._buffers=this.generateBuffers(e));const o=t[0]._texture.baseTexture,u=o.alphaMode>0;this.state.blendMode=Ec(e.blendMode,u),s.state.set(this.state);const h=s.gl,d=e.worldTransform.copyTo(this.tempMatrix);d.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=d.toArray(!0),this.shader.uniforms.uColor=lt.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,u).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);let p=!1;for(let v=0,w=0;v<a;v+=n,w+=1){let _=a-v;_>n&&(_=n),w>=l.length&&l.push(this._generateOneMoreBuffer(e));const T=l[w];T.uploadDynamic(t,v,_);const D=e._bufferUpdateIDs[w]||0;p=p||T._updateID<D,p&&(T._updateID=e._updateID,T.uploadStatic(t,v,_)),s.geometry.bind(T.geometry),h.drawElements(h.TRIANGLES,_*6,h.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,n=e._batchSize,s=e._properties;for(let a=0;a<i;a+=n)t.push(new jg(this.properties,s,n));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new jg(this.properties,i,t)}uploadVertices(e,t,i,n,s,a){let l=0,o=0,u=0,h=0;for(let d=0;d<i;++d){const p=e[t+d],v=p._texture,w=p.scale.x,_=p.scale.y,T=v.trim,D=v.orig;T?(o=T.x-p.anchor.x*D.width,l=o+T.width,h=T.y-p.anchor.y*D.height,u=h+T.height):(l=D.width*(1-p.anchor.x),o=D.width*-p.anchor.x,u=D.height*(1-p.anchor.y),h=D.height*-p.anchor.y),n[a]=o*w,n[a+1]=h*_,n[a+s]=l*w,n[a+s+1]=h*_,n[a+s*2]=l*w,n[a+s*2+1]=u*_,n[a+s*3]=o*w,n[a+s*3+1]=u*_,a+=s*4}}uploadPosition(e,t,i,n,s,a){for(let l=0;l<i;l++){const o=e[t+l].position;n[a]=o.x,n[a+1]=o.y,n[a+s]=o.x,n[a+s+1]=o.y,n[a+s*2]=o.x,n[a+s*2+1]=o.y,n[a+s*3]=o.x,n[a+s*3+1]=o.y,a+=s*4}}uploadRotation(e,t,i,n,s,a){for(let l=0;l<i;l++){const o=e[t+l].rotation;n[a]=o,n[a+s]=o,n[a+s*2]=o,n[a+s*3]=o,a+=s*4}}uploadUvs(e,t,i,n,s,a){for(let l=0;l<i;++l){const o=e[t+l]._texture._uvs;o?(n[a]=o.x0,n[a+1]=o.y0,n[a+s]=o.x1,n[a+s+1]=o.y1,n[a+s*2]=o.x2,n[a+s*2+1]=o.y2,n[a+s*3]=o.x3,n[a+s*3+1]=o.y3,a+=s*4):(n[a]=0,n[a+1]=0,n[a+s]=0,n[a+s+1]=0,n[a+s*2]=0,n[a+s*2+1]=0,n[a+s*3]=0,n[a+s*3+1]=0,a+=s*4)}}uploadTint(e,t,i,n,s,a){for(let l=0;l<i;++l){const o=e[t+l],u=lt.shared.setValue(o._tintRGB).toPremultiplied(o.alpha);n[a]=u,n[a+s]=u,n[a+s*2]=u,n[a+s*3]=u,a+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Qy.extension={name:"particle",type:be.RendererPlugin};Ae.add(Qy);var Pu=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Pu||{});const io={willReadFrequently:!0},Ce=class{static get experimentalLetterSpacingSupported(){let r=Ce._experimentalLetterSpacingSupported;if(r!==void 0){const e=ge.ADAPTER.getCanvasRenderingContext2D().prototype;r=Ce._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return r}constructor(r,e,t,i,n,s,a,l,o){this.text=r,this.style=e,this.width=t,this.height=i,this.lines=n,this.lineWidths=s,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=o}static measureText(r,e,t,i=Ce._canvas){t=t??e.wordWrap;const n=e.toFontString(),s=Ce.measureFont(n);s.fontSize===0&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const a=i.getContext("2d",io);a.font=n;const o=(t?Ce.wordWrap(r,e,i):r).split(/(?:\r\n|\r|\n)/),u=new Array(o.length);let h=0;for(let w=0;w<o.length;w++){const _=Ce._measureText(o[w],e.letterSpacing,a);u[w]=_,h=Math.max(h,_)}let d=h+e.strokeThickness;e.dropShadow&&(d+=e.dropShadowDistance);const p=e.lineHeight||s.fontSize+e.strokeThickness;let v=Math.max(p,s.fontSize+e.strokeThickness*2)+(o.length-1)*(p+e.leading);return e.dropShadow&&(v+=e.dropShadowDistance),new Ce(r,e,d,v,o,u,p+e.leading,h,s)}static _measureText(r,e,t){let i=!1;Ce.experimentalLetterSpacingSupported&&(Ce.experimentalLetterSpacing?(t.letterSpacing=`${e}px`,t.textLetterSpacing=`${e}px`,i=!0):(t.letterSpacing="0px",t.textLetterSpacing="0px"));let n=t.measureText(r).width;return n>0&&(i?n-=e:n+=(Ce.graphemeSegmenter(r).length-1)*e),n}static wordWrap(r,e,t=Ce._canvas){const i=t.getContext("2d",io);let n=0,s="",a="";const l=Object.create(null),{letterSpacing:o,whiteSpace:u}=e,h=Ce.collapseSpaces(u),d=Ce.collapseNewlines(u);let p=!h;const v=e.wordWrapWidth+o,w=Ce.tokenize(r);for(let _=0;_<w.length;_++){let T=w[_];if(Ce.isNewline(T)){if(!d){a+=Ce.addLine(s),p=!h,s="",n=0;continue}T=" "}if(h){const L=Ce.isBreakingSpace(T),O=Ce.isBreakingSpace(s[s.length-1]);if(L&&O)continue}const D=Ce.getFromCache(T,o,l,i);if(D>v)if(s!==""&&(a+=Ce.addLine(s),s="",n=0),Ce.canBreakWords(T,e.breakWords)){const L=Ce.wordWrapSplit(T);for(let O=0;O<L.length;O++){let z=L[O],V=z,Q=1;for(;L[O+Q];){const Z=L[O+Q];if(!Ce.canBreakChars(V,Z,T,O,e.breakWords))z+=Z;else break;V=Z,Q++}O+=Q-1;const S=Ce.getFromCache(z,o,l,i);S+n>v&&(a+=Ce.addLine(s),p=!1,s="",n=0),s+=z,n+=S}}else{s.length>0&&(a+=Ce.addLine(s),s="",n=0);const L=_===w.length-1;a+=Ce.addLine(T,!L),p=!1,s="",n=0}else D+n>v&&(p=!1,a+=Ce.addLine(s),s="",n=0),(s.length>0||!Ce.isBreakingSpace(T)||p)&&(s+=T,n+=D)}return a+=Ce.addLine(s,!1),a}static addLine(r,e=!0){return r=Ce.trimRight(r),r=e?`${r}
`:r,r}static getFromCache(r,e,t,i){let n=t[r];return typeof n!="number"&&(n=Ce._measureText(r,e,i)+e,t[r]=n),n}static collapseSpaces(r){return r==="normal"||r==="pre-line"}static collapseNewlines(r){return r==="normal"}static trimRight(r){if(typeof r!="string")return"";for(let e=r.length-1;e>=0;e--){const t=r[e];if(!Ce.isBreakingSpace(t))break;r=r.slice(0,-1)}return r}static isNewline(r){return typeof r!="string"?!1:Ce._newlines.includes(r.charCodeAt(0))}static isBreakingSpace(r,e){return typeof r!="string"?!1:Ce._breakingSpaces.includes(r.charCodeAt(0))}static tokenize(r){const e=[];let t="";if(typeof r!="string")return e;for(let i=0;i<r.length;i++){const n=r[i],s=r[i+1];if(Ce.isBreakingSpace(n,s)||Ce.isNewline(n)){t!==""&&(e.push(t),t=""),e.push(n);continue}t+=n}return t!==""&&e.push(t),e}static canBreakWords(r,e){return e}static canBreakChars(r,e,t,i,n){return!0}static wordWrapSplit(r){return Ce.graphemeSegmenter(r)}static measureFont(r){if(Ce._fonts[r])return Ce._fonts[r];const e={ascent:0,descent:0,fontSize:0},t=Ce._canvas,i=Ce._context;i.font=r;const n=Ce.METRICS_STRING+Ce.BASELINE_SYMBOL,s=Math.ceil(i.measureText(n).width);let a=Math.ceil(i.measureText(Ce.BASELINE_SYMBOL).width);const l=Math.ceil(Ce.HEIGHT_MULTIPLIER*a);if(a=a*Ce.BASELINE_MULTIPLIER|0,s===0||l===0)return Ce._fonts[r]=e,e;t.width=s,t.height=l,i.fillStyle="#f00",i.fillRect(0,0,s,l),i.font=r,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(n,0,a);const o=i.getImageData(0,0,s,l).data,u=o.length,h=s*4;let d=0,p=0,v=!1;for(d=0;d<a;++d){for(let w=0;w<h;w+=4)if(o[p+w]!==255){v=!0;break}if(!v)p+=h;else break}for(e.ascent=a-d,p=u-h,v=!1,d=l;d>a;--d){for(let w=0;w<h;w+=4)if(o[p+w]!==255){v=!0;break}if(!v)p-=h;else break}return e.descent=d-a,e.fontSize=e.ascent+e.descent,Ce._fonts[r]=e,e}static clearMetrics(r=""){r?delete Ce._fonts[r]:Ce._fonts={}}static get _canvas(){if(!Ce.__canvas){let r;try{const e=new OffscreenCanvas(0,0),t=e.getContext("2d",io);if(t!=null&&t.measureText)return Ce.__canvas=e,e;r=ge.ADAPTER.createCanvas()}catch{r=ge.ADAPTER.createCanvas()}r.width=r.height=10,Ce.__canvas=r}return Ce.__canvas}static get _context(){return Ce.__context||(Ce.__context=Ce._canvas.getContext("2d",io)),Ce.__context}};let Ct=Ce;Ct.METRICS_STRING="|ÉqÅ";Ct.BASELINE_SYMBOL="M";Ct.BASELINE_MULTIPLIER=1.4;Ct.HEIGHT_MULTIPLIER=2;Ct.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const r=new Intl.Segmenter;return e=>[...r.segment(e)].map(t=>t.segment)}return r=>[...r]})();Ct.experimentalLetterSpacing=!1;Ct._fonts={};Ct._newlines=[10,13];Ct._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const ZT=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ia=class{constructor(r){this.styleID=0,this.reset(),Zh(this,r,r)}clone(){const r={};return Zh(r,this,Ia.defaultStyle),new Ia(r)}reset(){Zh(this,Ia.defaultStyle,Ia.defaultStyle)}get align(){return this._align}set align(r){this._align!==r&&(this._align=r,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(r){this._breakWords!==r&&(this._breakWords=r,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(r){this._dropShadow!==r&&(this._dropShadow=r,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(r){this._dropShadowAlpha!==r&&(this._dropShadowAlpha=r,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(r){this._dropShadowAngle!==r&&(this._dropShadowAngle=r,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(r){this._dropShadowBlur!==r&&(this._dropShadowBlur=r,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(r){const e=Yh(r);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(r){this._dropShadowDistance!==r&&(this._dropShadowDistance=r,this.styleID++)}get fill(){return this._fill}set fill(r){const e=Yh(r);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(r){this._fillGradientType!==r&&(this._fillGradientType=r,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(r){JT(this._fillGradientStops,r)||(this._fillGradientStops=r,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(r){this.fontFamily!==r&&(this._fontFamily=r,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(r){this._fontSize!==r&&(this._fontSize=r,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(r){this._fontStyle!==r&&(this._fontStyle=r,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(r){this._fontVariant!==r&&(this._fontVariant=r,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(r){this._fontWeight!==r&&(this._fontWeight=r,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(r){this._letterSpacing!==r&&(this._letterSpacing=r,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(r){this._lineHeight!==r&&(this._lineHeight=r,this.styleID++)}get leading(){return this._leading}set leading(r){this._leading!==r&&(this._leading=r,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(r){this._lineJoin!==r&&(this._lineJoin=r,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(r){this._miterLimit!==r&&(this._miterLimit=r,this.styleID++)}get padding(){return this._padding}set padding(r){this._padding!==r&&(this._padding=r,this.styleID++)}get stroke(){return this._stroke}set stroke(r){const e=Yh(r);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(r){this._strokeThickness!==r&&(this._strokeThickness=r,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(r){this._textBaseline!==r&&(this._textBaseline=r,this.styleID++)}get trim(){return this._trim}set trim(r){this._trim!==r&&(this._trim=r,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(r){this._whiteSpace!==r&&(this._whiteSpace=r,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(r){this._wordWrap!==r&&(this._wordWrap=r,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(r){this._wordWrapWidth!==r&&(this._wordWrapWidth=r,this.styleID++)}toFontString(){const r=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!ZT.includes(i)&&(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${r} ${e.join(",")}`}};let Hi=Ia;Hi.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Pu.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function Yh(r){const e=lt.shared;return Array.isArray(r)?r.map(t=>e.setValue(t).toHex()):e.setValue(r).toHex()}function JT(r,e){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}function Zh(r,e,t){for(const i in t)Array.isArray(e[i])?r[i]=e[i].slice():r[i]=e[i]}const QT={texture:!0,children:!1,baseTexture:!0},Nd=class extends Wt{constructor(r,e,t){let i=!1;t||(t=ge.ADAPTER.createCanvas(),i=!0),t.width=3,t.height=3;const n=ye.from(t);n.orig=new Ke,n.trim=new Ke,super(n),this._ownCanvas=i,this.canvas=t,this.context=t.getContext("2d",{willReadFrequently:!0}),this._resolution=Nd.defaultResolution??ge.RESOLUTION,this._autoResolution=Nd.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=r,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return Ct.experimentalLetterSpacing}static set experimentalLetterSpacing(r){$e("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Ct.experimentalLetterSpacing=r}updateText(r){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&r)return;this._font=this._style.toFontString();const t=this.context,i=Ct.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=i.width,s=i.height,a=i.lines,l=i.lineHeight,o=i.lineWidths,u=i.maxLineWidth,h=i.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),t.scale(this._resolution,this._resolution),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.font=this._font,t.lineWidth=e.strokeThickness,t.textBaseline=e.textBaseline,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit;let d,p;const v=e.dropShadow?2:1;for(let w=0;w<v;++w){const _=e.dropShadow&&w===0,T=_?Math.ceil(Math.max(1,s)+e.padding*2):0,D=T*this._resolution;if(_){t.fillStyle="black",t.strokeStyle="black";const O=e.dropShadowColor,z=e.dropShadowBlur*this._resolution,V=e.dropShadowDistance*this._resolution;t.shadowColor=lt.shared.setValue(O).setAlpha(e.dropShadowAlpha).toRgbaString(),t.shadowBlur=z,t.shadowOffsetX=Math.cos(e.dropShadowAngle)*V,t.shadowOffsetY=Math.sin(e.dropShadowAngle)*V+D}else t.fillStyle=this._generateFillStyle(e,a,i),t.strokeStyle=e.stroke,t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;let L=(l-h.fontSize)/2;l-h.fontSize<0&&(L=0);for(let O=0;O<a.length;O++)d=e.strokeThickness/2,p=e.strokeThickness/2+O*l+h.ascent+L,e.align==="right"?d+=u-o[O]:e.align==="center"&&(d+=(u-o[O])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[O],d+e.padding,p+e.padding-T,!0),e.fill&&this.drawLetterSpacing(a[O],d+e.padding,p+e.padding-T)}this.updateTexture()}drawLetterSpacing(r,e,t,i=!1){const s=this._style.letterSpacing;let a=!1;if(Ct.experimentalLetterSpacingSupported&&(Ct.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||a){i?this.context.strokeText(r,e,t):this.context.fillText(r,e,t);return}let l=e;const o=Ct.graphemeSegmenter(r);let u=this.context.measureText(r).width,h=0;for(let d=0;d<o.length;++d){const p=o[d];i?this.context.strokeText(p,l,t):this.context.fillText(p,l,t);let v="";for(let w=d+1;w<o.length;++w)v+=o[w];h=this.context.measureText(v).width,l+=u-h+s,u=h}}updateTexture(){const r=this.canvas;if(this._style.trim){const s=fy(r);s.data&&(r.width=s.width,r.height=s.height,this.context.putImageData(s.data,0,0))}const e=this._texture,t=this._style,i=t.trim?0:t.padding,n=e.baseTexture;e.trim.width=e._frame.width=r.width/this._resolution,e.trim.height=e._frame.height=r.height/this._resolution,e.trim.x=-i,e.trim.y=-i,e.orig.width=e._frame.width-i*2,e.orig.height=e._frame.height-i*2,this._onTextureUpdate(),n.setRealSize(r.width,r.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0),this.updateText(!0),super._render(r)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(r,e){return this.updateText(!0),this._textureID===-1&&(r=!1),super.getBounds(r,e)}getLocalBounds(r){return this.updateText(!0),super.getLocalBounds.call(this,r)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(r,e,t){const i=r.fill;if(Array.isArray(i)){if(i.length===1)return i[0]}else return i;let n;const s=r.dropShadow?r.dropShadowDistance:0,a=r.padding||0,l=this.canvas.width/this._resolution-s-a*2,o=this.canvas.height/this._resolution-s-a*2,u=i.slice(),h=r.fillGradientStops.slice();if(!h.length){const d=u.length+1;for(let p=1;p<d;++p)h.push(p/d)}if(u.unshift(i[0]),h.unshift(0),u.push(i[i.length-1]),h.push(1),r.fillGradientType===Pu.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,o+a);const d=t.fontProperties.fontSize+r.strokeThickness;for(let p=0;p<e.length;p++){const v=t.lineHeight*(p-1)+d,w=t.lineHeight*p;let _=w;p>0&&v>w&&(_=(w+v)/2);const T=w+d,D=t.lineHeight*(p+1);let L=T;p+1<e.length&&D<T&&(L=(T+D)/2);const O=(L-_)/o;for(let z=0;z<u.length;z++){let V=0;typeof h[z]=="number"?V=h[z]:V=z/u.length;let Q=Math.min(1,Math.max(0,_/o+V*O));Q=Number(Q.toFixed(5)),n.addColorStop(Q,u[z])}}}else{n=this.context.createLinearGradient(a,o/2,l+a,o/2);const d=u.length+1;let p=1;for(let v=0;v<u.length;v++){let w;typeof h[v]=="number"?w=h[v]:w=p/d,n.addColorStop(w,u[v]),p++}}return n}destroy(r){typeof r=="boolean"&&(r={children:r}),r=Object.assign({},QT,r),super.destroy(r),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(r){this.updateText(!0);const e=Qn(this.scale.x)||1;this.scale.x=e*r/this._texture.orig.width,this._width=r}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(r){this.updateText(!0);const e=Qn(this.scale.y)||1;this.scale.y=e*r/this._texture.orig.height,this._height=r}get style(){return this._style}set style(r){r=r||{},r instanceof Hi?this._style=r:this._style=new Hi(r),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(r){r=String(r??""),this._text!==r&&(this._text=r,this.dirty=!0)}get resolution(){return this._resolution}set resolution(r){this._autoResolution=!1,this._resolution!==r&&(this._resolution=r,this.dirty=!0)}};let jn=Nd;jn.defaultAutoResolution=!0;class eC{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function tC(r,e){var i;let t=!1;if((i=r==null?void 0:r._textures)!=null&&i.length){for(let n=0;n<r._textures.length;n++)if(r._textures[n]instanceof ye){const s=r._textures[n].baseTexture;e.includes(s)||(e.push(s),t=!0)}}return t}function iC(r,e){if(r.baseTexture instanceof Be){const t=r.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function nC(r,e){if(r._texture&&r._texture instanceof ye){const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function rC(r,e){return e instanceof jn?(e.updateText(!0),!0):!1}function sC(r,e){if(e instanceof Hi){const t=e.toFontString();return Ct.measureFont(t),!0}return!1}function aC(r,e){if(r instanceof jn){e.includes(r.style)||e.push(r.style),e.includes(r)||e.push(r);const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function lC(r,e){return r instanceof Hi?(e.includes(r)||e.push(r),!0):!1}const eb=class{constructor(r){this.limiter=new eC(eb.uploadsPerFrame),this.renderer=r,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(aC),this.registerFindHook(lC),this.registerFindHook(tC),this.registerFindHook(iC),this.registerFindHook(nC),this.registerUploadHook(rC),this.registerUploadHook(sC)}upload(r){return new Promise(e=>{r&&this.add(r),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,Lt.system.addOnce(this.tick,this,sr.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const r=this.queue[0];let e=!1;if(r&&!r._destroyed){for(let t=0,i=this.uploadHooks.length;t<i;t++)if(this.uploadHooks[t](this.uploadHookHelper,r)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Lt.system.addOnce(this.tick,this,sr.UTILITY);else{this.ticking=!1;const r=this.completes.slice(0);this.completes.length=0;for(let e=0,t=r.length;e<t;e++)r[e]()}}registerFindHook(r){return r&&this.addHooks.push(r),this}registerUploadHook(r){return r&&this.uploadHooks.push(r),this}add(r){for(let e=0,t=this.addHooks.length;e<t&&!this.addHooks[e](r,this.queue);e++);if(r instanceof Rt)for(let e=r.children.length-1;e>=0;e--)this.add(r.children[e]);return this}destroy(){this.ticking&&Lt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let Ko=eb;Ko.uploadsPerFrame=4;Object.defineProperties(ge,{UPLOADS_PER_FRAME:{get(){return Ko.uploadsPerFrame},set(r){$e("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Ko.uploadsPerFrame=r}}});function tb(r,e){return e instanceof Be?(e._glTextures[r.CONTEXT_UID]||r.texture.bind(e),!0):!1}function oC(r,e){if(!(e instanceof gt))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:i}=t;for(let n=0;n<i.length;n++){const{texture:s}=i[n].style;s&&tb(r,s.baseTexture)}return t.batchable||r.geometry.bind(t,e._resolveDirectShader(r)),!0}function uC(r,e){return r instanceof gt?(e.push(r),!0):!1}class ib extends Ko{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(uC),this.registerUploadHook(tb),this.registerUploadHook(oC)}}ib.extension={name:"prepare",type:be.RendererSystem};Ae.add(ib);const _a=new xe;class uf extends Wt{constructor(e,t=100,i=100){super(e),this.tileTransform=new Pr,this._width=t,this._height=i,this.uvMatrix=this.texture.uvMatrix||new Tu(e),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(e){this.tileTransform.scale.copyFrom(e)}get tilePosition(){return this.tileTransform.position}set tilePosition(e){this.tileTransform.position.copyFrom(e)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(e){const t=this._texture;!t||!t.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))}_calculateBounds(){const e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,i,n)}getLocalBounds(e){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ke),e=this._localBoundsRect),this._bounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,_a);const t=this._width,i=this._height,n=-t*this.anchor._x;if(_a.x>=n&&_a.x<n+t){const s=-i*this.anchor._y;if(_a.y>=s&&_a.y<s+i)return!0}return!1}destroy(e){super.destroy(e),this.tileTransform=null,this.uvMatrix=null}static from(e,t){const i=e instanceof ye?e:ye.from(e,t);return new uf(i,t.width,t.height)}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}}var hC=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,dC=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,cC=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Ng=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,fC=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const no=new Ye;class nb extends ra{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Lc,this.state=Vi.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=Ln.from(Ng,fC,t),this.shader=e.context.webGLVersion>1?Ln.from(dC,hC,t):Ln.from(Ng,cC,t)}render(e){const t=this.renderer,i=this.quad;let n=i.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y);const s=e.uvRespectAnchor?e.anchor.x:0,a=e.uvRespectAnchor?e.anchor.y:0;n=i.uvs,n[0]=n[6]=-s,n[1]=n[3]=-a,n[2]=n[4]=1-s,n[5]=n[7]=1-a,i.invalidate();const l=e._texture,o=l.baseTexture,u=o.alphaMode>0,h=e.tileTransform.localTransform,d=e.uvMatrix;let p=o.isPowerOfTwo&&l.frame.width===o.width&&l.frame.height===o.height;p&&(o._glTextures[t.CONTEXT_UID]?p=o.wrapMode!==gi.CLAMP:o.wrapMode===gi.CLAMP&&(o.wrapMode=gi.REPEAT));const v=p?this.simpleShader:this.shader,w=l.width,_=l.height,T=e._width,D=e._height;no.set(h.a*w/T,h.b*w/D,h.c*_/T,h.d*_/D,h.tx/T,h.ty/D),no.invert(),p?no.prepend(d.mapCoord):(v.uniforms.uMapCoord=d.mapCoord.toArray(!0),v.uniforms.uClampFrame=d.uClampFrame,v.uniforms.uClampOffset=d.uClampOffset),v.uniforms.uTransform=no.toArray(!0),v.uniforms.uColor=lt.shared.setValue(e.tint).premultiply(e.worldAlpha,u).toArray(v.uniforms.uColor),v.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),v.uniforms.uSampler=l,t.shader.bind(v),t.geometry.bind(i),this.state.blendMode=Ec(e.blendMode,u),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}nb.extension={name:"tilingSprite",type:be.RendererPlugin};Ae.add(nb);const Da=class{constructor(r,e,t=null){this.linkedSheets=[],this._texture=r instanceof ye?r:null,this.baseTexture=r instanceof Be?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const i=this.baseTexture.resource;this.resolution=this._updateResolution(t||(i?i.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(r=null){const{scale:e}=this.data.meta;let t=nr(r,null);return t===null&&(t=parseFloat(e??"1")),t!==1&&this.baseTexture.setResolution(t),t}parse(){return new Promise(r=>{this._callback=r,this._batchIndex=0,this._frameKeys.length<=Da.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(r){let e=r;const t=Da.BATCH_SIZE;for(;e-r<t&&e<this._frameKeys.length;){const i=this._frameKeys[e],n=this._frames[i],s=n.frame;if(s){let a=null,l=null;const o=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new Ke(0,0,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution);n.rotated?a=new Ke(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):a=new Ke(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new Ke(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[i]=new ye(this.baseTexture,a,u,l,n.rotated?2:0,n.anchor,n.borders),ye.addToCache(this.textures[i],i)}e++}}_processAnimations(){const r=this.data.animations||{};for(const e in r){this.animations[e]=[];for(let t=0;t<r[e].length;t++){const i=r[e][t];this.animations[e].push(this.textures[i])}}}_parseComplete(){const r=this._callback;this._callback=null,this._batchIndex=0,r.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Da.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Da.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(r=!1){var e;for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,r&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let ll=Da;ll.BATCH_SIZE=1e3;const pC=["jpg","png","jpeg","avif","webp"];function rb(r,e,t){const i={};if(r.forEach(n=>{i[n]=e}),Object.keys(e.textures).forEach(n=>{i[n]=e.textures[n]}),!t){const n=ai.dirname(r[0]);e.linkedSheets.forEach((s,a)=>{const l=rb([`${n}/${e.data.meta.related_multi_packs[a]}`],s,!0);Object.assign(i,l)})}return i}const gC={extension:be.Asset,cache:{test:r=>r instanceof ll,getCacheableAssets:(r,e)=>rb(r,e,!1)},resolver:{test:r=>{const t=r.split("?")[0].split("."),i=t.pop(),n=t.pop();return i==="json"&&pC.includes(n)},parse:r=>{var t;const e=r.split(".");return{resolution:parseFloat(((t=ge.RETINA_PREFIX.exec(r))==null?void 0:t[1])??"1"),format:e[e.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:be.LoadParser,priority:zn.Normal},async testParse(r,e){return ai.extname(e.src).toLowerCase()===".json"&&!!r.frames},async parse(r,e,t){var u,h;let i=ai.dirname(e.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let n=i+r.meta.image;n=Ld(n,e.src);const a=(await t.load([n]))[n],l=new ll(a.baseTexture,r,e.src);await l.parse();const o=(u=r==null?void 0:r.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(o)){const d=[];for(const v of o){if(typeof v!="string")continue;let w=i+v;(h=e.data)!=null&&h.ignoreMultiPack||(w=Ld(w,e.src),d.push(t.load({src:w,data:{ignoreMultiPack:!0}})))}const p=await Promise.all(d);l.linkedSheets=p,p.forEach(v=>{v.linkedSheets=[l].concat(l.linkedSheets.filter(w=>w!==v))})}return l},unload(r){r.destroy(!0)}}};Ae.add(gC);class qo{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class bo{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in t){const a=t[s].match(/^[a-z]+/gm)[0],l=t[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(const u in l){const h=l[u].split("="),d=h[0],p=h[1].replace(/"/gm,""),v=parseFloat(p),w=isNaN(v)?p:v;o[d]=w}i[a].push(o)}const n=new qo;return i.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),i.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),i.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),i.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),i.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),i.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class Gd{static test(e){const t=e;return"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new qo,i=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),l=e.getElementsByTagName("kerning"),o=e.getElementsByTagName("distanceField");for(let u=0;u<i.length;u++)t.info.push({face:i[u].getAttribute("face"),size:parseInt(i[u].getAttribute("size"),10)});for(let u=0;u<n.length;u++)t.common.push({lineHeight:parseInt(n[u].getAttribute("lineHeight"),10)});for(let u=0;u<s.length;u++)t.page.push({id:parseInt(s[u].getAttribute("id"),10)||0,file:s[u].getAttribute("file")});for(let u=0;u<a.length;u++){const h=a[u];t.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(let u=0;u<l.length;u++)t.kerning.push({first:parseInt(l[u].getAttribute("first"),10),second:parseInt(l[u].getAttribute("second"),10),amount:parseInt(l[u].getAttribute("amount"),10)});for(let u=0;u<o.length;u++)t.distanceField.push({fieldType:o[u].getAttribute("fieldType"),distanceRange:parseInt(o[u].getAttribute("distanceRange"),10)});return t}}class Wd{static test(e){return typeof e=="string"&&e.includes("<font>")?Gd.test(ge.ADAPTER.parseXML(e)):!1}static parse(e){return Gd.parse(ge.ADAPTER.parseXML(e))}}const Jh=[bo,Gd,Wd];function mC(r){for(let e=0;e<Jh.length;e++)if(Jh[e].test(r))return Jh[e];return null}function yC(r,e,t,i,n,s){const a=t.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let l;const o=t.dropShadow?t.dropShadowDistance:0,u=t.padding||0,h=r.width/i-o-u*2,d=r.height/i-o-u*2,p=a.slice(),v=t.fillGradientStops.slice();if(!v.length){const w=p.length+1;for(let _=1;_<w;++_)v.push(_/w)}if(p.unshift(a[0]),v.unshift(0),p.push(a[a.length-1]),v.push(1),t.fillGradientType===Pu.LINEAR_VERTICAL){l=e.createLinearGradient(h/2,u,h/2,d+u);let w=0;const T=(s.fontProperties.fontSize+t.strokeThickness)/d;for(let D=0;D<n.length;D++){const L=s.lineHeight*D;for(let O=0;O<p.length;O++){let z=0;typeof v[O]=="number"?z=v[O]:z=O/p.length;const V=L/d+z*T;let Q=Math.max(w,V);Q=Math.min(Q,1),l.addColorStop(Q,p[O]),w=Q}}}else{l=e.createLinearGradient(u,d/2,h+u,d/2);const w=p.length+1;let _=1;for(let T=0;T<p.length;T++){let D;typeof v[T]=="number"?D=v[T]:D=_/w,l.addColorStop(D,p[T]),_++}}return l}function bC(r,e,t,i,n,s,a){const l=t.text,o=t.fontProperties;e.translate(i,n),e.scale(s,s);const u=a.strokeThickness/2,h=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=yC(r,e,a,s,[l],t),e.strokeStyle=a.stroke,a.dropShadow){const d=a.dropShadowColor,p=a.dropShadowBlur*s,v=a.dropShadowDistance*s;e.shadowColor=lt.shared.setValue(d).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=p,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*v,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*v}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(l,u,h+t.lineHeight-o.descent),a.fill&&e.fillText(l,u,h+t.lineHeight-o.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function vo(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function sb(r){return Array.from?Array.from(r):r.split("")}function vC(r){typeof r=="string"&&(r=[r]);const e=[];for(let t=0,i=r.length;t<i;t++){const n=r[t];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let l=s,o=a;l<=o;l++)e.push(String.fromCharCode(l))}else e.push(...sb(n))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const cn=class{constructor(r,e,t){var u;const[i]=r.info,[n]=r.common,[s]=r.page,[a]=r.distanceField,l=nr(s.file),o={};this._ownsTextures=t,this.font=i.face,this.size=i.size,this.lineHeight=n.lineHeight/l,this.chars={},this.pageTextures=o;for(let h=0;h<r.page.length;h++){const{id:d,file:p}=r.page[h];o[d]=e instanceof Array?e[h]:e[p],a!=null&&a.fieldType&&a.fieldType!=="none"&&(o[d].baseTexture.alphaMode=hi.NO_PREMULTIPLIED_ALPHA,o[d].baseTexture.mipmap=Ei.OFF)}for(let h=0;h<r.char.length;h++){const{id:d,page:p}=r.char[h];let{x:v,y:w,width:_,height:T,xoffset:D,yoffset:L,xadvance:O}=r.char[h];v/=l,w/=l,_/=l,T/=l,D/=l,L/=l,O/=l;const z=new Ke(v+o[p].frame.x/l,w+o[p].frame.y/l,_,T);this.chars[d]={xOffset:D,yOffset:L,xAdvance:O,kerning:{},texture:new ye(o[p].baseTexture,z),page:p}}for(let h=0;h<r.kerning.length;h++){let{first:d,second:p,amount:v}=r.kerning[h];d/=l,p/=l,v/=l,this.chars[p]&&(this.chars[p].kerning[d]=v)}this.distanceFieldRange=a==null?void 0:a.distanceRange,this.distanceFieldType=((u=a==null?void 0:a.fieldType)==null?void 0:u.toLowerCase())??"none"}destroy(){for(const r in this.chars)this.chars[r].texture.destroy(),this.chars[r].texture=null;for(const r in this.pageTextures)this._ownsTextures&&this.pageTextures[r].destroy(!0),this.pageTextures[r]=null;this.chars=null,this.pageTextures=null}static install(r,e,t){let i;if(r instanceof qo)i=r;else{const s=mC(r);if(!s)throw new Error("Unrecognized data format for font.");i=s.parse(r)}e instanceof ye&&(e=[e]);const n=new cn(i,e,t);return cn.available[n.font]=n,n}static uninstall(r){const e=cn.available[r];if(!e)throw new Error(`No font found named '${r}'`);e.destroy(),delete cn.available[r]}static from(r,e,t){if(!r)throw new Error("[BitmapFont] Property `name` is required.");const{chars:i,padding:n,resolution:s,textureWidth:a,textureHeight:l,...o}=Object.assign({},cn.defaultOptions,t),u=vC(i),h=e instanceof Hi?e:new Hi(e),d=a,p=new qo;p.info[0]={face:h.fontFamily,size:h.fontSize},p.common[0]={lineHeight:h.fontSize};let v=0,w=0,_,T,D,L=0;const O=[];for(let V=0;V<u.length;V++){_||(_=ge.ADAPTER.createCanvas(),_.width=a,_.height=l,T=_.getContext("2d"),D=new Be(_,{resolution:s,...o}),O.push(new ye(D)),p.page.push({id:O.length-1,file:""}));const Q=u[V],S=Ct.measureText(Q,h,!1,_),Z=S.width,re=Math.ceil(S.height),me=Math.ceil((h.fontStyle==="italic"?2:1)*Z);if(w>=l-re*s){if(w===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${Q}')`);--V,_=null,T=null,D=null,w=0,v=0,L=0;continue}if(L=Math.max(re+S.fontProperties.descent,L),me*s+v>=d){if(v===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${Q}')`);--V,w+=L*s,w=Math.ceil(w),v=0,L=0;continue}bC(_,T,S,v,w,s,h);const le=vo(S.text);p.char.push({id:le,page:O.length-1,x:v/s,y:w/s,width:me,height:re,xoffset:0,yoffset:0,xadvance:Z-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0)}),v+=(me+2*n)*s,v=Math.ceil(v)}for(let V=0,Q=u.length;V<Q;V++){const S=u[V];for(let Z=0;Z<Q;Z++){const re=u[Z],me=T.measureText(S).width,le=T.measureText(re).width,X=T.measureText(S+re).width-(me+le);X&&p.kerning.push({first:vo(S),second:vo(re),amount:X})}}const z=new cn(p,O,!0);return cn.available[r]!==void 0&&cn.uninstall(r),cn.available[r]=z,z}};let Ti=cn;Ti.ALPHA=[["a","z"],["A","Z"]," "];Ti.NUMERIC=[["0","9"]];Ti.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];Ti.ASCII=[[" ","~"]];Ti.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:cn.ALPHANUMERIC};Ti.available={};var wC=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,xC=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Gg=[],Wg=[],Hg=[],ab=class extends Rt{constructor(r,e={}){super();const{align:t,tint:i,maxWidth:n,letterSpacing:s,fontName:a,fontSize:l}=Object.assign({},ab.styleDefaults,e);if(!Ti.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=t,this._tintColor=new lt(i),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=r,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new mi(()=>{this.dirty=!0},this,0,0),this._roundPixels=ge.ROUND_PIXELS,this.dirty=!0,this._resolution=ge.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var me;const r=Ti.available[this._fontName],e=this.fontSize,t=e/r.size,i=new xe,n=[],s=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",o=sb(l),u=this._maxWidth*r.size/e,h=r.distanceFieldType==="none"?Gg:Wg;let d=null,p=0,v=0,w=0,_=-1,T=0,D=0,L=0,O=0;for(let le=0;le<o.length;le++){const oe=o[le],X=vo(oe);if(/(?:\s)/.test(oe)&&(_=le,T=p,O++),oe==="\r"||oe===`
`){s.push(p),a.push(-1),v=Math.max(v,p),++w,++D,i.x=0,i.y+=r.lineHeight,d=null,O=0;continue}const K=r.chars[X];if(!K)continue;d&&K.kerning[d]&&(i.x+=K.kerning[d]);const _e=Hg.pop()||{texture:ye.EMPTY,line:0,charCode:0,prevSpaces:0,position:new xe};_e.texture=K.texture,_e.line=w,_e.charCode=X,_e.position.x=Math.round(i.x+K.xOffset+this._letterSpacing/2),_e.position.y=Math.round(i.y+K.yOffset),_e.prevSpaces=O,n.push(_e),p=_e.position.x+Math.max(K.xAdvance-K.xOffset,K.texture.orig.width),i.x+=K.xAdvance+this._letterSpacing,L=Math.max(L,K.yOffset+K.texture.height),d=X,_!==-1&&u>0&&i.x>u&&(++D,ts(n,1+_-D,1+le-_),le=_,_=-1,s.push(T),a.push(n.length>0?n[n.length-1].prevSpaces:0),v=Math.max(v,T),w++,i.x=0,i.y+=r.lineHeight,d=null,O=0)}const z=o[o.length-1];z!=="\r"&&z!==`
`&&(/(?:\s)/.test(z)&&(p=T),s.push(p),v=Math.max(v,p),a.push(-1));const V=[];for(let le=0;le<=w;le++){let oe=0;this._align==="right"?oe=v-s[le]:this._align==="center"?oe=(v-s[le])/2:this._align==="justify"&&(oe=a[le]<0?0:(v-s[le])/a[le]),V.push(oe)}const Q=n.length,S={},Z=[],re=this._activePagesMeshData;h.push(...re);for(let le=0;le<Q;le++){const oe=n[le].texture,X=oe.baseTexture.uid;if(!S[X]){let K=h.pop();if(!K){const Se=new $T;let de,De;r.distanceFieldType==="none"?(de=new zg(ye.EMPTY),De=Le.NORMAL):(de=new zg(ye.EMPTY,{program:si.from(xC,wC),uniforms:{uFWidth:0}}),De=Le.NORMAL_NPM);const Ve=new jd(Se,de);Ve.blendMode=De,K={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:Ve,vertices:null,uvs:null,indices:null}}K.index=0,K.indexCount=0,K.vertexCount=0,K.uvsCount=0,K.total=0;const{_textureCache:_e}=this;_e[X]=_e[X]||new ye(oe.baseTexture),K.mesh.texture=_e[X],K.mesh.tint=this._tintColor.value,Z.push(K),S[X]=K}S[X].total++}for(let le=0;le<re.length;le++)Z.includes(re[le])||this.removeChild(re[le].mesh);for(let le=0;le<Z.length;le++)Z[le].mesh.parent!==this&&this.addChild(Z[le].mesh);this._activePagesMeshData=Z;for(const le in S){const oe=S[le],X=oe.total;if(!(((me=oe.indices)==null?void 0:me.length)>6*X)||oe.vertices.length<jd.BATCHABLE_SIZE*2)oe.vertices=new Float32Array(4*2*X),oe.uvs=new Float32Array(4*2*X),oe.indices=new Uint16Array(6*X);else{const K=oe.total,_e=oe.vertices;for(let Se=K*4*2;Se<_e.length;Se++)_e[Se]=0}oe.mesh.size=6*X}for(let le=0;le<Q;le++){const oe=n[le];let X=oe.position.x+V[oe.line]*(this._align==="justify"?oe.prevSpaces:1);this._roundPixels&&(X=Math.round(X));const K=X*t,_e=oe.position.y*t,Se=oe.texture,de=S[Se.baseTexture.uid],De=Se.frame,Ve=Se._uvs,ae=de.index++;de.indices[ae*6+0]=0+ae*4,de.indices[ae*6+1]=1+ae*4,de.indices[ae*6+2]=2+ae*4,de.indices[ae*6+3]=0+ae*4,de.indices[ae*6+4]=2+ae*4,de.indices[ae*6+5]=3+ae*4,de.vertices[ae*8+0]=K,de.vertices[ae*8+1]=_e,de.vertices[ae*8+2]=K+De.width*t,de.vertices[ae*8+3]=_e,de.vertices[ae*8+4]=K+De.width*t,de.vertices[ae*8+5]=_e+De.height*t,de.vertices[ae*8+6]=K,de.vertices[ae*8+7]=_e+De.height*t,de.uvs[ae*8+0]=Ve.x0,de.uvs[ae*8+1]=Ve.y0,de.uvs[ae*8+2]=Ve.x1,de.uvs[ae*8+3]=Ve.y1,de.uvs[ae*8+4]=Ve.x2,de.uvs[ae*8+5]=Ve.y2,de.uvs[ae*8+6]=Ve.x3,de.uvs[ae*8+7]=Ve.y3}this._textWidth=v*t,this._textHeight=(i.y+r.lineHeight)*t;for(const le in S){const oe=S[le];if(this.anchor.x!==0||this.anchor.y!==0){let Se=0;const de=this._textWidth*this.anchor.x,De=this._textHeight*this.anchor.y;for(let Ve=0;Ve<oe.total;Ve++)oe.vertices[Se++]-=de,oe.vertices[Se++]-=De,oe.vertices[Se++]-=de,oe.vertices[Se++]-=De,oe.vertices[Se++]-=de,oe.vertices[Se++]-=De,oe.vertices[Se++]-=de,oe.vertices[Se++]-=De}this._maxLineHeight=L*t;const X=oe.mesh.geometry.getBuffer("aVertexPosition"),K=oe.mesh.geometry.getBuffer("aTextureCoord"),_e=oe.mesh.geometry.getIndex();X.data=oe.vertices,K.data=oe.uvs,_e.data=oe.indices,X.update(),K.update(),_e.update()}for(let le=0;le<n.length;le++)Hg.push(n[le]);this._font=r,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:t,size:i}=Ti.available[this._fontName];if(t!=="none"){const{a:n,b:s,c:a,d:l}=this.worldTransform,o=Math.sqrt(n*n+s*s),u=Math.sqrt(a*a+l*l),h=(Math.abs(o)+Math.abs(u))/2,d=this.fontSize/i,p=r._view.resolution;for(const v of this._activePagesMeshData)v.mesh.shader.uniforms.uFWidth=h*e*d*p}super._render(r)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const r=Ti.available[this._fontName];if(!r)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==r&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(r){if(this.tint!==r){this._tintColor.setValue(r);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=r}}get align(){return this._align}set align(r){this._align!==r&&(this._align=r,this.dirty=!0)}get fontName(){return this._fontName}set fontName(r){if(!Ti.available[r])throw new Error(`Missing BitmapFont "${r}"`);this._fontName!==r&&(this._fontName=r,this.dirty=!0)}get fontSize(){return this._fontSize??Ti.available[this._fontName].size}set fontSize(r){this._fontSize!==r&&(this._fontSize=r,this.dirty=!0)}get anchor(){return this._anchor}set anchor(r){typeof r=="number"?this._anchor.set(r):this._anchor.copyFrom(r)}get text(){return this._text}set text(r){r=String(r??""),this._text!==r&&(this._text=r,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(r){this._maxWidth!==r&&(this._maxWidth=r,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(r){this._letterSpacing!==r&&(this._letterSpacing=r,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(r){r!==this._roundPixels&&(this._roundPixels=r,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(r){this._autoResolution=!1,this._resolution!==r&&(this._resolution=r,this.dirty=!0)}destroy(r){const{_textureCache:e}=this,i=Ti.available[this._fontName].distanceFieldType==="none"?Gg:Wg;i.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],i.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=ye.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(r)}};let SC=ab;SC.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const _C=[".xml",".fnt"],kC={extension:{type:be.LoadParser,priority:zn.Normal},name:"loadBitmapFont",test(r){return _C.includes(ai.extname(r).toLowerCase())},async testParse(r){return bo.test(r)||Wd.test(r)},async parse(r,e,t){const i=bo.test(r)?bo.parse(r):Wd.parse(r),{src:n}=e,{page:s}=i,a=[];for(let u=0;u<s.length;++u){const h=s[u].file;let d=ai.join(ai.dirname(n),h);d=Ld(d,n),a.push(d)}const l=await t.load(a),o=a.map(u=>l[u]);return Ti.install(i,o,!0)},async load(r,e){return(await ge.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};Ae.add(kC);const Ds=class extends Hi{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(r){return new Ds(Object.keys(Ds.defaultOptions).reduce((e,t)=>({...e,[t]:r[t]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(r=>{URL.revokeObjectURL(r.src),r.refs--,r.refs===0&&(r.fontFace&&document.fonts.delete(r.fontFace),delete Ds.availableFonts[r.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(r,e={}){const{availableFonts:t}=Ds;if(t[r]){const i=t[r];return this._fonts.push(i),i.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ge.ADAPTER.fetch(r).then(i=>i.blob()).then(async i=>new Promise((n,s)=>{const a=URL.createObjectURL(i),l=new FileReader;l.onload=()=>n([a,l.result]),l.onerror=s,l.readAsDataURL(i)})).then(async([i,n])=>{const s=Object.assign({family:ai.basename(r,ai.extname(r)),weight:"normal",style:"normal",src:i,dataSrc:n,refs:1,originalUrl:r,fontFace:null},e);t[r]=s,this._fonts.push(s),this.styleID++;const a=new FontFace(s.family,`url(${s.src})`,{weight:s.weight,style:s.style});s.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...r){const e=r.filter(t=>!this._overrides.includes(t));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...r){const e=r.filter(t=>this._overrides.includes(t));e.length>0&&(this._overrides=this._overrides.filter(t=>!e.includes(t)),this.styleID++)}toCSS(r){return[`transform: scale(${r})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((r,e)=>`${r}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(r){this._stylesheet!==r&&(this._stylesheet=r,this.styleID++)}normalizeColor(r){return Array.isArray(r)&&(r=ly(r)),typeof r=="number"?ay(r):r}dropShadowToCSS(){let r=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,t=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),i=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);r.startsWith("#")&&e<1&&(r+=(e*255|0).toString(16).padStart(2,"0"));const n=`${t}px ${i}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${r}`:`text-shadow: ${n} ${r}`}reset(){Object.assign(this,Ds.defaultOptions)}onBeforeDraw(){const{fontsDirty:r}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&r?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:r}=ge.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(r)}set fillGradientStops(r){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(r){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(r){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(r){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(r){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(r){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(r){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let za=Ds;za.availableFonts={};za.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Fs=class extends Wt{constructor(r="",e={}){super(ye.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const t=new Image,i=ye.from(t,{scaleMode:ge.SCALE_MODE,resourceOptions:{autoLoad:!1}});i.orig=new Ke,i.trim=new Ke,this.texture=i;const n="http://www.w3.org/2000/svg",s="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),o=document.createElementNS(s,"div"),u=document.createElementNS(s,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=Fs.defaultMaxWidth,this.maxHeight=Fs.defaultMaxHeight,this._domElement=o,this._styleElement=u,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(u),this._foreignObject.appendChild(o),this._image=t,this._loadImage=new Image,this._autoResolution=Fs.defaultAutoResolution,this._resolution=Fs.defaultResolution??ge.RESOLUTION,this.text=r,this.style=e}measureText(r){var l,o;const{text:e,style:t,resolution:i}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},r);Object.assign(this._domElement,{innerHTML:e,style:t.toCSS(i)}),this._styleElement.textContent=t.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const s=Math.min(this.maxWidth,Math.ceil(n.width)),a=Math.min(this.maxHeight,Math.ceil(n.height));return this._svgRoot.setAttribute("width",s.toString()),this._svgRoot.setAttribute("height",a.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),t!==this._style&&(Object.assign(this._domElement,{style:(l=this._style)==null?void 0:l.toCSS(i)}),this._styleElement.textContent=(o=this._style)==null?void 0:o.toGlobalCSS()),{width:s+t.padding*2,height:a+t.padding*2}}async updateText(r=!0){const{style:e,_image:t,_loadImage:i}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&r)return;const{width:n,height:s}=this.measureText();t.width=i.width=Math.ceil(Math.max(1,n)),t.height=i.height=Math.ceil(Math.max(1,s)),this._loading||(this._loading=!0,await new Promise(a=>{i.onload=async()=>{await e.onBeforeDraw(),this._loading=!1,t.src=i.src,i.onload=null,i.src="",this.updateTexture(),a()};const l=new XMLSerializer().serializeToString(this._svgRoot);i.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`}))}get source(){return this._image}updateTexture(){const{style:r,texture:e,_image:t,resolution:i}=this,{padding:n}=r,{baseTexture:s}=e;e.trim.width=e._frame.width=t.width/i,e.trim.height=e._frame.height=t.height/i,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,i),this.dirty=!1}_render(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0),this.updateText(!0),super._render(r)}_renderCanvas(r){this._autoResolution&&this._resolution!==r.resolution&&(this._resolution=r.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(r)}getLocalBounds(r){return this.updateText(!0),super.getLocalBounds(r)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(r){var t,i,n,s,a;typeof r=="boolean"&&(r={children:r}),r=Object.assign({},Fs.defaultDestroyOptions,r),super.destroy(r);const e=null;this.ownsStyle&&((t=this._style)==null||t.cleanFonts()),this._style=e,(i=this._svgRoot)==null||i.remove(),this._svgRoot=e,(n=this._domElement)==null||n.remove(),this._domElement=e,(s=this._foreignObject)==null||s.remove(),this._foreignObject=e,(a=this._styleElement)==null||a.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(r){this.updateText(!0);const e=Qn(this.scale.x)||1;this.scale.x=e*r/this._image.width/this.resolution,this._width=r}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(r){this.updateText(!0);const e=Qn(this.scale.y)||1;this.scale.y=e*r/this._image.height/this.resolution,this._height=r}get style(){return this._style}set style(r){this._style!==r&&(r=r||{},r instanceof za?(this.ownsStyle=!1,this._style=r):r instanceof Hi?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=za.from(r)):(this.ownsStyle=!0,this._style=new za(r)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(r){r=String(r===""||r===null||r===void 0?" ":r),r=this.sanitiseText(r),this._text!==r&&(this._text=r,this.dirty=!0)}get resolution(){return this._resolution}set resolution(r){this._autoResolution=!1,this._resolution!==r&&(this._resolution=r,this.dirty=!0)}sanitiseText(r){return r.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Iu=Fs;Iu.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};Iu.defaultMaxWidth=2024;Iu.defaultMaxHeight=2024;Iu.defaultAutoResolution=!0;class lb{constructor(){y(this,"pixiSpritesheetData");y(this,"pngImageData");y(this,"pngFile");y(this,"zipFile")}async initializeSpritesheetForWorkspace(e,t,i){let n=new Set;if((e.spritesheetId!=null||i!=null)&&(await this.load(e.spritesheetId!=null?e.spritesheetId:i),t.userSpritesheet!=null&&(t.userSpritesheet.destroy(),t.userSpritesheet=null),this.pngImageData!=null&&this.pixiSpritesheetData!=null)){let l=Be.fromBuffer(this.pngImageData,this.pixiSpritesheetData.meta.size.w,this.pixiSpritesheetData.meta.size.h);t.userSpritesheet=new ll(l,this.pixiSpritesheetData),t.userSpritesheet.parse().then(()=>{});for(let o in this.pixiSpritesheetData.frames){let u=o.indexOf("#");n.add(o.substring(0,u))}}let s=e.moduleStore.getBaseModule().typeStore.getType("SpriteLibrary"),a=Array.from(n);s.includeUserSpritesheet(a)}async load(e){if(e==null)return;typeof e=="number"&&(e="sprites/"+("0"+(e%256).toString(16)).slice(-2).toUpperCase()+"/"+e+".zip");let t=new Kw;this.zipFile=await t.fetchUint8ArrayFromCache(e),this.zipFile==null&&(await this.loadFromServer(e),this.zipFile!=null&&t.store(e,this.zipFile)),await this.unpackZip(this.zipFile)}unpackPngFile(){let e=UPNG.decode(this.pngFile.buffer),t=UPNG.toRGBA8(e)[0];this.pngImageData=new Uint8Array(t),this.pixiSpritesheetData.meta.size.w=e.width,this.pixiSpritesheetData.meta.size.h=e.height}async loadFromServer(e){let t={};return Bt!=null&&(t={"x-token-pm":Bt}),new Promise((i,n)=>{I.ajax({type:"GET",async:!0,url:e,headers:t,xhrFields:{responseType:"arraybuffer"},success:s=>{this.zipFile=new Uint8Array(s),i()},error:(s,a)=>{alert("Konnte das Spritesheet nicht laden: "+a)}})})}async unpackZip(e){e instanceof File&&(e=await this.readFile(e)),await this.continueUnpackZip(e)}async readFile(e){return new Promise((t,i)=>{var n=new FileReader;n.onload=()=>{let s=new Uint8Array(n.result);t(s)},n.onerror=i,n.readAsArrayBuffer(e)})}async continueUnpackZip(e){let t,i;(await JSZip.loadAsync(e)).forEach(function(s,a){a.name.endsWith(".png")&&(i=a),a.name.endsWith(".json")&&(t=a)}),this.pngFile=await i.async("uint8array"),this.pixiSpritesheetData=JSON.parse(await t.async("text")),this.unpackPngFile()}async makeZip(e="spritesheet"){const t=new JSZip;t.file(e+".png",this.pngFile),t.file(e+".json",JSON.stringify(this.pixiSpritesheetData),{compression:"DEFLATE",compressionOptions:{level:9}}),this.zipFile=await t.generateAsync({type:"uint8array"})}}const Ga=class Ga{constructor(e,t,i,n){y(this,"isClosed");y(this,"abortController");y(this,"shortestTimeoutMs",6e4);y(this,"timeOpened",null);this.networkManager=e,this.token=t,this.databaseId=i,this.onServerSentStatementsCallback=n,this.isClosed=!1,Ga.openListeners.push(this),this.open()}static close(){Ga.openListeners.forEach(e=>e.close())}open(){if(this.isClosed)return;this.abortController=new AbortController;let e=[["content-type","text/json"]];e.push(["x-token-pm","JJ"+Bt]),e.push(["x-timeout",this.shortestTimeoutMs+""]);try{fetch(Kr.sqlIdeURL+"registerLongpollingListener",{signal:this.abortController.signal,method:"POST",headers:e,body:JSON.stringify({token:this.token})}).then(t=>{if(t.status!=200){let i=Math.round(performance.now()-this.timeOpened)-4e3;i<this.shortestTimeoutMs&&(this.shortestTimeoutMs=i)}switch(t.status){case 200:t.json().then(i=>{console.log("http 200: "+i),this.onMessage(i),this.reopen()});break;case 502:this.reopen();break;default:this.reopen(1e4);break}}).catch(t=>{(""+t).indexOf("abort")<0&&(console.log(t),this.reopen(1e4))}).finally(()=>{this.abortController=null})}catch(t){console.log("Exception opening DatabaseLongPollingListener: "+t)}}reopen(e=500){setTimeout(()=>{this.open()},e)}onDBMessage(e){e.databaseId==this.databaseId&&(console.log("Message: "+e),this.onServerSentStatementsCallback(e.firstNewStatementIndex,e.newStatements,e.rollbackToVersion))}close(){var t;this.isClosed=!0,(t=this.abortController)==null||t.abort();let e=[["content-type","text/json"]];e.push(["x-token-pm","JJ"+Bt]);try{fetch("/servlet/unregisterLongpollingListener",{method:"POST",headers:e,body:JSON.stringify({token:this.token})})}catch{}}onMessage(e){for(let t of e)switch(t.eventType){case"close":return;case"broadcastDatabaseChange":this.onDBMessage(t.data);return}}};y(Ga,"openListeners",[]);let ea=Ga;class TC{constructor(e,t){y(this,"programPointerModule",null);y(this,"programPointerPosition");y(this,"programPointerDecoration",[]);y(this,"accordion");y(this,"fileListPanel");y(this,"workspaceListPanel");y(this,"$homeAction");y(this,"$synchronizeAction");y(this,"lastOpenModule",null);this.main=e,this.$projectexplorerDiv=t}initGUI(){this.accordion=new mm(this.main,this.$projectexplorerDiv),this.initFilelistPanel(),this.initWorkspacelistPanel()}initFilelistPanel(){let e=this;this.fileListPanel=new xr(this.accordion,"Kein Workspace gewählt","3","img_add-file-dark","Neue Datei...","emptyFile",!0,!1,"file",!0,[]),this.fileListPanel.newElementCallback=(t,i)=>{if(e.main.currentWorkspace==null)return alert("Bitte wählen Sie zuerst einen Workspace aus."),null;let n={name:t.name,dirty:!1,saved:!0,text:"",text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,panelElement:t,identical_to_repository_version:!1};e.fileListPanel.setElementClass(t,Mi.filenameToFileType(t.name).iconclass);let s=new Ni(n,e.main);t.externalElement=s,e.main.currentWorkspace.moduleStore.putModule(s),e.setModuleActive(s),e.fileListPanel.setCaption(e.main.currentWorkspace.name),e.main.networkManager.sendCreateFile(s,e.main.currentWorkspace,e.main.workspacesOwnerId,l=>{l==null?i(s):alert("Der Server ist nicht erreichbar!")})},this.fileListPanel.renameCallback=(t,i,n)=>{i=i.substr(0,80);let s=t.file;this.main.currentWorkspace.moduleStore.rename(s.name,i),s.name=i,s.saved=!1;let a=Mi.filenameToFileType(i);return e.fileListPanel.setElementClass(n,a.iconclass),monaco.editor.setModelLanguage(t.model,a.language),e.main.networkManager.sendUpdates(),i},this.fileListPanel.deleteCallback=(t,i)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("file",t.file.id,n=>{n==null?(e.main.currentWorkspace.moduleStore.removeModule(t),e.main.currentWorkspace.moduleStore.getModules(!1).length==0&&e.fileListPanel.setCaption("Keine Datei vorhanden"),i()):alert("Der Server ist nicht erreichbar!")})},this.fileListPanel.contextMenuProvider=t=>{let i=[],n=this;return i.push({caption:"Duplizieren",callback:s=>{let a=s.externalElement,l={name:a.file.name+" - Kopie",dirty:!0,saved:!1,text:a.file.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:a.file.version,panelElement:null,identical_to_repository_version:!1},o=new Ni(l,n.main),u=n.main.currentWorkspace;u.moduleStore.putModule(o),n.main.networkManager.sendCreateFile(o,u,n.main.workspacesOwnerId,d=>{if(d==null){let p={isFolder:!1,name:l.name,path:[],externalElement:o,iconClass:Mi.filenameToFileType(l.name).iconclass,readonly:!1,isPruefungFolder:!1};l.panelElement=p,n.fileListPanel.addElement(p,!0),n.fileListPanel.sortElements(),n.setModuleActive(o),n.fileListPanel.renameElement(p)}else alert("Der Server ist nicht erreichbar!")})}}),n.main.user.is_teacher||n.main.user.is_admin||n.main.user.is_schooladmin||(t.externalElement.file.submitted_date==null?i.push({caption:"Als Hausaufgabe markieren",callback:l=>{let o=l.externalElement.file;o.submitted_date=xw(new Date),o.saved=!1,n.main.networkManager.sendUpdates(null,!0),n.renderHomeworkButton(o)}}):i.push({caption:"Hausaufgabenmarkierung entfernen",callback:l=>{let o=l.externalElement.file;o.submitted_date=null,o.saved=!1,n.main.networkManager.sendUpdates(null,!0),n.renderHomeworkButton(o)}})),i},this.fileListPanel.selectCallback=t=>{e.setModuleActive(t)},this.$synchronizeAction=I('<div class="img_open-change jo_button jo_active" style="margin-right: 4px" title="Workspace mit Repository synchronisieren">'),this.$synchronizeAction.on("pointerdown",t=>{t.stopPropagation(),t.preventDefault(),this.main.getCurrentWorkspace().synchronizeWithRepository()}),this.fileListPanel.addAction(this.$synchronizeAction),this.$synchronizeAction.hide()}renderHomeworkButton(e){var s,a;let t=(a=(s=e==null?void 0:e.panelElement)==null?void 0:s.$htmlFirstLine)==null?void 0:a.find(".jo_additionalButtonHomework");if(t==null)return;t.find(".jo_homeworkButton").remove();let i=null,n="";if(e.submitted_date!=null&&(i="img_homework",n="Wurde als Hausaufgabe abgegeben: "+e.submitted_date,e.text_before_revision&&(i="img_homework-corrected",n="Korrektur liegt vor.")),i!=null){let l=I(`<div class="jo_homeworkButton ${i}" title="${n}"></div>`);t.prepend(l),i.indexOf("jo_active")>=0&&(l.on("mousedown",o=>o.stopPropagation()),l.on("click",o=>{o.stopPropagation()}))}}initWorkspacelistPanel(){let e=this;this.workspaceListPanel=new xr(this.accordion,"WORKSPACES","4","img_add-workspace-dark","Neuer Workspace...","workspace",!0,!0,"workspace",!1,["file"]),this.workspaceListPanel.newElementCallback=(t,i)=>{let n=e.main.user.id;e.main.workspacesOwnerId!=null&&(n=e.main.workspacesOwnerId);let s=new mn(t.name,e.main,n);s.isFolder=!1,s.path=t.path.join("/"),e.main.workspaceList.push(s),t.externalElement=s,e.main.networkManager.sendCreateWorkspace(s,e.main.workspacesOwnerId,a=>{a==null?(e.fileListPanel.enableNewButton(!0),i(s),e.setWorkspaceActive(s),s.renderSynchronizeButton(t)):alert("Der Server ist nicht erreichbar!")})},this.workspaceListPanel.renameCallback=(t,i)=>(i=i.substr(0,80),t.name=i,t.saved=!1,e.main.networkManager.sendUpdates(),i),this.workspaceListPanel.deleteCallback=(t,i)=>{e.main.networkManager.sendDeleteWorkspaceOrFile("workspace",t.id,n=>{n==null?(e.fileListPanel.$buttonNew.hide(),e.main.removeWorkspace(t),e.fileListPanel.clear(),e.main.getMonacoEditor().setModel(null),e.fileListPanel.setCaption("Bitte Workspace selektieren"),this.$synchronizeAction.hide(),i()):alert("Der Server ist nicht erreichbar!")})},this.workspaceListPanel.selectCallback=t=>{t!=null&&!t.isFolder&&e.main.networkManager.sendUpdates(()=>{e.setWorkspaceActive(t)})},this.workspaceListPanel.newFolderCallback=(t,i)=>{let n=e.main.user.id;e.main.workspacesOwnerId!=null&&(n=e.main.workspacesOwnerId);let s=new mn(t.name,e.main,n);s.isFolder=!0,s.path=t.path.join("/"),s.panelElement=t,t.externalElement=s,e.main.workspaceList.push(s),e.main.networkManager.sendCreateWorkspace(s,e.main.workspacesOwnerId,a=>{a==null?i(s):(alert("Fehler: "+a),e.workspaceListPanel.removeElement(t))})},this.workspaceListPanel.moveCallback=t=>{Array.isArray(t)||(t=[t]);for(let i of t){let n=i.externalElement;n.path=i.path.join("/"),n.saved=!1}this.main.networkManager.sendUpdates()},this.workspaceListPanel.dropElementCallback=(t,i,n)=>{let s=t.externalElement,a=i.externalElement;if(s.moduleStore.getModules(!1).indexOf(a)>=0)return;let l={name:a.file.name,dirty:!0,saved:!1,text:a.file.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:a.file.version,panelElement:null,identical_to_repository_version:!1};n=="move"&&(e.main.currentWorkspace.moduleStore.removeModule(a),e.fileListPanel.removeElement(a),e.main.networkManager.sendDeleteWorkspaceOrFile("file",a.file.id,()=>{}));let o=new Ni(l,e.main);s.moduleStore.putModule(o),e.main.networkManager.sendCreateFile(o,s,e.main.workspacesOwnerId,h=>{h==null||alert("Der Server ist nicht erreichbar!")})},this.$homeAction=I('<div class="img_home-dark jo_button jo_active" style="margin-right: 4px" title="Meine eigenen Workspaces anzeigen">'),this.$homeAction.on("pointerdown",t=>{t.stopPropagation(),t.preventDefault(),e.main.networkManager.sendUpdates(()=>{e.onHomeButtonClicked()}),e.main.bottomDiv.hideHomeworkTab()}),this.workspaceListPanel.addAction(this.$homeAction),this.$homeAction.hide(),this.workspaceListPanel.contextMenuProvider=t=>{let i=[];return i.push({caption:"Duplizieren",callback:n=>{let s=n.externalElement;this.main.networkManager.sendDuplicateWorkspace(s,(a,l)=>{if(a==null&&l!=null){let o=mn.restoreFromData(l,this.main);this.main.rightDiv.classDiagram.duplicateSerializedClassDiagram(s.id,o.id),this.main.workspaceList.push(o);let u=l.path.split("/");u.length==1&&u[0]==""&&(u=[]),o.panelElement={name:o.name,externalElement:o,iconClass:o.repository_id==null?"workspace":"repository",isFolder:!1,path:u,readonly:!1,isPruefungFolder:!1},this.workspaceListPanel.addElement(o.panelElement,!0),this.workspaceListPanel.sortElements()}a!=null&&alert(a)})}},{caption:"Exportieren",callback:n=>{let s=n.externalElement,a=s.name.replace(/\//g,"_");bc(s.toExportedWorkspace(),a+".json")}}),this.main.user.is_teacher&&this.main.teacherExplorer.classPanel.elements.length>0&&i.push({caption:"An Klasse austeilen...",callback:n=>{},subMenu:this.main.teacherExplorer.classPanel.elements.map(n=>({caption:n.name,callback:s=>{let a=n.externalElement,l=s.externalElement;this.main.networkManager.sendDistributeWorkspace(l,a,null,o=>{if(o==null){let u=this.main.networkManager;u.updateFrequencyInSeconds*u.forcedUpdateEvery,alert("Der Workspace "+l.name+" wurde an die Klasse "+a.name+` ausgeteilt. Er wird sofort in der Workspaceliste der Schüler/innen erscheinen.
 Falls das bei einer Schülerin/einem Schüler nicht klappt, bitten Sie sie/ihn, sich kurz aus- und wieder einzuloggen.`)}else alert(o)})}}))},{caption:"An einzelne Schüler/innen austeilen...",callback:n=>{let s=this.main.teacherExplorer.classPanel.elements.map(l=>l.externalElement),a=n.externalElement;new $w(s,a,this.main)}}),this.main.repositoryOn&&this.main.workspacesOwnerId==this.main.user.id&&(t.externalElement.repository_id==null?i.push({caption:"Repository anlegen...",callback:n=>{let s=n.externalElement;e.main.repositoryCreateManager.show(s)},subMenu:null}):(i.push({caption:"Mit Repository synchronisieren",callback:n=>{n.externalElement.synchronizeWithRepository()}}),i.push({caption:"Vom Repository loslösen",color:"#ff8080",callback:n=>{let s=n.externalElement;s.repository_id=null,s.saved=!1,this.main.networkManager.sendUpdates(()=>{e.workspaceListPanel.setElementClass(n,"workspace"),s.renderSynchronizeButton(n)},!0)}}))),i.push({caption:"Einstellungen...",callback:n=>{let s=n.externalElement;new Xw(s,this.main).open()}}),i}}onHomeButtonClicked(){this.workspaceListPanel.$buttonNew.show(),this.workspaceListPanel.$newFolderAction.show(),this.main.teacherExplorer.restoreOwnWorkspaces(),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.ownUpdateFrequencyInSeconds,this.$homeAction.hide(),this.fileListPanel.enableNewButton(this.main.workspaceList.length>0)}renderFiles(e){let t=e==null?"Kein Workspace vorhanden":e.name;if(this.fileListPanel.setCaption(t),this.fileListPanel.clear(),this.main.getCurrentWorkspace()!=null)for(let i of this.main.getCurrentWorkspace().moduleStore.getModules(!1))i.file.panelElement=null;if(e!=null){let i=[];for(let n of e.moduleStore.getModules(!1))i.push(n);i.sort((n,s)=>n.file.name>s.file.name?1:n.file.name<s.file.name?-1:0);for(let n of i)n.file.panelElement={name:n.file.name,externalElement:n,isFolder:!1,path:[],iconClass:Mi.filenameToFileType(n.file.name).iconclass,readonly:e.readonly,isPruefungFolder:!1},this.fileListPanel.addElement(n.file.panelElement,!0),this.renderHomeworkButton(n.file);this.fileListPanel.sortElements()}}renderWorkspaces(e){this.fileListPanel.clear(),this.workspaceListPanel.clear();for(let t of e){let i=t.path.split("/");i.length==1&&i[0]==""&&(i=[]),t.panelElement={name:t.name,externalElement:t,iconClass:t.repository_id==null?"workspace":"repository",isFolder:t.isFolder,path:i,readonly:t.readonly,isPruefungFolder:!1},this.workspaceListPanel.addElement(t.panelElement,!1),t.renderSynchronizeButton(t.panelElement)}this.workspaceListPanel.sortElements(),this.fileListPanel.enableNewButton(e.length>0)}renderErrorCount(e,t){if(t!=null)for(let i of e.moduleStore.getModules(!1)){let n=t.get(i),s=n==null||n==0?"":"("+n+")";this.fileListPanel.setTextAfterFilename(i.file.panelElement,s,"jo_errorcount")}}showRepositoryButtonIfNeeded(e){e.repository_id!=null&&e.owner_id==this.main.user.id?(this.$synchronizeAction.show(),this.main.user.settings.helperHistory.repositoryButtonDone||rn.showHelper("repositoryButton",this.main,this.$synchronizeAction)):this.$synchronizeAction.hide()}setWorkspaceActive(e,t=!1){var i;if(ea.close(),this.workspaceListPanel.select(e,!1,t),this.main.interpreter.state==Re.running&&this.main.interpreter.stop(),this.main.currentWorkspace=e,this.renderFiles(e),e!=null){let n=e.moduleStore.getModules(!1);e.currentlyOpenModule!=null?this.setModuleActive(e.currentlyOpenModule):n.length>0?this.setModuleActive(n[0]):this.setModuleActive(null),n.length==0&&!this.main.user.settings.helperHistory.newFileHelperDone&&rn.showHelper("newFileHelper",this.main,this.fileListPanel.$captionElement),this.showRepositoryButtonIfNeeded(e),new lb().initializeSpritesheetForWorkspace(e,this.main).then(()=>{for(let a of n)a.file.dirty=!0}),(i=this.main.bottomDiv.gradingManager)==null||i.setValues(e)}else this.setModuleActive(null)}writeEditorTextToFile(){let e=this.getCurrentlyEditedModule();e!=null&&(e.file.text=e.getProgramTextFromMonacoModel())}setModuleActive(e){this.main.bottomDiv.homeworkManager.hideRevision(),this.lastOpenModule!=null&&(this.lastOpenModule.getBreakpointPositionsFromEditor(),this.lastOpenModule.file.text=this.lastOpenModule.getProgramTextFromMonacoModel(),this.lastOpenModule.editorState=this.main.getMonacoEditor().saveViewState()),e==null?(this.main.getMonacoEditor().setModel(monaco.editor.createModel("Keine Datei vorhanden.","text")),this.main.getMonacoEditor().updateOptions({readOnly:!0}),this.fileListPanel.setCaption("Keine Datei vorhanden")):(this.main.getMonacoEditor().updateOptions({readOnly:this.main.currentWorkspace.readonly&&!this.main.user.is_teacher}),this.main.getMonacoEditor().setModel(e.model),this.main.getBottomDiv()!=null&&this.main.getBottomDiv().errorManager.showParenthesisWarning(e.bracketError),e.file.text_before_revision!=null?this.main.bottomDiv.homeworkManager.showHomeWorkRevisionButton():this.main.bottomDiv.homeworkManager.hideHomeworkRevisionButton())}setActiveAfterExternalModelSet(e){this.fileListPanel.select(e,!1),this.lastOpenModule=e,e.editorState!=null&&(this.main.editor.dontPushNextCursorMove++,this.main.getMonacoEditor().restoreViewState(e.editorState),this.main.editor.dontPushNextCursorMove--),e.renderBreakpointDecorators(),this.setCurrentlyEditedModule(e),this.showProgramPointer(),setTimeout(()=>{this.main.getMonacoEditor().getOptions().get(monaco.editor.EditorOption.readOnly)||this.main.getMonacoEditor().focus()},300)}showProgramPointer(){if(this.programPointerModule==this.getCurrentlyEditedModule()&&this.getCurrentlyEditedModule()!=null){let e=this.programPointerPosition,t={startColumn:e.column,startLineNumber:e.line,endColumn:e.column+e.length,endLineNumber:e.line};this.main.getMonacoEditor().revealRangeInCenterIfOutsideViewport(t),this.programPointerDecoration=this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[{range:t,options:{className:"jo_revealProgramPointer",isWholeLine:!0,overviewRuler:{color:"#6fd61b",position:monaco.editor.OverviewRulerLane.Center},minimap:{color:"#6fd61b",position:monaco.editor.MinimapPosition.Inline}}},{range:t,options:{beforeContentClassName:"jo_revealProgramPointerBefore"}}])}}showProgramPointerPosition(e,t){if(e==null)return;let i=this.main.currentWorkspace.moduleStore.findModuleByFile(e);i!=null&&(this.programPointerModule=i,this.programPointerPosition=t,i!=this.getCurrentlyEditedModule()?this.setModuleActive(i):this.showProgramPointer())}hideProgramPointerPosition(){this.getCurrentlyEditedModule()==this.programPointerModule&&this.main.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[]),this.programPointerModule=null,this.programPointerDecoration=[]}getCurrentlyEditedModule(){let e=this.main.currentWorkspace;return e==null?null:e.currentlyOpenModule}setCurrentlyEditedModule(e){if(e==null)return;let t=this.main.currentWorkspace;t.currentlyOpenModule!=e&&(t.currentlyOpenModule=e,t.saved=!1,e.file.dirty=!0)}setExplorerColor(e,t){let i;e==null?(e="transparent",i="Meine WORKSPACES"):i=t,this.fileListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.$listElement.parent().css("background-color",e),this.workspaceListPanel.setCaption(i)}getNewModule(e){return Ni.restoreFromData(e,this.main)}async fetchAndRenderOwnWorkspaces(){await this.fetchAndRenderWorkspaces(this.main.user)}async fetchAndRenderWorkspaces(e,t,i=null){await this.main.networkManager.sendUpdates();let n={ws_userId:e.id,userId:this.main.user.id},s=await yc("/servlet/getWorkspaces",n);if(s.success==!0){this.main.workspacesOwnerId==this.main.user.id&&t!=null&&(t.ownWorkspaces=this.main.workspaceList.slice(),t.currentOwnWorkspace=this.main.currentWorkspace);let a=(t==null?void 0:t.classPanelMode)=="tests";e.id!=this.main.user.id&&a&&(s.workspaces.workspaces=s.workspaces.workspaces.filter(l=>l.pruefung_id==i.id)),this.main.workspacesOwnerId=e.id,this.main.restoreWorkspaces(s.workspaces,!1),e.id!=this.main.user.id&&(this.main.projectExplorer.setExplorerColor("rgba(255, 0, 0, 0.2",e.familienname+", "+e.rufname),this.main.projectExplorer.$homeAction.show(),rn.showHelper("homeButtonHelper",this.main),this.main.networkManager.updateFrequencyInSeconds=this.main.networkManager.teacherUpdateFrequencyInSeconds,this.main.networkManager.secondsTillNextUpdate=this.main.networkManager.teacherUpdateFrequencyInSeconds,a||(this.main.bottomDiv.homeworkManager.attachToWorkspaces(this.main.workspaceList),this.main.bottomDiv.showHomeworkTab())),i!=null?(this.workspaceListPanel.$buttonNew.hide(),this.workspaceListPanel.$newFolderAction.hide()):(this.workspaceListPanel.$buttonNew.show(),this.workspaceListPanel.$newFolderAction.show())}}}const Wa=class Wa{constructor(e,t){y(this,"position",0);y(this,"yMax");y(this,"$grip");y(this,"$zoomcontrolDisplay");y(this,"gripHeight",10);y(this,"overallHeight",150);y(this,"zoomMin",.2);y(this,"zoomMax",2);this.callback=t;let i=I('<div class="jo_zoomcontrol-outer" title="Zoom" draggable="false"></div>');e.append(i);let n=I('<div class="jo_zoomcontrol-bar" draggable="false"></div>');i.append(n),this.$grip=I('<div class="jo_zoomcontrol-grip" draggable="false"></div>'),i.append(this.$grip),this.$zoomcontrolDisplay=I('<div class="jo_zoomcontrol-display"></div>'),this.$grip.append(this.$zoomcontrolDisplay);let s,a,l=this;l.overallHeight=Mo(i.css("height")),l.gripHeight=Mo(l.$grip.css("height")),l.yMax=l.overallHeight-l.gripHeight;let o=window.PointerEvent?"pointer":"mouse";n.on(o+"down",h=>{let d=h.pageY-i.offset().top-4;l.setZoom(d),l.$grip.css("top",d+"px"),l.$grip.trigger(o+"down",[h.clientY])}),this.$grip.on(o+"down",(h,d)=>{d==null&&(d=h.clientY),s=d,a=l.position,this.$zoomcontrolDisplay.show(),I(document).on(o+"move.zoomcontrol",p=>{let v=p.clientY-s;l.setZoom(a+v)}),I(document).on(o+"up.zoomcontrol",()=>{I(document).off(o+"up.zoomcontrol"),I(document).off(o+"move.zoomcontrol"),this.$zoomcontrolDisplay.hide()}),h.stopPropagation()}),e.on(o+"enter",h=>{Wa.preventFading||i.fadeIn()}),e.on(o+"leave",h=>{Wa.preventFading||i.fadeOut()});let u=(1-this.zoomMin)/(this.zoomMax-this.zoomMin);this.position=u*(this.overallHeight-this.gripHeight),this.$grip.css("top",this.position+"px")}setZoom(e){e<0&&(e=0),e>this.yMax&&(e=this.yMax),this.position=e,this.$grip.css("top",e+"px");let t=e/(this.overallHeight-this.gripHeight);t=this.zoomMin+t*(this.zoomMax-this.zoomMin);let i=Math.round(t*100)+" %";this.$zoomcontrolDisplay.html(i),this.callback!=null&&this.callback(t)}};y(Wa,"preventFading",!1);let Kn=Wa;var kt=.2;class ob{constructor(e,t){y(this,"zoomControl");y(this,"zoomfactor",1);y(this,"$canvas");y(this,"svgElement");y(this,"$menuButton");y(this,"defs");y(this,"style");y(this,"inlineStyles",{});y(this,"marginCm",1.6);y(this,"minDistance",2);y(this,"minWidthHeightCm",10);y(this,"widthCm",this.minWidthHeightCm);y(this,"heightCm",this.minWidthHeightCm);y(this,"$centerRectangle");this.main=t,this.$menuButton=I('<div class="jo_classDiagram_Menubutton jo_button jo_active img_menu-three-bars"></div>'),e.append(this.$menuButton);let i=I("<div></div>");e.append(i),i.addClass("jo_scrollable"),i.css({overflow:"auto",position:"relative",width:"100%",height:"100%"}),this.$canvas=I('<div class="jo_diagram-canvas"></div>'),i.append(this.$canvas),this.zoomControl=new Kn(e,o=>{this.$canvas.css({transform:"scale("+o+")"}),this.zoomfactor=o});let n="http://www.w3.org/2000/svg";this.svgElement=document.createElementNS(n,"svg"),I(this.svgElement).addClass("jo_diagram-svg svg_all_pointer_events"),this.$canvas[0].appendChild(this.svgElement),this.$centerRectangle=I(this.createElement("rect",this.svgElement)),this.$centerRectangle.addClass("centerRectangle"),this.$centerRectangle.css({fill:"#ffffff",stroke:"none"}),this.adjustCenterRectangle();let s=I(this.svgElement),a,l;s.on("mousedown",o=>{a=o.screenX,l=o.screenY,I(document).on("mousemove.diagram",u=>{let h=u.screenX-a,d=u.screenY-l;a=u.screenX,l=u.screenY,i.scrollLeft(i.scrollLeft()-h),i.scrollTop(i.scrollTop()-d)}),I(document).on("mouseup.diagram",()=>{I(document).off("mousemove.diagram"),I(document).off("mouseup.diagram")})})}adjustCenterRectangle(){this.$centerRectangle.attr({x:this.marginCm+"cm",y:this.marginCm+"cm",width:this.widthCm-2*this.marginCm+"cm",height:this.heightCm-2*this.marginCm+"cm"})}setSize(e,t){e<this.minWidthHeightCm&&(e=this.minWidthHeightCm),t<this.minWidthHeightCm&&(t=this.minWidthHeightCm),this.$canvas.css({width:e+"cm",height:t+"cm"}),this.widthCm=e,this.heightCm=t,this.adjustCenterRectangle()}adjustSizeAndElements(e){let t=1e5,i=1e5,n=-1e5,s=-1e5;for(let u of e)t>u.leftCm&&(t=u.leftCm),n<u.leftCm+u.widthCm&&(n=u.leftCm+u.widthCm),i>u.topCm&&(i=u.topCm),s<u.topCm+u.heightCm&&(s=u.topCm+u.heightCm);t-=this.marginCm,n+=this.marginCm,i-=this.marginCm,s+=this.marginCm;let a=!1,l=this.widthCm,o=this.heightCm;if(t<0||n>this.widthCm||n-t<=this.widthCm&&this.widthCm>this.minWidthHeightCm){let u=0;if(l=Math.max(this.minWidthHeightCm,n-t),t<0&&(u=-t),t>0&&n>l&&(u=l-n),a=u!=0,a)for(let h of e)h.move(u,0,!0,!0)}if(i<0||s>this.heightCm||s-i<=this.heightCm&&this.heightCm>this.minWidthHeightCm){let u=0;if(o=Math.max(this.minWidthHeightCm,s-i),i<0&&(u=-i),i>0&&s>o&&(u=o-s),a=u!=0,a)for(let h of e)h.move(0,u,!0,!0)}return this.setSize(l,o),{isAdjusted:a}}insertStyleElement(e=null){let t="http://www.w3.org/2000/svg";this.style==null&&(this.defs=document.createElementNS(t,"defs"),this.style=document.createElementNS(t,"style"),this.defs.appendChild(this.style),this.svgElement.appendChild(this.defs)),e!=null&&(this.inlineStyles=e,this.refreshInlineStyles())}createElement(e,t=null,i){let n="http://www.w3.org/2000/svg",s=I(document.createElementNS(n,e));return i!=null&&s.attr(i),t!=null&&t.appendChild(s[0]),s}refreshInlineStyles(){let e="";for(let t in this.inlineStyles){let i=this.inlineStyles[t];if(i!=null){e+=t+`{
`;for(let n in i)e+="   "+n+":"+i[n]+`;
`;e+=`}
`}else e+=t+`
`}this.style.textContent=e}findFreeSpace(e,t,i,n){let s=0,a=!1,l=0,o=0;for(;!a;){let u=s,h=0;for(h=0;h<=s;h++)if(l=this.marginCm+h*kt,o=this.marginCm+u*kt,this.isFree(e,t,i,l,o,n)){a=!0;break}if(a)break;for(h--,u=0;u<=s-1;u++)if(l=this.marginCm+h*kt,o=this.marginCm+u*kt,this.isFree(e,t,i,l,o,n)){a=!0;break}s+=2}return{x:l,y:o}}isFree(e,t,i,n,s,a){for(let l of e){let o=Math.abs(l.leftCm+l.widthCm/2-n-t/2)<=(l.widthCm+t)/2+a,u=Math.abs(l.topCm+l.heightCm/2-s-i/2)<=(l.heightCm+i)/2+a;if(o&&u)return!1}return!0}}var wo=(r=>(r[r.left=0]="left",r[r.center=1]="center",r[r.right=2]="right",r))(wo||{});const Ha=class Ha{constructor(e){y(this,"$element");y(this,"leftCm",0);y(this,"topCm",0);y(this,"widthCm");y(this,"heightCm");y(this,"lines",[]);y(this,"backgroundColor","#ffffff");this.parent=e}getRoutingRectangle(){return{left:Math.round(this.leftCm/kt),top:Math.round(this.topCm/kt),width:Math.round(this.widthCm/kt),height:Math.round(this.heightCm/kt)}}show(){this.$element!=null&&this.$element.show()}hide(){this.$element!=null&&this.$element.hide()}detach(){this.$element!=null&&this.$element.detach()}remove(){this.$element!=null&&(this.$element.remove(),this.$element=null)}appendTo(e){e.append(this.$element)}clear(){this.$element!=null&&(this.$element.empty(),this.lines=[])}move(e,t,i,n=!1){this.leftCm+=e,this.topCm+=t;let s=this.leftCm,a=this.topCm;i&&(s=Math.round(s/kt)*kt,a=Math.round(a/kt)*kt),n&&(this.leftCm=s,this.topCm=a),I(this.$element).css("transform","translate("+s+"cm,"+a+"cm)")}moveTo(e,t,i){this.move(e-this.leftCm,t-this.topCm,i)}createElement(e,t=null,i){let n="http://www.w3.org/2000/svg",s=I(document.createElementNS(n,e));return i!=null&&s.attr(i),t!=null&&t.appendChild(s[0]),s}createTextElement(e,t=null,i){let n=this.createElement("text",t,{font:"16px Roboto","font-family":"sans-serif",fill:"#000","alignment-baseline":"hanging","dominant-baseline":"hanging"});return i!=null&&n.attr(i),n.text(e),n}getTextMetrics(e){let t=e[0].getBBox();return{height:t.height*Ha.cmPerPx,width:t.width*Ha.cmPerPx}}addTextLine(e){this.lines.push(e),e.type=="text"&&(e.alignment==null&&(e.alignment=0),e.bold==null&&(e.bold=!1),e.italics==null&&(e.italics=!1))}render(){let e=this.$element;e==null&&(e=this.createElement("g",this.parent),e.addClass("svg_draggable"),e.addClass("svg_all_pointer_events"),this.$element=e,I(this.$element).css("transform","translate("+this.leftCm+"cm,"+this.topCm+"cm)"));let t=this.createElement("rect",e[0]),i=.1,n=0,s=!0;for(let h of this.lines)if(h.type=="text"){s&&(i+=.1),s=!1,h.yCm=i,h.$element=this.createTextElement(h.text,e[0],{"font-weight":h.bold?"bold":"normal","font-size":"12pt","font-style":h.italics?"italic":"normal","text-anchor":h.alignment==0?"start":h.alignment==1?"middle":"end",cursor:h.onClick==null?"":"pointer"}),h.$element.css("transform","translate(0cm,0cm)");let d=this.getTextMetrics(h.$element);h.textHeightCm=d.height,h.textWidthCm=d.width,n=Math.max(n,h.textWidthCm),i+=h.textHeightCm,h.tooltip!=null&&this.createElement("title",h.$element[0]).text(h.tooltip)}else h.yCm=i+h.thicknessCm/2,i+=h.thicknessCm+.1,s=!0;let a=2*.05+2*.2+n;this.widthCm=(Math.trunc(a/kt)+1)*kt,this.heightCm=(Math.trunc(i/kt)+1)*kt;let l=.05+.2,o=a/2+.1,u=a-l;t.css({width:this.widthCm+"cm",height:this.heightCm+"cm",fill:this.backgroundColor,stroke:"#000","stroke-width":"0.05cm"});for(let h of this.lines)if(h.type=="text"){let d;switch(h.alignment){case 1:d=o;break;case 0:d=l;break;case 2:d=u;break}let p=this.createElement("g",e[0]);p.append(h.$element),h.$element=p,h.$element.css("transform","translate("+d+"cm,"+h.yCm+"cm)"),h.onClick!=null&&(h.$element.addClass("clickable"),h.$element.on("mousedown",v=>{h.onClick(),v.stopPropagation()}))}else h.$element=this.createElement("line",e[0],{x1:"0",y1:h.yCm+"cm",x2:this.widthCm+"cm",y2:h.yCm+"cm"}),h.$element.css({stroke:"#000","stroke-width":h.thicknessCm+"cm"})}};y(Ha,"cmPerPx",2.54/96);let Hd=Ha;class ol extends Hd{constructor(t,i,n,s){super(t.svgElement);y(this,"className");y(this,"klass");y(this,"filename");y(this,"hashedSignature");y(this,"documentation");y(this,"active",!0);y(this,"withMethods",!0);y(this,"withAttributes",!0);y(this,"inDebounce");y(this,"isSystemClass");y(this,"$dropdownTriangle");if(this.diagram=t,this.klass=s,s!=null){this.attachToClass(this.klass),this.isSystemClass=s.module.isSystemModule,this.withAttributes=!1;//!this.isSystemClass;
this.withMethods=!1}this.moveTo(i,n,!0)}copy(){let t=new ol(this.diagram,this.leftCm,this.topCm,null);return t.className=this.className,t.filename=this.filename,t.hashedSignature=this.hashedSignature,t.documentation=this.documentation,t.active=!1,t.withMethods=this.withMethods,t.withAttributes=this.withAttributes,t.isSystemClass=this.isSystemClass,t}serialize(){return{className:this.className,filename:this.filename,hashedSignature:this.hashedSignature,withAttributes:this.withAttributes,withMethods:this.withMethods,isSystemClass:this.isSystemClass,leftCm:this.leftCm,topCm:this.topCm}}static deserialize(t,i){let n=new ol(t,i.leftCm,i.topCm,null);return n.hashedSignature=i.hashedSignature,n.className=i.className,n.filename=i.filename,n.withAttributes=i.withAttributes,n.withMethods=i.withMethods,n.isSystemClass=i.isSystemClass,n}attachToClass(t){this.klass=t;let i=this.getSignature(t);this.className!=t.identifier||this.hashedSignature!=i||this.widthCm<.7||this.documentation!=t.documentation?(this.isSystemClass=t.module.isSystemModule,this.renderLines()):this.addMouseEvents(),this.className=t.identifier,this.filename=t.module.file.name,this.hashedSignature=i,this.documentation=t.documentation}jumpToDeclaration(t){this.diagram.main.jumpToDeclaration(this.klass.module,t.declaration)}renderLines(){this.clear();let t=this.diagram.currentClassBoxes.parametersWithTypes;if(this.addTextLine({type:"text",text:(this.klass instanceof Pe?"<<interface>> ":this.klass.isAbstract?"<<abstract>> ":"")+this.klass.identifier,tooltip:Zn(this.klass,"",!0),alignment:wo.center,bold:!0,italics:this.klass instanceof Pe||this.klass.isAbstract,onClick:this.isSystemClass?void 0:()=>{this.jumpToDeclaration(this.klass)}}),this.klass instanceof $&&this.withAttributes){this.addTextLine({type:"line",thicknessCm:.05});for(let i of this.klass.attributes){let n=this.getVisibilityText(i.visibility)+yn(i.type)+" "+i.identifier;this.addTextLine({type:"text",text:n,tooltip:Zn(i),alignment:wo.left,onClick:this.isSystemClass?void 0:()=>{this.jumpToDeclaration(i)}})}}this.withMethods&&(this.addTextLine({type:"line",thicknessCm:.05}),this.klass.methods.filter(i=>i.signature!="toJson()").forEach(i=>{let n=this.getVisibilityText(i.visibility)+i.identifier+"()";if(t){let s=i.isConstructor?"":i.returnType==null?"void ":yn(i.returnType)+" ";n=this.getVisibilityText(i.visibility)+s+i.identifier+"("+i.parameterlist.parameters.map(a=>yn(a.type)+" "+a.identifier).join(", ")+")"}this.addTextLine({type:"text",text:n,tooltip:Zn(i),alignment:wo.left,italics:this.klass instanceof Pe||i.isAbstract,onClick:this.isSystemClass?void 0:()=>{this.jumpToDeclaration(i)}})})),this.backgroundColor=this.isSystemClass?"#aaaaaa":"#ffffff",this.render(),this.$dropdownTriangle=this.createElement("path",this.$element[0],{d:this.getTrianglePath(),class:"dropdown-triangle",style:"transform: translate("+(this.widthCm-.35)+"cm,0.05cm)"}),this.addMouseEvents()}getTrianglePath(){return this.withMethods?"M 0 8 L 11 8 L 5.5 2 L 0 8":"M 0 2 L 11 2 L 5.5 8 L 0 2"}detach(){var t;(t=this.$element)==null||t.off("mousedown.diagramElement"),I(document).off("mouseup.diagramElement"),I(document).off("mousemove.diagramElement"),super.detach()}addMouseEvents(){let t=this;this.$dropdownTriangle!=null&&(this.$dropdownTriangle.off("mouseup.dropdowntriangle"),this.$dropdownTriangle.off("mousedown.dropdowntriangle")),this.$dropdownTriangle.on("mousedown.dropdowntriangle",i=>{i.stopPropagation()}),this.$dropdownTriangle.on("mouseup.dropdowntriangle",i=>{i.stopPropagation(),this.withMethods=!this.withMethods,this.withAttributes=!this.withAttributes,this.$dropdownTriangle.attr("d",this.getTrianglePath()),this.renderLines(),this.diagram.adjustClassDiagramSize(),this.diagram.updateArrows()}),this.$element.on("mousedown.diagramElement",i=>{if(i.stopPropagation(),i.stopImmediatePropagation(),i.button!=0)return;let n=i.screenX,s=i.screenY;t.$element.find("rect").addClass("dragging"),I(document).off("mouseup.diagramElement"),I(document).off("mousemove.diagramElement"),I(document).on("mousemove.diagramElement",a=>{let l=.024583333333333332/this.diagram.zoomfactor,o=(a.screenX-n)*l,u=(a.screenY-s)*l;n=a.screenX,s=a.screenY,t.move(o,u,!0),clearTimeout(t.inDebounce),t.inDebounce=setTimeout(()=>{t.diagram.updateArrows()},200)}),I(document).on("mouseup.diagramElement",()=>{t.move(0,0,!0,!0);let a=t.diagram;a.adjustClassDiagramSize(),a.updateArrows(),t.$element.find("rect").removeClass("dragging"),I(document).off("mouseup.diagramElement"),I(document).off("mousemove.diagramElement"),a.dirty=!0})})}getVisibilityText(t){switch(t){case ee.private:return"-";case ee.protected:return"#";case ee.public:return"+"}}getSignature(t){let i="";if(t instanceof $&&this.withAttributes&&t.attributes.length>0)for(let n of t.attributes)i+=this.getVisibilityText(n.visibility)+n.type.identifier+" "+n.identifier;if(this.withMethods&&t.methods.length>0)for(let n of t.methods){if(n.isConstructor)continue;let s=n.returnType==null?"void":n.returnType.identifier;i+=this.getVisibilityText(n.visibility)+s+" "+n.identifier+"("+n.parameterlist.parameters.map(a=>a.type.identifier+" "+a.identifier).join(", ")+")"}return ww(i)}hasSignatureAndFileOf(t){return t.module.file.name==this.filename&&this.getSignature(t)==this.hashedSignature}}const fr=class fr{static makeHead(e,t,i){let n=t.x-e.x,s=t.y-e.y,a=Math.sqrt(n*n+s*s);if(a<1e-5)return{path:"",stroke:"none",fill:"none"};let l=n/a,o=s/a,u="M "+t.x*kt/Zr.cmPerPx+" "+t.y*kt/Zr.cmPerPx,h=this.arrows[i];for(let d of h.steps){let p=d.r/180*Math.PI,v=l*Math.cos(p)-o*Math.sin(p),w=l*Math.sin(p)+o*Math.cos(p);u+=" l "+v*d.f/Zr.cmPerPx+" "+w*d.f/Zr.cmPerPx,l=v,o=w}return{path:u,fill:h.fill,stroke:h.stroke}}};y(fr,"rauteAlpha",60),y(fr,"arrows",{inheritance:{steps:[{r:150,f:.4},{r:120,f:.4},{r:120,f:.4}],stroke:"#000000",fill:"#ffffff","stroke-dasharray":void 0},realization:{steps:[{r:150,f:.4},{r:120,f:.4},{r:120,f:.4}],stroke:"#000000",fill:"#8080ff","stroke-dasharray":"4"},composition:{steps:[{r:90+fr.rauteAlpha,f:.3},{r:180-2*fr.rauteAlpha,f:.3},{r:2*fr.rauteAlpha,f:.3},{r:180-2*fr.rauteAlpha,f:.3}],stroke:"#000000",fill:"#ffffff","stroke-dasharray":void 0}});let Yo=fr;const Xr=class Xr{constructor(e,t,i){y(this,"$element");this.parent=e,this.routingArrow=t,this.color=i}show(){this.$element!=null&&this.$element.show()}hide(){this.$element!=null&&this.$element.hide()}detach(){this.$element!=null&&this.$element.detach()}remove(){this.$element!=null&&this.$element.remove()}appendTo(e){e.append(this.$element)}clear(){this.$element!=null&&this.$element.empty()}createElement(e,t=null,i){let n="http://www.w3.org/2000/svg",s=I(document.createElementNS(n,e));return i!=null&&s.attr(i),t!=null&&t.appendChild(s[0]),s}createTextElement(e,t=null,i){let n=this.createElement("text",t,{font:"16px Roboto","font-family":"sans-serif",fill:"#000","alignment-baseline":"hanging"});return i!=null&&n.attr(i),n.text(e),n}getTextMetrics(e){let t=e[0].getBBox();return{height:t.height*Xr.cmPerPx,width:t.width*Xr.cmPerPx}}render(){let e=this.$element;e==null?(e=this.createElement("g",this.parent),this.$element=e,e.css("stroke",this.color)):e.empty();let t=this.routingArrow.minimalPoints;if(t==null||t.length<2)return;let i="M "+this.getPathCoordinates(t[0]);for(let a=1;a<t.length;a++)i+=" L "+this.getPathCoordinates(t[a]);let n=Yo.arrows[this.routingArrow.arrowType];for(this.createElement("path",e[0],{d:i}).css({"stroke-width":"0.2 cm",fill:"none","stroke-dasharray":n["stroke-dasharray"]});t.length>1&&t[t.length-1].x==t[t.length-2].x&&t[t.length-1].y==t[t.length-2].y;)t.pop();if(t.length>1&&this.routingArrow.endsOnArrowWithIdentifier==null){let a=Yo.makeHead(t[t.length-2],t[t.length-1],this.routingArrow.arrowType);this.createElement("path",e[0],{d:a.path}).css({stroke:this.color,"stroke-width":"0.2 cm",fill:a.fill})}}getPathCoordinates(e){let t=e.x*kt/Xr.cmPerPx,i=e.y*kt/Xr.cmPerPx;return""+t+" "+i}};y(Xr,"cmPerPx",2.54/96);let Zr=Xr;class CC extends ob{constructor(t,i){super(t,i);y(this,"classBoxesRepository",{});y(this,"arrows",[]);y(this,"currentWorkspaceId",null);y(this,"currentWorkspace");y(this,"currentClassBoxes");y(this,"version",0);y(this,"straightArrowSectionAfterRectangle",2);y(this,"distanceFromRectangles",2);y(this,"slotDistance",2);y(this,"dirty",!1);y(this,"routingWorker");this.$htmlElement=t;let n=this;this.$menuButton.on("click",s=>{s.preventDefault();let a=n.currentClassBoxes.displaySystemClasses==!0,l=n.currentClassBoxes.parametersWithTypes==!0;wr([{caption:a?"Systemklassen ausblenden":"Systemklassen einblenden",callback:()=>{n.currentClassBoxes.displaySystemClasses=!a,n.drawDiagram(n.currentWorkspace,!1)}},{caption:l?"Parameter ausblenden":"Parameter einblenden",callback:()=>{n.currentClassBoxes.parametersWithTypes=!l,n.currentClassBoxes.active.forEach(o=>{o.hashedSignature=-1}),n.drawDiagram(n.currentWorkspace,!1)}}],s.pageX+2,s.pageY+2),s.stopPropagation()})}duplicateSerializedClassDiagram(t,i){let n=this.classBoxesRepository[t],s={inactive:n.active.map(a=>a.copy()).concat(n.inactive.map(a=>a.copy())),active:[],displaySystemClasses:n.displaySystemClasses,parametersWithTypes:n.parametersWithTypes};this.classBoxesRepository[i]=s,this.dirty=!0}clearAfterLogout(){this.classBoxesRepository={},this.arrows.forEach(t=>{t.remove()}),I(this.svgElement).find(":not(.centerRectangle)").remove()}serialize(){if(this.currentClassBoxes==null)return;let t={classBoxes:[],displaySystemClasses:this.currentClassBoxes.displaySystemClasses,parametersWithTypes:this.currentClassBoxes.parametersWithTypes};for(let i in this.classBoxesRepository){let n=this.classBoxesRepository[i];for(let s of n.active){let a=s.serialize();a.workspaceId=Number.parseInt(i),t.classBoxes.push(a)}}return t}deserialize(t){for(let i of t.classBoxes){let n=this.classBoxesRepository[i.workspaceId];n==null&&(n={active:[],inactive:[],displaySystemClasses:!1,parametersWithTypes:!1},this.classBoxesRepository[i.workspaceId]=n),n.inactive.push(ol.deserialize(this,i)),n.displaySystemClasses=t.displaySystemClasses,n.parametersWithTypes=t.parametersWithTypes}}adjustClassDiagramSize(){let t=this.classBoxesRepository[this.currentWorkspaceId];this.adjustSizeAndElements(t.active)}getClassBoxes(t){let i=this.classBoxesRepository[t.id];return i==null&&(i={active:[],inactive:[],displaySystemClasses:!1,parametersWithTypes:!1},this.classBoxesRepository[t.id]=i),i}switchToWorkspace(t){let i=this.getClassBoxes(t);if(this.currentWorkspaceId!=t.id){if(this.currentWorkspaceId!=null){let n=this.classBoxesRepository[this.currentWorkspaceId];if(n!=null){for(let s of n.active)s.detach();for(let s of n.inactive)s.detach()}}for(let n of i.active)this.svgElement.appendChild(n.$element[0]);for(let n of i.inactive)n.$element!=null&&this.svgElement.appendChild(n.$element[0]);this.adjustSizeAndElements(i.active)}return this.currentWorkspaceId=t.id,i}drawDiagram(t,i){var h;if(t==null)return;this.currentWorkspace=t,this.currentClassBoxes=this.switchToWorkspace(t);let n=t.moduleStore,s=[],a=!1,l=[],o=[];for(let d of n.getModules(!1)){let p=(h=d==null?void 0:d.typeStore)==null?void 0:h.typeList;p!=null&&(a=!0,p.filter(v=>v instanceof $||v instanceof Pe).forEach(v=>{let w=this.findAndEnableClass(v,this.currentClassBoxes,l);w!=null&&s.push(w),v instanceof $&&v.registerUsedSystemClasses(o)}))}let u=[];for(;u.length<o.length;){u=o.slice(0);for(let d of u)d instanceof $&&d.registerUsedSystemClasses(o)}if(this.currentClassBoxes.displaySystemClasses)for(let d of o){let p=this.findAndEnableClass(d,this.currentClassBoxes,l);p!=null&&s.push(p)}this.dirty=this.dirty||l.length>0;for(let d of l){let p=new ol(this,Math.random()*10*kt,Math.random()*10*kt,d);p.renderLines();let v=this.findFreeSpace(s,p.widthCm,p.heightCm,this.minDistance);p.moveTo(v.x,v.y,!0),s.push(p)}if(l.length>0&&this.adjustSizeAndElements(s),!!a){for(let d of this.currentClassBoxes.active)d.hide(),d.active=!1,this.currentClassBoxes.inactive.push(d);this.currentClassBoxes.active=s,i||(this.adjustClassDiagramSize(),this.updateArrows())}}updateArrows(){this.$htmlElement.find(".jo_classdiagram-spinner").hide();let t=["#0075dc","#993f00","#005c31","#ff5005","#2bce48","#0000ff","#ffa405","#ffa8bb","#740aff","#990000","#ff0000"],i=0,n=this.drawArrows();this.version++,n.version=this.version,this.routingWorker!=null&&this.routingWorker.terminate(),this.routingWorker=new Worker("worker/diagram-worker.js");let s=this;this.routingWorker.onmessage=function(a){let l=a.data;if(l.version==s.version){s.$htmlElement.find(".jo_classdiagram-spinner").hide(),s.arrows.forEach(d=>{d.remove()});let o={},u=l.arrows.length+1,h;do h=u,u=0,l.arrows.forEach(d=>{d.color==null&&(u++,d.endsOnArrowWithIdentifier==null?(d.color=t[i],o[d.identifier]=d.color,i++,i>t.length-1&&(i=0)):d.color=o[d.endsOnArrowWithIdentifier])});while(u<h);l.arrows.forEach(d=>{d.color==null&&(d.color="#ff0000")}),l.arrows.forEach(d=>{let p=new Zr(s.svgElement,d,d.color);p.render(),s.arrows.push(p)})}},this.routingWorker.postMessage(n),this.$htmlElement.find(".jo_classdiagram-spinner").show()}drawArrows(){let t={rectangles:[],arrows:[],xMax:Math.ceil(this.widthCm/kt),yMax:Math.ceil(this.heightCm/kt),straightArrowSectionAfterRectangle:this.straightArrowSectionAfterRectangle,distanceFromRectangles:this.distanceFromRectangles,slotDistance:this.slotDistance},i=this.classBoxesRepository[this.currentWorkspaceId];return i.active.forEach(n=>{t.rectangles.push(n.getRoutingRectangle())}),i.active.forEach(n=>{if(n.klass instanceof $){if(n.klass.baseClass!=null){let s=this.findClassbox(n.klass.baseClass,i.active);s!=null&&this.drawArrwow(n,s,"inheritance",t)}for(let s of n.klass.implements){let a=this.findClassbox(s,i.active);a!=null&&this.drawArrwow(n,a,"realization",t)}for(let s of n.klass.getCompositeData()){let a=this.findClassbox(s.klass,i.active);a!=null&&this.drawArrwow(a,n,"composition",t)}}}),t}drawArrwow(t,i,n,s){t.getRoutingRectangle(),i.getRoutingRectangle();let a=this.classBoxesRepository[this.currentWorkspaceId];s.arrows.push({arrowType:n,destRectangleIndex:a.active.indexOf(i),sourceRectangleIndex:a.active.indexOf(t),destinationIdentifier:i.className,identifier:t.className+"(extends)"+i.className})}findClassbox(t,i){for(let n of i)if(n.klass==t)return n;return null}findAndEnableClass(t,i,n){let s=0;for(;s<i.active.length;){let a=i.active[s];if(a.className==t.identifier||a.hasSignatureAndFileOf(t))return a.attachToClass(t),i.active.splice(s,1),a;s++}for(s=0;s<i.inactive.length;){let a=i.inactive[s];if(a.className==t.identifier||a.hasSignatureAndFileOf(t))return i.inactive.splice(s,1),a.klass=t,a.renderLines(),a.show(),a.active=!0,this.dirty=!0,a;s++}return n.push(t),null}clear(){let t=this.classBoxesRepository[this.currentWorkspaceId];if(t!=null)for(let i of t.active)i.detach()}}class AC{constructor(e,t){this.main=e,this.objectDiagram=t}}class MC extends AC{constructor(){super(...arguments);y(this,"rootIdentifier");y(this,"$selectElement")}getSettingsElement(){var n;let t=this.main.getCurrentWorkspace().moduleStore,i=jQuery("<span>Start der Liste:&nbsp;</span>");this.$selectElement=jQuery("<select></select>"),i.append(this.$selectElement);for(let s of t.getModules(!1)){let a=(n=s.mainSymbolTable)==null?void 0:n.childSymbolTables;if(a==null||a.length==0)continue;let l=a[0].variableMap;l==null||a[0].classContext!=null||l.forEach((o,u)=>{let h=o.type;if(h!=null&&h instanceof $&&h.module!=null&&!h.module.isSystemModule){let d=u==this.rootIdentifier?" selected":"";this.$selectElement.append('<option value="'+u+d+'">'+u+' (Modul "'+s.file.name+'")</option>')}})}return i}getName(){return"Liste"}updateDiagram(){var u;let i=(u=this.main.getInterpreter().heap[this.rootIdentifier])==null?void 0:u.value;if(i==null){this.objectDiagram.error("Konnte die Variable "+this.rootIdentifier+" nicht finden.");return}(i.type==null||!(i.type instanceof $))&&this.objectDiagram.error("Die Variable "+this.rootIdentifier+" zeigt auf kein Objekt.");let n=i.type,s=i.value,a=this.analyzeSelfReference(n),l=[],o;if(a==null){let h=n;for(;h!=null&&!(h instanceof Ma);){for(let d of h.attributes){let p=s.attributes[d.index];if(p.type instanceof $)if(o!=null&&o==d.type)l.push(d.identifier);else{let v=this.analyzeSelfReference(p.type);v!=null&&(o=v)}}h=h.baseClass}}a==null&&o==null?this.objectDiagram.error("Konnte kein sich selbst referenzierendes Objekt finden."):this.drawDiagram(i,a,l,o)}drawDiagram(t,i,n,s){}analyzeSelfReference(t){let i=[],n,s=t;for(;s!=null&&!(s instanceof Ma);)s.implements.length>0&&(i=i.concat(s.implements)),s.baseClass!=null&&!(s.baseClass instanceof Ma)&&n.push(s.baseClass),s=s.baseClass;for(s=t;s!=null&&!(s instanceof Ma);){for(let a of s.attributes){let l=a.type;if(i.indexOf(l)>=0||n.indexOf(l)>=0)return l}s=s.baseClass}return null}clear(){}}class EC extends ob{constructor(t,i){super(i.find(".jo_objectdiagram-canvas"),t);y(this,"variants",[]);y(this,"currentVariant",null);this.$objectDiagramDiv=i,this.variants.push(new MC(t,this));let n=i.find(".jo_objectdiagram-type");n.empty(),n.append('<option value="none" selected>Bitte auswählen...</option>');let s=0;for(let l of this.variants)n.append('<option value="'+s+'">'+l.getName()+"</option>");let a=this;n.on("change",l=>{let o=l.currentTarget.value;if(o==null)a.currentVariant!=null&&(a.$canvas.find(".jo_objectDiagramError").remove(),a.currentVariant.clear()),a.currentVariant=null;else{let u=Number.parseInt(o);a.currentVariant=a.variants[u]}a.updateSettings()})}error(t){this.$canvas.append('<div class="jo_objectDiagramError">'+t+"</div>")}updateSettings(){let t=this.$objectDiagramDiv.find(".jo_objectdiagram-settings");this.currentVariant!=null?(t.empty(),t.append(this.currentVariant.getSettingsElement())):t.empty()}updateDiagram(){this.currentVariant!=null&&this.currentVariant.updateDiagram()}}class ub{constructor(e,t){y(this,"classDiagram");y(this,"objectDiagram");y(this,"isWholePage",!1);y(this,"$tabs");y(this,"$headings");this.main=e,this.$rightDiv=t,this.$tabs=t.find(".jo_tabs"),this.$headings=t.find(".jo_tabheadings");let i=this.$headings.find(".jo_classDiagramTabHeading").length>0,n=this.$headings.find(".jo_objectDiagramTabHeading").length>0;i&&(this.classDiagram=new CC(this.$tabs.find(".jo_classdiagram"),e),this.$headings.find(".jo_classDiagramTabHeading").on("click",()=>{s.main.drawClassDiagrams(!1)})),n&&(this.objectDiagram=new EC(this.main,this.$tabs.find(".jo_objectdiagram")),this.$headings.find(".jo_objectDiagramTabHeading").on("click",()=>{s.onObjectDiagramEnabled()}));let s=this,a="100%";t.find(".jo_whole-window").on("click",()=>{s.isWholePage=!s.isWholePage;let l=I(".jo_whole-window");s.isWholePage?(I("#code").css("display","none"),a=I("#rightdiv").css("width"),I("#rightdiv").css("width","100%"),l.removeClass("img_whole-window"),l.addClass("img_whole-window-back"),I(".jo_control-container").append(I("#controls")),l.attr("title","Auf normale Größe zurückführen"),I(".jo_graphics").trigger("sizeChanged")):(I("#code").css("display","flex"),I("#rightdiv").css("width",a),l.removeClass("img_whole-window-back"),l.addClass("img_whole-window"),I("#controls").insertAfter(I("#view-mode")),l.attr("title","Auf Fenstergröße vergrößern"),I(".jo_graphics").trigger("sizeChanged"))})}adjustWidthToWorld(){let e=this.main.getInterpreter().worldHelper;if(e!=null&&this.isWholePage){let t=window.innerHeight-this.$headings.height()-6,i=window.innerWidth/t,n=e.width/e.height;if(n<=i){let s=n*t;this.$tabs.find(".jo_run").css("width",s+"px"),this.$tabs.find(".jo_run").css("height",t+"px")}else{let s=window.innerWidth/n;this.$tabs.find(".jo_run").css("width",window.innerWidth+"px"),this.$tabs.find(".jo_run").css("height",s+"px")}}}initGUI(){Ao(this.$rightDiv)}isClassDiagramEnabled(){let e=this.$headings.find(".jo_classDiagramTabHeading");return e.length==0?!1:e.hasClass("jo_active")}isObjectDiagramEnabled(){let e=this.$headings.find(".jo_objectDiagramTabHeading");return e.length==0?!1:e.hasClass("jo_active")}updateObjectDiagramSettings(){this.isObjectDiagramEnabled&&this.objectDiagram.updateSettings()}onObjectDiagramEnabled(){this.objectDiagram.updateSettings(),(this.main.getInterpreter().state==Re.paused||this.main.getInterpreter().state==Re.running)&&this.objectDiagram.updateDiagram()}}class PC{constructor(e){y(this,"main");this.main=e}initSliders(){let e=this,t=window.PointerEvent?"pointer":"mouse";I("#slider1").on(t+"down",s=>{let a=s.clientX;I(document).on(t+"move.slider1",l=>{let o=l.clientX-a;e.moveLeftPanel(o),a=l.clientX}),I(document).on(t+"up.slider1",()=>{I(document).off(t+"move.slider1"),I(document).off(t+"up.slider1")})}),I("#slider2").on(t+"down",s=>{let a=s.clientY;I(document).on(t+"move.slider2",l=>{let o=l.clientY-a;e.moveBottomDiv(o),a=l.clientY}),I(document).on(t+"up.slider2",()=>{I(document).off(t+"move.slider2"),I(document).off(t+"up.slider2")})}),I("#slider3").on(t+"down",s=>{let a=s.clientX;Kn.preventFading=!0,I(document).on(t+"move.slider3",l=>{let o=l.clientX-a;e.moveRightDiv(o),a=l.clientX,l.stopPropagation()}),I(document).on(t+"up.slider3",()=>{I(document).off(t+"move.slider3"),I(document).off(t+"up.slider3"),Kn.preventFading=!1})});let i=I('<div class="jo_sliderknob img_knob jo_button jo_active" style="left: -8px" draggable="false"></div>');I("#slider2").append(i),i.on(t+"down",s=>{let a=s.clientY,l=s.clientX;s.stopPropagation(),Kn.preventFading=!0,I(document).on(t+"move.knobleft",o=>{let u=o.clientY-a,h=o.clientX-l;o.stopPropagation(),e.moveLeftPanel(h),e.moveBottomDiv(u),l+=h,a+=u}),I(document).on(t+"up.knobleft",()=>{I(document).off(t+"move.knobleft"),I(document).off(t+"up.knobleft"),Kn.preventFading=!1})});let n=I('<div class="jo_sliderknob img_knob jo_button jo_active" style="right: -8px" draggable="false"></div>');I("#slider2").append(n),n.on(t+"down",s=>{let a=s.clientY,l=s.clientX;s.stopPropagation(),Kn.preventFading=!0,I(document).on(t+"move.knobright",o=>{let u=o.clientY-a,h=o.clientX-l;o.stopPropagation(),e.moveRightDiv(h),e.moveBottomDiv(u),l+=h,a+=u}),I(document).on(t+"up.knobright",()=>{I(document).off(t+"move.knobright"),I(document).off(t+"up.knobright"),Kn.preventFading=!1})})}moveRightDiv(e){let t=I("#editor>.monaco-editor"),i=I("#rightdiv"),n=Number.parseInt(i.css("width").replace("px",""));i.css("width",n-e+"px");let s=Number.parseInt(t.css("width").replace("px",""));t.css("width",s+e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout(),I(".jo_graphics").trigger("sizeChanged"),n+=e}moveBottomDiv(e){let t=I("#editor>.monaco-editor"),i=I("#bottomdiv-outer"),n=Number.parseInt(i.css("height").replace("px",""));i.css("height",n-e+"px");let s=Number.parseInt(t.css("height").replace("px",""));t.css("height",s+e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}moveLeftPanel(e){let t=I("#leftpanel"),i=I("#editor>.monaco-editor"),n=Number.parseInt(t.css("width").replace("px",""));t.css("width",n+e+"px");let s=Number.parseInt(i.css("width").replace("px",""));i.css("width",s-e+"px"),this.main.getMonacoEditor().layout(),this.main.bottomDiv.homeworkManager.diffEditor!=null&&this.main.bottomDiv.homeworkManager.diffEditor.layout()}}function IC(r){var e,t;return((e=r.familienname)==null?void 0:e.length)>0&&((t=r.rufname)==null?void 0:t.length)>0?r.rufname+" "+r.familienname:r.username}var Ug={preparing:"Vorbereitung",running:"Prüfung läuft",correcting:"Korrektur",opening:"Herausgabe"};class Vg{constructor(e,t,i){y(this,"$html");y(this,"isActive",!0);y(this,"listeners",[]);y(this,"linkedToggleButtons",new Set);var n;this._caption=e,this.$parent=t,this._isChecked=i,this.$html=I(`<div class='joe_toggleButton active${i?" checked":""}'>${e}</div>`),(n=this.$parent)==null||n.append(this.$html),this.$html.on("pointerdown",s=>{s.stopPropagation(),this._isChecked||(this.checked=!this._isChecked)})}onChange(e){this.listeners.push(e)}linkTo(...e){e==null||e.forEach(t=>{this.linkedToggleButtons.add(t),t.linkedToggleButtons.add(this)})}get caption(){return this._caption}set caption(e){this._caption=e,this.$html.text(e)}setActive(e){this.isActive=e,this.$html.toggleClass("active",e)}get checked(){return this._isChecked}set checked(e){this._isChecked=e,this.$html.toggleClass("checked",e),this.listeners.forEach(t=>t(e)),e&&this.linkedToggleButtons.forEach(t=>t.checked=!1)}}class DC{constructor(e,t){y(this,"studentPanel");y(this,"classPanel");y(this,"ownWorkspaces");y(this,"currentOwnWorkspace");y(this,"pruefungen",[]);y(this,"classPanelMode","classes");y(this,"currentPruefung",null);this.main=e,this.classData=t,this.fetchPruefungen()}removePanels(){this.classPanel.remove(),this.studentPanel.remove()}initGUI(){this.initStudentPanel(),this.initClassPanel(),this.renderClasses(this.classData),Li.subscribe("onPruefungChanged",async()=>{this.classPanelMode=="tests"&&(await this.fetchPruefungen(),this.renderPruefungen())})}initStudentPanel(){this.studentPanel=new xr(this.main.projectExplorer.accordion,"Schüler/innen","3",null,"","student",!1,!1,"student",!1,[]),this.studentPanel.selectCallback=e=>{this.classPanelMode=="classes"?this.main.projectExplorer.fetchAndRenderWorkspaces(e,this):this.main.projectExplorer.fetchAndRenderWorkspaces(e,this,this.currentPruefung)}}restoreOwnWorkspaces(){let e=this.main;e.getMonacoEditor().updateOptions({readOnly:!0}),e.workspaceList=this.ownWorkspaces,e.currentWorkspace=this.currentOwnWorkspace,e.workspacesOwnerId=e.user.id,e.projectExplorer.setExplorerColor(null),e.projectExplorer.renderWorkspaces(e.workspaceList),e.currentWorkspace==null&&e.workspaceList.length>0&&(e.currentWorkspace=e.workspaceList[0]),e.currentWorkspace!=null&&e.projectExplorer.setWorkspaceActive(e.currentWorkspace,!0),this.studentPanel.select(null,!1)}initClassPanel(){let e=this,t=I('<div class="joe_teacherExplorerClassButtons"></div>'),i=new Vg("Klassen",t,!0),n=new Vg("Prüfungen",t,!1);i.linkTo(n),this.classPanel=new xr(this.main.projectExplorer.accordion,t,"2","","","class",!1,!1,"class",!1,[]);let s=I(`<a href='administration_mc.html?csrfToken=${Bt}' target='_blank'><div class="jo_button jo_active img_gear-dark" style="margin-right: 6px" title="Prüfungen verwalten..."></d>`);this.classPanel.$captionElement.find(".jo_actions").append(s),s.attr("title","Neue Prüfung erstellen").hide(),this.classPanel.selectCallback=a=>{e.main.networkManager.sendUpdates(()=>{if(this.classPanelMode=="classes"){let l=a;l!=null&&this.renderStudents(l.students)}else this.onSelectPruefung(a)})},n.onChange(async a=>{s.toggle(200),e.classPanelMode=a?"tests":"classes",e.main.networkManager.sendUpdates(()=>{if(a){e.main.workspacesOwnerId==e.main.user.id&&(e.ownWorkspaces=e.main.workspaceList.slice(),e.currentOwnWorkspace=e.main.currentWorkspace),this.renderPruefungen();let l=this.pruefungen.find(o=>["preparing","running"].indexOf(o.state)<0);l!=null&&this.classPanel.select(l,!0,!0)}else this.renderClasses(this.classData),this.main.projectExplorer.onHomeButtonClicked()})}),s.on("pointerdown",a=>{a.stopPropagation()})}onSelectPruefung(e){this.currentPruefung=e;let t=this.main.projectExplorer;if(e.state=="preparing"||e.state=="running")alert('Die Prüfung befindet sich im Zustand "'+Ug[e.state]+`, daher kann noch keine Schülerliste zur Korrektur angezeigt werden.
Klicken Sie auf das Zahnrad rechts oberhalb der Prüfungsliste, um zur Prüfungsverwaltung zu gelangen. Dort können Sie den Zustand der Prüfung ändern.`),t.fileListPanel.clear(),t.fileListPanel.setCaption("---"),t.workspaceListPanel.clear(),this.studentPanel.clear(),this.main.getMonacoEditor().setModel(monaco.editor.createModel("Keine Datei vorhanden.","text"));else{let i=this.classData.find(n=>n.id==e.klasse_id);i!=null&&(this.renderStudents(i.students),i.students.length>0&&this.studentPanel.select(i.students[0],!0,!0))}}renderStudents(e){this.studentPanel.clear(),this.studentPanel.setCaption(e.length+" Schüler/innen"),e.sort((t,i)=>t.familienname>i.familienname?-1:i.familienname>t.familienname?1:t.rufname>i.rufname?-1:i.rufname>t.rufname?1:t.username>i.username?-1:i.username>t.username?1:0);for(let t=0;t<e.length;t++){let i=e[t],n={name:i.familienname+", "+i.rufname,sortName:i.familienname+" "+i.rufname,externalElement:i,isFolder:!1,path:[],readonly:!1,isPruefungFolder:!1};this.studentPanel.addElement(n,!0)}}renderClasses(e){this.studentPanel.clear(),this.studentPanel.setCaption("Schüler/innen"),this.classPanel.clear(),e.sort((t,i)=>t.name.localeCompare(i.name));for(let t of e){let i={name:t.name,externalElement:t,isFolder:!1,path:[],readonly:!1,isPruefungFolder:!1};this.classPanel.addElement(i,!0)}}renderPruefungen(){this.classPanel.clear(),this.pruefungen.forEach(e=>this.addPruefungToClassPanel(e))}addPruefungToClassPanel(e){let t={name:e.name,externalElement:e,isFolder:!1,path:[],iconClass:"test",readonly:!1,isPruefungFolder:!1};this.classPanel.addElement(t,!0),this.updateClassNameAndState(e)}updateClassNameAndState(e){let t=this.classPanel.findElement(e);if(t!=null){let i=this.classData.find(n=>n.id==e.klasse_id);if(i!=null){let n=t.$htmlFirstLine.find(".joe_pruefung_klasse");n.length==0&&(n=I('<span class="joe_pruefung_klasse"></span>'),n.css("margin","0 4px"),t.$htmlFirstLine.find(".jo_filename").append(n)),n.text(`(${i.name})`)}this.classPanel.setElementClass(t,"test-"+e.state,Ug[e.state])}}async fetchPruefungen(){let e=await yc("/servlet/getPruefungenForLehrkraft",{});this.pruefungen=e.pruefungen}}class FC{constructor(e){y(this,"pruefung");y(this,"timer");this.main=e,Li.subscribe("startPruefung",t=>{this.startPruefung(t.pruefung)}),Li.subscribe("stopPruefung",t=>{this.stopPruefung(!0)})}close(){this.pruefung!=null&&(Li.unsubscribe("startPruefung"),Li.unsubscribe("stopPruefung"),this.timer!=null&&clearInterval(this.timer),this.main.networkManager.sendUpdates(()=>{let e=this.main.projectExplorer;e.workspaceListPanel.show(),e.fetchAndRenderOwnWorkspaces()},!0,!1,!1),this.pruefung=null)}startPruefung(e){this.pruefung==null&&(this.pruefung=e,this.main.networkManager.sendUpdates(()=>{let t=this.main.workspaceList.filter(s=>s.pruefung_id==e.id);t.length==0&&alert("Es fehlt der Prüfungsworkspace.");let i=t[0];this.main.workspaceList=[i],this.main.currentWorkspace=i;let n=this.main.projectExplorer;n.workspaceListPanel.clear(),n.fileListPanel.clear(),n.workspaceListPanel.hide(),n.setWorkspaceActive(i),I("#pruefunglaeuft").css("display","block"),this.timer!=null&&(clearInterval(this.timer),this.timer=null),this.timer=setInterval(async()=>{let s={pruefungId:this.pruefung.id,clientState:"",running:!0};(await yc("/servlet/reportPruefungState",s)).pruefungState!="running"&&this.stopPruefung(!0)},3e3)},!0,!1,!1))}async stopPruefung(e){console.log("Stopping pruefung..."),this.timer!=null&&clearInterval(this.timer),this.timer=null,this.pruefung!=null&&(this.pruefung=null,this.main.projectExplorer.workspaceListPanel.show(),e&&await this.main.projectExplorer.fetchAndRenderOwnWorkspaces(),I("#pruefunglaeuft").css("display","none"))}}class RC{constructor(e){y(this,"logoutAfterMinutes",20);y(this,"counterInMinutes",this.logoutAfterMinutes);let t=this;setInterval(()=>{t.counterInMinutes--,t.counterInMinutes==0&&(e?e.logout():t.logout())},60*1e3),document.body.addEventListener("keydown",()=>{t.reset()}),document.body.addEventListener("mousedown",()=>{t.reset()})}reset(){this.counterInMinutes=this.logoutAfterMinutes}logout(){Nt("logout",{currentWorkspaceId:null},()=>{window.location.href="index.html"})}}class OC{constructor(e){y(this,"loggedInWithVidis",!1);this.main=e,new RC(this)}initGUI(){let e=this;I("#login").css("display","flex"),I("#bitteWarten").css("display","none"),this.startAnimations();let t=I("#login-spinner>img");I("#login-username").focus(),I("#login-username").on("keydown",n=>{n.key=="Enter"&&I("#login-password").focus()}),I("#login-password").on("keydown",n=>{n.key=="Enter"&&I("#login-button").trigger("click")}),I("#login-password").on("keydown",n=>{n.key=="Tab"&&(n.preventDefault(),I("#login-button").focus(),I("#login-button").addClass("jo_active")),n.key=="Enter"&&I("#login-button").trigger("click")}),I("#login-button").on("keydown",n=>{n.key=="Tab"?(n.preventDefault(),I("#login-username").focus(),I("#login-button").removeClass("jo_active")):I("#login-button").trigger("click")}),I("#jo_testuser-login-button").on("click",()=>{I("#login-username").val("Testuser"),I("#login-password").val(""),I("#login-button").trigger("click")});let i=!1;I("#login-button").on("click",()=>{Yn.init(),t.show(),!i&&(i=!0,setTimeout(()=>{i=!1},1e3),this.sendLoginRequest(null))}),I("#buttonLogout").on("click",()=>{e.logout()})}logout(){if(this.main.user.is_testuser){this.showLoginForm();return}this.main.interpreter.closeAllWebsockets(),I("#bitteWartenText").html("Bitte warten, der letzte Bearbeitungsstand wird noch gespeichert ..."),I("#bitteWarten").css("display","flex"),this.main.workspacesOwnerId!=this.main.user.id&&this.main.projectExplorer.onHomeButtonClicked(),this.main.networkManager.sendUpdates(()=>{var i,n,s;(i=this.main.pruefungManagerForStudents)==null||i.stopPruefung(!1),this.main.rightDiv.classDiagram.clearAfterLogout();let e={currentWorkspaceId:((n=this.main.currentWorkspace)==null?void 0:n.pruefung_id)==null?(s=this.main.currentWorkspace)==null?void 0:s.id:null},t=this;Nt("logout",e,()=>{this.loggedInWithVidis?window.location.assign("https://aai-test.vidis.schule/auth/realms/vidis/protocol/openid-connect/logout?ID_TOKEN_HINT="+this.main.user.vidis_sub+"&post_logout_redirect_uri=https%3A%2F%2Fwww.online-ide.de"):t.showLoginForm()})}),Li.getInstance().close(),ea.close()}sendLoginRequest(e){let t=this,i="login",n={username:I("#login-username").val(),password:I("#login-password").val(),singleUseToken:e};Nt(i,n,s=>{if(!s.success)I("#login-message").html("Fehler: Benutzername und/oder Passwort ist falsch."),I("#login-spinner>img").hide();else{I("#login").hide(),I("#main").css("visibility","visible"),I("#bitteWartenText").html("Bitte warten ..."),I("#bitteWarten").css("display","flex");let a=s.user;a.is_testuser=s.isTestuser,(a.settings==null||a.settings.helperHistory==null)&&(a.settings={helperHistory:{consoleHelperDone:!1,newFileHelperDone:!1,newWorkspaceHelperDone:!1,speedControlHelperDone:!1,homeButtonHelperDone:!1,stepButtonHelperDone:!1,repositoryButtonDone:!1,folderButtonDone:!1},viewModes:null,classDiagram:null}),t.main.user=a,Kr.sqlIdeURL=s.sqlIdeForOnlineIdeClient+"/servlet/",this.main.waitForGUICallback=()=>{var o,u,h,d,p,v;t.main.mainMenu.initGUI(a,""),(o=t.main.bottomDiv.gradingManager)==null||o.initGUI(),I("#bitteWarten").hide(),I("#login-spinner>img").hide(),I("#menupanel-username").html(Co(IC(a))),new Hw(t.main).init(),a.is_teacher&&t.main.initTeacherExplorer(s.classdata),t.main.workspacesOwnerId=a.id,t.main.restoreWorkspaces(s.workspaces,!0),t.main.networkManager.initializeTimer(),t.main.projectExplorer.fileListPanel.setFixed(!a.is_teacher),t.main.projectExplorer.workspaceListPanel.setFixed(!a.is_teacher),(h=(u=t.main.rightDiv)==null?void 0:u.classDiagram)==null||h.clear(),a.settings.classDiagram!=null&&((p=(d=t.main.rightDiv)==null?void 0:d.classDiagram)==null||p.deserialize(a.settings.classDiagram)),t.main.viewModeController.initViewMode(),t.main.bottomDiv.hideHomeworkTab(),!this.main.user.settings.helperHistory.folderButtonDone&&t.main.projectExplorer.workspaceListPanel.elements.length>5&&rn.showHelper("folderButton",this.main,I(".img_add-folder-dark")),t.main.networkManager.initializeSSE(),(v=this.main.pruefungManagerForStudents)==null||v.close(),!a.is_teacher&&!a.is_admin&&!a.is_schooladmin&&(this.main.pruefungManagerForStudents=new FC(this.main),s.activePruefung!=null&&(this.main.workspaceList.filter(w=>w.pruefung_id==s.activePruefung.id)[0].getWorkspaceData(!0),this.main.pruefungManagerForStudents.startPruefung(s.activePruefung)))},this.main.startupComplete==0&&(this.main.waitForGUICallback(),this.main.waitForGUICallback=null)}},s=>{I("#login-message").html("Login gescheitert: "+s),I("#login-spinner>img").hide()})}loginWithVidis(e){this.loggedInWithVidis=!0,I("#login").hide(),I("#main").css("visibility","visible"),I("#bitteWartenText").html("Bitte warten ..."),I("#bitteWarten").css("display","flex"),this.sendLoginRequest(e)}showLoginForm(){var e,t;I("#login").show(),I("#main").css("visibility","hidden"),I("#bitteWarten").css("display","none"),I("#login-message").empty(),this.main.interpreter.setState(Re.not_initialized),this.main.getMonacoEditor().setModel(monaco.editor.createModel("","myJava")),this.main.projectExplorer.fileListPanel.clear(),this.main.projectExplorer.fileListPanel.setCaption(""),this.main.projectExplorer.workspaceListPanel.clear(),(t=(e=this.main.bottomDiv)==null?void 0:e.console)==null||t.clear(),this.main.interpreter.printManager.clear(),this.main.teacherExplorer!=null&&(this.main.teacherExplorer.removePanels(),this.main.teacherExplorer=null),this.main.currentWorkspace=null,this.main.user=null}startAnimations(){}}class LC{constructor(e,t){y(this,"$buttonEditorFullscreen");y(this,"$buttonPresentationMode");y(this,"$buttonMonitorMode");y(this,"$buttonMap",{});y(this,"highContrast",!1);y(this,"editorHasFullWidth",!1);y(this,"rightDivWidth");y(this,"editorWidth");this.$buttonsContainer=e,this.main=t,this.$buttonEditorFullscreen=I('<div title="Editor in voller Breite" class="img_whole-window jo_button jo_active" style="padding: 1px; margin-right: 8px"></div>'),this.$buttonPresentationMode=I('<div title="Präsentation (Beamer)" class="img_presentation-mode jo_button jo_active" syle="padding: 1px"></div>'),this.$buttonMonitorMode=I('<div title="Monitor" class="img_monitor-mode jo_button jo_active" style="margin-left: 5px; padding: 1px"></div>'),e.append(this.$buttonEditorFullscreen,this.$buttonPresentationMode,this.$buttonMonitorMode),this.$buttonMap={presentation:this.$buttonPresentationMode,monitor:this.$buttonMonitorMode};let i=this.main.actionManager;i.registerAction("editor.fullwidth",[],()=>{this.toggleEditorFullwidth()},"Editor auf die volle Breite erweitern",this.$buttonEditorFullscreen),i.registerAction("viewmode.presentation",[],()=>{this.setMode("presentation")},"Präsentationsansicht",this.$buttonPresentationMode),i.registerAction("viewmode.monitor",[],()=>{this.setMode("monitor")},"Monitoransicht",this.$buttonMonitorMode)}toggleEditorFullwidth(){this.editorHasFullWidth?(this.$buttonEditorFullscreen.removeClass("img_whole-window-back"),this.$buttonEditorFullscreen.addClass("img_whole-window"),this.$buttonEditorFullscreen.attr("title","Editor in voller Breite"),I("#rightdiv").css("width",this.rightDivWidth+"px"),I("#editor>.monaco-editor").css("width",this.editorWidth+"px"),I("#rightdiv").show(600),I("#leftpanel").show(600),I("#controls").show()):(this.$buttonEditorFullscreen.removeClass("img_whole-window"),this.$buttonEditorFullscreen.addClass("img_whole-window-back"),this.$buttonEditorFullscreen.attr("title","Editor in normaler Breite"),this.rightDivWidth=Number.parseInt(I("#rightdiv").css("width").replace("px","")),this.editorWidth=Number.parseInt(I("#editor>.monaco-editor").css("width").replace("px","")),I("#rightdiv").hide(600),I("#leftpanel").hide(600),I("#controls").hide(),this.main.getInterpreter().stop()),setTimeout(()=>{this.main.getMonacoEditor().layout()},800),this.editorHasFullWidth=!this.editorHasFullWidth}setMode(e,t=!0){let i=e=="presentation"?"monitor":"presentation";this.$buttonMap[e].addClass("jo_pressed"),this.$buttonMap[i].removeClass("jo_pressed");let s=this.main.user.settings.viewModes,a=s[e];s.viewModeChosen=e,this.main.themeManager.switchTheme(a.theme),this.main.editor.setFontSize(a.fontSize),this.highContrast!=a.highContrast&&(this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.highContrast=!this.highContrast),t&&this.saveSettings()}saveFontSize(e){let t=this.getChosenViewMode();t.fontSize=e,this.saveSettings()}setTheme(e){let t=this.getChosenViewMode();t.theme=e,this.main.themeManager.switchTheme(t.theme),this.saveSettings()}toggleHighContrast(){let e=this.getChosenViewMode();e.highContrast=!e.highContrast,this.main.getMonacoEditor().getAction("editor.action.toggleHighContrast").run(),this.saveSettings()}getChosenViewMode(){let e=this.main.user.settings.viewModes;return e[e.viewModeChosen]}saveSettings(){this.main.userDataDirty=!0}initViewMode(){let e=this.main.user.settings;e.viewModes==null&&(e.viewModes={monitor:null,presentation:null,viewModeChosen:"monitor"}),e.viewModes.monitor==null&&(e.viewModes.monitor={fontSize:14,highContrast:!1,theme:"dark"},e.viewModes.presentation={fontSize:18,highContrast:!1,theme:"light"},this.saveSettings()),this.setMode(e.viewModes.viewModeChosen,!1)}}class hb{constructor(e){y(this,"semicolonPositions",[]);y(this,"time");this.main=e}startRegistering(){this.semicolonPositions.forEach(e=>e.isThereAgain=!1),this.time=new Date().getTime(),this.semicolonPositions=this.semicolonPositions.filter(e=>this.time-e.firstSeenMs<5e3)}register(e,t){let i=this.semicolonPositions.find(n=>n.position.line==e.line&&n.position.column==e.column);i?i.isThereAgain=!0:this.semicolonPositions.push({position:e,firstSeenMs:this.time,isThereAgain:!0,module:t})}healSemicolons(){let e=new Date().getTime();this.semicolonPositions=this.semicolonPositions.filter(s=>s.isThereAgain);let t=this.main.getCurrentlyEditedModule();if(this.main.getMonacoEditor().getPosition()==null)return;let n=this.main.getMonacoEditor().getPosition().lineNumber;this.semicolonPositions.filter(s=>e-s.firstSeenMs>2e3).forEach(s=>{let a=s.module.file.id!=null&&s.module.file.id==t.file.id,l=[{range:new monaco.Range(s.position.line,s.position.column,s.position.line,s.position.column),text:";",forceMoveMarkers:!0}];if(a&&Math.abs(n-s.position.line)>1){let o=s.module.model.getValueInRange(new monaco.Range(s.position.line,0,s.position.line,1e4)).trim(),u=s.module.model.getValueInRange(new monaco.Range(s.position.line+1,0,s.position.line+2,1e4)).trim();if(!o.endsWith(";")&&!o.endsWith("{")&&!u.startsWith("{")){let d=this.main.getMonacoEditor();const p=d.getSelection();d.executeEdits("Semicolon-Angel",l),d.setSelection(p),this.semicolonPositions.splice(this.semicolonPositions.indexOf(s),1)}}})}}class BC{constructor(e){y(this,"backButtonListener");y(this,"oneTimeBackButtonListener");this.main=e;let t=this;history.pushState("PreventLeavingSite",""),window.addEventListener("popstate",i=>{i.state=="PreventLeavingSite"?(history.pushState("PreventLeavingSite",""),t.main.editor.pushHistoryState(!1,t.main.editor.getPositionForHistory())):this.oneTimeBackButtonListener==null&&this.backButtonListener(i),this.oneTimeBackButtonListener!=null&&(this.oneTimeBackButtonListener(),this.oneTimeBackButtonListener=null)})}registerBackButtonListener(e){this.backButtonListener=e}registerOneTimeBackButtonListener(e){this.oneTimeBackButtonListener=e,history.pushState({},"")}}class zC{start(e,t,i){let n=!1;for(let l of e)if(l.isFolder&&l.moduleStore.getModules(!1).length>0){console.log("Folder "+l.path+"/"+l.name+" contains files. -> Make new folder and transforming existing one to workspace.");let o=new mn(l.name,i,l.owner_id);o.isFolder=!0,o.path=l.path,e.push(o),t.sendCreateWorkspace(o,o.owner_id,u=>{u==null||u==""?console.log("Successfully created new Folder."):console.log("Error creating folder: "+u)}),l.isFolder=!1,l.name+=" (ws)",l.saved=!1,n=!0}let s=e.filter(l=>l.isFolder);for(let l of s){let o=[];for(let u of s)u!=l&&u.path==l.path&&u.name==l.name&&o.push(u);if(o.length>0){console.log(""+(o.length+1)+" folders with name "+l.path+"/"+l.name+"=> renaming them with suffixes (1), (2), ...");for(let u=0;u<o.length;u++)o[u].name+=" ("+(u+1)+")",o[u].saved=!1;n=!0}}let a=[];for(let l of s){let o=l.path;o!=""&&!o.endsWith("/")&&(o+="/"),o+=l.name,a.push(o)}for(let l of e)!l.isFolder&&l.pruefung_id==null&&l.path!=""&&l.path!=null&&a.indexOf(l.path)<0&&(console.log("Found workspace ("+l.path+"/"+l.name+") with path not corresponding to any folder => Set path = ''."),l.path="",l.saved=!1,n=!0);n&&t.sendUpdates(()=>{},!0)}}class ul{constructor(){y(this,"pixiApp");y(this,"userSpritesheet");y(this,"repositoryOn",!0);y(this,"workspaceList",[]);y(this,"workspacesOwnerId");y(this,"editor");y(this,"currentWorkspace");y(this,"projectExplorer");y(this,"teacherExplorer");y(this,"networkManager");y(this,"actionManager");y(this,"mainMenu");y(this,"synchronizationManager");y(this,"repositoryCreateManager");y(this,"repositoryUpdateManager");y(this,"repositoryCheckoutManager");y(this,"pruefungManagerForStudents");y(this,"spriteManager");y(this,"windowStateManager",new BC(this));y(this,"login");y(this,"compiler");y(this,"interpreter");y(this,"debugger");y(this,"semicolonAngel");y(this,"bottomDiv");y(this,"startupComplete",2);y(this,"waitForGUICallback");y(this,"programIsExecutable",!1);y(this,"version",0);y(this,"timerHandle");y(this,"user");y(this,"userDataDirty",!1);y(this,"themeManager");y(this,"rightDiv");y(this,"debounceDiagramDrawing");y(this,"viewModeController")}isTest(){return window.location.href.indexOf("online-ide")<0}isEmbedded(){return!1}getInterpreter(){return this.interpreter}getCurrentWorkspace(){return this.currentWorkspace}getDebugger(){return this.debugger}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getCurrentlyEditedModule(){return this.projectExplorer.getCurrentlyEditedModule()}getActionManager(){return this.actionManager}showProgramPointerPosition(e,t){this.projectExplorer.showProgramPointerPosition(e,t)}hideProgramPointerPosition(){this.projectExplorer.hideProgramPointerPosition()}getCompiler(){return this.compiler}setModuleActive(e){this.projectExplorer.setModuleActive(e)}getSemicolonAngel(){return this.semicolonAngel}jumpToDeclaration(e,t){this.projectExplorer.setModuleActive(e),this.editor.editor.revealLineInCenter(t.position.line),this.editor.editor.setPosition({column:t.position.column,lineNumber:t.position.line})}initGUI(){Tw(),this.login=new OC(this);let e=Ew("singleUseToken");e?(this.login.initGUI(),this.login.loginWithVidis(e)):this.login.initGUI(),this.actionManager=new bm(null,this),this.actionManager.init(),this.networkManager=new vw(this,I("#bottomdiv-outer .jo_updateTimerDiv")),new PC(this).initSliders(),this.mainMenu=new Uw(this),this.projectExplorer=new TC(this,I("#leftpanel>.jo_projectexplorer")),this.projectExplorer.initGUI(),this.bottomDiv=new vm(this,I("#bottomdiv-outer>.jo_bottomdiv-inner"),I("body")),this.rightDiv=new ub(this,I("#rightdiv-inner")),this.rightDiv.initGUI(),this.debugger=new ym(this,I("#leftpanel>.jo_debugger"),I("#leftpanel>.jo_projectexplorer")),this.interpreter=new cb(this,this.debugger,new Sm(I("#controls"),I("#editor")),I("#rightdiv-inner .jo_run")),this.interpreter.initGUI(),this.initTypes(),this.checkStartupComplete(),window.UZIP=null,this.correctPIXITransform(),ge.RENDER_OPTIONS.hello=!1,this.themeManager=new lm,this.viewModeController=new LC(I("#view-mode"),this),this.semicolonAngel=new hb(this)}correctPIXITransform(){Pr.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var i=e.worldTransform,n=this.worldTransform;n.a=t.a*i.a+t.b*i.c,n.b=t.a*i.b+t.b*i.d,n.c=t.c*i.a+t.d*i.c,n.d=t.c*i.b+t.d*i.d,n.tx=t.tx*i.a+t.ty*i.c+i.tx,n.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}}initEditor(){this.editor=new wm(this,!0,!1),new pc().init(),this.editor.initGUI(I("#editor"));let e=this;I(window).on("resize",t=>{I("#bottomdiv-outer").css("height","150px"),I("#editor").css("height",window.innerHeight-150-30-2+"px"),e.editor.editor.layout(),I("#editor").css("height","")}),I(window).trigger("resize")}initTeacherExplorer(e){this.teacherExplorer!=null&&this.teacherExplorer.removePanels(),this.teacherExplorer=new DC(this,e),this.teacherExplorer.initGUI()}checkStartupComplete(){this.startupComplete--,this.startupComplete==0&&this.start()}initTypes(){U.init(),C.init(),se.init(),it.init(),G.init(),A.init(),P.init(),F.init(),Ge.init(),lc.init(),oc.init(),uc.init(),hc.init(),dc.init(),cc.init()}start(){this.waitForGUICallback!=null&&this.waitForGUICallback();let e=this;setTimeout(()=>{e.getMonacoEditor().layout()},200),this.compiler=new um(this),this.startTimer(),I(window).on("unload",function(){navigator.sendBeacon&&e.user!=null&&(e.networkManager.sendUpdates(null,!1,!0),e.networkManager.sendUpdateUserSettings(()=>{}),e.interpreter.closeAllWebsockets(),ea.close(),Li.getInstance().close())})}startTimer(){this.timerHandle!=null&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval(()=>{e.compileIfDirty()},500)}compileIfDirty(){var e,t;if(this.currentWorkspace!=null&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=Za.compiling&&this.interpreter.state!=Re.running&&this.interpreter.state!=Re.paused)try{this.compiler.compile(this.currentWorkspace.moduleStore);let i=(t=(e=this.bottomDiv)==null?void 0:e.errorManager)==null?void 0:t.showErrors(this.currentWorkspace);this.projectExplorer.renderErrorCount(this.currentWorkspace,i),this.editor.onDidChangeCursorPosition(null),this.printProgram(),this.projectExplorer&&this.version++;let n=this.interpreter.getStartableModule(this.currentWorkspace.moduleStore)!=null;n&&this.interpreter.state==Re.not_initialized&&(this.copyExecutableModuleStoreToInterpreter(),this.interpreter.setState(Re.done)),!n&&(this.interpreter.state==Re.done||this.interpreter.state==Re.error)&&this.interpreter.setState(Re.not_initialized),this.drawClassDiagrams(!this.rightDiv.isClassDiagramEnabled())}catch(i){console.error(i),this.compiler.compilerStatus=Za.error}}printProgram(){this.bottomDiv.printModuleToBottomDiv(this.currentWorkspace,this.projectExplorer.getCurrentlyEditedModule())}drawClassDiagrams(e){clearTimeout(this.debounceDiagramDrawing),this.debounceDiagramDrawing=setTimeout(()=>{var t,i;(i=(t=this.rightDiv)==null?void 0:t.classDiagram)==null||i.drawDiagram(this.currentWorkspace,e)},500)}copyExecutableModuleStoreToInterpreter(){let e=this.currentWorkspace.moduleStore.copy();this.interpreter.moduleStore=e,this.interpreter.moduleStoreVersion=this.version,this.interpreter.state==Re.not_initialized&&this.programIsExecutable&&this.interpreter.setState(Re.done)}removeWorkspace(e){this.workspaceList.splice(this.workspaceList.indexOf(e),1)}restoreWorkspaces(e,t){this.workspaceList=[],this.currentWorkspace=null,this.getMonacoEditor().updateOptions({readOnly:!0});for(let i of e.workspaces){let n=mn.restoreFromData(i,this);this.workspaceList.push(n),i.id==this.user.currentWorkspace_id&&(this.currentWorkspace=n)}t&&new zC().start(this.workspaceList,this.networkManager,this),this.projectExplorer.renderWorkspaces(this.workspaceList),this.currentWorkspace==null&&this.workspaceList.length>0&&(this.currentWorkspace=this.workspaceList[0]),this.currentWorkspace!=null?this.projectExplorer.setWorkspaceActive(this.currentWorkspace,!0):this.projectExplorer.setModuleActive(null),this.workspaceList.length==0&&rn.showHelper("newWorkspaceHelper",this,this.projectExplorer.workspaceListPanel.$captionElement),Math.random()<.9&&rn.showHelper("spritesheetHelper",this)}restoreWorkspaceFromData(e){return mn.restoreFromData(e,this)}}class rn{static openHelper(e,t,i){let n=I(".jo_arrow_box");n.removeClass(["jo_arrow_box_left","jo_arrow_box_right","jo_arrow_box_top","jo_arrow_box_bottom"]),n.addClass("jo_arrow_box_"+i),n.css({left:"",right:"",top:"",bottom:""});let s=t.offset(),a=I("body"),l=34;switch(i){case"bottom":n.css({left:s.left+t.width()/2-l,bottom:a.height()-s.top+l});break;case"top":n.css({left:s.left+t.width()/2-l,top:s.top+t.height()+26});break;case"left":n.css({left:s.left+t.width()+l,top:s.top+t.height()/2-l});break;case"right":n.css({right:a.width()-s.left,top:s.top+t.height()/2-l});break}n.find("span").html(e);let o=n.find(".jo_button");o.on("click",u=>{u.stopPropagation(),o.off("click"),rn.close()}),n.fadeIn(800)}static close(){I(".jo_arrow_box").fadeOut(800)}static showHelper(e,t,i){let n;if(t instanceof ul)n=t;else return;let s=n.user.settings.helperHistory;if(e=="speedControlHelper"&&s.speedControlHelperDone&&(e="stepButtonHelper"),e=="spritesheetHelper"&&!s.newFileHelperDone)return;let a=e+"Done";if(s!=null&&(s[a]==null||!s[a])){s[a]=!0,n.networkManager.sendUpdateUserSettings(()=>{});let l="",o="left";switch(e){case"folderButton":l=`Mit diesem Button können Sie in der Liste der Workspaces Ordner anlegen. 
                    <ul>
                    <li>Bestehende Workspaces lassen sich mit der Maus in Ordner ziehen.</li>
                    <li>Wollen Sie einen Workspace in die oberste Ordnerebene bringen, so ziehen Sie ihn einfach auf den "Workspaces"-Balken.</li>
                    <li>Über das Kontextmenü der Ordner lassen sich Workspaces und Unterordner anlegen.</li>
                    </ul>`,o="top";break;case"repositoryButton":l='Wenn der aktuelle Workspace mit einem Repository verknüft ist, erscheint hier der "Synchronisieren-Button". Ein Klick darauf öffnet einen Dialog, in dem die Dateien des Workspace mit denen des Repositorys abgeglichen werden können.',o="top";break;case"speedControlHelper":l=`Mit dem Geschwindigkeitsregler können  
                            Sie einstellen, wie schnell das Programm abläuft. 
                            Bei Geschwindigkeiten bis 10 Steps/s wird 
                            während des Programmablaufs der Programzeiger gezeigt
                            und die Anzeige der Variablen auf der linken 
                            Seite stets aktualisiert.`,o="top",i=n.interpreter.controlButtons.speedControl.$grip;break;case"newFileHelper":l=`Es gibt noch keine Programmdatei im Workspace. <br> Nutzen Sie den Button 
                        <span class='img_add-file-dark jo_inline-image'></span> um eine Programmdatei anzulegen.
                        `,o="left";break;case"newWorkspaceHelper":l=`Es gibt noch keinen Workspace. <br> Nutzen Sie den Button
                        <span class='img_add-workspace-dark jo_inline-image'></span> um einen Workspace anzulegen.
                        `,o="left";break;case"homeButtonHelper":l="Mit dem Home-Button <span class='img_home-dark jo_inline-image'></span> können Sie wieder zu Ihren eigenen Workspaces wechseln.",o="top",i=I(".img_home-dark");break;case"stepButtonHelper":l=`Mit den Buttons "Step over"
                        (<span class='img_step-over-dark jo_inline-image'></span>, Taste F8), 
                        "Step into" 
                        (<span class='img_step-into-dark jo_inline-image'></span>, Taste F7) und 
                        "Step out" 
                        (<span class='img_step-out-dark jo_inline-image'></span>, Taste F9)  
                        können Sie das Programm schrittweise ausführen und sich nach jedem Schritt die Belegung der Variablen ansehen. <br>
                        <ul><li><span class='img_step-over-dark jo_inline-image'></span> Step over führt den nächsten Schritt aus, insbesondere werden Methodenaufrufe in einem Schritt durchgeführt.</li>
                        <li><span class='img_step-into-dark jo_inline-image'></span> Step into führt auch den nächsten Schritt aus, geht bei Methodenaufrufen aber in die Methode hinein und führt auch die Anweisungen innerhalb der Methode schrittweise aus.</li>
                        <li><span class='img_step-out-dark jo_inline-image'></span> Befindet sich die Programmausführung innerhalb einer Methode, so bewirkt ein Klick auf Step out, dass der Rest der Methode ausgeführt wird und die Programmausführung erst nach der Aufrufstelle der Methode anhält.</li>
                        </ul>
                        `,o="top",i=n.interpreter.controlButtons.$buttonStepOver;break;case"consoleHelper":l=`
                        Hier können Sie Anweisungen oder Terme eingeben, die nach Bestätigung mit der Enter-Taste ausgeführt/ausgewertet werden. Das Ergebnis sehen Sie im Bereich über der Eingabezeile. <br>
                        Falls das Programm gerade pausiert (z.B. bei Ausführung in Einzelschritten) können Sie auch auf die Variablen des aktuellen Sichtbarkeitsbereiches zugreifen.
                    `,o="bottom",i=n.bottomDiv.console.$consoleTab.find(".jo_monaco-editor");break;case"spritesheetHelper":l=`Unter "Sprites -> Spritesheet ergänzen" können Sie eigene png-Grafikdateien hochladen und dann als Sprites verwenden. Die Sprites werden je Workspace bzw. je Repository gespeichert.
                    <br><br>Die Übersicht der fest in die Online-IDE integrierten Sprites finden Sie jetzt nicht mehr im Hilfe-Menü, sondern auch hier unter "Sprites->Sprite-Bilderübersicht".`,o="top",i=I("#mainmenu").find('div:contains("Sprites")');break}l!=""&&i!=null&&i.length>0&&rn.openHelper(l,i,o)}}}class $g{constructor(e,t){y(this,"element");y(this,"pressedKeys",{});y(this,"keyPressedCallbacks",[]);y(this,"keyUpCallbacks",[]);y(this,"keyDownCallbacks",[]);this.main=t,this.registerListeners(e)}unregisterListeners(){this.element.off("keydown"),this.element.off("keyup"),this.element.off("keypressed")}registerListeners(e){this.element=e;let t=this;e.on("keydown",i=>{let n=i.key;if(n==null)return!0;t.pressedKeys[n.toLowerCase()]=!0;for(let s of t.keyDownCallbacks)s(n,i.shiftKey,i.ctrlKey,i.altKey);return this.main.isEmbedded()&&this.main.getInterpreter().state==Re.running&&!this.main.getMonacoEditor().hasTextFocus()&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(i.key)>=0&&i.preventDefault(),!0}),e.on("keyup",i=>{let n=i.key;if(n==null)return!0;if(!(typeof n>"u")){t.pressedKeys[n.toLowerCase()]=!1;for(let s of t.keyUpCallbacks)s(n);return!0}}),e.on("keyup",i=>{let n=i.key;i.shiftKey&&n.length>1&&(n="[shift]+"+n),i.ctrlKey&&n.length>1&&(n="[ctrl]+"+n),i.altKey&&n.length>1&&(n="[alt]+"+n);for(let s of t.keyPressedCallbacks)s(n);return!0})}isPressed(e){return e==null?null:this.pressedKeys[e.toLowerCase()]==!0}unsubscribeAllListeners(){this.keyPressedCallbacks=[]}}class jC{constructor(){y(this,"gamepads",[]);let e=this;window.addEventListener("gamepadconnected",function(t){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),e.gamepads.indexOf(t.gamepad)<0&&e.gamepads.push(t.gamepad)}),window.addEventListener("gamepaddisconnected",function(t){console.log("Gamepad disconnected from index %d: %s",t.gamepad.index,t.gamepad.id);let i=e.gamepads.indexOf(t.gamepad);i>=0&&e.gamepads.splice(i,1)})}isGamepadButtonPressed(e,t){let i=navigator.getGamepads()[e];if(i==null)return!1;let n=i.buttons[t];return n?n.pressed:!1}getGamepadAxisValue(e,t){let i=navigator.getGamepads()[e];return i==null?0:i.axes[t]}isGamepadConnected(e){return navigator.getGamepads()[e]!=null}}var Re=(r=>(r[r.not_initialized=0]="not_initialized",r[r.running=1]="running",r[r.paused=2]="paused",r[r.error=3]="error",r[r.done=4]="done",r[r.waitingForDB=5]="waitingForDB",r[r.waitingForInput=6]="waitingForInput",r[r.waitingForTimersToEnd=7]="waitingForTimersToEnd",r))(Re||{});class cb{constructor(e,t,i,n){y(this,"debugger");y(this,"mainModule");y(this,"moduleStore");y(this,"moduleStoreVersion",-100);y(this,"printManager");y(this,"inputManager");y(this,"stepsPerSecond",2);y(this,"maxStepsPerSecond",1e6);y(this,"timerDelayMs",10);y(this,"timerId");y(this,"state");y(this,"currentProgram");y(this,"currentProgramPosition");y(this,"currentMethod");y(this,"currentCallbackAfterReturn");y(this,"currentIsCalledFromOutside");y(this,"programStack",[]);y(this,"stack",[]);y(this,"stackframes",[]);y(this,"currentStackframe");y(this,"heap",{});y(this,"timerStopped",!0);y(this,"timerExtern",!1);y(this,"steps",0);y(this,"timeNetto",0);y(this,"timeWhenProgramStarted",0);y(this,"stepOverNestingLevel",0);y(this,"leaveLine",-1);y(this,"additionalStepFinishedFlag",!1);y(this,"isFirstStatement",!0);y(this,"showProgrampointerUptoStepsPerSecond",1e3);y(this,"worldHelper");y(this,"gngEreignisbehandlungHelper");y(this,"processingHelper");y(this,"databaseConnectionHelpers",[]);y(this,"keyboardTool");y(this,"gamepadTool");y(this,"webSocketsToCloseAfterProgramHalt",[]);y(this,"pauseUntil");y(this,"actions",["start","pause","stop","stepOver","stepInto","stepOut","restart"]);y(this,"buttonActiveMatrix",{start:[!1,!1,!0,!0,!0,!1],pause:[!1,!0,!1,!1,!1,!1],stop:[!1,!0,!0,!1,!1,!0],stepOver:[!1,!1,!0,!0,!0,!1],stepInto:[!1,!1,!0,!0,!0,!1],stepOut:[!1,!1,!0,!1,!1,!1],restart:[!1,!0,!0,!0,!0,!0]});y(this,"callbackAfterExecution");y(this,"timerEvents",0);y(this,"lastStepTime",0);y(this,"lastTimeBetweenEvents",0);y(this,"lastPrintedModule",null);y(this,"stepFinished",!1);y(this,"oldState");y(this,"runningStates",[2,1,6,5]);this.main=e,this.debugger_=t,this.controlButtons=i,this.printManager=new fw(n,this.main),this.inputManager=new pw(n,this.main),e.isEmbedded()?this.keyboardTool=new $g(I("html"),e):this.keyboardTool=new $g(I(window),e),this.gamepadTool=new jC,this.debugger=t,i.setInterpreter(this),this.timeWhenProgramStarted=performance.now(),this.steps=0,this.timeNetto=0,this.timerEvents=0,this.timerDelayMs=7;let s=this,a=()=>{s.timerExtern||s.timerFunction(s.timerDelayMs,!1,.7)};this.timerId=setInterval(a,this.timerDelayMs);let o=JSON.stringify({command:5});setInterval(()=>{s.webSocketsToCloseAfterProgramHalt.forEach(u=>u.send(o))},3e4)}initGUI(){let e=this,t=this.main.getActionManager(),i=()=>{e.stepOverNestingLevel=1e6,e.start()},n=()=>{e.pause()};t.registerAction("interpreter.start",["F4"],()=>{t.isActive("interpreter.start")?i():n()},"Programm starten",this.controlButtons.$buttonStart),t.registerAction("interpreter.pause",["F4"],()=>{t.isActive("interpreter.start")?i():n()},"Pause",this.controlButtons.$buttonPause),t.registerAction("interpreter.stop",[],()=>{e.stop(!1),e.steps=0},"Programm anhalten",this.controlButtons.$buttonStop),t.registerAction("interpreter.stepOver",["F6"],()=>{this.oneStep(!1)},"Einzelschritt (Step over)",this.controlButtons.$buttonStepOver),t.registerAction("interpreter.stepInto",["F7"],()=>{this.oneStep(!0)},"Einzelschritt (Step into)",this.controlButtons.$buttonStepInto),t.registerAction("interpreter.stepOut",[],()=>{this.stepOut()},"Step out",this.controlButtons.$buttonStepOut),t.registerAction("interpreter.restart",[],()=>{e.stop(!0)},"Neu starten",this.controlButtons.$buttonRestart),this.setState(0)}getStartableModule(e){let t;t=this.main.getCurrentlyEditedModule();let i=!1;if(t!=null){let n=e.findModuleByFile(t.file);if(n!=null&&(i=!t.hasErrors()&&!n.isStartable,n.isStartable))return n}if(this.mainModule!=null&&i){let n=e.findModuleByFile(this.mainModule.file);if(n!=null&&n.isStartable)return n}if(i){for(let n of e.getJavaModules(!1))if(n.isStartable)return n}return null}init(){var i,n,s,a;this.timerStopped=!0,this.main.getCurrentlyEditedModule().getBreakpointPositionsFromEditor(),(n=(i=this.main.getBottomDiv())==null?void 0:i.console)==null||n.clearExceptions(),this.moduleStoreVersion!=this.main.version&&this.main.getCompiler().atLeastOneModuleIsStartable&&(this.main.copyExecutableModuleStoreToInterpreter(),this.heap={},(a=(s=this.main.getBottomDiv())==null?void 0:s.console)==null||a.detachValues());let t=this.getStartableModule(this.moduleStore);if(t==null){this.setState(0);return}this.mainModule=t,this.currentProgramPosition=0,this.programStack=[],this.stack=[],this.stackframes=[],this.currentStackframe=0,this.setState(4),this.isFirstStatement=!0,this.stepOverNestingLevel=1e6,this.programStack.push({program:this.mainModule.mainProgram,programPosition:0,textPosition:{line:1,column:1,length:0},method:"Hauptprogramm",callbackAfterReturn:null,isCalledFromOutside:"Hauptprogramm"});for(let l of this.moduleStore.getJavaModules(!1))this.initializeEnums(l),this.initializeClasses(l);this.popProgram()}popProgram(){let e=this.programStack.pop();if(this.currentProgram=e.program,this.currentProgramPosition=e.programPosition,this.currentMethod=e.method,this.currentCallbackAfterReturn=e.callbackAfterReturn,this.currentIsCalledFromOutside=e.isCalledFromOutside,e.stackElementsToPushBeforeFirstExecuting!=null){this.stackframes.push(this.currentStackframe==null?0:this.currentStackframe),this.currentStackframe=this.stack.length;for(let t of e.stackElementsToPushBeforeFirstExecuting)this.stack.push(t);e.stackElementsToPushBeforeFirstExecuting=null}}initializeClasses(e){for(let t of e.typeStore.typeList)if(t instanceof $&&(t.staticClass.classObject=new he(t.staticClass),t.pushStaticInitializationPrograms(this.programStack)),t instanceof $t){let i=t.staticClass.classObject.attributes;for(let n of t.enumInfoList)i[n.ordinal].value=n.object}}initializeEnums(e){for(let t of e.typeStore.typeList)if(t instanceof $t){t.pushStaticInitializationPrograms(this.programStack);let i=[],n={module:t.module,labelManager:null,statements:[]},s=t.attributeInitializationProgram.statements.length>0;s&&this.programStack.push({program:n,programPosition:0,textPosition:{line:1,column:1,length:0},method:"Attribut-Initialisierung der Klasse "+t.identifier,callbackAfterReturn:null,isCalledFromOutside:"Initialisierung eines Enums"});for(let a of t.enumInfoList)a.object=new om(t,a),i.push({type:t,value:a.object}),a.constructorCallProgram!=null&&this.programStack.push({program:a.constructorCallProgram,programPosition:0,textPosition:{line:1,column:1,length:0},method:"Konstruktor von "+t.identifier,callbackAfterReturn:null,isCalledFromOutside:"Initialisierung eines Enums"}),s&&n.statements.push({type:f.initializeEnumValue,position:a.position,enumClass:t,valueIdentifier:a.identifier});s&&n.statements.push({type:f.programEnd,position:{line:0,column:0,length:1}}),t.valueList={type:new ze(t),value:i}}}start(e){var t,i;(i=(t=this.main.getBottomDiv())==null?void 0:t.console)==null||i.clearErrors(),this.callbackAfterExecution=e,this.isFirstStatement=!0,this.pauseUntil=null,(this.state==3||this.state==4)&&(this.init(),this.resetRuntime()),this.setState(1),this.hideProgrampointerPosition(),this.timeWhenProgramStarted=performance.now(),this.timerStopped=!1,this.getTimerClass().startTimer()}getTimerClass(){return this.main.getCurrentWorkspace().moduleStore.getModule("Base Module").typeStore.getType("Timer")}timerFunction(e,t,i){let n=performance.now();if(!t){let u=1e3/this.stepsPerSecond;if(this.timerStopped||n-this.lastStepTime<u)return;this.lastStepTime=n}this.lastTimeBetweenEvents=n-this.lastStepTime;let s=t?Number.MAX_SAFE_INTEGER:this.stepsPerSecond*this.timerDelayMs/1e3;this.timerEvents++;let a,l=0;for(;l<s&&!this.timerStopped&&a==null&&(performance.now()-n)/e<i&&(a=this.nextStep(),a==null);){if(this.stepsPerSecond<=this.showProgrampointerUptoStepsPerSecond&&!t&&this.showProgramPointerAndVariables(),(this.state==3||this.state==4)&&(this.timerStopped=!0),this.stepOverNestingLevel<0&&!this.timerStopped){let h=this.currentProgram.statements[this.currentProgramPosition].position;(h==null||h.line!=this.leaveLine)&&(this.timerStopped=!0,this.setState(2),this.comesStatement(f.closeStackframe)&&(a=this.nextStep(),a==null&&this.comesStatement(f.programEnd)&&(a=this.nextStep())))}l++}a!=null&&this.throwException(a),this.timerStopped&&((this.state==2||this.state==6)&&this.showProgramPointerAndVariables(),this.callbackAfterExecution!=null&&(this.callbackAfterExecution(),this.callbackAfterExecution=null));let o=performance.now()-n;this.timeNetto+=o}throwException(e){var n,s,a;this.timerStopped=!0,this.setState(3);let t=I('<div class="jo_exception"></div>'),i=!0;if(this.main.isEmbedded()){let o=this.main.config;if(o.withBottomPanel!=!0&&o.withConsole!=!0){i=!1;let u="",h=this.currentProgram.statements[this.currentProgramPosition];if(h!=null){let d=h==null?void 0:h.position;u=" in Zeile "+d.line+", Spalte "+d.column,(s=(n=this.main.getBottomDiv())==null?void 0:n.console)==null||s.showError(this.currentProgram.module,d)}alert("Fehler"+u+": "+e)}}if(i){t.append(I("<span class='jo_error-caption'>Fehler:</span>&nbsp;"+e+"<br>")),this.pushCurrentProgram();let l=!0;for(let u=this.programStack.length-1;u>=0;u--){let h=this.programStack[u],d=h.method instanceof m?h.method.identifier:h.method,p="<span class='jo_error-caption'>"+(l?"Ort":"aufgerufen von")+": </span>"+d;h.textPosition!=null&&(p+=" <span class='jo_runtimeErrorPosition'>(Z "+h.textPosition.line+", S "+h.textPosition.column+")</span>"),p+="<br>";let v=I(p);if(h.textPosition!=null){let w=this;I(v[2]).on("mousedown",()=>{var _,T;(T=(_=w.main.getBottomDiv())==null?void 0:_.console)==null||T.showError(h.program.module,h.textPosition)})}if(t.append(v),l=!1,h.isCalledFromOutside!=null)break}let o=(a=this.main.getBottomDiv())==null?void 0:a.console;o!=null&&(o.writeConsoleEntry(t,null,"rgba(255, 0, 0, 0.4"),o.showTab())}}hideProgrampointerPosition(){this.state==1&&this.stepsPerSecond>this.showProgrampointerUptoStepsPerSecond&&this.main.hideProgramPointerPosition()}comesStatement(e){return this.currentProgram==null||this.currentProgramPosition>this.currentProgram.statements.length-1?!1:this.currentProgram.statements[this.currentProgramPosition].type==e}resetRuntime(){var e,t,i;this.printManager.clear(),(e=this.worldHelper)==null||e.destroyWorld(),(t=this.processingHelper)==null||t.destroyWorld(),(i=this.gngEreignisbehandlungHelper)==null||i.detachEvents(),this.gngEreignisbehandlungHelper=null}stop(e=!1){var t;this.inputManager.hide(),this.setState(2),this.timerStopped=!0,this.stepFinished=!0,this.worldHelper!=null&&(this.worldHelper.spriteAnimations=[]),(t=this.gngEreignisbehandlungHelper)==null||t.detachEvents(),this.gngEreignisbehandlungHelper=null,this.main.hideProgramPointerPosition(),this.getTimerClass().stopTimer(),this.getTimerClass().clearEntries(),this.worldHelper!=null&&this.worldHelper.cacheAsBitmap(),this.databaseConnectionHelpers.forEach(i=>i.close()),this.databaseConnectionHelpers=[],this.heap={},this.programStack=[],this.stack=[],this.stackframes=[],setTimeout(()=>{this.setState(4),this.main.hideProgramPointerPosition(),e&&this.start()},500)}pause(){this.setState(2),this.showProgramPointerAndVariables(),this.timerStopped=!0}showProgramPointerAndVariables(){if(this.debugger.blur(!1),this.currentProgram==null)return;let e=this.currentProgram.statements[this.currentProgramPosition];if(e==null)return;let t=e.position;t!=null&&(this.main.showProgramPointerPosition(this.currentProgram.module.file,t),this.debugger.showData(this.currentProgram,t,this.stack,this.currentStackframe,this.heap),this.main.getBottomDiv().programPrinter!=null&&(this.currentProgram.module!=this.lastPrintedModule&&(this.main.getBottomDiv().printModuleToBottomDiv(null,this.currentProgram.module),this.lastPrintedModule=this.currentProgram.module),this.main.getBottomDiv().programPrinter.showNode(e)))}stepOut(){this.stepOverNestingLevel=0,this.start()}oneStep(e){var a,l;if((l=(a=this.main.getBottomDiv())==null?void 0:a.console)==null||l.clearErrors(),this.isFirstStatement=!0,this.state!=2){if(this.init(),this.state==0)return;this.resetRuntime(),this.showProgramPointerAndVariables(),this.setState(2),this.currentMethod=="Hauptprogramm"&&this.return;return}this.stepOverNestingLevel=1e4;let t=this.stepOverNestingLevel,n=this.currentProgram.statements[this.currentProgramPosition].position,s=this.nextStep();if(s!=null){this.throwException(s);return}!e&&this.stepOverNestingLevel>t?(this.stepOverNestingLevel=0,n!=null?this.leaveLine=n.line:this.leaveLine=-1,this.start()):this.state==4?this.main.hideProgramPointerPosition():(this.showProgramPointerAndVariables(),this.state!=6&&this.state!=5&&this.setState(2))}nextStep(){this.stepFinished=!1;let e,t;for(;!this.stepFinished&&!this.additionalStepFinishedFlag&&t==null;){if(this.currentProgram==null){console.log("Interpeter.nextStep: Current program is null!"),this.setState(4);return}if(this.currentProgramPosition>this.currentProgram.statements.length-1){this.setState(4);break}e=this.currentProgram.statements[this.currentProgramPosition],e.stepFinished!=null&&(this.stepFinished=e.stepFinished),t=this.executeNode(e)}return this.additionalStepFinishedFlag=!1,this.steps++,t}executeNode(e){var a,l;if(e.breakpoint!=null&&!this.isFirstStatement){this.additionalStepFinishedFlag=!0,this.pause();return}this.isFirstStatement=!1;let t=this.stack.length-1,i=this.currentStackframe,n=this.stack,s;switch(e.type){case f.castValue:let o=e.stackPosRelative==null?0:e.stackPosRelative;s=n[t+o],n[t+o]=s.type.castTo(s,e.newType);break;case f.checkCast:if(s=n[t],s.value==null)break;let u=s.value;if(e.newType instanceof $)if(typeof u=="object"){if(!u.class.hasAncestorOrIs(e.newType))return"Das Objekt der Klasse "+u.class.identifier+" kann nicht nach "+e.newType.identifier+" gecastet werden."}else{if(typeof u=="number"&&["Integer","Double","Float"].indexOf(e.newType.identifier)<0)return"Eine Zahl kann nicht nach "+e.newType.identifier+" gecastet werden.";if(typeof u=="string"&&["String","Character"].indexOf(e.newType.identifier)<0)return"Eine Zeichenkette kann nicht nach "+e.newType.identifier+" gecastet werden.";if(typeof u=="boolean"&&e.newType.identifier!="Boolean")return"Ein boolescher Wert kann nicht nach "+e.newType.identifier+" gecastet werden."}else if(e.newType instanceof Pe&&!u.class.implementsInterface(e.newType))return"Das Objekt der Klasse "+u.class.identifier+" implementiert nicht das Interface "+e.newType.identifier+".";break;case f.localVariableDeclaration:let h=e.variable,d=h.type;s={type:d,value:null},d instanceof ut&&(s.value=d.initialValue),n[h.stackPos+i]=s,e.pushOnTopOfStackForInitialization&&n.push(s);break;case f.pushLocalVariableToStack:n.push(n[e.stackposOfVariable+i]);break;case f.popAndStoreIntoVariable:n[e.stackposOfVariable+i]=n.pop();break;case f.pushAttribute:let p=e.useThisObject?n[i].value:n.pop().value;if(p==null)return"Zugriff auf ein Attribut ("+e.attributeIdentifier+") des null-Objekts";let v=p.getValue(e.attributeIndex);(v==null?void 0:v.updateValue)!=null&&v.updateValue(v),n.push(v);break;case f.pushArrayLength:let w=n.pop().value;if(w==null)return"Zugriff auf das length-Attribut des null-Objekts";n.push({type:C,value:w.length});break;case f.assignment:s=n.pop(),n[t-1].value=s.value,n[t-1].type instanceof ut||(n[t-1].type=s.type),e.leaveValueOnStack||n.pop();break;case f.plusAssignment:s=n.pop(),n[t-1].value+=s.value;break;case f.minusAssignment:s=n.pop(),n[t-1].value-=s.value;break;case f.multiplicationAssignment:s=n.pop(),n[t-1].value*=s.value;break;case f.divisionAssignment:s=n.pop(),n[t-1].value/=s.value;break;case f.divisionAssignmentInteger:s=n.pop(),n[t-1].value=Math.trunc(n[t-1].value/s.value);break;case f.moduloAssignment:s=n.pop(),n[t-1].value%=s.value;break;case f.ANDAssigment:s=n.pop(),n[t-1].value&=s.value;break;case f.ORAssigment:s=n.pop(),n[t-1].value|=s.value;break;case f.XORAssigment:s=n.pop(),n[t-1].value^=s.value;break;case f.shiftLeftAssigment:s=n.pop(),n[t-1].value<<=s.value;break;case f.shiftRightAssigment:s=n.pop(),n[t-1].value>>=s.value;break;case f.shiftRightUnsignedAssigment:s=n.pop(),n[t-1].value>>>=s.value;break;case f.binaryOp:let _=n.pop(),T=e.leftType.compute(e.operator,n[t-1],_),D=e.leftType.getResultType(e.operator,_.type);n[t-1]={type:D,value:T};break;case f.unaryOp:let L=n.pop();e.operator==f.minus?n.push({type:L.type,value:-L.value}):n.push({type:L.type,value:!L.value});break;case f.pushConstant:n.push({value:e.value,type:e.dataType});break;case f.pushStaticClassObject:e.klass instanceof $?n.push({type:e.klass.staticClass,value:e.klass.staticClass.classObject}):n.push({type:e.klass,value:e.klass});break;case f.pushStaticAttribute:s=e.klass.classObject.getValue(e.attributeIndex),s.updateValue!=null&&s.updateValue(s),n.push(s);break;case f.selectArrayElement:let O=n.pop(),z=n.pop();if(z.value==null)return"Zugriff auf ein Element eines null-Feldes";if(O.value>=z.value.length||O.value<0)return"Zugriff auf das Element mit Index "+O.value+" eines Feldes der Länge "+z.value.length;n.push(z.value[O.value]);break;case f.callMainMethod:this.stack.push({value:e.staticClass.classObject,type:e.staticClass});let V={value:[{value:"Test",type:F}],type:new ze(F)},Q=t+2;this.stack.push(V),this.stackframes.push(this.currentStackframe),this.programStack.push({program:this.currentProgram,programPosition:this.currentProgramPosition+1,textPosition:e.position,method:this.currentMethod,callbackAfterReturn:this.currentCallbackAfterReturn,isCalledFromOutside:null}),this.currentCallbackAfterReturn=null,this.currentStackframe=Q,this.currentProgram=e.method.program,this.currentMethod=e.method,this.currentProgramPosition=-1;for(let Me=0;Me<e.method.reserveStackForLocalVariables;Me++)n.push(null);break;case f.makeEllipsisArray:let S=n.splice(n.length-e.parameterCount,e.parameterCount);n.push({value:S,type:e.arrayType});break;case f.callMethod:let Z=e.method,re=t+1+e.stackframeBegin,me=Z.parameterlist.parameters;for(let Me=re+1;Me<=t;Me++)this.stack[Me]!=null&&(n[Me]={type:me[Me-re-1].type,value:n[Me].value});if(n[re].value==null&&!Z.isStatic)return"Aufruf der Methode "+Z.identifier+" des null-Objekts";if(Z.isAbstract||Z.isVirtual&&!e.isSuperCall){let Me=n[re];Me.value instanceof he?Z=Me.value.class.getMethodBySignature(Z.signature):Z=Me.type.getMethodBySignature(Z.signature)}if(Z==null)break;if(Z.invoke!=null){let Me=Z.getReturnType(),ei=n.splice(re),lr=Z.invoke(ei);Me!=null&&Me.identifier!="void"&&n.push({value:lr,type:Me})}else{this.stackframes.push(this.currentStackframe),this.programStack.push({program:this.currentProgram,programPosition:this.currentProgramPosition+1,textPosition:e.position,method:this.currentMethod,callbackAfterReturn:this.currentCallbackAfterReturn,isCalledFromOutside:null}),this.currentCallbackAfterReturn=null,this.currentStackframe=re,this.currentProgram=Z.program,this.currentMethod=Z,this.currentProgramPosition=-1;for(let Me=0;Me<Z.reserveStackForLocalVariables;Me++)n.push(null);this.stepOverNestingLevel++,this.additionalStepFinishedFlag=!0}break;case f.callInputMethod:let le=e.method,oe=t+1+e.stackframeBegin,X=n.splice(oe);this.pauseForInput(6);let K=this;this.inputManager.readInput(le,X,Me=>{K.resumeAfterInput(Me)});break;case f.return:this.return(e,n);break;case f.decreaseStackpointer:n.splice(t+1-e.popCount);break;case f.initStackframe:this.stackframes.push(this.currentStackframe),this.currentStackframe=t+1;for(let Me=0;Me<e.reserveForLocalVariables;Me++)n.push(null);break;case f.closeStackframe:n.splice(i),this.currentStackframe=this.stackframes.pop();break;case f.newObject:s={value:new he(e.class),type:e.class},n.push(s),e.subsequentConstructorCall&&(n.push(s),t++);let Se=e.class;for(;Se!=null;){let Me=Se.attributeInitializationProgram;Me.statements.length>0&&(this.stackframes.push(this.currentStackframe),this.programStack.push({program:this.currentProgram,programPosition:this.currentProgramPosition+1,textPosition:e.position,method:this.currentMethod,callbackAfterReturn:this.currentCallbackAfterReturn,isCalledFromOutside:null}),this.currentCallbackAfterReturn=null,this.currentStackframe=t+1,this.currentProgram=Me,this.currentProgramPosition=-1,this.currentMethod="Konstruktor von "+Se.identifier,this.stepOverNestingLevel++,this.additionalStepFinishedFlag=!0),Se=Se.baseClass}break;case f.processPostConstructorCallbacks:s=n[t];let de=s.type;for(let Me of de.getPostConstructorCallbacks())Me(s.value);break;case f.extendedForLoopInit:n[e.stackPosOfCounter+i]={type:C,value:0};break;case f.extendedForLoopCheckCounterAndGetElement:let De=n[e.stackPosOfCounter+i].value++,Ve=n[e.stackPosOfCollection+i].value;switch(e.kind){case"array":De<Ve.length?(n[e.stackPosOfElement+i].value=Ve[De].value,n[e.stackPosOfElement+i].type=Ve[De].type):this.currentProgramPosition=e.destination-1;break;case"internalList":let Me=Ve.intrinsicData.ListHelper.valueArray;De<Me.length?(n[e.stackPosOfElement+i].value=Me[De].value,n[e.stackPosOfElement+i].type=Me[De].type):this.currentProgramPosition=e.destination-1;break;case"group":let ei=Ve.intrinsicData.Actor.shapes;De<ei.length?(n[e.stackPosOfElement+i].value=ei[De],n[e.stackPosOfElement+i].type=ei[De].klass):this.currentProgramPosition=e.destination-1;break}break;case f.incrementDecrementCharBefore:s=n[t];let ae=s.value.charCodeAt(0)+e.incrementDecrementBy;s.value=String.fromCharCode(ae);break;case f.incrementDecrementCharAfter:s=n[t],n[t]={value:s.value,type:s.type};let Ie=s.value.charCodeAt(0)+e.incrementDecrementBy;s.value=String.fromCharCode(Ie);break;case f.incrementDecrementBefore:s=n[t],s.value+=e.incrementDecrementBy;break;case f.incrementDecrementAfter:s=n[t],n[t]={value:s.value,type:s.type},s.value+=e.incrementDecrementBy;break;case f.jumpAlways:this.currentProgramPosition=e.destination-1;break;case f.jumpIfTrue:s=n.pop(),s.value&&(this.currentProgramPosition=e.destination-1);break;case f.jumpIfFalse:s=n.pop(),s.value||(this.currentProgramPosition=e.destination-1);break;case f.jumpIfTrueAndLeaveOnStack:s=n[t],s.value&&(this.currentProgramPosition=e.destination-1);break;case f.jumpIfFalseAndLeaveOnStack:s=n[t],s.value||(this.currentProgramPosition=e.destination-1);break;case f.noOp:break;case f.programEnd:if(this.programStack.length>0){this.popProgram(),this.currentProgramPosition--,this.additionalStepFinishedFlag=!0,this.leaveLine=-1,e.pauseAfterProgramEnd&&(this.stepOverNestingLevel=-1);break}if(this.worldHelper!=null&&this.worldHelper.hasActors()||this.processingHelper!=null||this.gngEreignisbehandlungHelper!=null&&this.gngEreignisbehandlungHelper.hasAktionsEmpfaenger()){this.currentProgramPosition--;break}if(this.main.getCurrentWorkspace().moduleStore.getModule("Base Module").typeStore.getType("Timer").timerEntries.length>0){this.currentProgramPosition--;break}if(this.currentProgram=null,this.currentProgramPosition=-1,this.additionalStepFinishedFlag=!0,rn.showHelper("speedControlHelper",this.main),this.printManager.showProgramEnd(),this.steps>0){let Me=performance.now()-this.timeWhenProgramStarted,ei="Executed "+this.steps+" steps in "+this.round(Me)+" ms ("+this.round(this.steps/Me*1e3)+" steps/s)";(l=(a=this.main.getBottomDiv())==null?void 0:a.console)==null||l.writeConsoleEntry(ei,null),this.steps=-1}this.currentProgramPosition--,this.stop();break;case f.print:case f.println:let Ze=null,pt=null;e.withColor&&(pt=n.pop().value),e.empty||(Ze=n.pop().value),e.type==f.println?this.printManager.println(Ze,pt):this.printManager.print(Ze,pt);break;case f.pushEmptyArray:let mt=[];for(let Me=0;Me<e.dimension;Me++)mt.push(n.pop().value);n.push(this.makeEmptyArray(mt,e.arrayType));break;case f.beginArray:n.push({type:e.arrayType,value:[]});break;case f.addToArray:t-=e.numberOfElementsToAdd;let vt=n.splice(t+1,e.numberOfElementsToAdd).map(Me=>({type:Me.type,value:Me.value}));n[t].value=n[t].value.concat(vt);break;case f.pushEnumValue:let zt=e.enumClass.identifierToInfoMap[e.valueIdentifier];n.push(e.enumClass.valueList.value[zt.ordinal]);break;case f.keywordSwitch:let Kt=n.pop().value,ht=e.destinationMap[Kt];ht!=null?this.currentProgramPosition=ht-1:e.defaultDestination!=null&&(this.currentProgramPosition=e.defaultDestination-1);break;case f.heapVariableDeclaration:let st=e.variable;this.heap[st.identifier]=st,st.value={type:st.type,value:st.type instanceof ut?st.type.initialValue:null},e.pushOnTopOfStackForInitialization&&this.stack.push(st.value);break;case f.pushFromHeapToStack:let dt=this.heap[e.identifier];if(dt!=null)this.stack.push(dt.value);else return"Die Variable "+e.identifier+" ist nicht bekannt.";break;case f.returnIfDestroyed:let yt=this.stack[i].value;yt!=null&&yt.intrinsicData.Actor.isDestroyed==!0&&this.return(null,n);break;case f.setPauseDuration:let di=this.stack.pop().value;this.pauseUntil==null&&(this.pauseUntil=performance.now()+di);break;case f.pause:e.stepFinished=!0,this.pauseUntil!=null&&performance.now()<this.pauseUntil?this.currentProgramPosition--:this.pauseUntil=null;break}this.currentProgramPosition++}pauseForInput(e){this.timerStopped=!0,this.additionalStepFinishedFlag=!0,this.oldState=this.state,this.setState(e),e==6&&this.showProgramPointerAndVariables()}resumeAfterInput(e,t=!1){t&&this.stack.pop(),e!=null&&this.stack.push(e),this.main.hideProgramPointerPosition(),this.setState(2),this.oldState==1?this.start():this.showProgramPointerAndVariables()}return(e,t){let i=this.currentCallbackAfterReturn;if(e!=null&&e.copyReturnValueToStackframePos0){let n=t.pop();t[this.currentStackframe]=n,t.splice(this.currentStackframe+1)}else t.splice(this.currentStackframe+(e!=null&&e.leaveThisObjectOnStack?1:0));this.currentStackframe=this.stackframes.pop(),this.popProgram(),e!=null&&e.methodWasInjected==!0&&this.currentProgramPosition++,this.currentProgramPosition--,this.stepOverNestingLevel--,i!=null&&i(this),this.stepOverNestingLevel<0&&this.currentProgram.statements[this.currentProgramPosition+1].type==f.jumpAlways&&(this.stepFinished=!1)}makeEmptyArray(e,t){let i=t.arrayOfType;if(e.length==1){let n=[];for(let s=0;s<e[0];s++){let a={type:i,value:null};i instanceof ut&&(a.value=i.initialValue),n.push(a)}return{type:t,value:n}}else{let n=[],s=e.slice(),a=s.pop();for(let l=0;l<a;l++)n.push(this.makeEmptyArray(s,i));return{type:t,value:n}}}round(e){return""+Math.round(e*1e4)/1e4}setStepsPerSecond(e){this.stepsPerSecond=e,this.blurDebuggerIfNecessary()}blurDebuggerIfNecessary(){this.debugger.blur(this.state==1&&this.stepsPerSecond>this.showProgrampointerUptoStepsPerSecond)}setState(e){var a,l;let t=this.state;this.state=e,e==1&&((a=document.getElementById("jo_runtab"))==null||a.focus()),this.blurDebuggerIfNecessary(),(e==3||e==4)&&this.closeAllWebsockets();let i=this.main.getActionManager();for(let o of this.actions)i.setActive("interpreter."+o,this.buttonActiveMatrix[o][e]);this.buttonActiveMatrix.start[e]?(this.controlButtons.$buttonStart.show(),this.controlButtons.$buttonPause.hide()):(this.controlButtons.$buttonStart.hide(),this.controlButtons.$buttonPause.show()),this.buttonActiveMatrix.stop[e]||(this.worldHelper!=null&&this.worldHelper.clearActorLists(),(l=this.gngEreignisbehandlungHelper)==null||l.detachEvents(),this.gngEreignisbehandlungHelper=null),this.runningStates.indexOf(t)>=0&&this.runningStates.indexOf(e)<0&&(this.debugger.disable(),this.keyboardTool.unsubscribeAllListeners()),this.runningStates.indexOf(t)<0&&this.runningStates.indexOf(e)>=0&&this.debugger.enable()}closeAllWebsockets(){this.webSocketsToCloseAfterProgramHalt.forEach(e=>e.close()),this.webSocketsToCloseAfterProgramHalt=[]}pushCurrentProgram(){if(this.currentProgram==null)return;let e,t=this.currentProgram.statements[this.currentProgramPosition];t!=null&&(e=t.position),this.programStack.push({program:this.currentProgram,programPosition:this.currentProgramPosition,textPosition:e,method:this.currentMethod,callbackAfterReturn:this.currentCallbackAfterReturn,isCalledFromOutside:this.currentIsCalledFromOutside}),this.currentCallbackAfterReturn=null,this.currentIsCalledFromOutside=null}runTimer(e,t,i,n){if(this.state!=1)return;let s=e.program.statements;n||this.programStack.length==0?(this.pushCurrentProgram(),this.currentProgram=e.program,this.currentMethod=e,this.currentProgramPosition=0,this.currentCallbackAfterReturn=i,this.currentIsCalledFromOutside="Timer",this.stackframes.push(this.currentStackframe),this.currentStackframe=this.stack.length,this.stack=this.stack.concat(t),s[s.length-1].type==f.return&&this.stepOverNestingLevel++):(this.programStack.splice(1,0,{program:e.program,programPosition:0,textPosition:{line:0,column:0,length:0},method:e,callbackAfterReturn:i,isCalledFromOutside:"Timer",stackElementsToPushBeforeFirstExecuting:t}),s[s.length-1].type==f.return&&this.stepOverNestingLevel++)}evaluate(e){this.pushCurrentProgram(),this.currentProgram=e,this.currentProgramPosition=0;let t=this.stack.length,i=this.state,n=this.stepOverNestingLevel,s=this.additionalStepFinishedFlag;this.currentStackframe;let a,l=0;try{for(;a==null&&(this.currentProgram!=e||this.currentProgramPosition<this.currentProgram.statements.length)&&l<1e5;)a=this.nextStep(),l++}catch{a="Fehler bei der Auswertung"}this.currentProgram==e&&this.programStack.length>0&&this.popProgram();let o;if(this.stack.length>t)for(o=this.stack.pop();this.stack.length>t;)this.stack.pop();return this.stepOverNestingLevel=n,this.additionalStepFinishedFlag=s,this.setState(i),{error:a,value:o}}executeImmediatelyInNewStackframe(e,t){this.pushCurrentProgram(),this.currentProgram=e;let i=this.currentProgramPosition;this.currentProgramPosition=0;let n=this.stackframes.length;this.stackframes.push(this.currentStackframe);let s=this.stack.length;this.currentStackframe=s;for(let p of t)this.stack.push(p);let a=this.state,l=this.stepOverNestingLevel,o=this.additionalStepFinishedFlag,u=0,h=null;try{for(;this.stackframes.length>n&&u<1e5&&h==null;){let p=this.currentProgram.statements[this.currentProgramPosition];h=this.executeNode(p),u++}}catch{h="Fehler bei der Auswertung"}u==1e5&&this.throwException("Die Ausführung des Konstruktors dauerte zu lange.");let d;if(this.stack.length>s)for(d=this.stack.pop();this.stack.length>s;)this.stack.pop();return this.stepOverNestingLevel=l,this.additionalStepFinishedFlag=o,this.currentProgramPosition=i,this.setState(a),{error:h,value:d}}instantiateObjectImmediately(e){let t=new he(e),i={value:t,type:e},n=e;for(;n!=null;){let a=n.attributeInitializationProgram;a.statements.length>0&&this.executeImmediatelyInNewStackframe(a,[i]),n=n.baseClass}let s=e.getMethodBySignature(e.identifier+"()");return s!=null&&s.program!=null&&this.executeImmediatelyInNewStackframe(s.program,[i]),t}registerDatabaseConnection(e){this.databaseConnectionHelpers.push(e)}}const St=class St{static initDefaultValues(){St.defaultFillColor=8421631,St.defaultFillAlpha=1,St.defaultBorderColor=null,St.defaultBorderAlpha=1,St.defaultBorderWidth=10,St.defaultVisibility=!0}static setDefaultVisibility(e){St.defaultVisibility=e}static setDefaultBorder(e,t,i){if(St.defaultBorderWidth=e,typeof t=="string"){let n=Ot.parseColorToOpenGL(t);St.defaultBorderColor=n.color,St.defaultBorderAlpha=i??n.alpha}else St.defaultBorderColor=t,i!=null&&(St.defaultBorderAlpha=i)}static setDefaultFillColor(e,t){if(typeof e=="string"){let i=Ot.parseColorToOpenGL(e);St.defaultFillColor=i.color,St.defaultFillAlpha=t??i.alpha}else St.defaultFillColor=e,t!=null&&(St.defaultFillAlpha=t)}};y(St,"defaultFillColor",8421631),y(St,"defaultFillAlpha",1),y(St,"defaultBorderColor",null),y(St,"defaultBorderAlpha",1),y(St,"defaultBorderWidth",10),y(St,"defaultVisibility",!0);let Ci=St;class NC extends ${constructor(e){super("World",e,"Grafische Zeichenfläche mit Koordinatensystem"),this.module=e,this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("Group"),i=e.typeStore.getType("Shape"),n=e.typeStore.getType("MouseListener");this.addMethod(new m("World",new g([{identifier:"breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"höhe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=this.getWorldHelper(a,l,o);a.intrinsicData.World=u},!1,!1,"Legt einen neuen Grafikbereich (='Welt') an",!0)),this.addMethod(new m("World",new g([]),null,s=>{let a=s[0].value,l=this.getWorldHelper(a);a.intrinsicData.World=l},!1,!1,"Legt einen neuen Grafikbereich (='Welt') an. Das Koordinatensystem geht von 0 bis 800 in x-Richtung und von 0 - 600 in y-Richtung.",!0)),this.addMethod(new m("setBackgroundColor",new g([{identifier:"colorAsRGBInt",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value;a.intrinsicData.World.setBackgroundColor(l)},!1,!1,'Setzt die Hintergrundfarbe. Die Farbe wird als integer-Zahl erwartet. Am besten schreibt man sie als Hexadezimalzahl, also z.B. setBackgroundColor(0xff8080)."',!1)),this.addMethod(new m("setBackgroundColor",new g([{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value;a.intrinsicData.World.setBackgroundColor(l)},!1,!1,'Setzt die Hintergrundfarbe. Die Farbe ist entweder eine vordefinierte Farbe ("schwarz", "rot", ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("move",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=a.intrinsicData.World,h=new Ye().copyFrom(u.stage.projectionTransform);u.stage.projectionTransform.identity(),u.stage.projectionTransform.translate(l,o),u.stage.projectionTransform.prepend(h),u.computeCurrentWorldBounds(),u.shapesNotAffectedByWorldTransforms.forEach(d=>d.move(-l,-o))},!1,!1,"Verschiebt alle Objekte der Welt um x nach rechts und y nach unten.",!1)),this.addMethod(new m("follow",new g([{identifier:"shape",type:i,declaration:null,usagePositions:null,isFinal:!0},{identifier:"margin",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"xMin",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"xMax",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"yMin",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"yMax",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=s[4].value,d=s[5].value,p=s[6].value,v=a.intrinsicData.World,w=l.intrinsicData.Actor,_=0,T=0,D=w.getCenterX(),L=w.getCenterY(),O=D-(v.currentLeft+v.currentWidth-o);O>0&&v.currentLeft+v.currentWidth<h&&(_=-O);let z=v.currentLeft+o-D;z>0&&v.currentLeft>u&&(_=z);let V=L-(v.currentTop+v.currentHeight-o);V>0&&v.currentTop+v.currentHeight<=p&&(T=-V);let Q=v.currentTop+o-L;if(Q>0&&v.currentTop>=d&&(T=Q),_!=0||T!=0){let S=new Ye().copyFrom(v.stage.projectionTransform);v.stage.projectionTransform.identity(),v.stage.projectionTransform.translate(_,T),v.stage.projectionTransform.prepend(S),v.computeCurrentWorldBounds(),v.shapesNotAffectedByWorldTransforms.forEach(Z=>Z.move(-_,-T))}},!1,!1,"Verschiebt die Welt so, dass das übergebene graphische Objekt (shape) sichtbar wird. Verschoben wird nur, wenn das Objekt weniger als frameWidth vom Rand entfernt ist und die Welt nicht über die gegebenen Koordinaten xMin, xMax, yMin und yMax hinausragt.",!1)),this.addMethod(new m("rotate",new g([{identifier:"angleInDeg",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=a.intrinsicData.World,d=-l/180*Math.PI,p=new Ye().copyFrom(h.stage.projectionTransform);h.stage.projectionTransform.identity(),h.stage.projectionTransform.translate(-o,-u),h.stage.projectionTransform.rotate(d),h.stage.projectionTransform.translate(o,u),h.stage.projectionTransform.prepend(p),h.computeCurrentWorldBounds(),h.shapesNotAffectedByWorldTransforms.forEach(v=>{v.rotate(-l,o,u)})},!1,!1,"Rotiert die Welt um den angegebenen Winkel im Urzeigersinn. Drehpunkt ist der Punkt (x/y).",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=a.intrinsicData.World,d=new Ye().copyFrom(h.stage.projectionTransform);h.stage.projectionTransform.identity(),h.stage.projectionTransform.translate(-o,-u),h.stage.projectionTransform.scale(l,l),h.stage.projectionTransform.translate(o,u),h.stage.projectionTransform.prepend(d),h.computeCurrentWorldBounds(),h.shapesNotAffectedByWorldTransforms.forEach(p=>p.scale(1/l,o,u))},!1,!1,"Streckt die Welt um den angegebenen Faktor. Zentrum der Streckung ist (x/y).",!1)),this.addMethod(new m("setCoordinateSystem",new g([{identifier:"left",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"top",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=s[4].value,d=a.intrinsicData.World;d.stage.projectionTransform.identity(),d.stage.projectionTransform.translate(-l,-o),d.stage.projectionTransform.scale(d.initialWidth/u,d.initialHeight/h),d.computeCurrentWorldBounds(),d.shapesNotAffectedByWorldTransforms.forEach(p=>{p.scale(u/d.initialWidth,l,o),p.move(l,o)})},!1,!1,"Setzt das Koordinatensystem der Welt so, dass (left, top) die linke obere Ecke des sichtbaren Bereiches ist, width seine Breite und height seine Höhe.",!1)),this.addMethod(new m("setDefaultGroup",new g([{identifier:"group",type:t,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.World;o.defaultGroup=l==null?null:l.intrinsicData.Actor},!1,!1,"Legt eine Gruppe fest, zu der ab jetzt alle neuen Objekte automatisch hinzugefügt werden. Falls null angegeben wird, werden neue Objekte zu keiner Gruppe automatisch hinzugefügt.",!1)),this.addMethod(new m("getDefaultGroup",new g([]),t,s=>s[0].value.intrinsicData.World.getDefaultGroup(),!1,!1,"Gibt die Gruppe zurück, zu der aktuell alle neuen Objekte automatisch hinzugefügt werden. Falls gerade keine defaultGroup festgelegt ist, wird null zurückgegeben.",!1)),this.addMethod(new m("addMouseListener",new g([{identifier:"listener",type:n,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value;a.intrinsicData.World.addMouseListener(l)},!1,!1,"Fügt einen neuen MouseListener hinzu, dessen Methoden bei Mausereignissen aufgerufen werden.",!1)),this.addMethod(new m("getWidth",new g([]),C,s=>{let l=s[0].value.intrinsicData.World;return Math.round(l.currentWidth)},!1,!1,'Gibt die "Breite" des Grafikbereichs zurück, genauer: die x-Koordinate am rechten Rand.',!1)),this.addMethod(new m("getHeight",new g([]),C,s=>{let l=s[0].value.intrinsicData.World;return Math.round(l.currentHeight)},!1,!1,'Gibt die "Höhe" des Grafikbereichs zurück, genauer: die y-Koordinate am unteren Rand.',!1)),this.addMethod(new m("getTop",new g([]),C,s=>{let l=s[0].value.intrinsicData.World;return Math.round(l.currentTop)},!1,!1,"Gibt die y-Koordinate der linken oberen Ecke zurück.",!1)),this.addMethod(new m("getLeft",new g([]),C,s=>{let l=s[0].value.intrinsicData.World;return Math.round(l.currentLeft)},!1,!1,"Gibt die x-Koordinate der linken oberen Ecke zurück.",!1)),this.addMethod(new m("setCursor",new g([{identifier:"cursor",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,s=>{let l=s[0].value.intrinsicData.World,o=s[1].value;l.setCursor(o)},!1,!1,"Ändert die Form des Mauscursors im gesamten Grafikbereich. Mögiche Werte: siehe https://developer.mozilla.org/de/docs/Web/CSS/cursor.",!1)),this.addMethod(new m("clear",new g([]),null,s=>{let a=e.main.getInterpreter().worldHelper;a==null||a.destroyAll()},!1,!0,"Löscht alle grafischen Objekte",!1))}getWorldHelper(e,t=800,i=600){var s,a,l,o;let n=(l=(a=(s=this.module)==null?void 0:s.main)==null?void 0:a.getInterpreter())==null?void 0:l.worldHelper;if(n!=null){if(n.width!=t||n.height!=i){let u=Math.round(i/t*100);n.$containerOuter.css("padding-bottom",u+"%"),n.stage.projectionTransform.scale(n.width/t,n.width/i),(o=this.module.main.getRightDiv())==null||o.adjustWidthToWorld()}return n}else return new _l(t,i,this.module,e)}}class GC extends Rt{constructor(t,i){super();y(this,"projectionTransform");this.sourceFrame=t,this.destinationFrame=i,this.projectionTransform=new Ye}render(t){t.projection.projectionMatrix.identity(),t.projection.transform=this.projectionTransform,t.renderTexture.bind(t.renderTexture.current,this.sourceFrame,this.destinationFrame),super.render(t),t.batch.flush(),t.projection.projectionMatrix.identity(),t.projection.transform=null,t.renderTexture.bind(null)}}class _l{constructor(e,t,i,n){y(this,"$containerOuter");y(this,"$containerInner");y(this,"app");y(this,"stage");y(this,"actActors",[]);y(this,"keyPressedActors",[]);y(this,"keyUpActors",[]);y(this,"keyDownActors",[]);y(this,"actorHelpersToDestroy",[]);y(this,"mouseListenerShapes",[]);y(this,"mouseListeners",[]);y(this,"internalMouseListeners",[]);y(this,"internalKeyboardListeners",[]);y(this,"interpreter");y(this,"actorsFinished",!0);y(this,"summedDelta",0);y(this,"defaultGroup");y(this,"initialWidth");y(this,"initialHeight");y(this,"$coordinateDiv");y(this,"scaledTextures",{});y(this,"shapes",[]);y(this,"currentLeft");y(this,"currentTop");y(this,"currentWidth");y(this,"currentHeight");y(this,"shapesNotAffectedByWorldTransforms",[]);y(this,"globalScale");y(this,"robotWorldHelper");y(this,"tickerFunction");y(this,"actorsNotFinished",0);y(this,"ticks",0);y(this,"deltaSum",0);y(this,"spriteAnimations",[]);var p,v,w;for(this.width=e,this.height=t,this.module=i,this.world=n,this.globalScale=1;t>1e3||e>2e3;)this.globalScale*=2,t/=2,e/=2;this.initialHeight=this.height,this.initialWidth=this.width,this.currentLeft=0,this.currentTop=0,this.currentWidth=this.width,this.currentHeight=this.height,this.interpreter=(v=(p=this.module)==null?void 0:p.main)==null?void 0:v.getInterpreter(),this.interpreter.processingHelper!=null&&this.interpreter.throwException("Die herkömmliche Grafikausgabe kann nicht zusammen mit Processing genutzt werden."),this.interpreter.worldHelper!=null&&this.interpreter.throwException("Es darf nur ein World-Objekt instanziert werden."),this.interpreter.worldHelper=this;let s=this.module.main.getInterpreter().printManager.getGraphicsDiv();this.$coordinateDiv=this.module.main.getRightDiv().$rightDiv.find(".jo_coordinates");let a=()=>{let _=s.parents(".jo_tabs");_.length==0&&(_=s.parents(".joe_rightDivInner"));let T=_.width(),D=_.height();t/e>D/T?s.css({width:e/t*D+"px",height:D+"px"}):s.css({height:t/e*T+"px",width:T+"px"})};if(s.off("sizeChanged"),s.on("sizeChanged",a),a(),this.$containerOuter=I("<div></div>"),this.$containerInner=I("<div></div>"),this.$containerOuter.append(this.$containerInner),s.append(this.$containerOuter),s.show(),s[0].oncontextmenu=function(_){_.preventDefault()},this.module.main.pixiApp){this.app=this.module.main.pixiApp;let _=this.app.renderer;_.resize(e,t),_.background.color=0}else this.app=new sf({antialias:!0,width:e,height:t}),this.module.main.pixiApp=this.app;let l=this;this.tickerFunction=_=>{l.tick(Lt.shared.elapsedMS)},this.app.ticker.add(this.tickerFunction),this.app.ticker.maxFPS=30,this.app.ticker.minFPS=30,this.interpreter.timerExtern=!0;let o=new Ke(0,0,this.width,this.height),u=new Ke(0,0,e,t);this.stage=new GC(o,u),this.stage.projectionTransform=new Ye,this.app.stage.addChild(this.stage),this.$containerInner.append(this.app.view),this.interpreter.keyboardTool.keyPressedCallbacks.push(_=>{for(let T of l.keyPressedActors)l.runActorWhenKeyEvent(T,_)}),this.interpreter.keyboardTool.keyUpCallbacks.push(_=>{for(let T of l.keyUpActors)l.runActorWhenKeyEvent(T,_)}),this.interpreter.keyboardTool.keyDownCallbacks.push((_,T,D,L)=>{for(let O of l.keyDownActors)l.runActorWhenKeyEvent(O,_);for(let O of l.internalKeyboardListeners)O.onKeyDown(_,T,D,L)});for(let _ of["mouseup","mousedown","mousemove","mouseenter","mouseleave"]){let T=_;window.PointerEvent&&(T=T.replace("mouse","pointer")),this.$containerInner.on(T,D=>{let L=e*D.offsetX/this.$containerInner.width(),O=t*D.offsetY/this.$containerInner.height(),z=new xe(L*this.globalScale,O*this.globalScale);this.stage.projectionTransform.applyInverse(z,z),L=z.x,O=z.y,l.onMouseEvent(_,L,O,D.button);for(let V of this.internalMouseListeners)V.onMouseEvent(_,L,O);for(let V of this.mouseListeners)V.types[_]!=null&&this.invokeMouseListener(V,_,L,O,D.button);if(_=="mousedown"){let V=this.interpreter.gngEreignisbehandlungHelper;V!=null&&V.handleMouseClickedEvent(L,O)}})}let h=this.$coordinateDiv,d=window.PointerEvent?"pointer":"mouse";this.$containerInner.on(d+"move",_=>{let T=e*_.offsetX/this.$containerInner.width(),D=t*_.offsetY/this.$containerInner.height(),L=new xe(T*this.globalScale,D*this.globalScale);this.stage.projectionTransform.applyInverse(L,L),T=Math.round(L.x),D=Math.round(L.y),h.text(`(${T}/${D})`)}),this.$containerInner.on(d+"enter",_=>{h.show()}),this.$containerInner.on(d+"leave",_=>{h.hide()}),(w=this.module.main.getRightDiv())==null||w.adjustWidthToWorld()}clearActorLists(){this.actActors=[],this.keyPressedActors=[],this.keyUpActors=[],this.keyDownActors=[]}computeCurrentWorldBounds(){let e=new xe(0,0);this.stage.projectionTransform.applyInverse(e,e);let t=new xe(this.initialWidth,this.initialHeight);this.stage.projectionTransform.applyInverse(t,t),this.currentLeft=e.x,this.currentTop=e.y,this.currentWidth=Math.abs(t.x-e.x),this.currentHeight=Math.abs(t.y-e.y)}hasActors(){return this.actActors.length>0||this.keyPressedActors.length>0||this.keyUpActors.length>0||this.keyDownActors.length>0||this.mouseListeners.length>0||this.mouseListenerShapes.length>0}setAllHitpolygonsDirty(){for(let e of this.shapes)e.setHitPolygonDirty(!0)}destroyAll(){for(;this.shapes.length>0;)this.shapes.pop().destroy()}setCursor(e){this.$containerInner.css("cursor",e)}tick(e){var t;if(this.interpreter!=null){switch(this.interpreter.state){case Re.running:this.summedDelta+=e;for(let n of this.spriteAnimations)n.tick(e);if(!this.actorsFinished){this.actorsNotFinished++;break}if(this.interpreter.pauseUntil!=null)break;let i=!0;for(let n of this.actActors){let s=n.actorHelper;if(s.timerPaused||s.isDestroyed)continue;let a=(t=n.method)==null?void 0:t.program;this.runActor(i,n,this.summedDelta),a!=null&&!n.actorHelper.isDestroyed&&(i=!1,this.actorsFinished=!1)}break;case Re.done:case Re.error:case Re.not_initialized:this.clearActorLists();break}this.summedDelta=0,this.interpreter.state==Re.running&&(this.actActors.length>0?(this.interpreter.timerFunction(33.33,!0,.5),this.interpreter.state==Re.running&&(this.interpreter.timerStopped=!1,this.interpreter.timerFunction(33.33,!1,.08))):this.interpreter.timerFunction(33.33,!1,.7))}for(;this.actorHelpersToDestroy.length>0;){let i=this.actorHelpersToDestroy.pop();for(let s of[this.keyPressedActors,this.keyUpActors,this.keyDownActors])for(let a=0;a<s.length;a++)s[a].actorHelper===i&&(s.splice(a,1),a--);for(let s=0;s<this.mouseListenerShapes.length;s++)this.mouseListenerShapes[s].shapeHelper===i&&(this.mouseListenerShapes.splice(s,1),s--);for(let s=0;s<this.actActors.length;s++)this.actActors[s].actorHelper===i&&(this.actActors.splice(s,1),s--);let n=i.displayObject;n!=null&&(n.destroy(),i.displayObject=null)}}setBackgroundColor(e){let t=this.app.renderer;if(typeof e=="string"){let i=Ot.parseColorToOpenGL(e);t.background.color=i.color}else t.background.color=e}runActorWhenKeyEvent(e,t){var l,o;let i=(l=e.method)==null?void 0:l.program,n=(o=e.method)==null?void 0:o.invoke,s=e.actorHelper.runtimeObject,a=[{type:s.class,value:s},{type:F,value:t}];i!=null?this.interpreter.runTimer(e.method,a,null,!1):n!=null&&n([])}runActor(e,t,i){var u,h;let n=(u=t.method)==null?void 0:u.program,s=(h=t.method)==null?void 0:h.invoke,a=t.actorHelper.runtimeObject,l=[{type:a.class,value:a}];t.method.getParameterCount()>0&&l.push({type:A,value:i});let o=this;n!=null?this.interpreter.runTimer(t.method,l,e?d=>{o.actorsFinished=!0,d.timerStopped=!0}:null,!0):s!=null&&s([])}cacheAsBitmap(){let e=this.robotWorldHelper!=null;this.mouseListeners=[],this.mouseListenerShapes=[],this.internalMouseListeners=[],this.internalKeyboardListeners=[];let t=1;this.currentWidth*this.currentHeight>25e5&&(t=Math.sqrt(25e5/(this.currentWidth*this.currentHeight))),this.currentWidth*this.currentHeight<1024*1024&&(t=Math.sqrt(1024*1024/(this.currentWidth*this.currentHeight)));const i=new bl({scaleMode:Xt.LINEAR,width:Math.round(this.currentWidth*t),height:Math.round(this.currentHeight*t)});let n=new bi(i),s=new Ye().scale(t,t);setTimeout(()=>{e||(this.app.renderer.render(this.stage,{renderTexture:n,transform:s}),setTimeout(()=>{this.stage.children.forEach(l=>l.destroy()),this.stage.removeChildren();let a=new Wt(n);a.localTransform.scale(this.globalScale,this.globalScale),a.transform.onChange(),this.stage.projectionTransform=new Ye,this.stage.addChild(a)},300))},150)}destroyWorld(){for(let e of["mouseup","mousedown","mousemove","mouseenter","mouseleave"])this.$containerInner.off(e);this.spriteAnimations=[],this.app.ticker.remove(this.tickerFunction),this.app.stage.children.forEach(e=>e.destroy()),this.app.stage.removeChildren(),this.robotWorldHelper!=null&&(this.robotWorldHelper.destroy(),this.robotWorldHelper=null),I(this.app.view).detach(),this.$containerOuter.remove(),this.module.main.getInterpreter().printManager.getGraphicsDiv().hide(),this.interpreter.timerExtern=!1,this.interpreter.worldHelper=null,this.$coordinateDiv.hide(),Ci.initDefaultValues()}onMouseEvent(e,t,i,n){switch(e){case"mousedown":case"mouseup":for(let s of this.mouseListenerShapes){let a=s.shapeHelper;s.types[e]!=null&&(a.containsPoint(t,i)||a.trackMouseMove)&&this.invokeShapeMouseListener(s,e,t,i,n)}break;case"mouseenter":for(let s of this.mouseListenerShapes){let a=s.shapeHelper;s.types[e]!=null&&a.containsPoint(t,i)&&!a.mouseLastSeenInsideObject&&this.invokeShapeMouseListener(s,e,t,i,n,()=>{a.mouseLastSeenInsideObject=!0})}break;case"mouseleave":for(let s of this.mouseListenerShapes){let a=s.shapeHelper;s.types[e]!=null&&a.mouseLastSeenInsideObject&&this.invokeShapeMouseListener(s,e,t,i,n,()=>{a.mouseLastSeenInsideObject=!1})}break;case"mousemove":for(let s of this.mouseListenerShapes){let a=s.shapeHelper;if(s.types.mousemove!=null||s.types.mouseenter!=null&&!a.mouseLastSeenInsideObject||s.types.mouseleave!=null&&a.mouseLastSeenInsideObject){let l=a.containsPoint(t,i);(a.trackMouseMove||l)&&s.types.mousemove!=null&&this.invokeShapeMouseListener(s,"mousemove",t,i,n),l&&s.types.mouseenter!=null&&!a.mouseLastSeenInsideObject&&this.invokeShapeMouseListener(s,"mouseenter",t,i,n,()=>{a.mouseLastSeenInsideObject=!0}),!l&&s.types.mouseleave!=null&&a.mouseLastSeenInsideObject&&this.invokeShapeMouseListener(s,"mouseleave",t,i,n,()=>{a.mouseLastSeenInsideObject=!1})}}break}}invokeShapeMouseListener(e,t,i,n,s,a){if(!e.shapeHelper.reactToMouseEventsWhenInvisible&&!e.shapeHelper.displayObject.visible)return;let l=e.methods[t],o=l.program,u=l.invoke,h=e.shapeHelper.runtimeObject,d=[{type:h.class,value:h},{type:A,value:i},{type:A,value:n}];t!="mousemove"&&t!="mouseenter"&&t!="mouseleave"&&d.push({type:C,value:s}),o!=null?this.interpreter.runTimer(l,d,a,!1):u!=null&&u([])}addMouseListener(e){let t=this.mouseListenerShapes.findIndex(s=>s.shapeHelper.runtimeObject==e);t>=0&&this.mouseListenerShapes.splice(t,1);let i=[{identifier:"MouseUp",signature:"(double, double, int)"},{identifier:"MouseDown",signature:"(double, double, int)"},{identifier:"MouseMove",signature:"(double, double)"},{identifier:"MouseEnter",signature:"(double, double)"},{identifier:"MouseLeave",signature:"(double, double)"}],n=null;for(let s of i){let a=e.class.getMethodBySignature("on"+s.identifier+s.signature);((a==null?void 0:a.program)!=null&&a.program.statements.length>2||(a==null?void 0:a.invoke)!=null)&&(n==null&&(n={listener:e,types:{},methods:{}},this.mouseListeners.push(n)),n.types[s.identifier.toLowerCase()]=!0,n.methods[s.identifier.toLowerCase()]=a)}}invokeMouseListener(e,t,i,n,s,a){let l=e.methods[t],o=l.program,u=l.invoke,h=e.listener,d=[{type:h.class,value:h},{type:A,value:i},{type:A,value:n}];t!="mousemove"&&t!="mouseenter"&&t!="mouseleave"&&d.push({type:C,value:s}),o!=null?this.interpreter.runTimer(l,d,a,!1):u!=null&&u([])}getDefaultGroup(){var e;return(e=this.defaultGroup)==null?void 0:e.runtimeObject}}class WC extends ${constructor(e){super("Actor",e,"Abstrakte Klasse mit überschreibbaren Methoden act (zur Implementierung eines Timers) und onKeyTyped, onKeyUp usw. zur Entgegennahme von Tastaturereignissen"),this.setBaseClass(e.typeStore.getType("Object")),this.isAbstract=!0;let t=[{signature:"onKeyTyped(String)",actorListIdentifier:"keyPressedActors"},{signature:"onKeyUp(String)",actorListIdentifier:"keyUpActors"},{signature:"onKeyDown(String)",actorListIdentifier:"keyDownActors"},{signature:"act()",actorListIdentifier:"actActors"},{signature:"act(double)",actorListIdentifier:"actActors"}];this.postConstructorCallbacks=[i=>{for(let n of t){let s=i.class.getMethodBySignature(n.signature);if((s==null?void 0:s.program)!=null){let a=i.intrinsicData.Actor;a.worldHelper[n.actorListIdentifier].push({actorHelper:a,method:s})}}}],this.addMethod(new m("Actor",new g([]),null,i=>{let n=i[0].value,s=new fb(e.main.getInterpreter(),n);n.intrinsicData.Actor=s},!1,!1,"Der Konstruktor registriert den Actor beim Grafikfenster",!0)),this.addMethod(new m("destroy",new g([]),null,i=>{i[0].value.intrinsicData.Actor.destroy()},!1,!1,"Vernichtet das Grafikobjekt. Falls es in einem Group-Objekt enthalten ist, wird es vor dem Vernichten automatisch aus diesem entfernt.",!1)),this.addMethod(new m("isKeyUp",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value;return!n.intrinsicData.Actor.isKeyDown(s)},!1,!1,"Gibt genau dann true zurück, wenn der Benutzer die gegebenen Taste gerade NICHT drückt. Als Taste kann auch bsw. [shift]+m angegeben werden. Die Angabe von Sondertasten (Enter, ArrowUp, ArrowLeft, ...) ist auch möglich.",!1)),this.addMethod(new m("isKeyDown",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value;return n.intrinsicData.Actor.isKeyDown(s)},!1,!1,"Gibt genau dann true zurück, wenn der Benutzer die gegebenen Taste gerade drückt. Als Taste kann auch bsw. [shift]+m angegeben werden. Die Angabe von Sondertasten (Enter, ArrowUp, ArrowLeft, ...) ist auch möglich.",!1)),this.addMethod(new m("isGamepadButtonDown",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"buttonIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{i[0].value;let n=i[1].value,s=i[2].value;return e.main.getInterpreter().gamepadTool.isGamepadButtonPressed(n,s)},!1,!1,"Gibt genau dann true zurück, wenn der Button buttonIndex des Gamepads GamepadIndex gedrückt ist.",!1)),this.addMethod(new m("isGamepadConnected",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{i[0].value;let n=i[1].value;return e.main.getInterpreter().gamepadTool.isGamepadConnected(n)},!1,!1,"Gibt true zurück, falls das Gamepad mit dem übergebenen Index angeschlossen ist. VORSICHT: Das erste Gamepad hat Index 0.",!1)),this.addMethod(new m("getGamepadAxisValue",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"axisIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),A,i=>{i[0].value;let n=i[1].value,s=i[2].value;return e.main.getInterpreter().gamepadTool.getGamepadAxisValue(n,s)},!1,!1,"Gibt den Wert des Gamepad-Steuerknüppels mit Index axisIndex zurück.",!1)),this.addMethod(new m("isDestroyed",new g([]),P,i=>i[0].value.intrinsicData.Actor.isDestroyed,!1,!1,"Gibt true zurück, falls das Objekt bereits durch die Methode destroy() zerstört wurde.",!1)),this.addMethod(new m("getWorld",new g([]),e.typeStore.getType("World"),i=>{i[0].value.intrinsicData.Actor;let s=e.main.getInterpreter(),a=s.worldHelper;if(a==null){let l=new he(s.moduleStore.getType("World").type);a=new _l(800,600,s.moduleStore.getModule("Base Module"),l)}return a.world},!1,!1,"Gibt das Welt-Objekt zurück.",!1)),this.addMethod(new m("stopActing",new g([]),U,i=>{i[0].value.intrinsicData.Actor.setTimerPaused(!0)},!1,!1,"Stoppt den 30-mal pro Sekunde erfolgenden Aufruf der Methode act für dieses Objekt.",!1)),this.addMethod(new m("restartActing",new g([]),U,i=>{i[0].value.intrinsicData.Actor.setTimerPaused(!1)},!1,!1,"Startet den 30-mal pro Sekunde erfolgenden Aufruf der Methode act für dieses Objekt erneut.",!1)),this.addMethod(new m("isActing",new g([]),P,i=>!i[0].value.intrinsicData.Actor.timerPaused,!1,!1,"Gibt true zurück, wenn der periodische Aufruf der Methode act weiterhin erfolgt.",!1)),this.addMethod(new m("act",new g([{identifier:"deltaTime",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird ca. 30-mal pro Sekunde aufgerufen",!1)),this.addMethod(new m("act",new g([]),U,null,!1,!1,"Wird ca. 30-mal pro Sekunde aufgerufen",!1)),this.addMethod(new m("onKeyTyped",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, nachdem der Benutzer eine Taste gedrückt und wieder losgelassen hat.",!1)),this.addMethod(new m("onKeyDown",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, nachdem der Benutzer eine Taste gedrückt hat.",!1)),this.addMethod(new m("onKeyUp",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, nachdem der Benutzer eine Taste losgelassen hat.",!1))}registerWorldType(){this.methods.filter(e=>e.identifier=="getWorld")[0].returnType=this.module.typeStore.getType("World")}}class fb{constructor(e,t){y(this,"worldHelper");y(this,"isDestroyed",!1);y(this,"timerPaused",!1);this.runtimeObject=t;let i=e.worldHelper;if(i==null){let n=new he(e.moduleStore.getType("World").type);i=new _l(800,600,e.moduleStore.getModule("Base Module"),n),n.intrinsicData.World=i,t.intrinsicData.isGNG&&i.setBackgroundColor("#e6e6e6")}this.worldHelper=i}setTimerPaused(e){this.timerPaused=e}isKeyDown(e){return this.worldHelper.interpreter.keyboardTool.isPressed(e)}destroy(){this.isDestroyed=!0,this.worldHelper.actorHelpersToDestroy.push(this)}testdestroyed(e){return this.isDestroyed?(this.worldHelper.interpreter.throwException("Es wurde die Methode "+e+" eines bereits mit destroy() zerstörten Grafikobjekts aufgerufen."),!0):!1}}class HC extends $t{constructor(e){super("Alignment",e,[{type:f.pushEnumValue,position:null,identifier:"left"},{type:f.pushEnumValue,position:null,identifier:"center"},{type:f.pushEnumValue,position:null,identifier:"right"},{type:f.pushEnumValue,position:null,identifier:"top"},{type:f.pushEnumValue,position:null,identifier:"bottom"}]),this.documentation="Mögliche Ausrichtungen"}}function hf(r,e,t,i,n){let s=e.x-r.x,a=e.y-r.y,l=t.x-i.x,o=t.y-i.y,u=t.x-r.x,h=t.y-r.y,d=s*o-a*l;if(d*d<1e-6)return!1;let p=u*o-h*l,v=s*h-a*u,w=p/d,_=v/d,T=w>=0&&w<=1&&_>=0&&_<=1;return T&&n!=null&&(n.x=r.x+w*(e.x-r.x),n.y=r.y+w*(e.y-r.y)),T}function Zo(r,e){let t=e.x-r.x,i=e.y-r.y;return Math.sqrt(t*t+i*i)}function pb(r,e,t=1e-6){for(let i=0;i<r.length-1;i++)if(kl(r[i],r[i+1],e)<t)return!0;return!1}function UC(r,e,t=1e-6){for(let i=0;i<r.length;i++)if(kl(r[i%r.length],r[(i+1)%r.length],e)<t)return!0;return!1}function _r(r,e){let t=!1,i=r.length;for(let n=0;n<=i-1;n++){let s=n%i,a=(n-1)%i;a<0&&(a+=i),r[s].y>e.y!=r[a].y>e.y&&e.x<(r[a].x-r[s].x)*(e.y-r[s].y)/(r[a].y-r[s].y)+r[s].x&&(t=!t)}return t}function VC(r,e,t,i,n){let s=t.x,a=t.y,l=i.x,o=i.y,u=(l-s)*(l-s)+(o-a)*(o-a),h=2*(s-r.x)*(l-s)+2*(a-r.y)*(o-a),d=(s-r.x)*(s-r.x)+(a-r.y)*(a-r.y)-e*e,p=h*h-4*u*d;if(p<0)return;let v=Math.sqrt(p),w=(-h+v)/(2*u),_=(-h-v)/(2*u);w>=0&&w<=1&&n.push({x:s+w*(l-s),y:a+w*(o-a)}),_>=0&&_<=1&&n.push({x:s+_*(l-s),y:a+_*(o-a)})}function $C(r,e){for(let t=0;t<r.length;t++)if(_r(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(_r(r,e[t]))return!0;return!1}function XC(r,e){for(let t=0;t<r.length-1;t++)for(let i=0;i<e.length-1;i++)if(hf(r[t],r[t+1],e[i],e[i+1]))return!0;return!1}function kl(r,e,t){let i=e.x-r.x,n=e.y-r.y,s=i*i+n*n,a=((-r.x+t.x)*i+(-r.y+t.y)*n)/s;if(a<0)return Zo(r,t);if(a>1)return Zo(e,t);let l=r.x+a*(e.x-r.x),o=r.y+a*(e.y-r.y),u=t.x-l,h=t.y-o;return Math.sqrt(u*u+h*h)}function gb(r,e,t){let i=e.x-r.x,n=e.y-r.y,s=Math.sqrt(n*n+i*i);return s<1e-9?Zo(r,t):Math.abs(n*t.x-i*t.y+e.x*r.y-e.y*r.x)/s}function Qh(r,e,t=!1,i=!1,n=null){if(r.length==0||e.length==0)return!1;let s=r.length+(t?0:-1),a=e.length+(i?0:-1);if(t&&_r(r,e[0])){if(n!=null){let l=1e5,o=0;for(let h=0;h<r.length-1;h++){let d=(h+1)%r.length,p=kl(r[h],r[d],e[0]);p<l&&(l=p,o=0)}let u=(o+1)%r.length;n.y=r[u].x-r[o].x,n.x=-(r[u].y-r[o].y)}return!0}if(t&&_r(e,r[0]))return!0;for(let l=0;l<s;l++){let o=r[l],u=r[(l+1)%r.length];for(let h=0;h<a;h++){let d=e[h],p=e[(h+1)%e.length];if(hf(o,u,d,p))return!0}}return!1}class KC extends ${constructor(e){super("Shape",e,"Basisklasse für alle graphischen Objekte die verschoben, skaliert und gedreht werden können"),this.setBaseClass(e.typeStore.getType("Actor")),this.isAbstract=!0;let t=e.typeStore.getType("Shape"),i=e.typeStore.getType("Direction");new ze(t);let n=e.typeStore.getType("Vector2");this.addAttribute(new ce("angle",A,s=>{let l=s.object.intrinsicData.Actor;if(l==null||l.isDestroyed||l.displayObject==null){s.value=0;return}s.value=l.angle},!1,ee.protected,!0,"Richtung")),this.addAttribute(new ce("centerX",A,s=>{let l=s.object.intrinsicData.Actor;if(l==null||l.isDestroyed||l.displayObject==null){s.value=0;return}s.value=l.getCenterX()},!1,ee.protected,!0,"X-Koordinate des Diagonalenschnittpunkts der BoundingBox des Objekts")),this.addAttribute(new ce("centerY",A,s=>{let l=s.object.intrinsicData.Actor;if(l==null||l.isDestroyed||l.displayObject==null){s.value=0;return}s.value=l.getCenterY()},!1,ee.protected,!0,"Y-Koordinate des Diagonalenschnittpunkts der BoundingBox des Objekts")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("move",new g([{identifier:"dx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"dy",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=a.intrinsicData.Actor;u.testdestroyed("move")||u.move(l,o)},!1,!1,"Verschiebt das Grafikobjekt um dx Pixel nach rechts und um dy Pixel nach unten.",!1)),this.addMethod(new m("rotate",new g([{identifier:"angleInDeg",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"centerX",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"centerY",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=a.intrinsicData.Actor;h.testdestroyed("rotate")||h.rotate(l,o,u)},!1,!1,"Dreht das Grafikobjekt um den angegebenen Winkel. Drehpunkt ist (centerX, centerY).",!1)),this.addMethod(new m("rotate",new g([{identifier:"angleInDeg",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("rotate")||o.rotate(l)},!1,!1,"Dreht das Grafikobjekt um den angegebenen Winkel. Drehpunkt ist der 'Mittelpunkt' des Objekts",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"centerX",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"centerY",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=s[3].value,h=a.intrinsicData.Actor;h.testdestroyed("scale")||h.scale(l,o,u)},!1,!1,"Streckt das Grafikobjekt um den angegebenen Faktor. Das Zentrum der Streckung ist der Punkt (centerX, centerY)",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("scale")||o.scale(l)},!1,!1,"Streckt das Grafikobjekt um den angegebenen Faktor. Das Zentrum der Streckung ist der 'Mittelpunkt' des Objekts.",!1)),this.addMethod(new m("mirrorX",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;l.testdestroyed("mirrorX")||l.mirrorXY(-1,1)},!1,!1,"Spiegelt das Objekt in X-Richtung.",!1)),this.addMethod(new m("mirrorY",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;l.testdestroyed("mirrorX")||l.mirrorXY(1,-1)},!1,!1,"Spiegelt das Objekt in Y-Richtung.",!1)),this.addMethod(new m("isOutsideView",new g([]),P,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("isOutsideView"))return l.isOutsideView()},!1,!1,"Gibt genau dann true zurück, wenn sich die Bounding Box des Objekts außerhalb des sichtbaren Bereichs befindet. ",!1)),this.addMethod(new m("getCenterX",new g([]),A,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("getCenterX"))return l.getCenterX()},!1,!1,"Gibt die x-Koordinate des 'Mittelpunkts' zurück. Der 'Mittelpunkt' des Grafikobjekts ist der Diagonalenschnittpunkt seiner achsenparallelen Bounding-Box.",!1)),this.addMethod(new m("getCenterY",new g([]),A,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("getCenterY"))return l.getCenterY()},!1,!1,"Gibt die y-Koordinate des 'Mittelpunkts' zurück. Der 'Mittelpunkt' des Grafikobjekts ist der Diagonalenschnittpunkt seiner achsenparallelen Bounding-Box.",!1)),this.addMethod(new m("getAngle",new g([]),A,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("getAngle"))return l.angle},!1,!1,"Gibt den Winkel des Grafikobjekts in Grad zurück. Winkel == 0 bedeutet: dieselbe Richtung wie zum Zeipunkt der Instanzierung des Objekts. Positive Winkelzunahme bedeutet Rechtsdrehung.",!1)),this.addMethod(new m("containsPoint",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),P,s=>{let a=s[0].value,l=s[1].value,o=s[2].value,u=a.intrinsicData.Actor;if(!u.testdestroyed("containsPoint"))return u.containsPoint(l,o)},!1,!1,"Gibt genau dann true zurück, wenn das Grafikobjekt den Punkt (x, y) enthält.",!1)),this.addMethod(new m("collidesWith",new g([{identifier:"object",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,s=>{let a=s[0].value,l=s[1].value;l==null&&e.main.getInterpreter().throwException("Der Parameter der Methode collidesWith darf nicht null sein.");let o=a.intrinsicData.Actor,u=l.intrinsicData.Actor;if(!o.testdestroyed("collidesWith")){if(u.isDestroyed){o.worldHelper.interpreter.throwException("Die der Methode collidesWith als Parameter übergebene Figur ist bereits zerstört.");return}return o.collidesWith(u)}},!1,!1,"Gibt genau dann true zurück, wenn das Grafikobjekt und das andere Grafikobjekt kollidieren.",!1)),this.addMethod(new m("collidesWithAnyShape",new g([]),P,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("collidesWithAnyShape"))return l.collidesWithAnyShape()},!1,!1,"Gibt genau dann true zurück, wenn das Grafikobjekt mit irgendeinem anderen Grafikobjekt kollidiert.",!1)),this.addMethod(new m("collidesWithFillColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;if(!o.testdestroyed("collidesWithFillColor"))return o.collidesWithAnyShape(l)},!1,!1,"Gibt genau dann true zurück, wenn das Grafikobjekt mit einem anderen Grafikobjekt der angegebenen Füllfarbe kollidiert.",!1)),this.addMethod(new m("collidesWithFillColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;if(o.testdestroyed("collidesWithFillColor"))return;let u=Ot.parseColorToOpenGL(l);return o.collidesWithAnyShape(u.color)},!1,!1,"Gibt genau dann true zurück, wenn das Grafikobjekt mit einem anderen Grafikobjekt der angegebenen Füllfarbe kollidiert.",!1)),this.addMethod(new m("getFirstCollidingSprite",new g([{identifier:"imageIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;if(!o.testdestroyed("getFirstCollidingSprite"))return o.getFirstCollidingSprite(l)},!1,!1,"Falls dieses Grafikobjekt gerade mindestens ein Sprite mit dem übergebenen Bildindex (null bedeutet: mit irgendeinem BildIndex) berührt, wird das erste dieser Sprites zurückgegeben.",!1)),this.addMethod(new m("moveBackFrom",new g([{identifier:"otherShape",type:this,declaration:null,usagePositions:null,isFinal:!0},{identifier:"keepColliding",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=s[2].value;l==null&&e.main.getInterpreter().throwException("Der erste Parameter der Methode moveBackFrom darf nicht null sein.");let u=a.intrinsicData.Actor,h=l.intrinsicData.Actor;if(!u.testdestroyed("moveBackFrom")){if(h.isDestroyed){u.worldHelper.interpreter.throwException("Die der Methode moveBackFrom als Parameter übergebene Figur ist bereits zerstört.");return}u.moveBackFrom(h,o)}},!1,!1,"Rückt das Objekt entlang der letzten durch move vorgegebenen Richtung zurück, bis es das übergebene Objekt gerade noch (keepColliding == true) bzw. gerade nicht mehr (keepColliding == false) berührt.",!1)),this.addMethod(new m("directionRelativeTo",new g([{identifier:"otherShape",type:this,declaration:null,usagePositions:null,isFinal:!0}]),i,s=>{let a=s[0].value,l=s[1].value;l==null&&e.main.getInterpreter().throwException("Der erste Parameter der Methode directionRelativeTo darf nicht null sein.");let o=a.intrinsicData.Actor,u=l.intrinsicData.Actor;if(!o.testdestroyed("directionRelativeTo")){if(u.isDestroyed){o.worldHelper.interpreter.throwException("Die der Methode directionRelativeTo als Parameter übergebene Figur ist bereits zerstört.");return}return o.directionRelativeTo(u,i)}},!1,!1,"Gibt die Richtung (top, right, bottom oder left) zurück, in der das graphische Objekt relativ zum übergebenen graphischen Objekt steht.",!1)),this.addMethod(new m("moveTo",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value,u=s[2].value;l.testdestroyed("moveTo")||l.move(o-l.getCenterX(),u-l.getCenterY())},!1,!1,"Verschiebt das Grafikobjekt so, dass sich sein 'Mittelpunkt' an den angegebenen Koordinaten befindet.",!1)),this.addMethod(new m("defineCenter",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value,u=s[2].value;l.testdestroyed("defineCenter")||l.defineCenter(o,u)},!1,!1,"Setzt fest, wo der 'Mittelpunkt' des Objekts liegen soll. Dieser Punkt wird als Drehpunkt der Methode rotate, als Zentrum der Methode Scale und als Referenzpunkt der Methode moveTo benutzt.",!1)),this.addMethod(new m("defineCenterRelative",new g([{identifier:"xRel",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"yRel",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value,u=s[2].value;l.testdestroyed("defineCenterRelative")||l.defineCenterRelative(o,u)},!1,!1,`Setzt fest, wo der 'Mittelpunkt' des Objekts liegen soll. Dabei bedeutet (XRel/YRel) = (0/0) die linke obere Ecke der Bounding Box des Objekts, (XRel/YRel) = (1/1) die rechte untere Ecke. Defaultwert ist (XRel/YRel) = (0.5/0.5), also der Diagonalenschnittpunkt der Bounding Box. Dieser Punkt wird als Drehpunkt der Methode rotate, als Zentrum der Methode Scale und als Referenzpunkt der Methode moveTo benutzt.

VORSICHT: Diese Methode arbeitet nicht mehr korrekt, wenn das Objekt schon gedreht wurde!`,!1)),this.addMethod(new m("setAngle",new g([{identifier:"angleDeg",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value;l.testdestroyed("setAngle")||l.rotate(o-l.angle)},!1,!1,"Dreht das Objekt zur angegebenen Richtung.",!1)),this.addMethod(new m("setDefaultVisibility",new g([{identifier:"visibility",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[1].value;Ci.setDefaultVisibility(a)},!1,!0,'Setzt den Standardwert für das Attribut "visible". Dieser wird nachfolgend immer dann verwendet, wenn ein neues grafisches Objekt instanziert wird.',!1)),this.addMethod(new m("setVisible",new g([{identifier:"visible",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value;l.testdestroyed("setVisible")||l.setVisible(o)},!1,!1,"Macht das Grafikobjekt sichtbar (visible == true) bzw. unsichtbar (visible == false).",!1)),this.addMethod(new m("isVisible",new g([]),P,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("isVisible"))return l.displayObject.visible},!1,!1,"Gibt den Wert der Eigenschaft 'visible' des Grafikobjekts zurück.",!1)),this.addMethod(new m("setStatic",new g([{identifier:"isStatic",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let l=s[0].value.intrinsicData.Actor,o=s[1].value;l.testdestroyed("setStatic")||l.setStatic(o)},!1,!1,"setStatic(true) hat zur Folge, dass die Ansicht des Objekts durch Transformationen des World-Objekts nicht verändert wird.",!1)),this.addMethod(new m("onMouseEnter",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Mauspfeil in das Objekt hineinbewegt.",!1)),this.addMethod(new m("onMouseLeave",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Mauspfeil in das Objekt hineinbewegt.",!1)),this.addMethod(new m("onMouseDown",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"key",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Mauspfeil über dem Objekt befindet und der Benutzer eine Maustaste nach unten drückt.",!1)),this.addMethod(new m("onMouseUp",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"key",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Mauspfeil über dem Objekt befindet und der Benutzer eine Maustaste loslässt.",!1)),this.addMethod(new m("onMouseMove",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Mauspfeil über dem Objekt befindet und bewegt.",!1)),this.addMethod(new m("tint",new g([{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("tint")||o.tint(l)},!1,!1,"Überzieht das Grafikobjekt mit einer halbdurchsichtigen Farbschicht.",!1)),this.addMethod(new m("tint",new g([{identifier:"colorAsInt",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("tint")||o.tint(l)},!1,!1,"Überzieht das Grafikobjekt mit einer halbdurchsichtigen Farbschicht. Die Farbe wird als int-Wert angegeben, praktischerweise hexadezimal, also z.B. tint(0x303030).",!1)),this.addMethod(new m("startTrackingEveryMouseMovement",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;l.trackMouseMove=!0},!1,!1,'Sorgt dafür, dass ab jetzt JEDE Bewegung des Mauszeigers (auch wenn sich dieser außerhalb des Objekts befindet) ein MouseMove-Ereignis für dieses Objekt auslöst. -> Praktisch zur Umsetzung des "Ziehens" von Objekten mit der Maus!',!1)),this.addMethod(new m("stopTrackingEveryMouseMovement",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;l.trackMouseMove=!1},!1,!1,'Sorgt dafür, dass ab jetzt nur noch dann Bewegungen des Mauszeigers ein MouseMove-Ereignis für dieses Objekt auslösen, wenn sich der Mauszeiger über dem Objekt befindet. -> Praktisch zur Umsetzung des "Ziehens" von Objekten mit der Maus!',!1)),this.addMethod(new m("reactToMouseEventsWhenInvisible",new g([{identifier:"react",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.reactToMouseEventsWhenInvisible=l},!1,!1,"Legt fest, ob das Objekt auf Mausevents (buttondown, mouse move, ...) reagiert, wenn es unsichtbar ist.",!1)),this.addMethod(new m("tint",new g([{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("tint")||o.tint(l)},!1,!1,"Überzieht das Grafikobjekt mit einer halbdurchsichtigen Farbschicht.",!1)),this.addMethod(new m("defineDirection",new g([{identifier:"angleInDeg",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("defineDirection")||(o.directionRad=l/180*Math.PI)},!1,!1,`Setzt die Blickrichtung des graphischen Objekts. Dies ist die Richtung, in die es durch Aufruf der Methode forward bewegt wird. 
Bemerkung: die Methode rotate ändert auch die Blickrichtung!`,!1)),this.addMethod(new m("forward",new g([{identifier:"distance",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("forward")||o.forward(l)},!1,!1,`Bewegt das Objekt um die angegebene Länge in Richtung seiner Blickrichtung.
Bemerkung: Die Blickrichtung kann mit defineDirection gesetzt werden.`,!1)),this.addMethod(new m("copy",new g([]),this,s=>{let a=s[0].value,l=a.intrinsicData.Actor;if(!l.testdestroyed("copy"))return l.getCopy(a.class)},!0,!1,"Erstellt eine Kopie des Grafikobjekts und git sie zurück.",!1)),this.addMethod(new m("bringToFront",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("bringToFront"))return l.bringToFront()},!1,!1,"Setzt das Grafikobjekt vor alle anderen.",!1)),this.addMethod(new m("sendToBack",new g([]),U,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("sendToBack"))return l.sendToBack()},!1,!1,"Setzt das Grafikobjekt hinter alle anderen.",!1)),this.addMethod(new m("getHitPolygon",new g([]),new ze(n),s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("getHitPolygon"))return l.getHitPolygon(n)},!1,!1,"Gibt ein Array zurück, das die vier Eckpunkte des Hit-Polygons in Form von Vector2-Ortsvektoren enthält. Bei den Klassen Rectangle, Triangle und Polygon sind dies die Eckpunkte.",!1)),this.addMethod(new m("getScale",new g([]),A,s=>{let l=s[0].value.intrinsicData.Actor;if(!l.testdestroyed("getScale"))return l.scaleFactor},!1,!1,"Gibt den Wert des Streckungsfaktors zurück.",!1)),this.addMethod(new m("setScale",new g([{identifier:"newFactor",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Actor;o.testdestroyed("setScale")||o.scale(l/o.scaleFactor)},!1,!1,"Setzt den Wert des Streckungsfaktors ausgehend vom Wert 1.0 nach Instanzieren des Objekts. Im Unterschied zu dieser Methode multipliziert die Methode scale(double factor) den aktuellen Streckungsfaktor mit dem angegebenen Wert.",!1))}setSpriteType(e){this.methods.find(t=>t.identifier=="getFirstCollidingSprite").returnType=e}}class sa extends fb{constructor(t,i){super(t,i);y(this,"displayObject");y(this,"belongsToGroup");y(this,"centerXInitial");y(this,"centerYInitial");y(this,"angle",0);y(this,"hitPolygonInitial",null);y(this,"hitPolygonTransformed",null);y(this,"hitPolygonDirty",!0);y(this,"reactToMouseEventsWhenInvisible",!1);y(this,"mouseLastSeenInsideObject",!1);y(this,"trackMouseMove",!1);y(this,"scaleFactor",1);y(this,"directionRad",0);y(this,"lastMoveDx",0);y(this,"lastMoveDy",0);let n=[{identifier:"MouseUp",signature:"(double, double, int)"},{identifier:"MouseDown",signature:"(double, double, int)"},{identifier:"MouseMove",signature:"(double, double)"},{identifier:"MouseEnter",signature:"(double, double)"},{identifier:"MouseLeave",signature:"(double, double)"}],s=null;for(let a of n){let l=i.class.getMethodBySignature("on"+a.identifier+a.signature);((l==null?void 0:l.program)!=null||(l==null?void 0:l.invoke)!=null)&&(s==null&&(s={shapeHelper:this,types:{},methods:{}},this.worldHelper.mouseListenerShapes.push(s)),s.types[a.identifier.toLowerCase()]=!0,s.methods[a.identifier.toLowerCase()]=l)}this.worldHelper.defaultGroup==null&&this.worldHelper.shapes.push(this)}copyFrom(t){if(this.centerXInitial=t.centerXInitial,this.centerYInitial=t.centerYInitial,t.hitPolygonInitial!=null){this.hitPolygonInitial=[];for(let i of t.hitPolygonInitial)this.hitPolygonInitial.push(Object.assign({},i))}this.setHitPolygonDirty(!0),this.hitPolygonDirty=t.hitPolygonDirty,this.reactToMouseEventsWhenInvisible=t.reactToMouseEventsWhenInvisible,this.mouseLastSeenInsideObject=t.mouseLastSeenInsideObject,this.displayObject.localTransform.copyFrom(t.displayObject.transform.localTransform),this.displayObject.updateTransform()}setHitPolygonDirty(t){this.hitPolygonDirty=t}bringOnePlaneFurtherToFront(){let t=this.displayObject.parent,i=t.children.length-1,n=t.getChildIndex(this.displayObject);n<i&&t.setChildIndex(this.displayObject,n+1)}bringOnePlaneFurtherToBack(){let t=this.displayObject.parent,i=t.getChildIndex(this.displayObject);i>0&&t.setChildIndex(this.displayObject,i-1)}bringToFront(){let t=this.displayObject.parent,i=t.children.length-1;this.belongsToGroup!=null?this.belongsToGroup.setChildIndex(this,i):t.setChildIndex(this.displayObject,i)}sendToBack(){this.belongsToGroup!=null?this.belongsToGroup.setChildIndex(this,0):this.displayObject.parent.setChildIndex(this.displayObject,0)}addToDefaultGroupAndSetDefaultVisibility(){this.displayObject.visible=Ci.defaultVisibility,this.worldHelper.defaultGroup!=null&&(this.runtimeObject.intrinsicData.Actor=this,this.worldHelper.defaultGroup.add(this.runtimeObject))}tint(t){let i;typeof t=="string"?i=Ot.parseColorToOpenGL(t).color:i=t,this.displayObject.tint&&(this.displayObject.tint=i),this.render()}setVisible(t){this.displayObject.visible=t}getFirstCollidingSpriteHelper(t,i){for(let n of i){if(n==this)continue;let s=n.index;if(!s){if(n.shapes){let o=n.shapes,u=this.getFirstCollidingSpriteHelper(t,o.map(h=>h.intrinsicData.Actor));if(u)return u}continue}if(t!=null&&t!=s)continue;let a=this.displayObject.getBounds(),l=n.displayObject.getBounds();if(!(a.left>l.right||l.left>a.right)&&!(a.top>l.bottom||l.top>a.bottom)&&(n.hitPolygonDirty&&n.transformHitPolygon(),Qh(this.hitPolygonTransformed,n.hitPolygonTransformed,!0,!0)))return n.runtimeObject}}getFirstCollidingSprite(t){return this.displayObject.updateTransform(),this.hitPolygonDirty&&this.transformHitPolygon(),this.getFirstCollidingSpriteHelper(t,this.worldHelper.shapes)}collidesWithAnyShape(t){this.displayObject.updateTransform(),this.hitPolygonDirty&&this.transformHitPolygon();for(let i of this.worldHelper.shapes){if(this==i||t!=null&&i.fillColor!=t)continue;if(i.shapes||i.turtle){if(i.collidesWith(this))return!0;continue}let n=this.displayObject.getBounds(),s=i.displayObject.getBounds();if(!(n.left>s.right||s.left>n.right)&&!(n.top>s.bottom||s.top>n.bottom)&&(i.hitPolygonDirty&&i.transformHitPolygon(),Qh(this.hitPolygonTransformed,i.hitPolygonTransformed,!0,!0)))return!0}return!1}collidesWith(t){if(this.lineElements==null&&t.lineElements!=null)return t.collidesWith(this);if(t.shapes)return t.collidesWith(this);if(this.displayObject==null||t.displayObject==null)return;this.displayObject.updateTransform(),t.displayObject.updateTransform();let i=this.displayObject.getBounds(),n=t.displayObject.getBounds();return i.left>n.right||n.left>i.right||i.top>n.bottom||n.top>i.bottom?!1:this.hitPolygonInitial==null||t.hitPolygonInitial==null?!0:(this.hitPolygonDirty&&this.transformHitPolygon(),t.hitPolygonDirty&&t.transformHitPolygon(),Qh(this.hitPolygonTransformed,t.hitPolygonTransformed,!0,!0))}directionRelativeTo(t,i){this.displayObject.updateTransform(),t.displayObject.updateTransform();let n=this.displayObject.getBounds(),s=t.displayObject.getBounds(),a=s.left-n.right,l=n.left-s.right,o=s.top-n.bottom,u=n.top-s.bottom,h=i.enumInfoList,d=[];this.lastMoveDx>0?d.push({distance:a,ei:h[3]}):this.lastMoveDx<0&&d.push({distance:l,ei:h[1]}),this.lastMoveDy>0?d.push({distance:o,ei:h[0]}):this.lastMoveDy<0&&d.push({distance:u,ei:h[2]}),d.length==0&&(d=[{distance:a,ei:h[3]},{distance:l,ei:h[1]},{distance:o,ei:h[0]},{distance:u,ei:h[2]}]);let p=d[0].distance,v=d[0].ei;for(let w=1;w<d.length;w++)d[w].distance>p&&(p=d[w].distance,v=d[w].ei);return v.object}moveBackFrom(t,i){let n=this.lastMoveDx,s=this.lastMoveDy,a=Math.sqrt(n*n+s*s);if(a<.001||!this.collidesWith(t))return;let l=0;this.move(-n,-s);let o=-1;for(;this.collidesWith(t);){l=o;let d=o*2;if(this.move(n*(d-o),s*(d-o)),o=d,(o+1)*a<-100){this.move(n*(-1-o),s*(-1-o));return}}let u=o,h=!1;for(;(l-u)*a>1;){let d=(l+u)/2;this.move(n*(d-o),s*(d-o)),(h=this.collidesWith(t))?l=d:u=d,o=d}i&&!h?this.move(n*(l-o),s*(l-o)):h&&!i&&this.move(n*(u-o),s*(u-o)),this.lastMoveDx=n,this.lastMoveDy=s}containsPoint(t,i){return this.displayObject.getBounds().contains(t,i)?this.hitPolygonInitial==null?!0:(this.hitPolygonDirty&&this.transformHitPolygon(),_r(this.hitPolygonTransformed,{x:t,y:i})):!1}transformHitPolygon(){this.displayObject.updateTransform(),this.hitPolygonTransformed=[];let t=this.displayObject.transform.worldTransform;for(let i of this.hitPolygonInitial)this.hitPolygonTransformed.push({x:t.a*i.x+t.c*i.y+t.tx,y:t.b*i.x+t.d*i.y+t.ty});this.setHitPolygonDirty(!1)}isOutsideView(){let t=this.displayObject.getBounds(!0),i=this.worldHelper;return t.right<i.currentLeft||t.left>i.currentLeft+i.currentWidth||t.bottom<i.currentTop||t.top>i.currentTop+i.currentHeight}defineCenter(t,i){let n=new xe(t,i);this.displayObject.transform.worldTransform.applyInverse(n,n),this.centerXInitial=n.x,this.centerYInitial=n.y}defineCenterRelative(t,i){let n=this.displayObject.getBounds(!1);this.defineCenter(n.left+n.width*t,n.top+n.height*i)}move(t,i){(t!=0||i!=0)&&(this.lastMoveDx=t,this.lastMoveDy=i),this.displayObject.localTransform.translate(t,i),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0)}forward(t){let i=t*Math.cos(this.directionRad),n=-t*Math.sin(this.directionRad);this.move(i,n)}rotate(t,i,n){if(i==null){let s=new xe(this.centerXInitial,this.centerYInitial);this.displayObject.localTransform.apply(s,s),i=s.x,n=s.y}else{let s=new xe(i,n);this.displayObject.updateTransform(),this.displayObject.transform.worldTransform.applyInverse(s,s),this.displayObject.localTransform.apply(s,s),i=s.x,n=s.y}this.displayObject.localTransform.translate(-i,-n),this.displayObject.localTransform.rotate(-t/180*Math.PI),this.displayObject.localTransform.translate(i,n),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0),this.angle+=t,this.directionRad+=t/180*Math.PI}mirrorXY(t,i){let n,s,a=new xe(this.centerXInitial,this.centerYInitial);this.displayObject.localTransform.apply(a,a),n=a.x,s=a.y,this.displayObject.localTransform.translate(-n,-s),this.displayObject.localTransform.scale(t,i),this.displayObject.localTransform.translate(n,s),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0)}scale(t,i,n){if(i==null){let s=new xe(this.centerXInitial,this.centerYInitial);this.displayObject.localTransform.apply(s,s),i=s.x,n=s.y}else{let s=new xe(i,n);this.displayObject.transform.worldTransform.applyInverse(s,s),this.displayObject.localTransform.apply(s,s),i=s.x,n=s.y}this.displayObject.localTransform.translate(-i,-n),this.displayObject.localTransform.scale(t,t),this.displayObject.localTransform.translate(i,n),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0),this.scaleFactor*=t}getCenterX(){let t=new xe(this.centerXInitial,this.centerYInitial);return this.displayObject.updateTransform(),this.displayObject.transform.worldTransform.apply(t,t),t.x}getCenterY(){let t=new xe(this.centerXInitial,this.centerYInitial);return this.displayObject.updateTransform(),this.displayObject.transform.worldTransform.apply(t,t),t.y}destroy(){if(super.destroy(),this.belongsToGroup!=null)this.belongsToGroup.remove(this.runtimeObject);else{let i=this.worldHelper.shapes.indexOf(this);i>=0&&this.worldHelper.shapes.splice(i,1)}let t=this.worldHelper.shapesNotAffectedByWorldTransforms.indexOf(this);t>=0&&this.worldHelper.shapesNotAffectedByWorldTransforms.splice(t,1)}getCollidingShapes(t,i){let n=[];for(let s of t.shapes)s.intrinsicData.Actor.collidesWith(this)&&n.push({type:i,value:s});return n}getHitPolygon(t){this.hitPolygonDirty&&this.transformHitPolygon();let i=[];for(let n of this.hitPolygonTransformed){let s=new he(t);s.attributes=[{type:A,value:n.x},{type:A,value:n.y}],i.push({type:t,value:s})}return i}setStatic(t){let i=this.worldHelper.shapesNotAffectedByWorldTransforms;if(t)i.push(this);else{let n=i.indexOf(this);n>=0&&i.splice(n,1)}}getParentGroup(){var t;return((t=this.belongsToGroup)==null?void 0:t.runtimeObject)||null}borderContainsPoint(t,i,n=-1){return!1}}class qC extends ${constructor(e){super("Bitmap",e,"Rechteckige Bitmap mit beliebiger Auflösung und Positionierung in der Grafikausgabe"),this.setBaseClass(e.typeStore.getType("Shape"));let t=this.module.typeStore.getType("Color");this.addMethod(new m("Bitmap",new g([{identifier:"pointsX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"pointsY",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"left",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"top",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"displayWidth",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"displayHeight",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=i[5].value,h=i[6].value,d=new df(s,a,l,o,u,h,e.main.getInterpreter(),n);n.intrinsicData.Actor=d},!1,!1,"Instanziert eine neue Bitmap. pointsX bzw. pointsY bezeichnet Anzahl der Bildpunkte in x bzw. y-Richtung, (left, top) sind die Koordinaten der linken oberen Ecke.",!0)),this.addMethod(new m("getColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),t,i=>{let n=i[0].value,s=i[1].value,a=i[2].value;return n.intrinsicData.Actor.getFarbeAsObject(s,a,t)},!1,!1,"Gibt die Farbe des Punkts (x, y) zurück.",!1)),this.addMethod(new m("setColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=n.intrinsicData.Actor;s<0||s>u.anzahlX||a<0||a>u.anzahlY?e.main.getInterpreter().throwException("Die Koordinaten "+s+", "+a+" liegen außerhalb der Bitmap mit der Auflösung "+u.anzahlX+", "+u.anzahlY+"."):u.setzeFarbe(s,a,l,o)},!1,!1,"Setzt die Farbe des Pixels bei (x, y). Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0.",!1)),this.addMethod(new m("setColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=n.intrinsicData.Actor;s<0||s>o.anzahlX||a<0||a>o.anzahlY?e.main.getInterpreter().throwException("Die Koordinaten "+s+", "+a+" liegen außerhalb der Bitmap mit der Auflösung "+o.anzahlX+", "+o.anzahlY+"."):o.setzeFarbe(s,a,l)},!1,!1,"Setzt die Farbe des Pixels bei (x, y). Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau.",!1)),this.addMethod(new m("setColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=n.intrinsicData.Actor;s<0||s>o.anzahlX||a<0||a>o.anzahlY?e.main.getInterpreter().throwException("Die Koordinaten "+s+", "+a+" liegen außerhalb der Bitmap mit der Auflösung "+o.anzahlX+", "+o.anzahlY+"."):o.setzeFarbe(s,a,l)},!1,!1,'Setzt die Farbe des Pixels bei (x, y). Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("setColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=n.intrinsicData.Actor;s<0||s>u.anzahlX||a<0||a>u.anzahlY?e.main.getInterpreter().throwException("Die Koordinaten "+s+", "+a+" liegen außerhalb der Bitmap mit der Auflösung "+u.anzahlX+", "+u.anzahlY+"."):u.setzeFarbe(s,a,l,o)},!1,!1,'Setzt die Farbe des Pixels bei (x, y). Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)". 0.0 <= alpha <= 1.0.',!1)),this.addMethod(new m("isColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value;return n.intrinsicData.Actor.istFarbe(s,a,l)},!1,!1,'Gibt genau dann true zurück, wenn das Pixel bei (x, y) die angegebene Farbe besitzt. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("isColor",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value;return n.intrinsicData.Actor.istFarbe(s,a,l,1)},!1,!1,"Gibt genau dann true zurück, wenn das Pixel bei (x, y) die angegebene Farbe besitzt. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("fillAll",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value;n.intrinsicData.Actor.fillAll(s,a)},!1,!1,"Füllt die ganze Bitmap mit einer Farbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("fillAll",new g([{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value;n.intrinsicData.Actor.fillAll(s)},!1,!1,'Füllt die ganze Bitmap mit einer Farbe. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("copy",new g([]),this,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(!s.testdestroyed("copy"))return s.getCopy(n.class)},!1,!1,"Erstellt eine Kopie des Bitmap-Objekts und git sie zurück.",!1)),this.addMethod(new m("clone",new g([]),this,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(!s.testdestroyed("clone"))return s.getCopyOrClone(n.class,!0)},!1,!1,"Erstellt ein weiteres Bitmap-Objekt, das auf dieselben Pixeldaten zurückgreift.",!1))}}class df extends sa{constructor(t,i,n,s,a,l,o,u,h,d=!1){super(o,u);y(this,"texture");y(this,"data");y(this,"isBigEndian",!0);this.anzahlX=t,this.anzahlY=i,this.left=n,this.top=s,this.width=a,this.height=l;let p=new Uint32Array([287454020]),v=new Uint8Array(p.buffer);v[0]===68?this.isBigEndian=!1:v[0]===17&&(this.isBigEndian=!0),this.centerXInitial=n+a/2,this.centerYInitial=s+l/2,this.hitPolygonInitial=[{x:n,y:s},{x:n,y:s+l},{x:n+a,y:s+l},{x:n+a,y:s}],this.initGraphics(h,d);let w=this.displayObject;w.localTransform.scale(a/t,l/i),w.localTransform.translate(n,s),w.transform.onChange();let _=new xe(this.centerXInitial,this.centerYInitial);w.localTransform.applyInverse(_,_),this.centerXInitial=_.x,this.centerYInitial=_.y,this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(t){return this.getCopyOrClone(t,!1)}getCopyOrClone(t,i=!1){let n=new he(t),s=new df(this.anzahlX,this.anzahlY,this.left,this.top,this.width,this.height,this.worldHelper.interpreter,n,this,i);return n.intrinsicData.Actor=s,s.copyFrom(this),s.render(),n}render(){}initGraphics(t,i=!1){t==null?this.data=new Uint32Array(this.anzahlX*this.anzahlY):i?this.data=t.data:this.data=new Uint32Array(t.data);let n=new Uint8Array(this.data.buffer);if(i)this.texture=t.texture;else{let s=new cs(n,{width:this.anzahlX,height:this.anzahlY}),a=new Be(s,{scaleMode:Xt.NEAREST});this.texture=new ye(a)}this.displayObject=new Wt(this.texture),this.worldHelper.stage.addChild(this.displayObject)}uploadData(){this.texture.baseTexture.update()}getFarbeAsObject(t,i,n){let s=t+i*this.anzahlX,a=new he(n),l=this.data[s],o=l&255,u=(l&65280)>>8,h=(l&16711680)>>16,d={red:o,green:u,blue:h,hex:Ot.intColorToHexRGB(l>>8)};return a.intrinsicData=d,a}istFarbe(t,i,n,s){let a=t+i*this.anzahlX,l;if(typeof n=="string"){let p=Ot.parseColorToOpenGL(n);l=p.color,p.alpha}else l=n;let o=this.data[a],u=o&255,h=(o&65280)>>8,d=(o&16711680)>>16;return l==u*65536+h*256+d}setzeFarbe(t,i,n,s){let a=t+i*this.anzahlX,l;if(typeof n=="string"){let o=Ot.parseColorToOpenGL(n);l=o.color,s==null&&(s=o.alpha)}else l=n,s==null&&(s=1);this.data[a]=Math.round(s*255)*16777216+((l&255)<<16)+(l&65280)+((l&16711680)>>16),this.uploadData()}fillAll(t,i){let n;if(typeof t=="string"){let s=Ot.parseColorToOpenGL(t);n=s.color,i=s.alpha}else n=t;this.data.fill(Math.round(i*255)*16777216+((n&255)<<16)+(n&65280)+((n&16711680)>>16)),this.uploadData()}setzeFarbeRGBA(t,i,n,s,a,l){let o=l*4278190080+a*65536+s*256+n,u=t+i*this.anzahlX;this.data[u]=o,this.uploadData()}getFarbe(t,i){let n=this.data[t+i*this.anzahlX]&16777215;return(n&255)<<16+(n&65280)+(n&16711680)>>16}getAlpha(t,i){return(this.data[t+i*this.anzahlX]&4278190080)>>24/255}}class YC extends ${constructor(e){super("FilledShape",e,"Basisklasse für grafische Objekte mit Füllfarbe und Randfarbe, beide wahlweise auch transparent"),this.setBaseClass(e.typeStore.getType("Shape")),this.isAbstract=!0;let t=this.module.typeStore.getType("Color");this.addMethod(new m("getFillColor",new g([]),t,i=>{let s=i[0].value.intrinsicData.Actor;return s.getFarbeAsObject(s.fillColor,s.fillColor,t)},!1,!1,"Gibt die Füllfarbe des Objekts zurück.",!1)),this.addMethod(new m("getBorderColor",new g([]),t,i=>{let s=i[0].value.intrinsicData.Actor;return s.getFarbeAsObject(s.borderColor,s.borderColor,t)},!1,!1,"Gibt die Randfarbe des Objekts zurück.",!1)),this.addAttribute(new ce("borderWidth",A,i=>{let s=i.object.intrinsicData.Actor;if(s==null){i.value=Number.NaN;return}i.value=s.borderWidth},!1,ee.protected,!0,"Randbreite in Pixeln")),this.addMethod(new m("setAlpha",new g([{identifier:"alphaValue",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setAlpha")||a.setAlpha(s)},!1,!1,'Setzt die Durchsichtigkeit von Füllung und Rand. 0.0 bedeutet vollkommen durchsichtig, 1.0 bedeutet vollkommen undurchsichtig."',!1)),this.addMethod(new m("getAlpha",new g([]),A,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getAlpha"))return s.fillAlpha},!1,!1,'Setzt die Durchsichtigkeit von Füllung und Rand. 0.0 bedeutet vollkommen durchsichtig, 1.0 bedeutet vollkommen undurchsichtig."',!1)),this.addMethod(new m("setFillColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setFillColor")||a.setFillColor(s)},!1,!1,"Setzt die Füllfarbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau",!1)),this.addMethod(new m("setDefaultBorder",new g([{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[1].value,s=i[2].value;Ci.setDefaultBorder(n,s)},!1,!0,"Setzt Default-Eigenschaften des Randes. Sie werden nachfolgend immer dann verwendet, wenn ein neues grafisches Objekt erstellt wird. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("setDefaultBorder",new g([{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[1].value,s=i[2].value,a=i[3].value;Ci.setDefaultBorder(n,s,a)},!1,!0,"Setzt Default-Eigenschaften des Randes. Sie werden nachfolgend immer dann verwendet, wenn ein neues grafisches Objekt erstellt wird. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("setDefaultFillColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[1].value,s=i[2].value;Ci.setDefaultFillColor(n,s)},!1,!0,"Setzt die Default-Füllfarbe. Sie wird nachfolgend immer dann verwendet, wenn ein neues grafisches Objekt erstellt wird. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("setDefaultFillColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[1].value;Ci.setDefaultFillColor(n)},!1,!0,"Setzt die Default-Füllfarbe. Sie wird nachfolgend immer dann verwendet, wenn ein neues grafisches Objekt erstellt wird. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("setFillColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setFillColor")||l.setFillColor(s,a)},!1,!1,"Setzt die Füllfarbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0",!1)),this.addMethod(new m("setFillColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setFillColor")||a.setFillColor(s)},!1,!1,'Setzt die Füllfarbe. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("setFillColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setFillColor")||l.setFillColor(s,a)},!1,!1,'Setzt die Füllfarbe. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" oder "rgb(172, 22, 18)" und 0.0 <= alpha <= 1.0"',!1)),this.addMethod(new m("setBorderColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setBorderColor")||a.setBorderColor(s)},!1,!1,'Setzt die Randfarbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau"',!1)),this.addMethod(new m("setBorderColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setBorderColor")||l.setBorderColor(s,a)},!1,!1,'Setzt die Randfarbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau und 0.0 <= alpha <= 1.0"',!1)),this.addMethod(new m("setBorderColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setBorderColor")||l.setBorderColor(s,a)},!1,!1,'Setzt die Randfarbe. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" oder "rgb(172, 22, 18)" und 0.0 <= alpha <= 1.0"',!1)),this.addMethod(new m("setBorderColor",new g([{identifier:"colorAsRGBAString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setBorderColor")||a.setBorderColor(s)},!1,!1,'Setzt die Randfarbe. Die Farbe ist entweder eine vordefinierte Farbe (Color.black, Color.red, ...) oder eine css-Farbe der Art "#ffa7b3" (ohne alpha), "#ffa7b380" (mit alpha), "rgb(172, 22, 18)" oder "rgba(123, 22,18, 0.3)"',!1)),this.addMethod(new m("setBorderWidth",new g([{identifier:"widthInPixel",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setBorderWidth")||a.setBorderWidth(s)},!1,!1,'Setzt die Linienbreite des Randes (Einheit: Pixel)"',!1)),this.setupAttributeIndicesRecursive()}rgbaToHex(e,t){let i=e==null?"---":e.toString(16);for(;i.length<6;)i="0"+i;let n=Math.round(t*255).toString(16);return n.length<2&&(n="0"+n),"#"+i+n}}class vi extends sa{constructor(t,i){super(t,i);y(this,"fillColor");y(this,"fillAlpha");y(this,"borderColor");y(this,"borderAlpha");y(this,"borderWidth");this.borderColor=Ci.defaultBorderColor,this.borderAlpha=Ci.defaultBorderAlpha,this.borderWidth=Ci.defaultBorderWidth,this.fillColor=Ci.defaultFillColor,this.fillAlpha=Ci.defaultFillAlpha}copyFrom(t){super.copyFrom(t),this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.borderColor=t.borderColor,this.borderAlpha=t.borderAlpha,this.borderWidth=t.borderWidth}setAlpha(t){this.fillAlpha=t,this.borderAlpha=t,this.render()}setBorderColor(t,i){if(typeof t=="string"){let n=Ot.parseColorToOpenGL(t);this.borderColor=n.color,this.borderAlpha=i??n.alpha}else this.borderColor=t%16777216,this.borderAlpha=i;this.render()}setFillColor(t,i){if(typeof t=="string"){let n=Ot.parseColorToOpenGL(t);this.fillColor=n.color,this.fillAlpha=i??n.alpha}else this.fillColor=t%16777216,i!=null&&(this.fillAlpha=i);this.render()}setBorderWidth(t){this.borderWidth=t,this.render()}getFarbeAsObject(t,i,n){if(t==null)return null;let s=(t&16711680)>>16,a=(t&65280)>>8,l=t&255,o=new he(n),u={red:s,green:a,blue:l,hex:Ot.intColorToHexRGB(t)};return o.intrinsicData=u,o}borderContainsPoint(t,i,n=-1){return n!=-1&&this.borderColor!=n||this.hitPolygonInitial==null||this.borderColor==null?!1:(this.hitPolygonDirty&&this.transformHitPolygon(),UC(this.hitPolygonTransformed,{x:t,y:i},this.borderWidth/2))}}class ZC extends ${constructor(e){super("Circle",e,"Kreis"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Circle",new g([]),null,t=>{let i=t[0].value,n=new hs(50,50,50,e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert einen neuen Kreis mit Mittelpunkt (50, 50) und Radius 50.",!0)),this.addMethod(new m("Circle",new g([{identifier:"mx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"my",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"r",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=new hs(n,s,a,e.main.getInterpreter(),i);i.intrinsicData.Actor=l},!1,!1,"Instanziert einen neuen Kreis. (mx, my) ist der Mittelpunt, r sein Radius.",!0)),this.addMethod(new m("setRadius",new g([{identifier:"radius",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setRadius")||s.setRadius(n)},!1,!1,'Setzt den Radius des Kreises."',!1)),this.addMethod(new m("getRadius",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getRadius"))return n.r*n.displayObject.scale.x},!1,!1,"Gibt den Radius zurück.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Circle-Objekts und git sie zurück.",!1))}}class hs extends vi{constructor(e,t,i,n,s){super(n,s),this.mx=e,this.my=t,this.r=i,this.centerXInitial=e,this.centerYInitial=t,this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new hs(this.mx,this.my,this.r,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}render(){this.hitPolygonInitial=[];let e=Math.PI/8;for(let i=0;i<16;i++){let n=e*i;this.hitPolygonInitial.push({x:this.mx+this.r*Math.cos(n),y:this.my+this.r*Math.sin(n)})}this.hitPolygonDirty=!0;let t=this.displayObject;this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&t.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),t.drawCircle(this.mx,this.my,this.r),t.closePath(),this.fillColor!=null&&t.endFill()}setRadius(e){this.r=e,this.render()}isOutsideView(){return super.isOutsideView()}containsPoint(e,t){if(!this.displayObject.getBounds().contains(e,t))return!1;let i=new xe(e,t);this.displayObject.transform.worldTransform.applyInverse(i,i);let s=i.x-this.mx,a=i.y-this.my;return s*s+a*a<=this.r*this.r}collidesWith(e){if(e instanceof hs){let t=new xe(this.centerXInitial,this.centerYInitial);this.displayObject.updateTransform(),this.displayObject.transform.worldTransform.apply(t,t);let i=this.r*this.displayObject.scale.x,n=new xe(e.centerXInitial,e.centerYInitial);e.displayObject.updateTransform(),e.displayObject.transform.worldTransform.apply(n,n);let s=e.r*e.displayObject.scale.x,a=t.x-n.x,l=t.y-n.y;return a*a+l*l<=(i+s)*(i+s)}else return super.collidesWith(e)}}class JC extends ${constructor(e){super("Sector",e,"Kreisbogen/Kreissektor"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Sector",new g([{identifier:"mx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"my",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"r",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"startAngle",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"endAngle",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new cf(n,s,a,l/180*Math.PI,o/180*Math.PI,!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=u},!1,!1,"Instanziert einen neuen Kreisbogen bzw. (falls die Füllfarbe nicht null ist) Kreissektor. (mx, my) ist der Mittelpunt, r sein Radius. Der Kreisbogen wird von startAngle bis endAngle (beides in Grad) gegen den Uhrzeigersinn gezogen.",!0)),this.addMethod(new m("drawRadii",new g([{identifier:"radiiZeichnen",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("drawRadii")||(s.drawRadii=n,s.render())},!1,!1,"Legt fest, ob beim Zeichnen des Umrisses auch die beiden Radii ( = Strecken vom Mittelpunkt zur Kreislinie) mitgezeichnet werden sollen.",!1)),this.addMethod(new m("setRadius",new g([{identifier:"radius",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setRadius")||s.setRadius(n)},!1,!1,'Setzt den Radius des Kreisbogens/Kreissektors."',!1)),this.addMethod(new m("setStartAngle",new g([{identifier:"startWinkelInGrad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setStartAngle")||(n<0&&(n+=Math.ceil(-n/360)*360),n>360&&(n-=Math.trunc(n/360)*360),s.startAngleRad=n/180*Math.PI,s.render())},!1,!1,'Setzt den Startwinkel des Kreisbogens/Kreissektors."',!1)),this.addMethod(new m("setEndAngle",new g([{identifier:"endWinkelInGrad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setEndAngle")||(n<0&&(n+=Math.ceil(-n/360)*360),n>360&&(n-=Math.trunc(n/360)*360),s.endAngleRad=n/180*Math.PI,s.render())},!1,!1,'Setzt den Endwinkel des Kreisbogens/Kreissektors."',!1)),this.addMethod(new m("getRadius",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getRadius"))return n.r*n.displayObject.scale.x},!1,!1,"Gibt den Radius zurück.",!1)),this.addMethod(new m("getStartAngle",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getStartAngle"))return n.startAngleRad/Math.PI*180},!1,!1,"Gibt den Startwinkel in Grad zurück.",!1)),this.addMethod(new m("getEndAngle",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getEndAngle"))return n.endAngleRad/Math.PI*180},!1,!1,"Gibt den Endwinkel in Grad zurück.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Sector-Objekts und git sie zurück.",!1))}}class cf extends vi{constructor(e,t,i,n,s,a,l,o){super(l,o),this.mx=e,this.my=t,this.r=i,this.startAngleRad=n,this.endAngleRad=s,this.drawRadii=a,this.centerXInitial=e,this.centerYInitial=t,this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new cf(this.mx,this.my,this.r,this.startAngleRad,this.endAngleRad,this.drawRadii,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}render(){this.hitPolygonInitial=[];let e=this.endAngleRad-this.startAngleRad;this.hitPolygonInitial.push({x:this.mx,y:this.my});for(let i=0;i<16;i++){let n=this.startAngleRad+e*i;this.hitPolygonInitial.push({x:this.mx+this.r*Math.cos(n),y:this.my+this.r*Math.sin(n)})}this.hitPolygonInitial.push({x:this.mx,y:this.my}),this.hitPolygonDirty=!0;let t=this.displayObject;this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&t.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),Math.abs(this.startAngleRad-this.endAngleRad)<1e-8?t.drawCircle(this.mx,this.my,this.r):(this.drawRadii&&t.moveTo(this.mx,this.my),t.arc(this.mx,this.my,this.r,-this.startAngleRad,-this.endAngleRad,!0),this.drawRadii&&t.lineTo(this.mx,this.my)),this.drawRadii&&t.closePath(),this.fillColor!=null&&t.endFill()}setRadius(e){this.r=e,this.render()}isOutsideView(){return super.isOutsideView()}containsPoint(e,t){if(!this.displayObject.getBounds().contains(e,t))return!1;let i=new xe(e,t);this.displayObject.transform.worldTransform.applyInverse(i,i);let s=i.x-this.mx,a=i.y-this.my,l=Math.atan2(-a,s);if(s*s+a*a<=this.r*this.r){let o=2*Math.PI,u=this.startAngleRad<0?o+this.startAngleRad:this.startAngleRad,h=this.endAngleRad<0?o+this.endAngleRad:this.endAngleRad,p=(l<0?o+l:l)>=u&&u<=h;return u<=h?p:!p}else return!1}}class QC extends ${constructor(e){super("Arc",e,"Kreisbogenumriss (wahlweise gefüllt)"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Arc",new g([{identifier:"mx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"my",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"innerRadius",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"outerRadius",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"startAngle",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"endAngle",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=new ff(n,s,a,l,o/180*Math.PI,u/180*Math.PI,!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=h},!1,!1,"Instanziert einen neuen Kreisbogen. (mx, my) ist der Mittelpunt, ri sein Innenradius, ra sein Außenradius. Der Kreisbogen wird von startAngle bis endAngle (beides in Grad) gegen den Uhrzeigersinn gezogen.",!0)),this.addMethod(new m("setInnerRadius",new g([{identifier:"innerRadius",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setRadius")||(s.ri=n,s.render())},!1,!1,'Setzt den inneren Radius des Kreisbogens"',!1)),this.addMethod(new m("setOuterRadius",new g([{identifier:"outerRadius",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setRadius")||(s.ra=n,s.render())},!1,!1,'Setzt den äußeren Radius des Kreisbogens"',!1)),this.addMethod(new m("setStartAngle",new g([{identifier:"startWinkelInGrad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setStartAngle")||(n<0&&(n+=Math.ceil(-n/360)*360),n>360&&(n-=Math.trunc(n/360)*360),s.startAngleRad=n/180*Math.PI,s.render())},!1,!1,'Setzt den Startwinkel des Kreisbogens/Kreissektors."',!1)),this.addMethod(new m("setEndAngle",new g([{identifier:"endWinkelInGrad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setEndAngle")||(n<0&&(n+=Math.ceil(-n/360)*360),n>360&&(n-=Math.trunc(n/360)*360),s.endAngleRad=n/180*Math.PI,s.render())},!1,!1,'Setzt den Endwinkel des Kreisbogens/Kreissektors."',!1)),this.addMethod(new m("getInnerRadius",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getRadius"))return n.ri*n.displayObject.scale.x},!1,!1,"Gibt den inneren Radius zurück.",!1)),this.addMethod(new m("getOuterRadius",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getOuterRadius"))return n.ra*n.displayObject.scale.x},!1,!1,"Gibt den äußeren Radius zurück.",!1)),this.addMethod(new m("getStartAngle",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getStartAngle"))return n.startAngleRad/Math.PI*180},!1,!1,"Gibt den Startwinkel in Grad zurück.",!1)),this.addMethod(new m("getEndAngle",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getEndAngle"))return n.endAngleRad/Math.PI*180},!1,!1,"Gibt den Endwinkel in Grad zurück.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Arc-Objekts und git sie zurück.",!1))}}class ff extends vi{constructor(e,t,i,n,s,a,l,o,u){super(o,u),this.mx=e,this.my=t,this.ri=i,this.ra=n,this.startAngleRad=s,this.endAngleRad=a,this.drawRadii=l,this.centerXInitial=e,this.centerYInitial=t,this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new ff(this.mx,this.my,this.ri,this.ra,this.startAngleRad,this.endAngleRad,this.drawRadii,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}render(){this.hitPolygonInitial=[];let e=this.endAngleRad-this.startAngleRad;for(let i=0;i<16;i++){let n=this.startAngleRad+e*i;this.hitPolygonInitial.push({x:this.mx+this.ra*Math.cos(n),y:this.my+this.ra*Math.sin(n)})}for(let i=0;i<16;i++){let n=this.endAngleRad-e*i;this.hitPolygonInitial.push({x:this.mx+this.ri*Math.cos(n),y:this.my+this.ri*Math.sin(n)})}this.hitPolygonDirty=!0;let t=this.displayObject;this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&t.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),this.startAngleRad===void 0&&(this.startAngleRad=0),this.endAngleRad===void 0&&(this.endAngleRad=Math.PI*2),Math.abs(this.endAngleRad-this.startAngleRad)>=Math.PI*2?t.drawCircle(this.mx,this.my,this.ra).beginHole().drawCircle(this.mx,this.my,this.ri).endHole():(t.moveTo(this.mx+this.ra*Math.cos(this.startAngleRad),this.my-this.ra*Math.sin(this.startAngleRad)),t.lineTo(this.mx+this.ri*Math.cos(this.startAngleRad),this.my-this.ri*Math.sin(this.startAngleRad)),t.arc(this.mx,this.my,this.ri,-this.startAngleRad,-this.endAngleRad,!0).arc(this.mx,this.my,this.ra,-this.endAngleRad,-this.startAngleRad,!1)),t.closePath(),this.fillColor!=null&&t.endFill()}isOutsideView(){return super.isOutsideView()}containsPoint(e,t){if(!this.displayObject.getBounds().contains(e,t))return!1;let i=new xe(e,t);this.displayObject.transform.worldTransform.applyInverse(i,i);let s=i.x-this.mx,a=i.y-this.my,l=Math.atan2(-a,s),o=s*s+a*a;if(o<=this.ra*this.ra&&o>=this.ri*this.ri){let u=2*Math.PI,h=this.startAngleRad<0?u+this.startAngleRad:this.startAngleRad,d=this.endAngleRad<0?u+this.endAngleRad:this.endAngleRad,v=(l<0?u+l:l)>=h&&h<=d;return h<=d?v:!v}else return!1}}class eA extends ${constructor(e){super("Color",e,"Farbe"),this.setBaseClass(e.typeStore.getType("Object"));for(let t in Ot.predefinedColors){let i=Ot.predefinedColors[t],n=new he(this),s=(i&16711680)>>16,a=(i&65280)>>8,l=i&255,o={red:s,green:a,blue:l,hex:Ot.intColorToHexRGB(i)};n.intrinsicData=o;let u=new ce(t,this,h=>{h.value=n},!0,ee.public,!0,"Die Farbe "+t+" ("+Ot.intColorToHexRGB(i)+") oder "+Ot.intColorToRGB(i));u.color=Ot.intColorToHexRGB(i),this.addAttribute(u)}this.setupAttributeIndicesRecursive(),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("Color",new g([{identifier:"red",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"green",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"blue",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=Math.trunc(t[1].value),s=Math.trunc(t[2].value),a=Math.trunc(t[3].value),l={red:n,green:s,blue:a,hex:"rgb("+n+", "+s+", "+a+")"};i.intrinsicData=l},!1,!1,"Instanziert eine neue Farbe. Red, green und blue sind die Farbanteile, jeweils als integer-Zahlen im Bereich von 0 bis 255.",!0)),this.addMethod(new m("randomColor",new g([]),C,t=>(t[0].value,Math.floor(Math.random()*16777215)),!1,!0,"Gibt eine zufällige Farbe (ohne Transparenz) zurück.",!1)),this.addMethod(new m("randomColor",new g([{identifier:"minimumRGBValue",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{t[0].value;let i=t[1].value;i<0&&(i=0),i>255&&(i=255);let n=Math.floor(Math.random()*(256-i))+i,s=Math.floor(Math.random()*(256-i))+i,a=Math.floor(Math.random()*(256-i))+i;return 65536*n+256*s+a},!1,!0,"Gibt eine zufällige Farbe (ohne Transparenz) zurück. Min ist der Mindestwert für den Rot-, Grün- und Blauanteil, wobei jeder der Anteile und daher auch min zwischen 0 und 255 (jeweils einschließlich) liegen muss.",!1)),this.addMethod(new m("randomColor",new g([{identifier:"minimumRGBValue",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"maximumRGBValue",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{t[0].value;let i=t[1].value,n=t[1].value;if(i<0&&(i=0),i>255&&(i=255),n<0&&(n=0),n>255&&(n=255),n<i){let o=n;n=i,i=o}let s=Math.floor(Math.random()*(n-i+1))+i,a=Math.floor(Math.random()*(n-i+1))+i,l=Math.floor(Math.random()*(n-i+1))+i;return 65536*s+256*a+l},!1,!0,"Gibt eine zufällige Farbe (ohne Transparenz) zurück. Min ist der Mindestwert für den Rot-, Grün- und Blauanteil, max der Höchstwert, wobei jeder der Anteile und daher auch min zwischen 0 und 255 (jeweils einschließlich) liegen muss.",!1)),this.addMethod(new m("toString",new g([]),F,t=>t[0].value.intrinsicData.hex,!1,!1,"Verwandelt die Farbe in einen String.",!1)),this.addMethod(new m("toInt",new g([]),C,t=>{let n=t[0].value.intrinsicData;return 65536*n.red+256*n.green+n.blue},!1,!1,"Verwandelt die Farbe in einen int-Wert um, genauer: gibt 0x10000 * red + 0x100 * green + blue zurück.",!1)),this.addMethod(new m("equals",new g([{identifier:"otherColor",type:this,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData,a=n.intrinsicData;return s.red==a.red&&s.green==a.green&&s.blue==a.blue},!1,!1,"Vergleicht zwei Farben",!1)),this.addMethod(new m("getRed",new g([]),C,t=>t[0].value.intrinsicData.red,!1,!1,"Gibt den Rotanteil der Farbe zurück (0 - 255).",!1)),this.addMethod(new m("getGreen",new g([]),C,t=>t[0].value.intrinsicData.green,!1,!1,"Gibt den Grünanteil der Farbe zurück (0 - 255).",!1)),this.addMethod(new m("getBlue",new g([]),C,t=>t[0].value.intrinsicData.blue,!1,!1,"Gibt den Blauanteil der Farbe zurück (0 - 255).",!1)),this.addMethod(new m("fromRGB",new g([{identifier:"red",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"green",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"blue",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{t[0].value;let i=t[1].value,n=t[2].value,s=t[3].value;return i=Math.min(i,255),i=Math.max(0,i),n=Math.min(n,255),n=Math.max(0,n),s=Math.min(s,255),s=Math.max(0,s),i*65536+n*256+s},!1,!0,"Berechnet aus Rot-, Grün- und Blauwert (alle zwischen 0 und 255) die Farbe.",!1)),this.addMethod(new m("fromRGBA",new g([{identifier:"red",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"green",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"blue",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{t[0].value;let i=t[1].value,n=t[2].value,s=t[3].value,a=t[4].value;i=Math.min(i,255),i=Math.max(0,i),n=Math.min(n,255),n=Math.max(0,n),s=Math.min(s,255),s=Math.max(0,s),a=Math.min(a,1),a=Math.max(0,a);let l=(i*16777216+n*65536+s*256+Math.floor(a*255)).toString(16);for(;l.length<8;)l="0"+l;return"#"+l},!1,!0,"Berechnet aus Rot-, Grün- und Blauwert (alle zwischen 0 und 255) sowie Alpha-Wert (zwischen 0 und 1) die Farbe.",!1)),this.addMethod(new m("fromHSLA",new g([{identifier:"hue",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"saturation",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"luminance",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"alpha",type:A,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{t[0].value;let i=t[1].value,n=t[2].value,s=t[3].value,a=t[4].value;i=Math.min(i,360),i=Math.max(0,i),n=Math.min(n,100),n=Math.max(0,n),s=Math.min(s,100),s=Math.max(0,s),a=Math.min(a,1),a=Math.max(0,a);let l=this.hslToRgb(i,n,s),o=(l.r*16777216+l.g*65536+l.b*256+Math.floor(a*255)).toString(16);for(;o.length<8;)o="0"+o;return"#"+o},!1,!0,"Berechnet Hue (0 - 360), Saturation (0 - 100) und Luminance (0 - 100) sowie Alpha-Wert (zwischen 0 und 1) die Farbe.",!1)),this.addMethod(new m("fromHSL",new g([{identifier:"hue",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"saturation",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"luminance",type:A,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>{t[0].value;let i=t[1].value,n=t[2].value,s=t[3].value;i=Math.min(i,360),i=Math.max(0,i),n=Math.min(n,100),n=Math.max(0,n),s=Math.min(s,100),s=Math.max(0,s);let a=this.hslToRgb(i,n,s);return a.r*65536+a.g*256+a.b},!1,!0,"Berechnet Hue (0 - 360), Saturation (0 - 100) und Luminance (0 - 100)die Farbe.",!1))}hslToRgb(e,t,i){t/=100,i/=100;let n=(1-Math.abs(2*i-1))*t,s=n*(1-Math.abs(e/60%2-1)),a=i-n/2,l=0,o=0,u=0;return 0<=e&&e<60?(l=n,o=s,u=0):60<=e&&e<120?(l=s,o=n,u=0):120<=e&&e<180?(l=0,o=n,u=s):180<=e&&e<240?(l=0,o=s,u=n):240<=e&&e<300?(l=s,o=0,u=n):300<=e&&e<360&&(l=n,o=0,u=s),l=Math.round((l+a)*255),o=Math.round((o+a)*255),u=Math.round((u+a)*255),{r:l,g:o,b:u}}}class tA extends ${constructor(e){super("Ellipse",e,"Ellipse"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Ellipse",new g([]),null,t=>{let i=t[0].value,n=new hl(100,50,50,100,e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert eine neue Ellipse. (100, 50) ist der Mittelpunt, 100 und 50 sind ihre Radien.",!0)),this.addMethod(new m("Ellipse",new g([{identifier:"mx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"my",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"rx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"ry",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=new hl(n,s,a,l,e.main.getInterpreter(),i);i.intrinsicData.Actor=o},!1,!1,"Instanziert eine neue Ellipse. (mx, my) ist der Mittelpunt, rx und ry sind ihre Radien.",!0)),this.addMethod(new m("setRadiusX",new g([{identifier:"rx",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setRadiusX(n)},!1,!1,'Setzt den x-Radius der Ellipse"',!1)),this.addMethod(new m("setRadiusY",new g([{identifier:"ry",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setRadiusY(n)},!1,!1,'Setzt den y-Radius der Ellipse"',!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Ellipse-Objekts und git sie zurück.",!1))}}class hl extends vi{constructor(e,t,i,n,s,a){super(s,a),this.mx=e,this.my=t,this.rx=i,this.ry=n,this.centerXInitial=e,this.centerYInitial=t,this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new hl(this.mx,this.my,this.rx,this.ry,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}render(){this.hitPolygonInitial=[];let e=Math.PI/8;for(let i=0;i<16;i++){let n=e*i;this.hitPolygonInitial.push({x:this.mx+this.rx*Math.cos(n),y:this.my+this.ry*Math.sin(n)})}let t=this.displayObject;this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&t.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),t.drawEllipse(this.mx,this.my,this.rx,this.ry),t.closePath(),this.fillColor!=null&&t.endFill()}setRadiusX(e){this.rx=e,this.render()}setRadiusY(e){this.rx=e,this.render()}isOutsideView(){return super.isOutsideView()}containsPoint(e,t){if(!this.displayObject.getBounds().contains(e,t))return!1;let i=new xe(e,t);this.displayObject.transform.worldTransform.applyInverse(i,i);let s=i.x-this.mx,a=i.y-this.my;return s*s/(this.rx*this.rx)+a*a/(this.ry*this.ry)<=1}}class iA extends ${constructor(e){super("CollisionPair",e,"Speichert die Referenzen auf zwei Figuren, die gerade kollidiert sind. Diese Klasse von den Kollisionsmethden der Klasse Group benutzt."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("Shape");this.addAttribute(new ce("shapeA",t,i=>{let n=i.object;i.value=n.intrinsicData.ShapeA},!1,ee.public,!0,"Erstes an der Kollision beteiligtes Shape")),this.addAttribute(new ce("shapeB",t,i=>{let n=i.object;i.value=n.intrinsicData.ShapeB},!1,ee.public,!0,"Zweites an der Kollision beteiligtes Shape")),this.setupAttributeIndicesRecursive()}}class nA extends ${constructor(e){super("Group",e,"Klasse zum Gruppieren grafischer Elemente. Die gruppierten Elemente können miteinander verschoben, gedreht, gestreckt sowie ein- und ausgeblendet werden. Zudem besitzt die Klasse Methoden zur schnellen Erkennung von Kollision mit Elementen außerhalb der Gruppe."),this.setBaseClass(e.typeStore.getType("Shape"));let t=e.typeStore.getType("CollisionPair"),i=new ze(t),n=e.typeStore.getType("Shape");this.addMethod(new m("Group",new g([]),null,a=>{let l=a[0].value,o=new kr(e.main.getInterpreter(),l);l.intrinsicData.Actor=o},!1,!1,"Instanziert eine neue Gruppe. Ihr können mit der Methode add Elemente hinzugefügt werden, die dann mit der Gruppe verschoben, gedreht, ... werden.",!0)),this.addMethod(new m("Group",new g([{identifier:"shapes",type:new ze(e.typeStore.getType("Shape")),declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!0}]),null,a=>{let l=a[0].value,o=a[1].value,u=new kr(e.main.getInterpreter(),l);l.intrinsicData.Actor=u;for(let h of o)u.add(h.value)},!1,!1,"Instanziert eine neue Gruppe und fügt die übergebenen Grafikobjekte der Gruppe hinzu. Der Gruppe können mit der Methode add weitere Grafikobjekte hinzugefügt werden, die dann mit der Gruppe verschoben, gedreht, ... werden.",!0)),this.addMethod(new m("add",new g([{identifier:"shapes",type:new ze(n),declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!0}]),null,a=>{let l=a[0].value,o=a[1].value,u=l.intrinsicData.Actor;if(!u.testdestroyed("add"))for(let h of o)u.add(h.value)},!1,!1,"Fügt die Grafikobjekte der Gruppe hinzu.",!1)),this.addMethod(new m("get",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),n,a=>{let l=a[0].value,o=a[1].value,u=l.intrinsicData.Actor;if(!u.testdestroyed("get"))return u.getElement(o)},!1,!1,"Gibt das Grafikelement der Gruppe mit dem entsprechenden Index zurück. VORSICHT: Das erste Element hat Index 0!",!1)),this.addMethod(new m("remove",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,a=>{let l=a[0].value,o=a[1].value;l.intrinsicData.Actor.removeElementAt(o)},!1,!1,"Entfernt das Grafikelement aus der Gruppe mit dem entsprechenden Index, zerstört es jedoch nicht. VORSICHT: Das erste Element hat Index 0!",!1)),this.addMethod(new m("remove",new g([{identifier:"shape",type:n,declaration:null,usagePositions:null,isFinal:!0}]),null,a=>{let l=a[0].value,o=a[1].value,u=l.intrinsicData.Actor;u.testdestroyed("remove")||(u.remove(o),u.worldHelper.shapes.push(o.intrinsicData.Actor))},!1,!1,"Entfernt das übergebene Grafikelement aus der Gruppe, zerstört es jedoch nicht.",!1));let s=new ze(n);this.addMethod(new m("getCollidingShapes",new g([{identifier:"shape",type:e.typeStore.getType("Shape"),declaration:null,usagePositions:null,isFinal:!0}]),s,a=>{let l=a[0].value,o=a[1].value,u=l.intrinsicData.Actor;if(u.testdestroyed("getCollidingShapes")||o==null)return[];let h=u.getCollidingObjects(o),d=[];for(let p of h)d.push({type:n,value:p});return d},!1,!1,"Gibt die Objekte der Gruppe zurück, die mit dem übergebenen Shape kollidieren.",!1)),this.addMethod(new m("indexOf",new g([{identifier:"shape",type:e.typeStore.getType("Shape"),declaration:null,usagePositions:null,isFinal:!0}]),C,a=>{let l=a[0].value,o=a[1].value,u=l.intrinsicData.Actor;return u.testdestroyed("indexOf")||o==null?[]:u.indexOf(o)},!1,!1,"Gibt den Index des übergebenen Elements zurück. 0 bedeutet: erstes Element, -1 bedeutet: Das Element ist nicht in der Group enthalten.",!1)),this.addMethod(new m("getCollisionPairs",new g([{identifier:"group",type:this,declaration:null,usagePositions:null,isFinal:!0},{identifier:"maxOneCollisionPerShape",type:P,declaration:null,usagePositions:null,isFinal:!0}]),i,a=>{let l=a[0].value,o=a[1].value,u=a[2].value,h=l.intrinsicData.Actor,d=o.intrinsicData.Actor;if(!h.testdestroyed("getCollidingShapes"))return h.getCollidingObjects2(d,t,u)},!1,!1,"Überprüft, welche Objekte der Gruppe mit welchen der anderen kollidieren. Gibt für jede Kollision ein Collisionpair-Objekt zurück, das die beiden kollidierenden Objekte enthält. Falls maxOneCollisionPerShape == true ist jedes Objekt dabei aber nur in max. einem Collisionpair-Objekt enthalten.",!1)),this.addMethod(new m("size",new g([]),C,a=>{let o=a[0].value.intrinsicData.Actor;if(!o.testdestroyed("size"))return o.shapes.length},!1,!1,"Gibt zurück, wie viele Elemente in der Gruppe enthalten sind.",!1)),this.addMethod(new m("empty",new g([]),U,a=>{let o=a[0].value.intrinsicData.Actor;o.testdestroyed("empty")||o.removeAllChidren()},!1,!1,"Entfernt alle Elemente aus der Gruppe, löscht die Elemente aber nicht.",!1)),this.addMethod(new m("destroyAllChildren",new g([]),U,a=>{let o=a[0].value.intrinsicData.Actor;o.testdestroyed("destroyAllChildren")||o.destroyChildren()},!1,!1,"Löscht alle Elemente der Gruppe, nicht aber die Gruppe selbst.",!1)),n.addMethod(new m("getCollidingShapes",new g([{identifier:"group",type:this,declaration:null,usagePositions:null,isFinal:!0}]),s,a=>{let l=a[0].value,u=a[1].value.intrinsicData.Actor,h=l.intrinsicData.Actor;if(!h.testdestroyed("getCollidingShapes"))return h.getCollidingShapes(u,n)},!1,!1,"Gibt alle Shapes der Gruppe group zurück, die mit dem Shape kollidieren.",!1)),this.addMethod(new m("copy",new g([]),this,a=>{let l=a[0].value,o=l.intrinsicData.Actor;if(!o.testdestroyed("copy"))return o.getCopy(l.class)},!1,!1,"Erstellt eine Kopie des Group-Objekts (und aller seiner enthaltenen Grafikobjekte!) und git sie zurück.",!1)),this.addMethod(new m("renderAsStaticBitmap",new g([{identifier:"renderAsStaticBitmap",type:P,declaration:null,usagePositions:null,isFinal:!0}]),this,a=>{let o=a[0].value.intrinsicData.Actor,u=a[1].value;o.testdestroyed("renderAsStaticBitmap")||o.cacheAsBitmap(u)},!1,!1,"Zeichnet alle Objekte dieser Group in ein Bild und verwendet fortan nur noch dieses Bild, ohne die Kindelemente der Group erneut zu zeichnen. Mit dieser Methode können komplexe Bilder (z.B. ein Sternenhimmel) aufgebaut und dann statisch gemacht werden. Nach dem Aufbau brauchen sie daher kaum mehr Rechenzeit.",!1)),n.addMethod(new m("getParentGroup",new g([]),this,a=>{let o=a[0].value.intrinsicData.Actor;if(!o.testdestroyed("getParentGroup"))return o.getParentGroup()},!1,!1,"Gibt die Group zurück, in der sich das Grafikobjekt befindet, bzw. null, falls es in keiner Group ist.",!1))}}class kr extends sa{constructor(t,i){super(t,i);y(this,"shapes",[]);this.displayObject=new Rt,this.worldHelper.stage.addChild(this.displayObject),this.addToDefaultGroupAndSetDefaultVisibility()}indexOf(t){for(let i=0;i<this.shapes.length;i++)if(t==this.shapes[i])return i;return-1}setChildIndex(t,i){this.displayObject.setChildIndex(t.displayObject,i);let s=this.shapes.indexOf(t.runtimeObject);this.shapes.splice(s,1),this.shapes.splice(i,0,t.runtimeObject)}cacheAsBitmap(t){let i=this.displayObject;t?setTimeout(()=>{i.cacheAsBitmap=!0},300):i.cacheAsBitmap=t}removeElementAt(t){if(t<0||t>=this.shapes.length){this.worldHelper.interpreter.throwException("In der Gruppe gibt es kein Element mit Index "+t+".");return}let i=this.shapes[t];this.remove(i)}getElement(t){if(t<0||t>=this.shapes.length){this.worldHelper.interpreter.throwException("In der Gruppe gibt es kein Element mit Index "+t+".");return}return this.shapes[t]}getCopy(t){let i=new he(t),n=new kr(this.worldHelper.interpreter,i);i.intrinsicData.Actor=n;for(let s of this.shapes){let l=s.intrinsicData.Actor.getCopy(s.class);l.intrinsicData.Actor,n.add(l)}return n.copyFrom(this),n.render(),i}setTimerPaused(t){this.timerPaused=t;for(let i of this.shapes){let n=i.intrinsicData.Actor;n.timerPaused=t}}collidesWithAnyShape(t){for(let i of this.worldHelper.shapes)if(this!=i&&!(i.fillColor&&t!=null&&i.fillColor!=t)){if(i.shapes||i.turtle){if(i.collidesWith(this))return!0;continue}if(this.collidesWith(i))return!0}return!1}transformHitPolygon(){for(let t of this.shapes)t.intrinsicData.Actor.transformHitPolygon();this.hitPolygonDirty=!1}add(t){if(t==null)return;let i=t.intrinsicData.Actor;if(i.isDestroyed){this.worldHelper.interpreter.throwException("Ein schon zerstörtes Objekt kann keiner Gruppe hinzugefügt werden.");return}if(this.hasCircularReference(t))return;if(this.shapes.push(t),i.belongsToGroup!=null)i.belongsToGroup.remove(t);else{let h=this.worldHelper.shapes.indexOf(i);h>=0&&this.worldHelper.shapes.splice(h,1)}i.belongsToGroup=this,this.displayObject.parent.updateTransform();let n=new Ye().copyFrom(this.displayObject.transform.worldTransform);n.invert(),i.displayObject.localTransform.prepend(n.prepend(this.worldHelper.stage.localTransform)),i.displayObject.transform.onChange(),this.displayObject.addChild(i.displayObject),i.displayObject.updateTransform();let s=0,a=0;for(let h of this.shapes){let d=h.intrinsicData.Actor;s+=d.getCenterX(),a+=d.getCenterY()}let l=s/this.shapes.length,o=a/this.shapes.length;this.displayObject.updateTransform();let u=this.displayObject.worldTransform.applyInverse(new xe(l,o));this.centerXInitial=u.x,this.centerYInitial=u.y}removeAllChidren(){let t=0;for(let i of this.shapes)this.deregister(i,t++);this.shapes=[]}remove(t){let i=this.shapes.indexOf(t);i>=0&&(this.shapes.splice(i,1),this.deregister(t,i))}deregister(t,i){let n=t.intrinsicData.Actor,s=new Ye().copyFrom(n.displayObject.transform.worldTransform);this.displayObject.removeChild(n.displayObject);let a=new Ye().copyFrom(this.worldHelper.stage.localTransform);a.invert(),n.displayObject.localTransform.identity(),n.displayObject.localTransform.append(s.prepend(a)),n.displayObject.transform.onChange(),this.worldHelper.stage.addChild(n.displayObject),n.displayObject.updateTransform(),n.belongsToGroup=null}render(){}destroy(){this.destroyChildren(),super.destroy()}destroyChildren(){for(let t of this.shapes.slice(0))t.intrinsicData.Actor.destroy();this.shapes=[]}hasOverlappingBoundingBoxWith(t){this.displayObject.updateTransform(),t.displayObject.updateTransform();let i=this.displayObject.getBounds(),n=t.displayObject.getBounds();return!(i.left>n.right||n.left>i.right||i.top>n.bottom||n.top>i.bottom)}collidesWith(t){if(!this.hasOverlappingBoundingBoxWith(t))return!1;for(let i of this.shapes)if(i.intrinsicData.Actor.collidesWith(t))return!0;return!1}setHitPolygonDirty(t){for(let i of this.shapes)i.intrinsicData.Actor.setHitPolygonDirty(t)}containsPoint(t,i){this.displayObject.updateTransform();let n=this.displayObject.getBounds();if(t<n.left||t>n.left+n.width||i<n.top||i>n.top+n.height)return!1;for(let s of this.shapes)if(s.intrinsicData.Actor.containsPoint(t,i))return!0;return!1}getCollidingObjects(t){let i=[],n=t.intrinsicData.Actor;for(let s of this.shapes)s.intrinsicData.Actor.collidesWith(n)&&i.push(s);return i}getCollidingObjects2(t,i,n){let s=[],a=new Map;for(let l of this.shapes){let o=l.intrinsicData.Actor;for(let u of t.shapes){let h=u.intrinsicData.Actor;if(o.collidesWith(h)){if(!n||a.get(h)==null){a.set(h,!0);let d=new he(i);d.intrinsicData.ShapeA=o.runtimeObject,d.intrinsicData.ShapeB=h.runtimeObject,s.push({type:i,value:d})}if(n)break}}}return s}hasCircularReference(t){let i=t.intrinsicData.Actor;if(i instanceof kr){if(i==this)return this.worldHelper.interpreter.throwException("Eine Group darf sich nicht selbst enthalten!"),!0;for(let n of i.shapes)if(this.hasCircularReference(n))return!0}return!1}tint(t){for(let i of this.shapes)i.intrinsicData.Actor.tint(t)}borderContainsPoint(t,i,n=-1){for(let s of this.shapes)if(s.intrinsicData.Actor.borderContainsPoint(t,i,n))return!0;return!1}}class rA extends ${constructor(e){super("Key",e,"Aufzählung von Sondertasten zur Benutzung in den Methoden Actor.onKeyUp, Actor.onKeyTyped und Actor.onKeyDown"),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("ArrowUp",F,t=>{t.value="ArrowUp"},!0,ee.public,!0,"")),this.addAttribute(new ce("ArrowDown",F,t=>{t.value="ArrowDown"},!0,ee.public,!0,"")),this.addAttribute(new ce("ArrowLeft",F,t=>{t.value="ArrowLeft"},!0,ee.public,!0,"")),this.addAttribute(new ce("ArrowRight",F,t=>{t.value="ArrowRight"},!0,ee.public,!0,"")),this.addAttribute(new ce("Enter",F,t=>{t.value="Enter"},!0,ee.public,!0,"")),this.addAttribute(new ce("Space",F,t=>{t.value=" "},!0,ee.public,!0,"")),this.addAttribute(new ce("Shift",F,t=>{t.value="Shift"},!0,ee.public,!0,"")),this.addAttribute(new ce("Alt",F,t=>{t.value="Alt"},!0,ee.public,!0,"")),this.addAttribute(new ce("Strg",F,t=>{t.value="Control"},!0,ee.public,!0,"")),this.addAttribute(new ce("PageUp",F,t=>{t.value="PageUp"},!0,ee.public,!0,"")),this.addAttribute(new ce("PageDown",F,t=>{t.value="PageDown"},!0,ee.public,!0,"")),this.addAttribute(new ce("Backspace",F,t=>{t.value="Backspace"},!0,ee.public,!0,"")),this.addAttribute(new ce("Escape",F,t=>{t.value="Escape"},!0,ee.public,!0,"")),this.addAttribute(new ce("Entf",F,t=>{t.value="Delete"},!0,ee.public,!0,"")),this.addAttribute(new ce("Einf",F,t=>{t.value="Insert"},!0,ee.public,!0,"")),this.addAttribute(new ce("Ende",F,t=>{t.value="End"},!0,ee.public,!0,"")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}}class sA extends ${constructor(e){super("Polygon",e,"Wahlweise geschlossenes Polygon (mit Füllung und Rand) oder offener Streckenzug"),this.setBaseClass(e.typeStore.getType("FilledShape"));let t=e.typeStore.getType("Shape");this.addMethod(new m("Polygon",new g([]),null,i=>{let n=i[0].value,s=[];for(let l=0;l<6;l++){let o=Math.PI/3*l,u=100+50*Math.cos(o),h=100-50*Math.sin(o);s.push(u,h)}let a=new Ai(s,!0,e.main.getInterpreter(),n);n.intrinsicData.Actor=a},!1,!1,`Instanziert ein neues Polygon. Der Standardkonstruktor ohne Parameter instanziert ein regelmäßiges Sechseck. 
Tipp: Es gibt auch Konstruktoren, denen man ein Array von Koordinaten bzw. einzelne Koordinaten übergeben kann!`,!0)),this.addMethod(new m("Polygon",new g([{identifier:"closeAndFill",type:P,declaration:null,usagePositions:null,isFinal:!0},{identifier:"points",type:new ze(A),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=[];a.forEach(u=>l.push(u.value));let o=new Ai(l,s,e.main.getInterpreter(),n);n.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues Polygon. Die Punkte werden als Array von double-Werten der Form {x1, y1, x2, y2, ...} übergeben.",!0)),this.addMethod(new m("Polygon",new g([{identifier:"closeAndFill",type:P,declaration:null,usagePositions:null,isFinal:!0},{identifier:"points",type:new ze(A),declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=[];a.forEach(u=>l.push(u.value));let o=new Ai(l,s,e.main.getInterpreter(),n);n.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues Polygon. Die Punkte werden als double-Werte der Form x1, y1, x2, y2, ... übergeben.",!0)),this.addMethod(new m("Polygon",new g([{identifier:"closeAndFill",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=[],l=new Ai(a,s,e.main.getInterpreter(),n);n.intrinsicData.Actor=l},!1,!1,"Instanziert ein neues Polygon ohne Punkte.",!0)),this.addMethod(new m("Polygon",new g([{identifier:"shape",type:t,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value;if(s==null){e.main.getInterpreter().throwException("Die übergebene Figur ist null.");return}let a=s.intrinsicData.Actor;a.displayObject.getBounds();let l=[];l=this.extractPoints(a,l);let o=[];for(let h of l)o.push(h.x),o.push(h.y);o.length>0&&(o=o.concat(o.slice(0,2)));let u=new Ai(o,!1,e.main.getInterpreter(),n,!0);n.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues Polygon. Seine Punkte sind die Punkte des Hitpolygons der übergebenen Figur.",!0)),this.addMethod(new m("addPoint",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("addPoint")||l.addPoint(s,a)},!1,!1,'Fügt dem Polygon einen Punkt hinzu."',!1)),this.addMethod(new m("setPoints",new g([{identifier:"points",type:new ze(A),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("addPoints")||a.setPoints(s.map(l=>l.value))},!1,!1,'Löscht alle Punkte des Polygons und setzt komplett neue. Diese werden in einem double[] übergeben, das abwechselnd die x- und y-Koordinaten enthält."',!1)),this.addMethod(new m("addPoints",new g([{identifier:"points",type:new ze(A),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;if(!a.testdestroyed("addPoints"))for(let l=0;l<s.length-1;l+=2)a.addPoint(s[l].value,s[l+1].value,l>=s.length-2)},!1,!1,'Fügt dem Polygon mehrere Punkte hinzu. Diese werden in einem double[] übergeben, das abwechselnd die x- und y-Koordinaten enthält."',!1)),this.addMethod(new m("insertPoint",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=n.intrinsicData.Actor;o.testdestroyed("insertPoint")||o.insertPoint(s,a,l)},!1,!1,'Fügt dem Polygon einen Punkt als "index-ter" Punkt hinzu. index == 0 => ganz am Anfang; index == Anzahl der bisherigen Punkte => ganz am Ende;"',!1)),this.addMethod(new m("movePointTo",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=n.intrinsicData.Actor;o.testdestroyed("insertPoint")||o.movePointTo(s,a,l)},!1,!1,"schiebt den index-ten Punkt nach (x, y). index == 0 => erster Punkt, index == 1 => zweiter Punkt usw.",!1)),this.addMethod(new m("close",new g([]),null,i=>{let s=i[0].value.intrinsicData.Actor;s.testdestroyed("close")||(s.isClosed=!0,s.render())},!1,!1,"Schließt das Polygon. Diese Methode hat bei gefüllten Polygonen keinen Effekt.",!1)),this.addMethod(new m("open",new g([]),null,i=>{let s=i[0].value.intrinsicData.Actor;s.testdestroyed("open")||(s.isClosed=!1,s.render())},!1,!1,"Öffnet das Polygon. Diese Methode hat bei gefüllten Polygonen keinen Effekt.",!1)),this.addMethod(new m("copy",new g([]),this,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(!s.testdestroyed("copy"))return s.getCopy(n.class)},!1,!1,"Erstellt eine Kopie des Polygon-Objekts und git sie zurück.",!1))}extractPoints(e,t){if(e instanceof kr){let i=[];for(let n of e.shapes)i=this.extractPoints(n.intrinsicData.Actor,i);return t.concat(i)}else return e.hitPolygonDirty&&e.transformHitPolygon(),t.concat(e.hitPolygonTransformed.map(function(i){return{x:i.x,y:i.y}}))}}class Ai extends vi{constructor(t,i,n,s,a=!1){super(n,s);y(this,"isClosed",!1);this.closeAndFill=i,this.isClosed=a;let l=0,o=0;this.hitPolygonInitial=[];for(let u=0;u<t.length;){let h=t[u++],d=t[u++];l+=h,o+=d,this.hitPolygonInitial.push({x:h,y:d})}t.length>1&&(this.centerXInitial=l/this.hitPolygonInitial.length,this.centerYInitial=o/this.hitPolygonInitial.length),i||(this.borderColor=255),this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(t){let i=new he(t),n=new Ai([],this.closeAndFill,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}render(){let t=this.displayObject;if(this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&this.closeAndFill&&t.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),this.hitPolygonInitial.length>0){t.moveTo(this.hitPolygonInitial[0].x,this.hitPolygonInitial[0].y);for(let i=1;i<this.hitPolygonInitial.length;i++)t.lineTo(this.hitPolygonInitial[i].x,this.hitPolygonInitial[i].y)}(this.closeAndFill||this.isClosed)&&t.closePath(),this.fillColor!=null&&this.closeAndFill&&t.endFill()}addPoint(t,i,n=!0){let s=new xe(t,i);this.displayObject.transform.worldTransform.applyInverse(s,s),this.hitPolygonInitial.push({x:s.x,y:s.y}),this.hitPolygonDirty=!0,n&&this.render()}insertPoint(t,i,n){n<0&&(n=0),n>this.hitPolygonInitial.length&&(n=this.hitPolygonInitial.length);let s=new xe(t,i);this.displayObject.transform.worldTransform.applyInverse(s,s),this.hitPolygonInitial.splice(n,0,{x:s.x,y:s.y}),this.hitPolygonDirty=!0,this.render()}movePointTo(t,i,n){if(n<0&&(n=0),n>this.hitPolygonInitial.length&&(n=this.hitPolygonInitial.length),this.hitPolygonInitial.length==0)return;let s=new xe(t,i);this.displayObject.transform.worldTransform.applyInverse(s,s),this.hitPolygonInitial[n].x=s.x,this.hitPolygonInitial[n].y=s.y,this.hitPolygonDirty=!0,this.render()}setPoint(t,i,n){(n==0||n==1)&&(this.hitPolygonInitial[n]={x:t,y:i},this.hitPolygonDirty=!0,this.render())}setPoints(t){this.hitPolygonInitial=[];for(let i=0;i<t.length-1;i+=2)this.hitPolygonInitial.push({x:t[i],y:t[i+1]});this.hitPolygonDirty=!0,this.render()}setAllPointsUntransformed(t){this.hitPolygonInitial=[];for(let i=0;i<t.length;i+=2)this.hitPolygonInitial.push({x:t[i],y:t[i+1]});this.hitPolygonDirty=!0,this.render()}containsPoint(t,i){return this.displayObject.getBounds().contains(t,i)?this.hitPolygonInitial==null?!0:(this.hitPolygonDirty&&this.transformHitPolygon(),this.closeAndFill?_r(this.hitPolygonTransformed,{x:t,y:i}):pb(this.hitPolygonTransformed,{x:t,y:i})):!1}}class aA extends ${constructor(e){super("Rectangle",e,"Rechteck"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Rectangle",new g([]),null,t=>{let i=t[0].value,n=new ta(0,0,100,100,e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert ein neues, achsenparalleles Rechteck-Objekt.",!0)),this.addMethod(new m("Rectangle",new g([{identifier:"left",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"top",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=new ta(n,s,a,l,e.main.getInterpreter(),i);i.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues, achsenparalleles Rechteck-Objekt. (left, top) sind die Koordinaten der linken oberen Ecke.",!0)),this.addMethod(new m("setWidth",new g([{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let n=t[0].value.intrinsicData.Actor,s=t[1].value;n.testdestroyed("setWidth")||(n.width=s/n.displayObject.scale.x,n.centerXInitial=n.left+n.width/2,n.render())},!1,!1,"Setzt die Breite des Rechtecks.",!1)),this.addMethod(new m("setHeight",new g([{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let n=t[0].value.intrinsicData.Actor,s=t[1].value;n.testdestroyed("setHeight")||(n.height=s/n.displayObject.scale.y,n.centerYInitial=n.top+n.height/2,n.render())},!1,!1,"Setzt die Höhe des Rechtecks.",!1)),this.addMethod(new m("getWidth",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getWidth"))return n.width*n.scaleFactor},!1,!1,"Gibt die Breite zurück.",!1)),this.addMethod(new m("getHeight",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getHeight"))return n.height*n.scaleFactor},!1,!1,"Gibt die Höhe zurück.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Rectangle-Objekts und git sie zurück.",!1)),this.addMethod(new m("moveTo",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let n=t[0].value.intrinsicData.Actor,s=t[1].value,a=t[2].value;n.testdestroyed("moveTo")||(n.transformHitPolygon(),n.move(s-n.hitPolygonTransformed[0].x,a-n.hitPolygonTransformed[0].y))},!1,!1,"Verschiebt das Grafikobjekt so, dass sich sein 'Mittelpunkt' an den angegebenen Koordinaten befindet.",!1))}}class ta extends vi{constructor(e,t,i,n,s,a){super(s,a),this.left=e,this.top=t,this.width=i,this.height=n,this.centerXInitial=e+i/2,this.centerYInitial=t+n/2,this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new ta(this.left,this.top,this.width,this.height,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}render(){this.hitPolygonInitial=[{x:this.left,y:this.top},{x:this.left,y:this.top+this.height},{x:this.left+this.width,y:this.top+this.height},{x:this.left+this.width,y:this.top}];let e=this.displayObject;this.displayObject==null?(e=new gt,this.displayObject=e,this.worldHelper.stage.addChild(e)):e.clear(),this.fillColor!=null&&e.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&e.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),e.moveTo(this.left,this.top),e.lineTo(this.left+this.width,this.top),e.lineTo(this.left+this.width,this.top+this.height),e.lineTo(this.left,this.top+this.height),e.closePath(),this.fillColor!=null&&e.endFill()}}class lA extends $t{constructor(e){super("RepeatType",e,[{type:f.pushEnumValue,position:null,identifier:"once"},{type:f.pushEnumValue,position:null,identifier:"loop"},{type:f.pushEnumValue,position:null,identifier:"backAndForth"}]),this.documentation="Gibt an, auf welche Art eine Sprite-Animation abgespielt werden soll."}}class oA extends ${constructor(e){super("RoundedRectangle",e,"Rechteck mit abgerundeten Ecken"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("RoundedRectangle",new g([{identifier:"left",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"top",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"radius",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new pf(n,s,a,l,o,e.main.getInterpreter(),i);i.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues, achsenparalleles abgerundetes Rechteck-Objekt. (left, top) sind die Koordinaten der linken oberen Ecke.",!0)),this.addMethod(new m("getWidth",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getWidth"))return n.width*n.displayObject.scale.x},!1,!1,"Gibt die Breite zurück.",!1)),this.addMethod(new m("getHeight",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getHeight"))return n.height*n.displayObject.scale.y},!1,!1,"Gibt die Höhe zurück.",!1)),this.addMethod(new m("getRadius",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getHeight"))return n.radius*n.displayObject.scale.y},!1,!1,"Gibt den Eckradius zurück.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des RoundedRectangle-Objekts und git sie zurück.",!1))}}class pf extends vi{constructor(e,t,i,n,s,a,l){super(a,l),this.left=e,this.top=t,this.width=i,this.height=n,this.radius=s,this.centerXInitial=e+i/2,this.centerYInitial=t+n/2,this.hitPolygonInitial=[],this.addCenterCircle(e+s,t+s,Math.PI/2),this.addCenterCircle(e+s,t+n-s,Math.PI),this.addCenterCircle(e+i-s,t+n-s,3*Math.PI/2),this.addCenterCircle(e+i-s,t+s,0),this.hitPolygonInitial.push({x:e+s,y:t}),this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}getCopy(e){let t=new he(e),i=new pf(this.left,this.top,this.width,this.height,this.radius,this.worldHelper.interpreter,t);return t.intrinsicData.Actor=i,i.copyFrom(this),i.render(),t}addCenterCircle(e,t,i){let n=8,s=Math.PI/2/n;for(let a=0;a<=n;a++)this.hitPolygonInitial.push({x:e+this.radius*Math.cos(i+s*a),y:t-this.radius*Math.sin(i+s*a)})}render(){let e=this.displayObject;this.displayObject==null?(e=new gt,this.displayObject=e,this.worldHelper.stage.addChild(e)):e.clear(),this.fillColor!=null&&e.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&e.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),e.drawRoundedRect(this.left,this.top,this.width,this.height,this.radius),this.fillColor!=null&&e.endFill()}}class uA extends $t{constructor(e){super("ScaleMode",e,[{type:f.pushEnumValue,position:null,identifier:"linear"},{type:f.pushEnumValue,position:null,identifier:"nearest_neighbour"}]),this.documentation="Art der Interpolation der Pixelfarben beim Skalieren von grafischen Objekten"}}class hA extends ${constructor(e){super("Sound",e,"Aufzählung aller Geräusche"),this.setBaseClass(e.typeStore.getType("Object"));for(let t of Yn.sounds)this.addAttribute(new ce(t.name,F,i=>{i.value=t.name},!0,ee.public,!0,t.description));this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("playSound",new g([{identifier:"sound",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[1].value;Yn.play(i)},!1,!0,"Spielt einen Sound ab. Die Möglichen Sounds sind als statische Variablen der Klasse Sound hinterlegt. Tippe als Parameter also Sound gefolgt von einem Punkt ein, um eine Auswahl zu sehen!")),this.addMethod(new m("getVolume",new g([]),A,t=>(Yn.volumeDetectionRunning||Yn.startDetectingVolume(),Yn.getVolume()),!1,!0,"Gibt die aktuelle Mikrofonlautstärke zurück. Beim ersten Aufruf muss der Benutzer dem Browser die Erlaubnis zur Benutzung des Mikrofons geben. Solange dies noch nicht erfolgt ist, gibt die Funktion den Wert -1 zurück."))}}const qi=class qi{static getPolygonForTexture(e,t,i,n){t==null&&(t=0),e+="#"+t;let s=qi.polygonStore[e];return s==null&&(s=qi.getPolygon(n,i.worldHelper),qi.polygonStore[e]=s),s}static getPolygon(e,t){let n=t.app.renderer.extract.pixels(e),s=e.width,a=e.height;if(n.length!==4*s*a)return[{x:0,y:0},{x:s,y:0},{x:s,y:a},{x:0,y:a}];let l=[],u=3*2+3,h=[];qi.addPointsOnLine({x:0,y:0},{x:s-1,y:0},u,h),qi.addPointsOnLine({x:s-1,y:0},{x:s-1,y:a-1},u,h),qi.addPointsOnLine({x:s-1,y:a-1},{x:0,y:a-1},u,h),qi.addPointsOnLine({x:0,y:a-1},{x:0,y:0},u,h);let d={x:s/2,y:a/2};for(let v of h)qi.probe(l,v,d,s,a,n);let p=!1;for(;!p;){p=!0;for(let v=0;v<l.length-1;v++)gb(l[v],l[(v+2)%l.length],l[v+1])<2&&(l.splice(v+1,1),p=!1)}return l}static addPointsOnLine(e,t,i,n){let s=(t.x-e.x)/(i-1),a=(t.y-e.y)/(i-1);for(let l=1;l<=i-1+.1;l++)n.push({x:e.x+s*l,y:e.y+a*l})}static probe(e,t,i,n,s,a){let l=Zo(t,i),o=(i.x-t.x)/l,u=(i.y-t.y)/l,h,d;for(let p=0;p<=l-2&&(h=t.x+p*o,d=t.y+p*u,!!qi.isTransparent(h,d,n,s,a));p++);e.push({x:h,y:d})}static isTransparent(e,t,i,n,s){return e<0||t<0||e>i||t>n?!0:s[4*Math.round(e)+4*i*Math.round(t)+3]==0}};y(qi,"polygonStore",{});let Ud=qi;var Vd;(r=>{function e(n){let s=n.slice();return s.sort(r.POINT_COMPARATOR),r.makeHullPresorted(s)}r.makeHull=e;function t(n){if(n.length<=1)return n.slice();let s=[];for(let l=0;l<n.length;l++){const o=n[l];for(;s.length>=2;){const u=s[s.length-1],h=s[s.length-2];if((u.x-h.x)*(o.y-h.y)>=(u.y-h.y)*(o.x-h.x))s.pop();else break}s.push(o)}s.pop();let a=[];for(let l=n.length-1;l>=0;l--){const o=n[l];for(;a.length>=2;){const u=a[a.length-1],h=a[a.length-2];if((u.x-h.x)*(o.y-h.y)>=(u.y-h.y)*(o.x-h.x))a.pop();else break}a.push(o)}return a.pop(),s.length==1&&a.length==1&&s[0].x==a[0].x&&s[0].y==a[0].y?s:s.concat(a)}r.makeHullPresorted=t;function i(n,s){return n.x<s.x?-1:n.x>s.x?1:n.y<s.y?-1:n.y>s.y?1:0}r.POINT_COMPARATOR=i})(Vd||(Vd={}));class dA extends ${constructor(e){super("Sprite",e,"Ein Sprite ist eine kleine Pixelgrafik, die verschoben, gedreht und skaliert werden kann. Zudem besitzt es Methoden zum Erkennen von Kollisionen mit anderen grafischen Objekten."),this.setBaseClass(e.typeStore.getType("Shape"));let t=e.typeStore.getType("ScaleMode");this.addMethod(new m("Sprite",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"spriteLibraryEntry",type:e.typeStore.getType("SpriteLibrary"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"scalemode",type:t,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=i[5].value,h=new $r(s,a,l.enumValue.identifier,o,e.main.getInterpreter(),n,null,u.enumValue.identifier);n.intrinsicData.Actor=h},!1,!1,"Instanziert ein neues Sprite und stellt es an der Position (x, y) dar. SpriteLibraryEntry ist ein Auzählungstyp (enum). Gib einfach SpriteLibraryEntry gefolgt von einem Punkt ein, dann erhältst Du ein Auswahl von Bildern. Einen Überblick über die Bilder bekommst Du auch über den Menüpunkt Hilfe->Sprite-Bilderübersicht.",!0)),this.addMethod(new m("Sprite",new g([{identifier:"shape",type:e.typeStore.getType("Shape"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"scalemode",type:t,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value;if(s==null){e.main.getInterpreter().throwException("Die übergebene Figur ist null.");return}let l=new $r(0,0,"",0,e.main.getInterpreter(),n,s.intrinsicData.Actor,a.enumValue.identifier);n.intrinsicData.Actor=l},!1,!1,"Zeichnet das graphische Objekt (shape) in eine Bitmap und macht daraus ein Sprite. Dieses wird an der Position (x, y) dargestellt.",!0)),this.addMethod(new m("Sprite",new g([{identifier:"shape",type:e.typeStore.getType("Shape"),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value;if(s==null){e.main.getInterpreter().throwException("Die übergebene Figur ist null.");return}let a=new $r(0,0,"",0,e.main.getInterpreter(),n,s.intrinsicData.Actor,"linear");n.intrinsicData.Actor=a},!1,!1,"Zeichnet das graphische Objekt (shape) in eine Bitmap und macht daraus ein Sprite. Dieses wird an der Position (x, y) dargestellt.",!0)),this.addMethod(new m("Sprite",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"spriteLibraryEntry",type:e.typeStore.getType("SpriteLibrary"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=new $r(s,a,l.enumValue.identifier,o,e.main.getInterpreter(),n);n.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues Sprite und stellt es an der Position (x, y) dar. SpriteLibraryEntry ist ein Aufzählungstyp (enum). Gib einfach SpriteLibraryEntry gefolgt von einem Punkt ein, dann erhältst Du ein Auswahl von Bildern. Einen Überblick über die Bilder bekommst Du auch über den Menüpunkt Hilfe->Sprite-Bilderübersicht.",!0)),this.addMethod(new m("Sprite",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"spriteLibraryEntry",type:e.typeStore.getType("SpriteLibrary"),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=new $r(s,a,l.enumValue.identifier,null,e.main.getInterpreter(),n);n.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues Sprite und stellt es an der Position (x, y) dar. SpriteLibraryEntry ist ein Auzählungstyp (enum). Gib einfach SpriteLibraryEntry gefolgt von einem Punkt ein, dann erhältst Du ein Auswahl von Bildern. Einen Überblick über die Bilder bekommst Du auch über den Menüpunkt Hilfe->Sprite-Bilderübersicht.",!0)),this.addMethod(new m("setImage",new g([{identifier:"spriteLibraryEntry",type:e.typeStore.getType("SpriteLibrary"),declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.isDestroyed||a.setTexture(s.enumValue.identifier)},!1,!1,"Ändert das Bild des Sprites. SpriteLibraryEntry ist ein Auzählungstyp (enum). Gib einfach SpriteLibraryEntry gefolgt von einem Punkt ein, dann erhältst Du ein Auswahl von Bildern. Einen Überblick über die Bilder bekommst Du auch über den Menüpunkt Hilfe->Sprite-Bilderübersicht.",!1)),this.addMethod(new m("setImage",new g([{identifier:"spriteLibraryEntry",type:e.typeStore.getType("SpriteLibrary"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.isDestroyed||l.setTexture(s.enumValue.identifier,a)},!1,!1,"Ändert das Bild des Sprites. SpriteLibraryEntry ist ein Auzählungstyp (enum). Gib einfach SpriteLibraryEntry gefolgt von einem Punkt ein, dann erhältst Du ein Auswahl von Bildern. Einen Überblick über die Bilder bekommst Du auch über den Menüpunkt Hilfe->Sprite-Bilderübersicht.",!1)),this.addMethod(new m("setImageIndex",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.isDestroyed||a.setTexture(a.textureName,s)},!1,!1,"Ändert den Bildindex des Sprites.",!1)),this.addMethod(new m("playAnimation",new g([{identifier:"indexArray",type:new ze(C),declaration:null,usagePositions:null,isFinal:!0},{identifier:"repeatType",type:e.typeStore.getType("RepeatType"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"imagesPerSecond",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=n.intrinsicData.Actor,u=[];for(let h of s)u.push(h.value);o.testdestroyed("playAnimation")||o.playAnimation(u,a.enumValue.identifier,l)},!1,!1,"Spielt eine Animation ab.",!1)),this.addMethod(new m("playAnimation",new g([{identifier:"fromIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"toIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"repeatType",type:e.typeStore.getType("RepeatType"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"imagesPerSecond",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=n.intrinsicData.Actor;if(u.testdestroyed("playAnimation"))return;let h=[];if(Math.abs(a-s)<1e4){let d=Math.sign(a-s);for(let p=s;p!=a;p=p+d)h.push(p);h.push(a)}u.playAnimation(h,l.enumValue.identifier,o)},!1,!1,"Spielt eine Animation ab.",!1)),this.addMethod(new m("stopAnimation",new g([]),null,i=>{let s=i[0].value.intrinsicData.Actor;s.isDestroyed||s.stopAnimation(!1)},!1,!1,"Stoppt die gerade laufende Animation",!1)),this.addMethod(new m("pauseAnimation",new g([]),null,i=>{let s=i[0].value.intrinsicData.Actor;s.testdestroyed("pauseAnimation")||s.pauseAnimation()},!1,!1,"Pausiert die laufende Animation.",!1)),this.addMethod(new m("resumeAnimation",new g([]),null,i=>{let s=i[0].value.intrinsicData.Actor;s.testdestroyed("resumeAnimation")||s.resumeAnimation()},!1,!1,"Fährt mit einer pausierten Animation wieder fort.",!1)),this.addMethod(new m("setAlpha",new g([{identifier:"alphaValue",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("setAlpha")||a.setAlpha(s)},!1,!1,"Setzt die Durchsichtigkeit. 0.0 bedeutet vollkommen durchsichtig, 1.0 bedeutet vollkommen undurchsichtig.",!1)),this.addMethod(new m("copy",new g([]),this,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(!s.testdestroyed("copy"))return s.getCopy(n.class)},!1,!1,"Erstellt eine Kopie des Sprite-Objekts und git sie zurück.",!1)),this.addMethod(new m("getWidth",new g([]),A,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getWidth"))return s.getWidth()},!1,!1,"Gibt die Breite zurück.",!1)),this.addMethod(new m("getHeight",new g([]),A,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getHeight"))return s.getHeight()},!1,!1,"Gibt die Höhe zurück.",!1)),this.addMethod(new m("getImageIndex",new g([]),C,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getImageIndex"))return s.index},!1,!1,"Gibt den Index des Bildes innerhalb der Sprite-Library zurück.",!1)),this.addMethod(new m("makeTiling",new g([{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("makeTiling")||l.makeTiling(s,a,0,0)},!1,!1,`Fügt das identische Bild nach rechts und unten kachelartig ('tile'!) so oft hinzu, bis die angegebene Breite erreicht ist. 
TIPP: Mit der Methode getTileImage() erhält man ein Tile-Objekt, dessen Methoden move, scale, mirrorX und mirrorY sich gleichzeitig auf jede einzelne Kachel auswirken.`,!1)),this.addMethod(new m("makeTiling",new g([{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"gapX",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"gapY",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=i[3].value,o=i[4].value,u=n.intrinsicData.Actor;u.testdestroyed("makeTiling")||u.makeTiling(s,a,l,o)},!1,!1,`Fügt das identische Bild nach rechts und unten kachelartig ('tile'!) so oft hinzu, bis die angegebene Breite erreicht ist. 
TIPP: Mit der Methode getTileImage() erhält man ein Tile-Objekt, dessen Methoden move, scale, mirrorX und mirrorY sich gleichzeitig auf jede einzelne Kachel auswirken. GapX und GapY sind die Abstände, die zwischen den einzelnen Kacheln eingehalten werden.`,!1)),this.addMethod(new m("getTileImage",new g([]),e.typeStore.getType("Tile"),i=>{let s=i[0].value.intrinsicData.Actor;if(s.testdestroyed("getTileImage"))return;if(!s.isTileSprite){s.worldHelper.interpreter.throwException("Das Sprite hat kein TileImage. Sie müssen es zuerst mit der Methode makeTiling in ein Kachel-Sprite umwandeln.");return}let a=new he(e.typeStore.getType("Tile"));return a.intrinsicData.Actor=new fA(s),a},!1,!1,"Nachdem das Sprite mittels der Methode 'makeTiling' zum TileSprite gemacht wurde, kann wirken die Methoden move, scale und rotate immer auf den ganzen gekachelten Bereich. Will man das verfielfachte Bild ändern, so bekommt man über diese Methode das Sprite-Objekt, das diesem Bild entspricht. Ruft man für dieses Objekt die Methoden move, rotate oder scale auf, so wirken sie auf jede der einzelnen Kacheln.",!1))}}class $r extends sa{constructor(t,i,n,s,a,l,o,u="nearest_neighbour"){super(a,l);y(this,"animationIndices",[]);y(this,"animationRuns",!1);y(this,"imagesPerMillisecond",1);y(this,"animationTime",0);y(this,"animationPaused",!1);y(this,"repeatType","once");y(this,"textureName","");y(this,"isTileSprite",!1);y(this,"oldTexture");if(this.x=t,this.y=i,this.name=n,this.index=s,this.interpreter=a,this.scaleMode=u,o==null)this.setTexture(null,s);else{this.copyBitmapFromShape(o);let d=o.displayObject.getBounds();this.x=d.left+d.width/2,this.y=d.top+d.height/2}let h=this.displayObject;this.displayObject.localTransform.translate(this.x-h.width/2,this.y-h.height/2),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(h),this.centerXInitial=h.width/2,this.centerYInitial=h.height/2,this.addToDefaultGroupAndSetDefaultVisibility()}makeTiling(t,i,n,s){t/=this.scaleFactor,i/=this.scaleFactor;let a=this.displayObject;this.oldTexture==null&&(this.oldTexture=a.texture);let l=this.oldTexture;(n>0||s>0)&&(l=this.generateGapTexture(l,n,s)),l.baseTexture.mipmap=Ei.OFF;let o=new uf(l,t,i);o.setParent(a.parent),o.transform.localTransform.copyFrom(a.transform.localTransform),o.transform.onChange(),o.updateTransform(),this.displayObject=o,this.centerXInitial+=-a.width/2+t/2,this.centerYInitial+=-a.height/2+i/2;let u=this.centerXInitial-t/2,h=this.centerYInitial-i/2,d=u+t,p=h+i;this.hitPolygonInitial=[{x:u,y:h},{x:d,y:h},{x:d,y:p},{x:u,y:p}],this.setHitPolygonDirty(!0),a.destroy(),this.isTileSprite=!0}generateGapTexture(t,i,n){const s=new gt,a=new Wt(t);return s.lineStyle(1,0,.01),s.drawRect(0,0,a.width+i,a.height+n),s.addChild(a),this.worldHelper.app.renderer.generateTexture(s)}setTileOffset(t,i){this.isTileSprite&&this.displayObject.tilePosition.set(t,i)}copyBitmapFromShape(t){let i=t.displayObject.getBounds(),n=i.width,s=i.height;const a=new bl({scaleMode:this.scaleMode=="nearest_neighbour"?Xt.NEAREST:Xt.LINEAR,width:n,height:s});let l=new bi(a),o=t.displayObject;this.worldHelper.app.renderer.render(o,{renderTexture:l,transform:new Ye().translate(-i.left,-i.top)});let u=[];u=this.extractPoints(t,u);for(let h of u)h.x-=i.left,h.y-=i.top;this.hitPolygonInitial=u,this.hitPolygonInitial=Vd.makeHull(u),this.hitPolygonDirty=!0,this.displayObject=new Wt(l),t.setHitPolygonDirty(!0)}extractPoints(t,i){if(t instanceof kr){for(let n of t.shapes)i=this.extractPoints(n.intrinsicData.Actor,i);return i}else return t.hitPolygonDirty&&t.transformHitPolygon(),i.concat(t.hitPolygonTransformed.map(function(n){return{x:n.x,y:n.y}}))}getWidth(){return this.displayObject.width*this.scaleFactor}getHeight(){return this.displayObject.height*this.scaleFactor}getCopy(t){let i=new he(t),n=new $r(this.x,this.y,this.name,this.index,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}setAlpha(t){this.displayObject.alpha=t}setTexture(t,i){if(t==this.name&&i==this.index)return;t==null&&(t=this.name),i==null&&(i=0),this.index=i,this.textureName=t;let n=yi.get("spritesheet"),s=t+"#"+i,a=n.textures[s];if(a==null&&(n=this.worldHelper.interpreter.main.userSpritesheet,a=n==null?void 0:n.textures[s]),a!=null){if(a.baseTexture.scaleMode=0,this.scaleMode=="linear"){let h=this.worldHelper.scaledTextures[s];if(h==null){let d=new Wt(a),p=bi.create({width:d.width,height:d.height,scaleMode:Xt.LINEAR});this.worldHelper.app.renderer.render(d,{renderTexture:p}),this.worldHelper.scaledTextures[s]=p,h=p}a=h,a==null&&(a=n.textures[s])}let l=this.displayObject;l==null?(l=new Wt(a),this.displayObject=l):l.texture=a,this.isTileSprite||(this.hitPolygonInitial=Ud.getPolygonForTexture(t,i,this,new Wt(n.textures[s])),this.hitPolygonDirty=!0);let o=this.centerXInitial,u=this.centerYInitial;this.centerXInitial=l.width/2,this.centerYInitial=l.height/2,this.displayObject.parent&&(this.displayObject.localTransform.append(new Ye().translate(o-this.centerXInitial,u-this.centerYInitial)),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0))}else this.interpreter.throwException("Das Spritesheet "+t+" hat kein Bild mit Index "+i),this.displayObject==null&&(this.displayObject=new Wt)}render(){}playAnimation(t,i,n){this.stopAnimation(!1),this.animationIndices=t,this.repeatType=i,this.imagesPerMillisecond=n/1e3,this.animationTime=0,this.animationRuns=!0,this.worldHelper.spriteAnimations.push(this)}stopAnimation(t){if(this.animationRuns){let i=this.worldHelper.spriteAnimations,n=i.indexOf(this);n>=0&&i.splice(n,1)}this.animationRuns=!1,t&&this.setVisible(!1)}pauseAnimation(){this.animationPaused=!0}resumeAnimation(){this.animationPaused=!1}tick(t){if(this.animationPaused)return;let i;switch(this.repeatType){case"backAndForth":let n=this.animationIndices.length*2/this.imagesPerMillisecond,s=Math.trunc(this.animationTime/n),a=this.animationTime-s*n;i=this.imagesPerMillisecond*a,i>=this.animationIndices.length&&(i=Math.max(2*this.animationIndices.length-.1-i,0)),i=Math.trunc(i);break;case"loop":let l=this.animationIndices.length/this.imagesPerMillisecond,o=Math.trunc(this.animationTime/l),u=this.animationTime-o*l;i=this.imagesPerMillisecond*u,i=Math.trunc(i),i=Math.trunc(i);break;case"once":if(i=Math.trunc(this.imagesPerMillisecond*this.animationTime),i>=this.animationIndices.length){this.stopAnimation(!0),this.destroy();return}break}this.animationTime+=t,this.setTexture(null,this.animationIndices[i])}}class cA extends ${constructor(e){super("Tile",e,"Eine Kachel in einem Sprite, das mithilfe der Methode makeTiling zu einer Kachelfläche gemacht wurde."),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("move",new g([{identifier:"dx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"dy",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=i.intrinsicData.Actor;a.testdestroyed("move")||a.move(n,s)},!1,!1,"Verschiebt das Grafikobjekt um dx Pixel nach rechts und um dy Pixel nach unten.",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("scale")||s.scale(n,n)},!1,!1,"Streckt das Grafikobjekt um den angegebenen Faktor. Das Zentrum der Streckung ist der 'Mittelpunkt' des Objekts.",!1)),this.addMethod(new m("mirrorX",new g([]),U,t=>{let n=t[0].value.intrinsicData.Actor;n.testdestroyed("mirrorX")||n.scale(-1,1)},!1,!1,"Spiegelt das Objekt in X-Richtung.",!1)),this.addMethod(new m("mirrorY",new g([]),U,t=>{let n=t[0].value.intrinsicData.Actor;n.testdestroyed("mirrorX")||n.scale(1,-1)},!1,!1,"Spiegelt das Objekt in Y-Richtung.",!1))}}class fA{constructor(e){this.spriteHelper=e}move(e,t){let i=this.spriteHelper.displayObject;i.tilePosition.x+=e,i.tilePosition.y+=t}scale(e,t){let i=this.spriteHelper.displayObject;i.tileScale.x*=e,i.tileScale.y*=t}testdestroyed(e){return this.spriteHelper.testdestroyed(e)}}var Jo=[{filename:"ship_1.png",name:"Ship_1",index:0,scale:.8},{filename:"ship_2.png",name:"Ship_1",index:1,scale:.8},{filename:"ship_3.png",name:"Ship_1",index:2,scale:.8},{filename:"Schaufel.png",name:"Werkzeug",index:0,scale:1},{filename:"minesweeper/minesweeper.png",name:"Minesweeper",tilesX:20,tilesY:1,spacingX:1,scale:1,index:0},{filename:"minesweeper/minesweeper-numbers.png",name:"Minesweeper",tilesX:10,tilesY:1,scale:1,index:22},{filename:"Sleepy_Blocks/sleepy_blocks.png",name:"Sleepy_Blocks",tilesX:8,tilesY:1,spacingX:2,spacingY:2,scale:1,index:0,extrudeMarginWidth:1},{filename:"flappy_bird/bird1.png",name:"Bird",index:0,indexName:"Bird"},{filename:"flappy_bird/bird2.png",name:"Bird",index:1,indexName:"Bird"},{filename:"flappy_bird/bird3.png",name:"Bird",index:2,indexName:"Bird"},{filename:"flappy_bird/Baeume.png",name:"Bird",index:3,indexName:"Bird"},{filename:"flappy_bird/houses.png",name:"Bird",index:4,indexName:"Bird"},{filename:"flappy_bird/Leiste.png",name:"Bird",index:5,indexName:"Bird"},{filename:"flappy_bird/Saeule.png",name:"Bird",index:6,indexName:"Bird"},{filename:"flappy_bird/Wolken.png",name:"Bird",index:7,indexName:"Bird"},{filename:"Raumschiff_Adrian/NeuesRaumschiff/raumschiff_0004_geradeaus.png",name:"Space_Shooter_1",index:0},{filename:"Raumschiff_Adrian/NeuesRaumschiff/raumschiff_0001_runter1.png",name:"Space_Shooter_1",index:1},{filename:"Raumschiff_Adrian/NeuesRaumschiff/raumschiff_0000_runter2.png",name:"Space_Shooter_1",index:2},{filename:"Raumschiff_Adrian/NeuesRaumschiff/raumschiff_0003_hoch1.png",name:"Space_Shooter_1",index:3},{filename:"Raumschiff_Adrian/NeuesRaumschiff/raumschiff_0002_hoch2.png",name:"Space_Shooter_1",index:4},{filename:"Raumschiff_Adrian/NeuerSchuss.png",name:"Space_Shooter_1",index:5},{filename:"Raumschiff_Adrian/Schussanimation/schuss_0000.png",name:"Space_Shooter_1",index:6},{filename:"Raumschiff_Adrian/Schussanimation/schuss_0001.png",name:"Space_Shooter_1",index:7},{filename:"Raumschiff_Adrian/Schussanimation/schuss_0002.png",name:"Space_Shooter_1",index:8},{filename:"Raumschiff_Adrian/Schussanimation/schuss_0003.png",name:"Space_Shooter_1",index:9},{filename:"Raumschiff_Adrian/Asteroid.png",name:"Space_Shooter_1",index:10},{filename:"Raumschiff_Adrian/Gegner.png",name:"Space_Shooter_1",index:11},{filename:"Raumschiff_Adrian/Explosion/explosion_0000_..png",name:"Space_Shooter_1",index:12},{filename:"Raumschiff_Adrian/Explosion/explosion_0001_..png",name:"Space_Shooter_1",index:13},{filename:"Raumschiff_Adrian/Explosion/explosion_0002_..png",name:"Space_Shooter_1",index:14},{filename:"Raumschiff_Adrian/Explosion/explosion_0003_..png",name:"Space_Shooter_1",index:15},{filename:"Raumschiff_Adrian/Explosion/explosion_0004_..png",name:"Space_Shooter_1",index:16},{filename:"Raumschiff_Adrian/Explosion/explosion_0005_..png",name:"Space_Shooter_1",index:17},{filename:"Raumschiff_Adrian/Explosion/explosion_0006_..png",name:"Space_Shooter_1",index:18},{filename:"Raumschiff_Adrian/Explosion/explosion_0007_..png",name:"Space_Shooter_1",index:19},{filename:"Raumschiff_Adrian/Explosion/explosion_0008_..png",name:"Space_Shooter_1",index:20},{filename:"Raumschiff_Adrian/Explosion/explosion_0009_..png",name:"Space_Shooter_1",index:21},{filename:"Raumschiff_Adrian/Explosion/explosion_0010_..png",name:"Space_Shooter_1",index:22},{filename:"Raumschiff_Adrian/Explosion/explosion_0011_..png",name:"Space_Shooter_1",index:23},{filename:"classics/spaceship_1.png",name:"Space_Shooter_2",index:0},{filename:"classics/spaceship_2.png",name:"Space_Shooter_2",index:1},{filename:"classics/spaceship_3.png",name:"Space_Shooter_2",index:2},{filename:"classics/spaceship_4.png",name:"Space_Shooter_2",index:3},{filename:"classics/spaceship_5.png",name:"Space_Shooter_2",index:4},{filename:"classics/spaceship_6.png",name:"Space_Shooter_2",index:5},{filename:"classics/spaceship_7.png",name:"Space_Shooter_2",index:6},{filename:"classics/spaceship_8.png",name:"Space_Shooter_2",index:7},{filename:"classics/spaceship_9.png",name:"Space_Shooter_2",index:8},{filename:"classics/missile_1.png",name:"Space_Shooter_2",index:9},{filename:"classics/missile_2.png",name:"Space_Shooter_2",index:10},{filename:"classics/missile_3.png",name:"Space_Shooter_2",index:11},{filename:"classics/missile_4.png",name:"Space_Shooter_2",index:12},{filename:"classics/missile_5.png",name:"Space_Shooter_2",index:13},{filename:"classics/missile_6.png",name:"Space_Shooter_2",index:14},{filename:"classics/missile_7.png",name:"Space_Shooter_2",index:15},{filename:"classics/missile_8.png",name:"Space_Shooter_2",index:16},{filename:"classics/missile_9.png",name:"Space_Shooter_2",index:17},{filename:"classics/missile_10.png",name:"Space_Shooter_2",index:18},{filename:"classics/missile_11.png",name:"Space_Shooter_2",index:19},{filename:"classics/missile_12.png",name:"Space_Shooter_2",index:20},{filename:"classics/satellite_1.png",name:"Space_Shooter_2",index:21},{filename:"classics/satellite_2.png",name:"Space_Shooter_2",index:22},{filename:"classics/sokoban_man_horizontal.png",name:"Soko",tilesX:3,tilesY:1,spacingX:2,spacingY:0,scale:1,index:0,extrudeMarginWidth:1},{filename:"classics/sokoban_man_vertical.png",name:"Soko",tilesX:6,tilesY:1,spacingX:2,spacingY:0,scale:1,index:3,extrudeMarginWidth:1},{filename:"classics/sokoban_box_1.png",name:"Soko",index:9,extrudeMarginWidth:1},{filename:"classics/sokoban_box_2.png",name:"Soko",index:10,extrudeMarginWidth:1},{filename:"classics/sokoban_empty.png",name:"Soko",index:11,extrudeMarginWidth:1},{filename:"classics/sokoban_wall.png",name:"Soko",index:12,extrudeMarginWidth:1},{filename:"classics/sokoban_target.png",name:"Soko",index:13,extrudeMarginWidth:1},{filename:"classics/pacman_characters.png",name:"PMan",tilesX:22,tilesY:1,spacingX:2,spacingY:0,scale:1,index:0},{filename:"classics/pacman_maze.png",name:"PMan",tilesX:15,tilesY:1,spacingX:2,spacingY:0,scale:1,index:22},{filename:"classics/bo_bat_long.png",name:"Breakin",index:0},{filename:"classics/bo_bat_short.png",name:"Breakin",index:1},{filename:"classics/bo_ball_blue.png",name:"Breakin",index:2},{filename:"classics/bo_ball_gray.png",name:"Breakin",index:3},{filename:"classics/bo_rechteck.png",name:"Breakin",index:4},{filename:"classics/bo_rechteck_active.png",name:"Breakin",index:5},{filename:"classics/bo_quadrat.png",name:"Breakin",index:6},{filename:"classics/bo_quadrat_active.png",name:"Breakin",index:7},{filename:"classics/bo_fuenfeck.png",name:"Breakin",index:8},{filename:"classics/bo_fuenfeck_active.png",name:"Breakin",index:9},{filename:"classics/bo_raute.png",name:"Breakin",index:10},{filename:"classics/bo_raute_active.png",name:"Breakin",index:11},{filename:"classics/bo_star1.png",name:"Breakin",index:12},{filename:"classics/bo_star2.png",name:"Breakin",index:13},{filename:"classics/Chess.png",name:"Boardgames",tilesX:6,tilesY:2,spacingX:2,spacingY:2,scale:1,index:0},{filename:"classics/Spielstein.png",name:"Boardgames",index:12},{filename:"classics/wuerfel_1.png",name:"Boardgames",index:13},{filename:"classics/wuerfel_2.png",name:"Boardgames",index:14},{filename:"classics/wuerfel_3.png",name:"Boardgames",index:15},{filename:"classics/wuerfel_4.png",name:"Boardgames",index:16},{filename:"classics/wuerfel_5.png",name:"Boardgames",index:17},{filename:"classics/wuerfel_6.png",name:"Boardgames",index:18},{filename:"plattformer/Tiles_and_enemies_64x64.png",name:"Plattforms",tilesX:22,tilesY:16,spacingX:2,spacingY:2,scale:1,index:0,extrudeMarginWidth:1},{filename:"tower-defense/tower-defense.png",name:"TowerDefense",tilesX:18,tilesY:10,spacingX:2,spacingY:2,scale:1,index:0,extrudeMarginWidth:1},{filename:"plattformer/male.png",name:"Characters_1",tilesX:6,tilesY:2,spacingX:0,spacingY:0,scale:1,index:0},{filename:"plattformer/background_grass.png",name:"Background",index:0,scale:.2},{filename:"plattformer/background_mountains.png",name:"Background",index:1,scale:.2},{filename:"plattformer/background_sky.png",name:"Background",index:2,scale:.2},{filename:"plattformer/cloud1.png",name:"Background",index:3,scale:.5},{filename:"plattformer/cloud2.png",name:"Background",index:4,scale:.5},{filename:"plattformer/cloud3.png",name:"Background",index:5,scale:.5},{filename:"plattformer/cloud4.png",name:"Background",index:6,scale:.5},{filename:"plattformer/grass1.png",name:"Background",index:7},{filename:"plattformer/grass2.png",name:"Background",index:8},{filename:"plattformer/grass3.png",name:"Background",index:9},{filename:"plattformer/tree1.png",name:"Background",index:10,scale:.5},{filename:"plattformer/tree2.png",name:"Background",index:11,scale:.5},{filename:"plattformer/tree3.png",name:"Background",index:12,scale:.5},{filename:"frogger/Frogger_1.png",name:"Frogger",tilesX:3,tilesY:1,spacingX:2,spacingY:0,scale:1,index:0,extrudeMarginWidth:1},{filename:"frogger/Frogger_car.png",name:"Frogger",tilesX:2,tilesY:1,spacingX:2,spacingY:0,scale:1,index:3,extrudeMarginWidth:1},{filename:"3d/grass3d.png",name:"robot",tilesX:1,tilesY:1,index:0},{filename:"3d/tiled_grass.png",name:"robot",tilesX:1,tilesY:1,index:2},{filename:"3d/grass_side.png",name:"robot",tilesX:1,tilesY:1,index:3},{filename:"3d/brick3d_red.png",name:"robot",tilesX:1,tilesY:1,index:4},{filename:"3d/brick3d_yellow.png",name:"robot",tilesX:1,tilesY:1,index:5},{filename:"3d/brick3d_green.png",name:"robot",tilesX:1,tilesY:1,index:6},{filename:"3d/brick3d_blue.png",name:"robot",tilesX:1,tilesY:1,index:7},{filename:"3d/rock.png",name:"robot",tilesX:1,tilesY:1,index:8},{filename:"3d/bedrock.png",name:"robot",tilesX:1,tilesY:1,index:9},{filename:"3d/earth.png",name:"robot",tilesX:1,tilesY:1,index:10},{filename:"3d/north.png",name:"robot",tilesX:1,tilesY:1,index:11},{filename:"pixelmon/creature1.png",name:"pixelmon",index:0},{filename:"pixelmon/creature2.png",name:"pixelmon",index:1},{filename:"pixelmon/creature3.png",name:"pixelmon",index:2},{filename:"pixelmon/flowersblue.png",name:"pixelmon",index:3},{filename:"pixelmon/flowersred.png",name:"pixelmon",index:4},{filename:"pixelmon/flowerswhite.png",name:"pixelmon",index:5},{filename:"pixelmon/tree.png",name:"pixelmon",index:6},{filename:"pixelmon/grass.png",name:"pixelmon",index:7},{filename:"pixelmon/highgrass.png",name:"pixelmon",index:8},{filename:"pixelmon/highgrassoverlay.png",name:"pixelmon",index:9},{filename:"pixelmon/itembucket.png",name:"pixelmon",index:10},{filename:"pixelmon/plattform.png",name:"pixelmon",index:11},{filename:"pixelmon/player1back.png",name:"pixelmon",index:12},{filename:"pixelmon/player1backwalk1.png",name:"pixelmon",index:13},{filename:"pixelmon/player1backwalk2.png",name:"pixelmon",index:14},{filename:"pixelmon/player1front.png",name:"pixelmon",index:15},{filename:"pixelmon/player1frontwalk1.png",name:"pixelmon",index:16},{filename:"pixelmon/player1frontwalk2.png",name:"pixelmon",index:17},{filename:"pixelmon/player1side.png",name:"pixelmon",index:18},{filename:"pixelmon/player1sidewalk1.png",name:"pixelmon",index:19},{filename:"pixelmon/player1sidewalk2.png",name:"pixelmon",index:20},{filename:"pixelmon/wall1.png",name:"pixelmon",index:21},{filename:"pixelmon/wall2.png",name:"pixelmon",index:22},{filename:"pixelmon/wall3.png",name:"pixelmon",index:23},{filename:"pixelmon/wall4.png",name:"pixelmon",index:24},{filename:"pixelmon/wallstairs1.png",name:"pixelmon",index:25},{filename:"pixelmon/wallstairs2.png",name:"pixelmon",index:26},{filename:"pixelmon/wallstairs3.png",name:"pixelmon",index:27},{filename:"pixelmon/wallstairs4.png",name:"pixelmon",index:28},{filename:"pixelmon/water1.png",name:"pixelmon",index:29},{filename:"pixelmon/water2.png",name:"pixelmon",index:30},{filename:"pixelmon/water3.png",name:"pixelmon",index:31},{filename:"pixelmon/water4.png",name:"pixelmon",index:32},{filename:"pixelmon/way1.png",name:"pixelmon",index:33},{filename:"pixelmon/way2.png",name:"pixelmon",index:34},{filename:"pixelmon/way3.png",name:"pixelmon",index:35},{filename:"pixelmon/way4.png",name:"pixelmon",index:36},{filename:"pixelmon/way5.png",name:"pixelmon",index:37},{filename:"pixelmon/way6.png",name:"pixelmon",index:38},{filename:"pixelmon/way7.png",name:"pixelmon",index:39},{filename:"pixelmon/way8.png",name:"pixelmon",index:40},{filename:"pixelmon/whitefence1.png",name:"pixelmon",index:41},{filename:"pixelmon/whitefence2.png",name:"pixelmon",index:42},{filename:"pixelmon/woodfence1.png",name:"pixelmon",index:43},{filename:"pixelmon/woodfence2.png",name:"pixelmon",index:44},{filename:"little_figure/Animation_Run/Run0.png",name:"Sneaker",index:0},{filename:"little_figure/Animation_Run/Run1.png",name:"Sneaker",index:1},{filename:"little_figure/Animation_Run/Run2.png",name:"Sneaker",index:2},{filename:"little_figure/Animation_Sneak/Sneak0.png",name:"Sneaker",index:3},{filename:"little_figure/Animation_Sneak/Sneak1.png",name:"Sneaker",index:4},{filename:"little_figure/Animation_Sneak/Sneak2.png",name:"Sneaker",index:5},{filename:"javakara/bugeast_r.gif",name:"Kara",index:0},{filename:"javakara/object_leaf.gif",name:"Kara",index:1},{filename:"javakara/object_mushroom.gif",name:"Kara",index:2},{filename:"javakara/object_tree.gif",name:"Kara",index:3},{filename:"javahamster/hamster_bottom.png",name:"Hamster",index:0},{filename:"javahamster/grain.png",name:"Hamster",index:1},{filename:"javahamster/wall.png",name:"Hamster",index:2}];function Xg(r,e){let t=""+r;for(;t.length<e;)t="0"+t;return t}let pA=()=>{for(let r=0;r<56;r++)Jo.push({filename:"explosion-images/explosion"+Xg(r,4)+".png",name:"Explosion_1",index:r});for(let r=1;r<=10;r++)Jo.push({filename:"boulders/image_part_"+Xg(r,3)+".png",name:"Boulders",index:r-1})};pA();typeof rc<"u"&&(rc.exports=Jo);class Qo extends $t{constructor(e){super("SpriteLibrary",e,Qo.getSystemNodes()),this.documentation="Aufzählung der Sprite-Grafiken"}includeUserSpritesheet(e){let t=Qo.getSystemNodes();for(let i of e)t.push({type:f.pushEnumValue,position:null,identifier:i});this.setEnumValues(t)}static getSystemNodes(){return Jo.filter(e=>e.index==null||e.index==0).map(e=>({type:f.pushEnumValue,position:null,identifier:e.name}))}}class gA extends ${constructor(e){super("Text",e,"Text, der innerhalb der Grafikausgabe dargestellt werden kann"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Text",new g([]),null,t=>{let i=t[0].value,n=new Vs(0,0,24,"Text",e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert ein neues Textobjekt. Der Textanker (default: links oben) liegt bei (0, 0).",!0)),this.addMethod(new m("Text",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=new Vs(n,s,a,l,e.main.getInterpreter(),i);i.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues Textobjekt. (x, y) sind die Koordinaten des Textankers (default: links oben), fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("Text",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"font-family",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new Vs(n,s,a,l,e.main.getInterpreter(),i,o);i.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues Textobjekt. (x, y) sind die Koordinaten des Textankers (default: links oben), fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("setFontsize",new g([{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setFontsize(n)},!1,!1,"Setzt die Schriftgröße des Textes (Einheit: Pixel).",!1)),this.addMethod(new m("setAlignment",new g([{identifier:"alignment",type:e.typeStore.getType("Alignment"),declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setAlignment(n.enumValue.identifier)},!1,!1,'Setzt die Ausrichtung in X-Richtung. Zulässige Werte sind "Alignment.left", "Alignment.right" und "Alignment.center".',!1)),this.addMethod(new m("setText",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setText(n)},!1,!1,"Setzt den Text.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Text-Objekts und git sie zurück.",!1)),this.addMethod(new m("getWidth",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getWidth"))return n.getWidth()},!1,!1,"Gibt die Breite des Textes zurück.",!1)),this.addMethod(new m("getHeight",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getHeight"))return n.getHeight()},!1,!1,"Gibt die Höhe des Textes zurück.",!1)),this.addMethod(new m("getFontSize",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getFontSize"))return n.fontsize},!1,!1,"Gibt die Schriftgröße zurück.",!1)),this.addMethod(new m("getText",new g([]),F,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getText"))return n.text},!1,!1,"Gibt den Textinhalt zurück.",!1)),this.addMethod(new m("setStyle",new g([{identifier:"isBold",type:P,declaration:null,usagePositions:null,isFinal:!0},{identifier:"isItalic",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=i.intrinsicData.Actor;a.testdestroyed("setStyle")||a.setStyle(n,s)},!1,!1,"Gibt die Eigenschaften Fettdruck (bold) und Schrägschrift (italic) zurück.",!1)),this.addMethod(new m("moveTo",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let n=t[0].value.intrinsicData.Actor,s=t[1].value,a=t[2].value;n.testdestroyed("moveTo")||n.moveTo(s,a)},!1,!1,"Verschiebt das Grafikobjekt so, dass sich sein 'Mittelpunkt' an den angegebenen Koordinaten befindet.",!1))}}class Vs extends vi{constructor(t,i,n,s,a,l,o){super(a,l);y(this,"alignment","left");y(this,"textStyle",new Hi({fontFamily:"Arial",fontSize:10,fontStyle:"normal",fontWeight:"normal",fill:this.fillColor==null?0:this.fillColor,stroke:this.borderColor==null?0:this.borderColor,strokeThickness:this.borderColor==null?0:this.borderWidth,dropShadow:!1,wordWrap:!1,align:"left",lineJoin:"round"}));this.x=t,this.y=i,this.fontsize=n,this.text=s,this.fontFamily=o,this.centerXInitial=t,this.centerYInitial=i,this.fontsize==0&&(this.fontsize=10),this.borderColor=null,this.textStyle.stroke=0,o!=null&&(this.textStyle.fontFamily=o),this.hitPolygonInitial=[],this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}setStyle(t,i){this.textStyle.fontWeight=t?"bold":"normal",this.textStyle.fontStyle=i?"italic":"normal",this.render()}getCopy(t){let i=new he(t),n=new Vs(this.x,this.y,this.fontsize,this.text,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.alignment=this.alignment,n.copyFrom(this),n.render(),i}render(){let t=this.displayObject;if(this.textStyle.fill=this.fillColor==null?0:this.fillColor,this.textStyle.stroke=this.borderColor==null?0:this.borderColor,this.textStyle.strokeThickness=this.borderColor==null?0:this.borderWidth,this.textStyle.fontSize=this.fontsize,this.displayObject==null)t=new jn(this.text,this.textStyle),this.displayObject=t,this.displayObject.localTransform.translate(this.x,this.y),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(t);else{switch(t.text=this.text,t.alpha=this.fillAlpha,this.alignment){case"left":t.anchor.x=0;break;case"center":t.anchor.x=.5;break;case"right":t.anchor.x=1;break}this.textStyle.align=this.alignment,t.style=this.textStyle}this.centerXInitial=0,this.centerYInitial=0;let i=0,n=0;if(this.text!=null){let l=Ct.measureText(""+this.text,this.textStyle);i=l.width,n=l.height,l.fontProperties.ascent,this.centerXInitial=i/2,this.centerYInitial=n/2}let s=0-t.anchor.x*i,a=0-t.anchor.y*n;this.hitPolygonInitial=[{x:s,y:a},{x:s,y:a+n},{x:s+i,y:a+n},{x:s+i,y:a}],this.hitPolygonDirty=!0}moveTo(t,i){let n=new xe(0,0);this.displayObject.updateTransform(),this.displayObject.localTransform.apply(n,n),this.move(t-n.x,i-n.y)}setFontsize(t){this.fontsize=t,this.fontsize==0&&(this.fontsize=10),this.render()}setText(t){this.text=t,this.render()}setAlignment(t){this.alignment=t,this.render()}getWidth(){return this.displayObject.width}getHeight(){return this.displayObject.height}}class mA extends ${constructor(e){super("Input",e,"Klasse mit statischen Methoden zur Eingabe von Text per Tastatur"),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("readChar",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),Ge,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp char")),this.addMethod(new m("readInt",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp int")),this.addMethod(new m("readString",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp String")),this.addMethod(new m("readFloat",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:G,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp float")),this.addMethod(new m("readDouble",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp double")),this.addMethod(new m("readBoolean",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Defaultwert",type:P,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp boolean")),this.addMethod(new m("readChar",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),Ge,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp char")),this.addMethod(new m("readInt",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp int")),this.addMethod(new m("readString",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp String")),this.addMethod(new m("readFloat",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp float")),this.addMethod(new m("readDouble",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp double")),this.addMethod(new m("readBoolean",new g([{identifier:"Meldungstext",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>null,!1,!0,"Erwartet vom Benutzer die Eingabe eines Wertes vom Datentyp boolean"))}}class yA extends ${constructor(e){super("Gamepad",e,"Klasse mit statischen Methoden zur Abfrage der Gamepads"),this.setBaseClass(e.typeStore.getType("Object")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("isButtonDown",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"buttonIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{t[0].value;let i=t[1].value,n=t[2].value;return e.main.getInterpreter().gamepadTool.isGamepadButtonPressed(i,n)},!1,!0,"Gibt genau dann true zurück, wenn der Button buttonIndex des Gamepads GamepadIndex gedrückt ist.",!1)),this.addMethod(new m("isConnected",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{t[0].value;let i=t[1].value;return e.main.getInterpreter().gamepadTool.isGamepadConnected(i)},!1,!0,"Gibt true zurück, falls das Gamepad mit dem übergebenen Index angeschlossen ist. VORSICHT: Das erste Gamepad hat Index 0.",!1)),this.addMethod(new m("getAxisValue",new g([{identifier:"gamepadIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"axisIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>{t[0].value;let i=t[1].value,n=t[2].value;return e.main.getInterpreter().gamepadTool.getGamepadAxisValue(i,n)},!1,!0,"Gibt den Wert des Gamepad-Steuerknüppels mit Index axisIndex zurück.",!1))}}class bA extends ${constructor(e){super("Math",e,"Klasse mit statischen Methoden zur Berechnung mathematischer Funktionen (sin, cos, abs, ...) und zur Ermittlung von Zufallszahlen."),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("PI",A,t=>{t.value=Math.PI},!0,ee.public,!0,"Die Kreiszahl Pi (3.1415...)")),this.addAttribute(new ce("E",A,t=>{t.value=Math.E},!0,ee.public,!0,"Die Eulersche Zahl e")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("round",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.round(t[1].value),!1,!0,"**Rundet** den Wert")),this.addMethod(new m("floor",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.floor(t[1].value),!1,!0,"Rundet den Wert ab, sucht also die **nächstkleinere** ganze Zahl")),this.addMethod(new m("ceil",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.ceil(t[1].value),!1,!0,"Rundet den Wert auf, sucht also die **nächstgrößere** Zahl.")),this.addMethod(new m("signum",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.sign(t[1].value),!1,!0,`Gibt das Vorzeichen der Zahl zurück, d.h. 
  - -1, falls die Zahl **negativ** ist,
  - 0, falls die Zahl **0** ist und
  - +1, falls die Zahl **positiv** ist.`)),this.addMethod(new m("sqrt",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.sqrt(t[1].value),!1,!0,"Gibt die **Quadratwurzel** der Zahl zurück. Für andere Wurzeln benutze Math.pow(a, b), z.B. Math.pow(10, 1.0/3.0) für die Kubikwurzel aus 10.")),this.addMethod(new m("random",new g([]),A,t=>Math.random(),!1,!0,"Gibt eine Zufallszahl aus dem Intervall [0;1[ zurück.")),this.addMethod(new m("pow",new g([{identifier:"Basis",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Exponent",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.pow(t[1].value,t[2].value),!1,!0,'Math.pow(a, b) gibt "a hoch b" zurück.')),this.addMethod(new m("toDegrees",new g([{identifier:"WinkelInRad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>t[1].value/Math.PI*180,!1,!0,"Wandelt einen Winkel von Rad in Grad um, d.h. berechnet Winkel/Pi*180.")),this.addMethod(new m("toRadians",new g([{identifier:"WinkelInGrad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>t[1].value/180*Math.PI,!1,!0,"Wandelt einen Winkel von Grad in Rad um, d.h. berechnet Winkel/180*Pi.")),this.addMethod(new m("exp",new g([{identifier:"Zahl",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.exp(t[1].value),!1,!0,'Berechnet "e hoch die Zahl".')),this.addMethod(new m("log",new g([{identifier:"Zahl",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.log(t[1].value),!1,!0,"Berechnet den natürlichen Logarithmus der Zahl.")),this.addMethod(new m("log10",new g([{identifier:"Zahl",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.log10(t[1].value),!1,!0,"Berechnet den Zehnerlogarithmus der Zahl.")),this.addMethod(new m("sin",new g([{identifier:"WinkelInRad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.sin(t[1].value),!1,!0,"Berechnet den Sinus des Winkels.")),this.addMethod(new m("cos",new g([{identifier:"WinkelInRad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.cos(t[1].value),!1,!0,"Berechnet den Cosinus des Winkels.")),this.addMethod(new m("tan",new g([{identifier:"WinkelInRad",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.tan(t[1].value),!1,!0,"Berechnet den Tangens des Winkels.")),this.addMethod(new m("asin",new g([{identifier:"WertDesSinus",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.asin(t[1].value),!1,!0,"Berechnet den Arcus-Sinus des Wertes in Rad.")),this.addMethod(new m("acos",new g([{identifier:"WertDesCosinus",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.acos(t[1].value),!1,!0,"Berechnet den Arcus-Cosinus des Wertes in Rad.")),this.addMethod(new m("atan",new g([{identifier:"WertDesTangens",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.atan(t[1].value),!1,!0,"Berechnet den Arcus-Tangens des Wertes in Rad.")),this.addMethod(new m("atan2",new g([{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.atan2(t[1].value,t[2].value),!1,!0,`Sind (x, y) die kartesischen Koordinaten eines Punktes, so ist Math.atan2(x, y) der Winkel alpha der Polarkoordinaten (alpha, r) des Punktes. 
**Bem.: **Alpha wird in Rad berechnet.`)),this.addMethod(new m("abs",new g([{identifier:"Wert",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.abs(t[1].value),!1,!0,"Berechnet den Betrag des Wertes.")),this.addMethod(new m("abs",new g([{identifier:"Wert",type:G,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>Math.abs(t[1].value),!1,!0,"Berechnet den Betrag des Wertes.")),this.addMethod(new m("abs",new g([{identifier:"Wert",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.abs(t[1].value),!1,!0,"Berechnet den Betrag des Wertes.")),this.addMethod(new m("max",new g([{identifier:"a",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.max(t[1].value,t[2].value),!1,!0,"Gibt die größere der beiden Zahlen zurück.")),this.addMethod(new m("max",new g([{identifier:"a",type:G,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:G,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>Math.max(t[1].value,t[2].value),!1,!0,"Gibt die größere der beiden Zahlen zurück.")),this.addMethod(new m("max",new g([{identifier:"a",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.max(t[1].value,t[2].value),!1,!0,"Gibt die größere der beiden Zahlen zurück.")),this.addMethod(new m("min",new g([{identifier:"a",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:C,declaration:null,usagePositions:null,isFinal:!0}]),C,t=>Math.min(t[1].value,t[2].value),!1,!0,"Gibt die kleinere der beiden Zahlen zurück.")),this.addMethod(new m("min",new g([{identifier:"a",type:G,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:G,declaration:null,usagePositions:null,isFinal:!0}]),G,t=>Math.min(t[1].value,t[2].value),!1,!0,"Gibt die kleinere der beiden Zahlen zurück.")),this.addMethod(new m("min",new g([{identifier:"a",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,t=>Math.min(t[1].value,t[2].value),!1,!0,"Gibt die kleinere der beiden Zahlen zurück."))}}class vA extends ${constructor(e){super("MathTools",e,"Klasse mit mathematischen Hilfsfunktionen als statische Methoden"),this.setBaseClass(e.typeStore.getType("Object")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass);let t=e.typeStore.getType("Vector2"),i=new ze(t),n=t.attributeMap.get("x").index,s=t.attributeMap.get("y").index;this.addMethod(new m("intersectCircleWithPolygon",new g([{identifier:"mx",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"my",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"r",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"points",type:i,declaration:null,usagePositions:null,isFinal:!0}]),i,a=>{let l=a[1].value,o=a[2].value,u=a[3].value,h=a[4].value,d=[];for(let _ of h)d.push({x:_.value.attributes[n].value,y:_.value.attributes[s].value});let p=[],v={x:l,y:o};for(let _=0;_<d.length;_++){let T=d[_],D=d[(_+1)%d.length];VC(v,u,T,D,p)}let w=[];for(let _ of p){let T=new he(t);T.attributes[n]={type:A,value:_.x},T.attributes[s]={type:A,value:_.y},w.push({type:t,value:T})}return w},!1,!0,"Zu einem gegebenen Kreis werden die Punkte berechnet, die auf den Seiten eines gegebenen Polygons liegen.")),this.addMethod(new m("intersectLineSegments",new g([{identifier:"p0",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"p1",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"p2",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"p3",type:t,declaration:null,usagePositions:null,isFinal:!0}]),t,a=>{let l=[];for(let u=0;u<4;u++){let h=a[u].value.attributes;l.push({x:h[n].value,y:h[s].value})}let o={x:0,y:0};if(hf(l[0],l[1],l[2],l[3],o)){let u=new he(t);return u.attributes[n]={type:A,value:o.x},u.attributes[s]={type:A,value:o.y},u}else return null},!1,!0,"Berechnet den Schnittpunkt der Strecken [p0, p1] und [p2, p3]. Gibt null zurück, wenn sich die Strecken nicht schneiden oder wenn sie parallel sind und teilweise aufeinander liegen.")),this.addMethod(new m("polygonContainsPoint",new g([{identifier:"polygonPoints",type:i,declaration:null,usagePositions:null,isFinal:!0},{identifier:"p",type:t,declaration:null,usagePositions:null,isFinal:!0}]),P,a=>{let l=a[1].value,o=[];for(let d of l)o.push({x:d.value.attributes[n].value,y:d.value.attributes[s].value});let u=a[2].value.attributes,h={x:u[n].value,y:u[s].value};return _r(o,h)},!1,!0,"Gibt genau dann true zurück, wenn das Polygon den Punkt enthält.")),this.addMethod(new m("distancePointToLine",new g([{identifier:"p",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"a",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:t,declaration:null,usagePositions:null,isFinal:!0}]),A,a=>{let l=[];for(let o=0;o<3;o++){let u=a[o].value.attributes;l.push({x:u[n].value,y:u[s].value})}return gb(l[1],l[2],l[0])},!1,!0,"Berechnet den Abstand des Punktes P zur Gerade AB.")),this.addMethod(new m("distancePointToLineSegment",new g([{identifier:"p",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"a",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"b",type:t,declaration:null,usagePositions:null,isFinal:!0}]),A,a=>{let l=[];for(let o=0;o<3;o++){let u=a[o].value.attributes;l.push({x:u[n].value,y:u[s].value})}return kl(l[1],l[2],l[0])},!1,!0,"Berechnet den Abstand des Punktes P zur Strecke [AB]."))}}class wA extends ${constructor(t){super("System",t,"Klasse mit statischen Methoden für Systemfunktionen, z.B. Sound, Löschen der Ausgabe usw.");y(this,"printStream");y(this,"deltaTimeMillis",0);this.printStream=new he(t.typeStore.getType("PrintStream")),this.setBaseClass(t.typeStore.getType("Object")),this.addAttribute(new ce("out",t.typeStore.getType("PrintStream"),i=>{i.value=this.printStream},!0,ee.public,!0,"PrintStream-Objekt, mit dem Text ausgegeben werden kann.")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("currentTimeMillis",new g([]),C,i=>Date.now()+this.deltaTimeMillis,!1,!0,"Gibt die Anzahl der Millisekunden, die seit dem 01.01.1970 00:00:00 UTC vergangen sind, zurück.")),this.addMethod(new m("exit",new g([{identifier:"status",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{var s;let n=(s=t.main.getBottomDiv())==null?void 0:s.console;n!=null&&(n.writeConsoleEntry("Das Programm wurde angehalten mit Statuswert: "+i[1].value,null,"#0000ff"),n.showTab()),t.main.getInterpreter().stop()},!1,!0,"Beendet das Programm und gibt den übergebenen Wert in der Konsole aus."))}}class xA extends ${constructor(e){super("PrintStream",e,"Interne Hilfsklasse, um System.out.println zu ermöglichen. Das Objekt System.out ist von der Klasse PrintStream."),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("print",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{e.main.getInterpreter().printManager.print(t[1].value)},!1,!0,"Gibt den Text aus.")),this.addMethod(new m("println",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{e.main.getInterpreter().printManager.println(t[1].value)},!1,!0,"Gibt den Text aus, gefolgt von einem Zeilensprung.")),this.addMethod(new m("println",new g([]),null,t=>{e.main.getInterpreter().printManager.println("")},!1,!0,"Setzt den Cursor in die nächste Zeile."))}}class SA extends ${constructor(e){super("SystemTools",e,"Klasse mit statischen Methoden für Systemfunktionen, z.B. Löschen der Ausgabe, Registrieren eines Tastaturlisteners usw."),this.setBaseClass(e.typeStore.getType("Object")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("clearScreen",new g([]),null,t=>{e.main.getInterpreter().printManager.clear()},!1,!0,"Löscht den Bildschirm")),this.addMethod(new m("setSpeed",new g([{identifier:"speed",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[1].value;e.main.getInterpreter().controlButtons.speedControl.setSpeedInStepsPerSecond(i>=1?i:"max")},!1,!0,"Setzt die Ausführungsgeschwindigkeit. Der Parameter speed wir in Steps/Sekunde angegeben. Eine negative Zahl bedeutet: 'maximal'.")),this.addMethod(new m("getSpeed",new g([]),C,t=>e.main.getInterpreter().controlButtons.speedControl.getSpeedInStepsPerSecond(),!1,!0,"Gibt die Ausführungsgeschwindigkeit in Steps pro Sekunde zurück.")),this.addMethod(new m("pause",new g([{identifier:"durationInMs",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{},!1,!0,"Pausiert das Programm für die angegebene Zeit in ms.")),this.addMethod(new m("getStepCount",new g([]),C,t=>e.main.getInterpreter().steps,!1,!0,"Gibt die Anzahl der seit dem Start des Programms ausgeführten PCode-Anweisungen aus.")),this.addMethod(new m("addKeyListener",new g([{identifier:"keyListener",type:e.typeStore.getType("KeyListener"),declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[1].value,n=i.class.getMethodBySignature("onKeyTyped(String)");n!=null&&e.main.getInterpreter().keyboardTool.keyPressedCallbacks.push(s=>{let a=n==null?void 0:n.program,l=n==null?void 0:n.invoke,o=[{type:i.class,value:i},{type:F,value:s}];a!=null?e.main.getInterpreter().runTimer(n,o,null,!1):l!=null&&l([])})},!1,!0,"Fügt einen KeyListener hinzu, dessen Methode keyTyped immer dann aufgerufen wird, wenn eine Taste gedrückt und anschließend losgelassen wird."))}}class _A extends Pe{constructor(e){super("KeyListener",e,"Interface mit Methode onKeyTyped. Eine Klasse, die dieses Interface implementiert, kann auf Tastatureingaben reagieren. Ein Objekt dieser Klasse muss zuvor aber mit System.addKeyListener() registriert werden."),this.addMethod(new m("onKeyTyped",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, nachdem eine Taste gedrückt wurde."))}}class kA extends Pe{constructor(e){super("Runnable",e),this.addMethod(new m("run",new g([]),U,null,!1,!1,"Wird vom Timer immer wieder aufgerufen"))}}class TA extends ${constructor(t){super("Timer",t,"Timer Klasse zur periodischen Ausführung von Methoden");y(this,"timerEntries",[]);y(this,"timerRunning",!1);y(this,"timerStarted",!1);this.setBaseClass(t.typeStore.getType("Object")),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("repeat",new g([{identifier:"runnable",type:t.typeStore.getType("Runnable"),declaration:null,usagePositions:null,isFinal:!0},{identifier:"deltaTimeInMs",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[1].value,s=i[2].value,a={timerListener:n,dt:s,lastTimeFired:0,running:!0,method:n.class.getMethod("run",new g([]))};this.timerEntries.push(a)},!1,!0,"Fügt ein neues TimerListener-Objekt hinzu und ruft dessen tick-Methode immer wieder auf."))}startTimer(){this.timerStarted||(this.timerStarted=!0,this.timerRunning=!1,this.processTimerEntries())}stopTimer(){this.timerStarted=!1,this.timerRunning=!1}clearEntries(){this.timerEntries=[],this.timerRunning=!1}processTimerEntries(){var i,n;if(!this.timerStarted)return;if(this.timerEntries.length>0){let s=(n=(i=this.module)==null?void 0:i.main)==null?void 0:n.getInterpreter();if(s!=null){switch(s.state){case Re.done:case Re.error:case Re.not_initialized:this.timerEntries=[],this.timerRunning=!1;break}if(!this.timerRunning&&s.state==Re.running){let a=performance.now();for(let l of this.timerEntries){let o=a-l.lastTimeFired;o>=l.dt&&(this.runEntry(l,s,Math.round(o)),l.lastTimeFired=a)}}}}let t=this;setTimeout(()=>{t.processTimerEntries()},10)}runEntry(t,i,n){let s=[{type:t.timerListener.class,value:t.timerListener}];this.timerRunning=!0;let a=this;i.runTimer(t.method,s,l=>{a.timerRunning=!1},!1)}}class CA extends Pe{constructor(e){super("Map",e,"Interface mit Methoden einer Map (Schlüssel-Wert-Speicher)");let t=e.typeStore.getType("Object"),i=t.clone();i.identifier="K",i.isTypeVariable=!0;let n={identifier:"K",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=t.clone();s.identifier="V",s.isTypeVariable=!0;let a={identifier:"V",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:s};this.typeVariables.push(a),this.addMethod(new m("size",new g([]),C,null,!0,!1,"Gibt die Anzahl der Elemente der Map zurück.")),this.addMethod(new m("isEmpty",new g([]),P,null,!0,!1,"Testet, ob die Map leer ist.")),this.addMethod(new m("containsKey",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Gibt genau dann true zurück, wenn die Map zum Schlüssel key einen Wert enthält.")),this.addMethod(new m("containsValue",new g([{identifier:"value",type:s,declaration:null,usagePositions:null,isFinal:!0}]),P,null,!0,!1,"Gibt genau dann true zurück, wenn die Map den Wert enthält.")),this.addMethod(new m("get",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0}]),s,null,!0,!1,"Gibt den Wert zum Schlüssel key zurück. Gibt null zurück, falls die Map zum Schlüssel key keinen Wert enthält.")),this.addMethod(new m("put",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0},{identifier:"value",type:s,declaration:null,usagePositions:null,isFinal:!0}]),s,null,!0,!1,"Speichert das key-value pair in der Map. Falls zum key vorher schon ein Value gespeichert war, wird dieser zurückgegeben. In der Map wird er dann durch den neuen Value überschrieben. Falls es zum key noch keinen value in der Map gab, wird null zurückgegeben.")),this.addMethod(new m("clear",new g([]),null,null,!0,!1,"Entfernt alle Element aus dieser Map."))}}class AA{constructor(e,t,i){y(this,"keyArray",[]);y(this,"valueArray",[]);y(this,"map",new Map);this.runtimeObject=e,this.interpreter=t,this.module=i}get(e){return this.map.get(e.value)}set(e,t){let i=this.map.get(e.value);return i==null?this.keyArray.push(e):this.valueArray.splice(this.valueArray.indexOf(i),1),this.valueArray.push(t),this.map.set(e.value,t),i}allElementsPrimitive(){for(let e of this.keyArray)if(!(e.type instanceof ut||["String","_Double","Integer","Boolean","Character"].indexOf(e.type.identifier)>=0))return!1;for(let e of this.valueArray)if(!(e.type instanceof ut||["String","_Double","Integer","Boolean","Character"].indexOf(e.type.identifier)>=0))return!1;return!0}to_String(){if(this.allElementsPrimitive()){let a="[";for(let l=0;l<this.keyArray.length;l++)a+=""+this.keyArray[l].value+" => "+this.valueArray[l].value,l<this.keyArray.length-1&&(a+=", ");return a+"]"}let e={line:1,column:1,length:1},t=[{type:f.noOp,position:e,stepFinished:!1},{type:f.pushConstant,dataType:F,value:"[",position:e,stepFinished:!1}],i=new g([]);for(let a=0;a<this.valueArray.length;a++){let l=this.keyArray[a];l.type instanceof ut||l.type instanceof Xa?t.push({type:f.pushConstant,dataType:F,value:l.type.castTo(l,F).value,position:e,stepFinished:!1}):(t.push({type:f.pushConstant,dataType:l.type,value:l.value,stepFinished:!1,position:e}),t.push({type:f.callMethod,method:l.type.getMethod("toString",i),isSuperCall:!1,stackframeBegin:-1,stepFinished:!1,position:e})),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),t.push({type:f.pushConstant,dataType:F,value:" => ",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e});let o=this.valueArray[a];o.value==null||o.type instanceof ut||o.type instanceof Xa?t.push({type:f.pushConstant,dataType:F,value:o.value==null?"null":o.type.castTo(o,F).value,position:e,stepFinished:!1}):(t.push({type:f.pushConstant,dataType:o.type,value:o.value,stepFinished:!1,position:e}),t.push({type:f.callMethod,method:o.type.getMethod("toString",i),isSuperCall:!1,stackframeBegin:-1,stepFinished:!1,position:e})),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),a<this.valueArray.length-1&&(t.push({type:f.pushConstant,dataType:F,value:", ",position:e,stepFinished:!1}),t.push({type:f.binaryOp,leftType:F,operator:f.plus,stepFinished:!1,position:e}))}t.push({type:f.pushConstant,dataType:F,value:"]",position:e,stepFinished:!1}),t.push({type:f.binaryOp,operator:f.plus,leftType:F,stepFinished:!1,position:e}),t.push({type:f.return,copyReturnValueToStackframePos0:!0,leaveThisObjectOnStack:!1,stepFinished:!1,position:e,methodWasInjected:!0});let n={module:this.module,statements:t,labelManager:null},s=new m("toString",new g([]),F,n,!1,!1);return this.interpreter.runTimer(s,[],()=>console.log("List.toString fertig!"),!0),""}size(){return this.valueArray.length}isEmpty(){return this.valueArray.length==0}containsKey(e){return this.map.get(e.value)!=null}containsValue(e){for(let t of this.valueArray)if(t.value==e.value)return!0;return!1}clear(){this.valueArray=[],this.keyArray=[],this.map.clear()}}class MA extends ${constructor(e){super("HashMap",e,"Map-Klasse mit Zugriffszeit proportional zu log(Anzahl der Elemente)");let t=e.typeStore.getType("Object");this.setBaseClass(t);let i=t.clone();i.identifier="K",i.isTypeVariable=!0;let n={identifier:"K",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:i};this.typeVariables.push(n);let s=t.clone();s.identifier="V",s.isTypeVariable=!0;let a={identifier:"V",scopeFrom:{line:1,column:1,length:1},scopeTo:{line:1,column:1,length:1},type:s};this.typeVariables.push(a);let l=e.typeStore.getType("Map").clone();l.typeVariables=[n,a],this.implements.push(l),this.addMethod(new m("HashMap",new g([]),null,o=>{let u=o[0].value,h=new AA(u,e.main.getInterpreter(),e);u.intrinsicData.MapHelper=h},!1,!1,"Instanziert eine neue HashMap",!0)),this.addMethod(new m("put",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0},{identifier:"value",type:s,declaration:null,usagePositions:null,isFinal:!0}]),s,o=>{let u=o[0].value,h=o[1],d=o[2];return u.intrinsicData.MapHelper.set(h,d)},!1,!1,"Speichert das key-value pair in der Map. Falls zum key vorher schon ein Value gespeichert war, wird dieser zurückgegeben. In der Map wird er dann durch den neuen Value überschrieben. Falls es zum key noch keinen value in der Map gab, wird null zurückgegeben.")),this.addMethod(new m("clear",new g([]),null,o=>o[0].value.intrinsicData.MapHelper.clear(),!1,!1,"Entfernt alle Key-Value-Pairs aus dieser HashMap.")),this.addMethod(new m("containsKey",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.MapHelper.containsKey(h)},!1,!1,"Gibt genau dann true zurück, wenn die Map zum Schlüssel key einen Wert enthält.")),this.addMethod(new m("containsValue",new g([{identifier:"value",type:s,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1];return u.intrinsicData.MapHelper.containsValue(h)},!1,!1,"Gibt genau dann true zurück, wenn die Map den Wert enthält.")),this.addMethod(new m("get",new g([{identifier:"key",type:i,declaration:null,usagePositions:null,isFinal:!0}]),s,o=>{let u=o[0].value,h=o[1],p=u.intrinsicData.MapHelper.get(h);return p==null?null:p.value},!1,!1,"Gibt den Wert zum Schlüssel key zurück. Gibt null zurück, falls die Map zum Schlüssel key keinen Wert enthält.")),this.addMethod(new m("isEmpty",new g([]),P,o=>o[0].value.intrinsicData.MapHelper.isEmpty(),!1,!1,"Testet, ob die HashMap leer ist.")),this.addMethod(new m("size",new g([]),C,o=>o[0].value.intrinsicData.MapHelper.size(),!1,!1,"Gibt die Anzahl der key-value-pairs der HashMap zurück.")),this.addMethod(new m("toString",new g([]),F,o=>o[0].value.intrinsicData.MapHelper.to_String(),!1,!1))}}class EA extends ${constructor(e){super("Triangle",e,"Dreieck"),this.setBaseClass(e.typeStore.getType("Polygon")),this.addMethod(new m("Triangle",new g([]),null,t=>{let i=t[0].value,n=new Ai([0,100,100,100,50,0],!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert ein neues Dreieck.",!0)),this.addMethod(new m("Triangle",new g([{identifier:"x1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x2",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y2",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x3",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y3",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=[];for(let a=1;a<=6;a++)n.push(t[a].value);let s=new Ai(n,!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=s},!1,!1,"Instanziert ein neues Dreieck.",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Triangle-Objekts und git sie zurück.",!1))}}class PA extends ${constructor(e){super("LocalDateTime",e,"Ein LocalDate-Objekt speichert einen Zeitpunkt (Datum und Uhrzeit)."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("DayOfWeek"),i=e.typeStore.getType("Month");this.addMethod(new m("LocalDateTime",new g([]),null,n=>{let s=n[0].value;var a=new Date;let l={date:a};s.intrinsicData.ldt=l},!1,!1,"Holt den aktuellen Zeitpunkt von der Systemuhr des Rechners und gibt ihn als LocalDateTime-Objekt zurück.",!0)),this.addMethod(new m("now",new g([]),this,n=>{let s=new he(this);var a=new Date;let l={date:a};return s.intrinsicData.ldt=l,s},!1,!0,"Holt den aktuellen Zeitpunkt von der Systemuhr des Rechners und gibt ihn als LocalDateTime-Objekt zurück.",!1)),this.addMethod(new m("of",new g([{identifier:"year",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"month",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"dayOfMonth",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"hour",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"minute",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"second",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,n=>{let s=new he(this),a=Math.trunc(n[1].value),l=Math.trunc(n[2].value),o=Math.trunc(n[3].value),u=Math.trunc(n[4].value),h=Math.trunc(n[5].value),d=Math.trunc(n[6].value);var p=new Date(a,l-1,o,u,h,d);let v={date:p};return s.intrinsicData.ldt=v,s},!1,!0,"Gibt ein LocalDateTime-Objekt zurück, das den durch year, month (1 - 12), dayOfMonth, hour, minute, second beschriebenen Zeitpunkt repräsentiert.",!1)),this.addMethod(new m("of",new g([{identifier:"year",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"month",type:i,declaration:null,usagePositions:null,isFinal:!0},{identifier:"dayOfMonth",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"hour",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"minute",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"second",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,n=>{let s=new he(this),a=Math.trunc(n[1].value),l=n[2].value,o=Math.trunc(n[3].value),u=Math.trunc(n[4].value),h=Math.trunc(n[5].value),d=Math.trunc(n[6].value);var p=new Date(a,l.enumValue.ordinal,o,u,h,d);let v={date:p};return s.intrinsicData.ldt=v,s},!1,!0,"Gibt ein LocalDateTime-Objekt zurück, das den durch year, month (1 - 12), dayOfMonth, hour, minute, second beschriebenen Zeitpunkt repräsentiert.",!1)),this.addMethod(new m("plusDays",new g([{identifier:"days",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,n=>{let s=n[0].value,a=Math.trunc(n[1].value),l=s.intrinsicData.ldt.date,o=new Date(l.getTime()+a*24*3600*1e3),u=new he(this),h={date:o};return u.intrinsicData.ldt=h,u},!1,!1,"Gibt ein neues LocalDateTime-Objekt zurück, das einen Zeitpunkt repräsentiert, der um die übergebene Anzahl von Tagen später liegt.",!1)),this.addMethod(new m("minusDays",new g([{identifier:"days",type:C,declaration:null,usagePositions:null,isFinal:!0}]),this,n=>{let s=n[0].value,a=Math.trunc(n[1].value),l=s.intrinsicData.ldt.date,o=new Date(l.getTime()-a*24*3600*1e3),u=new he(this),h={date:o};return u.intrinsicData.ldt=h,u},!1,!1,"Gibt ein neues LocalDateTime-Objekt zurück, das einen Zeitpunkt repräsentiert, der um die übergebene Anzahl von Tagen früher liegt.",!1)),this.addMethod(new m("compareTo",new g([{identifier:"date",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.ldt.date.getTime(),o=a.intrinsicData.ldt.date.getTime();return Math.sign(l-o)},!1,!1,"Gibt 1 zurück, falls das Datum größer ist als das übergebene, 0, falls sie gleich sind und -1, falls das Datum kleiner ist als das übergebene.",!1)),this.addMethod(new m("until",new g([{identifier:"date",type:this,declaration:null,usagePositions:null,isFinal:!0}]),C,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.ldt.date.getTime(),o=a.intrinsicData.ldt.date.getTime();return(l-o)/(24*3600)},!1,!1,"Gibt zurück, wie viele Tage (gerundet) zwischen den beiden Zeitpunkten liegen.",!1)),this.addMethod(new m("getYear",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getFullYear(),!1,!1,"Gibt das Jahr zurück.",!1)),this.addMethod(new m("getMonthValue",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getMonth()+1,!1,!1,"Gibt den Monat als Zahl zurück (Januar == 1, Februar == 2, ..., Dezember == 12).",!1)),this.addMethod(new m("getDayOfMonth",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getDate(),!1,!1,"Gibt den Tag innerhalb des Monats zurück (Zahl von 1 bis 31).",!1)),this.addMethod(new m("getHour",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getHours(),!1,!1,"Gibt die Stunde innerhalb des Tages zurück.",!1)),this.addMethod(new m("getMinute",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getMinutes(),!1,!1,"Gibt die Minute zurück.",!1)),this.addMethod(new m("getSecond",new g([]),C,n=>n[0].value.intrinsicData.ldt.date.getSeconds(),!1,!1,"Gibt die Sekunde zurück.",!1)),this.addMethod(new m("toString",new g([]),F,n=>{let a=n[0].value.intrinsicData.ldt.date,l=o=>o<10?"0"+o:""+o;return`${l(a.getDate())}.${l(a.getMonth()+1)}.${l(a.getFullYear())} ${l(a.getHours())}:${l(a.getMinutes())}:${l(a.getSeconds())}`},!1,!1,"Gibt den Wert in der Form 12.03.2007 10:15:30 zurück.",!1)),this.addMethod(new m("getDayOfWeek",new g([]),t,n=>{let a=n[0].value.intrinsicData.ldt.date.getDay();return t.enumInfoList[a-1].object},!1,!1,"Gibt die den Wochentag zurück. Falls Du ihn als Zahl (0 == Montag, ...) benötigst, nutze getDayOfWeek().toOrdinal(). ",!1)),this.addMethod(new m("getMonth",new g([]),i,n=>{let a=n[0].value.intrinsicData.ldt.date.getMonth();return i.enumInfoList[a].object},!1,!1,"Gibt die den Monat zurück. Falls Du ihn als Zahl (1 == Januar, ...) benötigst, nutze getMonthValue()",!1))}}class IA extends $t{constructor(e){super("DayOfWeek",e,[{type:f.pushEnumValue,position:null,identifier:"Montag"},{type:f.pushEnumValue,position:null,identifier:"Dienstag"},{type:f.pushEnumValue,position:null,identifier:"Mittwoch"},{type:f.pushEnumValue,position:null,identifier:"Donnerstag"},{type:f.pushEnumValue,position:null,identifier:"Freitag"},{type:f.pushEnumValue,position:null,identifier:"Samstag"},{type:f.pushEnumValue,position:null,identifier:"Sonntag"}]),this.documentation="Wochentag"}}class DA extends $t{constructor(e){super("Month",e,[{type:f.pushEnumValue,position:null,identifier:"Januar"},{type:f.pushEnumValue,position:null,identifier:"Februar"},{type:f.pushEnumValue,position:null,identifier:"März"},{type:f.pushEnumValue,position:null,identifier:"April"},{type:f.pushEnumValue,position:null,identifier:"Mai"},{type:f.pushEnumValue,position:null,identifier:"Juni"},{type:f.pushEnumValue,position:null,identifier:"Juli"},{type:f.pushEnumValue,position:null,identifier:"August"},{type:f.pushEnumValue,position:null,identifier:"Septemter"},{type:f.pushEnumValue,position:null,identifier:"Oktober"},{type:f.pushEnumValue,position:null,identifier:"November"},{type:f.pushEnumValue,position:null,identifier:"Dezember"}]),this.documentation="Monat"}}class FA extends ${constructor(e){super("Line",e,"Strecke (gerade Linie zwischen zwei Punkten)"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Line",new g([]),null,t=>{let i=t[0].value,n=[0,0,100,100],s=new Ai(n,!1,e.main.getInterpreter(),i);i.intrinsicData.Actor=s},!1,!1,`Instanziert eine Strecke mit Anfangspunkt (0, 0) und Endpunkt (100, 100).
Tipp: Es gibt auch einen Konstruktor, dem man die Koordinaten der Endpunkte übergeben kann.`,!0)),this.addMethod(new m("Line",new g([{identifier:"x1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x2",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y2",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=[n,s,a,l],u=new Ai(o,!1,e.main.getInterpreter(),i);i.intrinsicData.Actor=u},!1,!1,"Instanziert eine Strecke mit Anfangspunkt (x1/y1) und Endpunkt (x2/y2).",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie der Strecke und git sie zurück.",!1)),this.addMethod(new m("setPoint",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=i.intrinsicData.Actor;l.testdestroyed("setPoint")||l.setPoint(n,s,a-1)},!1,!1,"Ändert einen Punkt des Polygons. index == 1 bedeutet: Anfangspunkt; index == 2 bedeutet: Endpunkt",!1)),this.addMethod(new m("setPoints",new g([{identifier:"x1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x2",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y2",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=i.intrinsicData.Actor;o.testdestroyed("setPoints")||o.setPoints([n,s,a,l])},!1,!1,"Ändert die Punkte der Strecke. (x1/y1) ist der neue Anfangspunkt, (x2/y2) ist der neue Endpunkt.",!1))}}class RA extends ${constructor(e){super("Vector2",e,"Repräsentiert einen zweidimensionalen Vektor"),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("x",A,null,!1,ee.public,!1,"x-Komponente des Vektors")),this.addAttribute(new ce("y",A,null,!1,ee.public,!1,"y-Komponente des Vektors")),this.setupAttributeIndicesRecursive();let t=this.attributeMap.get("x").index,i=this.attributeMap.get("y").index;this.addMethod(new m("Vector2",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value;s.attributes[t]={type:A,value:a},s.attributes[i]={type:A,value:l}},!1,!1,"Instanziert einen neuen zweidimensionalen Vektor mit den Komponenten x und y.",!0)),this.addMethod(new m("fromPolarCoordinates",new g([{identifier:"r",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"alphaDeg",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=new he(this),a=n[1].value,l=n[2].value;return l*=Math.PI/180,s.attributes[t]={type:A,value:Math.cos(l)*a},s.attributes[i]={type:A,value:Math.sin(l)*a},s},!1,!0,"Gibt einen neuen zweidimensionalen Vektor zurück, der mit den Polarkoordinaten (r/alphaDeg) gebildet wird. Datei ist r (Abstand zum Ursprung des Koordinatensystems) und alphaDeg (Winkel zur positiven x-Achse in Grad).",!1)),this.addMethod(new m("toString",new g([]),F,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value;return`(${a}/${l})`},!1,!1,'Gibt den Vektor als Zeichenkette in der Form "(x/y)" zurück.',!1)),this.addMethod(new m("getAngleDeg",new g([]),A,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=Math.atan2(l,a)/Math.PI*180;return o>=0?o:360+o},!1,!1,"Gibt den zur positiven x-Achse in Grad zurück.",!1)),this.addMethod(new m("getAngleRad",new g([]),A,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=Math.atan2(l,a);return o>=0?o:Math.PI*2+o},!1,!1,"Gibt den zur positiven x-Achse im Bogenmaß zurück.",!1)),this.addMethod(new m("getLength",new g([]),A,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value;return Math.sqrt(a*a+l*l)},!1,!1,"Gibt die Länge des Vectors zurück.",!1)),this.addMethod(new m("toUnitVector",new g([]),this,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=new he(this),u=Math.sqrt(a*a+l*l);return Math.abs(u)>1e-11?(a/=u,l/=u):(a=0,l=0),o.attributes[t]={type:A,value:a},o.attributes[i]={type:A,value:l},o},!1,!1,"Gibt den zum Vektor zugehörigen Einheitsvektor (d.h. den Vektor mit derselben Richtung, aber der Länge 1) zurück.",!1)),this.addMethod(new m("setLength",new g([{identifier:"length",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=n[1].value,u=Math.sqrt(a*a+l*l);u>0&&(s.attributes[t].value=a/u*o,s.attributes[i].value=l/u*o)},!1,!1,"Ändert den Vektor so, dass er seine Richtung beibehält, aber auf die angegebene Länge gestreckt/gestaucht wird.",!1)),this.addMethod(new m("plus",new g([{identifier:"vector",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=n[0].value,a=n[1].value,l=s.attributes[t].value,o=s.attributes[i].value,u=a.attributes[t].value,h=a.attributes[i].value,d=new he(this);return d.attributes[t]={type:A,value:l+u},d.attributes[i]={type:A,value:o+h},d},!1,!1,"Gibt die Summe zurück, die sich aus Addition dieses Vektor mit dem übergebenen Vektor ergibt. WICHTIG: Diese Methode ändert das Objekt nicht, für das sie aufgerufen wurde!",!1)),this.addMethod(new m("minus",new g([{identifier:"vector",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=n[0].value,a=n[1].value,l=s.attributes[t].value,o=s.attributes[i].value,u=a.attributes[t].value,h=a.attributes[i].value,d=new he(this);return d.attributes[t]={type:A,value:l-u},d.attributes[i]={type:A,value:o-h},d},!1,!1,"Gibt die Differenz zurück, die sich aus Subtraktion des übergebenen Vektors von diesem Vektor ergibt. WICHTIG: Diese Methode ändert das Objekt nicht, für das sie aufgerufen wurde!",!1)),this.addMethod(new m("scalarProduct",new g([{identifier:"vector1",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"vector2",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),A,n=>{let s=n[1].value,a=n[2].value,l=s.attributes[t].value,o=s.attributes[i].value,u=a.attributes[t].value,h=a.attributes[i].value;return l*u+o*h},!1,!0,"Gibt das Skalarprodukt der beiden Vektoren zurück.",!1)),this.addMethod(new m("scaledBy",new g([{identifier:"scalar",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=n[1].value,u=new he(this);return u.attributes[t]={type:A,value:a*o},u.attributes[i]={type:A,value:l*o},u},!1,!1,"Gibt das Produkt zurück, das sich aus Multiplikation dieses Vektor mit dem übergebenen Skalar ergibt. WICHTIG: Diese Methode ändert das Objekt nicht, für das sie aufgerufen wurde!",!1)),this.addMethod(new m("rotatedBy",new g([{identifier:"angleDeg",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,n=>{let s=n[0].value,a=s.attributes[t].value,l=s.attributes[i].value,o=-n[1].value*Math.PI/180,u=Math.sin(o),h=Math.cos(o),d=new he(this);return d.attributes[t]={type:A,value:a*h-l*u},d.attributes[i]={type:A,value:a*u+l*h},d},!1,!1,"Gibt den um den übergebenen Winkel (in Grad) rotierten Vektor zurück. Positiver Winkel => Rotation GEGEN DEN Uhrzeigersinn. WICHTIG: Diese Methode ändert das Objekt nicht, für das sie aufgerufen wurde!",!1)),this.addMethod(new m("distance",new g([{identifier:"x1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y1",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x2",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y2",type:A,declaration:null,usagePositions:null,isFinal:!0}]),A,n=>{let s=n[1].value,a=n[2].value,l=n[3].value,o=n[4].value,u=l-s,h=o-a;return Math.sqrt(u*u+h*h)},!1,!0,"Berechnet den Abstand der Punkte (x1/y1) und (x2/y2)."))}}class OA extends Pe{constructor(e){super("MouseListener",e,"Interface mit Methoden, die aufgerufen werden, wenn Maus-Ereignisse eintreten. Ein Objekt dieser Klasse muss zuvor aber mit world.addMouseListener() registriert werden, wobei world das aktuelle World-Objekt ist."),this.addMethod(new m("onMouseUp",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"button",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Maustaste über dem Grafikbereich losgelassen wird.")),this.addMethod(new m("onMouseDown",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"button",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Maustaste über dem Grafikbereich gedrückt wird.")),this.addMethod(new m("onMouseMove",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn der Mauszeiger über dem Grafikbereich bewegt wird.")),this.addMethod(new m("onMouseEnter",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn der Mauszeiger in den Grafikbereich hineinbewegt wird.")),this.addMethod(new m("onMouseLeave",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn der Mauszeiger aus dem Grafikbereich herausbewegt wird."))}}class LA extends ${constructor(e){super("MouseAdapter",e,"Klasse mit leeren Methoden, die aufgerufen werden, wenn Maus-Ereignisse eintreten. Ein Objekt einer Kindklasse dieser Klasse muss zuvor aber mit world.addMouseListener() registriert werden, wobei world das aktuelle World-Objekt ist.");let t=e.typeStore.getType("MouseListener");this.implements.push(t),this.addMethod(new m("onMouseUp",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"button",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn eine Maustaste über dem Grafikbereich losgelassen wird.")),this.addMethod(new m("onMouseDown",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"button",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn eine Maustaste über dem Grafikbereich gedrückt wird.")),this.addMethod(new m("onMouseMove",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn der Mauszeiger über dem Grafikbereich bewegt wird.")),this.addMethod(new m("onMouseEnter",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn der Mauszeiger in den Grafikbereich hineinbewegt wird.")),this.addMethod(new m("onMouseLeave",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn der Mauszeiger aus dem Grafikbereich herausbewegt wird."))}}class BA extends ${constructor(e){super("WebSocketClient",e,"Ein Objekt der Klasse WebSocketClient repräsentiert einen anderen Rechner, mit dem dieser Rechner über den WebSocket in Kontakt steht.");let t=e.typeStore.getType("Object");this.setBaseClass(t),this.addMethod(new m("send",new g([{identifier:"message",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"messageType",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value,o=n[2].value;a.send(l,o)},!1,!1,"Sendet Daten (message) an diesen Client. Den messageType kannst Du frei wählen. Die client bekommt ihn zusammen mit den Daten übermittelt. Tipp: Du kannst auch Objekte senden, musst sie dazu aber vorher serialisieren, d.h. mithilfe der Methode toJson in eine Zeichenkette verwandeln.",!1)),this.addMethod(new m("setUserData",new g([{identifier:"schlüssel",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"wert",type:t,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value,o=n[2].value;a.setUserData(l,o)},!1,!1,"Mit dieser Methode kannst Du beliebige Objektreferenzen in diesem WebSocketClient-Objekt speichern. Den Schlüssel kannst Du dabei frei wählen und später nutzen, um den Wert durch die Methode getUserData wieder zu holen.",!1)),this.addMethod(new m("getUserData",new g([{identifier:"schlüssel",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value;return a.getUserData(l)},!1,!1,'Mit dieser Methode kannst Du eine Objektreferenz erhalten, die Du zuvor mit der Methode setUserData gespeichert hast. Bemerkung1: Diese Methode entfernt die Objekreferenz nicht aus dem WebSocketClient-Objekt. Bemerkung2: Damit Du alle Methoden des erhaltenen Objekts aufrufen kannst, musst Du dem Computer mitteilen, von welcher Klasse es ist ("casten"). Das geht für die Klasse MeineNutzerDaten bspw. so: MeineNutzerDaten mnd = (MeineNutzerDaten)client.getUserData("schlüssel");',!1));let i=[{att:"rufname",getter:"getFirstName",help:"Rufnamen"},{att:"familienname",getter:"getLastName",help:"Familiennamen"},{att:"username",getter:"getUsername",help:"Benutzernamen"},{att:"nickname",getter:"getNickname",help:"Spielernamen"}];for(let n of i)this.addMethod(new m(n.getter,new g([]),F,s=>s[0].value.intrinsicData.Helper[n.att],!1,!1,"Gibt den "+n.help+" des Clients zurück.",!1));this.addMethod(new m("getNumber",new g([]),C,n=>n[0].value.intrinsicData.Helper.index,!1,!1,'Gehört ein Client zu einer mit findClient bzw. findClients gefundenen Gruppe, so erhältst Du mit dieser Methode die "Rangfolge" dieses Clients in dieser Gruppe. Allen Clients wird dieselbe Rangfolgeordnung vom Server mitgeteilt. So lässt sich bspw. einfach festlegen, welcher Client eine besondere Rolle (Server) in der Gruppe erhalten soll (z.B. Client mit Nummer 1). Bemerkung: Die Nummer ist eine Zahl zwischen 1 und der Anzahl der Clients in der Gruppe.',!1)),this.addMethod(new m("getIndex",new g([]),C,n=>n[0].value.intrinsicData.Helper.index,!1,!1,"Diese Methode ist veraltet. Bitte benutze stattdessen getNumber.",!1))}}class zA{constructor(e,t,i,n,s,a,l){y(this,"keyValueStore",{});y(this,"index",0);y(this,"connected",!0);this.runtimeObject=e,this.webSocketHelper=t,this.id=i,this.rufname=n,this.familienname=s,this.username=a,this.nickname=l}send(e,t){this.webSocketHelper.sendToClient(this.id,e,t)}getUserData(e){return this.keyValueStore[e]}setUserData(e,t){this.keyValueStore[e]=t}}class jA extends ${constructor(e){super("WebSocket",e,"Ein Objekt der Klasse WebSocket kann Daten über das Internet senden und empfangen. Um die Klasse benutzen zu können, musst Du eine eigene Klasse schreiben, die die Klasse WebSocket erweitert und die Methoden onConnect, onMessage, onOtherClientConnected und onOtherClientDisconnected überschreibt."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("WebSocketClient"),i=e.typeStore.getType("System");this.addMethod(new m("WebSocket",new g([]),null,n=>{var o,u;let s=n[0].value,a=(u=(o=this.module)==null?void 0:o.main)==null?void 0:u.getInterpreter(),l=new NA(s,a,t,i);s.intrinsicData.Helper=l},!1,!1,"Instanziert ein neues WebSocket-Objekt.",!0)),this.addMethod(new m("open",new g([{identifier:"sessionCode",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"nickName",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=s.intrinsicData.Helper;o.connect(a,l),s.intrinsicData.Helper=o},!1,!1,"Startet die Verbindung mit dem Server. Den SessionCode kannst Du frei wählen. Mit allen anderen Clients, die eine Verbindung mit demselben SessionCode aufbauen, kannst Du anschließend Daten austauschen. Auch der Nickname ist frei wählbar. Er ist für alle anderen Clients sichtbar.",!1)),this.addMethod(new m("sendToAll",new g([{identifier:"message",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"messageType",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value,o=n[2].value;a.sendToAll(l,o)},!1,!1,"Sendet Daten (message) an alle anderen Clients. Den messageType kannst Du frei wählen. Die empfangenden Clients bekommen ihn zusammen mit den Daten übermittelt. Tipp: Du kannst auch Objekte senden, musst sie dazu aber vorher serialisieren, d.h. mithilfe der Methode toJson in eine Zeichenkette verwandeln.",!1)),this.addMethod(new m("findClients",new g([{identifier:"count",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value;a.findClientsFromCount(l)},!1,!1,'Sucht die übergebene Anzahl von "kontaktbereiten" Clients, d.h. solchen Clients, die exakt dieselbe Suchanfrage abgegeben haben. Findet der Server die Clients, so ruft er bei allen beteiligten Clients onClientsFound auf.',!1)),this.addMethod(new m("findClients",new g([{identifier:"nicknames",type:new ze(F),declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,o=n[1].value.map(u=>u.value);a.findClientsFromNicknames(o)},!1,!1,"Sucht die Clients mit den angegebenen Nicknames. Haben sie eine entsprechende Suchanfrage (d.h. dieselben Nicknames) abgegeben, so so ruft der Server bei allen beteiligten Clients onClientsFound auf.",!1)),this.addMethod(new m("findClient",new g([{identifier:"nickname",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Helper,l=n[1].value;a.findClientsFromNicknames([l])},!1,!1,"Sucht den Client mit dem angegebenen Nickname. Hat er eine entsprechende Suchanfrage (d.h. mit dem Nickname DIESES clients) abgegeben, so so ruft der Server bei beiden Clients onClientsFound auf.",!1)),this.addMethod(new m("close",new g([]),U,n=>{n[0].value.intrinsicData.Helper.disconnect()},!1,!1,"Beendet die Verbindung. Bei allen anderen Clients, die sich mit derselben sessionId verbunden haben, wird daraufhin die Methode onOtherClientDisconnected aufgerufen.",!1)),this.addMethod(new m("onOpen",new g([]),null,null,!1,!1,"Wird aufgerufen, sobald die Verbindung mit dem Server zustandegekommen ist.",!1)),this.addMethod(new m("onClose",new g([]),null,null,!1,!1,"Wird aufgerufen, nachdem die Verbindung geschlossen wurde.",!1)),this.addMethod(new m("onMessage",new g([{identifier:"sender",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"message",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"messageType",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!1,!1,"Wird immer dann aufgerufen, wenn eine Nachricht eines anderen Clients empfangen wurde.",!1)),this.addMethod(new m("onOtherClientConnected",new g([{identifier:"otherClient",type:t,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!1,!1,"Wird immer dann aufgerufen, wenn sich ein anderer Client unter Nutzung desselben sessionCodes mit dem Server verbunden hat.",!1)),this.addMethod(new m("onOtherClientDisconnected",new g([{identifier:"otherClient",type:t,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!1,!1,"Wird immer dann aufgerufen, wenn ein anderer Client unter Nutzung desselben sessionCodes die Verbindung mit dem Server beendet hat.",!1)),this.addMethod(new m("onClientsFound",new g([{identifier:"oherClients",type:new ze(t),declaration:null,usagePositions:null,isFinal:!0},{identifier:"ownNumber",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,null,!1,!1,"Wird aufgerufen, wenn die durch die Methoden findClient bzw. findClients zuvor gesuchten Clients gefunden wurden.",!1)),this.addMethod(new m("getOtherClients",new g([]),new ze(t),n=>n[0].value.intrinsicData.Helper.clientList.map(o=>({type:t,value:o.runtimeObject})),!1,!1,"Gibt alle bisher bei der selben Session angemeldeten Clients zurück.",!1))}}class NA{constructor(e,t,i,n){y(this,"onOpenMethod");y(this,"onCloseMethod");y(this,"onMessageMethod");y(this,"onClientConnectedMethod");y(this,"onClientDisconnectedMethod");y(this,"onClientsFoundMethod");y(this,"clientList",[]);y(this,"idToClientMap",{});y(this,"connection");y(this,"client_id");y(this,"isOpen",!1);y(this,"unsentMessages",[]);this.runtimeObject=e,this.interpreter=t,this.webSocketClientType=i,this.systemClassType=n;let s=e.class;this.onOpenMethod=s.methods.find(a=>a.signature=="onOpen()"),this.onCloseMethod=s.methods.find(a=>a.signature=="onClose()"),this.onMessageMethod=s.methods.find(a=>a.signature=="onMessage(WebSocketClient, String, String)"),this.onClientConnectedMethod=s.methods.find(a=>a.signature=="onOtherClientConnected(WebSocketClient)"),this.onClientDisconnectedMethod=s.methods.find(a=>a.signature=="onOtherClientDisconnected(WebSocketClient)"),this.onClientsFoundMethod=s.methods.find(a=>a.signature=="onClientsFound(WebSocketClient[], int)")}connect(e,t){if(this.interpreter.main.isEmbedded()){this.interpreter.throwException("Die Netzwerkfunktionalitäten stehen nur eingeloggten Nutzern in der Entwicklungsumgebung zur Verfügung und können daher leider hier nicht ausprobiert werden.");return}Nt("getWebSocketToken",{},i=>{let n=(window.location.protocol.startsWith("https")?"wss://":"ws://")+window.location.host+"/servlet/websocket";this.connection=new WebSocket(n),this.connection.onerror=s=>{this.onError(s)},this.connection.onclose=s=>{this.onClose(s)},this.connection.onmessage=s=>{this.onMessage(s)},this.connection.onopen=s=>{let a={command:1,token:i.token,nickname:t,sessionCode:e};this.interpreter.webSocketsToCloseAfterProgramHalt.push(this.connection),this.isOpen=!0,this.sendIntern(JSON.stringify(a)),this.onOpen()}})}sendIntern(e){if(!this.isOpen)this.unsentMessages.push(e);else try{this.connection.send(e)}catch(t){console.log(t)}}onClose(e){this.isOpen=!1,this.runMethod(this.onCloseMethod,[])}sendToClient(e,t,i){let n={command:3,data:t,dataType:i,recipient_id:e};this.sendIntern(JSON.stringify(n))}sendToAll(e,t){let i={command:2,data:e,dataType:t};this.sendIntern(JSON.stringify(i))}disconnect(){let e={command:4};this.sendIntern(JSON.stringify(e)),this.connection.close();let t=this.interpreter.webSocketsToCloseAfterProgramHalt;t.splice(t.indexOf(this.connection),1)}onMessage(e){let t=JSON.parse(e.data);if(t.command!=null)switch(t.command){case 1:let i=new he(this.webSocketClientType),n=new zA(i,this,t.user_id,t.rufname,t.familienname,t.username,t.nickname);i.intrinsicData.Helper=n,this.clientList.push(n),this.idToClientMap[t.user_id]=n,this.runMethod(this.onClientConnectedMethod,[{type:this.webSocketClientType,value:i}]);break;case 2:let s=this.idToClientMap[t.from_client_id];if(s==null)return;this.runMethod(this.onMessageMethod,[{type:this.webSocketClientType,value:s.runtimeObject},{type:F,value:t.data},{type:F,value:t.dataType}]);break;case 3:let a=this.idToClientMap[t.disconnecting_client_id];if(a==null)return;this.clientList.splice(this.clientList.indexOf(a),1),this.idToClientMap[t.disconnecting_client_id]=void 0,this.runMethod(this.onClientDisconnectedMethod,[{type:this.webSocketClientType,value:a.runtimeObject}]);break;case 4:this.systemClassType.deltaTimeMillis=t.currentTimeMills-Date.now(),this.client_id=t.client_id;break;case 5:break;case 6:this.onClientsFound(t);break}}onClientsFound(e){let t=0,i=[];for(let s of e.clients)if(s.id==this.client_id)t=s.index;else{let a=this.idToClientMap[s.id];a!=null&&(a.index=s.index,i.push({type:this.webSocketClientType,value:a.runtimeObject}))}let n={type:new ze(this.webSocketClientType),value:i};this.runMethod(this.onClientsFoundMethod,[n,{type:C,value:t}])}onError(e){this.interpreter.throwException("Kommunikationsfehler beim WebSocket")}onOpen(){this.isOpen=!0,this.unsentMessages.length>0&&(this.unsentMessages.forEach(e=>this.sendIntern(e)),this.unsentMessages=[]),this.runMethod(this.onOpenMethod,[])}runMethod(e,t){e!=null&&(t.splice(0,0,{type:this.runtimeObject.class,value:this.runtimeObject}),this.interpreter.state==Re.waitingForInput||this.interpreter.state==Re.waitingForDB?this.interpreter.executeImmediatelyInNewStackframe(e.program,t):this.interpreter.runTimer(e,t,()=>{},!1))}findClientsFromCount(e){let t={command:6,count:e,nicknames:[]};this.sendIntern(JSON.stringify(t))}findClientsFromNicknames(e){let t={command:6,count:e.length,nicknames:e};this.sendIntern(JSON.stringify(t))}}class GA extends ${constructor(e){super("PApplet",e,"Processing-Applet"),this.module=e,this.setBaseClass(e.typeStore.getType("Object")),this.documentation="Wenn Du Deine Klasse von PApplet ableitest (class Test extends PApplet{...}), kannst Du auf diese Weise ein Processing-Applet erstellen (siehe https://processing.org), indem Du ihre Methoden draw(), mousePressed(), usw. überschreibst und mit Inhalt füllst. Du startest das Applet, indem Du ein Objekt Deiner Klasse instanzierst und davon die main-Methode aufrufst: new Test().main();",[["mouseX","aktuelle x-Koordinate des Mauszeigers"],["mouseY","aktuelle y-Koordinate des Mauszeigers"],["pMouseX","x-Koordinate des Mauszeigers im vorhergehenden Frame"],["pMouseY","y-Koordinate des Mauszeigers im vorhergehenden Frame"],["LEFT","links"],["CENTER","Mitte"],["RIGHT","rechts"],["TOP","obenbündig"],["BASELINE","bündig auf der Grundlinie"],["BOTTOM","untenbündig"],["width","Breite des Zeichenbereichs"],["height","Höhe des Zeichenbereichs"],["keyCode","Zahlencode der zuletzt gedrückten Taste"],["mouseButton","zuletzt gedrückte Maustaste, kann die Werte LEFT, RIGHT und CENTER annehmen"],["CORNER","Mode zum Zeichnen von Rechtecken"],["CORNERS","Mode zum Zeichnen von Rechtecken"],["RADIUS","Mode zum Zeichnen von Rechtecken"],["POINTS","zeichne nachfolgend Einzelpunkte"],["LINES","zeichne nachfolgend einzelne Linien"],["TRIANGLES","zeichne nachfolgend einzelne Dreiecke"],["TRIANGLE_STRIP","zeichne nachfolgend einen Triangle-Strip"],["TRIANGLE_FAN","zeichne nachfolgend einen Triangle-Fan"],["QUADS","zeichne nachfolgend Vierecke"],["QUAD_STRIP","zeichne nachfolgend einen Quad-Strip"],["TESS","zeichne nachfolgend ein TESS - geht nur bei createCanvas(width, height, WEBGL)"],["CLOSE","endShape(CLOSE) schließt den Linienzug"],["DEGREES","angleMode(DEGREES) sorgt dafür, dass nachfolgende Winkelangaben in Grad interpretiert werden."],["RADIANS","angleMode(RADIANS) sorgt dafür, dass nachfolgende Winkelangaben im Bogenmaß interpretiert werden."]].forEach(n=>{this.addAttribute(new ce(n[0],C,s=>{s.value=e.main.getInterpreter().processingHelper.p5o[n[0]]},!1,ee.public,!0,n[1]))}),[["WEBGL","WebGL-Renderer zur 3D-Ausgabe"],["P2D","Renderer zur zweidimensionalen Ausgabe"],["RGB","Color-Mode RGB (rot, grün, blau)"],["HSL","Color-Mode HSL"],["HSB","Color-Mode HSB"]].forEach(n=>{this.addAttribute(new ce(n[0],F,s=>{s.value=e.main.getInterpreter().processingHelper.p5o[n[0]]},!1,ee.public,!0,n[1]))}),this.addAttribute(new ce("key",Ge,n=>{n.value=e.main.getInterpreter().processingHelper.p5o.key},!1,ee.public,!0,"letzte gedrückte Taste")),this.addMethod(new m("PApplet",new g([]),null,n=>{let s=n[0].value,a=this.getProcessingHelper(s);s.intrinsicData.Processing=a},!1,!1,"Legt eine neues Processing-Applet an",!0)),this.addMethod(new m("main",new g([{identifier:"name",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Processing,l=e.main.getInterpreter();l.currentProgramPosition++,a.main(),l.currentProgramPosition--},!1,!1,"Startet das Processing-Applet.",!1)),this.addMethod(new m("main",new g([]),null,n=>{let a=n[0].value.intrinsicData.Processing,l=e.main.getInterpreter();l.currentProgramPosition++,a.main(),l.currentProgramPosition--},!1,!1,"Startet das Processing-Applet.",!1)),this.addMethod(new m("loop",new g([]),null,n=>{n[0].value.intrinsicData.Processing.loop()},!1,!1,"Startet nach noLoop() die Renderer-Loop wieder neu, so dass draw() wieder periodisch aufgerufen wird.",!1)),this.addMethod(new m("noLoop",new g([]),null,n=>{n[0].value.intrinsicData.Processing.noLoop()},!1,!1,"Stoppt die Render-Loop, so dass draw() nicht mehr aufgerufen wird. Kann mit loop() wieder gestartet werden.",!1)),this.addMethod(new m("size",new g([{identifier:"width",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Processing,l=n[1].value,o=n[2].value;a.createCanvas(l,o)},!1,!1,"Definiert die Abmessungen des Processing-Ausgabebereichs in Pixeln.",!1)),this.addMethod(new m("createCanvas",new g([{identifier:"width",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Processing,l=n[1].value,o=n[2].value;a.createCanvas(l,o)},!1,!1,"Definiert die Abmessungen des Processing-Ausgabebereichs in Pixeln.",!1)),this.addMethod(new m("createCanvas",new g([{identifier:"width",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"height",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"renderer",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[0].value.intrinsicData.Processing,l=n[1].value,o=n[2].value,u=n[3].value;a.renderer=u,a.createCanvas(l,o)},!1,!1,"Definiert die Abmessungen des Processing-Ausgabebereichs in Pixeln.",!1)),this.addMethod(new m("draw",new g([]),U,null,!1,!1,'Die draw-Methode wird 60-mal pro Sekunde aufgerufen ("Render-Loop"). Die Render-Loop kann mit der Methode noLoop() gestoppt und mit loop() wieder gestartet werden. redraw() ruft (im gestoppten Zustand) draw genau ein Mal auf.',!1)),this.addMethod(new m("settings",new g([]),U,null,!1,!1,"Die settings-Methode wird aufgerufen, nachdem das Processing-Applet durch Aufruf der Methode main gestartet wurde. Im Unterschied zur Original Java-Version von Processing hat die Methode settings hier keine andere Bewandtnis als die - unmittelbar darauf aufgerufene - Methode setup. In beiden Methoden kann man bspw. mit createCanvas(width, height) das Koordinatensystem einrichten und Figuren zeichnen.",!1)),this.addMethod(new m("setup",new g([]),U,null,!1,!1,"Die setup-Methode wird beim Programmstart nach der settings-Methode aufgerufen. Im Unterschied zur Original Java-Version von Processing hat die Methode setup hier keine andere Bewandtnis als die - unmittelbar davor aufgerufene - Methode settings. In beiden Methoden kann man bspw. mit createCanvas(width, height) das Koordinatensystem einrichten und Figuren zeichnen.",!1)),this.addMethod(new m("mousePressed",new g([]),U,null,!1,!1,"Die mousePressed-Methode wird immer dann aufgerufen, wenn gerade eine Maustaste heruntergedrückt wurde. Die aktuellen Koordinaten des Mauszeigers liegen in den Attributen mouseX und mouseY vor, die gerade heruntergedrückte Maustaste kann dem Attribut mouseButton entnommen werden.",!1)),this.addMethod(new m("mouseReleased",new g([]),U,null,!1,!1,"Die mouseReleased-Methode wird immer dann aufgerufen, wenn gerade eine Maustaste losgelassen wurde. Die aktuellen Koordinaten des Mauszeigers liegen in den Attributen mouseX und mouseY vor, die gerade losgelassene Maustaste kann dem Attribut mouseButton entnommen werden.",!1)),this.addMethod(new m("mouseClicked",new g([]),U,null,!1,!1,"Die mouseClicked-Methode wird immer dann aufgerufen, wenn eine Maustaste auf dem Zeichenbereich gedrückt und anschließend losgelassen wurde. Die aktuellen Koordinaten des Mauszeigers liegen in den Attributen mouseX und mouseY vor, die gerade losgelassene Maustaste kann dem Attribut mouseButton entnommen werden.",!1)),this.addMethod(new m("mouseDragged",new g([]),U,null,!1,!1,"Die mouseDragged-Methode wird immer dann aufgerufen, wenn eine Maustaste gerade heruntergedrückt ist und die Position des Mauszeigers sich verändert hat. Die aktuellen Koordinaten des Mauszeigers liegen in den Attributen mouseX und mouseY vor, die zuletzt gedrückte Maustaste kann dem Attribut mouseButton entnommen werden.",!1)),this.addMethod(new m("mouseMoved",new g([]),U,null,!1,!1,"Die mouseMoved-Methode wird immer dann aufgerufen, wenn die Position des Mauszeigers sich verändert hat. Die aktuellen Koordinaten des Mauszeigers liegen in den Attributen mouseX und mouseY vor, die zuletzt gedrückte Maustaste kann dem Attribut mouseButton entnommen werden.",!1)),this.addMethod(new m("mouseEntered",new g([]),U,null,!1,!1,"Die mouseEntered-Methode wird immer dann aufgerufen, wenn der Mauszeiger von außen neu in den Zeichenbereich hineinfährt.",!1)),this.addMethod(new m("mouseExited",new g([]),U,null,!1,!1,"Die mouseExited-Methode wird immer dann aufgerufen, wenn der Mauszeiger den Zeichnbereich gerade verlassen hat.",!1)),this.addMethod(new m("keyPressed",new g([]),U,null,!1,!1,"Die keyPressed-Methode wird immer dann aufgerufen, wenn eine Taste gerade heruntergedrückt wurde. Informationen zur Taste können den Attributen key (String) und keyCode (int) entnommen werden.",!1)),this.addMethod(new m("keyReleased",new g([]),U,null,!1,!1,"Die keyReleased-Methode wird immer dann aufgerufen, wenn eine Taste gerade losgelassen wurde. Informationen zur Taste können den Attributen key (String) und keyCode (int) entnommen werden.",!1)),this.addProcessingMethod("clear",[],[],"Löscht die Zeichenfläche."),this.addProcessingMethod("background",["rgb"],G,"Übermalt die komplette Zeichenfläche mit der übergebenen Farbe."),this.addProcessingMethod("background",["colorAsString"],F,"Übermalt die komplette Zeichenfläche mit der übergebenen Farbe. Übergeben wird eine Zeichenkette der Form 'rgb(0,0,255)' oder 'rgb(0%, 0%, 100%)' oder 'rgba(0, 0, 255, 1)' oder 'rgba(0%, 0%, 100%, 1)' und all diese Kombinationen statt rgb auch mit hsl und hsb.",F),this.addProcessingMethod("background",["v1","v2","v3"],G,"Übermalt die komplette Zeichenfläche mit der übergebenen Farbe. v1, v2 und v3 sind - abhängig vom aktuellen color mode - rot, grün und blauwert oder Farbe, Sättigung und Helligkeit"),this.addProcessingMethod("fill",["rgb"],C,"Setzt die Füllfarbe."),this.addProcessingMethod("fill",["rgb"],F,"Setzt die Füllfarbe."),this.addProcessingMethod("fill",["rgb","alpha"],[C,G],"Setzt die Füllfarbe."),this.addProcessingMethod("fill",["gray"],G,"Setzt die Füllfarbe."),this.addProcessingMethod("fill",["v1","v2","v3"],G,"Setzt die Füllfarbe. v1, v2 und v3 sind - abhängig vom aktuellen color mode - rot, grün und blauwert oder Farbe, Sättigung und Helligkeit"),this.addProcessingMethod("fill",["v1","v2","v3","alpha"],G,"Setzt die Füllfarbe. v1, v2 und v3 sind - abhängig vom aktuellen color mode - rot, grün und blauwert oder Farbe, Sättigung und Helligkeit"),this.addProcessingMethod("noFill",[],[],"Die nachfolgend gezeichneten Figuren werden nicht gefüllt."),this.addProcessingMethod("stroke",["rgb"],C,"Setzt die Linienfarbe."),this.addProcessingMethod("stroke",["rgb"],F,"Setzt die Linienfarbe."),this.addProcessingMethod("stroke",["rgb","alpha"],[C,G],"Setzt die Linienfarbe."),this.addProcessingMethod("stroke",["gray"],G,"Setzt die Linienfarbe."),this.addProcessingMethod("stroke",["v1","v2","v3"],G,"Setzt die Linienfarbe. v1, v2 und v3 sind - abhängig vom aktuellen color mode - rot, grün und blauwert oder Farbe, Sättigung und Helligkeit"),this.addProcessingMethod("stroke",["v1","v2","v3","alpha"],G,"Setzt die Linienfarbe. v1, v2 und v3 sind - abhängig vom aktuellen color mode - rot, grün und blauwert oder Farbe, Sättigung und Helligkeit"),this.addProcessingMethod("strokeWeight",["weight"],G,"Setzt die Linienbreite."),this.addProcessingMethod("noStroke",[],[],"Die nachfolgend gezeichneten Figuren werden ohne Rand gezeichnet."),this.addProcessingMethod("color",["gray"],G,"Gibt den Grauton als String-kodierte Farbe zurück.",F),this.addProcessingMethod("color",["colorAsString"],F,"Gibt die Farbe zurück. Übergeben kann eine Zeichenkette der Form 'rgb(0,0,255)' oder 'rgb(0%, 0%, 100%)' oder 'rgba(0, 0, 255, 1)' oder 'rgba(0%, 0%, 100%, 1)' und all diese Kombinationen statt rgb auch mit hsl und hsb.",F),this.addProcessingMethod("color",["gray","alpha"],G,"Gibt den Grauton als String-kodierte Farbe zurück.",F),this.addProcessingMethod("color",["v1","v2","v3"],G,"Gibt die aus v1, v2, v3 gebildete Farbe String-kodiert zurück.",F),this.addProcessingMethod("color",["v1","v2","v3","alpha"],G,"Gibt die aus v1, v2, v3 und alpha gebildete Farbe String-kodiert zurück.",F),this.addProcessingMethod("lerpColor",["colorA","colorB","t"],[F,F,G],"Gibt eine Zwischenfarbe zwischen colorA und colorB zurück. t == 0 bedeutet: colorA, t == 1 bedeutet: colorB, t == 0.5 bedeutet: genau zwischen beiden, usw.",F),this.addProcessingMethod("colorMode",["mode"],F,"Setzt den Modus, in dem nachfolgende Aufrufe von color(...) interpretiert werden. Möglich sind die Werte RGB, HSL und HSB."),this.addProcessingMethod("colorMode",["mode","max"],[F,G],"Setzt den Modus, in dem nachfolgende Aufrufe von color(...) interpretiert werden. Möglich sind die Werte RGB, HSL und HSB für Mode. Max ist der Maximalwert jeder Farbkomponente."),this.addProcessingMethod("colorMode",["mode","max1","max2","max3"],[F,G,G,G],"Setzt den Modus, in dem nachfolgende Aufrufe von color(...) interpretiert werden. Möglich sind die Werte RGB, HSL und HSB für Mode. Max ist der Maximalwert jeder Farbkomponente."),this.addProcessingMethod("colorMode",["mode","max1","max2","max3","maxAlpha"],[F,G,G,G,G],"Setzt den Modus, in dem nachfolgende Aufrufe von color(...) interpretiert werden. Möglich sind die Werte RGB, HSL und HSB für Mode. Max ist der Maximalwert jeder Farbkomponente."),this.addProcessingMethod("rectMode",["mode"],F,"Setzt den Modus, in dem nachfolgende Aufrufe von rect(...) interpretiert werden. Möglich sind die Werte CORNER, CORNERS, RADIUS und CENTER."),this.addProcessingMethod("rect",["left","top","width","height"],G,"Zeichnet ein Rechteck. (left, top) ist die linke obere Ecke, width die Breite und height die Höhe des Rechtecks."),this.addProcessingMethod("rect",["left","top","width","height","radius"],G,"Zeichnet ein Rechteck mit abgerundeten Ecken. (left, top) ist die linke obere Ecke, width die Breite und height die Höhe des Rechtecks."),this.addProcessingMethod("rect",["left","top","width","height","radius1","radius2","radius3","radius4"],G,"Zeichnet ein Rechteck mit abgerundeten Ecken. (left, top) ist die linke obere Ecke, width die Breite und height die Höhe des Rechtecks."),this.addProcessingMethod("square",["left","top","width"],G,"Zeichnet ein Quadrat. (left, top) ist die linke obere Ecke, width Seitenlänge des Quadrats."),this.addProcessingMethod("square",["left","top","width","radius"],G,"Zeichnet ein Quadrat mit abgerundeten Ecken. (left, top) ist die linke obere Ecke, width Seitenlänge des Quadrats. Radius ist der Eckenradius."),this.addProcessingMethod("square",["left","top","width","radius1","radius2","radius3","radius4"],G,"Zeichnet ein Quadrat mit abgerundeten Ecken. (left, top) ist die linke obere Ecke, width Seitenlänge des Quadrats. Radius ist der Eckenradius."),this.addProcessingMethod("rect",["left","top","width","height","radius"],G,"Zeichnet ein Rechteck. (left, top) ist die linke obere Ecke, width die Breite und height die Höhe des Rechtecks. Radius ist der Eckenradius"),this.addProcessingMethod("ellipse",["left","top","width","height"],G,"Zeichnet eine Ellipse. (left, top) ist die linke obere Ecke der Boundingbox der Ellipse, width ihre Breite und height ihre Höhe. Das lässt sich aber mit ellipseMode(...) ändern!"),this.addProcessingMethod("circle",["x","y","extent"],G,"Zeichnet einen Kreis. (x, y) ist der Mittelpunkt des Kreises, extent der doppelte Radius."),this.addProcessingMethod("ellipseMode",["mode"],F,"Setzt den Modus, in dem nachfolgende Aufrufe von ellipse(...) interpretiert werden. Möglich sind die Werte CORNER, CORNERS, RADIUS und CENTER."),this.addProcessingMethod("line",["x1","y1","x2","y2"],G,"Zeichnet eine Strecke von (x1, y1) nach (x2, y2)."),this.addProcessingMethod("line",["x1","y1","z1","x2","y2","z2"],G,"Zeichnet eine Strecke von (x1, y1, z1) nach (x2, y2, z2)."),this.addProcessingMethod("triangle",["x1","y1","x2","y2","x3","y3"],G,"Zeichnet eine Dreieck mit den Eckpunkten (x1, y1), (x2, y2) und (x3, y3)."),this.addProcessingMethod("quad",["x1","y1","x2","y2","x3","y3","x4","y4"],G,"Zeichnet eine Viereck mit den Eckpunkten (x1, y1), (x2, y2), (x3, y3) und (x4, y4)."),this.addProcessingMethod("bezier",["x1","y1","x2","y2","x3","y3","x4","y4"],G,"Zeichnet eine kubische Bezierkurve mit den Ankerpunkten (x1, y1), (x4, y4) und den Kontrollpunkten (x2, y2), (x3, y3)."),this.addProcessingMethod("curve",["x1","y1","x2","y2","x3","y3","x4","y4"],G,"Zeichnet eine Catmull-Rom-Kurve vom Punkt (x2, y2) nach (x3, y3) so, als würde sie von (x1, x2) kommen und es am Ende zu (x4, y4) weitergehen."),this.addProcessingMethod("curvePoint",["a","b","c","d","t"],G,"Will man die Zwischenpunkte einer Curve erhalten (Beginn b, Ende c, als würde sie von a kommen und nach d gehen), so verwendet man sowohl für die x- als auch für die y-Koordinate diese Funktion. t gibt an, welchen Punkt der Kurve man haben möchte. t hat Werte zwischen 0 (Startpunkt) und 1 (Endpunkt).",G),this.addProcessingMethod("curveTangent",["a","b","c","d","t"],G,"Will man die Zwischentangenten einer Curve erhalten (Beginn b, Ende c, als würde sie von a kommen und nach d gehen), so verwendet man sowohl für die x- als auch für die y-Koordinate diese Funktion. t gibt an, welchen Punkt der Kurve man haben möchte. t hat Werte zwischen 0 (Startpunkt) und 1 (Endpunkt).",G),this.addProcessingMethod("bezierPoint",["x1","x2","x3","x4","t"],G,"Will man die Zwischenpunkte einer Bezierkurve erhalten (Ankerkoordinaten x1, x4 und Stützkoordinaten x2, x3), so nutzt man - einzeln sowohl für die x- also auch für die y-Koordinate - diese Funktion. t gibt an, welchen Punkt der Kurve man haben möchte. t hat Werte zwischen 0 (Startpunkt) und 1 (Endpunkt).",G),this.addProcessingMethod("bezierTangent",["x1","x2","x3","x4","t"],G,"Will man die Zwischentangenten einer Bezierkurve erhalten (Ankerkoordinaten x1, x4 und Stützkoordinaten x2, x3), so nutzt man - einzeln sowohl für die x- also auch für die y-Koordinate - diese Funktion. t gibt an, welchen Punkt der Kurve man haben möchte. t hat Werte zwischen 0 (Startpunkt) und 1 (Endpunkt).",G),this.addProcessingMethod("beginShape",[],[],"Beginnt mit dem Zeichnen eines Polygons. Die einzelnen Punkte werden mit der Methode vertex(x, y) gesetzt."),this.addProcessingMethod("endShape",[],[],"Endet das Zeichnen eines Polygons."),this.addProcessingMethod("beginShape",["kind"],F,"Beginnt mit dem Zeichnen eines Polygons. Die einzelnen Punkte werden mit der Methode vertex(x, y) gesetzt. Mögliche Werte für kind sind: POINTS, LINES, TRIANGLES, TRIANGLE_STRIP, TRIANGLE_FAN, QUADS, QUAD_STRIP"),this.addProcessingMethod("endShape",["kind"],F,"endShape(CLOSE) schließt den Linienzug."),this.addProcessingMethod("vertex",["x","y"],G,"Setzt zwischen beginShape() und endShape() einen Punkt."),this.addProcessingMethod("point",["x","y"],G,"Zeichnet einen Punkt."),this.addProcessingMethod("set",["x","y","color"],[G,G,F],"Setzt die Farbe des Pixels bei (x, y)."),this.addProcessingMethod("vertex",["x","y","z"],G,"Setzt zwischen beginShape() und endShape() einen Punkt."),this.addProcessingMethod("point",["x","y","z"],G,"Zeichnet einen Punkt."),this.addProcessingMethod("curveVertex",["x","y"],G,"Setzt zwischen beginShape() und endShape() einen Punkt. Processing zeichnet damit eine Kurve nach dem Catmull-Rom-Algorithmus."),this.addProcessingMethod("curvevertex",["x","y","z"],G,"Setzt zwischen beginShape() und endShape() einen Punkt. Processing zeichnet damit eine Kurve nach dem Catmull-Rom-Algorithmus."),this.addProcessingMethod("box",["size"],G,"Zeichnet einen 3D-Würfel mit der Seitenlänge size."),this.addProcessingMethod("box",["sizeX","sizeY","sizeZ"],G,"Zeichnet einen 3D-Würfel mit den angegebenen Seitenlängen."),this.addProcessingMethod("resetMatrix",[],[],"Setzt alle erfolgten Transformationen zurück."),this.addProcessingMethod("push",[],[],"Sichert den aktuellen Zeichenzustand, d.h. die Farben und Transformationen, auf einen Stack."),this.addProcessingMethod("pop",[],[],"Holt den obersten Zeichenzustand, d.h. die Farben und Transformationen, vom Stack."),this.addProcessingMethod("scale",["factor"],G,"Streckt die nachfolgend gezeichneten Figuren."),this.addProcessingMethod("scale",["factorX","factorY"],G,"Streckt die nachfolgend gezeichneten Figuren."),this.addProcessingMethod("scale",["factorX","factorY","factorZ"],G,"Streckt die nachfolgend gezeichneten Figuren."),this.addProcessingMethod("translate",["x","y"],G,"Verschiebt die nachfolgend gezeichneten Figuren."),this.addProcessingMethod("translate",["x","y","z"],G,"Verschiebt die nachfolgend gezeichneten Figuren."),this.addProcessingMethod("rotate",["angle"],G,"Rotiert die nachfolgend gezeichneten Figuren. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("rotateX",["angle"],G,"Rotiert die nachfolgend gezeichneten Figuren um die X-Achse. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("rotateY",["angle"],G,"Rotiert die nachfolgend gezeichneten Figuren um die Y-Achse. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("shearX",["angle"],G,"Schert die nachfolgend gezeichneten Figuren in Richtung derX-Achse. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("shearY",["angle"],G,"Schert die nachfolgend gezeichneten Figuren in Richtung der Y-Achse. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("rotateZ",["angle"],G,"Rotiert die nachfolgend gezeichneten Figuren um die Z-Achse. Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie angle interpretiert wird. Default ist RADIANS."),this.addProcessingMethod("angleMode",["mode"],F,"Mit angleMode(RADIANS) bzw. angleMode(DEGREES) kann beeinflusst werden, wie winkel bei Rotationen interpretiert werden. Default ist RADIANS."),this.addProcessingMethod("textSize",["size"],G,"Setzt die Schriftgröße in Pixel."),this.addProcessingMethod("textAlign",["alignX"],C,"Setzt die Ausrichtung des nächsten ausgegebenen Textes in x-Richtung. Mögliche Werte sind CENTER, LEFT, RIGHT"),this.addProcessingMethod("textAlign",["alignX","alignY"],C,"Setzt die Ausrichtung des nächsten ausgegebenen Textes. Mögliche Werte für alignX sind CENTER, LEFT, RIGHT, mögliche Werte für alignY sind TOP, CENTER, BASELINE, BOTTOM"),this.addProcessingMethod("text",["text","x","y"],[F,G,G],"Gibt Text aus."),this.addProcessingMethod("text",["text","x","y","x2","y2"],[F,G,G,G,G],"Gibt Text aus. x2 und y2 sind die Breite und Höhe des Textausgabebereichs. Hat der Text horizontal nicht Platz, so wird er entsprechend umgebrochen."),this.addProcessingMethod("random",["low","high"],G,"Gibt eine Zufallszahl zwischen low und high zurück.",G),this.addProcessingMethod("random",["high"],G,"Gibt eine Zufallszahl zwischen 0 und high zurück.",G),this.addProcessingMethod("sqrt",["n"],G,"Gibt die Quadratwurzel von n zurück.",G),this.addProcessingMethod("pow",["basis","exponent"],G,'Gibt die den Wert der Potenz ("basis hoch exponent") zurück.',G),this.addProcessingMethod("max",["a","b"],G,"Gibt den größeren der beiden Werte zurück.",G),this.addProcessingMethod("min",["a","b"],G,"Gibt den kleineren der beiden Werte zurück.",G),this.addProcessingMethod("abs",["n"],G,"Gibt den Betrag des Wertes zurück.",G),this.addProcessingMethod("sin",["n"],G,"Gibt den Sinus des Wertes zurück.",G),this.addProcessingMethod("cos",["n"],G,"Gibt den Cosinus des Wertes zurück.",G),this.addProcessingMethod("tan",["n"],G,"Gibt den Tangens des Wertes zurück.",G),this.addProcessingMethod("asin",["n"],G,"Gibt den Arcussinus des Wertes zurück.",G),this.addProcessingMethod("acos",["n"],G,"Gibt den Arcussosinus des Wertes zurück.",G),this.addProcessingMethod("radians",["angle"],G,"Wandelt einen Winkel vom Gradmaß ins Bogenmaß um.",G),this.addProcessingMethod("degrees",["angle"],G,"Wandelt einen Winkel vom Bogenmaß ins Gradmaß um.",G),this.addProcessingMethod("atan",["n"],G,"Gibt den Arcussangens des Wertes zurück.",G),this.addProcessingMethod("atan2",["x","y"],G,"Gibt den Arcussangens des Wertes zurück.",G),this.addProcessingMethod("sqrt",["x","y"],G,"Gibt die Quadratwurzel des Wertes zurück.",G),this.addProcessingMethod("sq",["x","y"],G,"Gibt das Quadrat des Wertes zurück.",G),this.addProcessingMethod("abs",["n"],C,"Gibt den Betrag des Wertes zurück.",C),this.addProcessingMethod("round",["n"],G,"Rundet den Wert auf eine ganze Zahl.",C),this.addProcessingMethod("ceil",["n"],G,"Rundet den Wert auf eine ganze Zahl (Aufrunden!).",C),this.addProcessingMethod("floor",["n"],G,"Rundet den Wert auf eine ganze Zahl (Abfrunden!).",C),this.addProcessingMethod("dist",["x1","y1","x2","y2"],G,"Berechnet den Abstand der Punkte (x1, y1) und (x2, y2).",G),this.addProcessingMethod("lerp",["a","b","t"],G,"Berechnet den a + (b - a)*t. Wählt man t zwischen 0 und 1, so kann man damit die Zwischenwerte zwischen a und b errechnen.",G),this.addProcessingMethod("constrain",["value","min","max"],G,"Beschränkt value auf den Bereich [min, max], genauer: Ist value < min, so wird min zurückgegeben. Ist value > max, so wird max zurückgegeben. Ansonsten wird value zurückgegeben.",G),this.addProcessingMethod("year",[],[],"Aktuelle Jahreszahl",C),this.addProcessingMethod("month",[],[],"Monat: 1 == Januar, 12 == Dezember",C),this.addProcessingMethod("day",[],[],"Tag (innerhalb des Monats) des aktuellen Datums",C),this.addProcessingMethod("hour",[],[],"Stundenzahl der aktuellen Uhrzeit",C),this.addProcessingMethod("hour",[],[],"Stundenzahl der aktuellen Uhrzeit",C),this.addProcessingMethod("minute",[],[],"Minutenzahl der aktuellen Uhrzeit",C),this.addProcessingMethod("second",[],[],"Sekundenzahl der aktuellen Uhrzeit",C),this.addProcessingMethod("frameRate",["n"],C,"Setzt die Framerate (Anzahl der Aufrufe von draw() pro Sekunde)"),this.addProcessingMethod("textWidth",["text"],F,"Gibt die Breite des Texts zurück.",G),this.addProcessingMethod("textAscent",["text"],F,"Gibt den Ascent Textes zurück ( = Höhe des größten Zeichens über der Grundlinie).",G),this.addProcessingMethod("textDescent",["text"],F,"Gibt den Descent Textes zurück ( = Tiefe des tiefsten Zeichens unter der Grundlinie).",G),this.addProcessingMethod("textLeading",["leading"],G,"Setzt den Abstand zweier aufeinanderfolgender Textzeilen."),this.addProcessingMethod("cursor",["type"],F,'Ändert das Aussehen des Mauscursors. Type ist einer der Werte "arrow", "cross", "text", "move", "hand", "wait", "progress".'),this.addProcessingMethod("noCursor",["type"],F,"Hat zur Folge, dass der Mauscursor über dem Zeichenbereich unsichtbar ist."),this.addProcessingMethod("copy",["sx","sy","sw","sh","dx","dy","dw","dh"],G,"Kopiert den rechteckigen Bereich mit der linken oberen Ecke (sx, sy) sowie der Breite sw und der Höhe sh in den Bereich mit der linken oberen Ecke (dx, dy), der Breite dw und der Höhe dh."),this.addProcessingMethod("millis",[],[],"Gibt die Millisekunden zurück, die vergangen sind, seit setup() aufgerufen wurde."),this.addProcessingMethod("redraw",[],[],"Führt draw() genau ein Mal aus. Macht ggf. Sinn, wenn die Render-Loop zuvor mit noLoop() gestoppt wurde."),this.setupAttributeIndicesRecursive()}addProcessingMethod(e,t,i,n,s){let a=[];if(Array.isArray(i))for(let l=0;l<t.length;l++)a.push({identifier:t[l],type:i[l],declaration:null,usagePositions:null,isFinal:!0});else a=t.map(l=>({identifier:l,type:i,declaration:null,usagePositions:null,isFinal:!0}));s==null?this.addMethod(new m(e,new g(a),null,l=>{let u=l[0].value.intrinsicData.Processing,h=l.slice(1).map(d=>d.value);u.p5o[e](...h)},!1,!1,n,!1)):this.addMethod(new m(e,new g(a),s,l=>{let u=l[0].value.intrinsicData.Processing,h=l.slice(1).map(d=>d.value);return u.p5o[e](...h)},!1,!1,n,!1))}getProcessingHelper(e,t=800,i=600){var s,a;let n=(a=(s=this.module)==null?void 0:s.main)==null?void 0:a.getInterpreter();if(n.processingHelper!=null){n.throwException("Es kann nur ein einziges Processing-Applet instanziert werden.");return}if(n.worldHelper!=null){n.throwException("Processing kann nicht gleichzeitig mit der herkömmlichen Grafikausgabe genutzt werden.");return}return new WA(this.module,n,e)}}class WA{constructor(e,t,i){y(this,"$containerOuter");y(this,"$containerInner");y(this,"$div");y(this,"width",800);y(this,"height",600);y(this,"p5o");y(this,"renderer");y(this,"loopStopped",!1);y(this,"onSizeChanged");y(this,"canvasCreated",!1);var s;this.module=e,this.interpreter=t,this.runtimeObject=i,this.interpreter.processingHelper=this,this.$containerOuter=I("<div></div>");let n=this.module.main.getInterpreter().printManager.getGraphicsDiv();this.onSizeChanged=()=>{let a=n.parents(".jo_tabs"),l=a.width(),o=a.height();this.height/this.width>o/l?n.css({width:this.width/this.height*o+"px",height:o+"px"}):n.css({height:this.height/this.width*l+"px",width:l+"px"})},n.off("sizeChanged"),n.on("sizeChanged",this.onSizeChanged),this.onSizeChanged(),this.$containerInner=I("<div></div>"),this.$containerOuter.append(this.$containerInner),n.append(this.$containerOuter),n.show(),n[0].oncontextmenu=function(a){a.preventDefault()},(s=this.module.main.getRightDiv())==null||s.adjustWidthToWorld()}createCanvas(e,t){this.width=e,this.height=t,this.onSizeChanged(),this.p5o.createCanvas(this.width,this.height,this.renderer),this.$div.find("canvas").css({width:"",height:""}),this.canvasCreated=!0}main(){this.interpreter.timerExtern=!0,this.setupProcessing(this.$containerInner)}setupProcessing(e){let t=this;this.canvasCreated=!1;let i=!0;this.$div=e;let n=s=>{s.setup=function(){t.renderer=s.P2D,t.p5o=s;let a=()=>{i=!1};t.createCanvas(t.width,t.height);let l=2;t.runMethod("setup",()=>{--l==0&&a()}),t.runMethod("settings",()=>{--l==0&&a()})},s.preload=function(){t.runMethod("preload")},s.draw=function(){t.interpreter.state==Re.running&&!t.loopStopped&&(i||(i=!0,t.runMethod("draw",()=>{i=!1}))),t.tick()},s.mousePressed=function(){t.runMethod("mousePressed")},s.mouseReleased=function(){t.runMethod("mouseReleased")},s.mouseClicked=function(){t.runMethod("mouseClicked")},s.mouseDragged=function(){t.runMethod("mouseDragged")},s.mouseEntered=function(){t.runMethod("mouseEntered")},s.mouseExited=function(){t.runMethod("mouseExited")},s.mouseMoved=function(){t.runMethod("mouseMoved")},s.keyPressed=function(){t.runMethod("keyPressed")},s.keyReleased=function(){t.runMethod("keyReleased")}};new p5(n,e[0]),e.find("canvas").css({width:"",height:""})}tick(){this.interpreter.state==Re.running&&(this.interpreter.timerFunction(33.33,!0,.5),this.interpreter.timerStopped=!1,this.interpreter.timerFunction(33.33,!1,.08))}loop(){this.loopStopped=!1}noLoop(){this.loopStopped=!0}runMethod(e,t=null){let i=this.runtimeObject.class,n=i.getMethodBySignature(e+"()");if((n==null?void 0:n.program)==null){t!=null&&t();return}let a=[{type:i,value:this.runtimeObject}];this.interpreter.runTimer(n,a,l=>{t!=null&&t()},e=="draw")}destroyWorld(){this.p5o!=null&&this.p5o.remove(),this.$containerOuter.remove(),this.module.main.getInterpreter().printManager.getGraphicsDiv().hide(),this.interpreter.timerExtern=!1,this.interpreter.processingHelper=null}}class HA extends ${constructor(e){super("Turtle",e,"Turtle-Klasse zum Zeichnen von Streckenzügen oder gefüllten Figuren. Wichtig sind vor allem die Methoden forward(double length) und turn(double angleDeg), die die Turtle nach vorne bewegen bzw. ihre Blickrichtung ändern."),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("Turtle",new g([]),null,t=>{let i=t[0].value,n=new ss(100,200,!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,'Instanziert ein neues Turtle-Objekt ohne Punkte. Die Turtle blickt anfangs nach rechts. Am Ende des Streckenzugs wird eine "Schildkröte" (kleines Dreieck) gezeichnet.',!0)),this.addMethod(new m("Turtle",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=new ss(n,s,!0,e.main.getInterpreter(),i);i.intrinsicData.Actor=a},!1,!1,'Instanziert ein neues Turtle-Objekt ohne Punkte. Die Turtle blickt anfangs nach rechts. Am Ende des Streckenzugs wird eine "Schildkröte" (kleines Dreieck) gezeichnet.',!0)),this.addMethod(new m("Turtle",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"showTurtle",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=new ss(n,s,a,e.main.getInterpreter(),i);i.intrinsicData.Actor=l},!1,!1,'Instanziert ein neues Turtle-Objekt ohne Punkte. Die Turtle blickt anfangs nach rechts. Falls showTurtle == true, wird am Ende des Streckenzuges eine "Schildkröte" (kleines Dreieck) gezeichnet.',!0)),this.addMethod(new m("forward",new g([{identifier:"length",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("forward")||s.forward(n)},!1,!1,"Weist die Turtle an, die angegebene Länge vorwärts zu gehen. Ihr zurückgelegter Weg wird als gerade Strecke mit der aktuellen BorderColor gezeichnet. Mit setBorderColor(null) bewirkst Du, dass ein Stück ihres Weges nicht gezeichnet wird.",!1)),this.addMethod(new m("turn",new g([{identifier:"angleInDeg",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("turn")||s.turn(n)},!1,!1,"Bewirkt, dass sich die Turtle um den angegebenen Winkel (in Grad!) dreht, d.h. ihre Blickrichtung ändert. Ein positiver Winkel bewirkt eine Drehung gegen den Uhrzeigersinn. Diese Methode wirkt sich NICHT auf die bisher gezeichneten Strecken aus. Willst Du alles bisher Gezeichnete inklusive Turtle drehen, so nutze die Methode rotate.",!1)),this.addMethod(new m("penUp",new g([]),null,t=>{let n=t[0].value.intrinsicData.Actor;n.testdestroyed("penUp")||(n.penIsDown=!1)},!1,!1,"Bewirkt, dass die Turtle beim Gehen ab jetzt nicht mehr zeichnet.",!1)),this.addMethod(new m("penDown",new g([]),null,t=>{let n=t[0].value.intrinsicData.Actor;n.testdestroyed("penDown")||(n.penIsDown=!0)},!1,!1,"Bewirkt, dass die Turtle beim Gehen ab jetzt wieder zeichnet.",!1)),this.addMethod(new m("closeAndFill",new g([{identifier:"closeAndFill",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("closeAndFill")||s.closeAndFill(n)},!1,!1,"closeAndFill == true bewirkt, dass das von der Turtlezeichnung umschlossene Gebiet gefüllt wird.",!1)),this.addMethod(new m("showTurtle",new g([{identifier:"showTurtle",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("showTurtle")||s.setShowTurtle(n)},!1,!1,"showTurtle == true bewirkt, dass am Ort der Turtle ein rotes Dreieck gezeichnet wird.",!1)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Turtle-Objekts und gibt es zurück.",!1)),this.addMethod(new m("clear",new g([]),this,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("clear"))return n.clear()},!1,!1,"Löscht alle bis jetzt mit der Turtle gezeichneten Strecken.",!1)),this.addMethod(new m("collidesWithBorderColor",new g([{identifier:"borderColor",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;if(!s.testdestroyed("collidesWithBorderColor"))return s.collidesWithBorderColor(n)},!1,!1,'Gibt genau dann true zurück, wenn sich der "Mittelpunkt" des Turtle-Dreiecks auf dem Rand eines anderen graphischen Objekts mit der angegebenen Farbe befindet.',!1)),this.addMethod(new m("collidesWithBorderColor",new g([{identifier:"color",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;if(s.testdestroyed("collidesWithBorderColor"))return;let a=Ot.parseColorToOpenGL(n);return s.collidesWithBorderColor(a.color)},!1,!1,'Gibt genau dann true zurück, wenn sich der "Mittelpunkt" des Turtle-Dreiecks auf dem Rand eines anderen graphischen Objekts mit der angegebenen Farbe befindet.',!1)),this.addMethod(new m("getLastSegmentLength",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getLastSegmentLength"))return n.getLastSegmentLength()},!1,!1,"Gibt die Länge des letzten gezeichneten Streckenzugs zurück.",!1)),this.addMethod(new m("getX",new g([]),A,t=>t[0].value.intrinsicData.Actor.getPosition().x,!1,!1,"Gibt die x-Koordinate der aktuellen Turtleposition zurück.",!1)),this.addMethod(new m("getY",new g([]),A,t=>t[0].value.intrinsicData.Actor.getPosition().y,!1,!1,"Gibt die y-Koordinate der aktuellen Turtleposition zurück.",!1)),this.addMethod(new m("moveTo",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let n=t[0].value.intrinsicData.Actor,s=t[1].value,a=t[2].value;n.testdestroyed("moveTo")||n.moveTo(s,a)},!1,!1,"Bewirkt, dass die Turtle zum Punkt (x, y) geht.",!1))}}class ss extends vi{constructor(t,i,n,s,a){super(s,a);y(this,"lineElements",[]);y(this,"turtleAngleDeg",0);y(this,"isFilled",!1);y(this,"turtle");y(this,"lineGraphic");y(this,"xSum",0);y(this,"ySum",0);y(this,"initialHitPolygonDirty",!0);y(this,"turtleSize",40);y(this,"penIsDown",!0);y(this,"lastLineWidth",0);y(this,"lastColor",0);y(this,"lastAlpha",0);y(this,"lastTurtleAngleDeg",0);y(this,"renderJobPresent",!1);y(this,"angleHasChanged",!0);y(this,"lastLengthSign",-2);y(this,"newTurtleX");y(this,"newTurtleY");y(this,"newAngleDeg");this.showTurtle=n,this.lineElements.push({x:t,y:i,color:0,alpha:1,lineWidth:1}),this.calculateCenter(),this.borderColor=16777215,this.hitPolygonInitial=[];let l=new Rt;this.displayObject=l,this.lineGraphic=new gt,l.addChild(this.lineGraphic),this.lineGraphic.moveTo(t,i),this.turtle=new gt,l.addChild(this.turtle),this.turtle.visible=this.showTurtle,this.initTurtle(0,0,this.turtleAngleDeg),this.moveTurtleTo(t,i,this.turtleAngleDeg),this.worldHelper.stage.addChild(this.displayObject),this.addToDefaultGroupAndSetDefaultVisibility()}calculateCenter(){let t=this.lineElements.length,i=this.lineElements[t-1];this.xSum+=i.x,this.ySum+=i.y,this.centerXInitial=this.xSum/t,this.centerYInitial=this.ySum/t}closeAndFill(t){t!=this.isFilled&&(this.isFilled=t,this.render(),this.initialHitPolygonDirty=!0)}setShowTurtle(t){this.turtle.visible=t}turn(t){this.angleHasChanged=!0,this.turtleAngleDeg-=t,Math.abs(this.turtleAngleDeg)>360&&(this.turtleAngleDeg-=Math.floor(this.turtleAngleDeg/360)*360);let i=this.lineElements[this.lineElements.length-1];this.moveTurtleTo(i.x,i.y,this.turtleAngleDeg)}rotate(t,i,n){super.rotate(t,i,n)}getCopy(t){let i=new he(t),n=new ss(this.lineElements[0].x,this.lineElements[0].y,this.showTurtle,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.turtleAngleDeg=this.turtleAngleDeg,n.copyFrom(this),n.render(),i}forward(t){Math.sign(t)!=this.lastLengthSign&&(this.angleHasChanged=!0),this.lastLengthSign=Math.sign(t);let i=this.lineElements[this.lineElements.length-1],n=this.penIsDown?this.borderColor:null,s=this.turtleAngleDeg/180*Math.PI,a;!this.angleHasChanged&&i.color==n&&i.alpha==this.borderAlpha&&i.lineWidth==this.borderWidth?(i.x+=t*Math.cos(s),i.y+=t*Math.sin(s),a=i):(a={x:i.x+t*Math.cos(s),y:i.y+t*Math.sin(s),color:n,alpha:this.borderAlpha,lineWidth:this.borderWidth},this.lineElements.push(a)),this.angleHasChanged=!1,this.hitPolygonDirty=!0,this.initialHitPolygonDirty=!0,this.calculateCenter(),this.newTurtleX=a.x,this.newTurtleY=a.y,this.newAngleDeg=this.turtleAngleDeg,this.renderJobPresent||(this.renderJobPresent=!0,setTimeout(()=>{this.renderJobPresent=!1,this.render(),this.moveTurtleTo(this.newTurtleX,this.newTurtleY,this.turtleAngleDeg)},100))}moveTo(t,i){let n={x:t,y:i,color:null,alpha:this.borderAlpha,lineWidth:this.borderWidth};this.lineElements.push(n),this.hitPolygonDirty=!0,this.initialHitPolygonDirty=!0,this.calculateCenter(),this.moveTurtleTo(n.x,n.y,this.turtleAngleDeg)}initTurtle(t,i,n){this.turtle.clear(),this.turtle.lineStyle(3,16711680,1,.5),this.turtle.moveTo(t,i);let s=n/180*Math.PI,a=Math.cos(s),l=Math.sin(s),o=-Math.sin(s),u=Math.cos(s),h=this.turtleSize/2,d=this.turtleSize/4,p=this.turtleSize/4;this.turtle.moveTo(t+a*h,i+l*h),this.turtle.lineTo(t-a*d+o*p,i-l*d+u*p),this.turtle.lineTo(t-a*d-o*p,i-l*d-u*p),this.turtle.lineTo(t+a*h,i+l*h)}moveTurtleTo(t,i,n){this.turtle.localTransform.identity(),this.turtle.localTransform.rotate(n/180*Math.PI),this.turtle.localTransform.translate(t,i),this.turtle.transform.onChange(),this.turtle.updateTransform(),this.lastTurtleAngleDeg=this.turtleAngleDeg}render(){let t=this.lineGraphic;this.lastLineWidth=0,this.lastColor=0,this.lastAlpha=0,this.displayObject==null?(t=new gt,this.displayObject=t,this.worldHelper.stage.addChild(t)):t.clear(),this.fillColor!=null&&this.isFilled&&t.beginFill(this.fillColor,this.fillAlpha);let i=this.lineElements[0];t.moveTo(i.x,i.y),this.isFilled&&t.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5);for(let n=1;n<this.lineElements.length;n++){let s=this.lineElements[n];s.color!=null?(this.isFilled||(s.lineWidth!=this.lastLineWidth||s.color!=this.lastColor||s.alpha!=this.lastAlpha)&&(t.lineStyle(s.lineWidth,s.color,s.alpha,.5),this.lastLineWidth=s.lineWidth,this.lastColor=s.color,this.lastAlpha=s.alpha),t.lineTo(s.x,s.y)):t.moveTo(s.x,s.y)}this.isFilled&&t.closePath(),this.fillColor!=null&&this.isFilled&&t.endFill()}collidesWith(t){t instanceof ss&&t.initialHitPolygonDirty&&t.setupInitialHitPolygon(),this.initialHitPolygonDirty&&(this.setupInitialHitPolygon(),this.transformHitPolygon(),this.render());let i=this.displayObject.getBounds(),n=t.displayObject.getBounds();return i.left>n.right||n.left>i.right||i.top>n.bottom||n.top>i.bottom?!1:t.shapes?t.collidesWith(this):this.hitPolygonInitial==null||t.hitPolygonInitial==null?!0:(this.hitPolygonDirty&&this.transformHitPolygon(),t.hitPolygonDirty&&t.transformHitPolygon(),t.hitPolygonTransformed.length==2&&!this.isFilled?XC(this.hitPolygonTransformed,t.hitPolygonTransformed):$C(this.hitPolygonTransformed,t.hitPolygonTransformed))}setupInitialHitPolygon(){this.hitPolygonInitial=this.lineElements.map(t=>({x:t.x,y:t.y}))}clear(t=null,i=null,n=null){let s=this.lineElements.pop();t==null&&(t=s.x),i==null&&(i=s.y),this.lineElements=[],this.lineElements.push({x:t,y:i,color:0,alpha:1,lineWidth:1}),this.calculateCenter(),this.hitPolygonInitial=[],n!=null&&(this.turtleAngleDeg=n,this.angleHasChanged=!0,this.lastTurtleAngleDeg=0,this.borderColor=0,this.turtleSize=40),this.render(),n!=null&&this.moveTurtleTo(t,i,n)}touchesAtLeastOneFigure(){let t=this.lineElements[this.lineElements.length-1],i=t.x,n=t.y;for(let s of this.worldHelper.shapes)if(s!=this&&s.containsPoint(i,n))return!0;return!1}touchesColor(t){let i=this.lineElements[this.lineElements.length-1],n=i.x,s=i.y;for(let a of this.worldHelper.shapes)if(a!=this&&a.containsPoint(n,s)&&a instanceof vi&&a.fillColor==t)return!0;return!1}touchesShape(t){let i=this.lineElements[this.lineElements.length-1],n=i.x,s=i.y;return t.containsPoint(n,s)}containsPoint(t,i){return this.initialHitPolygonDirty&&(this.setupInitialHitPolygon(),this.transformHitPolygon(),this.render()),this.displayObject.getBounds().contains(t,i)?this.hitPolygonInitial==null?!0:(this.hitPolygonDirty&&this.transformHitPolygon(),this.isFilled?_r(this.hitPolygonTransformed,{x:t,y:i}):pb(this.hitPolygonTransformed,{x:t,y:i})):!1}borderContainsPointExcludingLastLineElement(t,i,n=-1){let s=this.lineElements.pop(),a=this.borderContainsPoint(t,i,n);return this.lineElements.push(s),a}borderContainsPoint(t,i,n=-1){this.displayObject.updateTransform();let s=this.displayObject.transform.worldTransform,a=s.a==1&&s.b==0&&s.c==0&&s.d==1&&s.tx==0&&s.ty==0,l={x:t,y:i};if(this.lineElements.length<2)return!1;let o=this.lineElements[0],u,h=o;a||(h={x:s.a*h.x+s.c*h.y+s.tx,y:s.b*h.x+s.d*h.y+s.ty});for(let d=0;d<this.lineElements.length-1;d++)if(u=h,o=this.lineElements[d+1],h=o,a||(h={x:s.a*h.x+s.c*h.y+s.tx,y:s.b*h.x+s.d*h.y+s.ty}),!(n!=-1&&o.color!=n)&&kl(u,h,l)<=o.lineWidth/2)return!0;return!1}collidesWithBorderColor(t){let i=this.lineElements[this.lineElements.length-1],n=i.x,s=i.y;for(let a of this.worldHelper.shapes)if(a==this){if(a.borderContainsPointExcludingLastLineElement(n,s,t))return!0}else if(a.borderContainsPoint(n,s,t))return!0;return!1}getLastSegmentLength(){if(this.lineElements.length<2)return 0;let t=this.lineElements[this.lineElements.length-2],i=this.lineElements[this.lineElements.length-1],n=i.x-t.x,s=i.y-t.y;return Math.sqrt(n*n+s*s)}getPosition(){return this.lineElements[this.lineElements.length-1]}}class Oi extends ${constructor(e,t){super("Ereignisbehandlung",e,"Zugriff auf Ereignisse einschließlich Taktgeber (Graphics'n Games-Bibliothek (Cornelsen-Verlag))"),this.moduleStore=t;let i=t.getType("Object").type;this.setBaseClass(i),this.addMethod(new m("Ereignisbehandlung",new g([]),null,n=>{let s=n[0].value;Oi.getHelper(e).registerEvents(s)},!1,!1,"Instanziert ein neues Ereignisbehandlungs-Objekt.",!0)),this.addMethod(new m("Starten",new g([]),null,n=>{Oi.getHelper(e).startTimer()},!1,!1,"Zeitgeber starten.",!1)),this.addMethod(new m("Anhalten",new g([]),null,n=>{Oi.getHelper(e).stopTimer()},!1,!1,"Zeitgeber anhalten.",!1)),this.addMethod(new m("TaktdauerSetzen",new g([{identifier:"dauer",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let s=n[1].value;Oi.getHelper(e).taktdauer=s},!1,!0,"Setzt die Taktdauer des Zeitgebers in Millisekunden",!1)),this.addMethod(new m("TaktImpulsAusführen",new g([]),U,null,!1,!1,"Diese Methode wird vom Taktgeber aufgerufen.")),this.addMethod(new m("TasteGedrückt",new g([{identifier:"taste",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Taste gedrückt wird.")),this.addMethod(new m("SonderTasteGedrückt",new g([{identifier:"taste",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Sondertaste gedrückt wird.")),this.addMethod(new m("MausGeklickt",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine die linke Maustaste gedrückt wird."))}static getHelper(e){let t=e.main.getInterpreter();return t.gngEreignisbehandlungHelper==null&&(t.gngEreignisbehandlungHelper=new UA(e),t.gngEreignisbehandlungHelper.bindEvents()),t.gngEreignisbehandlungHelper}}class UA{constructor(e){y(this,"aktionsempfaengerTypes",["ausführen","taste","sondertaste","geklickt"]);y(this,"methodSignatureList",["TaktImpulsAusführen()","Ausführen()","AktionAusführen()","MausGeklickt(int, int, int)","Taste(char)","TasteGedrückt(char)","SonderTaste(int)","SonderTasteGedrückt(int)"]);y(this,"methodToAktionsempfaengerTypeMap",{"TaktImpulsAusführen()":"ausführen","Ausführen()":"ausführen","AktionAusführen()":"ausführen","MausGeklickt(int, int, int)":"geklickt","Taste(char)":"taste","TasteGedrückt(char)":"taste","SonderTaste(int)":"sondertaste","SonderTasteGedrückt(int)":"sondertaste"});y(this,"keyToKeyCodeMap",{Enter:13,ArrowLeft:37,ArrowRight:39,ArrowUp:38,ArrowDown:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,PageUp:33,PageDown:34,Insert:155});y(this,"aktionsempfaengerMap",{});y(this,"timerRunning",!1);y(this,"taktdauer",300);y(this,"remainingTime",0);y(this,"onKeyDownMethod");this.module=e;for(let t of this.aktionsempfaengerTypes)this.aktionsempfaengerMap[t]=[]}hasAktionsEmpfaenger(){for(let e of this.aktionsempfaengerTypes)if(this.aktionsempfaengerMap[e].length>0)return!0;return!1}registerEvents(e){let t=e.class;for(let i of this.methodSignatureList){let n=t.getMethodBySignature(i),s=this.methodToAktionsempfaengerTypeMap[i];((n==null?void 0:n.program)!=null||(n==null?void 0:n.invoke)!=null)&&this.aktionsempfaengerMap[s].push({type:s,method:n,runtimeObject:e})}}unregisterEvents(e){e.class;for(let t of this.methodSignatureList){let i=this.methodToAktionsempfaengerTypeMap[t];this.aktionsempfaengerMap[i]=this.aktionsempfaengerMap[i].filter(n=>n.runtimeObject!=e)}}bindEvents(){let e=this.module.main.getInterpreter();this.onKeyDownMethod=t=>{if(t.length==1)for(let i of this.aktionsempfaengerMap.taste)this.invokeMethod(i.method,i.runtimeObject,[{type:Ge,value:t}]);else{let i=this.keyToKeyCodeMap[t];if(i!=null)for(let n of this.aktionsempfaengerMap.sondertaste)this.invokeMethod(n.method,n.runtimeObject,[{type:Ge,value:i}])}},e.keyboardTool.keyDownCallbacks.push(this.onKeyDownMethod)}detachEvents(){let e=this.module.main.getInterpreter(),t=e.keyboardTool.keyDownCallbacks.indexOf(this.onKeyDownMethod);t>=0&&e.keyboardTool.keyDownCallbacks.splice(t,1),this.stopTimer()}invokeMethod(e,t,i=[],n){let s=e.program,a=e.invoke;i=i.slice(0),i.unshift({type:t.class,value:t}),s!=null?this.module.main.getInterpreter().runTimer(e,i,n,!1):a!=null&&a(i)}stopTimer(){this.timerRunning=!1}startTimer(){this.timerRunning||(this.timerRunning=!0,this.processTimerEntries())}processTimerEntries(){if(!this.timerRunning)return;let e=10;if(this.remainingTime+=e,this.remainingTime>this.taktdauer){this.remainingTime-=this.taktdauer;let i=this.aktionsempfaengerMap.ausführen;for(let n of i)this.invokeMethod(n.method,n.runtimeObject,[])}let t=this;setTimeout(()=>{t.processTimerEntries()},e)}handleMouseClickedEvent(e,t){let i=[{type:C,value:Math.round(e)},{type:C,value:Math.round(t)},{type:C,value:1}],n=this.aktionsempfaengerMap.geklickt;for(let s of n)this.invokeMethod(s.method,s.runtimeObject,i)}}class VA extends ${constructor(e,t){super("Zeichenfenster",e,"Grafische Zeichenfläche mit Koordinatensystem"),this.module=e,this.setBaseClass(t.getType("Object").type);let i=e.typeStore.getType("Aktionsempfaenger");this.addMethod(new m("MalflächenBreiteGeben",new g([]),C,n=>Math.round(this.getWorldHelper().width),!1,!0,"Gibt die Breite des Zeichenbereichs in Pixeln zurück.",!1)),this.addMethod(new m("MalflächenHöheGeben",new g([]),C,n=>Math.round(this.getWorldHelper().width),!1,!0,"Gibt die Höhe des Zeichenbereichs in Pixeln zurück.",!1)),this.addMethod(new m("AktionsEmpfängerEintragen",new g([{identifier:"neu",type:i,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let s=n[1].value;Oi.getHelper(e).registerEvents(s)},!1,!0,"Trägt einen neuen Aktionsempfänger ein.",!1)),this.addMethod(new m("AktionsEmpfängerEntfernen",new g([{identifier:"alt",type:i,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let s=n[1].value;Oi.getHelper(e).unregisterEvents(s)},!1,!0,"Löscht einen Aktionsempfänger aus der Liste.",!1)),this.addMethod(new m("TaktgeberStarten",new g([]),U,n=>{Oi.getHelper(e).startTimer()},!1,!0,"Startet den Taktgeber",!1)),this.addMethod(new m("TaktgeberStoppen",new g([]),U,n=>{Oi.getHelper(e).stopTimer()},!1,!0,"Stoppt den Taktgeber",!1)),this.addMethod(new m("TaktdauerSetzen",new g([{identifier:"dauer",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let s=n[1].value,a=Oi.getHelper(e);a.taktdauer=s},!1,!0,"Setzt die Taktdauer des Zeitgebers in Millisekunden",!1))}getWorldHelper(e=800,t=600){var n,s,a,l;let i=(a=(s=(n=this.module)==null?void 0:n.main)==null?void 0:s.getInterpreter())==null?void 0:a.worldHelper;if(i!=null){if(i.width!=e||i.height!=t){let o=Math.round(t/e*100);i.$containerOuter.css("padding-bottom",o+"%"),i.stage.localTransform.scale(i.width/e,i.height/t),i.width=e,i.height=t,i.stage.transform.onChange(),(l=this.module.main.getRightDiv())==null||l.adjustWidthToWorld()}return i}else{let o=new he(this.module.typeStore.getType("World")),u=new _l(e,t,this.module,o);o.intrinsicData.World=u}}}class $A extends ${constructor(e,t){super("Rechteck",e,"Rechteck-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)"),this.setBaseClass(e.typeStore.getType("GNGBaseFigur")),this.addAttribute(new ce("breite",C,i=>{let n=i.object.intrinsicData.Actor;i.value=n?Math.round(Math.abs(n.width*n.displayObject.scale.x)):0},!1,ee.protected,!1,"Breite des Rechtecks")),this.addAttribute(new ce("höhe",C,i=>{let n=i.object.intrinsicData.Actor;i.value=n?Math.round(Math.abs(n.height*n.displayObject.scale.x)):0},!1,ee.protected,!1,"Höhe des Rechtecks")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("Rechteck",new g([]),null,i=>{let n=i[0].value;n.intrinsicData.isGNG=!0;let s=new XA(10,10,100,100,e.main.getInterpreter(),n);n.intrinsicData.Actor=s,n.gngAttributes={moveAnchor:{x:10,y:10},width:100,height:100,colorString:"rot"},s.setFillColor(16711680)},!1,!1,"Instanziert ein neues, achsenparalleles Rechteck-Objekt.",!0)),this.addMethod(new m("GrößeSetzen",new g([{identifier:"breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"höhe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor,a=i[1].value,l=i[2].value;s.testdestroyed("GrößeSetzen")||(n.gngAttributes.width=a,n.gngAttributes.height=l,s.renderGNG(n))},!1,!1,"Setzt die Breite und Höhe des Rechtecks.",!1))}}class XA extends ta{renderGNG(e){let t=e.gngAttributes,i=t.moveAnchor.x+t.width/2,n=t.moveAnchor.y+t.height/2;this.left=t.moveAnchor.x,this.top=t.moveAnchor.y,this.width=t.width,this.height=t.height,this.render(),this.displayObject.localTransform.identity(),this.displayObject.localTransform.translate(-i,-n),this.displayObject.localTransform.rotate(-this.angle/180*Math.PI),this.displayObject.localTransform.translate(i,n),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0)}}var Jr={weiß:16777215,weiss:16777215,rot:16711680,grün:65280,gruen:65280,blau:255,gelb:16776960,magenta:16711935,cyan:65535,hellgelb:16777088,hellgrün:8454016,hellgruen:8454016,orange:16744448,braun:8404992,grau:8421504,schwarz:0};class KA extends ${constructor(e,t){super("GNGBaseFigur",e,"Oberklasse der graphischen Elemente in der Graphics'n Games-Bibliothek (Cornelsen-Verlag)");let i=t.getType("Object").type;this.setBaseClass(i),this.addAttribute(new ce("farbe",F,n=>{var a;let s=(a=n.object.gngAttributes)==null?void 0:a.colorString;n.value=s??"schwarz"},!1,ee.protected,!1,"Farbe des Grafikobjekts")),this.addAttribute(new ce("x",C,n=>{n.value=n.object.gngAttributes?Math.round(n.object.gngAttributes.moveAnchor.x):0},!1,ee.protected,!1,"x-Position des Grafikobjekts")),this.addAttribute(new ce("y",C,n=>{n.value=n.object.gngAttributes?Math.round(n.object.gngAttributes.moveAnchor.y):0},!1,ee.protected,!1,"y-Position des Grafikobjekts")),this.addAttribute(new ce("winkel",C,n=>{n.object.intrinsicData.Actor&&(n.value=n.object.intrinsicData.Actor.angle)},!1,ee.protected,!1,"Blickrichtung des Grafikobjekts in Grad")),this.addAttribute(new ce("größe",C,n=>{n.value=n.object.gngAttributes?Math.round(n.object.gngAttributes.width):0},!1,ee.protected,!1,"Größe des Grafikobjekts (100 entspricht 'normalgroß')")),this.addAttribute(new ce("sichtbar",P,n=>{var s;n.object.intrinsicData.Actor&&(n.value=(s=n.object.intrinsicData.Actor.displayObject)==null?void 0:s.visible)},!1,ee.protected,!1,"true, wenn das Grafikobjekt sichtbar ist")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("PositionSetzen",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=s.intrinsicData.Actor,l=n[1].value,o=n[2].value;a.testdestroyed("PositionSetzen")||(s.gngAttributes.moveAnchor.x=l,s.gngAttributes.moveAnchor.y=o,a.renderGNG(s))},!1,!1,"Verschiebt das Rechteck so, dass seine linke obere Ecke bei (x,y) zu liegen kommt.",!1)),this.addMethod(new m("Verschieben",new g([{identifier:"deltaX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"deltaY",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=s.intrinsicData.Actor,l=n[1].value,o=n[2].value;a.testdestroyed("Verschieben")||(s.gngAttributes.moveAnchor.x+=l,s.gngAttributes.moveAnchor.y+=o,a.renderGNG(s))},!1,!1,"Verschiebt die Figur um (x, y)",!1)),this.addMethod(new m("Drehen",new g([{identifier:"grad",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=s.intrinsicData.Actor,l=n[1].value;a.testdestroyed("Drehen")||(a.angle+=l,a.directionRad+=l/180*Math.PI,a.renderGNG(s))},!1,!1,"Dreht die Figur um den angegebenen Winkel. Drehpunkt ist der Diagonalenschnittpunkt der kleinsten achsenparallelen Bounding Box um die Figur.",!1)),this.addMethod(new m("FarbeSetzen",new g([{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=s.intrinsicData.Actor,l=n[1].value;s.gngAttributes.colorString=l;let o=Jr[l.toLocaleLowerCase()];o==null&&(o=0),!a.testdestroyed("FarbeSetzen")&&(a.setFillColor(o),a.render())},!1,!1,"Setzt die Farbe der Figur.",!1)),this.addMethod(new m("WinkelSetzen",new g([{identifier:"winkel",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=s.intrinsicData.Actor,l=n[1].value;a.testdestroyed("WinkelSetzen")||(a.angle=l,a.directionRad=l/180*Math.PI,a.renderGNG(s))},!1,!1,"Setzt den Drehwinkel der Figur. Der Winkel wird in Grad angegebenen, positive Werte bedeuten eine Drehung gegen den Uhrzeigersinn.",!1)),this.addMethod(new m("SichtbarkeitSetzen",new g([{identifier:"sichtbarkeit",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("SichtbarkeitSetzen")||a.setVisible(l)},!1,!1,"Schaltet die Sichtbarkeit der Figur ein oder aus.",!1)),this.addMethod(new m("Entfernen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("Entfernen")||a.destroy()},!1,!1,"Zerstört das Objekt.",!1)),this.addMethod(new m("GanzNachVornBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("GanzNachVornBringen"))return a.bringToFront()},!1,!1,"Setzt das Grafikobjekt vor alle anderen.",!1)),this.addMethod(new m("GanzNachHintenBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("GanzNachHintenBringen"))return a.sendToBack()},!1,!1,"Setzt das Grafikobjekt hinter alle anderen.",!1)),this.addMethod(new m("NachVornBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("NachVornBringen"))return a.bringOnePlaneFurtherToFront()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach vorne.",!1)),this.addMethod(new m("NachHintenBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("NachHintenBringen"))return a.bringOnePlaneFurtherToBack()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach hinten.",!1))}}class qA extends Pe{constructor(e){super("Aktionsempfaenger",e,"GNG: Interface für die Aktionsausführung"),this.addMethod(new m("Ausführen",new g([]),U,null,!1,!1,"Diese Methode wird vom Taktgeber aufgerufen.")),this.addMethod(new m("Taste",new g([{identifier:"taste",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Taste gedrückt wird.")),this.addMethod(new m("SonderTaste",new g([{identifier:"taste",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Sondertaste gedrückt wird.")),this.addMethod(new m("Geklickt",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine die linke Maustaste gedrückt wird."))}}class YA extends ${constructor(e,t){super("Dreieck",e,"Dreieck-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)"),this.setBaseClass(e.typeStore.getType("GNGBaseFigur")),this.addAttribute(new ce("breite",C,i=>{i.value=Math.round(i.object.gngAttributes.width)},!1,ee.protected,!1,"Breite des Dreiecks")),this.addAttribute(new ce("höhe",C,i=>{i.value=Math.round(i.object.gngAttributes.height)},!1,ee.protected,!1,"Höhe des Dreiecks")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("Dreieck",new g([]),null,i=>{let n=i[0].value;n.intrinsicData.isGNG=!0;let s=new ZA([60,10,110,110,10,110],!0,e.main.getInterpreter(),n);n.intrinsicData.Actor=s,n.gngAttributes={moveAnchor:{x:60,y:10},width:100,height:100,colorString:"rot"},s.centerXInitial=60,s.centerYInitial=60,s.setFillColor(16711680)},!1,!1,"Instanziert ein neues Dreieck-Objekt.",!0)),this.addMethod(new m("GrößeSetzen",new g([{identifier:"breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"höhe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor,a=i[1].value,l=i[2].value;s.testdestroyed("GrößeSetzen")||(n.gngAttributes.width=a,n.gngAttributes.height=l,s.renderGNG(n))},!1,!1,"Setzt die Breite und Höhe des Dreiecks.",!1))}}class ZA extends Ai{renderGNG(e){let t=e.gngAttributes,i=t.moveAnchor.x,n=t.moveAnchor.y,s=i,a=n+t.height/2;this.hitPolygonInitial=[{x:i,y:n},{x:i+t.width/2,y:n+t.height},{x:i-t.width/2,y:n+t.height}],this.render(),this.displayObject.localTransform.identity(),this.displayObject.localTransform.translate(-s,-a),this.displayObject.localTransform.rotate(-this.angle/180*Math.PI),this.displayObject.localTransform.translate(s,a),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0)}}class JA extends ${constructor(e,t){super("Kreis",e,"Kreis-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)"),this.setBaseClass(e.typeStore.getType("GNGBaseFigur")),this.addAttribute(new ce("radius",C,i=>{let n=i.object.intrinsicData.Actor;i.value=Math.round(n.r*n.displayObject.scale.x)},!1,ee.protected,!1,"Radius des Kreises")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("Kreis",new g([]),null,i=>{let n=i[0].value;n.intrinsicData.isGNG=!0;let s=new QA(60,60,50,e.main.getInterpreter(),n);n.intrinsicData.Actor=s,n.gngAttributes={moveAnchor:{x:60,y:10},width:100,height:100,colorString:"rot"},s.centerXInitial=60,s.centerYInitial=60,s.setFillColor(16711680)},!1,!1,"Instanziert ein neues Kreis-Objekt.",!0)),this.addMethod(new m("RadiusSetzen",new g([{identifier:"radius",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor,a=i[1].value;n.gngAttributes.width=2*a,n.gngAttributes.height=2*a,s.renderGNG(n)},!1,!1,"Setzt den Radius des Kreis-Objekts.",!1))}}class QA extends hs{renderGNG(e){let t=e.gngAttributes;this.mx=t.moveAnchor.x,this.my=t.moveAnchor.y,this.r=t.width/2,this.render()}}class eM extends ${constructor(e,t){super("GTurtle",e,"Turtle-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)");let i=t.getType("Object").type;this.baseClass=i,this.addAttribute(new ce("x",C,n=>{let s=n.object.intrinsicData.Actor;n.value=Math.round(s.lineElements[s.lineElements.length-1].x)},!1,ee.protected,!1,"x-Position der Figur")),this.addAttribute(new ce("y",C,n=>{let s=n.object.intrinsicData.Actor;n.value=Math.round(s.lineElements[s.lineElements.length-1].y)},!1,ee.protected,!1,"x-Position der Figur")),this.addAttribute(new ce("winkel",C,n=>{n.value=-n.object.intrinsicData.Actor.turtleAngleDeg},!1,ee.protected,!1,"Blickrichtung der Figur in Grad")),this.addAttribute(new ce("größe",C,n=>{n.value=Math.round(n.object.intrinsicData.Actor.scaleFactor*100)},!1,ee.protected,!1,"Größe der Figur (100 entspricht 'normalgroß')")),this.addAttribute(new ce("sichtbar",P,n=>{var s;n.value=(s=n.object.intrinsicData.Actor.displayObject)==null?void 0:s.visible},!1,ee.protected,!1,"true, wenn die Figur sichtbar ist")),this.addAttribute(new ce("stiftUnten",P,n=>{n.value=n.object.intrinsicData.Actor.penIsDown},!1,ee.protected,!1,"true, wenn die Turtle beim Gehen zeichnet")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("GTurtle",new g([]),null,n=>{let s=n[0].value;s.intrinsicData.isGNG=!0;let a=new ss(100,200,!0,e.main.getInterpreter(),s);a.borderWidth=1,a.setShowTurtle(!0),a.setBorderColor(0),s.intrinsicData.Actor=a,s.intrinsicData.moveAnchor={x:10,y:10},Oi.getHelper(e).registerEvents(s)},!1,!1,"Instanziert ein neues Turtle-Objekt.",!0)),this.addMethod(new m("GrößeSetzen",new g([{identifier:"größe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("größeSetzen")||(a.turtleSize=l,a.borderWidth=l/100,a.moveTurtleTo(0,0,0),a.initTurtle(0,0,a.angle),a.moveTurtleTo(a.lineElements[a.lineElements.length-1].x,a.lineElements[a.lineElements.length-1].y,a.angle),a.turn(0))},!1,!1,"Setzt die Größe des Turtle-Dreiecks.",!1)),this.addMethod(new m("FarbeSetzen",new g([{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value,o=Jr[l.toLocaleLowerCase()];o==null&&(o=0),!a.testdestroyed("FarbeSetzen")&&(a.setBorderColor(o),a.render())},!1,!1,"Setzt die Zeichenfarbe der Turtle.",!1)),this.addMethod(new m("Drehen",new g([{identifier:"grad",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("Drehen")||a.turn(l)},!1,!1,"Dreht die Turtle um den angegebenen Winkel. Positiver Winkel bedeutet Drehung gegen den Uhrzeigersinn.",!1)),this.addMethod(new m("Gehen",new g([{identifier:"länge",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("Gehen")||a.forward(l)},!1,!1,"Bewirkt, dass die Turtle um die angegebene Länge nach vorwärts geht.",!1)),this.addMethod(new m("StiftHeben",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("StiftHeben")||(a.penIsDown=!1)},!1,!1,"Bewirkt, dass die Turtle beim Gehen ab jetzt nicht mehr zeichnet.",!1)),this.addMethod(new m("StiftSenken",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("StiftSenken")||(a.penIsDown=!0)},!1,!1,"Bewirkt, dass die Turtle beim Gehen ab jetzt wieder zeichnet.",!1)),this.addMethod(new m("Löschen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("Löschen")||a.clear(100,200,0)},!1,!1,"Löscht alles von der Turtle gezeichnete und versetzt die Turtle in den Ausgangszustand.",!1)),this.addMethod(new m("PositionSetzen",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value,o=n[2].value;a.testdestroyed("PositionSetzen")||a.moveTo(l,o)},!1,!1,"Verschiebt die Turtle an die Position (x, y) ohne eine neue Linie zu zeichnen.",!1)),this.addMethod(new m("ZumStartpunktGehen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("ZumStartpunktGehen")||a.moveTo(100,200)},!1,!1,"Verschiebt die Turtle an die Position (100, 200) ohne eine neue Linie zu zeichnen.",!1)),this.addMethod(new m("WinkelSetzen",new g([{identifier:"winkel",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("WinkelSetzen")||a.turn(l+a.turtleAngleDeg)},!1,!1,"Setzt den Blickwinkel der Turtle. 0° => nach rechts, 90°: => nach oben, usw..",!1)),this.addMethod(new m("WinkelGeben",new g([]),C,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("WinkelGeben"))return Math.round(-a.turtleAngleDeg)},!1,!1,"Gibt den Blickwinkel der Turtle zurück.",!1)),this.addMethod(new m("XPositionGeben",new g([]),C,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("XPositionGeben"))return Math.round(a.lineElements[a.lineElements.length-1].x)},!1,!1,"Gibt x-Position der Turtle zurück.",!1)),this.addMethod(new m("YPositionGeben",new g([]),C,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("YPositionGeben"))return Math.round(a.lineElements[a.lineElements.length-1].y)},!1,!1,"Gibt y-Position der Turtle zurück.",!1)),this.addMethod(new m("SichtbarkeitSetzen",new g([{identifier:"sichtbarkeit",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let a=n[0].value.intrinsicData.Actor,l=n[1].value;a.testdestroyed("SichtbarkeitSetzen")||a.setVisible(l)},!1,!1,"Schaltet die Sichtbarkeit der Figur ein oder aus.",!1)),this.addMethod(new m("Entfernen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;a.testdestroyed("Entfernen")||a.destroy()},!1,!1,"Schaltet die Sichtbarkeit der Figur ein oder aus.",!1)),this.addMethod(new m("GanzNachVornBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("GanzNachVornBringen"))return a.bringToFront()},!1,!1,"Setzt das Grafikobjekt vor alle anderen.",!1)),this.addMethod(new m("GanzNachHintenBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("GanzNachHintenBringen"))return a.sendToBack()},!1,!1,"Setzt das Grafikobjekt hinter alle anderen.",!1)),this.addMethod(new m("NachVornBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("NachVornBringen"))return a.bringOnePlaneFurtherToFront()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach vorne.",!1)),this.addMethod(new m("NachHintenBringen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("NachHintenBringen"))return a.bringOnePlaneFurtherToBack()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach hinten.",!1)),this.addMethod(new m("Berührt",new g([]),P,n=>{let a=n[0].value.intrinsicData.Actor;if(!a.testdestroyed("Berührt"))return a.touchesAtLeastOneFigure()},!1,!1,"Gibt genau dann true zurück, wenn sich an der aktuellen Position der Turtle mindestens eine andere Figur befindet.",!1)),this.addMethod(new m("Berührt",new g([{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Actor;if(l.testdestroyed("Berührt"))return;let o=Jr[a];return o==null&&(o=0),l.touchesColor(o)},!1,!1,"Gibt genau dann true zurück, wenn sich an der aktuellen Position der Turtle mindestens eine andere Figur mit der angegebenen Farbe befindet.",!1)),this.addMethod(new m("Berührt",new g([{identifier:"objekt",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Actor,o=a.intrinsicData.Actor;if(o==null||!(o instanceof sa))return!1;if(!l.testdestroyed("Berührt"))return l.touchesShape(o)},!1,!1,"Gibt genau dann true zurück, wenn die übergebene Figur die aktuelle Turtleposition enthält.",!1)),this.addMethod(new m("AktionAusführen",new g([]),U,null,!1,!1,"Diese Methode wird vom Taktgeber aufgerufen.")),this.addMethod(new m("TasteGedrückt",new g([{identifier:"taste",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Taste gedrückt wird.")),this.addMethod(new m("SonderTasteGedrückt",new g([{identifier:"taste",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Sondertaste gedrückt wird.")),this.addMethod(new m("MausGeklickt",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine die linke Maustaste gedrückt wird."))}}class tM extends ${constructor(e,t){super("GText",e,"Text-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)"),this.setBaseClass(e.typeStore.getType("GNGBaseFigur")),this.addAttribute(new ce("text",F,i=>{i.value=i.object.intrinsicData.Actor.text},!1,ee.private,!1,"Angezeigter Text")),this.addAttribute(new ce("textgröße",C,i=>{i.value=i.object.intrinsicData.Actor.fontsize},!1,ee.private,!1,"Textgröße")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("Text",new g([]),null,i=>{let n=i[0].value;n.intrinsicData.isGNG=!0;let s=new iM(10,-3,12,"Text",e.main.getInterpreter(),n);n.gngAttributes={moveAnchor:{x:10,y:10},width:100,height:100,colorString:"schwarz"},s.centerXInitial=60,s.centerYInitial=60,s.setFillColor(0),n.intrinsicData.Actor=s},!1,!1,"Instanziert ein neues Text-Objekt.",!0)),this.addMethod(new m("TextSetzen",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor,a=i[1].value;s.testdestroyed("TextSetzen")||(s.text=a,s.renderGNG(n))},!1,!1,"Ändert den Text des Text-Objekts.",!1)),this.addMethod(new m("getText",new g([]),F,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getText"))return s.text},!1,!1,"Gibt den Textinhalt zurück.",!1)),this.addMethod(new m("TextGrößeSetzen",new g([{identifier:"textGröße",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor,a=i[1].value;s.fontsize=a,s.renderGNG(n)},!1,!1,"Setzt die Schriftgröße des Text-Objekts.",!1)),this.addMethod(new m("TextVergrößern",new g([]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(s.testdestroyed("TextVergrößern"))return;let a=s.fontsize;a<=10?a+=1:a<=40?a+=2:a+=4,s.fontsize=a,s.renderGNG(n)},!1,!1,"Vergrößert die Schriftgröße des Text-Objekts.",!1)),this.addMethod(new m("TextVerkleinern",new g([]),null,i=>{let n=i[0].value,s=n.intrinsicData.Actor;if(s.testdestroyed("TextVerkleinern"))return;let a=s.fontsize;a<=10?a-=1:a<=40?a-=2:a-=4,a<1&&(a=1),s.fontsize=a,s.renderGNG(n)},!1,!1,"Verkleinert die Schriftgröße des Text-Objekts.",!1))}}class iM extends Vs{renderGNG(e){let t=e.gngAttributes;this.x=t.moveAnchor.x,this.y=t.moveAnchor.y-this.fontsize,this.render();let i=this.x+this.centerXInitial,n=this.y+this.centerYInitial;this.displayObject.localTransform.identity(),this.displayObject.localTransform.translate(-this.centerXInitial,-this.centerYInitial),this.displayObject.localTransform.rotate(-this.angle/180*Math.PI),this.displayObject.localTransform.translate(i,n),this.displayObject.transform.onChange(),this.displayObject.updateTransform(),this.setHitPolygonDirty(!0)}}class nM extends ${constructor(e,t){let i=t.getType("Object").type;super("Figur",e,"Figur-Klasse der Graphics'n Games-Bibliothek (Cornelsen-Verlag)"),this.setBaseClass(i);let n=t.getType("Polygon").type,s=t.getType("Circle").type,a=t.getType("Ellipse").type,l=t.getType("Rectangle").type;this.addAttribute(new ce("x",C,o=>{o.value=Math.round(o.object.intrinsicData.Center.x)},!1,ee.private,!1,"x-Position der Figur")),this.addAttribute(new ce("y",C,o=>{o.value=Math.round(o.object.intrinsicData.Center.y)},!1,ee.private,!1,"y-Position der Figur")),this.addAttribute(new ce("winkel",C,o=>{o.value=o.object.intrinsicData.Actor.angle},!1,ee.private,!1,"Blickrichtung der Figur in Grad")),this.addAttribute(new ce("größe",C,o=>{o.value=Math.round(o.object.intrinsicData.Actor.scaleFactor*100)},!1,ee.private,!1,"Größe der Figur (100 entspricht 'normalgroß')")),this.addAttribute(new ce("sichtbar",P,o=>{var u;o.value=(u=o.object.intrinsicData.Actor.displayObject)==null?void 0:u.visible},!1,ee.private,!1,"true, wenn die Figur sichtbar ist")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("Figur",new g([]),null,o=>{let u=o[0].value;u.intrinsicData.isGNG=!0;let h=e.main.getInterpreter(),d=Oi.getHelper(e),p=new Kg(h,u,d);u.intrinsicData.Actor=p;let v={x:100,y:200};u.intrinsicData.Center=v,this.drawInitialTriangle(p,n,s,h,v),u.intrinsicData.isInitialTriangle=!0,p.scale(.4,v.x,v.y),p.displayObject.updateTransform(),d.registerEvents(u)},!1,!1,"Instanziert ein neues Figur-Objekt.",!0)),this.addMethod(new m("GrößeSetzen",new g([{identifier:"größe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor,d=o[1].value;if(h.testdestroyed("GrößeSetzen"))return;let p=u.intrinsicData.Center,v=d/100;h.scale(v/h.scaleFactor,p.x,p.y),h.displayObject.updateTransform()},!1,!1,"Setzt die Größe der Figur.",!1)),this.addMethod(new m("Drehen",new g([{identifier:"grad",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor,d=o[1].value;if(h.testdestroyed("Drehen"))return;let p=u.intrinsicData.Center;h.rotate(d,p.x,p.y),h.displayObject.updateTransform()},!1,!1,"Dreht die Figur um den angegebenen Winkel. Positiver Winkel bedeutet Drehung gegen den Uhrzeigersinn.",!1)),this.addMethod(new m("Gehen",new g([{identifier:"länge",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor,d=o[1].value;if(h.testdestroyed("Gehen"))return;let p=u.intrinsicData.Center,v=h.angle/180*Math.PI,w=d*Math.cos(v),_=d*Math.sin(-v);p.x+=w,p.y+=_,h.move(w,_),h.displayObject.updateTransform()},!1,!1,"Bewirkt, dass die Figur um die angegebene Länge 'nach vorne' geht.",!1)),this.addMethod(new m("PositionSetzen",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor,d=o[1].value,p=o[2].value;if(h.testdestroyed("PositionSetzen"))return;let v=u.intrinsicData.Center;h.move(d-v.x,p-v.y),h.displayObject.updateTransform(),v.x=d,v.y=p},!1,!1,"Verschiebt die Figur an die Position (x, y).",!1)),this.addMethod(new m("ZumStartpunktGehen",new g([]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor;if(h.testdestroyed("ZumStartpunktGehen"))return;let d=u.intrinsicData.Center;h.move(100-d.x,200-d.y),h.displayObject.updateTransform(),d.x=100,d.y=200},!1,!1,"Verschiebt die Figur an die Position (100, 200).",!1)),this.addMethod(new m("WinkelSetzen",new g([{identifier:"winkel",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let h=o[0].value.intrinsicData.Actor,d=o[1].value;h.testdestroyed("WinkelSetzen")||(h.rotate(d-h.angle),h.displayObject.updateTransform())},!1,!1,"Dreht die Figur so, dass der Blickwinkel der Figur in die angegebene Richtung zeigt. 0° => nach rechts (initial), 90°: => nach oben, usw..",!1)),this.addMethod(new m("WinkelGeben",new g([]),C,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("WinkelGeben"))return h.angle<0&&(h.angle+=360*Math.ceil(h.angle/-360)),h.angle>=360&&(h.angle-=360*Math.floor(h.angle/360)),Math.round(h.angle)},!1,!1,"Gibt den Blickwinkel der Figur zurück.",!1)),this.addMethod(new m("XPositionGeben",new g([]),C,o=>{let u=o[0].value;return u.intrinsicData.Actor.testdestroyed("XPositionGeben")?void 0:u.intrinsicData.Center.x},!1,!1,"Gibt x-Position der Figur zurück.",!1)),this.addMethod(new m("YPositionGeben",new g([]),C,o=>{let u=o[0].value;return u.intrinsicData.Actor.testdestroyed("YPositionGeben")?void 0:u.intrinsicData.Center.y},!1,!1,"Gibt y-Position der Figur zurück.",!1)),this.addMethod(new m("SichtbarkeitSetzen",new g([{identifier:"sichtbarkeit",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let h=o[0].value.intrinsicData.Actor,d=o[1].value;h.testdestroyed("SichtbarkeitSetzen")||h.setVisible(d)},!1,!1,"Schaltet die Sichtbarkeit der Figur ein oder aus.",!1)),this.addMethod(new m("Entfernen",new g([]),null,o=>{let h=o[0].value.intrinsicData.Actor;h.testdestroyed("Entfernen")||h.destroy()},!1,!1,"Entfernt die Figur aus dem Zeichenfenster",!1)),this.addMethod(new m("GanzNachVornBringen",new g([]),null,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("GanzNachVornBringen"))return h.bringToFront()},!1,!1,"Setzt das Grafikobjekt vor alle anderen.",!1)),this.addMethod(new m("GanzNachHintenBringen",new g([]),null,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("GanzNachHintenBringen"))return h.sendToBack()},!1,!1,"Setzt das Grafikobjekt hinter alle anderen.",!1)),this.addMethod(new m("NachVornBringen",new g([]),null,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("NachVornBringen"))return h.bringOnePlaneFurtherToFront()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach vorne.",!1)),this.addMethod(new m("NachHintenBringen",new g([]),null,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("NachHintenBringen"))return h.bringOnePlaneFurtherToBack()},!1,!1,"Setzt das Grafikobjekt eine Ebene nach hinten.",!1)),this.addMethod(new m("EigeneFigurLöschen",new g([]),null,o=>{let u=o[0].value,h=u.intrinsicData.Actor;if(h.testdestroyed("EigeneFigurLöschen"))return;h.destroyChildren();let d=u.intrinsicData.Center;this.drawInitialTriangle(h,n,s,this.module.main.getInterpreter(),d),u.intrinsicData.isInitialTriangle=!0},!1,!1,"Löscht die hinzugefügten Figuren",!1)),this.addMethod(new m("Berührt",new g([]),P,o=>{let h=o[0].value.intrinsicData.Actor;if(!h.testdestroyed("Berührt")){for(let d of h.worldHelper.shapes)if(d!=h&&h.collidesWith(d))return!0;return!1}},!1,!1,"Gibt genau dann true zurück, wenn die Figur mit einem graphischen Objekt kollidiert.",!1)),this.addMethod(new m("Berührt",new g([{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1].value,d=u.intrinsicData.Actor;if(d.testdestroyed("Berührt"))return;let p=Jr[h];p==null&&(p=0);for(let v of d.worldHelper.shapes)if(v!=d){if(v instanceof Kg)for(let w of v.shapes){let _=w.intrinsicData.Actor;if(_ instanceof vi&&p==_.fillColor&&d.collidesWith(_))return!0}else if(v instanceof vi&&p==v.fillColor&&d.collidesWith(v))return!0}return!1},!1,!1,"Gibt genau dann true zurück, wenn die Figur mit einem graphischen Objekt der angegebenen Farbe kollidiert.",!1)),this.addMethod(new m("Berührt",new g([{identifier:"objekt",type:i,declaration:null,usagePositions:null,isFinal:!0}]),P,o=>{let u=o[0].value,h=o[1].value,d=u.intrinsicData.Actor,p=h.intrinsicData.Actor;if(p==null||!(p instanceof sa))return!1;if(!d.testdestroyed("Berührt"))return d.collidesWith(p)},!1,!1,"Gibt genau dann true zurück, wenn die Figur mit dem übergebenen graphischen Objekt kollidiert.",!1)),this.addMethod(new m("FigurteilFestlegenDreieck",new g([{identifier:"x1",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y1",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x2",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y2",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x3",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y3",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=o[1].value,d=o[2].value,p=o[3].value,v=o[4].value,w=o[5].value,_=o[6].value,T=o[7].value,D=u.intrinsicData.Actor;if(D.testdestroyed("FigurteilFestlegenDreieck"))return;u.intrinsicData.isInitialTriangle&&(u.intrinsicData.isInitialTriangle=!1,D.destroyChildren());let L=Jr[T];L==null&&(L=0);let O=new he(n),z=new Ai([h,d,p,v,w,_],!0,this.module.main.getInterpreter(),O);O.intrinsicData.Actor=z;let V=u.intrinsicData.Center;z.rotate(D.angle,0,0),z.scale(D.scaleFactor,0,0),z.move(V.x,V.y),z.setFillColor(L),z.setBorderColor("black"),z.setBorderWidth(2),D.add(O)},!1,!1,"Erzeugt ein neues, dreieckiges Element und fügt es der Figur hinzu.",!1)),this.addMethod(new m("FigurteilFestlegenRechteck",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"höhe",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=o[1].value,d=o[2].value,p=o[3].value,v=o[4].value,w=o[5].value,_=u.intrinsicData.Actor;if(_.testdestroyed("FigurteilFestlegenRechteck"))return;u.intrinsicData.isInitialTriangle&&(u.intrinsicData.isInitialTriangle=!1,_.destroyChildren());let T=Jr[w];T==null&&(T=0);let D=new he(l),L=new ta(h+.05,d+.05,p-.1,v-.1,this.module.main.getInterpreter(),D);D.intrinsicData.Actor=L;let O=u.intrinsicData.Center;L.rotate(_.angle,0,0),L.scale(_.scaleFactor,0,0),L.move(O.x,O.y),L.setFillColor(T),L.setBorderColor("black"),L.setBorderWidth(2),_.add(D)},!1,!1,"Erzeugt ein neues, rechteckiges Element einer eigenen Darstellung der Figur.",!1)),this.addMethod(new m("FigurteilFestlegenEllipse",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"höhe",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,o=>{let u=o[0].value,h=o[1].value,d=o[2].value,p=o[3].value,v=o[4].value,w=o[5].value,_=u.intrinsicData.Actor;if(_.testdestroyed("FigurteilFestlegenEllipse"))return;u.intrinsicData.isInitialTriangle&&(u.intrinsicData.isInitialTriangle=!1,_.destroyChildren());let T=Jr[w];T==null&&(T=0),v=v-.1,p=p-.1;let D=new he(a),L=new hl(h+p/2+.05,d+v/2+.05,p/2,v/2,this.module.main.getInterpreter(),D);D.intrinsicData.Actor=L;let O=u.intrinsicData.Center;L.rotate(_.angle,0,0),L.scale(_.scaleFactor,0,0),L.move(O.x,O.y),L.setFillColor(T),L.setBorderColor("black"),L.setBorderWidth(2),_.add(D)},!1,!1,"Erzeugt ein neues, elliptisches Element einer eigenen Darstellung der Figur.",!1)),this.addMethod(new m("AktionAusführen",new g([]),U,null,!1,!1,"Diese Methode wird vom Taktgeber aufgerufen.")),this.addMethod(new m("TasteGedrückt",new g([{identifier:"taste",type:Ge,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Taste gedrückt wird.")),this.addMethod(new m("SonderTasteGedrückt",new g([{identifier:"taste",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine Sondertaste gedrückt wird.")),this.addMethod(new m("MausGeklickt",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!1,!1,"Wird aufgerufen, wenn eine die linke Maustaste gedrückt wird."))}drawInitialTriangle(e,t,i,n,s){let a=new he(t),l=new Ai([-50,-50,50,0,-50,50],!0,n,a);a.intrinsicData.Actor=l,l.move(s.x,s.y),l.setFillColor("yellow"),l.setBorderColor("black"),l.setBorderWidth(2),e.add(a);let o=new he(i),u=new hs(0,0,10,n,o);o.intrinsicData.Actor=u,u.move(s.x,s.y),u.setFillColor("blue"),u.setBorderColor("black"),u.setBorderWidth(2),e.add(o)}}class Kg extends kr{constructor(e,t,i){super(e,t),this.gngEreignisbehandlungsHelper=i}destroy(){this.gngEreignisbehandlungsHelper.unregisterEvents(this.runtimeObject),super.destroy()}}class rM extends ${constructor(e){super("Random",e,"Zufallszahlengenerator"),this.setBaseClass(e.typeStore.getType("Object")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("nextInt",new g([{identifier:"bound",type:C,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),C,t=>{t[0].value;let i=t[1].value;return Math.floor(Math.random()*i)},!1,!1,"Gibt eine ganzzahlige Zufallszahl aus der Menge {0, 1, ..., bound - 1} zurück.",!1)),this.addMethod(new m("randint",new g([{identifier:"from",type:C,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"to",type:C,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),C,t=>{let i=t[1].value,n=t[2].value;return Math.floor(Math.random()*(n-i+1)+i)},!1,!0,"Gibt eine ganzzahlige Zufallszahl aus der Menge {from, from + 1, ..., to} zurück.",!1)),this.addMethod(new m("randdouble",new g([{identifier:"from",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"to",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),A,t=>{let i=t[1].value,n=t[2].value;return Math.random()*(n-i)+i},!1,!0,"Gibt eine Zufallszahl aus dem Intervall [from, to[ zurück.",!1))}}class sM extends $t{constructor(e){super("Direction",e,[{type:f.pushEnumValue,position:null,identifier:"top"},{type:f.pushEnumValue,position:null,identifier:"right"},{type:f.pushEnumValue,position:null,identifier:"bottom"},{type:f.pushEnumValue,position:null,identifier:"left"}]),this.documentation="Richtung (oben, rechts, unten, links)"}}const du=class du{static patch(e){let t=!1;for(let i of du.patches)e.match(i.old)!=null&&(e=e.replace(i.old,i.new),t=!0);return{patchedText:e,modified:t}}};y(du,"patches",[{old:/SpriteLibrary.Ship_Adrian,\s*0/g,new:"SpriteLibrary.Space_Shooter_1, 0"},{old:/SpriteLibrary.Ship_Adrian,\s*1/g,new:"SpriteLibrary.Space_Shooter_1, 1"},{old:/SpriteLibrary.Ship_Adrian,\s*2/g,new:"SpriteLibrary.Space_Shooter_1, 2"},{old:/SpriteLibrary.Ship_Adrian,\s*3/g,new:"SpriteLibrary.Space_Shooter_1, 3"},{old:/SpriteLibrary.Ship_Adrian,\s*4/g,new:"SpriteLibrary.Space_Shooter_1, 4"},{old:/SpriteLibrary.Schuss_Adrian,\s*0/g,new:"SpriteLibrary.Space_Shooter_1, 5"},{old:/SpriteLibrary.Schuss_Adrian,\s*1/g,new:"SpriteLibrary.Space_Shooter_1, 6"},{old:/SpriteLibrary.Schuss_Adrian,\s*2/g,new:"SpriteLibrary.Space_Shooter_1, 7"},{old:/SpriteLibrary.Schuss_Adrian,\s*3/g,new:"SpriteLibrary.Space_Shooter_1, 8"},{old:/SpriteLibrary.Schuss_Adrian,\s*4/g,new:"SpriteLibrary.Space_Shooter_1, 9"},{old:/SpriteLibrary.Asteroid_Adrian,\s*0/g,new:"SpriteLibrary.Space_Shooter_1, 10"},{old:/SpriteLibrary.Gegner_Adrian,\s*0/g,new:"SpriteLibrary.Space_Shooter_1, 11"},{old:/SpriteLibrary.Explosion_Adrian,\s*0/g,new:"SpriteLibrary.Space_Shooter_1, 12"},{old:/SpriteLibrary.Explosion_Adrian,\s*1/g,new:"SpriteLibrary.Space_Shooter_1, 13"},{old:/SpriteLibrary.Explosion_Adrian,\s*2/g,new:"SpriteLibrary.Space_Shooter_1, 14"},{old:/SpriteLibrary.Explosion_Adrian,\s*3/g,new:"SpriteLibrary.Space_Shooter_1, 15"},{old:/SpriteLibrary.Explosion_Adrian,\s*4/g,new:"SpriteLibrary.Space_Shooter_1, 16"},{old:/SpriteLibrary.Explosion_Adrian,\s*5/g,new:"SpriteLibrary.Space_Shooter_1, 17"},{old:/SpriteLibrary.Explosion_Adrian,\s*6/g,new:"SpriteLibrary.Space_Shooter_1, 18"},{old:/SpriteLibrary.Explosion_Adrian,\s*7/g,new:"SpriteLibrary.Space_Shooter_1, 19"},{old:/SpriteLibrary.Explosion_Adrian,\s*8/g,new:"SpriteLibrary.Space_Shooter_1, 20"},{old:/SpriteLibrary.Explosion_Adrian,\s*9/g,new:"SpriteLibrary.Space_Shooter_1, 21"},{old:/SpriteLibrary.Explosion_Adrian,\s*10/g,new:"SpriteLibrary.Space_Shooter_1, 22"},{old:/SpriteLibrary.Explosion_Adrian,\s*11/g,new:"SpriteLibrary.Space_Shooter_1, 23"}]);let $d=du;class aM extends ${constructor(e,t){super("KeyEvent",e,"Nachbildung von java.awt.event.KeyEvent"),this.setBaseClass(t.getType("Object").type);let i=[{name:"VK_ENTER",code:13},{name:"VK_LEFT",code:37},{name:"VK_UP",code:38},{name:"VK_RIGHT",code:39},{name:"VK_DOWN",code:40},{name:"VK_PAGE_UP",code:33},{name:"VK_PAGE_DOWN",code:34},{name:"VK_INSERT",code:155}];for(let n=1;n<=12;n++)i.push({name:"VK"+n,code:111+n});for(let n of i)this.addAttribute(new ce(n.name,C,s=>{s.value=n.code},!0,ee.public,!0,"KeyCode für die Taste "+n.name));this.setupAttributeIndicesRecursive(),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass)}}var Ft;(r=>{function e(t,i){return t[i]}r.get=e})(Ft||(Ft={}));var Tr=(r=>(r[r.buffer=0]="buffer",r[r.json=1]="json",r[r.text=2]="text",r))(Tr||{});class mb{setLoaderResourceExtensionType(e,t){let i=LoaderResource.XHR_RESPONSE_TYPE.TEXT;t===Tr.buffer?i=LoaderResource.XHR_RESPONSE_TYPE.BUFFER:t===Tr.json&&(i=LoaderResource.XHR_RESPONSE_TYPE.JSON),LoaderResource.setExtensionXhrType(e,i)}getInteractionPlugin(e){return e.plugins.interaction}get assets(){}isRendererDestroyed(e){return!e.gl}installRendererPlugin(e,t){Ir.registerPlugin(e,t)}installLoaderPlugin(e,t){Loader.registerPlugin(t)}render(e,t,i){e.render(t,i)}}class yb extends mb{render(e,t,i){e.render(t,{renderTexture:i})}}class bb extends yb{installRendererPlugin(e,t){t.extension={type:Ft.get(Mt,"ExtensionType").RendererPlugin,name:e},Ft.get(Mt,"extensions").add(t)}installLoaderPlugin(e,t){t.extension={type:Ft.get(Mt,"ExtensionType").Loader,name:e},Ft.get(Mt,"extensions").add(t)}}class lM extends bb{setLoaderResourceExtensionType(e,t){}getInteractionPlugin(e){}get assets(){return yi}isRendererDestroyed(e){return"_systemsHash"in e?Object.keys(e._systemsHash).length===0:!1}installRendererPlugin(e,t){t.extension={type:[Ft.get(Mt,"ExtensionType").RendererPlugin],name:e},Ft.get(Mt,"extensions").add(t)}installLoaderPlugin(e,t){t.extension={type:[Ft.get(Mt,"ExtensionType").Loader,Ft.get(Mt,"ExtensionType").LoadParser],name:e},Ft.get(Mt,"extensions").add(t)}}const oM="VERSION"in Mt&&Ft.get(Mt,"VERSION").startsWith("7"),uM="extensions"in Mt,hM="ArrayResource"in Mt,xt=oM?new lM:uM?new bb:hM?new yb:new mb;class ji{constructor(e,t=[],i=[]){this.descriptor=e,this.buffers=t,this.images=i,this.textures=[]}static load(e,t,i){let n=new ji(e);return cM(e,s=>{s.forEach(a=>n.buffers.push(a)),qg(e,s,a=>{a.forEach(l=>n.images.push(l)),i&&i(n)},t)},t),n}static isValidBuffer(e){const t=new Uint32Array(e,0,3);return t[0]===1179937895&&t[1]===2}static isEmbeddedResource(e){return e&&e.startsWith("data:")}static fromBuffer(e,t){const i=[];let n=12;for(;n<e.byteLength;){const o=new Uint32Array(e,n,3);i.push({length:o[0],type:o[1],offset:n+2*4}),n+=o[0]+2*4}const s=new Uint8Array(e,i[0].offset,i[0].length),a=JSON.parse(new TextDecoder("utf-8").decode(s)),l=[];for(let o=1;o<i.length;o++)l.push(e.slice(i[o].offset,i[o].offset+i[o].length));qg(a,l,o=>{t(new ji(a,l,o))})}static async fromURL(e,t){if(!xt.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const i=await ge.ADAPTER.fetch(e,t);return new Promise(async n=>{if(e.includes(".glb")){let s=await i.arrayBuffer();ji.fromBuffer(s,a=>{n(a)})}else{let s=await i.json();ji.load(s,new dM(e),a=>{n(a)})}})}}class dM{constructor(e){this.parentURL=e}load(e,t){const i=this.parentURL.substring(0,this.parentURL.lastIndexOf("/")+1)+e;(async()=>{if(!xt.assets)throw new Error("PIXI3D: Assets are not available in current version of PixiJS.");let s={};if(i.includes(".bin")){const a=await ge.ADAPTER.fetch(i);s.data=await a.arrayBuffer()}else{let a=await xt.assets.load(i);a&&(s.texture=a)}t(s)})()}}function qg(r,e,t,i){const n=[];if(!r.images||r.images.length===0)return t(n);let s=r.images.filter(p=>typeof p.bufferView!="number"&&ji.isEmbeddedResource(p.uri)).map((p,v)=>v),a=r.images.filter(p=>typeof p.bufferView!="number"&&!ji.isEmbeddedResource(p.uri)).map((p,v)=>v),l=r.images.filter(p=>typeof p.bufferView=="number").map((p,v)=>v);for(let p=0;p<s.length;p++){let v=s[p],w=r.images[v];n[v]=ye.from(w.uri)}if(l.length===0&&a.length===0)return t(n);if(a.length>0&&!i)throw new Error("PIXI3D: A resource loader is required when image is external.");const o=(p,v,w)=>{i==null||i.load(p.uri,_=>{_.texture&&(n[v]=_.texture,w())})},u=(p,v,w)=>{fM(p,r,e,_=>{n[v]=_,w()})};let h=a.length,d=l.length;for(let p=0;p<a.length;p++){let v=a[p],w=r.images[v];o(w,v,()=>{--h===0&&d===0&&t(n)})}for(let p=0;p<l.length;p++){let v=l[p],w=r.images[v];u(w,v,()=>{--d===0&&h===0&&t(n)})}}function cM(r,e,t){const i=[],n=r.buffers.filter(o=>ji.isEmbeddedResource(o.uri)).map((o,u)=>u);for(let o=0;o<n.length;o++){let u=n[o],h=r.buffers[u];i[u]=pM(h.uri)}const s=r.buffers.filter(o=>!ji.isEmbeddedResource(o.uri)).map((o,u)=>u);if(s.length===0)return e(i);if(!t)throw new Error("PIXI3D: A resource loader is required when buffer is not embedded.");const a=(o,u,h)=>{t.load(o,d=>{i[u]=d.data,h()})};let l=s.length;for(let o=0;o<s.length;o++){let u=s[o],h=r.buffers[u];a(h.uri,u,()=>{--l===0&&e(i)})}}function fM(r,e,t,i){const n=e.bufferViews[r.bufferView],s=new Uint8Array(t[n.buffer],n.byteOffset,n.byteLength),a=new Blob([s],{type:r.mimeType}),l=new FileReader;l.onload=()=>{i(ye.from(l.result))},l.readAsDataURL(a)}function pM(r){return Uint8Array.from(atob(r.split(",")[1]),e=>e.charCodeAt(0)).buffer}const gM={use:function(r,e){if(r.extension!=="gltf")return e();let t=this;ji.load(r.data,new mM(t,r),i=>{Object.assign(r,{gltf:i}),e()})},add:function(){xt.setLoaderResourceExtensionType("bin",Tr.buffer),xt.setLoaderResourceExtensionType("gltf",Tr.json)},test(r){return r.includes(".gltf")||r.includes(".glb")},async load(r){return await ji.fromURL(r)}};xt.installLoaderPlugin("gltf",gM);class mM{constructor(e,t){this._loader=e,this._resource=t}load(e,t){const i=this._resource.url.substring(0,this._resource.url.lastIndexOf("/")+1)+e;if(!this._loader.resources[i])this._loader.add({parentResource:this._resource,url:i,onComplete:t});else if(this._loader.resources[i].data)t(this._loader.resources[i]);else{let n=this._loader.onProgress.add((s,a)=>{a.url===i&&(t(a),n.detach())})}}}const yM={use:function(r,e){if(r.extension!=="glb")return e();if(ji.isValidBuffer(r.data))ji.fromBuffer(r.data,t=>{Object.assign(r,{gltf:t}),e()});else return e()},add:function(){xt.setLoaderResourceExtensionType("glb",Tr.buffer)}};xt.installLoaderPlugin("cubemap",yM);var $s=1e-6,Ui=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function bM(){var r=new Ui(9);return Ui!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function vM(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],l=e[4],o=e[5],u=e[6],h=e[7],d=e[8],p=t[0],v=t[1],w=t[2],_=t[3],T=t[4],D=t[5],L=t[6],O=t[7],z=t[8];return r[0]=p*i+v*a+w*u,r[1]=p*n+v*l+w*h,r[2]=p*s+v*o+w*d,r[3]=_*i+T*a+D*u,r[4]=_*n+T*l+D*h,r[5]=_*s+T*o+D*d,r[6]=L*i+O*a+z*u,r[7]=L*n+O*l+z*h,r[8]=L*s+O*o+z*d,r}function wM(){var r=new Ui(16);return Ui!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function xM(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function vb(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function SM(r,e){if(r===e){var t=e[1],i=e[2],n=e[3],s=e[6],a=e[7],l=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=i,r[9]=s,r[11]=e[14],r[12]=n,r[13]=a,r[14]=l}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function _M(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],l=e[5],o=e[6],u=e[7],h=e[8],d=e[9],p=e[10],v=e[11],w=e[12],_=e[13],T=e[14],D=e[15],L=t*l-i*a,O=t*o-n*a,z=t*u-s*a,V=i*o-n*l,Q=i*u-s*l,S=n*u-s*o,Z=h*_-d*w,re=h*T-p*w,me=h*D-v*w,le=d*T-p*_,oe=d*D-v*_,X=p*D-v*T,K=L*X-O*oe+z*le+V*me-Q*re+S*Z;return K?(K=1/K,r[0]=(l*X-o*oe+u*le)*K,r[1]=(n*oe-i*X-s*le)*K,r[2]=(_*S-T*Q+D*V)*K,r[3]=(p*Q-d*S-v*V)*K,r[4]=(o*me-a*X-u*re)*K,r[5]=(t*X-n*me+s*re)*K,r[6]=(T*z-w*S-D*O)*K,r[7]=(h*S-p*z+v*O)*K,r[8]=(a*oe-l*me+u*Z)*K,r[9]=(i*me-t*oe-s*Z)*K,r[10]=(w*Q-_*z+D*L)*K,r[11]=(d*z-h*Q-v*L)*K,r[12]=(l*re-a*le-o*Z)*K,r[13]=(t*le-i*re+n*Z)*K,r[14]=(_*O-w*V-T*L)*K,r[15]=(h*V-d*O+p*L)*K,r):null}function kM(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3],l=e[4],o=e[5],u=e[6],h=e[7],d=e[8],p=e[9],v=e[10],w=e[11],_=e[12],T=e[13],D=e[14],L=e[15],O=t[0],z=t[1],V=t[2],Q=t[3];return r[0]=O*i+z*l+V*d+Q*_,r[1]=O*n+z*o+V*p+Q*T,r[2]=O*s+z*u+V*v+Q*D,r[3]=O*a+z*h+V*w+Q*L,O=t[4],z=t[5],V=t[6],Q=t[7],r[4]=O*i+z*l+V*d+Q*_,r[5]=O*n+z*o+V*p+Q*T,r[6]=O*s+z*u+V*v+Q*D,r[7]=O*a+z*h+V*w+Q*L,O=t[8],z=t[9],V=t[10],Q=t[11],r[8]=O*i+z*l+V*d+Q*_,r[9]=O*n+z*o+V*p+Q*T,r[10]=O*s+z*u+V*v+Q*D,r[11]=O*a+z*h+V*w+Q*L,O=t[12],z=t[13],V=t[14],Q=t[15],r[12]=O*i+z*l+V*d+Q*_,r[13]=O*n+z*o+V*p+Q*T,r[14]=O*s+z*u+V*v+Q*D,r[15]=O*a+z*h+V*w+Q*L,r}function TM(r,e,t){var i=t[0],n=t[1],s=t[2],a,l,o,u,h,d,p,v,w,_,T,D;return e===r?(r[12]=e[0]*i+e[4]*n+e[8]*s+e[12],r[13]=e[1]*i+e[5]*n+e[9]*s+e[13],r[14]=e[2]*i+e[6]*n+e[10]*s+e[14],r[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],l=e[1],o=e[2],u=e[3],h=e[4],d=e[5],p=e[6],v=e[7],w=e[8],_=e[9],T=e[10],D=e[11],r[0]=a,r[1]=l,r[2]=o,r[3]=u,r[4]=h,r[5]=d,r[6]=p,r[7]=v,r[8]=w,r[9]=_,r[10]=T,r[11]=D,r[12]=a*i+h*n+w*s+e[12],r[13]=l*i+d*n+_*s+e[13],r[14]=o*i+p*n+T*s+e[14],r[15]=u*i+v*n+D*s+e[15]),r}function CM(r,e,t){var i=t[0],n=t[1],s=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function AM(r,e,t,i){var n=i[0],s=i[1],a=i[2],l=Math.hypot(n,s,a),o,u,h,d,p,v,w,_,T,D,L,O,z,V,Q,S,Z,re,me,le,oe,X,K,_e;return l<$s?null:(l=1/l,n*=l,s*=l,a*=l,o=Math.sin(t),u=Math.cos(t),h=1-u,d=e[0],p=e[1],v=e[2],w=e[3],_=e[4],T=e[5],D=e[6],L=e[7],O=e[8],z=e[9],V=e[10],Q=e[11],S=n*n*h+u,Z=s*n*h+a*o,re=a*n*h-s*o,me=n*s*h-a*o,le=s*s*h+u,oe=a*s*h+n*o,X=n*a*h+s*o,K=s*a*h-n*o,_e=a*a*h+u,r[0]=d*S+_*Z+O*re,r[1]=p*S+T*Z+z*re,r[2]=v*S+D*Z+V*re,r[3]=w*S+L*Z+Q*re,r[4]=d*me+_*le+O*oe,r[5]=p*me+T*le+z*oe,r[6]=v*me+D*le+V*oe,r[7]=w*me+L*le+Q*oe,r[8]=d*X+_*K+O*_e,r[9]=p*X+T*K+z*_e,r[10]=v*X+D*K+V*_e,r[11]=w*X+L*K+Q*_e,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function MM(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[4],a=e[5],l=e[6],o=e[7],u=e[8],h=e[9],d=e[10],p=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*n+u*i,r[5]=a*n+h*i,r[6]=l*n+d*i,r[7]=o*n+p*i,r[8]=u*n-s*i,r[9]=h*n-a*i,r[10]=d*n-l*i,r[11]=p*n-o*i,r}function EM(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],l=e[2],o=e[3],u=e[8],h=e[9],d=e[10],p=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n-u*i,r[1]=a*n-h*i,r[2]=l*n-d*i,r[3]=o*n-p*i,r[8]=s*i+u*n,r[9]=a*i+h*n,r[10]=l*i+d*n,r[11]=o*i+p*n,r}function PM(r,e,t){var i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],l=e[2],o=e[3],u=e[4],h=e[5],d=e[6],p=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n+u*i,r[1]=a*n+h*i,r[2]=l*n+d*i,r[3]=o*n+p*i,r[4]=u*n-s*i,r[5]=h*n-a*i,r[6]=d*n-l*i,r[7]=p*n-o*i,r}function IM(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function DM(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function FM(r,e,t){var i=t[0],n=t[1],s=t[2],a=Math.hypot(i,n,s),l,o,u;return a<$s?null:(a=1/a,i*=a,n*=a,s*=a,l=Math.sin(e),o=Math.cos(e),u=1-o,r[0]=i*i*u+o,r[1]=n*i*u+s*l,r[2]=s*i*u-n*l,r[3]=0,r[4]=i*n*u-s*l,r[5]=n*n*u+o,r[6]=s*n*u+i*l,r[7]=0,r[8]=i*s*u+n*l,r[9]=n*s*u-i*l,r[10]=s*s*u+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function RM(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function wb(r,e){var t=e[0],i=e[1],n=e[2],s=e[4],a=e[5],l=e[6],o=e[8],u=e[9],h=e[10];return r[0]=Math.hypot(t,i,n),r[1]=Math.hypot(s,a,l),r[2]=Math.hypot(o,u,h),r}function OM(r,e){var t=new Ui(3);wb(t,e);var i=1/t[0],n=1/t[1],s=1/t[2],a=e[0]*i,l=e[1]*n,o=e[2]*s,u=e[4]*i,h=e[5]*n,d=e[6]*s,p=e[8]*i,v=e[9]*n,w=e[10]*s,_=a+h+w,T=0;return _>0?(T=Math.sqrt(_+1)*2,r[3]=.25*T,r[0]=(d-v)/T,r[1]=(p-o)/T,r[2]=(l-u)/T):a>h&&a>w?(T=Math.sqrt(1+a-h-w)*2,r[3]=(d-v)/T,r[0]=.25*T,r[1]=(l+u)/T,r[2]=(p+o)/T):h>w?(T=Math.sqrt(1+h-a-w)*2,r[3]=(p-o)/T,r[0]=(l+u)/T,r[1]=.25*T,r[2]=(d+v)/T):(T=Math.sqrt(1+w-a-h)*2,r[3]=(l-u)/T,r[0]=(p+o)/T,r[1]=(d+v)/T,r[2]=.25*T),r}function LM(r,e,t,i){var n=e[0],s=e[1],a=e[2],l=e[3],o=n+n,u=s+s,h=a+a,d=n*o,p=n*u,v=n*h,w=s*u,_=s*h,T=a*h,D=l*o,L=l*u,O=l*h,z=i[0],V=i[1],Q=i[2];return r[0]=(1-(w+T))*z,r[1]=(p+O)*z,r[2]=(v-L)*z,r[3]=0,r[4]=(p-O)*V,r[5]=(1-(d+T))*V,r[6]=(_+D)*V,r[7]=0,r[8]=(v+L)*Q,r[9]=(_-D)*Q,r[10]=(1-(d+w))*Q,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function BM(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t+t,l=i+i,o=n+n,u=t*a,h=i*a,d=i*l,p=n*a,v=n*l,w=n*o,_=s*a,T=s*l,D=s*o;return r[0]=1-d-w,r[1]=h+D,r[2]=p-T,r[3]=0,r[4]=h-D,r[5]=1-u-w,r[6]=v+_,r[7]=0,r[8]=p+T,r[9]=v-_,r[10]=1-u-d,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function zM(r,e,t,i,n){var s=1/Math.tan(e/2),a;return r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=(n+i)*a,r[14]=2*n*i*a):(r[10]=-1,r[14]=-2*i),r}var jM=zM;function NM(r,e,t,i,n,s,a){var l=1/(e-t),o=1/(i-n),u=1/(s-a);return r[0]=-2*l,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*u,r[11]=0,r[12]=(e+t)*l,r[13]=(n+i)*o,r[14]=(a+s)*u,r[15]=1,r}var GM=NM;function WM(r,e,t,i){var n,s,a,l,o,u,h,d,p,v,w=e[0],_=e[1],T=e[2],D=i[0],L=i[1],O=i[2],z=t[0],V=t[1],Q=t[2];return Math.abs(w-z)<$s&&Math.abs(_-V)<$s&&Math.abs(T-Q)<$s?vb(r):(h=w-z,d=_-V,p=T-Q,v=1/Math.hypot(h,d,p),h*=v,d*=v,p*=v,n=L*p-O*d,s=O*h-D*p,a=D*d-L*h,v=Math.hypot(n,s,a),v?(v=1/v,n*=v,s*=v,a*=v):(n=0,s=0,a=0),l=d*a-p*s,o=p*n-h*a,u=h*s-d*n,v=Math.hypot(l,o,u),v?(v=1/v,l*=v,o*=v,u*=v):(l=0,o=0,u=0),r[0]=n,r[1]=l,r[2]=h,r[3]=0,r[4]=s,r[5]=o,r[6]=d,r[7]=0,r[8]=a,r[9]=u,r[10]=p,r[11]=0,r[12]=-(n*w+s*_+a*T),r[13]=-(l*w+o*_+u*T),r[14]=-(h*w+d*_+p*T),r[15]=1,r)}function HM(r,e,t,i){var n=e[0],s=e[1],a=e[2],l=i[0],o=i[1],u=i[2],h=n-t[0],d=s-t[1],p=a-t[2],v=h*h+d*d+p*p;v>0&&(v=1/Math.sqrt(v),h*=v,d*=v,p*=v);var w=o*p-u*d,_=u*h-l*p,T=l*d-o*h;return v=w*w+_*_+T*T,v>0&&(v=1/Math.sqrt(v),w*=v,_*=v,T*=v),r[0]=w,r[1]=_,r[2]=T,r[3]=0,r[4]=d*T-p*_,r[5]=p*w-h*T,r[6]=h*_-d*w,r[7]=0,r[8]=h,r[9]=d,r[10]=p,r[11]=0,r[12]=n,r[13]=s,r[14]=a,r[15]=1,r}function gf(){var r=new Ui(3);return Ui!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function xb(r){var e=r[0],t=r[1],i=r[2];return Math.hypot(e,t,i)}function Xd(r,e,t){var i=new Ui(3);return i[0]=r,i[1]=e,i[2]=t,i}function UM(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function VM(r,e,t,i){return r[0]=e,r[1]=t,r[2]=i,r}function $M(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function XM(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function KM(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function qM(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function YM(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return Math.hypot(t,i,n)}function ZM(r,e){var t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return t*t+i*i+n*n}function JM(r){var e=r[0],t=r[1],i=r[2];return e*e+t*t+i*i}function QM(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function eE(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function Sb(r,e){var t=e[0],i=e[1],n=e[2],s=t*t+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function _b(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function xo(r,e,t){var i=e[0],n=e[1],s=e[2],a=t[0],l=t[1],o=t[2];return r[0]=n*o-s*l,r[1]=s*a-i*o,r[2]=i*l-n*a,r}function tE(r,e,t,i){var n=e[0],s=e[1],a=e[2];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r[2]=a+i*(t[2]-a),r}function iE(r,e,t){var i=e[0],n=e[1],s=e[2],a=t[3]*i+t[7]*n+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*i+t[4]*n+t[8]*s+t[12])/a,r[1]=(t[1]*i+t[5]*n+t[9]*s+t[13])/a,r[2]=(t[2]*i+t[6]*n+t[10]*s+t[14])/a,r}function nE(r,e,t){var i=t[0],n=t[1],s=t[2],a=t[3],l=e[0],o=e[1],u=e[2],h=n*u-s*o,d=s*l-i*u,p=i*o-n*l,v=n*p-s*d,w=s*h-i*p,_=i*d-n*h,T=a*2;return h*=T,d*=T,p*=T,v*=2,w*=2,_*=2,r[0]=l+h+v,r[1]=o+d+w,r[2]=u+p+_,r}var rE=xb;(function(){var r=gf();return function(e,t,i,n,s,a){var l,o;for(t||(t=3),i||(i=0),n?o=Math.min(n*t+i,e.length):o=e.length,l=i;l<o;l+=t)r[0]=e[l],r[1]=e[l+1],r[2]=e[l+2],s(r,r,a),e[l]=r[0],e[l+1]=r[1],e[l+2]=r[2];return e}})();function sE(){var r=new Ui(4);return Ui!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function kb(r,e,t,i){var n=new Ui(4);return n[0]=r,n[1]=e,n[2]=t,n[3]=i,n}function Tb(r,e,t,i,n){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function aE(r,e){var t=e[0],i=e[1],n=e[2],s=e[3],a=t*t+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}function lE(r,e,t){var i=e[0],n=e[1],s=e[2],a=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*s+t[12]*a,r[1]=t[1]*i+t[5]*n+t[9]*s+t[13]*a,r[2]=t[2]*i+t[6]*n+t[10]*s+t[14]*a,r[3]=t[3]*i+t[7]*n+t[11]*s+t[15]*a,r}(function(){var r=sE();return function(e,t,i,n,s,a){var l,o;for(t||(t=4),i||(i=0),n?o=Math.min(n*t+i,e.length):o=e.length,l=i;l<o;l+=t)r[0]=e[l],r[1]=e[l+1],r[2]=e[l+2],r[3]=e[l+3],s(r,r,a),e[l]=r[0],e[l+1]=r[1],e[l+2]=r[2],e[l+3]=r[3];return e}})();function Kd(){var r=new Ui(4);return Ui!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function oE(r,e,t){t=t*.5;var i=Math.sin(t);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r}function uE(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],l=Math.sin(t),o=Math.cos(t);return r[0]=i*o+a*l,r[1]=n*o+s*l,r[2]=s*o-n*l,r[3]=a*o-i*l,r}function hE(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],l=Math.sin(t),o=Math.cos(t);return r[0]=i*o-s*l,r[1]=n*o+a*l,r[2]=s*o+i*l,r[3]=a*o-n*l,r}function dE(r,e,t){t*=.5;var i=e[0],n=e[1],s=e[2],a=e[3],l=Math.sin(t),o=Math.cos(t);return r[0]=i*o+n*l,r[1]=n*o-i*l,r[2]=s*o+a*l,r[3]=a*o-s*l,r}function So(r,e,t,i){var n=e[0],s=e[1],a=e[2],l=e[3],o=t[0],u=t[1],h=t[2],d=t[3],p,v,w,_,T;return v=n*o+s*u+a*h+l*d,v<0&&(v=-v,o=-o,u=-u,h=-h,d=-d),1-v>$s?(p=Math.acos(v),w=Math.sin(p),_=Math.sin((1-i)*p)/w,T=Math.sin(i*p)/w):(_=1-i,T=i),r[0]=_*n+T*o,r[1]=_*s+T*u,r[2]=_*a+T*h,r[3]=_*l+T*d,r}function cE(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function fE(r,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),r[3]=.5*i,i=.5/i,r[0]=(e[5]-e[7])*i,r[1]=(e[6]-e[2])*i,r[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(e[s*3+a]-e[a*3+s])*i,r[s]=(e[s*3+n]+e[n*3+s])*i,r[a]=(e[a*3+n]+e[n*3+a])*i}return r}function pE(r,e,t,i){var n=.5*Math.PI/180;e*=n,t*=n,i*=n;var s=Math.sin(e),a=Math.cos(e),l=Math.sin(t),o=Math.cos(t),u=Math.sin(i),h=Math.cos(i);return r[0]=s*o*h-a*l*u,r[1]=a*l*h+s*o*u,r[2]=a*o*u-s*l*h,r[3]=a*o*h+s*l*u,r}var gE=kb,mE=Tb,mf=aE,yE=function(){var r=gf(),e=Xd(1,0,0),t=Xd(0,1,0);return function(i,n,s){var a=_b(n,s);return a<-.999999?(xo(r,e,n),rE(r)<1e-6&&xo(r,t,n),Sb(r,r),oE(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(xo(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,mf(i,i))}}();(function(){var r=Kd(),e=Kd();return function(t,i,n,s,a,l){return So(r,i,a,l),So(e,n,s,l),So(t,r,e,2*l*(1-l)),t}})();(function(){var r=bM();return function(e,t,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],mf(e,fE(e,r))}})();class Ue{static set(e,t,i,n=new Float32Array(3)){return VM(n,e,t,i)}static fromValues(e,t,i){return Xd(e,t,i)}static create(){return gf()}static add(e,t,i=new Float32Array(3)){return $M(i,e,t)}static transformQuat(e,t,i=new Float32Array(3)){return nE(i,e,t)}static subtract(e,t,i=new Float32Array(3)){return XM(i,e,t)}static scale(e,t,i=new Float32Array(3)){return qM(i,e,t)}static dot(e,t){return _b(e,t)}static normalize(e,t=new Float32Array(3)){return Sb(t,e)}static cross(e,t,i=new Float32Array(3)){return xo(i,e,t)}static transformMat4(e,t,i=new Float32Array(3)){return iE(i,e,t)}static copy(e,t=new Float32Array(3)){return UM(t,e)}static magnitude(e){return xb(e)}static squaredMagnitude(e){return JM(e)}static inverse(e,t=new Float32Array(3)){return eE(t,e)}static negate(e,t=new Float32Array(3)){return QM(t,e)}static multiply(e,t,i=new Float32Array(3)){return KM(i,e,t)}static distance(e,t){return YM(e,t)}static squaredDistance(e,t){return ZM(e,t)}static lerp(e,t,i,n=new Float32Array(3)){return tE(n,e,t,i)}}class ui{static set(e,t,i,n,s=new Float32Array(4)){return mE(s,e,t,i,n)}static fromValues(e,t,i,n){return gE(e,t,i,n)}static create(){return Kd()}static normalize(e,t=new Float32Array(4)){return mf(t,e)}static slerp(e,t,i,n=new Float32Array(4)){return So(n,e,t,i)}static fromEuler(e,t,i,n=new Float32Array(4)){return pE(n,e,t,i)}static conjugate(e,t=new Float32Array(4)){return cE(t,e)}static rotateX(e,t,i=new Float32Array(4)){return uE(i,e,t)}static rotateY(e,t,i=new Float32Array(4)){return hE(i,e,t)}static rotateZ(e,t,i=new Float32Array(4)){return dE(i,e,t)}static rotationTo(e,t,i=new Float32Array(4)){return yE(i,e,t)}}const jr=new Float32Array(4);class Yi extends mi{constructor(e=0,t=0,i=0,n=1,s=()=>{},a=void 0){super(s,a),this._array=new Float32Array(4),this._array.set([e,t,i,n])}get array(){return this._array}set array(e){this.setFrom(e)}get x(){return this._array[0]}set x(e){this._array[0]!==e&&(this._array[0]=e,this.cb.call(this.scope))}get y(){return this._array[1]}set y(e){this._array[1]!==e&&(this._array[1]=e,this.cb.call(this.scope))}get z(){return this._array[2]}set z(e){this._array[2]!==e&&(this._array[2]=e,this.cb.call(this.scope))}get w(){return this._array[3]}set w(e){this._array[3]!==e&&(this._array[3]=e,this.cb.call(this.scope))}setEulerAngles(e,t,i){ui.fromEuler(e,t,i,this._array),this.cb.call(this.scope)}clone(e=this.cb,t=this.scope){return new Yi(this.x,this.y,this.z,this.w,e,t)}copyFrom(e){return(this._array[0]!==e.x||this._array[1]!==e.y||this._array[2]!==e.z||this._array[3]!==e.w)&&(this._array[0]=e.x,this._array[1]=e.y,this._array[2]=e.z,this._array[3]=e.w,this.cb.call(this.scope)),this}copyTo(e){return e instanceof Yi&&e.set(this.x,this.y,this.z,this.w),e}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}set(e,t=e,i=e,n=e){return(this._array[0]!==e||this._array[1]!==t||this._array[2]!==i||this._array[3]!==n)&&(this._array[0]=e,this._array[1]=t,this._array[2]=i,this._array[3]=n,this.cb.call(this.scope)),this}setFrom(e){return this.set(e[0],e[1],e[2],e[3]),this}normalize(e=new Yi){return e.setFrom(ui.normalize(this._array,jr))}static slerp(e,t,i,n=new Yi){return n.setFrom(ui.slerp(e.array,t.array,i,jr))}static fromEuler(e,t,i,n=new Yi){return n.setFrom(ui.fromEuler(e,t,i,jr))}static conjugate(e,t=new Yi){return t.setFrom(ui.conjugate(e.array,jr))}static rotateX(e,t,i=new Yi){return i.setFrom(ui.rotateX(e.array,t,jr))}static rotateY(e,t,i=new Yi){return i.setFrom(ui.rotateY(e.array,t,jr))}static rotateZ(e,t,i=new Yi){return i.setFrom(ui.rotateZ(e.array,t,jr))}}class je{static getTranslation(e,t=new Float32Array(3)){return RM(t,e)}static create(){return wM()}static translate(e,t,i=new Float32Array(16)){return TM(i,e,t)}static getScaling(e,t=new Float32Array(3)){return wb(t,e)}static getRotation(e,t=new Float32Array(4)){return OM(t,e)}static copy(e,t=new Float32Array(16)){return xM(t,e)}static fromQuat(e,t=new Float32Array(16)){return BM(t,e)}static fromRotationTranslationScale(e,t,i,n=new Float32Array(16)){return LM(n,e,t,i)}static fromRotation(e,t,i=new Float32Array(16)){return FM(i,e,t)}static fromScaling(e,t=new Float32Array(16)){return DM(t,e)}static fromTranslation(e,t=new Float32Array(16)){return IM(t,e)}static multiply(e,t,i=new Float32Array(16)){return kM(i,e,t)}static lookAt(e,t,i,n=new Float32Array(16)){return WM(n,e,t,i)}static identity(e=new Float32Array(16)){return vb(e)}static perspective(e,t,i,n,s=new Float32Array(16)){return jM(s,e,t,i,n)}static ortho(e,t,i,n,s,a,l=new Float32Array(16)){return GM(l,e,t,i,n,s,a)}static invert(e,t=new Float32Array(16)){return _M(t,e)}static transpose(e,t=new Float32Array(16)){return SM(t,e)}static targetTo(e,t,i,n=new Float32Array(16)){return HM(n,e,t,i)}static rotateX(e,t,i=new Float32Array(16)){return MM(i,e,t)}static rotateY(e,t,i=new Float32Array(16)){return EM(i,e,t)}static rotateZ(e,t,i=new Float32Array(16)){return PM(i,e,t)}static rotate(e,t,i,n=new Float32Array(16)){return AM(n,e,t,i)}static scale(e,t,i=new Float32Array(16)){return CM(i,e,t)}}class Zi{constructor(e,t,i){this._parent=e,this._data=t,this._update=i}get data(){return this._id!==this._parent.transformId&&(this._update(this._data),this._id=this._parent.transformId),this._data}}const qt=new Float32Array(16);class ft extends Ye{constructor(e){super(),this._transformId=0,e?this.array=new Float32Array(e):this.array=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get transformId(){return this._transformId}toArray(e,t){return e?je.transpose(this.array,t):t?je.copy(this.array,t):this.array}get position(){return this._position||(this._position=new Zi(this,new nt,e=>{je.getTranslation(this.array,e.array)})),this._position.data}get scaling(){return this._scaling||(this._scaling=new Zi(this,new nt,e=>{je.getScaling(this.array,e.array)})),this._scaling.data}get rotation(){if(!this._rotation){let e=new Float32Array(16);this._rotation=new Zi(this,new Yi,t=>{for(let i=0;i<3;i++)e[i+0]=this.array[i+0]/this.scaling.x,e[i+4]=this.array[i+4]/this.scaling.y,e[i+8]=this.array[i+8]/this.scaling.z;ui.normalize(je.getRotation(e,t.array),t.array)})}return this._rotation.data}get up(){return this._up||(this._up=new Zi(this,new nt,e=>{Ue.normalize(Ue.set(this.array[4],this.array[5],this.array[6],e.array),e.array)})),this._up.data}get down(){return this._down||(this._down=new Zi(this,new nt,e=>{Ue.negate(this.up.array,e.array)})),this._down.data}get right(){return this._right||(this._right=new Zi(this,new nt,e=>{Ue.negate(this.left.array,e.array)})),this._right.data}get left(){return this._left||(this._left=new Zi(this,new nt,e=>{Ue.normalize(Ue.cross(this.up.array,this.forward.array,e.array),e.array)})),this._left.data}get forward(){return this._forward||(this._forward=new Zi(this,new nt,e=>{Ue.normalize(Ue.set(this.array[8],this.array[9],this.array[10],e.array),e.array)})),this._forward.data}get backward(){return this._backward||(this._backward=new Zi(this,new nt,e=>{Ue.negate(this.forward.array,e.array)})),this._backward.data}copyFrom(e){return e instanceof ft&&(je.copy(e.array,this.array),this._transformId++),this}setFrom(e){return je.copy(e,this.array),this._transformId++,this}setFromRotationPositionScale(e,t,i){je.fromRotationTranslationScale(e.array,t.array,i.array,this.array),this._transformId++}multiply(e){je.multiply(e.array,this.array,this.array),this._transformId++}static translate(e,t,i=new ft){return i.setFrom(je.translate(e.array,t.array,qt))}static fromQuaternion(e,t=new ft){return t.setFrom(je.fromQuat(e.array,qt))}static fromRotationTranslationScale(e,t,i,n=new ft){return n.setFrom(je.fromRotationTranslationScale(e.array,t.array,i.array,qt))}static fromRotation(e,t,i=new ft){return i.setFrom(je.fromRotation(e,t.array,qt))}static fromScaling(e,t=new ft){return t.setFrom(je.fromScaling(e.array,qt))}static fromTranslation(e,t=new ft){return t.setFrom(je.fromTranslation(e.array,qt))}static lookAt(e,t,i,n=new ft){return n.setFrom(je.lookAt(e.array,t.array,i.array,qt))}static identity(e=new ft){return e.setFrom(je.identity(qt))}static perspective(e,t,i,n,s=new ft){return s.setFrom(je.perspective(e,t,i,n,qt))}static ortho(e,t,i,n,s,a,l=new ft){return l.setFrom(je.ortho(e,t,i,n,s,a,qt))}static invert(e,t=new ft){return t.setFrom(je.invert(e.array,qt))}static transpose(e,t=new ft){return t.setFrom(je.transpose(e.array,qt))}static targetTo(e,t,i,n=new ft){return n.setFrom(je.targetTo(e.array,t.array,i.array,qt))}static rotateX(e,t,i=new ft){return i.setFrom(je.rotateX(e.array,t,qt))}static rotateY(e,t,i=new ft){return i.setFrom(je.rotateY(e.array,t,qt))}static rotateZ(e,t,i=new ft){return i.setFrom(je.rotateZ(e.array,t,qt))}static rotate(e,t,i,n=new ft){return n.setFrom(je.rotate(e.array,t,i.array,qt))}static scale(e,t,i=new ft){return i.setFrom(je.scale(e.array,t.array,qt))}}const un=new Float32Array(3);class nt extends mi{constructor(e=0,t=0,i=0,n=()=>{},s=void 0){super(n,s),this._array=new Float32Array(3),this._array.set([e,t,i])}get array(){return this._array}set array(e){this.setFrom(e)}get x(){return this._array[0]}set x(e){this._array[0]!==e&&(this._array[0]=e,this.cb.call(this.scope))}get y(){return this._array[1]}set y(e){this._array[1]!==e&&(this._array[1]=e,this.cb.call(this.scope))}get z(){return this._array[2]}set z(e){this._array[2]!==e&&(this._array[2]=e,this.cb.call(this.scope))}clone(e=this.cb,t=this.scope){return new nt(this.x,this.y,this.z,e,t)}copyFrom(e){return(this._array[0]!==e.x||this._array[1]!==e.y||this._array[2]!==e.z)&&(this._array[0]=e.x,this._array[1]=e.y,this._array[2]=e.z,this.cb.call(this.scope)),this}copyTo(e){return e instanceof nt&&e.set(this.x,this.y,this.z),e}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}set(e,t=e,i=e){return(this._array[0]!==e||this._array[1]!==t||this._array[2]!==i)&&(this._array[0]=e,this._array[1]=t,this._array[2]=i,this.cb.call(this.scope)),this}setFrom(e){return this.set(e[0],e[1],e[2]),this}normalize(e=new nt){return e.setFrom(Ue.normalize(this._array,un))}get magnitude(){return Ue.magnitude(this._array)}static dot(e,t){return Ue.dot(e._array,t._array)}static add(e,t,i=new nt){return i.setFrom(Ue.add(e._array,t._array,un))}static subtract(e,t,i=new nt){return i.setFrom(Ue.subtract(e._array,t._array,un))}static cross(e,t,i=new nt){return i.setFrom(Ue.cross(e._array,t._array,un))}static inverse(e,t=new nt){return t.setFrom(Ue.inverse(e._array,un))}static distance(e,t){return Ue.distance(e._array,t._array)}static squaredDistance(e,t){return Ue.squaredDistance(e._array,t._array)}static multiply(e,t,i=new nt){return i.setFrom(Ue.multiply(e._array,t._array,un))}static negate(e,t=new nt){return t.setFrom(Ue.negate(e._array,un))}static transform(e,t,i=new nt){return t instanceof ft?i.setFrom(Ue.transformMat4(e._array,t.array,un)):i.setFrom(Ue.transformQuat(e._array,t.array,un))}static lerp(e,t,i,n=new nt){return n.setFrom(Ue.lerp(e._array,t._array,i,un))}static scale(e,t,i=new nt){return i.setFrom(Ue.scale(e._array,t,un))}}class yf extends Pr{constructor(){super(...arguments),this.position=new nt(0,0,0,this.onChange,this),this.scale=new nt(1,1,1,this.onChange,this),this.rotationQuaternion=new Yi(0,0,0,1,this.onChange,this),this.worldTransform=new ft,this.localTransform=new ft,this.inverseWorldTransform=new ft,this.normalTransform=new ft}updateLocalTransform(){this._localID!==this._currentLocalID&&(this.localTransform.setFromRotationPositionScale(this.rotationQuaternion,this.position,this.scale),this._parentID=-1,this._currentLocalID=this._localID)}setFromMatrix(e){this.localTransform.copyFrom(e),this.position.copyFrom(this.localTransform.position),this.scale.copyFrom(this.localTransform.scaling),this.rotationQuaternion.copyFrom(this.localTransform.rotation)}updateTransform(e){this.updateLocalTransform(),!(e&&this._parentID===e._worldID)&&(this.worldTransform.copyFrom(this.localTransform),e instanceof yf&&this.worldTransform.multiply(e.worldTransform),je.invert(this.worldTransform.array,this.inverseWorldTransform.array),je.transpose(this.inverseWorldTransform.array,this.normalTransform.array),this._worldID++,e&&(this._parentID=e._worldID))}lookAt(e,t=new nt(0,1,0)){t instanceof nt&&(t=t.array);let i=je.getRotation(je.targetTo(e.array,this.worldTransform.position.array,t));this.rotationQuaternion.set(i[0],i[1],i[2],i[3])}}class xn extends Rt{constructor(){super(...arguments),this.transform=new yf}set position(e){this.transform.position.copyFrom(e)}get position(){return this.transform.position}set scale(e){this.transform.scale.copyFrom(e)}get scale(){return this.transform.scale}set rotationQuaternion(e){this.transform.rotationQuaternion.copyFrom(e)}get rotationQuaternion(){return this.transform.rotationQuaternion}get z(){return this.transform.position.z}set z(e){this.transform.position.z=e}get localTransform(){return this.transform.localTransform}get worldTransform(){return this.transform.worldTransform}}class Yg{constructor(e,t){this._direction=new nt,this._origin=new nt,this._origin.copyFrom(e),this._direction.copyFrom(t)}get origin(){return this._origin}get direction(){return this._direction}getPoint(e,t=new nt){return nt.add(this._origin,nt.scale(this._direction,e,t),t)}}class ka{static set(e,t,i,n,s=new Float32Array(4)){return Tb(s,e,t,i,n)}static transformMat4(e,t,i=new Float32Array(4)){return lE(i,e,t)}static fromValues(e,t,i,n){return kb(e,t,i,n)}}const bE=new Float32Array(3),vE=new Float32Array(16),Ta=new Float32Array(4);class tn extends xn{constructor(e){super(),this.renderer=e,this._transformId=0,this._orthographic=!1,this._orthographicSize=10,this._obliqueness=new mi(()=>{this._transformId++},void 0),this._fieldOfView=60,this._near=.1,this._far=1e3;let t=e.width/e.height,i=-1;this.renderer.on("prerender",()=>{this._aspect||e.width/e.height!==t&&(this._transformId++,t=e.width/e.height),!this.parent&&i!==this.transform._localID&&(this.transform.updateTransform(),i=this.transform._localID)}),tn.main||(tn.main=this),this.transform.position.z=5,this.transform.rotationQuaternion.setEulerAngles(0,180,0)}get transformId(){return this.transform._worldID+this._transformId}get obliqueness(){return this._obliqueness}set obliqueness(e){this._obliqueness.copyFrom(e)}destroy(e){super.destroy(e),this===tn.main&&(tn.main=void 0)}get orthographicSize(){return this._orthographicSize}set orthographicSize(e){this._orthographicSize!==e&&(this._orthographicSize=e,this._transformId++)}get orthographic(){return this._orthographic}set orthographic(e){this._orthographic!==e&&(this._orthographic=e,this._transformId++)}screenToRay(e,t,i=this.renderer.screen){let n=this.screenToWorld(e,t,1,void 0,i);if(n)return this.orthographic?new Yg(n,this.worldTransform.forward):new Yg(this.worldTransform.position,nt.subtract(n,this.worldTransform.position))}screenToWorld(e,t,i,n=new nt,s=this.renderer.screen){var a;this.transform.updateTransform((a=this.parent)==null?void 0:a.transform);let l=this.far;this.far=i;let o=je.invert(this.viewProjection.array,vE);if(o===null)return;let u=ka.set(e/s.width*2-1,(t/s.height*2-1)*-1,1,1,Ta);this.far=l;let h=ka.transformMat4(u,o,Ta);h[3]=1/h[3];for(let d=0;d<3;d++)h[d]*=h[3];return n.set(h[0],h[1],h[2])}worldToScreen(e,t,i,n=new xe,s=this.renderer.screen){var a;this.transform.updateTransform((a=this.parent)==null?void 0:a.transform);let l=ka.set(e,t,i,1,Ta),o=ka.transformMat4(ka.transformMat4(l,this.view.array,Ta),this.projection.array,Ta);if(o[3]!==0)for(let u=0;u<3;u++)o[u]/=o[3];return n.set((o[0]+1)/2*s.width,s.height-(o[1]+1)/2*s.height)}get aspect(){return this._aspect}set aspect(e){this._aspect!==e&&(this._aspect=e,this._transformId++)}get fieldOfView(){return this._fieldOfView}set fieldOfView(e){this._fieldOfView!==e&&(this._fieldOfView=e,this._transformId++)}get near(){return this._near}set near(e){this._near!==e&&(this._near=e,this._transformId++)}get far(){return this._far}set far(e){this._far!==e&&(this._far=e,this._transformId++)}get projection(){return this._projection||(this._projection=new Zi(this,new ft,e=>{const t=this._aspect||this.renderer.width/this.renderer.height;this._orthographic?je.ortho(-this._orthographicSize*t,this._orthographicSize*t,-this._orthographicSize,this._orthographicSize,this._near,this._far,e.array):(je.perspective(this._fieldOfView*us,t,this._near,this._far,e.array),e.array[8]=this._obliqueness.x,e.array[9]=this._obliqueness.y)})),this._projection.data}get view(){return this._view||(this._view=new Zi(this,new ft,e=>{const t=Ue.add(this.worldTransform.position.array,this.worldTransform.forward.array,bE);je.lookAt(this.worldTransform.position.array,t,this.worldTransform.up.array,e.array)})),this._view.data}get viewProjection(){return this._viewProjection||(this._viewProjection=new Zi(this,new ft,e=>{je.multiply(this.projection.array,this.view.array,e.array)})),this._viewProjection.data}}xt.installRendererPlugin("camera",tn);class wE{constructor(e,t=tn.main){this._autoUpdate=!0,this._allowControl=!0,this._camera=tn.main,this._target={x:0,y:0,z:0},this._angles=new mi(()=>{this._angles.x=Math.min(Math.max(-85,this._angles.x),85)},void 0,0,180),this._distance=5,this._enableDamping=!1,this._dampingFactor=.1,this._grabbed=!1,this._previousPinchDistance=0,this._previousClientX=0,this._previousClientY=0,this._dampingAngles={x:0,y:180},this._dampingDistance=5,this.onPointerDown=(i,n)=>{this._grabbed=!0,this._previousClientX=i,this._previousClientY=n},this.onPointerUp=()=>{this._grabbed=!1},this.onPointerMove=(i,n)=>{if(this._grabbed){const s=i-this._previousClientX,a=n-this._previousClientY;this.angles.x+=a*.5,this.angles.y-=s*.5,this.updateCamera(),this._previousClientX=i,this._previousClientY=n}},this.onPreRender=()=>{this.autoUpdate&&this.updateCamera()},this.onMouseDownInteraction=i=>{var n,s,a;if(this.allowControl&&!i.stopped){this._grabbed=!0;const l=i.data.originalEvent,o=l,u=l,h=(n=o==null?void 0:o.targetTouches)==null?void 0:n[0],d=(s=h==null?void 0:h.clientX)!=null?s:u==null?void 0:u.clientX,p=(a=h==null?void 0:h.clientY)!=null?a:u==null?void 0:u.clientY;this.onPointerDown(d,p)}},this.onMouseDown=i=>{this.allowControl&&this.onPointerDown(i.clientX,i.clientY)},this.onMouseMove=i=>{this.allowControl&&i.buttons===1&&this.onPointerMove(i.clientX,i.clientY)},this.onMouseUp=i=>{this.allowControl&&this.onPointerUp()},this.onWheel=i=>{this.allowControl&&(this.distance+=i.deltaY*.01,i.preventDefault(),this.updateCamera())},this.onTouchStart=i=>{var n;if(this.allowControl){const s=(n=i==null?void 0:i.targetTouches)==null?void 0:n[0];if(s){const a=s.clientX,l=s.clientY;this.onPointerDown(a,l)}i.touches.length===2&&(i.preventDefault(),this._previousPinchDistance=Math.hypot(i.touches[0].clientX-i.touches[1].clientX,i.touches[0].clientY-i.touches[1].clientY))}},this.onPinch=i=>{if(this.allowControl){i.preventDefault();const n=Math.hypot(i.touches[0].clientX-i.touches[1].clientX,i.touches[0].clientY-i.touches[1].clientY),s=n-this._previousPinchDistance;this.distance-=s*.1,this.updateCamera(),this._previousPinchDistance=n}},this.onTouchMove=i=>{var n;if(this.allowControl){const s=(n=i==null?void 0:i.targetTouches)==null?void 0:n[0];if(i.touches.length===1&&s){const a=s.clientX,l=s.clientY;this.onPointerMove(a,l)}i.touches.length===2&&this.onPinch(i)}},this.onTouchEnd=i=>{this.allowControl&&i.touches.length===0&&this.onPointerUp()},this._element=e,this._camera=t,this.bind()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){this._autoUpdate=e}get allowControl(){return this._allowControl}set allowControl(e){this._allowControl=e}get camera(){return this._camera}set camera(e){this._camera=e}get target(){return this._target}set target(e){this._target=e}get angles(){return this._angles}get distance(){return this._distance}set distance(e){this._distance=Math.min(Math.max(e,.01),Number.MAX_SAFE_INTEGER)}get enableDamping(){return this._enableDamping}set enableDamping(e){this._enableDamping=e}get dampingFactor(){return this._dampingFactor}set dampingFactor(e){this._dampingFactor=e}destroy(){this.unbind()}bind(){this.camera.renderer.on("prerender",this.onPreRender);let e=xt.getInteractionPlugin(this.camera.renderer);e&&e.on("mousedown",this.onMouseDownInteraction),this._element.addEventListener("mousedown",this.onMouseDown),this._element.addEventListener("touchstart",this.onTouchStart),this._element.addEventListener("wheel",this.onWheel),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd)}unbind(){this._element.removeEventListener("mousedown",this.onMouseDown),this._element.removeEventListener("touchstart",this.onTouchStart),this._element.removeEventListener("wheel",this.onWheel),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}updateCamera(){this.enableDamping&&(this._dampingAngles.x+=(this.angles.x-this._dampingAngles.x)*this.dampingFactor,this._dampingAngles.y+=(this.angles.y-this._dampingAngles.y)*this.dampingFactor,this._dampingDistance+=(this.distance-this._dampingDistance)*this.dampingFactor);const e=this.enableDamping?this._dampingAngles:this.angles,t=this.enableDamping?this._dampingDistance:this.distance,i=ui.fromEuler(e.x,e.y,0,new Float32Array(4)),n=Ue.transformQuat(Ue.set(0,0,1,new Float32Array(3)),i,new Float32Array(3)),s=Ue.subtract(Ue.set(this.target.x,this.target.y,this.target.z,new Float32Array(3)),Ue.scale(n,t,new Float32Array(3)),new Float32Array(3));this.camera.position.set(s[0],s[1],s[2]),this.camera.rotationQuaternion.set(i[0],i[1],i[2],i[3])}}class Bn{constructor(){this._shaderGeometry={}}getShaderGeometry(e){return this._shaderGeometry[e.name]}addShaderGeometry(e,t){this._shaderGeometry[e.name]=e.createShaderGeometry(this,t)}hasShaderGeometry(e,t){return this._shaderGeometry[e.name]?!t||t&&this._shaderGeometry[e.name].instanced:!1}destroy(){for(let e in this._shaderGeometry)this._shaderGeometry[e].destroy();this._shaderGeometry={}}}var qd;(r=>{function e(){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,0,1,1,0,-1,-1,0,-1,1,0,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1])},normals:{buffer:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([0,1,1,0,0,0,1,1])}]})}r.create=e})(qd||(qd={}));var Yd;(r=>{function e(){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,13,14,12,15,13,16,17,18,16,19,17,20,21,22,20,23,21])},normals:{buffer:new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([.625,1,.375,.75,.375,1,.625,.75,.625,.75,.375,.5,.375,.75,.625,.5,.625,.5,.375,.25,.375,.5,.625,.25,.625,.25,.375,0,.375,.25,.625,0,.375,.25,.125,.5,.375,.5,.125,.25,.875,.25,.625,.5,.875,.5,.625,.25])}],tangents:{buffer:new Float32Array([0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1])}})}r.create=e})(Yd||(Yd={}));var Zd;(r=>{function e(){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,1,0,1,-1,0,-1,-1,0,1,1,0])},indices:{buffer:new Uint8Array([0,2,1,0,1,3])},normals:{buffer:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1])},uvs:[{buffer:new Float32Array([0,0,1,1,0,1,1,0])}]})}r.create=e})(Zd||(Zd={}));class xE extends xn{constructor(e,t){super(),this.mesh=e,this.material=t}destroy(e){super.destroy(e),this.mesh.removeInstance(this)}}var br=(r=>(r.spot="spot",r.directional="directional",r.point="point",r))(br||{}),ir=(r=>(r.opaque="opaque",r.mask="mask",r.blend="blend",r))(ir||{}),dr=(r=>(r.alpha="alpha",r.emissive="emissive",r.f0="f0",r.metallic="metallic",r.normal="normal",r.occlusion="occlusion",r.roughness="roughness",r))(dr||{}),Rn;(r=>{let e;function t(w){if(e!==void 0)return e;const _=w.gl;return e=_.getParameter(_.MAX_VERTEX_UNIFORM_VECTORS),e}r.getMaxVertexUniformVectors=t;let i;function n(w){return w.context.webGLVersion===2?!0:(i!==void 0||(i=!!w.gl.getExtension("OES_texture_float")),i)}r.isFloatingPointTextureSupported=n;let s;function a(w){if(w.context.webGLVersion===2)return!0;if(s!==void 0)return s;const _=w.gl,T=_.getExtension("OES_texture_half_float");if(!T)return!1;const D=_.createTexture();_.bindTexture(_.TEXTURE_2D,D),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,8,8,0,_.RGBA,T.HALF_FLOAT_OES,null);const L=_.createFramebuffer();_.bindFramebuffer(_.FRAMEBUFFER,L);const O=_.COLOR_ATTACHMENT0;return _.framebufferTexture2D(_.FRAMEBUFFER,O,_.TEXTURE_2D,D,0),s=_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE,s}r.isHalfFloatFramebufferSupported=a;let l;function o(w){if(w.context.webGLVersion===2)return!0;if(l!==void 0)return l;const _=w.gl;if(!_.getExtension("OES_texture_float"))return!1;const D=_.createTexture();_.bindTexture(_.TEXTURE_2D,D),_.texImage2D(_.TEXTURE_2D,0,_.RGBA,8,8,0,_.RGBA,_.FLOAT,null);const L=_.createFramebuffer();_.bindFramebuffer(_.FRAMEBUFFER,L);const O=_.COLOR_ATTACHMENT0;return _.framebufferTexture2D(_.FRAMEBUFFER,O,_.TEXTURE_2D,D,0),l=_.checkFramebufferStatus(_.FRAMEBUFFER)===_.FRAMEBUFFER_COMPLETE,l}r.isFloatFramebufferSupported=o;let u;function h(w){return u!==void 0||(u=w.gl.getExtension("OES_texture_float_linear")!==null),u}r.supportsFloatLinear=h;function d(w){return w.context.webGLVersion===2?!0:w.gl.getExtension("EXT_shader_texture_lod")!==null}r.isShaderTextureLodSupported=d;let p;function v(w){return p!==void 0||(p=w.gl.getExtension("ANGLE_instanced_arrays")!==void 0),p}r.isInstancingSupported=v})(Rn||(Rn={}));const bf=Ft.get(Mt,"BufferResource")||Ft.get(Mt,"resources").BufferResource;class ia extends ye{constructor(e){let t=new Float32Array(e*16),i=new bf(t,{width:4,height:e});super(new Be(i,{mipmap:Ei.OFF,wrapMode:gi.CLAMP,scaleMode:Xt.NEAREST,format:fe.RGBA,type:ke.FLOAT,alphaMode:hi.NO_PREMULTIPLIED_ALPHA,resolution:1})),this._buffer=t}static isSupported(e){return Rn.isFloatingPointTextureSupported(e)}updateBuffer(e){this._buffer.set(e),this.baseTexture.resource.update()}}var yr;(r=>{const e=[],t=new Mr;function i(l,o,u){t.on(l,o,u)}r.on=i;function n(l,o){if(!e.includes(l)){e.push(l);let u=a(l,o);console.warn(`PIXI3D: ${u}`),t.emit("warn",u)}}r.warn=n;function s(l,o){if(!e.includes(l)){e.push(l);let u=a(l,o);console.error(`PIXI3D: ${u}`),t.emit("error",u)}}r.error=s;function a(l,o){let u=l,h;for(;(h=/{(\w*)}/g.exec(u))!==null&&o;)u=u.replace(h[0],o[h[1]]);return u}})(yr||(yr={}));var Qr=(r=>(r.meshVertexSkinningFloatingPointTexturesNotSupported='Mesh is using vertex skinning but floating point textures is not supported on this device/environment. In case of errors, try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',r.meshVertexSkinningNumberOfJointsNotSupported="Mesh is using vertex skinning but the number of joints ({joints}) is not supported on this device/environment. Max number of supported joints is {maxJoints}, try reducing the number of joints.",r.imageBasedLightingShaderTextureLodNotSupported='Image based lighting is used but shader texture lod is not supported on this device/environment, the material may not be displayed correctly. Try changing the environment in PixiJS settings. Set "PIXI.settings.PREFER_ENV = PIXI.ENV.WEBGL2" before creating a renderer/application.',r))(Qr||{}),Du=(r=>(r.ldr="ldr",r.rgbe8="rgbe8",r))(Du||{}),eu;(r=>{function e(n,s,a,l,o){let u=[];if(s.instances.length>0&&u.push("USE_INSTANCING 1"),n.context.webGLVersion===1&&u.push("WEBGL1 1"),n.context.webGLVersion===2&&u.push("WEBGL2 1"),a.colors&&(a.colors.componentCount===3?u.push("HAS_VERTEX_COLOR_VEC3 1"):u.push("HAS_VERTEX_COLOR_VEC4 1")),a.normals&&u.push("HAS_NORMALS 1"),a.uvs&&a.uvs[0]&&u.push("HAS_UV_SET1 1"),a.uvs&&a.uvs[1]&&u.push("HAS_UV_SET2 1"),a.tangents&&u.push("HAS_TANGENTS 1"),a.targets){for(let h=0;h<a.targets.length;h++)a.targets[h].positions&&u.push("HAS_TARGET_POSITION"+h),a.targets[h].normals&&u.push("HAS_TARGET_NORMAL"+h),a.targets[h].tangents&&u.push("HAS_TARGET_TANGENT"+h);s.targetWeights&&s.targetWeights.length>0&&(u.push(`WEIGHT_COUNT ${s.targetWeights.length}`),u.push("USE_MORPHING 1"))}if(a.joints&&u.push("HAS_JOINT_SET1 1"),a.weights&&u.push("HAS_WEIGHT_SET1 1"),s.skin&&t(s,u,n),l.unlit&&u.push("MATERIAL_UNLIT 1"),u.push("MATERIAL_METALLICROUGHNESS 1"),o.fog&&u.push("USE_FOG 1"),o.lights.length>0&&(u.push(`LIGHT_COUNT ${o.lights.length}`),u.push("USE_PUNCTUAL 1")),o.imageBasedLighting){if(!o.imageBasedLighting.valid)return;Rn.isShaderTextureLodSupported(n)?u.push("USE_TEX_LOD 1"):yr.warn(Qr.imageBasedLightingShaderTextureLodNotSupported),u.push("USE_IBL 1"),o.imageBasedLighting.diffuse.cubemapFormat===Du.rgbe8&&u.push("USE_RGBE 1")}if(l.shadowCastingLight&&u.push("USE_SHADOW_MAPPING 1"),l.baseColorTexture){if(!l.baseColorTexture.valid)return;l.baseColorTexture.transform&&u.push("HAS_BASECOLOR_UV_TRANSFORM 1"),u.push("HAS_BASE_COLOR_MAP 1")}if(l.emissiveTexture){if(!l.emissiveTexture.valid)return;l.emissiveTexture.transform&&u.push("HAS_EMISSIVE_UV_TRANSFORM 1"),u.push("HAS_EMISSIVE_MAP 1")}if(l.normalTexture){if(!l.normalTexture.valid)return;l.normalTexture.transform&&u.push("HAS_NORMAL_UV_TRANSFORM 1"),u.push("HAS_NORMAL_MAP 1")}if(l.metallicRoughnessTexture){if(!l.metallicRoughnessTexture.valid)return;l.metallicRoughnessTexture.transform&&u.push("HAS_METALLICROUGHNESS_UV_TRANSFORM 1"),u.push("HAS_METALLIC_ROUGHNESS_MAP 1")}if(l.occlusionTexture){if(!l.occlusionTexture.valid)return;l.occlusionTexture.transform&&u.push("HAS_OCCLUSION_UV_TRANSFORM 1"),u.push("HAS_OCCLUSION_MAP 1")}switch(l.alphaMode){case ir.opaque:{u.push("ALPHAMODE_OPAQUE 1");break}case ir.mask:{u.push("ALPHAMODE_MASK 1");break}}switch(l.debugMode&&u.push("DEBUG_OUTPUT 1"),l.debugMode){case dr.alpha:{u.push("DEBUG_ALPHA 1");break}case dr.emissive:{u.push("DEBUG_EMISSIVE 1");break}case dr.f0:{u.push("DEBUG_F0 1");break}case dr.metallic:{u.push("DEBUG_METALLIC 1");break}case dr.normal:{u.push("DEBUG_NORMAL 1");break}case dr.occlusion:{u.push("DEBUG_OCCLUSION 1");break}case dr.roughness:{u.push("DEBUG_ROUGHNESS 1");break}}return u}r.build=e;function t(n,s,a){if(!n.skin)return;let l=20,o=Rn.getMaxVertexUniformVectors(a)-l,h=Math.floor(o/8),d=n.skin.joints.length<=h;const p=()=>{var w;s.push("USE_SKINNING 1"),s.push(`JOINT_COUNT ${(w=n.skin)==null?void 0:w.joints.length}`)},v=()=>{var w;s.push("USE_SKINNING 1"),s.push(`JOINT_COUNT ${(w=n.skin)==null?void 0:w.joints.length}`),s.push("USE_SKINNING_TEXTURE 1")};if(ge.PREFER_UNIFORMS_WHEN_UPLOADING_SKIN_JOINTS){if(d){p();return}if(ia.isSupported(a)){v();return}else yr.error(Qr.meshVertexSkinningNumberOfJointsNotSupported,{joints:n.skin.joints.length,maxJoints:h})}else{if(ia.isSupported(a)){v();return}yr.warn(Qr.meshVertexSkinningFloatingPointTexturesNotSupported),d?p():yr.error(Qr.meshVertexSkinningNumberOfJointsNotSupported,{joints:n.skin.joints.length,maxJoints:h})}}function i(n){return n.includes("USE_SKINNING_TEXTURE 1")}r.hasSkinningTextureFeature=i})(eu||(eu={}));class Tl extends Ln{constructor(){super(...arguments),this._state=Object.assign(new Vi,{culling:!0,clockwiseFrontFace:!1,depthTest:!0})}get name(){return"mesh-shader"}createShaderGeometry(e,t){let i=new wn;return e.indices&&(e.indices.buffer.BYTES_PER_ELEMENT===1?i.addIndex(new Fe(new Uint16Array(e.indices.buffer))):i.addIndex(new Fe(e.indices.buffer))),e.positions&&i.addAttribute("a_Position",new Fe(e.positions.buffer),3,e.positions.normalized,e.positions.componentType,e.positions.stride),e.uvs&&e.uvs[0]&&i.addAttribute("a_UV1",new Fe(e.uvs[0].buffer),2,e.uvs[0].normalized,e.uvs[0].componentType,e.uvs[0].stride),e.normals&&i.addAttribute("a_Normal",new Fe(e.normals.buffer),3,e.normals.normalized,e.normals.componentType,e.normals.stride),e.tangents&&i.addAttribute("a_Tangent",new Fe(e.tangents.buffer),4,e.tangents.normalized,e.tangents.componentType,e.tangents.stride),e.colors&&i.addAttribute("a_Color",new Fe(e.colors.buffer),e.colors.componentCount,e.colors.normalized,e.colors.componentType,e.colors.stride),i}render(e,t,i=this._state,n=Bi.TRIANGLES){const s=e.instances.filter(o=>o.worldVisible&&o.renderable).length,a=e.instances.length>0;e.geometry.hasShaderGeometry(this,a)||e.geometry.addShaderGeometry(this,a);let l=e.geometry.getShaderGeometry(this);t.shader.bind(this,!1),t.state.set(i),t.geometry.bind(l,this),t.geometry.draw(n,void 0,void 0,s)}}class SE{constructor(){this._maxInstances=200,this._modelMatrix=[new Fe,new Fe,new Fe,new Fe],this._normalMatrix=[new Fe,new Fe,new Fe,new Fe],this._baseColor=new Fe,this.expandBuffers(this._maxInstances)}expandBuffers(e){for(;e>this._maxInstances;)this._maxInstances+=Math.floor(this._maxInstances*.5);for(let t=0;t<4;t++)this._modelMatrix[t].update(new Float32Array(4*this._maxInstances)),this._normalMatrix[t].update(new Float32Array(4*this._maxInstances));this._baseColor.update(new Float32Array(4*this._maxInstances))}updateBuffers(e){e.length>this._maxInstances&&this.expandBuffers(e.length);let t=0;for(let i=0;i<e.length;i++){const n=e[i].transform.normalTransform.array;for(let l=0;l<4;l++)this._normalMatrix[l].data.set(n.slice(l*4,l*4+4),t*4);const s=e[i].worldTransform.array;for(let l=0;l<4;l++)this._modelMatrix[l].data.set(s.slice(l*4,l*4+4),t*4);const a=e[i].material;this._baseColor.data.set(a.baseColor.rgba,t*4),t++}for(let i=0;i<4;i++)this._modelMatrix[i].update(),this._normalMatrix[i].update();this._baseColor.update()}addGeometryAttributes(e){for(let t=0;t<4;t++)e.addAttribute(`a_ModelMatrix${t}`,this._modelMatrix[t],4,!1,void 0,0,void 0,!0);for(let t=0;t<4;t++)e.addAttribute(`a_NormalMatrix${t}`,this._normalMatrix[t],4,!1,void 0,0,void 0,!0);e.addAttribute("a_BaseColorFactor",this._baseColor,4,!1,void 0,0,void 0,!0)}}var Cr;(r=>{function e(t,i,n){return n.context.webGLVersion===1&&(t=t.replace(/VERSION/,"100").replace(/VERT_IN/g,"attribute").replace(/VERT_OUT/g,"varying").replace(/FRAG_COLOR/g,"gl_FragColor").replace(/FRAG_IN/g,"varying")),n.context.webGLVersion===2&&(t=t.replace(/VERSION/,"300 es").replace(/VERT_IN/g,"in").replace(/VERT_OUT/g,"out").replace(/FRAG_COLOR/g,"g_finalColor").replace(/FRAG_IN/g,"in")),t.replace(/#define FEATURES/,i.map(s=>`#define ${s}`).join(`
`))}r.build=e})(Cr||(Cr={}));var _E={source:`#version VERSION

//
// This fragment shader defines a reference implementation for Physically Based Shading of
// a microfacet surface material defined by a glTF model.
//
// References:
// [1] Real Shading in Unreal Engine 4
//     http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf
// [2] Physically Based Shading at Disney
//     http://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf
// [3] README.md - Environment Maps
//     https://github.com/KhronosGroup/glTF-WebGL-PBR/#environment-maps
// [4] "An Inexpensive BRDF Model for Physically based Rendering" by Christophe Schlick
//     https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf

#define FEATURES

#if defined(WEBGL1) //&& defined(USE_TEX_LOD)
#extension GL_EXT_shader_texture_lod : enable
#endif

#if defined(WEBGL1)
#extension GL_OES_standard_derivatives : enable
#endif

#if defined(WEBGL1) && defined(USE_HDR)
#extension GL_OES_texture_float : enable
#extension GL_OES_texture_float_linear : enable
#endif

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}
vec4 _textureLod(sampler2D sampler, vec2 coord, float lod)
{
#ifdef WEBGL2
    return textureLod(sampler, coord, lod);
#endif
#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) 
    return texture2DLodEXT(sampler, coord, lod);
#endif
    return vec4(0.0);
}

vec4 _textureLod(samplerCube sampler, vec3 coord, float lod)
{
#ifdef WEBGL2
    return textureLod(sampler, coord, lod);
#endif
#if defined(WEBGL1) && defined(GL_EXT_shader_texture_lod) 
    return textureCubeLodEXT(sampler, coord, lod);
#endif
    return vec4(0.0);
}
vec3 _dFdx(vec3 coord)
{
#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    return dFdx(coord);
#endif
    return vec3(0.0);
}

vec3 _dFdy(vec3 coord)
{
#if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    return dFdy(coord);
#endif
    return vec3(0.0);
}
FRAG_IN vec2 v_UVCoord1;
FRAG_IN vec2 v_UVCoord2;

// General Material
#ifdef HAS_NORMAL_MAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
uniform int u_NormalUVSet;
uniform mat3 u_NormalUVTransform;
#endif

#ifdef HAS_EMISSIVE_MAP
uniform sampler2D u_EmissiveSampler;
uniform int u_EmissiveUVSet;
uniform vec3 u_EmissiveFactor;
uniform mat3 u_EmissiveUVTransform;
#endif

#ifdef HAS_OCCLUSION_MAP
uniform sampler2D u_OcclusionSampler;
uniform int u_OcclusionUVSet;
uniform float u_OcclusionStrength;
uniform mat3 u_OcclusionUVTransform;
#endif

// Metallic Roughness Material
#ifdef HAS_BASE_COLOR_MAP
uniform sampler2D u_BaseColorSampler;
uniform int u_BaseColorUVSet;
uniform mat3 u_BaseColorUVTransform;
#endif

#ifdef HAS_METALLIC_ROUGHNESS_MAP
uniform sampler2D u_MetallicRoughnessSampler;
uniform int u_MetallicRoughnessUVSet;
uniform mat3 u_MetallicRoughnessUVTransform;
#endif

// Specular Glossiness Material
#ifdef HAS_DIFFUSE_MAP
uniform sampler2D u_DiffuseSampler;
uniform int u_DiffuseUVSet;
uniform mat3 u_DiffuseUVTransform;
#endif

#ifdef HAS_SPECULAR_GLOSSINESS_MAP
uniform sampler2D u_SpecularGlossinessSampler;
uniform int u_SpecularGlossinessUVSet;
uniform mat3 u_SpecularGlossinessUVTransform;
#endif

// IBL
#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
#endif

#ifdef USE_SHADOW_MAPPING
uniform sampler2D u_ShadowSampler;
#endif

vec2 getNormalUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_NORMAL_MAP
    uv.xy = u_NormalUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_NORMAL_UV_TRANSFORM
    uv = u_NormalUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getEmissiveUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_EMISSIVE_MAP
    uv.xy = u_EmissiveUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_EMISSIVE_UV_TRANSFORM
    uv = u_EmissiveUVTransform * uv;
    #endif
#endif

    return uv.xy;
}

vec2 getOcclusionUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_OCCLUSION_MAP
    uv.xy = u_OcclusionUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_OCCLUSION_UV_TRANSFORM
    uv = u_OcclusionUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getBaseColorUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_BASE_COLOR_MAP
    uv.xy = u_BaseColorUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_BASECOLOR_UV_TRANSFORM
    uv = u_BaseColorUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getMetallicRoughnessUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_METALLIC_ROUGHNESS_MAP
    uv.xy = u_MetallicRoughnessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_METALLICROUGHNESS_UV_TRANSFORM
    uv = u_MetallicRoughnessUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getSpecularGlossinessUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_SPECULAR_GLOSSINESS_MAP
    uv.xy = u_SpecularGlossinessUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_SPECULARGLOSSINESS_UV_TRANSFORM
    uv = u_SpecularGlossinessUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

vec2 getDiffuseUV()
{
    vec3 uv = vec3(v_UVCoord1, 1.0);
#ifdef HAS_DIFFUSE_MAP
    uv.xy = u_DiffuseUVSet < 1 ? v_UVCoord1 : v_UVCoord2;
    #ifdef HAS_DIFFUSE_UV_TRANSFORM
    uv = u_DiffuseUVTransform * uv;
    #endif
#endif
    return uv.xy;
}

// textures.glsl needs to be included

const float M_PI = 3.141592653589793;
const float c_MinReflectance = 0.04;

FRAG_IN vec3 v_Position;
FRAG_IN vec3 v_ModelViewPosition;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
FRAG_IN mat3 v_TBN;
#else
FRAG_IN vec3 v_Normal;
#endif
#endif

#ifdef HAS_VERTEX_COLOR_VEC3
FRAG_IN vec3 v_Color;
#endif
#ifdef HAS_VERTEX_COLOR_VEC4
FRAG_IN vec4 v_Color;
#endif

struct AngularInfo
{
    float NdotL;                  // cos angle between normal and light direction
    float NdotV;                  // cos angle between normal and view direction
    float NdotH;                  // cos angle between normal and half vector
    float LdotH;                  // cos angle between light direction and half vector

    float VdotH;                  // cos angle between view direction and half vector

    vec3 padding;
};

vec4 getVertexColor()
{
   vec4 color = vec4(1.0, 1.0, 1.0, 1.0);

#ifdef HAS_VERTEX_COLOR_VEC3
    color.rgb = v_Color;
#endif
#ifdef HAS_VERTEX_COLOR_VEC4
    color = v_Color;
#endif

   return color;
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
    vec2 UV = getNormalUV();

    // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
    vec3 pos_dx = _dFdx(v_Position);
    vec3 pos_dy = _dFdy(v_Position);
    vec3 tex_dx = _dFdx(vec3(UV, 0.0));
    vec3 tex_dy = _dFdy(vec3(UV, 0.0));
    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
    vec3 ng = normalize(v_Normal);
#else
    vec3 ng = cross(pos_dx, pos_dy);
#endif

    t = normalize(t - ng * dot(ng, t));
    vec3 b = normalize(cross(ng, t));
    mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
    mat3 tbn = v_TBN;
#endif

#ifdef HAS_NORMAL_MAP
    vec3 n = _texture(u_NormalSampler, UV).rgb;
    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
    // The tbn matrix is linearly interpolated, so we need to re-normalize
    vec3 n = normalize(tbn[2].xyz);
#endif

    return n;
}

float getPerceivedBrightness(vec3 vector)
{
    return sqrt(0.299 * vector.r * vector.r + 0.587 * vector.g * vector.g + 0.114 * vector.b * vector.b);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness/examples/convert-between-workflows/js/three.pbrUtilities.js#L34
float solveMetallic(vec3 diffuse, vec3 specular, float oneMinusSpecularStrength) {
    float specularBrightness = getPerceivedBrightness(specular);

    if (specularBrightness < c_MinReflectance) {
        return 0.0;
    }

    float diffuseBrightness = getPerceivedBrightness(diffuse);

    float a = c_MinReflectance;
    float b = diffuseBrightness * oneMinusSpecularStrength / (1.0 - c_MinReflectance) + specularBrightness - 2.0 * c_MinReflectance;
    float c = c_MinReflectance - specularBrightness;
    float D = b * b - 4.0 * a * c;

    return clamp((-b + sqrt(D)) / (2.0 * a), 0.0, 1.0);
}

AngularInfo getAngularInfo(vec3 pointToLight, vec3 normal, vec3 view)
{
    // Standard one-letter names
    vec3 n = normalize(normal);           // Outward direction of surface point
    vec3 v = normalize(view);             // Direction from surface point to view
    vec3 l = normalize(pointToLight);     // Direction from surface point to light
    vec3 h = normalize(l + v);            // Direction of the vector between l and v

    float NdotL = clamp(dot(n, l), 0.0, 1.0);
    float NdotV = clamp(dot(n, v), 0.0, 1.0);
    float NdotH = clamp(dot(n, h), 0.0, 1.0);
    float LdotH = clamp(dot(l, h), 0.0, 1.0);
    float VdotH = clamp(dot(v, h), 0.0, 1.0);

    return AngularInfo(
        NdotL,
        NdotV,
        NdotH,
        LdotH,
        VdotH,
        vec3(0, 0, 0)
    );
}

#ifdef USE_SHADOW_MAPPING
FRAG_IN vec4 v_PositionLightSpace;
#endif

float linstep(float low, float high, float v)
{
    return clamp((v-low) / (high-low), 0.0, 1.0);
}

#ifdef USE_SHADOW_MAPPING
float getShadowContribution()
{
    vec3 coords = v_PositionLightSpace.xyz / v_PositionLightSpace.w * 0.5 + 0.5;
    if (coords.z < 0.01 || coords.z > 0.99 || coords.x < 0.01 || coords.x > 0.99 || coords.y < 0.01 || coords.y > 0.99) {
        return 1.0;
    }
    vec2 moments = vec2(1.0) - _texture(u_ShadowSampler, coords.xy).xy;
    float p = step(coords.z, moments.x);
    float variance = max(moments.y - moments.x * moments.x, 0.00002);
    float d = coords.z - moments.x;
    float pMax = linstep(0.2, 1.0, variance / (variance + d*d));
    return min(max(p, pMax), 1.0);
}
#endif
uniform float u_Exposure;

const float GAMMA = 2.2;
const float INV_GAMMA = 1.0 / GAMMA;

// linear to sRGB approximation
// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
vec3 LINEARtoSRGB(vec3 color)
{
    return pow(color, vec3(INV_GAMMA));
}

// sRGB to linear approximation
// see http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html
vec4 SRGBtoLINEAR(vec4 srgbIn)
{
    return vec4(pow(srgbIn.xyz, vec3(GAMMA)), srgbIn.w);
}

// Uncharted 2 tone map
// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 toneMapUncharted2Impl(vec3 color)
{
    const float A = 0.15;
    const float B = 0.50;
    const float C = 0.10;
    const float D = 0.20;
    const float E = 0.02;
    const float F = 0.30;
    return ((color*(A*color+C*B)+D*E)/(color*(A*color+B)+D*F))-E/F;
}

vec3 toneMapUncharted(vec3 color)
{
    const float W = 11.2;
    color = toneMapUncharted2Impl(color * 2.0);
    vec3 whiteScale = 1.0 / toneMapUncharted2Impl(vec3(W));
    return LINEARtoSRGB(color * whiteScale);
}

// Hejl Richard tone map
// see: http://filmicworlds.com/blog/filmic-tonemapping-operators/
vec3 toneMapHejlRichard(vec3 color)
{
    color = max(vec3(0.0), color - vec3(0.004));
    return (color*(6.2*color+.5))/(color*(6.2*color+1.7)+0.06);
}

// ACES tone map
// see: https://knarkowicz.wordpress.com/2016/01/06/aces-filmic-tone-mapping-curve/
vec3 toneMapACES(vec3 color)
{
    const float A = 2.51;
    const float B = 0.03;
    const float C = 2.43;
    const float D = 0.59;
    const float E = 0.14;
    return LINEARtoSRGB(clamp((color * (A * color + B)) / (color * (C * color + D) + E), 0.0, 1.0));
}

vec3 toneMap(vec3 color)
{
    color *= u_Exposure;

#ifdef TONEMAP_UNCHARTED
    return toneMapUncharted(color);
#endif

#ifdef TONEMAP_HEJLRICHARD
    return toneMapHejlRichard(color);
#endif

#ifdef TONEMAP_ACES
    return toneMapACES(color);
#endif

    return LINEARtoSRGB(color);
}

vec4 encodeRGBE(vec3 rgb) {
  vec4 vEncoded;
  float maxComponent = max(max(rgb.r, rgb.g), rgb.b);
  float fExp = ceil(log2(maxComponent));
  vEncoded.rgb = rgb / exp2(fExp);
  vEncoded.a = (fExp + 128.0) / 255.0;
  return vEncoded;
}

vec3 decodeRGBE(vec4 rgbe) {
  vec3 vDecoded;
  float fExp = rgbe.a * 255.0 - 128.0;
  vDecoded = rgbe.rgb * exp2(fExp);
  return vDecoded;
}

// KHR_lights_punctual extension.
// see https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual

struct Light
{
    vec3 direction;
    float range;

    vec3 color;
    float intensity;

    vec3 position;
    float innerConeCos;

    float outerConeCos;
    int type;

    vec2 padding;
};

const int LightType_Directional = 0;
const int LightType_Point = 1;
const int LightType_Spot = 2;

#ifdef USE_PUNCTUAL
uniform Light u_Lights[LIGHT_COUNT];
#endif

#ifdef USE_FOG
uniform float u_FogNear;
uniform float u_FogFar;
uniform vec3 u_FogColor;
#endif

#if defined(MATERIAL_SPECULARGLOSSINESS) || defined(MATERIAL_METALLICROUGHNESS)
uniform float u_MetallicFactor;
uniform float u_RoughnessFactor;
uniform vec4 u_BaseColorFactor;
#endif

#ifdef USE_INSTANCING
FRAG_IN vec4 v_BaseColorFactor;
#endif

#ifdef MATERIAL_SPECULARGLOSSINESS
uniform vec3 u_SpecularFactor;
uniform vec4 u_DiffuseFactor;
uniform float u_GlossinessFactor;
#endif

#ifdef ALPHAMODE_MASK
uniform float u_AlphaCutoff;
#endif

#ifdef USE_SHADOW_MAPPING
uniform int u_ShadowLightIndex;
#endif

uniform vec3 u_Camera;

uniform int u_MipCount;

struct MaterialInfo
{
    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
    vec3 reflectance0;            // full reflectance color (normal incidence angle)

    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
    vec3 diffuseColor;            // color contribution from diffuse lighting

    vec3 reflectance90;           // reflectance color at grazing angle
    vec3 specularColor;           // color contribution from specular lighting
};

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(MaterialInfo materialInfo, vec3 n, vec3 v)
{
    float NdotV = clamp(dot(n, v), 0.0, 1.0);

    float lod = clamp(materialInfo.perceptualRoughness * float(u_MipCount), 0.0, float(u_MipCount));
    vec3 reflection = normalize(reflect(-v, n));

    vec2 brdfSamplePoint = clamp(vec2(NdotV, materialInfo.perceptualRoughness), vec2(0.0, 0.0), vec2(1.0, 1.0));
    // retrieve a scale and bias to F0. See [1], Figure 3
    vec2 brdf = _texture(u_brdfLUT, brdfSamplePoint).rg;

    vec4 diffuseSample = _texture(u_DiffuseEnvSampler, n);

#ifdef USE_TEX_LOD
    vec4 specularSample = _textureLod(u_SpecularEnvSampler, reflection, lod);
#else
    vec4 specularSample = _texture(u_SpecularEnvSampler, reflection);
#endif

#if defined(USE_HDR)
    // Already linear.
    vec3 diffuseLight = diffuseSample.rgb;
    vec3 specularLight = specularSample.rgb;
#elif defined(USE_RGBE)
    vec3 diffuseLight = decodeRGBE(diffuseSample);
    vec3 specularLight = decodeRGBE(specularSample);
#else
    vec3 diffuseLight = SRGBtoLINEAR(diffuseSample).rgb;
    vec3 specularLight = SRGBtoLINEAR(specularSample).rgb;
#endif

    vec3 diffuse = diffuseLight * materialInfo.diffuseColor;
    vec3 specular = specularLight * (materialInfo.specularColor * brdf.x + brdf.y);

    return diffuse + specular;
}
#endif

// Lambert lighting
// see https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/
vec3 diffuse(MaterialInfo materialInfo)
{
    return materialInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    return materialInfo.reflectance0 + (materialInfo.reflectance90 - materialInfo.reflectance0) * pow(clamp(1.0 - angularInfo.VdotH, 0.0, 1.0), 5.0);
}

// Smith Joint GGX
// Note: Vis = G / (4 * NdotL * NdotV)
// see Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs. Journal of Computer Graphics Techniques, 3
// see Real-Time Rendering. Page 331 to 336.
// see https://google.github.io/filament/Filament.md.html#materialsystem/specularbrdf/geometricshadowing(specularg)
float visibilityOcclusion(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    float NdotL = angularInfo.NdotL;
    float NdotV = angularInfo.NdotV;
    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;

    float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);
    float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);

    float GGX = GGXV + GGXL;
    if (GGX > 0.0)
    {
        return 0.5 / GGX;
    }
    return 0.0;
}

// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.
float microfacetDistribution(MaterialInfo materialInfo, AngularInfo angularInfo)
{
    float alphaRoughnessSq = materialInfo.alphaRoughness * materialInfo.alphaRoughness;
    float f = (angularInfo.NdotH * alphaRoughnessSq - angularInfo.NdotH) * angularInfo.NdotH + 1.0;
    return alphaRoughnessSq / (M_PI * f * f);
}

vec3 getPointShade(vec3 pointToLight, MaterialInfo materialInfo, vec3 normal, vec3 view)
{
    AngularInfo angularInfo = getAngularInfo(pointToLight, normal, view);

    if (angularInfo.NdotL > 0.0 || angularInfo.NdotV > 0.0)
    {
        // Calculate the shading terms for the microfacet specular shading model
        vec3 F = specularReflection(materialInfo, angularInfo);
        float Vis = visibilityOcclusion(materialInfo, angularInfo);
        float D = microfacetDistribution(materialInfo, angularInfo);

        // Calculation of analytical lighting contribution
        vec3 diffuseContrib = (1.0 - F) * diffuse(materialInfo);
        vec3 specContrib = F * Vis * D;

        // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
        return angularInfo.NdotL * (diffuseContrib + specContrib);
    }

    return vec3(0.0, 0.0, 0.0);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#range-property
float getRangeAttenuation(float range, float distance)
{
    if (range <= 0.0)
    {
        // negative range means unlimited
        return 1.0;
    }
    return max(min(1.0 - pow(distance / range, 4.0), 1.0), 0.0) / pow(distance, 2.0);
}

// https://github.com/KhronosGroup/glTF/blob/master/extensions/2.0/Khronos/KHR_lights_punctual/README.md#inner-and-outer-cone-angles
float getSpotAttenuation(vec3 pointToLight, vec3 spotDirection, float outerConeCos, float innerConeCos)
{
    float actualCos = dot(normalize(spotDirection), normalize(-pointToLight));
    if (actualCos > outerConeCos)
    {
        if (actualCos < innerConeCos)
        {
            return smoothstep(outerConeCos, innerConeCos, actualCos);
        }
        return 1.0;
    }
    return 0.0;
}

vec3 applyDirectionalLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)
{
    vec3 pointToLight = -light.direction;
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;
    return light.intensity * light.color * shade;
}

vec3 applyPointLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view)
{
    vec3 pointToLight = light.position - v_Position;
    float distance = length(pointToLight);
    float attenuation = getRangeAttenuation(light.range, distance);
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view);
    return attenuation * light.intensity * light.color * shade;
}

vec3 applySpotLight(Light light, MaterialInfo materialInfo, vec3 normal, vec3 view, float shadow)
{
    vec3 pointToLight = light.position - v_Position;
    float distance = length(pointToLight);
    float rangeAttenuation = getRangeAttenuation(light.range, distance);
    float spotAttenuation = getSpotAttenuation(pointToLight, light.direction, light.outerConeCos, light.innerConeCos);
    vec3 shade = getPointShade(pointToLight, materialInfo, normal, view) * shadow;
    return rangeAttenuation * spotAttenuation * light.intensity * light.color * shade;
}

#ifdef WEBGL2
    out vec4 FRAG_COLOR;
#endif

void main()
{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = 0.0;
    float metallic = 0.0;
    vec4 baseColor = vec4(0.0, 0.0, 0.0, 1.0);
    vec3 diffuseColor = vec3(0.0);
    vec3 specularColor= vec3(0.0);
    vec3 f0 = vec3(0.04);

#ifdef MATERIAL_SPECULARGLOSSINESS

#ifdef HAS_SPECULAR_GLOSSINESS_MAP
    vec4 sgSample = SRGBtoLINEAR(_texture(u_SpecularGlossinessSampler, getSpecularGlossinessUV()));
    perceptualRoughness = (1.0 - sgSample.a * u_GlossinessFactor); // glossiness to roughness
    f0 = sgSample.rgb * u_SpecularFactor; // specular
#else
    f0 = u_SpecularFactor;
    perceptualRoughness = 1.0 - u_GlossinessFactor;
#endif // ! HAS_SPECULAR_GLOSSINESS_MAP

#ifdef HAS_DIFFUSE_MAP
    baseColor = SRGBtoLINEAR(_texture(u_DiffuseSampler, getDiffuseUV())) * u_DiffuseFactor;
#else
    baseColor = u_DiffuseFactor;
#endif // !HAS_DIFFUSE_MAP

    baseColor *= getVertexColor();

    // f0 = specular
    specularColor = f0;
    float oneMinusSpecularStrength = 1.0 - max(max(f0.r, f0.g), f0.b);
    diffuseColor = baseColor.rgb * oneMinusSpecularStrength;

#ifdef DEBUG_METALLIC
    // do conversion between metallic M-R and S-G metallic
    metallic = solveMetallic(baseColor.rgb, specularColor, oneMinusSpecularStrength);
#endif // ! DEBUG_METALLIC

#endif // ! MATERIAL_SPECULARGLOSSINESS

#ifdef MATERIAL_METALLICROUGHNESS

#ifdef HAS_METALLIC_ROUGHNESS_MAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = _texture(u_MetallicRoughnessSampler, getMetallicRoughnessUV());
    perceptualRoughness = mrSample.g * u_RoughnessFactor;
    metallic = mrSample.b * u_MetallicFactor;
#else
    metallic = u_MetallicFactor;
    perceptualRoughness = u_RoughnessFactor;
#endif

    vec4 baseColorFactor = u_BaseColorFactor;
#ifdef USE_INSTANCING
    baseColorFactor = v_BaseColorFactor;
#endif

    // The albedo may be defined from a base texture or a flat color
#if defined(HAS_BASE_COLOR_MAP) && defined(MATERIAL_UNLIT)
    baseColor = _texture(u_BaseColorSampler, getBaseColorUV()) * baseColorFactor;
#elif defined(HAS_BASE_COLOR_MAP)
    baseColor = SRGBtoLINEAR(_texture(u_BaseColorSampler, getBaseColorUV())) * baseColorFactor;
#else
    baseColor = baseColorFactor;
#endif

    baseColor *= getVertexColor();

    diffuseColor = baseColor.rgb * (vec3(1.0) - f0) * (1.0 - metallic);

    specularColor = mix(f0, baseColor.rgb, metallic);

#endif // ! MATERIAL_METALLICROUGHNESS

#ifdef ALPHAMODE_MASK
    if(baseColor.a < u_AlphaCutoff)
    {
        discard;
    }
    baseColor.a = 1.0;
#endif

#ifdef ALPHAMODE_OPAQUE
    baseColor.a = 1.0;
#endif

#ifdef MATERIAL_UNLIT
    FRAG_COLOR = vec4(baseColor.rgb * baseColor.a, baseColor.a);
    return;
#endif

    perceptualRoughness = clamp(perceptualRoughness, 0.0, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    vec3 specularEnvironmentR0 = specularColor.rgb;
    // Anything less than 2% is physically impossible and is instead considered to be shadowing. Compare to "Real-Time-Rendering" 4th editon on page 325.
    vec3 specularEnvironmentR90 = vec3(clamp(reflectance * 50.0, 0.0, 1.0));

    MaterialInfo materialInfo = MaterialInfo(
        perceptualRoughness,
        specularEnvironmentR0,
        alphaRoughness,
        diffuseColor,
        specularEnvironmentR90,
        specularColor
    );

    // LIGHTING

    vec3 color = vec3(0.0, 0.0, 0.0);
    vec3 normal = getNormal();
    vec3 view = normalize(u_Camera - v_Position);

    float shadow = 1.0;
    #ifdef USE_SHADOW_MAPPING
        shadow = getShadowContribution();
    #endif

#ifdef USE_PUNCTUAL
    for (int i = 0; i < LIGHT_COUNT; ++i)
    {
        float shadowContribution = shadow;
        #ifdef USE_SHADOW_MAPPING
        if (u_ShadowLightIndex != i) 
        {
            shadowContribution = 1.0;
        }
        #endif
        Light light = u_Lights[i];
        if (light.type == LightType_Directional)
        {
            color += applyDirectionalLight(light, materialInfo, normal, view, shadowContribution);
        }
        else if (light.type == LightType_Point)
        {
            color += applyPointLight(light, materialInfo, normal, view);
        }
        else if (light.type == LightType_Spot)
        {
            color += applySpotLight(light, materialInfo, normal, view, shadowContribution);
        }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    color += getIBLContribution(materialInfo, normal, view);
#endif

    float ao = 1.0;
    // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSION_MAP
    ao = _texture(u_OcclusionSampler,  getOcclusionUV()).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

    vec3 emissive = vec3(0);
#ifdef HAS_EMISSIVE_MAP
    emissive = SRGBtoLINEAR(_texture(u_EmissiveSampler, getEmissiveUV())).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifndef DEBUG_OUTPUT // no debug

    vec3 toneMappedColor = toneMap(color);

    #ifdef USE_FOG
        float fogDepth = -v_ModelViewPosition.z;
        float fogFactor = smoothstep(u_FogNear, u_FogFar, fogDepth);
        toneMappedColor = mix(toneMappedColor, u_FogColor, fogFactor);
    #endif

    // regular shading
    FRAG_COLOR = vec4(toneMappedColor * baseColor.a, baseColor.a);

#else // debug output

    #ifdef DEBUG_METALLIC
        FRAG_COLOR.rgb = vec3(metallic);
    #endif

    #ifdef DEBUG_ROUGHNESS
        FRAG_COLOR.rgb = vec3(perceptualRoughness);
    #endif

    #ifdef DEBUG_NORMAL
        #ifdef HAS_NORMAL_MAP
            FRAG_COLOR.rgb = _texture(u_NormalSampler, getNormalUV()).rgb;
        #else
            FRAG_COLOR.rgb = vec3(0.5, 0.5, 1.0);
        #endif
    #endif

    #ifdef DEBUG_BASECOLOR
        FRAG_COLOR.rgb = LINEARtoSRGB(baseColor.rgb);
    #endif

    #ifdef DEBUG_OCCLUSION
        FRAG_COLOR.rgb = vec3(ao);
    #endif

    #ifdef DEBUG_EMISSIVE
        FRAG_COLOR.rgb = LINEARtoSRGB(emissive);
    #endif

    #ifdef DEBUG_F0
        FRAG_COLOR.rgb = vec3(f0);
    #endif

    #ifdef DEBUG_ALPHA
        FRAG_COLOR.rgb = vec3(baseColor.a);
    #endif

    FRAG_COLOR.a = 1.0;

#endif // !DEBUG_OUTPUT
}
`},kE={source:`#version VERSION

#define FEATURES

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}
#ifdef HAS_TARGET_POSITION0
VERT_IN vec3 a_Target_Position0;
#endif

#ifdef HAS_TARGET_POSITION1
VERT_IN vec3 a_Target_Position1;
#endif

#ifdef HAS_TARGET_POSITION2
VERT_IN vec3 a_Target_Position2;
#endif

#ifdef HAS_TARGET_POSITION3
VERT_IN vec3 a_Target_Position3;
#endif

#ifdef HAS_TARGET_POSITION4
VERT_IN vec3 a_Target_Position4;
#endif

#ifdef HAS_TARGET_POSITION5
VERT_IN vec3 a_Target_Position5;
#endif

#ifdef HAS_TARGET_POSITION6
VERT_IN vec3 a_Target_Position6;
#endif

#ifdef HAS_TARGET_POSITION7
VERT_IN vec3 a_Target_Position7;
#endif

#ifdef HAS_TARGET_NORMAL0
VERT_IN vec3 a_Target_Normal0;
#endif

#ifdef HAS_TARGET_NORMAL1
VERT_IN vec3 a_Target_Normal1;
#endif

#ifdef HAS_TARGET_NORMAL2
VERT_IN vec3 a_Target_Normal2;
#endif

#ifdef HAS_TARGET_NORMAL3
VERT_IN vec3 a_Target_Normal3;
#endif

#ifdef HAS_TARGET_TANGENT0
VERT_IN vec3 a_Target_Tangent0;
#endif

#ifdef HAS_TARGET_TANGENT1
VERT_IN vec3 a_Target_Tangent1;
#endif

#ifdef HAS_TARGET_TANGENT2
VERT_IN vec3 a_Target_Tangent2;
#endif

#ifdef HAS_TARGET_TANGENT3
VERT_IN vec3 a_Target_Tangent3;
#endif

#ifdef USE_MORPHING
uniform float u_morphWeights[WEIGHT_COUNT];
#endif

#ifdef HAS_JOINT_SET1
VERT_IN vec4 a_Joint1;
#endif

#ifdef HAS_JOINT_SET2
VERT_IN vec4 a_Joint2;
#endif

#ifdef HAS_WEIGHT_SET1
VERT_IN vec4 a_Weight1;
#endif

#ifdef HAS_WEIGHT_SET2
VERT_IN vec4 a_Weight2;
#endif

#ifdef USE_SKINNING
#ifdef USE_SKINNING_TEXTURE
uniform sampler2D u_jointMatrixSampler;
uniform sampler2D u_jointNormalMatrixSampler;
#else
uniform mat4 u_jointMatrix[JOINT_COUNT];
uniform mat4 u_jointNormalMatrix[JOINT_COUNT];
#endif
#endif

// these offsets assume the texture is 4 pixels across
#define ROW0_U ((0.5 + 0.0) / 4.0)
#define ROW1_U ((0.5 + 1.0) / 4.0)
#define ROW2_U ((0.5 + 2.0) / 4.0)
#define ROW3_U ((0.5 + 3.0) / 4.0)

#ifdef USE_SKINNING
mat4 getJointMatrix(float boneNdx) {
    #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(JOINT_COUNT);
    return mat4(
        _texture(u_jointMatrixSampler, vec2(ROW0_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW1_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW2_U, v)),
        _texture(u_jointMatrixSampler, vec2(ROW3_U, v))
    );
    #else
    return u_jointMatrix[int(boneNdx)];
    #endif
}

mat4 getJointNormalMatrix(float boneNdx) {
    #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(JOINT_COUNT);
    return mat4(
        _texture(u_jointNormalMatrixSampler, vec2(ROW0_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW1_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW2_U, v)),
        _texture(u_jointNormalMatrixSampler, vec2(ROW3_U, v))
    );
    #else
    return u_jointNormalMatrix[int(boneNdx)];
    #endif
}

mat4 getSkinningMatrix()
{
    mat4 skin = mat4(0);

    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)
    skin +=
        a_Weight1.x * getJointMatrix(a_Joint1.x) +
        a_Weight1.y * getJointMatrix(a_Joint1.y) +
        a_Weight1.z * getJointMatrix(a_Joint1.z) +
        a_Weight1.w * getJointMatrix(a_Joint1.w);
    #endif

    return skin;
}

mat4 getSkinningNormalMatrix()
{
    mat4 skin = mat4(0);

    #if defined(HAS_WEIGHT_SET1) && defined(HAS_JOINT_SET1)
    skin +=
        a_Weight1.x * getJointNormalMatrix(a_Joint1.x) +
        a_Weight1.y * getJointNormalMatrix(a_Joint1.y) +
        a_Weight1.z * getJointNormalMatrix(a_Joint1.z) +
        a_Weight1.w * getJointNormalMatrix(a_Joint1.w);
    #endif

    return skin;
}
#endif // !USE_SKINNING

#ifdef USE_MORPHING
vec4 getTargetPosition()
{
    vec4 pos = vec4(0);

#ifdef HAS_TARGET_POSITION0
    pos.xyz += u_morphWeights[0] * a_Target_Position0;
#endif

#ifdef HAS_TARGET_POSITION1
    pos.xyz += u_morphWeights[1] * a_Target_Position1;
#endif

#ifdef HAS_TARGET_POSITION2
    pos.xyz += u_morphWeights[2] * a_Target_Position2;
#endif

#ifdef HAS_TARGET_POSITION3
    pos.xyz += u_morphWeights[3] * a_Target_Position3;
#endif

#ifdef HAS_TARGET_POSITION4
    pos.xyz += u_morphWeights[4] * a_Target_Position4;
#endif

    return pos;
}

vec4 getTargetNormal()
{
    vec4 normal = vec4(0);

#ifdef HAS_TARGET_NORMAL0
    normal.xyz += u_morphWeights[0] * a_Target_Normal0;
#endif

#ifdef HAS_TARGET_NORMAL1
    normal.xyz += u_morphWeights[1] * a_Target_Normal1;
#endif

#ifdef HAS_TARGET_NORMAL2
    normal.xyz += u_morphWeights[2] * a_Target_Normal2;
#endif

#ifdef HAS_TARGET_NORMAL3
    normal.xyz += u_morphWeights[3] * a_Target_Normal3;
#endif

#ifdef HAS_TARGET_NORMAL4
    normal.xyz += u_morphWeights[4] * a_Target_Normal4;
#endif

    return normal;
}

vec4 getTargetTangent()
{
    vec4 tangent = vec4(0);

#ifdef HAS_TARGET_TANGENT0
    tangent.xyz += u_morphWeights[0] * a_Target_Tangent0;
#endif

#ifdef HAS_TARGET_TANGENT1
    tangent.xyz += u_morphWeights[1] * a_Target_Tangent1;
#endif

#ifdef HAS_TARGET_TANGENT2
    tangent.xyz += u_morphWeights[2] * a_Target_Tangent2;
#endif

#ifdef HAS_TARGET_TANGENT3
    tangent.xyz += u_morphWeights[3] * a_Target_Tangent3;
#endif

#ifdef HAS_TARGET_TANGENT4
    tangent.xyz += u_morphWeights[4] * a_Target_Tangent4;
#endif

    return tangent;
}

#endif // !USE_MORPHING


VERT_IN vec4 a_Position;
VERT_OUT vec3 v_Position;

VERT_OUT vec3 v_ModelViewPosition;

#ifdef USE_INSTANCING
VERT_IN vec4 a_ModelMatrix0;
VERT_IN vec4 a_ModelMatrix1;
VERT_IN vec4 a_ModelMatrix2;
VERT_IN vec4 a_ModelMatrix3;
#endif

#ifdef USE_INSTANCING
VERT_IN vec4 a_BaseColorFactor;
VERT_OUT vec4 v_BaseColorFactor;
#endif

#ifdef USE_INSTANCING
VERT_IN vec4 a_NormalMatrix0;
VERT_IN vec4 a_NormalMatrix1;
VERT_IN vec4 a_NormalMatrix2;
VERT_IN vec4 a_NormalMatrix3;
#endif

#ifdef HAS_NORMALS
VERT_IN vec4 a_Normal;
#endif

#ifdef HAS_TANGENTS
VERT_IN vec4 a_Tangent;
#endif

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
VERT_OUT mat3 v_TBN;
#else
VERT_OUT vec3 v_Normal;
#endif
#endif

#ifdef HAS_UV_SET1
VERT_IN vec2 a_UV1;
#endif

#ifdef HAS_UV_SET2
VERT_IN vec2 a_UV2;
#endif

VERT_OUT vec2 v_UVCoord1;
VERT_OUT vec2 v_UVCoord2;

#ifdef HAS_VERTEX_COLOR_VEC3
VERT_IN vec3 a_Color;
VERT_OUT vec3 v_Color;
#endif

#ifdef HAS_VERTEX_COLOR_VEC4
VERT_IN vec4 a_Color;
VERT_OUT vec4 v_Color;
#endif

uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_ViewMatrix;
uniform mat4 u_NormalMatrix;

#ifdef USE_SHADOW_MAPPING
uniform mat4 u_LightViewProjectionMatrix;
VERT_OUT vec4 v_PositionLightSpace;
#endif

vec4 getPosition()
{
    vec4 pos = a_Position;

#ifdef USE_MORPHING
    pos += getTargetPosition();
#endif

#ifdef USE_SKINNING
    pos = getSkinningMatrix() * pos;
#endif

    return pos;
}

#ifdef HAS_NORMALS
vec4 getNormal()
{
    vec4 normal = a_Normal;

#ifdef USE_MORPHING
    normal += getTargetNormal();
#endif

#ifdef USE_SKINNING
    normal = getSkinningNormalMatrix() * normal;
#endif

    return normalize(normal);
}
#endif

#ifdef HAS_TANGENTS
vec4 getTangent()
{
    vec4 tangent = a_Tangent;

#ifdef USE_MORPHING
    tangent += getTargetTangent();
#endif

#ifdef USE_SKINNING
    tangent = getSkinningMatrix() * tangent;
#endif

    return normalize(tangent);
}
#endif

void main()
{
    mat4 modelMatrix = u_ModelMatrix;
    #ifdef USE_INSTANCING
        modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
    #endif
    vec4 pos = modelMatrix * getPosition();
    v_Position = vec3(pos.xyz) / pos.w;

    vec4 modelViewPosition = u_ViewMatrix * pos;
    v_ModelViewPosition = vec3(modelViewPosition.xyz) / modelViewPosition.w;

    mat4 normalMatrix = u_NormalMatrix;
    #ifdef USE_INSTANCING
        normalMatrix = mat4(a_NormalMatrix0, a_NormalMatrix1, a_NormalMatrix2, a_NormalMatrix3);
    #endif

    #ifdef HAS_NORMALS
    #ifdef HAS_TANGENTS
    vec4 tangent = getTangent();
    vec3 normalW = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));
    vec3 tangentW = normalize(vec3(modelMatrix * vec4(tangent.xyz, 0.0)));
    vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
    v_TBN = mat3(tangentW, bitangentW, normalW);
    #else // !HAS_TANGENTS
    v_Normal = normalize(vec3(normalMatrix * vec4(getNormal().xyz, 0.0)));
    #endif
    #endif // !HAS_NORMALS

    v_UVCoord1 = vec2(0.0, 0.0);
    v_UVCoord2 = vec2(0.0, 0.0);

    #ifdef HAS_UV_SET1
    v_UVCoord1 = a_UV1;
    #endif

    #ifdef HAS_UV_SET2
    v_UVCoord2 = a_UV2;
    #endif

    #if defined(HAS_VERTEX_COLOR_VEC3) || defined(HAS_VERTEX_COLOR_VEC4)
    v_Color = a_Color;
    #endif

    #ifdef USE_SHADOW_MAPPING
    v_PositionLightSpace = u_LightViewProjectionMatrix * pos;
    #endif

    #ifdef USE_INSTANCING
    v_BaseColorFactor = a_BaseColorFactor;
    #endif

    gl_Position = u_ViewProjectionMatrix * pos;
}
`};class vf extends Tl{constructor(){super(...arguments),this._instancing=new SE}static build(e,t){let i=si.from(Cr.build(kE.source,t,e),Cr.build(_E.source,t,e));return new vf(i)}get name(){return"standard-shader"}createShaderGeometry(e,t){let i=super.createShaderGeometry(e,t);if(t&&this._instancing.addGeometryAttributes(i),e.targets)for(let n=0;n<e.targets.length;n++){let s=e.targets[n].positions;s&&i.addAttribute(`a_Target_Position${n}`,new Fe(s.buffer),3,s.normalized,s.componentType,s.stride);let a=e.targets[n].normals;a&&i.addAttribute(`a_Target_Normal${n}`,new Fe(a.buffer),3,a.normalized,a.componentType,a.stride);let l=e.targets[n].tangents;l&&i.addAttribute(`a_Target_Tangent${n}`,new Fe(l.buffer),3,l.normalized,l.componentType,l.stride)}return e.uvs&&e.uvs[1]&&i.addAttribute("a_UV2",new Fe(e.uvs[1].buffer),2,e.uvs[1].normalized,e.uvs[1].componentType,e.uvs[1].stride),e.joints&&i.addAttribute("a_Joint1",new Fe(e.joints.buffer),4,e.joints.normalized,e.joints.componentType,e.joints.stride),e.weights&&i.addAttribute("a_Weight1",new Fe(e.weights.buffer),4,e.weights.normalized,e.weights.componentType,e.weights.stride),i}render(e,t,i,n){if(e.instances.length>0){const s=e.instances.filter(a=>a.worldVisible&&a.renderable);if(s.length===0)return;this._instancing.updateBuffers(s)}super.render(e,t,i,n)}}var dl=(r=>(r.opaque="opaque",r.transparent="transparent",r))(dl||{});class wf{constructor(){this._renderSortType=dl.opaque,this.state=Object.assign(new Vi,{culling:!0,clockwiseFrontFace:!1,depthTest:!0}),this.drawMode=Bi.TRIANGLES,this.renderSortType=dl.opaque}get depthMask(){return this.state.depthMask}set depthMask(e){this.state.depthMask=e}get doubleSided(){return!this.state.culling}set doubleSided(e){this.state.culling=!e}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}createShader(e,t){}updateUniforms(e,t){}destroy(){}get isInstancingSupported(){return!1}createInstance(){}render(e,t){!this._shader&&(this._shader=this.createShader(e,t),!this._shader)||(this.updateUniforms&&this.updateUniforms(e,this._shader),this._shader.render(e,t,this.state,this.drawMode))}static from(e,t,i){return Object.assign(new wf,{updateUniforms:i||(()=>{}),_shader:new Tl(si.from(e,t))})}}class vr{constructor(e,t){this.renderer=e,this.lights=[],this.renderer.on("prerender",()=>{for(let i of this.lights)i.parent||i.transform.updateTransform()}),vr.main||(vr.main=this),this.imageBasedLighting=t}destroy(){}get valid(){return!this.imageBasedLighting||this.imageBasedLighting.valid}}xt.installRendererPlugin("lighting",vr);class TE{enableJointMatrixTextures(e){this._jointMatrixTexture||(this._jointMatrixTexture=new ia(e)),this._jointNormalTexture||(this._jointNormalTexture=new ia(e))}destroy(){var e,t;(e=this._jointNormalTexture)==null||e.destroy(!0),(t=this._jointMatrixTexture)==null||t.destroy(!0)}update(e,t){e.skin&&(this._jointMatrixTexture?(this._jointMatrixTexture.updateBuffer(e.skin.jointMatrices),t.uniforms.u_jointMatrixSampler=this._jointMatrixTexture):t.uniforms.u_jointMatrix=e.skin.jointMatrices,this._jointNormalTexture?(this._jointNormalTexture.updateBuffer(e.skin.jointNormalMatrices),t.uniforms.u_jointNormalMatrixSampler=this._jointNormalTexture):t.uniforms.u_jointNormalMatrix=e.skin.jointNormalMatrices)}}class ri{constructor(e=0,t=0,i=0,n=1){this._array4=new Float32Array([e,t,i,n]),this._array3=this._array4.subarray(0,3)}static fromBytes(e=0,t=0,i=0,n=255){return new ri(e/255,t/255,i/255,n/255)}static fromHex(e){return typeof e=="string"&&(e=parseInt(e.replace(/[^0-9A-F]/gi,""),16)),ri.fromBytes(e>>16&255,e>>8&255,e&255)}get rgb(){return this._array3}get rgba(){return this._array4}get r(){return this._array4[0]}set r(e){this._array4[0]=e}get g(){return this._array4[1]}set g(e){this._array4[1]=e}get b(){return this._array4[2]}set b(e){this._array4[2]=e}get a(){return this._array4[3]}set a(e){this._array4[3]=e}static from(e){return new ri(...e)}}class CE{constructor(e){this.baseColor=new ri(...e.baseColor.rgba)}}class Cb{constructor(){this.alphaCutoff=.5,this.alphaMode="OPAQUE",this.doubleSided=!1,this.roughness=1,this.metallic=1,this.emissiveFactor=[0,0,0],this.baseColor=[1,1,1,1],this.unlit=!1}}class Zg{static multiply(e,t,i=new Float32Array(9)){return vM(i,e,t)}}class Jn{constructor(){this._rotation=0,this._array=new Float32Array(9),this._dirty=!0,this._translation=new Float32Array([1,0,0,0,1,0,0,0,1]),this._scaling=new Float32Array([1,0,0,0,1,0,0,0,1]),this._rotate=new Float32Array([Math.cos(0),-Math.sin(0),0,Math.sin(0),Math.cos(0),0,0,0,1]),this.offset=new mi(()=>{this._translation.set([1,0,0,0,1,0,this.offset.x,this.offset.y,1]),this._dirty=!0},void 0),this.scale=new mi(()=>{this._scaling.set([this.scale.x,0,0,0,this.scale.y,0,0,0,1]),this._dirty=!0},void 0,1,1)}get rotation(){return this._rotation}set rotation(e){this._rotation=e,this._rotate.set([Math.cos(e),-Math.sin(e),0,Math.sin(e),Math.cos(e),0,0,0,1]),this._dirty=!0}get array(){return this._dirty&&(Zg.multiply(Zg.multiply(this._translation,this._rotate,this._array),this._scaling,this._array),this._dirty=!1),this._array}static fromTexture(e){const t=new Jn;if(!e.frame||e.noFrame)return t;let{x:i,y:n,width:s,height:a}=e.frame;return e.rotate===0&&(t.offset.set(i/e.baseTexture.width,n/e.baseTexture.height),t.scale.set(s/e.baseTexture.width,a/e.baseTexture.height)),e.rotate===2&&(i=e.frame.x+e.frame.width,t.offset.set(i/e.baseTexture.width,n/e.baseTexture.height),t.scale.set(a/e.baseTexture.height,s/e.baseTexture.width),t.rotation=-90*us),t}}class as extends ye{constructor(e,t){super(e),this.uvSet=t}}class AE extends as{constructor(e,t,i){super(e,i),this.scale=t,this.uvSet=i}}class ME extends as{constructor(e,t,i){super(e,i),this.strength=t,this.uvSet=i}}class Ab{create(e){let t=new Gt;if(!(e instanceof Cb))return t;switch(t.baseColor=ri.from(e.baseColor),e.baseColorTexture&&(t.baseColorTexture=new as(e.baseColorTexture.baseTexture,e.baseColorTexture.texCoord),t.baseColorTexture.transform=this.createTextureTransform(e.baseColorTexture)),t.metallic=e.metallic,t.roughness=e.roughness,e.metallicRoughnessTexture&&(t.metallicRoughnessTexture=new as(e.metallicRoughnessTexture.baseTexture,e.metallicRoughnessTexture.texCoord),t.metallicRoughnessTexture.transform=this.createTextureTransform(e.metallicRoughnessTexture)),t.emissive=ri.from(e.emissiveFactor),e.emissiveTexture&&(t.emissiveTexture=new as(e.emissiveTexture.baseTexture,e.emissiveTexture.texCoord),t.emissiveTexture.transform=this.createTextureTransform(e.emissiveTexture)),e.alphaMode){case"BLEND":{t.alphaMode=ir.blend,t.renderSortType=dl.transparent;break}case"MASK":{t.alphaMode=ir.mask;break}case"OPAQUE":{t.alphaMode=ir.blend;break}}return t.unlit=e.unlit,t.doubleSided=e.doubleSided,t.alphaCutoff=e.alphaCutoff,e.normalTexture&&(t.normalTexture=new AE(e.normalTexture.baseTexture,e.normalTexture.scale,e.normalTexture.texCoord),t.normalTexture.transform=this.createTextureTransform(e.normalTexture)),e.occlusionTexture&&(t.occlusionTexture=new ME(e.occlusionTexture.baseTexture,e.occlusionTexture.strength,e.occlusionTexture.texCoord),t.occlusionTexture.transform=this.createTextureTransform(e.occlusionTexture)),t}createTextureTransform(e){if(e.transform){const t=new Jn;return e.transform.offset&&(t.offset.x=e.transform.offset[0],t.offset.y=e.transform.offset[1]),e.transform.rotation!==void 0&&(t.rotation=e.transform.rotation),e.transform.scale&&(t.scale.x=e.transform.scale[0],t.scale.y=e.transform.scale[1]),t}}}var EE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAADAFBMVEX/AACvAwC4BgC1BQD7AAD3AQDzAQD+AAD9AAD8AQDpAQC/CACxAwD5BgDACwCtAwDxAQC9CADDEQCrAwC7BwC4AQDfAQB+AADvAQD1AQD7AwB7AABrAADHAQDCDgDiAQCyBQCRAQD5AAC1AQDYAQDNAQCpAQCUAQCeAQB0AABhAAD3BwCnAQDCBwCMAACOAAD6BABvAADFAgDsAQD4AACIAADEDADKAQDnAQCfAQCoAwDuEADqFACAAACFAACKAADzCwCCAAC/AQCbAgDKDQDwDgC9AQDBAgCiAAC7AQCkAADlAQD0CACzAQDjGwBoAADEFgB4AAD2CADGEQDGDADQAQDbAQDGCADSAQDNCwDWAQDdAQDUAQBlAAB2AADJCADBGgCVAgDOEADtAQBxAADSDADBFgCZAADnGADXDADcIgDKEgDDAQBcAADQLQCkAwDSEADPCADfHgClAgDXBwDTCADkDACYAAC9IACxLgCiAwCZAgDIFgDINgDdDADxCgDuCACSAQDnEADqCgCPAQBYAAC+HADYJgDLMACWAADOFgDbEQCtMwDSGwCGAADLBgC4JwDbGADaDADBIACoVQDRIQCgAgCxTQDHGwDVKQC6IwDCPACRbADGIQDMGwBUAADgEQDgBwDXEgDkFQDkBgCHdgDnCQDSFQC1KgDWFwDgFwDgDACaRwDCJwCcAADLKAC4LwC2RwDELwCYZADLIACkPQDcBgC9KACFXgDrEAB/ZQCoOgDGKAC+LgDYHACpTwC6QwCWTQB5bQCiWwCcAgCfQgBxdACMVgCzNAB9fwCeYADXIQC4NwC+NgCxOgCHbQCRUQDDNwCrOQDRJwCnRQCYWQCuQQBnfQC+QACNZABziwBskAAY4QCXAgB4hQBghgBllwC1QACtSACfTgBfngCPXABYpQChSAC7PAB/dwCeVABTkQBKnABRrABBuwA4wwBcjgBKtAByfAAxywBApQA3sAAo1QBshgAK8QAY0QBXmgAkxgBPpAAqugBFrgA1uwB98tmWAAAOvklEQVR4nO3Ye1jW5RnA8d+Wtmmews2yJTlXrVWUmUNLt5xSVrpygqJZQShMwqWYOHSWhvMwkSESRRaej5hT8ZiJpCvDI5annGYecmpaOWdhHnff93O6n+f3exFc17yubTfG1V9+P8/9/F54X73Tp/fs+fqfX37xj8///um+3X/bu27GjDfeWLT+ry+//OqrC9/56PXXX3hh9HPPvTZq1LPP9u//2GO9e7du3bpVq1YPPtimTZuOHTvfAVO7dtOmN9xwQ40aNb6P8z01XqXm/4DTp09//b+9gT2n91zZDezZc6U3sOcKb+CbKw745hvo/7cALkcAgLNwA198fsUAZ8+epUfg8081YNF/EnD2/NmzX14UN3AZG+j8LQDOn7948YsLdAO7964jwHof4DUOeKuSgEoJCPDVhQvn5CPgXsEHLqD3twy4eP4rGAM4OqNMAEqqBGgaCKiM4KLsnzvz7wIucwUIOHXqFAD2nagS4EEGCHkHlSBcwPypc8fPnDmxu7xcAtZXFtAxEFClS7iA/ePHj585se+T8r0nsY+vQgQsrAqA/zC2VnApwgXKHz9z7MSJ8vKT66oM6GwDggQVE85h/tgx6H+iALvoVVgJQBsNqOAOLiUAwLHj1P+k/OTJo0fLynYtWrQdAQeCAI+FBFyu4MyZYzjQ37lTAbYDoAQ28M47RwAw2g94CwFD1UMQBHAFoQ0EOCH7a9dAf9eu7ds/gwUcsAGjLEArDehMAHEHFQpCIPadwDr2d0IfF4B9Adh/5MgmDdggANM4IPAOKhIEMPbp/tq1a9esWbFr1yEEHATA/v1HPpKArQLQXwBaM4C6g6oILM1umRf9MgUoEYAjHPCsAfCHwFqBJagMwSsvL9+p+2tWLN91CAEHAbBDAIoAsHXraxsUYFqGfQfOCmzBpQme6K8V+1+xAvqH8AYObyPAJgLMl4DC/oUIyNCAoXwFwYJLGby9J+HhXyvPv2L58kOHtsACDpZs2wGAjQgoQsDWDRtWwQYKC6dN660BQ4cGrUAIOKEihLdO9CmP/fcPbVl9EBagAEVFRfMBkEeAQgRMQwAKhqKAraBJU74DhxBK4a07KvKiv/z997cA4DABNm+0AatyJECuYJgEKEETJahWrUYIQ8DviaNH1xwVedO3ASsJkAeA/oV0BxkZGbiCYQgY2rGjuITqtWs3byIJ1aoZQqCBabwZKi/6CFgt+wgoFhvII0COWIEGGAEAqtdurgRNqlmEChFeWVkZy8u+BhQX0wbmWwApGNbKABre0bB69eYkAEITIbAMoRQIKMO6Of+bb7733ra3P9y8uXTjgmIQrFzpBwzPGP7WMLaChjDVDQG/BRkCJN4b8MtH1k1/yRIDmAeAxQDIQgAIJtMGADA8tEBMtWqhERri7cI5dEjkZf+9JW8DoLR0AQDm+QCTBQBGCOoRoaEhMINBhHJ4i/Bnn8xTXy6AAxYbQM5kAAy0BTBXw4Qg2Agfw4O3PyDYIvK6//aHY0s5YPHEvKw5c1YJwOSBAwcKAAmuB0A9LQgkuAhG8dZvhxF1kRcLGDsW+wuWLQNAAQDysrJAAIBMIcjImKkFQ68fWq/j1RaBDC4iEEKA1dtlXpyfFjB2EADGIaAAARMJMDUnM1OtYOZMtoJ6MA4hpMF2eJ/hrD64+k19fNEfO2jQbAUAwcSJCJgzNVMLZhoBGhwCM4RU0CDgIIy/X0p9CZgoATlCMHeuLbgepp5LEAaFCKXwXj5Ygj/7Dx+WeeiPpfMPmj2bALkCkJU1a9asOVMVgAvu9RG0QSK0ws/wSkpKDsu+yBNA9MdNWJaeC4D8fNjAmFlZCEDBi3O1gAj39uw5rKcmuAaFMAoOAcDhkm0wS7aZvOqPW5aePk8DxsAKJEAKpmsBEHoSga+BIwzDcjRv7h04cIDnqY8PIC1gQjpuIB8BYyyAEExHQc2ZNYfXvNclaIOFYAwlQcCBHdu2URx+/snzE2CCAOQCYIjcQD8QjM8cLwXTpxNhZs2aKDAEaTAIR8Eh3sIDO2g+xBlr+uNEHwDxCBgyhlbQDwTJ48cLwZQpStByuCHYBoYIYMB4C/djfbPKD1LHFxcAgHgBSEFAPwAkJyvBlCmS0KFlSyS4Bo2wFI7D2w+zGWdsqdtHwMj43PhO0EdAQgIA+iVrwZQpFqGmJAiDD+EyJEQD4HdPqcrLPgBGjoyPj+/UCQEpCQkkSHQE02k6KEKAwVK4DO/Ikf0bN5ZSvlTl9QNAfQB0QoAUJCrB0qVLzQ46dCACM0iEUVgMDQHARhwSLJhtHV8vQAJIkJjIBZJwUwiDQjCF65CABTSiLvoT0kdCHwBJkDeAxEQlGCAE0nCTFDCDi7AZyuFtwllAgtnjFjh57Cc5G0BDWlryABwh6IEAmg7GIBFKwRi2w/sA+8ViAzovnj8EJBEgOjoaAVHqDkCQNmDAeC3o0aBBkEEhtIIzeirAB5uKN8Gb3+JlOLpu+hKAhKjuOImpBEgbwJeAhgYNLINEaIVhcAcAioqpD4IJSEhPF4+f6gMgDPPRKVFRJEhNlQJJ6Np1aVcUEEEaNEIpDIM5UOLBR6+i4iK5gGWyrvpiA2FhtIGoaFcgAANuvrkrInr0sPbAEEEM5fBeQME8GpkXdXX+pKQwBaDpLgmpaS4Bpoe7CEuhGRzijSZA0Tx46wNf6bmqD6cfqfpCEBMVowipqZrw5JNCoAwMYRQWgzlaImD0ShzcQK6Yker1Z/oIiIkhQTYTkOFJmCeeGPDEzS7Cp3AcAuKNnj9aAApyhSCeJkn35QoiY3DioqLi4rKzu2cLQrfULt26pXUTBhhmsBUWw3J48Nl7PgDgnWeBvy/rYeFhkTAkoMmmIUOXLmDoRgaDcBWKYTsI4j1HggI58fG5/PyqHx4eKQWxcUEEMrgIo1AM7WAQbyv0F8+nem5BfH7g+RUgMiYWhgGyb7lFAAIQUsEY2mEgDQAAAvjotbgA3/zmF+R3gt9++vxJ4bB904+MlWMbYCyEUIRkMAhIALB1MU1BPgri8/F3j9p+nSTR9wli+UU4CEshGcphQ1Di4T+ACUE+Tic58vEPNxPpGgSiRYsW2dktblHTJZihHBqiJd7WPCGYKABKIG6/TlIditP3iIjICJjY2AgJaNSoURz810JNgEIytENDtMTLy8P+RBx895vP+2EyXocmIjxCT7NmzWLhT2xss0Y0LfwKy6Egfok3Ko+GBPDecwjrh1t9EKiJlQY9jVwGdwRCtMTbkLdB5qkP7770+cOsvEWQ06dPAIM7QkI0xduwAf/1JcsIojtFq3yS069zjRxot2/fnr6179PHZgQ6LIhFAQDk87LGjNEAGHMBTllPe3f6WJBG1rSowOKtWoWCiVn42S8lRfSjzQOg+9daQ4i2OMESzWlUEaWFAKzCKxCAISkKEM4X4NTlPKSmbVsfpY89AVtRGASskn3YgALwPo/+gM0j1z7ykG/asgm09HHuCAFz5mTNmiUBKSkuILgO/aCpqqZPMy8HAXMMgG2g6v2KOG2DOV5OjgCAIIEAQAiL9PV1+Lt8fhhiqgACQI4AzEpIUBuAXzl2P6BdUb/SJHB4hQYgriAK+5G8789fJeYnlZlLoDiANhAVHRPQ97Vxfl3ZqciFgBwCwOfOlAT4+BWjAeb4/vhVVzWmv7tx48Y8VUtO5WUEmDp1zqx++MlX98PVj5+gfGM1svadKkwtNmTwCguhP3Vqv34JQIhiC3D6dtzXrRtybEBd+aUHATkCADcAnz8V4Bp1Ab48a/NQ/VBzq/1Vt775ql+/LgIy3Q3wBZi8rNttq1T1qX8rADIlICGKAGwBvM/PbrXZX3e/nDsrnkfpjxxvWmFmjtpAlAbQr1+nz+tW3G0+b+bRS443bbLeALsBp6/zfOsmjak7Te/hwLlPfuEfNgTI1IAYC8D7Tp7i+rR9+wZkX1Fznzu34cj/B8BkAUhM6C5fhE6/sezrPB1dxfv27Tt48GAryiowf6lg2rVrpwGJGhBBAKtv57Eu44NpXnnlYRW+ze62k/PbkCMByQDorgF6AVaf8verel9ZV2dmXTf5ezEfq/kTHwFITsYFdKfXAFuA7rt5FtdtWeZRlntGzE/VvKTGBsQhIIIWENCnZ17nRR3K74q2KausSb7E5sdq/kjDAVEAiBU3IBeg+ip/P+bl4eno78KoY4u0DPMqy8m5W85dd92FgBcJQDcA/Yg61gJ438qr+h9UW6RNmVdVTs8DarwMAIxXgFi2AKtv52Ud4jAyTm23zLM6+cDP+ViAOPjszxbg9k2ezi7qIq7OrdIm7Eb/bOaXOA5APIJiAVZfHV/m6fCmzto6bYWtJs6v1HgZAzUgLk7dgLwA3rfydHiqO3GTtsJu9RdmADCXAKnyBtgC3D48eioPh6ezm7qImzYvO9nr+AQC1AU4fXr0VF5unuombtqs7O/+yIwNiIyANwJsAbIv13+buHuZ99V13LSdsMn+Rs3TEpAGAHoEQvX18Vle1dXRVdzfdsNPi/kZjA2I4AC8ANaX2w/KO3HetsumK6dXLw2AF4F4BCrq06On825dxe12ULmXmHtgHIBeAF2A24cXXnDe1EO07fI9em68UQFSu2drAFuA7os89WXeqeujO20rzcJqLIC5AbmA55+nPj++P8/PruPs3Fb6RjaP4xgAPoNqAbVUv29AXyyf8vrwvjo7tz/9uJqnnnrKG64B4gbEAswFqP4zKn+3nXfr+uSBbVamuf12CUjkAL2Avub+nzHHD8izuj65G/elxTgbEDeACxAPQIi+P8/q5ujB7dutEYC0tNTsuKAFsH6IvDy8r27HA9q/EyMBiRyAL4FL9HneHN49Oo8HtGFGjCBAMgPQDcAC6ALg5w/vh8zze684ztJiFKA7/RTAR4BugBaALwDTt4+v887hWd2N+9ojRkyaNIkAA+gZjIiQN0ALUBfg9HX+OjsfWPfHrTYNB4gbkAugC4D+x9QX128f38mHrPvik/gogH4EGtfSC4ALkH08v1y/yYu77+XmA+vBcZx/AeDdATn/vA1ZAAAAAElFTkSuQmCC";class xf{get diffuse(){return this._diffuse}get specular(){return this._specular}constructor(e,t){this._diffuse=e,this._specular=t}get valid(){return this._diffuse.valid&&this._specular.valid&&(!this.lookupBrdf||this.lookupBrdf.valid)}}xf.defaultLookupBrdf=ye.from(EE,{mipmap:Ei.OFF});const ed={},Jg=r=>r?r.lights.length+(r.imageBasedLighting?.5:0):0;class Gt extends wf{constructor(){super(...arguments),this._lightingEnvironmentConfigId=0,this._unlit=!1,this._alphaMode=ir.blend,this._baseColorFactor=new Float32Array(4),this._instancingEnabled=!1,this._skinUniforms=new TE,this.roughness=1,this.metallic=1,this.baseColor=new ri(1,1,1,1),this.alphaCutoff=.5,this.emissive=new ri(0,0,0),this.exposure=1}get baseColorTexture(){return this._baseColorTexture}set baseColorTexture(e){e!==this._baseColorTexture&&(this.invalidateShader(),!(e!=null&&e.transform)&&(e!=null&&e.frame)&&!(e!=null&&e.noFrame)&&(e.transform=Jn.fromTexture(e)),this._baseColorTexture=e)}get metallicRoughnessTexture(){return this._metallicRoughnessTexture}set metallicRoughnessTexture(e){e!==this._metallicRoughnessTexture&&(this.invalidateShader(),!(e!=null&&e.transform)&&(e!=null&&e.frame)&&!(e!=null&&e.noFrame)&&(e.transform=Jn.fromTexture(e)),this._metallicRoughnessTexture=e)}get normalTexture(){return this._normalTexture}set normalTexture(e){e!==this._normalTexture&&(this.invalidateShader(),!(e!=null&&e.transform)&&(e!=null&&e.frame)&&!(e!=null&&e.noFrame)&&(e.transform=Jn.fromTexture(e)),this._normalTexture=e)}get occlusionTexture(){return this._occlusionTexture}set occlusionTexture(e){e!==this._occlusionTexture&&(this.invalidateShader(),!(e!=null&&e.transform)&&(e!=null&&e.frame)&&!(e!=null&&e.noFrame)&&(e.transform=Jn.fromTexture(e)),this._occlusionTexture=e)}get emissiveTexture(){return this._emissiveTexture}set emissiveTexture(e){e!==this._emissiveTexture&&(this.invalidateShader(),!(e!=null&&e.transform)&&(e!=null&&e.frame)&&!(e!=null&&e.noFrame)&&(e.transform=Jn.fromTexture(e)),this._emissiveTexture=e)}get alphaMode(){return this._alphaMode}set alphaMode(e){this._alphaMode!==e&&(this._alphaMode=e,this.invalidateShader())}get shadowCastingLight(){return this._shadowCastingLight}set shadowCastingLight(e){e!==this._shadowCastingLight&&(this.invalidateShader(),this._shadowCastingLight=e)}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode!==e&&(this.invalidateShader(),this._debugMode=e)}get lightingEnvironment(){return this._lightingEnvironment}set lightingEnvironment(e){e!==this._lightingEnvironment&&(this.invalidateShader(),this._lightingEnvironmentConfigId=Jg(e),this._lightingEnvironment=e)}get unlit(){return this._unlit}set unlit(e){this._unlit!==e&&(this._unlit=e,this.invalidateShader())}destroy(){var e,t,i,n,s;(e=this._baseColorTexture)==null||e.destroy(),(t=this._normalTexture)==null||t.destroy(),(i=this._emissiveTexture)==null||i.destroy(),(n=this._occlusionTexture)==null||n.destroy(),(s=this._metallicRoughnessTexture)==null||s.destroy(),this._skinUniforms.destroy()}invalidateShader(){this._shader=void 0}static create(e){return new Ab().create(e)}render(e,t){!this._instancingEnabled&&e.instances.length>0&&(this.invalidateShader(),this._instancingEnabled=!0),this._instancingEnabled&&e.instances.length===0&&(this.invalidateShader(),this._instancingEnabled=!1);let i=this.lightingEnvironment||vr.main,n=Jg(i);n!==this._lightingEnvironmentConfigId&&(this.invalidateShader(),this._lightingEnvironmentConfigId=n),super.render(e,t)}get isInstancingSupported(){return!0}createInstance(){return new CE(this)}createShader(e,t){if(t.context.webGLVersion===1){let a=["EXT_shader_texture_lod","OES_standard_derivatives"];for(let l of a)t.gl.getExtension(l)}let i=this.lightingEnvironment||vr.main,n=eu.build(t,e,e.geometry,this,i);if(!n)return;e.skin&&eu.hasSkinningTextureFeature(n)&&this._skinUniforms.enableJointMatrixTextures(e.skin.joints.length);let s=n.join(",");return ed[s]||(ed[s]=vf.build(t,n)),ed[s]}updateUniforms(e,t){var i,n,s,a,l;for(let d=0;d<3;d++)this._baseColorFactor[d]=this.baseColor.rgba[d];this._baseColorFactor[3]=this.baseColor.a*e.worldAlpha;let o=this.camera||tn.main;e.skin&&this._skinUniforms.update(e,t),t.uniforms.u_Camera=o.worldTransform.position.array,t.uniforms.u_ViewProjectionMatrix=o.viewProjection.array,t.uniforms.u_ViewMatrix=o.view.array,t.uniforms.u_Exposure=this.exposure,t.uniforms.u_MetallicFactor=this.metallic,t.uniforms.u_RoughnessFactor=this.roughness,t.uniforms.u_BaseColorFactor=this._baseColorFactor,t.uniforms.u_ModelMatrix=e.worldTransform.array,t.uniforms.u_NormalMatrix=e.transform.normalTransform.array,this._alphaMode===ir.mask&&(t.uniforms.u_AlphaCutoff=this.alphaCutoff),e.targetWeights&&e.targetWeights.length>0&&(t.uniforms.u_morphWeights=e.targetWeights),(i=this.baseColorTexture)!=null&&i.valid&&(t.uniforms.u_BaseColorSampler=this.baseColorTexture,t.uniforms.u_BaseColorUVSet=this.baseColorTexture.uvSet||0,this.baseColorTexture.transform&&(t.uniforms.u_BaseColorUVTransform=this.baseColorTexture.transform.array));let u=this.lightingEnvironment||vr.main;for(let d=0;d<u.lights.length;d++){let p=u.lights[d],v=0;switch(p.type){case br.point:v=1;break;case br.directional:v=0;break;case br.spot:v=2;break}t.uniforms[`u_Lights[${d}].type`]=v,t.uniforms[`u_Lights[${d}].position`]=p.worldTransform.position.array,t.uniforms[`u_Lights[${d}].direction`]=p.worldTransform.forward.array,t.uniforms[`u_Lights[${d}].range`]=p.range,t.uniforms[`u_Lights[${d}].color`]=p.color.rgb,t.uniforms[`u_Lights[${d}].intensity`]=p.intensity,t.uniforms[`u_Lights[${d}].innerConeCos`]=Math.cos(p.innerConeAngle*us),t.uniforms[`u_Lights[${d}].outerConeCos`]=Math.cos(p.outerConeAngle*us)}u.fog&&(t.uniforms.u_FogNear=u.fog.near,t.uniforms.u_FogFar=u.fog.far,t.uniforms.u_FogColor=u.fog.color.rgb),this._shadowCastingLight&&(t.uniforms.u_ShadowSampler=this._shadowCastingLight.shadowTexture,t.uniforms.u_LightViewProjectionMatrix=this._shadowCastingLight.lightViewProjection,t.uniforms.u_ShadowLightIndex=u.lights.indexOf(this._shadowCastingLight.light));let h=u.imageBasedLighting;h!=null&&h.valid&&(t.uniforms.u_DiffuseEnvSampler=h.diffuse,t.uniforms.u_SpecularEnvSampler=h.specular,t.uniforms.u_brdfLUT=h.lookupBrdf||xf.defaultLookupBrdf,t.uniforms.u_MipCount=h.specular.levels-1),(n=this.emissiveTexture)!=null&&n.valid&&(t.uniforms.u_EmissiveSampler=this.emissiveTexture,t.uniforms.u_EmissiveUVSet=this.emissiveTexture.uvSet||0,t.uniforms.u_EmissiveFactor=this.emissive.rgb,this.emissiveTexture.transform&&(t.uniforms.u_EmissiveUVTransform=this.emissiveTexture.transform.array)),(s=this.normalTexture)!=null&&s.valid&&(t.uniforms.u_NormalSampler=this.normalTexture,t.uniforms.u_NormalScale=this.normalTexture.scale||1,t.uniforms.u_NormalUVSet=this.normalTexture.uvSet||0,this.normalTexture.transform&&(t.uniforms.u_NormalUVTransform=this.normalTexture.transform.array)),(a=this.metallicRoughnessTexture)!=null&&a.valid&&(t.uniforms.u_MetallicRoughnessSampler=this.metallicRoughnessTexture,t.uniforms.u_MetallicRoughnessUVSet=this.metallicRoughnessTexture.uvSet||0,this.metallicRoughnessTexture.transform&&(t.uniforms.u_MetallicRoughnessUVTransform=this.metallicRoughnessTexture.transform.array)),(l=this.occlusionTexture)!=null&&l.valid&&(t.uniforms.u_OcclusionSampler=this.occlusionTexture,t.uniforms.u_OcclusionStrength=this.occlusionTexture.strength||1,t.uniforms.u_OcclusionUVSet=this.occlusionTexture.uvSet||0,this.occlusionTexture.transform&&(t.uniforms.u_OcclusionUVTransform=this.occlusionTexture.transform.array))}}class Fu{constructor(){this._onChanged=()=>{this._center.set((this._min.x+this._max.x)/2,(this._min.y+this._max.y)/2,(this._min.z+this._max.z)/2),this._extents.set(Math.abs(this._max.x-this._center.x),Math.abs(this._max.y-this._center.y),Math.abs(this._max.z-this._center.z)),this._size.set(this._extents.x*2,this._extents.y*2,this._extents.z*2)},this._min=new nt(0,0,0,this._onChanged,this),this._max=new nt(0,0,0,this._onChanged,this),this._center=new nt(0,0,0,()=>{},this),this._size=new nt(0,0,0,()=>{},this),this._extents=new nt(0,0,0,()=>{},this)}get min(){return this._min}set min(e){this._min.copyFrom(e)}get max(){return this._max}set max(e){this._max.copyFrom(e)}get center(){return this._center}get size(){return this._size}get extents(){return this._extents}static from(e){let t=new Fu;return t.min.setFrom(e.min),t.max.setFrom(e.max),t}encapsulate(e){this._min.x=Math.min(this._min.x,e.x),this._min.y=Math.min(this._min.y,e.y),this._min.z=Math.min(this._min.z,e.z),this._max.x=Math.max(this._max.x,e.x),this._max.y=Math.max(this._max.y,e.y),this._max.z=Math.max(this._max.z,e.z)}}class PE{static create(e={}){var t,i,n,s;const a=(t=e==null?void 0:e.radius)!=null?t:1,l=Math.max(3,Math.floor((i=e==null?void 0:e.segments)!=null?i:32)),o=(n=e==null?void 0:e.thetaStart)!=null?n:0,u=(s=e==null?void 0:e.thetaLength)!=null?s:Math.PI*2,h=[],d=[],p=[],v=[],w=Ue.create(),_=Ue.create();d.push(0,0,0),p.push(0,0,1),v.push(.5,.5);for(let T=0,D=3;T<=l;T+=1,D+=3){const L=o+T/l*u;w[0]=a*Math.cos(L),w[1]=a*Math.sin(L),d.push(w[0],w[1],w[2]),p.push(0,0,1),_[0]=(d[D]/a+1)/2,_[1]=(d[D+1]/a+1)/2,v.push(_[0],_[1])}for(let T=1;T<=l;T+=1)h.push(T,T+1,0);return Object.assign(new Bn,{normals:{buffer:new Float32Array(p)},uvs:[{buffer:new Float32Array(v)}],indices:{buffer:new Uint16Array(h)},positions:{buffer:new Float32Array(d)}})}}class IE{static create(e={}){var t,i,n,s,a,l,o,u;const h=(t=e==null?void 0:e.radiusTop)!=null?t:1,d=(i=e==null?void 0:e.radiusBottom)!=null?i:1,p=(n=e==null?void 0:e.height)!=null?n:1,v=Math.floor((s=e==null?void 0:e.radialSegments)!=null?s:32),w=Math.floor((a=e==null?void 0:e.heightSegments)!=null?a:1),_=(l=e==null?void 0:e.openEnded)!=null?l:!1,T=(o=e==null?void 0:e.thetaStart)!=null?o:0,D=(u=e==null?void 0:e.thetaLength)!=null?u:Math.PI*2,L=[],O=[],z=[],V=[];let Q=0;const S=[],Z=p/2,re=()=>{const le=(d-h)/p;for(let oe=0;oe<=w;oe+=1){const X=[],K=oe/w,_e=K*(d-h)+h;for(let Se=0;Se<=v;Se+=1){const de=Se/v,De=de*D+T,Ve=Math.sin(De),ae=Math.cos(De),Ie=_e*Ve,Xe=-K*p+Z,Je=_e*ae;O.push(Ie,Xe,Je);const Ze=Ve,pt=le,mt=ae,vt=Ue.normalize(Ue.fromValues(Ze,pt,mt));V.push(vt[0],vt[1],vt[2]),z.push(de,1-K),X.push(Q),Q+=1}S.push(X)}for(let oe=0;oe<v;oe+=1)for(let X=0;X<w;X+=1){const K=S[X][oe],_e=S[X+1][oe],Se=S[X+1][oe+1],de=S[X][oe+1];L.push(K,_e,de),L.push(_e,Se,de)}},me=le=>{const oe=Q,X=le===!0?h:d,K=le===!0?1:-1;for(let Se=1;Se<=v;Se+=1)O.push(0,Z*K,0),V.push(0,K,0),z.push(.5,.5),Q+=1;const _e=Q;for(let Se=0;Se<=v;Se+=1){const De=Se/v*D+T,Ve=Math.cos(De),ae=Math.sin(De),Ie=X*ae,Xe=Z*K,Je=X*Ve;O.push(Ie,Xe,Je),V.push(0,K,0);const Ze=Ve*.5+.5,pt=ae*.5*K+.5;z.push(Ze,pt),Q+=1}for(let Se=0;Se<v;Se+=1){const de=oe+Se,De=_e+Se;le===!0?L.push(De,De+1,de):L.push(De+1,De,de)}};return re(),_===!1&&(h>0&&me(!0),d>0&&me(!1)),Object.assign(new Bn,{normals:{buffer:new Float32Array(V)},uvs:[{buffer:new Float32Array(z)}],indices:{buffer:new Uint16Array(L)},positions:{buffer:new Float32Array(O)}})}}var Jd;(r=>{function e(t={}){const{radius:i=1,segments:n=32,rings:s=16}=t,a=[],l=[],o=[],u=[],h=[];let d=0;for(let p=0;p<=s;p++){const v=[],w=p/s;let _=0;p==0?_=.5/n:p==s&&(_=-.5/n);for(let T=0;T<=n;T++){const D=T/n;let L=-i*Math.cos(D*Math.PI*2)*Math.sin(w*Math.PI),O=i*Math.cos(w*Math.PI),z=i*Math.sin(D*Math.PI*2)*Math.sin(w*Math.PI),V=Ue.fromValues(L,O,z);o.push(L,O,z),h.push(...Ue.normalize(V)),u.push(D+_,1-w),v.push(d++)}a.push(v)}for(let p=0;p<s;p++)for(let v=0;v<n;v++){const w=a[p][v+1],_=a[p][v],T=a[p+1][v],D=a[p+1][v+1];p!==0&&l.push(w,_,D),p!==s-1&&l.push(_,T,D)}return Object.assign(new Bn,{normals:{buffer:new Float32Array(h)},uvs:[{buffer:new Float32Array(u)}],indices:{buffer:new Uint16Array(l)},positions:{buffer:new Float32Array(o)}})}r.create=e})(Jd||(Jd={}));class bt extends xn{constructor(e,t){if(super(),this.geometry=e,this.material=t,this.pluginName="pipeline",this.enabledRenderPasses={material:{}},this.renderSortOrder=0,this._instances=[],!e)throw new Error("PIXI3D: Geometry is required when creating a mesh.")}get instances(){return this._instances}createInstance(){var e;if(this.material&&!this.material.isInstancingSupported)throw new Error("PIXI3D: Can't create instance of mesh, material does not support instancing.");return this._instances[this._instances.push(new xE(this,(e=this.material)==null?void 0:e.createInstance()))-1]}removeInstance(e){const t=this._instances.indexOf(e);t>=0&&this._instances.splice(t,1)}enableRenderPass(e,t){this.enabledRenderPasses[e]||(this.enabledRenderPasses[e]=t||{})}disableRenderPass(e){this.enabledRenderPasses[e]&&delete this.enabledRenderPasses[e]}isRenderPassEnabled(e){return!!this.enabledRenderPasses[e]}destroy(e){(e===!0||e&&e.geometry)&&this.geometry.destroy(),(e===!0||e&&e.material)&&this.material&&this.material.destroy(),super.destroy(e)}_render(e){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.skin&&this.skin.calculateJointMatrices(),e.plugins[this.pluginName].render(this)}getBoundingBox(){var e,t;if(!((e=this.geometry.positions)!=null&&e.min)||!((t=this.geometry.positions)!=null&&t.max))return;let i=Ue.transformMat4(this.geometry.positions.min,this.worldTransform.array),n=Ue.transformMat4(this.geometry.positions.max,this.worldTransform.array);for(let s=0;s<3;s++){let a=i[s];i[s]=Math.min(i[s],n[s]),n[s]=Math.max(a,n[s])}return Fu.from({min:i,max:n})}static createQuad(e=new Gt){return new bt(Zd.create(),e)}static createCube(e=new Gt){return new bt(Yd.create(),e)}static createPlane(e=new Gt){return new bt(qd.create(),e)}static createSphere(e=new Gt,t){return new bt(Jd.create(t),e)}static createCircle(e=new Gt,t={}){return new bt(PE.create(t),e)}static createCylinder(e=new Gt,t={}){return new bt(IE.create(t),e)}}class DE extends Mr{constructor(e){super(),this.name=e,this.speed=1,this.loop=!1}play(e=Lt.shared){this.position=0,this._ticker||(this._update=()=>{this.update(e.deltaMS/1e3*this.speed)},this._ticker=e.add(this._update))}stop(){this._ticker&&this._update&&(this._ticker.remove(this._update),this._ticker=this._update=void 0)}update(e){this.position+=e,!(this.position<this.duration)&&(this.loop?this.position>this.duration&&(this.position=this.position%this.duration):(this.position=this.duration,this.stop()),this.emit("complete"))}}class FE extends DE{constructor(e,t){super(t),this._duration=0,this._position=0,this._channels=[];for(let i of e)this._duration=Math.max(this._duration,i.duration);this._channels=e}get duration(){return this._duration}get position(){return this._position}set position(e){this._position=e;for(let t of this._channels)t.position=this._position}}class cr{constructor(e,t,i=0,n,s=!1,a,l){this.buffer=e,this.componentType=t,this.stride=i,this.componentCount=n,this.normalized=s,this.min=a,this.max=l}static from(e,t,i,n,s,a,l=!1,o,u){switch(e){case 5125:return new cr(new Uint32Array(i,n,s),e,a,t,l,o,u);case 5126:return new cr(new Float32Array(i,n,s),e,a,t,l,o,u);case 5120:return new cr(new Int8Array(i,n,s),e,a,t,l,o,u);case 5121:return new cr(new Uint8Array(i,n,s),e,a,t,l,o,u);case 5122:return new cr(new Int16Array(i,n,s),e,a,t,l,o,u);case 5123:return new cr(new Uint16Array(i,n,s),e,a,t,l,o,u);default:throw new Error(`PIXI3D: Unknown component type "${e}".`)}}}class RE{constructor(e,t){this.parent=e,this.joints=t,this._jointMatrices=[],this._jointNormalMatrices=[],this._transformIds=[],this.jointNormalMatrices=new Float32Array(this.joints.length*16),this.jointMatrices=new Float32Array(this.joints.length*16);for(let i=0;i<t.length;i++)this._transformIds.push(-1),this._jointMatrices.push(new Float32Array(this.jointMatrices.buffer,16*4*i,16)),this._jointNormalMatrices.push(new Float32Array(this.jointNormalMatrices.buffer,16*4*i,16))}calculateJointMatrices(){for(let e=0;e<this.joints.length;e++)this.joints[e].transform._worldID!==this._transformIds[e]&&(this._transformIds[e]=this.joints[e].transform._worldID,je.multiply(this.joints[e].worldTransform.array,this.joints[e].inverseBindMatrix,this._jointMatrices[e]),je.multiply(this.parent.transform.inverseWorldTransform.array,this._jointMatrices[e],this._jointMatrices[e]),je.invert(this._jointMatrices[e],this._jointNormalMatrices[e]),je.transpose(this._jointNormalMatrices[e],this._jointNormalMatrices[e]))}}class OE extends xn{constructor(e){super(),this.inverseBindMatrix=e}}function Sf(r,e){switch(r.constructor){case Float32Array:return t=>t;case Uint32Array:return t=>{for(let i=0;i<e;i++)t[i]=t[i]/4294967295;return t};case Uint16Array:return t=>{for(let i=0;i<e;i++)t[i]=t[i]/65535;return t};case Uint8Array:return t=>{for(let i=0;i<e;i++)t[i]=t[i]/255;return t};case Int32Array:return t=>{for(let i=0;i<e;i++)t[i]=Math.max(t[i]/2147483647,-1);return t};case Int16Array:return t=>{for(let i=0;i<e;i++)t[i]=Math.max(t[i]/32767,-1);return t};case Int8Array:return t=>{for(let i=0;i<e;i++)t[i]=Math.max(t[i]/127,-1);return t};default:throw new Error("Invalid component type.")}}class LE{constructor(e,t){this._output=e,this._stride=t,this._data=new Float32Array(t),this._denormalize=Sf(this._output,this._stride)}interpolate(e,t){let i=(e+0)*this._stride,n=(e+1)*this._stride;for(let s=0;s<this._stride;s++)this._output.length>n?this._data[s]=(1-t)*this._output[i+s]+t*this._output[n+s]:this._data[s]=this._output[i+s];return this._denormalize(this._data)}}class _f{constructor(e,t,i){this._input=e,this._output=t,this._stride=i,this._data=new Float32Array(i),this._denormalize=Sf(this._output,this._stride)}interpolate(e,t){const i=this._input[e+1]-this._input[e],n=(e+0)*this._stride*3,s=(e+1)*this._stride*3;for(let a=0;a<this._stride;a++)this._data[a]=_f.calculate(t,this._output[n+a+1*this._stride],this._output[s+a+1*this._stride],i*this._output[s+a],i*this._output[n+a+2*this._stride]);return this._denormalize(this._data)}static calculate(e,t,i,n,s){return(2*e**3-3*e**2+1)*t+(e**3-2*e**2+e)*n+(-2*e**3+3*e**2)*i+(e**3-e**2)*s}}class BE{constructor(e,t){this._output=e,this._stride=t,this._data=new Float32Array(t),this._denormalize=Sf(this._output,this._stride)}interpolate(e){for(let t=0;t<this._stride;t++)this._data[t]=this._output[e*this._stride+t];return this._denormalize(this._data)}}class ro{static create(e,t,i,n){switch(e){case"LINEAR":return new LE(i,n);case"CUBICSPLINE":return new _f(t,i,n);case"STEP":return new BE(i,n)}throw new Error(`PIXI3D: Unknown interpolation type "${e}"`)}}class Ru{constructor(e,t){this._position=0,this._frame=0,this._input=e,this._interpolation=t}get position(){return this._position}set position(e){this.setPosition(e)}get duration(){return this._input[this._input.length-1]}get frame(){return this._frame}get length(){return this._input.length}setPosition(e){this._position=e,this._frame=this.calculateFrame(this._position),this.updateTarget(this._interpolation.interpolate(this._frame,this.calculateFramePosition(this._frame,this._position)))}update(e){this.position+=e}calculateFramePosition(e,t){return e===this._input.length-1?1:(t-this._input[e])/(this._input[e+1]-this._input[e])}calculateFrame(e){if(e<this._input[0])return 0;for(let t=0;t<this._input.length-1;t++)if(e>=this._input[t]&&e<this._input[t+1])return t;return this._input.length-1}}class Qg extends Ru{constructor(e,t,i){super(t,i),this._transform=e}updateTarget(e){this._transform.rotationQuaternion.set(e[0],e[1],e[2],e[3])}}class zE extends Ru{constructor(e,t,i){super(t,i),this._transform=e}updateTarget(e){this._transform.scale.set(e[0],e[1],e[2])}}class jE{constructor(e){this._output=e,this._data=new Float32Array(4)}interpolate(e,t){let i=(e+0)*4,n=(e+1)*4,s=ui.set(this._output[i],this._output[i+1],this._output[i+2],this._output[i+3],new Float32Array(4));if(this._output.length<=n)return ui.normalize(s,this._data);let a=ui.set(this._output[n],this._output[n+1],this._output[n+2],this._output[n+3],new Float32Array(4));return ui.normalize(ui.slerp(s,a,t,this._data),this._data)}}class NE extends Ru{constructor(e,t,i){super(t,i),this._transform=e}updateTarget(e){this._transform.position.set(e[0],e[1],e[2])}}class GE extends Ru{constructor(e,t,i){super(t,i),this._weights=e}updateTarget(e){for(let t=0;t<e.length;t++)this._weights[t]=e[t]}}class WE{static create(e,t,i,n,s){if(n==="translation")return new NE(s.transform,e,ro.create(i,e,t,3));if(n==="scale")return new zE(s.transform,e,ro.create(i,e,t,3));if(n==="rotation")return i==="LINEAR"?new Qg(s.transform,e,new jE(t)):new Qg(s.transform,e,ro.create(i,e,t,4));if(n==="weights"){let a=s.children[0].targetWeights;return a?new GE(a,e,ro.create(i,e,t,a.length)):void 0}throw new Error(`PIXI3D: Unknown channel path "${n}"`)}}class tu{constructor(e,t){var i;if(this._asset=e,this._materialFactory=t||new Ab,this._descriptor=this._asset.descriptor,e.textures.length===0)for(let n=0;n<((i=this._descriptor.textures)==null?void 0:i.length);n++)e.textures.push(this.parseTexture(n))}static createModel(e,t){return new tu(e,t).parseModel()}static createMesh(e,t,i=0){return new tu(e,t).parseMesh(i)}parseBuffer(e){if(e===void 0)return;typeof e=="number"&&(e=this._asset.descriptor.accessors[e]);let t=this._descriptor.bufferViews[e.bufferView||0],i=e.byteOffset||0;t.byteOffset!==void 0&&(i+=t.byteOffset);let n=e.count*td[e.type];t.byteStride!==void 0&&t.byteStride!==0&&(n=t.byteStride/HE[e.componentType]*(e.count-1)+td[e.type]);let s=this._asset.buffers[t.buffer];const a=e.normalized===!0;return cr.from(e.componentType,td[e.type],s,i,n,t.byteStride,a,e.min,e.max)}parseAnimation(e,t){typeof e=="number"&&(e=this._asset.descriptor.animations[e]);let i=[];for(let n of e.channels){let s=e.samplers[n.sampler],a=this.parseBuffer(s.input);if(a===void 0)continue;let l=this.parseBuffer(s.output);if(l===void 0)continue;let o=WE.create(a.buffer,l.buffer,s.interpolation||"LINEAR",n.target.path,t[n.target.node]);o&&i.push(o)}return new FE(i,e.name)}parseMaterial(e){typeof e=="number"&&(e=this._asset.descriptor.materials[e]);let t=new Cb;if(!e)return this._materialFactory.create(t);e.occlusionTexture!==void 0&&(t.occlusionTexture=this._asset.textures[e.occlusionTexture.index].clone(),t.occlusionTexture.strength=e.occlusionTexture.strength,t.occlusionTexture.texCoord=e.occlusionTexture.texCoord,e.occlusionTexture.extensions&&e.occlusionTexture.extensions.KHR_texture_transform&&(t.occlusionTexture.transform=e.occlusionTexture.extensions.KHR_texture_transform,e.occlusionTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(t.occlusionTexture.texCoord=e.occlusionTexture.extensions.KHR_texture_transform.texCoord))),e.normalTexture!==void 0&&(t.normalTexture=this._asset.textures[e.normalTexture.index].clone(),t.normalTexture.scale=e.normalTexture.scale||1,t.normalTexture.texCoord=e.normalTexture.texCoord,e.normalTexture.extensions&&e.normalTexture.extensions.KHR_texture_transform&&(t.normalTexture.transform=e.normalTexture.extensions.KHR_texture_transform,e.normalTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(t.normalTexture.texCoord=e.normalTexture.extensions.KHR_texture_transform.texCoord))),e.emissiveTexture!==void 0&&(t.emissiveTexture=this._asset.textures[e.emissiveTexture.index].clone(),t.emissiveTexture.texCoord=e.emissiveTexture.texCoord,e.emissiveTexture.extensions&&e.emissiveTexture.extensions.KHR_texture_transform&&(t.emissiveTexture.transform=e.emissiveTexture.extensions.KHR_texture_transform,e.emissiveTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(t.emissiveTexture.texCoord=e.emissiveTexture.extensions.KHR_texture_transform.texCoord))),e.doubleSided!==void 0&&(t.doubleSided=e.doubleSided),e.emissiveFactor&&(t.emissiveFactor=e.emissiveFactor),e.alphaMode&&(t.alphaMode=e.alphaMode),e.alphaCutoff!==void 0&&(t.alphaCutoff=e.alphaCutoff);let i=e.pbrMetallicRoughness;return(i==null?void 0:i.metallicRoughnessTexture)!==void 0&&(t.metallicRoughnessTexture=this._asset.textures[i.metallicRoughnessTexture.index].clone(),t.metallicRoughnessTexture.texCoord=i.metallicRoughnessTexture.texCoord,i.metallicRoughnessTexture.extensions&&i.metallicRoughnessTexture.extensions.KHR_texture_transform&&(t.metallicRoughnessTexture.transform=i.metallicRoughnessTexture.extensions.KHR_texture_transform,i.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(t.metallicRoughnessTexture.texCoord=i.metallicRoughnessTexture.extensions.KHR_texture_transform.texCoord))),i!=null&&i.baseColorFactor&&(t.baseColor=i.baseColorFactor),(i==null?void 0:i.baseColorTexture)!==void 0&&(t.baseColorTexture=this._asset.textures[i.baseColorTexture.index].clone(),t.baseColorTexture.texCoord=i.baseColorTexture.texCoord,i.baseColorTexture.extensions&&i.baseColorTexture.extensions.KHR_texture_transform&&(t.baseColorTexture.transform=i.baseColorTexture.extensions.KHR_texture_transform,i.baseColorTexture.extensions.KHR_texture_transform.texCoord!==void 0&&(t.baseColorTexture.texCoord=i.baseColorTexture.extensions.KHR_texture_transform.texCoord))),(i==null?void 0:i.metallicFactor)!==void 0&&(t.metallic=i.metallicFactor),(i==null?void 0:i.roughnessFactor)!==void 0&&(t.roughness=i.roughnessFactor),e.extensions&&(t.unlit=e.extensions.KHR_materials_unlit!==void 0),this._materialFactory.create(t)}parseTexture(e){const t=this._descriptor.textures[e],i=this._asset.images[t.source],n=new ye(new Be(i.baseTexture.resource,{wrapMode:gi.REPEAT,alphaMode:hi.NO_PREMULTIPLIED_ALPHA}));if(this._descriptor.samplers&&t.sampler!==void 0)switch(this._descriptor.samplers[t.sampler].wrapS){case 10497:n.baseTexture.wrapMode=gi.REPEAT;break;case 33648:n.baseTexture.wrapMode=gi.MIRRORED_REPEAT;break;case 33071:n.baseTexture.wrapMode=gi.CLAMP;break}return n}parseMesh(e){typeof e=="number"&&(e=this._asset.descriptor.meshes[e]);let t=e.weights||[];return e.primitives.map(i=>Object.assign(this.parsePrimitive(i),{name:e.name,targetWeights:t}))}parseSkin(e,t,i){return typeof e=="number"&&(e=this._asset.descriptor.skins[e]),new RE(t,e.joints.map(n=>i[n]))}parsePrimitive(e){let{attributes:t,targets:i}=e,n=Object.assign(new Bn,{indices:this.parseBuffer(e.indices),positions:this.parseBuffer(t.POSITION),normals:this.parseBuffer(t.NORMAL),tangents:this.parseBuffer(t.TANGENT),joints:this.parseBuffer(t.JOINTS_0),weights:this.parseBuffer(t.WEIGHTS_0),colors:this.parseBuffer(t.COLOR_0)});for(let a=0;;a++){let l=this.parseBuffer(t[`TEXCOORD_${a}`]);if(l===void 0)break;n.uvs=n.uvs||[],n.uvs.push(l)}if(i)for(let a=0;a<i.length;a++)n.targets=n.targets||[],n.targets.push({positions:this.parseBuffer(i[a].POSITION),normals:this.parseBuffer(i[a].NORMAL),tangents:this.parseBuffer(i[a].TANGENT)});let s;return e.material!==void 0?s=this.parseMaterial(this._asset.descriptor.materials[e.material]):s=this.parseMaterial(),new bt(n,s)}parseNode(e){const t=this._asset.descriptor.nodes[e];let i;for(let s of this._asset.descriptor.skins||[]){const a=s.joints.indexOf(e);if(a>=0){const l=this.parseBuffer(s.inverseBindMatrices),o=l==null?void 0:l.buffer.slice(a*16,a*16+16);i=Object.assign(new OE(o),{name:t.name})}}let n=i||Object.assign(new xn,{name:t.name});return t.translation&&n.position.set(t.translation[0],t.translation[1],t.translation[2]),t.rotation&&n.rotationQuaternion.set(t.rotation[0],t.rotation[1],t.rotation[2],t.rotation[3]),t.scale&&n.scale.set(t.scale[0],t.scale[1],t.scale[2]),t.matrix&&n.transform.setFromMatrix(new ft(t.matrix)),n}parseModel(){let e=this._descriptor.nodes.map((s,a)=>this.parseNode(a)),t=this._descriptor.scenes[this._asset.descriptor.scene||0],i=new iu,n=(s,a)=>{let l=this._asset.descriptor.nodes[a].mesh,o;if(this._asset.descriptor.nodes[a].skin!==void 0&&(o=this.parseSkin(this._asset.descriptor.nodes[a].skin,e[a],e)),l!==void 0)for(let u of this.parseMesh(l))i.meshes.push(e[a].addChild(u)),i.meshes[i.meshes.length-1].skin=o;if(s.addChild(e[a]),!!this._asset.descriptor.nodes[a].children)for(let u of this._asset.descriptor.nodes[a].children)n(e[a],u)};for(let s of t.nodes)n(i,s);if(this._asset.descriptor.animations)for(let s of this._asset.descriptor.animations)i.animations.push(this.parseAnimation(s,e));return i}}const td={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HE={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};function Mb(r,e,t){for(let i of r.children)if(i instanceof bt){const n=i.createInstance();n.name=i.name,t.push(e.addChild(n))}else if(i instanceof xn){const n=e.addChild(new xn);n.name=r.name,n.position=i.position,n.scale=i.scale,n.rotationQuaternion=i.rotationQuaternion,Mb(i,n,t)}}class UE extends xn{constructor(e){super(),this.meshes=[],Mb(e,this,this.meshes)}}class iu extends xn{constructor(){super(...arguments),this.animations=[],this.meshes=[]}static from(e,t){return tu.createModel(e,t)}createInstance(){return new UE(this)}getBoundingBox(){this.updateTransform();let e=new Fu,t=this.meshes[0].getBoundingBox();t&&(e.min=t.min,e.max=t.max);for(let i=1;i<this.meshes.length;i++){let n=this.meshes[i].getBoundingBox();n&&(e.encapsulate(n.min),e.encapsulate(n.max))}return e}}class VE extends xn{constructor(){super(...arguments),this.type=br.point,this.color=new ri(1,1,1),this.range=10,this.intensity=10,this.innerConeAngle=0,this.outerConeAngle=45}}class $E{constructor(e,t){this.renderer=e,this.name=t,this.clearColor=new ri(0,0,0,0)}get renderTexture(){return this._renderTexture}set renderTexture(e){this._renderTexture=e}clear(){if(this._renderTexture&&this.clearColor){const e=this.renderer.renderTexture.current;this.renderer.renderTexture.bind(this._renderTexture),this.renderer.renderTexture.clear(Array.from(this.clearColor.rgba)),this.renderer.renderTexture.bind(e||void 0)}}render(e){const t=this.renderer.renderTexture.current;this._renderTexture&&this.renderer.renderTexture.bind(this._renderTexture);for(let i of e)i.material&&i.material.render(i,this.renderer);this._renderTexture&&this.renderer.renderTexture.bind(t||void 0)}}var XE={source:`#version VERSION

VERT_IN vec3 a_Position;
VERT_IN vec2 a_UV1;

VERT_OUT vec2 v_UV1;

void main() {
  v_UV1 = a_UV1;
  gl_Position = vec4(a_Position, 1.0);
}`},KE={source:`#version VERSION

#define FEATURES

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

#ifdef WEBGL2
  out vec4 FRAG_COLOR;
#endif

FRAG_IN vec2 v_UV1;

uniform vec2 u_BlurScale;
uniform sampler2D u_FilterSampler;

void main() {
  vec4 color = vec4(0.0);

  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-3.0) * u_BlurScale.xy)) * (1.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-2.0) * u_BlurScale.xy)) * (6.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(-1.0) * u_BlurScale.xy)) * (15.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+0.0) * u_BlurScale.xy)) * (20.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+1.0) * u_BlurScale.xy)) * (15.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+2.0) * u_BlurScale.xy)) * (6.0/64.0);
  color += texture2D(u_FilterSampler, v_UV1 + (vec2(+3.0) * u_BlurScale.xy)) * (1.0/64.0);

  FRAG_COLOR = color;
}`};class qE{constructor(e){this.renderer=e,this._mesh=bt.createQuad(),this._gaussianBlurShader=new Tl(si.from(Cr.build(XE.source,[],e),Cr.build(KE.source,[],e)))}applyGaussianBlur(e){this.applyBlurScale(e.shadowTexture,e.filterTexture,new Float32Array([0,e.softness/e.shadowTexture.height])),this.applyBlurScale(e.filterTexture,e.shadowTexture,new Float32Array([e.softness/e.shadowTexture.width,0]))}applyBlurScale(e,t,i){this.renderer.renderTexture.bind(t),this.renderer.renderTexture.clear(),this._gaussianBlurShader.uniforms.u_FilterSampler=e,this._gaussianBlurShader.uniforms.u_BlurScale=i,this._gaussianBlurShader.render(this._mesh,this.renderer),this.renderer.renderTexture.bind(void 0)}}var YE={source:`#version VERSION

#define FEATURES

vec4 _texture(sampler2D sampler, vec2 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return texture2D(sampler, coord);
#endif
}

vec4 _texture(samplerCube sampler, vec3 coord)
{
#ifdef WEBGL2
    return texture(sampler, coord);
#else
    return textureCube(sampler, coord);
#endif
}

VERT_IN vec3 a_Position;

#ifdef USE_SKINNING
  VERT_IN vec4 a_Joint1;
  VERT_IN vec4 a_Weight1;
#endif

uniform mat4 u_ViewProjectionMatrix;
uniform mat4 u_ModelMatrix;

#ifdef USE_SKINNING
  #ifdef USE_SKINNING_TEXTURE
    uniform sampler2D u_jointMatrixSampler;
  #else
    uniform mat4 u_jointMatrix[MAX_JOINT_COUNT];
  #endif
#endif

#ifdef USE_INSTANCING
  VERT_IN vec4 a_ModelMatrix0;
  VERT_IN vec4 a_ModelMatrix1;
  VERT_IN vec4 a_ModelMatrix2;
  VERT_IN vec4 a_ModelMatrix3;
#endif

// these offsets assume the texture is 4 pixels across
#define ROW0_U ((0.5 + 0.0) / 4.0)
#define ROW1_U ((0.5 + 1.0) / 4.0)
#define ROW2_U ((0.5 + 2.0) / 4.0)
#define ROW3_U ((0.5 + 3.0) / 4.0)

#ifdef USE_SKINNING
mat4 getJointMatrix(float boneNdx) {
  #ifdef USE_SKINNING_TEXTURE
    float v = (boneNdx + 0.5) / float(MAX_JOINT_COUNT);
    return mat4(
      _texture(u_jointMatrixSampler, vec2(ROW0_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW1_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW2_U, v)), 
      _texture(u_jointMatrixSampler, vec2(ROW3_U, v))
    );
  #else
    return u_jointMatrix[int(boneNdx)];
  #endif
}

mat4 getSkinningMatrix() {
  mat4 skin = mat4(0);
  skin += 
    a_Weight1.x * getJointMatrix(a_Joint1.x) +
    a_Weight1.y * getJointMatrix(a_Joint1.y) +
    a_Weight1.z * getJointMatrix(a_Joint1.z) +
    a_Weight1.w * getJointMatrix(a_Joint1.w);
  return skin;
}
#endif

void main() {
  mat4 modelMatrix = u_ModelMatrix;
  #ifdef USE_INSTANCING
    modelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
  #endif
  vec4 pos = vec4(a_Position, 1.0);
  #ifdef USE_SKINNING
    pos = getSkinningMatrix() * pos;
  #endif
  gl_Position = u_ViewProjectionMatrix * modelMatrix * pos;
}`},ZE={source:`#version VERSION

#define FEATURES

#if defined(WEBGL1)
  #extension GL_OES_standard_derivatives : enable
#endif

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

#ifdef WEBGL2
  out vec4 FRAG_COLOR;
#endif

void main() {
  float depth = gl_FragCoord.z;
  float dx = 0.0;
  float dy = 0.0;

  #if defined(WEBGL2) || defined(GL_OES_standard_derivatives)
    dx = dFdx(depth);
    dy = dFdy(depth);
  #endif

  float moment2 = depth * depth + 0.25 * (dx * dx + dy * dy);
  FRAG_COLOR = vec4(1.0 - depth, 1.0 - moment2, 0.0, 0.0);
}`};class JE{constructor(){this._maxInstances=20,this._modelMatrix=[new Fe,new Fe,new Fe,new Fe],this.expandBuffers(this._maxInstances)}expandBuffers(e){for(;e>this._maxInstances;)this._maxInstances+=Math.floor(this._maxInstances*.5);for(let t=0;t<4;t++)this._modelMatrix[t].update(new Float32Array(4*this._maxInstances))}updateBuffers(e){e.length>this._maxInstances&&this.expandBuffers(e.length);for(let t=0;t<e.length;t++){const i=e[t].worldTransform.array;for(let n=0;n<4;n++)this._modelMatrix[n].data.set(i.slice(n*4,n*4+4),t*4)}for(let t=0;t<4;t++)this._modelMatrix[t].update()}addGeometryAttributes(e){for(let t=0;t<4;t++)e.addAttribute(`a_ModelMatrix${t}`,this._modelMatrix[t],4,!1,void 0,0,void 0,!0)}}var Qd;(r=>{function e(t,i=[]){return t.context.webGLVersion===1&&i.push("WEBGL1 1"),t.context.webGLVersion===2&&i.push("WEBGL2 1"),i}r.build=e})(Qd||(Qd={}));class nu extends Tl{constructor(e,t=[]){t=Qd.build(e,t),super(si.from(Cr.build(YE.source,t,e),Cr.build(ZE.source,t,e))),this._instancing=new JE}get maxSupportedJoints(){return 0}createShaderGeometry(e,t){let i=new wn;return e.indices&&(e.indices.buffer.BYTES_PER_ELEMENT===1?i.addIndex(new Fe(new Uint16Array(e.indices.buffer))):i.addIndex(new Fe(e.indices.buffer))),e.positions&&i.addAttribute("a_Position",new Fe(e.positions.buffer),3,!1,e.positions.componentType,e.positions.stride),t&&this._instancing.addGeometryAttributes(i),i}get name(){return"shadow-shader"}render(e,t,i){if(e.instances.length>0){const n=e.instances.filter(s=>s.worldVisible&&s.renderable);if(n.length===0)return;this._instancing.updateBuffers(n)}super.render(e,t,i)}updateUniforms(e,t){this.uniforms.u_ModelMatrix=e.worldTransform.array,this.uniforms.u_ViewProjectionMatrix=t.lightViewProjection}}class kf extends nu{constructor(e){const t=kf.getMaxJointCount(e)-1;super(e,["USE_SKINNING 1","MAX_JOINT_COUNT "+t]),this._maxSupportedJoints=t}get maxSupportedJoints(){return this._maxSupportedJoints}static getMaxJointCount(e){let t=8,i=Rn.getMaxVertexUniformVectors(e)-t;return Math.floor(i/4)}createShaderGeometry(e,t){let i=super.createShaderGeometry(e,t);return e.joints&&i.addAttribute("a_Joint1",new Fe(e.joints.buffer),4,!1,e.joints.componentType,e.joints.stride),e.weights&&i.addAttribute("a_Weight1",new Fe(e.weights.buffer),4,!1,e.weights.componentType,e.weights.stride),i}get name(){return"skinned-shadow-shader"}updateUniforms(e,t){super.updateUniforms(e,t),e.skin&&(this.uniforms.u_jointMatrix=e.skin.jointMatrices)}}const id=256;class em extends nu{constructor(e){super(e,["USE_SKINNING 1","USE_SKINNING_TEXTURE 1","MAX_JOINT_COUNT "+id]),this._jointMatrixTexture=new ia(id)}static isSupported(e){return ia.isSupported(e)}get maxSupportedJoints(){return id}createShaderGeometry(e,t){let i=super.createShaderGeometry(e,t);return e.joints&&i.addAttribute("a_Joint1",new Fe(e.joints.buffer),4,!1,e.joints.componentType,e.joints.stride),e.weights&&i.addAttribute("a_Weight1",new Fe(e.weights.buffer),4,!1,e.weights.componentType,e.weights.stride),i}get name(){return"skinned-shadow-shader"}updateUniforms(e,t){super.updateUniforms(e,t),e.skin&&(this._jointMatrixTexture.updateBuffer(e.skin.jointMatrices),this.uniforms.u_jointMatrixSampler=this._jointMatrixTexture)}}class QE{constructor(e){this.renderer=e,this._state=Object.assign(new Vi,{depthTest:!0,clockwiseFrontFace:!1,culling:!0,blendMode:Le.NONE}),this._shadowShader=new nu(this.renderer),this._instancedShadowShader=new nu(this.renderer,["USE_INSTANCING 1"])}getSkinningShader(){return this._textureShader||this._skinningShader?this._textureShader||this._skinningShader:(em.isSupported(this.renderer)?this._textureShader=new em(this.renderer):(yr.warn(Qr.meshVertexSkinningFloatingPointTexturesNotSupported),this._skinningShader=new kf(this.renderer)),this._textureShader||this._skinningShader)}render(e,t){let n=e.instances.length>0?this._instancedShadowShader:this._shadowShader;if(e.skin){let s=this.getSkinningShader();s&&e.skin.joints.length>s.maxSupportedJoints?yr.error(Qr.meshVertexSkinningNumberOfJointsNotSupported,{joints:e.skin.joints.length,maxJoints:s.maxSupportedJoints}):n=s}n&&(n.updateUniforms(e,t),n.render(e,this.renderer,this._state))}}class eP{constructor(e,t="shadow"){this.renderer=e,this.name=t,this._lights=[],this._filter=new qE(e),this._shadow=new QE(e)}addShadowCastingLight(e){this._lights.indexOf(e)<0&&this._lights.push(e)}removeShadowCastingLight(e){const t=this._lights.indexOf(e);t>=0&&this._lights.splice(t,1)}clear(){for(let e of this._lights)e.clear()}render(e){if(e.length===0||this._lights.length===0)return;const t=this.renderer.renderTexture.current;for(let i of this._lights){this.renderer.renderTexture.bind(i.shadowTexture),i.updateLightViewProjection();for(let n of e)this._shadow.render(n,i);i.softness>0&&this._filter.applyGaussianBlur(i)}this.renderer.renderTexture.bind(t||void 0)}}class tP extends xu{constructor(){super(),this.addAttribute("aMatrix0",this._buffer,4,!1,ke.FLOAT),this.addAttribute("aMatrix1",this._buffer,4,!1,ke.FLOAT),this.addAttribute("aMatrix2",this._buffer,4,!1,ke.FLOAT),this.addAttribute("aMatrix3",this._buffer,4,!1,ke.FLOAT)}}var iP={source:`precision highp float;

attribute vec2 aVertexPosition;

attribute vec4 aMatrix0;
attribute vec4 aMatrix1;
attribute vec4 aMatrix2;
attribute vec4 aMatrix3;

attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void) {
  mat4 modelMatrix = mat4(aMatrix0, aMatrix1, aMatrix2, aMatrix3);

  gl_Position = modelMatrix * vec4(aVertexPosition.xy, 0.0, 1.0);

  vTextureCoord = vec2(aTextureCoord.x, aTextureCoord.y);
  vTextureId = aTextureId;
  vColor = aColor * tint;
}`},nP={source:`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = vColor * vec4(color.rgb, color.a);
}`};const rP=Ft.get(Mt,"BatchRenderer")||Ft.get(Mt,"AbstractBatchRenderer");class Eb extends rP{constructor(e){super(e),this.shaderGenerator=new Ic(iP.source,nP.source),this.geometryClass=tP,this.vertexSize=6+16,Object.assign(this.state,{culling:!1,clockwiseFrontFace:!1,depthTest:!0})}packInterleavedGeometry(e,t,i,n,s){const{uint32View:a,float32View:l}=t,o=n/this.vertexSize,u=e.uvs,h=e.indices,d=e.vertexData,p=e._texture.baseTexture._batchLocation,v=Math.min(e.worldAlpha,1),w=v<1&&e._texture.baseTexture.alphaMode?oy(e._tintRGB,v):e._tintRGB+(v*255<<24);for(let _=0;_<d.length;_+=2){l[n++]=d[_],l[n++]=d[_+1],l[n++]=u[_],l[n++]=u[_+1],a[n++]=w,l[n++]=p;let T=e.modelViewProjection.array;for(let D=0;D<16;D++)l[n++]=T[D]}for(let _=0;_<h.length;_++)i[s++]=o+h[_]}}xt.installRendererPlugin("sprite3d",Eb);class sP extends ra{constructor(e){super(e),this.renderer=e,this._meshes=[],this._sprites=[],this.materialPass=new $E(this.renderer,"material"),this.shadowPass=new eP(this.renderer,"shadow"),this.renderPasses=[this.shadowPass,this.materialPass],e.on("prerender",()=>{for(let t of this.renderPasses)t.clear&&t.clear()}),this._spriteRenderer=new Eb(e)}render(e){e.isSprite?this._sprites.push(e):this._meshes.push(e)}flush(){this.sort();for(let e of this.renderPasses)e.render(this._meshes.filter(t=>t.isRenderPassEnabled(e.name)));if(this._meshes=[],this._sprites.length>0){this._spriteRenderer.start();for(let e of this._sprites)this._spriteRenderer.render(e);this._spriteRenderer.stop(),this._sprites=[]}}sort(){this._meshes.sort((e,t)=>!e.material||!t.material?0:e.material.renderSortType!==t.material.renderSortType?e.material.renderSortType===dl.transparent?1:-1:e.renderSortOrder===t.renderSortOrder?0:e.renderSortOrder<t.renderSortOrder?-1:1),this._sprites.sort((e,t)=>e.zIndex!==t.zIndex?e.zIndex-t.zIndex:t.distanceFromCamera-e.distanceFromCamera)}enableShadows(e,t){let i=e instanceof iu?e.meshes:[e];for(let n of i)t&&n.material instanceof Gt&&(n.material.shadowCastingLight=t),n.enableRenderPass(this.shadowPass.name);t&&this.shadowPass.addShadowCastingLight(t)}disableShadows(e){let t=e instanceof iu?e.meshes:[e];for(let i of t)i.material instanceof Gt&&(i.material.shadowCastingLight=void 0),i.disableRenderPass(this.shadowPass.name)}}xt.installRendererPlugin("pipeline",sP);const aP=Ft.get(Mt,"ArrayResource")||Ft.get(Mt,"resources").ArrayResource,lP=Ft.get(Mt,"BaseImageResource")||Ft.get(Mt,"resources").BaseImageResource;class tm extends aP{constructor(e,t){super(e),this.target=t}upload(e,t){e.gl.pixelStorei(e.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===hi.UNPACK);for(let i=0;i<this.items.length;i++){const n=this.items[i].resource;n instanceof bf&&e.gl.texImage2D(this.target,i,t.format,n.width,n.height,0,t.format,t.type,n.data),n instanceof lP&&e.gl.texImage2D(this.target,i,t.format,t.format,t.type,n.source)}return!0}}const oP=Ft.get(Mt,"CubeResource")||Ft.get(Mt,"resources").CubeResource;class im extends oP{constructor(e,t=1){super(e),this.levels=t}style(e){let t=e.gl;return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.levels>1?t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR):t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),!0}}class On extends Be{constructor(){super(...arguments),this.cubemapFormat=Du.ldr}static get faces(){return["posx","negx","posy","negy","posz","negz"]}get levels(){return this.resource.levels}static fromFaces(e){const t=Array.isArray(e)?e:[e],i=On.faces.map((n,s)=>new tm(t.map(a=>a[n]),er.TEXTURE_CUBE_MAP_POSITIVE_X+s));return new On(new im(i,t.length))}static fromColors(e,t=e,i=e,n=e,s=e,a=e){const l=[],o=[e,t,i,n,s,a];for(let u=0;u<o.length;u++){let h=new bf(new Uint8Array(o[u].rgba.map(p=>p*255)),{width:1,height:1}),d=new ye(new Be(h,{type:ke.UNSIGNED_BYTE,format:fe.RGB,alphaMode:hi.NO_PREMULTIPLIED_ALPHA}));l.push(new tm([d],er.TEXTURE_CUBE_MAP_POSITIVE_X+u))}return new On(new im(l,1))}}class uP{constructor(e){this.json=e}get format(){return Du.ldr}get mipmaps(){return this.json}}class hP{constructor(e){this.json=e}get format(){return this.json.format}get mipmaps(){return this.json.mipmaps}}var ru;(r=>{function e(t){return t.version===2?new hP(t):new uP(t)}r.getFileVersion=e})(ru||(ru={}));const dP={use:function(r,e){if(r.extension!=="cubemap")return e();const t=this,i=ru.getFileVersion(r.data),n=i.mipmaps.map(o=>On.faces.map(u=>r.url.substring(0,r.url.lastIndexOf("/")+1)+o.replace("{{face}}",u)));let s=n.reduce((o,u)=>o.concat(u),[]);t.add(s.filter(o=>!t.resources[o]).map(o=>({parentResource:r,url:o})));let a=0,l=t.onLoad.add((o,u)=>{if(s.includes(u.url)&&++a===s.length){const h=n.map(p=>({posx:ye.from(p[0]),negx:ye.from(p[1]),posy:ye.from(p[2]),negy:ye.from(p[3]),posz:ye.from(p[4]),negz:ye.from(p[5])}));let d=On.fromFaces(h);d.cubemapFormat=i.format,r.cubemap=d,l.detach(),e()}})},add:function(){xt.setLoaderResourceExtensionType("cubemap",Tr.json)},test(r){return r.includes(".cubemap")},async load(r){if(!xt.assets)throw new Error("PIXI3D: This feature is only available when using PixiJS v7+");const t=await(await ge.ADAPTER.fetch(r)).json(),i=ru.getFileVersion(t),n=i.mipmaps.map(l=>On.faces.map(o=>r.substring(0,r.lastIndexOf("/")+1)+l.replace("{{face}}",o))),s=[];for(let l of n){let o={posx:await xt.assets.load(l[0]),negx:await xt.assets.load(l[1]),posy:await xt.assets.load(l[2]),negy:await xt.assets.load(l[3]),posz:await xt.assets.load(l[4]),negz:await xt.assets.load(l[5])};s.push(o)}let a=On.fromFaces(s);return a.cubemapFormat=i.format,a}};xt.installLoaderPlugin("cubemap",dP);const cP=["glsl","vert","frag"],fP={use:(r,e)=>{e()},add:function(){for(let r of cP)xt.setLoaderResourceExtensionType(r,Tr.text)},test(r){return r.includes(".glsl")||r.includes(".vert")||r.includes(".frag")},async load(r){return await(await ge.ADAPTER.fetch(r)).text()}};xt.installLoaderPlugin("shader",fP);var pP={source:`#version 100

attribute vec3 a_Position;

uniform mat4 u_ModelViewProjection;

void main() {
  gl_Position = u_ModelViewProjection * vec4(a_Position, 1.0);
}`},gP={source:`#version 100

#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif

uniform vec3 u_Id;

void main() {
  gl_FragColor = vec4(u_Id / 255.0, 1.0);
}`};class mP{constructor(e,t){this._renderer=e,this._update=0,this._matrix=new Float32Array(16),this._pixels=new Uint8Array(t*t*4),this._output=bi.create({width:t,height:t,resolution:1}),this._shader=new Tl(si.from(pP.source,gP.source)),this._output.framebuffer.addDepthTexture()}destroy(){this._output.destroy(!0),this._shader.destroy()}resizeToAspect(){const e=this._renderer.width/this._renderer.height,t=Math.floor(this._output.height*e);this._output.width!==t&&(this._pixels=new Uint8Array(t*this._output.height*4),this._output.resize(t,this._output.height))}containsId(e,t,i){const{width:n,height:s}=this._renderer.screen;e=Math.floor(e/n*this._output.width),t=Math.floor((s-t)/s*this._output.height);for(let a=0;a<3;a++)if(i[a]!==this._pixels[(t*this._output.width+e)*4+a])return!1;return!0}update(e){if(this._renderer.renderTexture.bind(this._output),this._update++%2===0){this._renderer.renderTexture.clear();for(let t of e)this.renderHitArea(t)}else{const t=this._renderer.gl;t.readPixels(0,0,this._output.width,this._output.height,t.RGBA,t.UNSIGNED_BYTE,this._pixels)}this._renderer.renderTexture.bind(void 0)}renderHitArea(e){const t=this._shader.uniforms,i=e.object instanceof bt?[e.object]:e.object.meshes,n=e.camera||tn.main;for(let s of i)t.u_Id=e.id,t.u_ModelViewProjection=je.multiply(n.viewProjection.array,s.transform.worldTransform.array,this._matrix),this._shader.render(s,this._renderer)}}class Ls{constructor(e){this.renderer=e,this._hitAreas=[],this._map=new mP(this.renderer,128),Lt.shared.add(this._update,this,sr.LOW),Ls.main||(Ls.main=this)}_update(){if(!this.renderer.plugins)return;let e=xt.getInteractionPlugin(this.renderer);e&&e.hitTest(new xe(0,0)),this._hitAreas.length>0&&(this._map.resizeToAspect(),this._map.update(this._hitAreas),this._hitAreas=[])}destroy(){this===Ls.main&&(Ls.main=void 0),Lt.shared.remove(this._update,this)}containsHitArea(e,t,i){return this._hitAreas.indexOf(i)<0&&this._hitAreas.push(i),this._map.containsId(e,t,i.id)}}xt.installRendererPlugin("picking",Ls);var nm;(r=>{let e=0;function t(){return e++,new Uint8Array([e>>16&255,e>>8&255,e&255])}r.next=t})(nm||(nm={}));var ec=(r=>(r.low="low",r.medium="medium",r.high="high",r))(ec||{}),rm;(r=>{function e(n,s,a){let l=i(n,a);return bi.create({width:s,height:s,type:l,scaleMode:t(n)})}r.create=e;function t(n){return Rn.supportsFloatLinear(n)?Xt.LINEAR:Xt.NEAREST}function i(n,s){if(s===ec.high){if(Rn.isFloatFramebufferSupported(n))return ke.FLOAT;if(Rn.isHalfFloatFramebufferSupported(n))return ke.HALF_FLOAT}return s===ec.medium&&Rn.isHalfFloatFramebufferSupported(n)?ke.HALF_FLOAT:ke.UNSIGNED_BYTE}})(rm||(rm={}));var sm;(r=>{const e=new Float32Array(16),t=new Float32Array(16),i=new Float32Array(4),n=new Float32Array(3),s=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3);function o(h){if(h.light.type!==br.directional)return;let d=h.shadowArea/2,p=d*2/h.shadowArea,v=je.ortho(-d,d,-d,d,-d,d,e),w=h.light,_=h.camera||tn.main;_&&h.followCamera?(Ue.scale(_.worldTransform.forward.array,d,l),Ue.add(_.worldTransform.position.array,l,a),Ue.transformQuat(a,ui.conjugate(h.light.worldTransform.rotation.array,i),n),n[0]=p*Math.floor(n[0]/p),n[1]=p*Math.floor(n[1]/p),Ue.transformQuat(n,w.worldTransform.rotation.array,n),Ue.add(n,w.worldTransform.forward.array,s),je.lookAt(n,s,w.worldTransform.up.array,t),je.multiply(v,t,h.lightViewProjection)):(Ue.add(w.worldTransform.position.array,h.light.worldTransform.forward.array,a),je.lookAt(w.worldTransform.position.array,a,w.worldTransform.up.array,t),je.multiply(v,t,h.lightViewProjection))}r.calculateDirectionalLightViewProjection=o;function u(h){if(h.light.type!==br.spot)return;let d=h.light;je.perspective(d.outerConeAngle*us*2,1,2,d.range,e),Ue.add(d.worldTransform.position.array,d.worldTransform.forward.array,a),je.lookAt(d.worldTransform.position.array,a,d.worldTransform.up.array,t),je.multiply(e,t,h.lightViewProjection)}r.calculateSpotLightViewProjection=u})(sm||(sm={}));class fi{static createCube3d(e=new Gt){return new bt(this.createCube3dMesh(),e)}static createCube3dMesh(){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,1,1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,13,14,12,15,13,16,17,18,16,19,17,20,21,22,20,23,21])},normals:{buffer:new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([.66666,0,.33333,1,.66666,1,.33333,0,.66666,0,.33333,1,.66666,1,.33333,0,.66666,0,.33333,1,.66666,1,.33333,0,.66666,0,.33333,1,.66666,1,.33333,0,0,0,.33333,.25,.33333,0,0,.25,.66666,0,1,1,1,0,.66666,1])}],tangents:{buffer:new Float32Array([0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1])}})}static createHalfheightCube3d(e=new Gt){return new bt(this.createHalfheightCube3dMesh(),e)}static createHalfheightCube3dMesh(){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,1,1,-1,0,-1,-1,0,1,-1,1,-1,-1,1,-1,1,0,-1,-1,0,-1,1,1,-1,1,1,-1,1,0,1,1,0,-1,1,1,1,1,1,1,-1,0,1,1,0,1,-1,1,1,1,0,1,-1,0,-1,1,0,-1,-1,0,1,-1,1,1,1,1,-1,-1,1,-1,1,1,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1,4,5,6,4,7,5,8,9,10,8,11,9,12,13,14,12,15,13,16,17,18,16,19,17,20,21,22,20,23,21])},normals:{buffer:new Float32Array([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([.66666,0,.33333,.5,.66666,.5,.33333,0,.66666,0,.33333,.5,.66666,.5,.33333,0,.66666,0,.33333,.5,.66666,.5,.33333,0,.66666,0,.33333,.5,.66666,.5,.33333,0,0,0,.33333,.25,.33333,0,0,.25,.66666,0,1,1,1,0,.66666,1])}],tangents:{buffer:new Float32Array([0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1,-1,0,0,1])}})}static createPlane3d(e=1,t=1,i=new Gt){return new bt(this.createPlane3dMesh(e,t),i)}static createPlane3dMesh(e=1,t=1){return Object.assign(new Bn,{positions:{buffer:new Float32Array([-1,0,1,1,0,-1,-1,0,-1,1,0,1])},indices:{buffer:new Uint8Array([0,1,2,0,3,1])},normals:{buffer:new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0])},uvs:[{buffer:new Float32Array([0,t,e,0,0,0,e,t])}]})}}function Ca(r,e=!1,t=null){let n=yi.get("spritesheet").textures[r];if(e){let s=new Wt(n),a=bi.create({width:s.width,height:s.height,scaleMode:Xt.NEAREST,wrapMode:gi.REPEAT});return t.render(s,{renderTexture:a}),new as(a.baseTexture)}else{let s=new as(n.baseTexture);return s.transform=new Jn,s.transform.offset.set((n.frame.x+0)/n.baseTexture.width,(n.frame.y+0)/n.baseTexture.height),s.transform.scale.set(n.frame.width/n.baseTexture.width,n.frame.height/n.baseTexture.height),s}}class yP extends bt{constructor(e,t,i){super(e,t),this.farbe=i}}class bP extends bt{constructor(e,t,i){super(e,t),this.farbe=i}}class vP{constructor(e,t){y(this,"farben",["rot","gelb","grün","blau"]);y(this,"farbeToColorInfoMap",{rot:[1,0,0],gelb:[1,1,0],grün:[0,1,0],blau:[0,0,1]});y(this,"farbeToMarkerMaterialMap",{});y(this,"farbeToBrickMaterialMap",{});y(this,"grassBrickMaterial");y(this,"groundPlaneMaterial");y(this,"planeMaterial",{});y(this,"cloudMaterial");y(this,"light1");y(this,"light2");y(this,"lightingEnvironment");this.worldHelper=e,this.camera=t;let i=e.app.renderer,n=new xf(On.fromColors(new ri(1,1,1)),On.fromColors(new ri(1,1,1)));this.light2=Object.assign(new VE,{type:br.directional,range:600,intensity:4,color:new ri(1,1,1)}),this.light2.position.set(12,16,-12),this.light2.rotationQuaternion.setEulerAngles(25,45,0),this.lightingEnvironment=new vr(e.app.renderer,n),this.lightingEnvironment.lights.push(this.light2),this.grassBrickMaterial=new Gt,this.initMaterial(this.grassBrickMaterial),this.grassBrickMaterial.baseColorTexture=Ca("robot#0"),this.cloudMaterial=new Gt,this.initMaterial(this.cloudMaterial),this.cloudMaterial.baseColor=new ri(1,1,1,.5),this.groundPlaneMaterial=new Gt,this.initMaterial(this.groundPlaneMaterial),this.groundPlaneMaterial.baseColorTexture=Ca("robot#2",!0,i);for(let s of this.farben){let a=new Gt;this.initMaterial(a);let l=this.farbeToColorInfoMap[s];a.baseColor=new ri(l[0],l[1],l[2],1),this.farbeToMarkerMaterialMap[s]=a;let o=new Gt;this.initMaterial(o);let u=this.farben.indexOf(s)+4;o.baseColorTexture=Ca("robot#"+u),this.farbeToBrickMaterialMap[s]=o}}getBrick(e){return new bP(fi.createHalfheightCube3dMesh(),this.farbeToBrickMaterialMap[e],e)}getGrassBrick(){return new bt(fi.createCube3dMesh(),this.grassBrickMaterial)}getGrassPlane(e,t){let i=new bt(fi.createPlane3dMesh(e,t),this.groundPlaneMaterial);return i.scale.x=e,i.scale.z=t,i.x+=e-1,i.z+=t-1,i}makePlane(e,t,i,n,s,a,l){let o;typeof l=="string"?o=this.getPlaneMaterial(l):(o=new Gt,this.initMaterial(o),o.baseColor=l);let u=new bt(fi.createPlane3dMesh(s,a),o);u.y=i,u.x=t,u.z=n,u.scale.set(s,1,a),e.addChild(u)}getMarker(e){let t=new yP(fi.createCube3dMesh(),this.farbeToMarkerMaterialMap[e],e);return t.scale.set(.9,.1,.9),t}getSidePlanes(e,t,i,n,s){let a=[],l=this.getPlaneMaterial(i),o=new bt(fi.createPlane3dMesh(e,1),l);o.scale.x=e+2*n,o.x+=e-1,o.y-=1+2*s,o.z-=1+2*n,o.rotationQuaternion.setEulerAngles(-90,0,180),a.push(o);let u=new bt(fi.createPlane3dMesh(e,1),l);u.scale.x=e+2*n,u.x+=e-1,u.y-=1+2*s,u.z+=2*t-1+2*n,u.rotationQuaternion.setEulerAngles(90,0,0),a.push(u);let h=new bt(fi.createPlane3dMesh(t,1),l);h.scale.x=t+2*n,h.y-=1+2*s,h.x-=1+2*n,h.z+=t-1,h.rotationQuaternion.setEulerAngles(90,-90,0),a.push(h);let d=new bt(fi.createPlane3dMesh(t,1),l);return d.scale.x=t+2*n,d.y-=1+2*s,d.x+=2*e-1+2*n,d.z+=t-1,d.rotationQuaternion.setEulerAngles(90,90,0),a.push(d),a}getHorizontalPlanes(e,t,i,n,s){let a=[],l=this.getPlaneMaterial(i),o=new bt(fi.createPlane3dMesh(t,1),l);o.scale.x=e+2*n,o.x+=e-1,o.y-=2+2*s,o.z-=2+2*n,o.rotationQuaternion.setEulerAngles(180,0,180),a.push(o);let u=new bt(fi.createPlane3dMesh(e,1),l);u.scale.x=e+2*n,u.x+=e-1,u.y-=2+2*s,u.z+=2*t+2*n,u.rotationQuaternion.setEulerAngles(0,0,0),a.push(u);let h=new bt(fi.createPlane3dMesh(t,1),l);h.scale.x=t+2*n+2,h.y-=2+2*s,h.x-=2+2*n,h.z+=t-1,h.rotationQuaternion.setEulerAngles(0,-90,0),a.push(h);let d=new bt(fi.createPlane3dMesh(t,1),l);return d.scale.x=t+2*n+2,d.y-=2+2*s,d.x+=2*e+2*n,d.z+=t-1,d.rotationQuaternion.setEulerAngles(0,90,0),a.push(d),a}makeClouds(e,t,i,n){let s=150,a=20,l=s,o=()=>{if(l<=0)return;let u=1500,h=20;for(let d=0;d<s/a;d++){l--;let p=Math.sqrt(Math.random())*u,v=Math.random()*2*Math.PI,w=Math.floor(p*Math.cos(v))+i,_=Math.floor(p*Math.sin(v))+n,T=Math.random()*10+2;for(let D=0;D<T;D++){let L=fi.createCube3d(this.cloudMaterial),O=Math.floor(Math.random()*h+2),z=Math.floor(Math.random()*h/4+2),V=Math.floor(Math.random()*h+2),Q=Math.floor(Math.random()*3*(5+T+O)),S=Math.floor(Math.random()*3*(5+T+V));L.x=w+Q,L.z=_+S,L.y=t+z/2,L.scale.set(O,z,V),e.addChild(L)}}setTimeout(o,200)};o()}initMaterial(e){e.camera=this.camera,e.exposure=1,e.roughness=.9,e.lightingEnvironment=this.lightingEnvironment}getPlaneMaterial(e){let t=this.worldHelper.app.renderer;if(this.planeMaterial[e]!=null)return this.planeMaterial[e];let i=new Gt;return this.initMaterial(i),i.baseColorTexture=Ca(e,!0,t),this.planeMaterial[e]=i,i}makeSprite3d(e,t){let i=new Gt;this.initMaterial(i),i.baseColorTexture=Ca(e,!1),i.alphaMode=ir.mask;let n=fi.createPlane3d(1,1,i);return t.addChild(n),n}}class wP extends ${constructor(e){super("Robot",e,"Robot Karol"),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("RobotWorld");this.addMethod(new m("Robot",new g([]),null,n=>{let s=n[0].value,a=new so(e.main.getInterpreter(),s,1,1,5,8);s.intrinsicData.Robot=a},!1,!1,"Instanziert ein neues Robot-Objekt. Der Roboter steht anfangs an der Stelle (1/1)",!0)),this.addMethod(new m("Robot",new g([{identifier:"startX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"startY",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=new so(e.main.getInterpreter(),s,a,l,5,10);s.intrinsicData.Robot=o},!1,!1,"Instanziert ein neues Robot-Objekt. Der Roboter wird anfangs an die Stelle (startX/startY) gesetzt.",!0)),this.addMethod(new m("Robot",new g([{identifier:"startX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"startY",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"worldX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"worldY",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=n[3].value,u=n[4].value,h=new so(e.main.getInterpreter(),s,a,l,o,u);s.intrinsicData.Robot=h},!1,!1,"Instanziert ein neues Robot-Objekt. Der Roboter wird anfangs an die Stelle (startX/startY) gesetzt. Wenn die RobotWorld noch nicht instanziert ist, wird sie mit der Größe worldX * worldY neu erstellt.",!0)),this.addMethod(new m("Robot",new g([{identifier:"startX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"startY",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"initialeWelt",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=n[3].value,u=new so(e.main.getInterpreter(),s,a,l,0,0,o);s.intrinsicData.Robot=u},!1,!1,"Instanziert ein neues Robot-Objekt. Der Roboter wird anfangs an die Stelle (startX/startY) gesetzt. Wenn die RobotWorld noch nicht instanziert ist, wird sie auf Grundlage des Strings initialeWelt erstellt.",!0)),this.addMethod(new m("getWelt",new g([]),t,n=>n[0].value.intrinsicData.Robot.robotWorldHelper.runtimeObject,!1,!1,"Gibt das RobotWorld-Objekt zurück",!1)),this.addMethod(new m("rechtsDrehen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Robot;a.direction.turnRight(),a.adjustAngle()},!1,!1,"Dreht den Roboter um 90° nach rechts.",!1)),this.addMethod(new m("linksDrehen",new g([]),null,n=>{let a=n[0].value.intrinsicData.Robot;a.direction.turnLeft(),a.adjustAngle()},!1,!1,"Dreht den Roboter um 90° nach links.",!1)),this.addMethod(new m("schritt",new g([]),null,n=>{n[0].value.intrinsicData.Robot.schritt()},!1,!1,"Lässt den Roboter einen Schritt nach vorne gehen.",!1)),this.addMethod(new m("schritt",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Robot;for(let o=0;o<a&&l.schritt();o++);},!1,!1,"Lässt den Roboter Anzahl Schritte nach vorne gehen.",!1)),this.addMethod(new m("hinlegen",new g([]),null,n=>{n[0].value.intrinsicData.Robot.hinlegen("rot")},!1,!1,"Lässt den Roboter einen roten Ziegel vor sich hinlegen.",!1)),this.addMethod(new m("markeLöschen",new g([]),null,n=>{n[0].value.intrinsicData.Robot.markeLöschen()},!1,!1,"Lässt den Roboter eine Marke, die direkt unter ihm liegt, löschen.",!1)),this.addMethod(new m("markeSetzen",new g([]),null,n=>{n[0].value.intrinsicData.Robot.markeSetzen("gelb")},!1,!1,"Lässt den Roboter eine gelbe Marke direkt unter sich setzen.",!1)),this.addMethod(new m("markeSetzen",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value;s.intrinsicData.Robot.markeSetzen(a)},!1,!1,"Lässt den Roboter eine Marke der angegebenen Farbe direkt unter sich setzen.",!1)),this.addMethod(new m("hinlegen",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Robot;for(let o=0;o<a&&l.hinlegen("rot");o++);},!1,!1,"Lässt den Roboter Anzahl rote Ziegel vor sich hinlegen.",!1)),this.addMethod(new m("hinlegen",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value;s.intrinsicData.Robot.hinlegen(a)},!1,!1,"Lässt den Roboter einen Ziegel der angegebenen Farbe vor sich hinlegen.",!1)),this.addMethod(new m("aufheben",new g([]),null,n=>{n[0].value.intrinsicData.Robot.aufheben()},!1,!1,"Lässt den Roboter einen roten Ziegel vor sich aufheben.",!1)),this.addMethod(new m("aufheben",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Robot;for(let o=0;o<a&&l.aufheben();o++);},!1,!1,"Lässt den Roboter Anzahl rote Ziegel vor sich aufheben.",!1)),this.addMethod(new m("warten",new g([{identifier:"ZeitInMillisekunden",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{},!1,!1,"Pausiert das Programm für die angegebene Zeit in ms.")),this.addMethod(new m("langsam",new g([]),null,n=>{e.main.getInterpreter().controlButtons.speedControl.setSpeedInStepsPerSecond(5)},!1,!1,"Setzt die Ausführungsgeschwindigkeit auf 5 Programmschritte/Sekunde.")),this.addMethod(new m("schnell",new g([]),null,n=>{e.main.getInterpreter().controlButtons.speedControl.setSpeedInStepsPerSecond("max")},!1,!1,"Setzt die Ausführungsgeschwindigkeit auf 'maximal'.")),this.addMethod(new m("beenden",new g([]),null,n=>{var a;let s=(a=e.main.getBottomDiv())==null?void 0:a.console;s!=null&&(s.writeConsoleEntry("Das Programm wurde durch einen Roboter angehalten.",null,"#0000ff"),s.showTab()),e.main.getInterpreter().stop()},!1,!1,"Beendet das Programm.")),this.addMethod(new m("istWand",new g([]),P,n=>n[0].value.intrinsicData.Robot.istWand(),!1,!1,"Gibt genau dann true zurück, wenn der Roboter direkt vor einer Wand steht.")),this.addMethod(new m("nichtIstWand",new g([]),P,n=>!n[0].value.intrinsicData.Robot.istWand(),!1,!1,"Gibt genau dann true zurück, wenn der Roboter nicht direkt vor einer Wand steht.")),this.addMethod(new m("istZiegel",new g([]),P,n=>n[0].value.intrinsicData.Robot.istZiegel(null),!1,!1,"Gibt genau dann true zurück, wenn direkt vor dem Roboter mindestens ein Ziegel liegt.")),this.addMethod(new m("istZiegel",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return s.intrinsicData.Robot.istZiegel(a)},!1,!1,"Gibt genau dann true zurück, wenn direkt vor dem Roboter genau Anzahl Ziegel liegen.")),this.addMethod(new m("istZiegel",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return s.intrinsicData.Robot.istZiegel(a)},!1,!1,"Gibt genau dann true zurück, wenn auf dem Ziegelstapel direkt vor dem Roboter mindestens ein Ziegel mit der angegebenen Farbe liegt.")),this.addMethod(new m("nichtIstZiegel",new g([]),P,n=>!n[0].value.intrinsicData.Robot.istZiegel(null),!1,!1,"Gibt genau dann true zurück, wenn direkt vor dem Roboter kein Ziegel liegt.")),this.addMethod(new m("nichtIstZiegel",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return!s.intrinsicData.Robot.istZiegel(a)},!1,!1,"Gibt genau dann true zurück, wenn direkt vor dem Roboter nicht genau Anzahl Ziegel liegen.")),this.addMethod(new m("nichtIstZiegel",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return!s.intrinsicData.Robot.istZiegel(a)},!1,!1,"Gibt genau dann true zurück, wenn auf dem Ziegelstapel direkt vor dem Roboter kein Ziegel mit der angegebenen Farbe liegt.")),this.addMethod(new m("istMarke",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return s.intrinsicData.Robot.istMarke(a)},!1,!1,"Gibt genau dann true zurück, wenn unter dem Roboter eine Marke in der angegebenen Farbe liegt.")),this.addMethod(new m("istMarke",new g([]),P,n=>n[0].value.intrinsicData.Robot.istMarke(null),!1,!1,"Gibt genau dann true zurück, wenn unter dem Roboter eine Marke (egal in welcher Farbe) liegt.")),this.addMethod(new m("nichtIstMarke",new g([{identifier:"Farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return!s.intrinsicData.Robot.istMarke(a)},!1,!1,"Gibt genau dann true zurück, wenn unter dem Roboter keine Marke in der angegebenen Farbe liegt.")),this.addMethod(new m("nichtIstMarke",new g([]),P,n=>!n[0].value.intrinsicData.Robot.istMarke(null),!1,!1,"Gibt genau dann true zurück, wenn unter dem Roboter keine Marke (egal in welcher Farbe) liegt."));let i=["Norden","Westen","Süden","Osten"];for(let n=0;n<4;n++){let s=i[n];this.addMethod(new m("ist"+s,new g([]),P,a=>a[0].value.intrinsicData.Robot.direction.index==n,!1,!1,"Gibt genau dann true zurück, wenn der Roboter nach "+s+" blickt."))}this.addMethod(new m("istLeer",new g([]),P,n=>n[0].value.intrinsicData.Robot.hatSteine==0,!1,!1,"Gibt genau dann true zurück, wenn der Roboter keinen Stein mit sich trägt.")),this.addMethod(new m("istVoll",new g([]),P,n=>{let a=n[0].value.intrinsicData.Robot;return a.hatSteine==a.maxSteine},!1,!1,"Gibt genau dann true zurück, wenn der Roboter die maximale Anzahl von Steinen mit sich trägt.")),this.addMethod(new m("nichtIstLeer",new g([]),P,n=>n[0].value.intrinsicData.Robot.hatSteine>0,!1,!1,"Gibt genau dann true zurück, wenn der Roboter mindestens einen Stein mit sich trägt.")),this.addMethod(new m("hatZiegel",new g([]),P,n=>n[0].value.intrinsicData.Robot.hatSteine>0,!1,!1,"Gibt genau dann true zurück, wenn der Roboter mindestens einen Stein mit sich trägt.")),this.addMethod(new m("hatZiegel",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value;return s.intrinsicData.Robot.hatSteine>=a},!1,!1,"Gibt genau dann true zurück, wenn der Roboter mindestens Anzahl Steine mit sich trägt.")),this.addMethod(new m("nichtIstVoll",new g([]),P,n=>{let a=n[0].value.intrinsicData.Robot;return a.hatSteine<a.maxSteine},!1,!1,"Gibt genau dann true zurück, wenn der Roboter weniger als die maximale Anzahl von Steinen mit sich trägt.")),this.addMethod(new m("setzeAnzahlSteine",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Robot;return l.hatSteine=a},!1,!1,"Befüllt den Rucksack des Roboters mit genau Anzahl Steinen.")),this.addMethod(new m("setzeRucksackgröße",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Robot;return l.maxSteine=a},!1,!1,"Gibt dem Roboter einen Rucksack, der maximal Anzahl Steine fasst."))}}class xP extends ${constructor(e){super("RobotWorld",e,"Welt für Robot Karol"),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("RobotWorld",new g([{identifier:"worldX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"worldY",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value;const a=e.main.getInterpreter();let l=new tc(a,i,n,s,null);i.intrinsicData.RobotWorldHelper=l},!1,!1,"Instanziert eine neue Robot-Welt",!0)),this.addMethod(new m("RobotWorld",new g([{identifier:"initialeWelt",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;const s=e.main.getInterpreter();let a=new tc(s,i,0,0,n);i.intrinsicData.RobotWorldHelper=a},!1,!1,"Instanziert eine neue Robot-Welt.",!0)),this.addMethod(new m("setzeMaximalhöhe",new g([{identifier:"Anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.RobotWorldHelper;return s.maximumHeight=n},!1,!1,"Ändert die maximale Höhe der Ziegelstapel.")),this.addMethod(new m("setzeZiegel",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=i.intrinsicData.RobotWorldHelper;if(n<1||n>o.worldX||s<1||s>o.worldY){o.interpreter.throwException(`Die Position (${n}/${s}) ist außerhalb der Weltgrenzen.`);return}for(let u=0;u<l;u++)o.addBrick(n-1,s-1,a)},!1,!1,"Setzt Anzahl Ziegel an der angegebenen Position mit der angegebenen Farbe. Die x- und y-Koordinaten beginnen bei 1.")),this.addMethod(new m("setzeMarke",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"farbe",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=i.intrinsicData.RobotWorldHelper;if(n<1||n>l.worldX||s<1||s>l.worldY){l.interpreter.throwException(`Die Position (${n}/${s}) ist außerhalb der Weltgrenzen.`);return}l.setMarker(n-1,s-1,a)},!1,!1,"Setzt einen Marker an der angegebenen Position mit der angegebenen Farbe. Die x- und y-Koordinaten beginnen bei 1."))}}class tc{constructor(e,t,i,n,s){y(this,"worldHelper");y(this,"robotCubeFactory");y(this,"camera");y(this,"displayObject");y(this,"container3D");y(this,"markers",[]);y(this,"bricks",[]);y(this,"maximumHeight",15);y(this,"robots",[]);if(this.interpreter=e,this.runtimeObject=t,this.worldX=i,this.worldY=n,this.fetchWorld(e),this.worldHelper.robotWorldHelper!=null){this.interpreter.throwException(`Es wurde bereits ein Robot-World-Objekt instanziert. Davon kann es aber nur ein einziges geben. 
Tipp: Jedes Robot-Objekt kann das Robot-World-Objekt mit der getRobotWorld() holen.`);return}this.worldHelper.robotWorldHelper=this,this.camera=new tn(this.worldHelper.app.renderer),this.robotCubeFactory=new vP(this.worldHelper,this.camera),this.markers=[],this.bricks=[],this.container3D=new xn,this.displayObject=this.container3D,this.worldHelper.stage.addChild(this.displayObject),s!=null?this.initFromString(s):this.initWorldArrays(i,n),this.renderOrnamentsAndInitCamera()}adjustRobotPositions(e,t){for(let i of this.robots)i.x==e&&i.y==t&&(i.model.y=this.getBrickCount(e,t)+1.6)}initWorldArrays(e,t){for(let i=0;i<e;i++){let n=[];this.markers.push(n);let s=[];this.bricks.push(s);for(let a=0;a<t;a++)n.push(null),s.push([])}}fetchWorld(e){let t=e.worldHelper;if(t==null){let i=new he(e.moduleStore.getType("World").type);t=new _l(800,600,e.moduleStore.getModule("Base Module"),i),i.intrinsicData.World=t,e.worldHelper=t}this.worldHelper=t}renderOrnamentsAndInitCamera(){this.worldHelper.app.renderer.background.color=8421631;let e=this.robotCubeFactory.getGrassPlane(this.worldX,this.worldY);this.container3D.addChild(e);let t=0,i=0;this.robotCubeFactory.getSidePlanes(this.worldX,this.worldY,"robot#3",i,t++).forEach(a=>{this.container3D.addChild(a)}),this.robotCubeFactory.getSidePlanes(this.worldX,this.worldY,"robot#10",i,t++).forEach(a=>{this.container3D.addChild(a)}),this.robotCubeFactory.makeClouds(this.container3D,60,this.worldX/2,this.worldY/2),this.robotCubeFactory.makePlane(this.container3D,this.worldX/2,-4,this.worldY/2,3e3,3e3,new ri(55/255,174/255,77/255));let n=this.robotCubeFactory.makeSprite3d("robot#11",this.container3D);n.position.set(2*this.worldX+1,-1,2*this.worldY-6),n.scale.set(257/40,1,1),n.rotationQuaternion.setEulerAngles(0,90,0);let s=new wE(this.worldHelper.app.view,this.camera);s.angles.x=45,s.angles.y=-20,s.target={x:this.worldX-1,y:0,z:this.worldY-1},s.distance=Math.max(this.worldX,this.worldY)*2.3}addBrick(e,t,i){let n=this.bricks[e][t].length;if(n<this.maximumHeight){let s=this.robotCubeFactory.getBrick(i);return this.setToXY(e,t,n,s),this.bricks[e][t].push(s),this.container3D.addChild(s),this.adjustMarkerHeight(e,t),this.adjustRobotPositions(e,t),!0}else return!1}removeBrick(e,t){if(this.bricks[e][t].length>0)this.bricks[e][t].pop().destroy(),this.adjustMarkerHeight(e,t),this.adjustRobotPositions(e,t);else return!1}getBrickCount(e,t){return this.bricks[e][t].length}hasBrickColor(e,t,i){for(let n of this.bricks[e][t])if(n.farbe==i)return!0;return!1}getMarkerColor(e,t){let i=this.markers[e][t];return i==null?null:i.farbe}setMarker(e,t,i){this.markers[e][t]!=null&&this.markers[e][t].destroy();let n=this.robotCubeFactory.getMarker(i);this.markers[e][t]=n,this.container3D.addChild(n),this.setToXY(e,t,0,n),this.adjustMarkerHeight(e,t)}removeMarker(e,t){let i=this.markers[e][t];return i==null?!1:(this.markers[e][t]=null,i.destroy(),!0)}adjustMarkerHeight(e,t){let i=this.markers[e][t];if(i!=null){let n=this.bricks[e][t].length;i.y=n+.1}}clear(){for(let e=0;e<this.bricks.length;e++)for(let t=0;t<this.bricks[e].length;t++){let i=this.bricks[e][t];for(;i.length>0;)i.pop().destroy()}for(let e=0;e<this.markers.length;e++)for(let t=0;t<this.markers[e].length;t++){let i=this.markers[e][t];i!=null&&(this.markers[e][t]=null,i.destroy())}}setDimensions(e,t){this.clear(),this.worldX=e,this.worldY=t,this.markers=[],this.bricks=[];for(let i=0;i<e;i++){let n=[];this.markers.push(n);let s=[];this.bricks.push(s);for(let a=0;a<t;a++)n.push(null),s.push([])}}getNumberOfBricks(e,t){return this.bricks[e][t].length}initFromString(e){let t={r:"rot",g:"grün",b:"blau",y:"gelb"},i={R:"rot",G:"grün",B:"blau",Y:"gelb"},n=["1","2","3","4","5","6","7","8","9","0"];this.clear();let s=e.split(`
`),a=0;s.forEach(d=>{let p=this.rowLength(d);p>a&&(a=p)}),this.initWorldArrays(a,s.length),this.worldX=a,this.worldY=s.length;let l,o,u="rot",h="gelb";for(let d=0;d<s.length;d++){let p=s[d],v=0,w=0;for(;w<p.length;){if(l=p.charAt(w),o=w<p.length-1?p.charAt(w+1):null,w++,t[l]!=null){u=t[l];continue}if(i[l]!=null){h=i[l];continue}let _=n.indexOf(l);if(_>=0){for(let T=0;T<_+1;T++)this.addBrick(v,d,u);o=="m"&&(this.setMarker(v,d,h),w++),v++;continue}if(l==" "){v++;continue}if(l=="_"){this.setMarker(v,d,h),v++;continue}}}}rowLength(e){let t=0,i=" _1234567890";for(let n=0;n<e.length;n++)i.indexOf(e.charAt(n))>=0&&t++;return t}setToXY(e,t,i,n){n.x=2*(this.worldX-e-1),n.z=2*(this.worldY-t-1),n.y=i}destroy(){}gibtFarbe(e){return this.robotCubeFactory.farben.indexOf(e)>=0}}class SP{constructor(){y(this,"names",["top","right","bottom","left"]);y(this,"deltas",[{dx:0,dy:-1},{dx:-1,dy:0},{dx:0,dy:1},{dx:1,dy:0}]);y(this,"angles",[0,90,180,270]);y(this,"index",2)}turnRight(){this.index=(this.index-1+4)%4}turnLeft(){this.index=(this.index+1+4)%4}getAngle(){return this.angles[this.index]}getDeltas(){return this.deltas[this.index]}}class so{constructor(e,t,i,n,s,a,l=null){y(this,"robotWorldHelper");y(this,"model");y(this,"x");y(this,"y");y(this,"hatSteine",1e7);y(this,"maxSteine",1e8);y(this,"direction",new SP);this.interpreter=e,this.runtimeObject=t,this.fetchRobotWorld(e,s,a,l),this.robotWorldHelper.robots.push(this),this.render(),this.moveTo(i-1,n-1),this.adjustAngle()}fetchRobotWorld(e,t,i,n){let s=e.worldHelper;if(this.robotWorldHelper=s==null?void 0:s.robotWorldHelper,this.robotWorldHelper==null){let a=new he(e.moduleStore.getType("RobotWorld").type);this.robotWorldHelper=new tc(e,a,t,i,n),a.intrinsicData.RobotWorldHelper=this.robotWorldHelper}}render(){let e=iu.from(yi.get("steve"));e.scale.set(.1);for(let t of e.meshes){let i=t.material;i.camera=this.robotWorldHelper.camera,i.exposure=.5,i.lightingEnvironment=this.robotWorldHelper.robotCubeFactory.lightingEnvironment}this.robotWorldHelper.container3D.addChild(e),this.model=e}crop(e,t,i){return e<t&&(e=t),e>i&&(e=i),e}moveTo(e,t){const i=this.robotWorldHelper;e=this.crop(e,0,i.worldX-1),t=this.crop(t,0,i.worldY-1),this.model.x=2*(i.worldX-e-1),this.model.z=2*(i.worldY-t-1),this.model.y=i.getNumberOfBricks(e,t)+1.6,this.x=e,this.y=t}adjustAngle(){this.model.transform.rotationQuaternion.setEulerAngles(0,this.direction.getAngle(),0)}schritt(){let e=this.direction.getDeltas(),t=this.x+e.dx,i=this.y+e.dy;const n=this.robotWorldHelper;if(t<0||t>=n.worldX||i<0||i>=n.worldY)return this.interpreter.throwException("Der Roboter ist gegen eine Wand geprallt!"),!1;let s=n.getNumberOfBricks(this.x,this.y),a=n.getNumberOfBricks(t,i);return a<s-1?(this.interpreter.throwException("Der Roboter kann maximal einen Ziegel nach unten springen."),!1):a>s+1?(this.interpreter.throwException("Der Roboter kann maximal einen Ziegel hoch springen."),!1):(this.moveTo(t,i),!0)}hinlegen(e){let t=this.direction.getDeltas(),i=this.x+t.dx,n=this.y+t.dy;const s=this.robotWorldHelper;return i<0||i>=s.worldX||n<0||n>=s.worldY?(this.interpreter.throwException("Der Roboter steht direkt vor einer Wand. Da kann er keine Ziegel hinlegen."),!1):(e=e.toLocaleLowerCase(),s.gibtFarbe(e)?this.hatSteine==0?(this.interpreter.throwException("Der Roboter hat keine Ziegel mehr bei sich und kann daher keinen mehr hinlegen."),!1):s.bricks[i][n].length>=s.maximumHeight?(this.interpreter.throwException("Der Ziegelstapel darf die maximale Höhe "+s.maximumHeight+" nicht überschreiten."),!1):(s.addBrick(i,n,e),this.hatSteine--,!0):(this.interpreter.throwException("Es gibt nur Ziegel der Farben "+s.robotCubeFactory.farben.join(", ")+". Die Farbe "+e+" ist nicht darunter."),!1))}aufheben(){let e=this.direction.getDeltas(),t=this.x+e.dx,i=this.y+e.dy;const n=this.robotWorldHelper;if(t<0||t>=n.worldX||i<0||i>=n.worldY)return this.interpreter.throwException("Der Roboter steht direkt vor einer Wand. Da kann er keinen Ziegel aufheben."),!1;if(n.getNumberOfBricks(t,i)<1)return this.interpreter.throwException("Vor dem Roboter liegt kein Ziegel, er kann daher keinen aufheben."),!1;if(n.removeBrick(t,i),this.hatSteine<this.maxSteine)this.hatSteine++;else return this.interpreter.throwException("Der Roboter kann nicht mehr Steine aufheben, da er keinen Platz mehr in seinem Rucksack hat."),!1;return!0}markeSetzen(e){const t=this.robotWorldHelper;if(e=e.toLocaleLowerCase(),!t.gibtFarbe(e))return this.interpreter.throwException("Es gibt nur Marken der Farben "+t.robotCubeFactory.farben.join(", ")+". Die Farbe "+e+" ist nicht darunter."),!1;t.setMarker(this.x,this.y,e)}markeLöschen(){this.robotWorldHelper.removeMarker(this.x,this.y)}istWand(){let e=this.direction.getDeltas(),t=this.x+e.dx,i=this.y+e.dy;const n=this.robotWorldHelper;return t<0||t>=n.worldX||i<0||i>=n.worldY}istZiegel(e){let t=this.direction.getDeltas(),i=this.x+t.dx,n=this.y+t.dy;const s=this.robotWorldHelper;return i<0||i>=s.worldX||n<0||n>=s.worldY?!1:e==null?s.getBrickCount(i,n)>0:typeof e=="string"?s.hasBrickColor(i,n,e.toLocaleLowerCase()):s.bricks[i][n].length==e}istMarke(e){let i=this.robotWorldHelper.markers[this.x][this.y];return e==null?i!=null:typeof e=="string"?i!=null&&i.farbe==e.toLocaleLowerCase():!1}}class _P extends ${constructor(e){super("ResultSet",e,"Ein ResultSet-Objekt speichert das Ergebnis einer Abfrage an die Datenbank."),e.typeStore.getType("ResultSet"),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("next",new g([]),P,i=>i[0].value.intrinsicData.Helper.next(),!1,!1,'Bewegt den "Cursor" zum nächsten Datensatz und gibt genau dann true zurück, wenn noch ein Datensatz da ist.',!1)),this.addMethod(new m("size",new g([]),C,i=>i[0].value.intrinsicData.Helper.size(),!1,!1,"Gibt die Anzahl der Zeilen der Ergebnistabelle zurück.",!1)),this.addMethod(new m("getIndex",new g([]),C,i=>i[0].value.intrinsicData.Helper.cursor,!1,!1,'Gibt den Index zurück, auf dem der "Cursor" in der Liste der Zeilen der Ergebnistabelle steht. Vor dem ersten Aufruf von next() wird -1 zurückgegeben.',!1)),this.addMethod(new m("wasNull",new g([]),P,i=>i[0].value.intrinsicData.Helper.wasNull,!1,!1,"Gibt genau dann true zurück, wenn der zuletzt gelesene Wert null war.",!1));let t=[P,C,G,A,F];for(let i of t){let n=i.identifier.charAt(0).toUpperCase()+i.identifier.substring(1);this.addMethod(new m("get"+n,new g([{identifier:"columnIndex",type:C,declaration:null,usagePositions:null,isFinal:!0}]),i,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Helper,u=e.main.getInterpreter();if(l<1||l>o.columnCount()){u.throwException("Das Ergebnis hat keine Spalte "+l+".");return}return o.isAfterLast()&&u.throwException("Der Cursor befindet sich hinter dem letzten Datensatz des ResultSet."),o.getValue(i,l,e.main.getInterpreter())},!1,!1,"Gibt den Wert der Spalte mit dem angegebenen Spaltenindex als "+i.identifier+" zurück.",!1)),this.addMethod(new m("get"+n,new g([{identifier:"columnLabel",type:F,declaration:null,usagePositions:null,isFinal:!0}]),i,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.Helper,u=e.main.getInterpreter();o.isAfterLast()&&u.throwException("Der Cursor befindet sich hinter dem letzten Datensatz des ResultSet.");let h=o.getColumnIndex(l);if(h<0){u.throwException("Das Ergebnis hat keine Spalte mit dem Bezeichner "+l+".");return}return o.getValue(i,h,e.main.getInterpreter())},!1,!1,"Gibt den Wert der Spalte mit dem angegebenen Spaltenindex als "+i.identifier+" zurück.",!1))}}}class Pb{constructor(e){y(this,"cursor",-1);y(this,"wasNull",!1);this.result=e}getColumnIndex(e){e=e.toLocaleLowerCase();let t=this.result.columns.findIndex((i,n)=>i.toLocaleLowerCase()==e);return t<0?t:t+1}next(){return this.cursor++,this.result==null?!1:this.cursor<this.result.values.length}size(){return this.result.values.length}columnCount(){return this.result.columns.length}getValue(e,t,i){if(this.cursor<0&&(this.cursor=0),this.cursor>=this.result.values.length)return i.throwException("Es wurde versucht, auf den "+(this.cursor+1)+". Datensatz zuzugreifen, das ResultSet hat aber nur "+this.result.values.length+" Datensätze."),null;let n=this.result.values[this.cursor][t-1];if(this.wasNull=n==null,e==F)return n==null?null:""+n;if(e==C)return n==null||typeof n!="number"?0:Math.floor(n);if(e==G||e==A)return n==null||typeof n!="number"?0:n;if(e==P)return n==null?!1:(n+"").indexOf("1")>=0}isAfterLast(){return this.cursor>this.result.values.length-1}}class kP extends ${constructor(e){super("Statement",e,"Ein Statement-Objekt repräsentiert eine Anweisung an die Datenbank.");let t=e.typeStore.getType("ResultSet");this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("executeQuery",new g([{identifier:"query",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.ConnectionHelper,l=e.main.getInterpreter();if(s=s.trim(),!s.toLocaleLowerCase().startsWith("select"))return e.main.getInterpreter().resumeAfterInput(null),l.throwException("Mit der Methode executeQuery können nur select-Anweisungen ausgeführt werden. Benutze für datenverändernde Anweisungen die Methode executeUpdate."),null;l.pauseForInput(Re.waitingForDB),e.main.getBottomDiv().showHideDbBusyIcon(!0),a.executeQuery(s,(o,u)=>{if(e.main.getBottomDiv().showHideDbBusyIcon(!1),o!=null){e.main.getInterpreter().resumeAfterInput(null),l.throwException(o);return}let h=new Pb(u),d=new he(t);d.intrinsicData.Helper=h,l.resumeAfterInput({value:d,type:t},!0)})},!1,!1,"Führt ein SQL-Statement aus, das eine selct-Anweisung enthält.",!1)),this.addMethod(new m("executeUpdate",new g([{identifier:"query",type:F,declaration:null,usagePositions:null,isFinal:!0}]),C,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.ConnectionHelper,l=e.main.getInterpreter();if(s=s.trim(),s.toLocaleLowerCase().startsWith("select")){e.main.getInterpreter().resumeAfterInput(null),l.throwException("Mit der Methode executeUpdate können nur datenverändernde Anweisungen ausgeführt werden. Benutze für select-Anweisungen die Methode executeQuery.");return}l.pauseForInput(Re.waitingForDB),e.main.getBottomDiv().showHideDbBusyIcon(!0),a.executeWriteStatement(s,o=>{if(e.main.getBottomDiv().showHideDbBusyIcon(!1),o!=null){e.main.getInterpreter().resumeAfterInput(null),l.throwException(o);return}l.resumeAfterInput({value:0,type:C},!0)})},!1,!1,"Führt ein SQL-Statement aus, das eine datenverändernde Anweisung enthält.",!1))}}function ao(r,e){return db=new r.Database(e),db.create_function("isDate",function(t){if(t==null)return!0;if(typeof t!="string")return!1;var i=/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/;if(t.match(i)){var n=t.split("/"),s=t.split("-"),a=n.length,l=s.length;if(a>1)var o=t.split("/");else if(l>1)var o=t.split("-");if(o.length!=3)return!1;var u=parseInt(o[2]),h=parseInt(o[1]),d=parseInt(o[0]),p=[31,28,31,30,31,30,31,31,30,31,30,31];if((h==1||h>2)&&u>p[h-1])return!1;if(h==2){var v=!1;return(!(d%4)&&d%100||!(d%400))&&(v=!0),!(v==!1&&u>=29||v==!0&&u>29)}return!0}else return!1}),db.create_function("isDateTime",function(t){if(t==null)return!0;if(typeof t!="string")return!1;var i=/^\d{4}[\-](0[1-9]|1[012])[\-](0[1-9]|[12][0-9]|3[01]) ([01][1-9]|2[0123]):([0-5][0-9]):([0-5][0-9])$/;if(t.match(i)){var n=t.split(" "),s=n[0];if(s.length!=10)return!1;var a=parseInt(s.substring(8,10)),l=parseInt(s.substring(5,7)),o=parseInt(s.substring(0,4)),u=[31,28,31,30,31,30,31,31,30,31,30,31];if((l==1||l>2)&&a>u[l-1])return!1;if(l==2){var h=!1;return(!(o%4)&&o%100||!(o%400))&&(h=!0),!(h==!1&&a>=29||h==!0&&a>29)}return!0}else return!1}),db}class TP{constructor(){y(this,"initsql",initSqlJs({locateFile:(e,t)=>"https://embed.learn-sql.de/include/lib/sql.js/sql-wasm.wasm"}));y(this,"db");y(this,"SQL");y(this,"onmessage");y(this,"onError")}postMessageToClient(e){this.onmessage({data:e})}postMessage(e){let t=this;t.db==null?t.initsql.then(i=>{t.SQL=i,t.db=ao(i,void 0),t.worker(e)}).catch(i=>(console.log(i),t.postMessageToClient({id:this.data.id,error:i.message}))):t.worker(e)}terminate(){}worker(e){var t,i,n=e.config?e.config:{};try{switch(e&&e.action){case"open":return t=e.buffer,this.db=ao(this.SQL,t&&new Uint8Array(t)),this.postMessageToClient({id:e.id,ready:!0});case"exec":if(this.db===null&&(this.db=ao(this.SQL,void 0)),!e.sql)throw"exec: Missing query string";return this.postMessageToClient({id:e.id,results:this.db.exec(e.sql,e.params,n)});case"each":this.db===null&&(this.db=ao(this.SQL,void 0));var s=function(o){return this.postMessage({id:e.id,row:o,finished:!1})},a=function(){return this.postMessage({id:e.id,finished:!0})};return this.db.each(e.sql,e.params,s,a,n);case"export":t=this.db.export(),i={id:e.id,results:[{buffer:t}]};try{return this.postMessageToClient(i)}catch{return this.postMessageToClient(i)}case"close":return this.db&&this.db.close(),this.postMessageToClient({id:e.id});default:throw new Error("Invalid action : "+(e&&e.action))}}catch(l){return this.postMessageToClient({id:e.id,error:l.message})}}}class CP{constructor(e){y(this,"databaseDirectoryEntries",null);y(this,"worker");y(this,"queryId",0);y(this,"querySuccessCallbacksMap",new Map);y(this,"queryErrorCallbackMap",new Map);y(this,"databaseStructure");this.main=e}initializeWorker(e,t,i){this.main.getBottomDiv().console.writeConsoleEntry("Bitte warten, die Datenbank wird initialisiert...",null),this.worker!=null&&this.worker.terminate(),performance.now();let n="worker/sqljs-worker.js";this.main.isEmbedded()&&(n=window.javaOnlineDir+n),window.jo_doc?this.worker=new TP:this.worker=new Worker(n);let s=this,a;this.worker.onmessage=()=>{s.worker.onmessage=o=>{let u=o.data.id;if(o.data.error==null){let h=s.querySuccessCallbacksMap.get(u);h!=null&&h(o.data.results)}else{let h=s.queryErrorCallbackMap.get(u);h!=null&&h(o.data.error)}this.queryErrorCallbackMap.delete(u),this.querySuccessCallbacksMap.delete(u)},t==null&&(t=[]),t=t.slice(),t.length;let l=()=>{if(t.length>0){let o=t.shift();s.executeQuery(o,u=>{l()},u=>{u="Error while setting up database: "+u+", query: "+o,console.log({error:"Error while setting up database: "+u,query:o}),console.log(),l()})}else i!=null&&i(a)};l()},this.worker.onerror=l=>{a="Worker error: "+l.error,console.log("Worker error: "+l.error)},this.worker.postMessage({id:s.queryId++,action:"open",buffer:e})}executeQuery(e,t,i){let n=this.queryId++;this.querySuccessCallbacksMap.set(n,t),this.queryErrorCallbackMap.set(n,i),this.worker.postMessage({id:n,action:"exec",sql:e,params:{}})}executeWriteQueries(e,t,i){if(e.length==0){t();return}let n=e.shift();this.executeQuery(n,()=>{this.executeWriteQueries(e,t,i)},s=>{this.executeWriteQueries(e,()=>{},a=>{}),i(s)})}static getDumpType(e){let t=[83,81,76,105,116,101],i=120,n=!0;for(let s=0;s<t.length;s++)if(t[s]!=e[s]){n=!1;break}return n?"binaryUncompressed":e[0]==i?"binaryCompressed":"other"}close(){this.worker!=null&&(this.worker.terminate(),this.worker=null)}}class AP extends ${constructor(e){super("PreparedStatement",e,"Ein PreparedStatement-Objekt repräsentiert eine parametrisierte Anweisung an die Datenbank.");let t=e.typeStore.getType("ResultSet");this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("executeQuery",new g([]),t,n=>{let a=n[0].value.intrinsicData.Helper,l=e.main.getInterpreter();if(!a.query.toLocaleLowerCase().startsWith("select"))return e.main.getInterpreter().resumeAfterInput(null),l.throwException("Mit der Methode executeQuery können nur select-Anweisungen ausgeführt werden. Benutze für datenverändernde Anweisungen die Methode executeUpdate."),null;l.pauseForInput(Re.waitingForDB),e.main.getBottomDiv().showHideDbBusyIcon(!0);let o=a.checkQuery();if(o!=null)return l.throwException(o),null;a.connectionHelper.executeQuery(a.getQueryWithParameterValuesFilledIn(),(u,h)=>{if(e.main.getBottomDiv().showHideDbBusyIcon(!1),u!=null){e.main.getInterpreter().resumeAfterInput(null),l.throwException(u);return}let d=new Pb(h),p=new he(t);p.intrinsicData.Helper=d,l.resumeAfterInput({value:p,type:t},!0)})},!1,!1,"Führt ein SQL-Statement aus, das eine select-Anweisung enthält.",!1)),this.addMethod(new m("executeUpdate",new g([]),C,n=>{let a=n[0].value.intrinsicData.Helper,l=e.main.getInterpreter();if(a.query.toLocaleLowerCase().startsWith("select"))return e.main.getInterpreter().resumeAfterInput(null),l.throwException("Mit der Methode execute können nur datenverändernde Anweisungen ausgeführt werden.Benutze für select-Anweisungen die Methode executeQuery."),null;l.pauseForInput(Re.waitingForDB),e.main.getBottomDiv().showHideDbBusyIcon(!0);let o=a.checkQuery();if(o!=null)return l.resumeAfterInput(null),l.throwException(o),null;a.connectionHelper.executeWriteStatement(a.getQueryWithParameterValuesFilledIn(),u=>{if(e.main.getBottomDiv().showHideDbBusyIcon(!1),u!=null){e.main.getInterpreter().resumeAfterInput(null),l.resumeAfterInput(null),l.throwException(u);return}l.resumeAfterInput({value:0,type:C},!0)})},!1,!1,"Führt ein SQL-Statement aus, das eine datenverändernde Anweisung enthält.",!1));let i=[P,C,G,A,F];for(let n of i){let s=n.identifier.charAt(0).toUpperCase()+n.identifier.substring(1);this.addMethod(new m("set"+s,new g([{identifier:"parameterIndex",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"value",type:n,declaration:null,usagePositions:null,isFinal:!0}]),U,a=>{let l=a[0].value,o=a[1].value,u=a[2].value,d=l.intrinsicData.Helper.setValue(u,o);d!=null&&(e.main.getInterpreter().resumeAfterInput(null),e.main.getInterpreter().throwException(d))},!1,!1,"Setzt im Parameter mit dem angegebenen Index den "+n.identifier+"-Wert ein."))}}}class MP{constructor(e,t){y(this,"parameterValues");y(this,"parameterPositions");y(this,"query");this.connectionHelper=e,this.query=t.trim(),this.prepareStatement(this.query)}prepareStatement(e){let t=!1;this.parameterPositions=[];for(let i=0;i<e.length;i++)switch(e.charAt(i)){case"'":t=!t;break;case"?":t||this.parameterPositions.push(i);break}this.parameterValues=new Array(this.parameterPositions.length)}setValue(e,t){if(t<1||t>this.parameterPositions.length)return this.parameterPositions.length==0?"Es gibt keine Parameter (mit ? besetzte Stellen) in dieser Anweisung.":"Es gibt nur die Parameterpositionen 1 bis "+this.parameterPositions.length+" in der SQL-Anweisung, keine Position "+t+".";e==null?this.parameterValues[t-1]="null":typeof e=="string"?(e=e.replace(/'/g,"''"),this.parameterValues[t-1]="'"+e+"'"):this.parameterValues[t-1]=""+e}checkQuery(){return null}getQueryWithParameterValuesFilledIn(){let e=this.query,t=[],i=0;for(let s=0;s<this.parameterPositions.length;s++)t.push(e.substring(i,this.parameterPositions[s])),i=this.parameterPositions[s]+1;i<e.length&&t.push(e.substring(i));let n="";for(let s=0;s<this.parameterPositions.length;s++)n+=t[s]+this.parameterValues[s];return t.length>this.parameterPositions.length&&(n+=t[t.length-1]),n}}class EP extends ${constructor(e){super("Connection",e,"Ein Connection-Objekt repräsentiert die Verbindung zu einer Datenbank auf www.sql-ide.de"),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("PreparedStatement"),i=e.typeStore.getType("Statement");this.addMethod(new m("createStatement",new g([]),i,n=>{let a=n[0].value.intrinsicData.Helper,l=new he(i);return l.intrinsicData.ConnectionHelper=a,l},!1,!1,"Erstellt ein Statement-Objekt, mit dem Statements zur Datenbank geschickt werden können.",!1)),this.addMethod(new m("prepareStatement",new g([{identifier:"query",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Helper,o=new he(t);return o.intrinsicData.Helper=new MP(l,a),o},!1,!1,"Erstellt ein PreparedStatement-Objekt, mit dem Anweisungen zur Datenbank geschickt werden können.",!1)),this.addMethod(new m("close",new g([]),U,n=>{n[0].value.intrinsicData.Helper.close()},!1,!1,"Schließt die Verbindung zur Datenbank.",!1))}}class PP{constructor(e){y(this,"database");y(this,"databaseData");y(this,"token");y(this,"databaseSSEListener");y(this,"skipNextServerSentStatement",!1);this.main=e,e.getInterpreter().registerDatabaseConnection(this)}connect(e,t){let i=this;this.main.networkManager.fetchDatabaseAndToken(e,(n,s,a)=>{a==null?(i.token=s,i.databaseData=n,i.database=new CP(i.main),i.database.initializeWorker(n.templateDump,n.statements,l=>{i.databaseSSEListener=new ea(i.main.networkManager,i.token,n.id,(o,u,h)=>{i.onServerSentStatements(o,u,h)}),t(null)})):t(a)})}close(){this.databaseSSEListener!=null&&(this.databaseSSEListener.close(),this.databaseSSEListener=null),this.database!=null&&(this.database.close(),this.database=null)}onServerSentStatements(e,t,i){if(this.skipNextServerSentStatement){this.skipNextServerSentStatement=!1;return}if(i!=null){this.databaseData.statements.splice(i),this.database.initializeWorker(this.databaseData.templateDump,this.databaseData.statements);return}else this.executeStatementsFromServer(e,t)}executeStatementsFromServer(e,t,i){if(this.database==null){i&&i("Keine Datenbankverbindung.");return}let s=this.databaseData.statements.length-e+1;if(s>=t.length){i&&i(null);return}t=t.slice(s),this.databaseData.statements=this.databaseData.statements.concat(t),this.database.executeWriteQueries(t,()=>{i!=null&&i(null)},a=>{i!=null&&i(a)})}executeWriteStatement(e,t,i=!1){this.database==null&&t("Es besteht keine Verbindung zur Datenbank.",0);let n=this,s=n.databaseData.statements.length;this.database.executeQuery("explain "+e,()=>{n.skipNextServerSentStatement=!0,n.main.networkManager.addDatabaseStatement(n.token,s,[e],(a,l,o)=>{if(o!=null){t(o,0);return}n.executeStatementsFromServer(s+1,a,u=>{n.database.executeWriteQueries([e],()=>{if(n.databaseData.statements.push(e),!i){t(null,0);return}n.executeQuery("select last_insert_rowid()",(h,d)=>{t(null,d.values[0][0])})},h=>{n.databaseData.statements.push(e),t!=null&&t(h,0),n.main.networkManager.rollbackDatabaseStatement(n.token,n.databaseData.statements.length,()=>{})})})})},a=>{t(a,0)})}executeQuery(e,t){if(this.database==null||this.databaseSSEListener==null){t("Es besteht keine Verbindung zur Datenbank.",null);return}this.database.executeQuery(e,i=>{t(null,i.length==0?{columns:[],values:[]}:i[0])},i=>{t(i,null)})}}class IP extends ${constructor(e){super("DatabaseManager",e,"Über die statische Methode DatabaseManager.getConnection(String code) kann die Verbindung zu einer Datenbank auf www.sql-ide.de aufgebaut werden."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("Connection");this.addMethod(new m("getConnection",new g([{identifier:"code",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,i=>{i[0].value;let n=i[1].value,s=e.main,a=e.main.getInterpreter();if(s.isEmbedded())return a.throwException("Verbindung zu einer Datenbank kann nur von www.online-ide.de aus aufgebaut werden."),null;let l=new PP(e.main);a.pauseForInput(Re.waitingForDB),e.main.getBottomDiv().showHideDbBusyIcon(!0),l.connect(n,o=>{if(e.main.getBottomDiv().showHideDbBusyIcon(!1),o==null){let u=new he(t);u.intrinsicData.Helper=l,a.resumeAfterInput({value:u,type:t},!0)}else a.resumeAfterInput(null),a.throwException(o)})},!1,!0,"Baut eine Verbindung mit einer Datenbank auf www.sql-ide.de auf. Gibt ein Connection-Objekt zurück, das diese Verbindung repräsentiert.",!1))}}class DP extends ${constructor(e){super("JavaKaraWorld",e,"JavaKara-Welt"),this.setBaseClass(e.typeStore.getType("FilledShape"));let t=e.typeStore.getType("Position");this.addAttribute(new ce("NORTH",C,i=>{i.value=0},!0,ee.public,!0,"Direction NORTH")),this.addAttribute(new ce("WEST",C,i=>{i.value=1},!0,ee.public,!0,"Direction WEST")),this.addAttribute(new ce("SOUTH",C,i=>{i.value=2},!0,ee.public,!0,"Direction SOUTH")),this.addAttribute(new ce("EAST",C,i=>{i.value=3},!0,ee.public,!0,"Direction EAST")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("JavaKaraWorld",new g([{identifier:"sizeX",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"sizeY",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=new Tf(10,10,s,a,e.main.getInterpreter(),n,t);n.intrinsicData.Actor=l},!1,!1,"Instanziert eine neue JavaKara-Welt",!0)),this.addMethod(new m("getSizeX",new g([]),C,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getSizeX"))return s.sizeX},!1,!1,"Gibt zurück, wie viele Felder breit die Welt ist.",!1)),this.addMethod(new m("getSizeY",new g([]),C,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getSizeY"))return s.sizeY},!1,!1,"Gibt zurück, wie viele Felder hoch die Welt ist.",!1)),this.addMethod(new m("clearAll",new g([]),U,i=>{let s=i[0].value.intrinsicData.Actor;s.testdestroyed("clearAll")||s.clearAll()},!1,!1,"Löscht alles aus der Welt bis auf Kara.",!1)),this.addMethod(new m("setLeaf",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setLeaf")||l.setOrRemoveLeaf(s,a)},!1,!1,"Setzt oder entfernt an der Position (x, y) ein Kleeblatt.",!1)),this.addMethod(new m("setTree",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setTree")||l.setOrRemoveTree(s,a)},!1,!1,"Setzt oder entfernt an der Position (x, y) einen Baumstumpf.",!1)),this.addMethod(new m("setMushroom",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;l.testdestroyed("setMushroom")||l.setOrRemoveMushroom(s,a)},!1,!1,"Setzt oder entfernt an der Position (x, y) einen Pilz.",!1)),this.addMethod(new m("isEmpty",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value,a=i[2].value,l=n.intrinsicData.Actor;if(!l.testdestroyed("setEmpty"))return l.isEmpty(s,a)},!1,!1,"Gibt genau dann true zurück, wenn sich auf dem angegebenen Feld nichts befindet (auch nicht Kara).",!1)),this.addMethod(new m("init",new g([{identifier:"worldAsString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("init")||(a.clearAll(),a.init(s))},!1,!1,"Baut die Welt mithilfe eines mehrzeiligen Strings. Dabei bedeutet \\n einen Zeilenumbruch, l ein Kleeblatt, t einen Baumstumpf und m einen Pilz.",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("scale")||a.scaleNew(s)},!1,!1,"Streckt das Grafikobjekt um den angegebenen Faktor. Das Zentrum der Streckung ist der 'Mittelpunkt' des Objekts.",!1))}}class Tf extends vi{constructor(t,i,n,s,a,l,o){super(a,l);y(this,"cellWidth",28);y(this,"backgroundGraphics");y(this,"columns");y(this,"karas",[]);this.left=t,this.top=i,this.sizeX=n,this.sizeY=s,this.runtimeObject=l,this.positionKlass=o,this.columns=[];for(let u=0;u<n;u++){let h=[];this.columns.push(h);for(let d=0;d<s;d++)h.push([])}this.borderWidth=2,this.fillColor=11855540,this.fillAlpha=1,this.borderColor=11184810,this.borderAlpha=1,this.centerXInitial=t+this.borderWidth/2+n*this.cellWidth/2,this.centerYInitial=i+this.borderWidth/2+s*this.cellWidth/2,this.displayObject=new Rt,this.worldHelper.stage.addChild(this.displayObject),this.addToDefaultGroupAndSetDefaultVisibility(),this.render()}scaleNew(t){this.displayObject.updateTransform();let i=new xe(this.left,this.top);this.displayObject.transform.worldTransform.apply(i,i),this.scale(t,i.x,i.y)}isMushroom(t,i){for(let n of this.columns[t][i])if(n.isMushroom())return!0;return!1}isTree(t,i){for(let n of this.columns[t][i])if(n.isTree())return!0;return!1}isLeaf(t,i){for(let n of this.columns[t][i])if(n.isLeaf())return!0;return!1}getCopy(t){let i=new he(t),n=new Tf(this.left,this.top,this.sizeX,this.sizeY,this.worldHelper.interpreter,i,this.positionKlass);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}render(){this.backgroundGraphics!=null&&this.backgroundGraphics.destroy();let t=this.displayObject;this.backgroundGraphics=new gt,t.addChild(this.backgroundGraphics),t.setChildIndex(this.backgroundGraphics,0);let i=this.sizeX*this.cellWidth,n=this.sizeY*this.cellWidth;this.hitPolygonInitial=[{x:this.left,y:this.top},{x:this.left,y:this.top+n},{x:this.left+i,y:this.top+n},{x:this.left+i,y:this.top}],this.backgroundGraphics.clear(),this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,1),this.backgroundGraphics.moveTo(this.left,this.top),this.backgroundGraphics.lineTo(this.left+i,this.top),this.backgroundGraphics.lineTo(this.left+i,this.top+n),this.backgroundGraphics.lineTo(this.left,this.top+n),this.backgroundGraphics.closePath(),this.fillColor!=null&&this.backgroundGraphics.endFill(),this.backgroundGraphics.lineStyle(1,this.borderColor,this.borderAlpha,.5);for(let s=1;s<this.sizeX;s++){let a=this.left+this.cellWidth*s;this.backgroundGraphics.moveTo(a,this.top),this.backgroundGraphics.lineTo(a,this.top+n)}for(let s=1;s<this.sizeY;s++){let a=this.top+this.cellWidth*s;this.backgroundGraphics.moveTo(this.left,a),this.backgroundGraphics.lineTo(this.left+i,a)}}removeSprite(t){let i=this.columns[t.x][t.y],n=i.indexOf(t);n>0&&i.splice(n,1)}addSprite(t,i,n){this.columns[t][i].push(n)}moveSprite(t,i,n){this.removeSprite(n),this.addSprite(t,i,n)}getMushroom(t,i){return this.columns[t][i].find(s=>s.isMushroom())}isOutside(t,i){return t<=0||i<=0||t>=this.sizeX||i>=this.sizeY}put(t,i,n){if(t<0&&(t=-t+this.sizeX-1),i<0&&(i=-i+this.sizeY-1),t=t%this.sizeX,i=i%this.sizeY,this.columns[t][i].push(n),n.isKara())this.karas.push(n);else for(let s of this.karas){let a=this.displayObject,l=a.children.length-1;a.setChildIndex(s.sprite,l)}}removeLeaf(t,i){let s=this.columns[t][i].find(a=>a.isLeaf());this.removeSprite(s),s.sprite.destroy()}removeTree(t,i){let s=this.columns[t][i].find(a=>a.isTree());this.removeSprite(s),s.sprite.destroy()}removeMushroom(t,i){let s=this.columns[t][i].find(a=>a.isMushroom());this.removeSprite(s),s.sprite.destroy()}clearAll(){for(let t of this.columns)for(let i of t)this.emptyCellArray(i)}emptyCellArray(t){let i=null;for(let n of t)n.isKara()?i=n:n.sprite.destroy();for(;t.length>0;)t.pop();i!=null&&t.push(i)}setOrRemoveLeaf(t,i){this.isLeaf(t,i)?this.removeLeaf(t,i):new Xs(this,t,i,3,1)}setOrRemoveTree(t,i){this.isTree(t,i)?this.removeTree(t,i):new Xs(this,t,i,3,3)}setOrRemoveMushroom(t,i){this.isMushroom(t,i)?this.setOrRemoveMushroom(t,i):new Xs(this,t,i,3,2)}isEmpty(t,i){return this.columns[t][i].length==0}init(t){let i=t.split(`
`);for(let n=0;n<i.length&&!(n>=this.sizeY);n++){let s=i[n];for(let a=0;a<s.length&&!(a>=this.sizeX);a++)switch(s.charAt(a).toLocaleLowerCase()){case"l":this.setOrRemoveLeaf(a,n);break;case"t":this.setOrRemoveTree(a,n);break;case"m":this.setOrRemoveMushroom(a,n);break}}}destroy(){for(let t of this.columns)for(let i of t){for(let n of i)n.sprite.destroy();for(;i.length>0;)i.pop()}super.destroy()}}class FP extends ${constructor(e){super("Kara",e,"JavaKara-Marienkäfer"),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("JavaKaraWorld"),i=e.typeStore.getType("Position");this.addMethod(new m("Kara",new g([{identifier:"javaKaraWorld",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"direction",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=n[3].value,u=n[4].value;if(a==null){e.main.getInterpreter().throwException("Der Parameter javaKaraWorld darf nicht null sein.");return}let h=new Xs(a.intrinsicData.Actor,l,o,u,0);s.intrinsicData.Helper=h},!1,!1,"Instanziert ein neues Kara-Objekt",!0)),this.addMethod(new m("setPosition",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let s=n[0].value,a=n[1].value,l=n[2].value,o=s.intrinsicData.Helper;if(o.testDestroyed("setPosition"))return!0;o.setPosition(a,l)},!1,!1,"Setzt Kara an die angegebene Position. (0,0) ist dabei die linke obere Ecke der Welt.",!1)),this.addMethod(new m("getPosition",new g([]),i,n=>{let a=n[0].value.intrinsicData.Helper;return a.testDestroyed("getPosition")?!0:a.getPosition()},!1,!1,"Gibt Karas Position zurück. Dabei ist (0/0) die Position der linken oberen Ecke.",!1)),this.addMethod(new m("move",new g([]),U,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("move"))return!0;a.forward()},!1,!1,"Bewegt Kara um ein Feld nach vorne.",!1)),this.addMethod(new m("getWorld",new g([]),t,n=>{let a=n[0].value.intrinsicData.Helper;return a.testDestroyed("getWorld")?!0:a.world.runtimeObject},!1,!1,"Gibt das JavaKaraWorld-Objekt zurück, in dem sich Kara befindet.",!1)),this.addMethod(new m("getDirection",new g([]),C,n=>{let a=n[0].value.intrinsicData.Helper;return a.testDestroyed("getDirection")?!0:a.direction},!1,!1,"Gibt die Blickrichtung von Kara zurück: 0 == Norden, 1 == Westen, 2 == Süden, 3 == Osten",!1)),this.addMethod(new m("onLeaf",new g([]),P,n=>{let a=n[0].value.intrinsicData.Helper;return a.testDestroyed("onLeaf")?!0:a.world.isLeaf(a.x,a.y)},!1,!1,"Gibt genau dann true zurück, wenn sich Kara auf einem Kleeblatt befindet.",!1)),this.addMethod(new m("treeFront",new g([]),P,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("treeFront"))return!0;let l=a.getPositionFront();return a.world.isTree(l.x,l.y)},!1,!1,"Gibt genau dann true zurück, wenn sich vor Kara ein Baumstumpf befindet.",!1)),this.addMethod(new m("mushroomFront",new g([]),P,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("mushroomFront"))return!0;let l=a.getPositionFront();return a.world.isMushroom(l.x,l.y)},!1,!1,"Gibt genau dann true zurück, wenn sich vor Kara ein Pilz befindet.",!1)),this.addMethod(new m("treeLeft",new g([]),P,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("treeLeft"))return!0;let l=a.getPositionLeft();return a.world.isTree(l.x,l.y)},!1,!1,"Gibt genau dann true zurück, wenn sich links von Kara ein Baumstumpf befindet.",!1)),this.addMethod(new m("treeRight",new g([]),P,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("treeRight"))return!0;let l=a.getPositionRight();return a.world.isTree(l.x,l.y)},!1,!1,"Gibt genau dann true zurück, wenn sich rechts von Kara ein Baumstumpf befindet.",!1)),this.addMethod(new m("turnLeft",new g([]),U,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("turnLeft"))return!0;a.turn(1)},!1,!1,"Dreht Kara um 90° nach links",!1)),this.addMethod(new m("turnRight",new g([]),U,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("turnRight"))return!0;a.turn(-1)},!1,!1,"Dreht Kara um 90° nach rechts",!1)),this.addMethod(new m("putLeaf",new g([]),U,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("putLeaf"))return!0;a.putLeaf()},!1,!1,"Legt ein Kleeblatt auf die Position, an der Kara gerade steht.",!1)),this.addMethod(new m("removeLeaf",new g([]),U,n=>{let a=n[0].value.intrinsicData.Helper;if(a.testDestroyed("removeLeaf"))return!0;a.removeLeaf()},!1,!1,"Kara nimmt das Kleeblatt, das sich auf seiner aktuellen Position befindet.",!1))}}const zs=class zs{constructor(e,t,i,n,s){y(this,"sprite");this.world=e,this.x=t,this.y=i,this.direction=n,this.imageIndex=s;let l=yi.get("spritesheet").textures["Kara#"+s];l.baseTexture.scaleMode=0,this.sprite=new Wt(l),this.move(e.left+t*e.cellWidth,e.top+i*e.cellWidth),e.displayObject.addChild(this.sprite),this.direction=3,this.setDirection(n),this.world.put(t,i,this)}forward(){let e=zs.directions[this.direction],t=(this.x+e.dx+this.world.sizeX)%this.world.sizeX,i=(this.y+e.dy+this.world.sizeY)%this.world.sizeY;if(this.world.isTree(t,i)){this.throwException(`An der neuen Position (${t}, ${i}) befindet sich ein Baumstumpf. Kara kann nicht dorthin gehen.`);return}if(this.world.isMushroom(t,i)){let n=t+e.dx,s=i+e.dy;if(n=(n+this.world.sizeX)%this.world.sizeX,s=(s+this.world.sizeY)%this.world.sizeY,this.world.isTree(n,s)){this.throwException(`An der neuen Position (${t}, ${i}) befindet sich ein Pilz, dahinter ein Baum. Kara kann den Pilz daher nicht schieben.`);return}if(this.world.isMushroom(n,s)){this.throwException(`An der neuen Position (${t}, ${i}) befindet sich ein Pilz, dahinter noch ein Pilz. Kara kann den Pilz daher nicht schieben.`);return}this.world.getMushroom(t,i).moveToCell(n,s)}this.moveToCell(t,i)}turn(e){this.setDirection((this.direction+e+4)%4)}throwException(e){let t=this.world.worldHelper.interpreter;t.throwException(e),t.stop()}move(e,t){this.sprite.localTransform.translate(e,t),this.sprite.transform.onChange()}moveToCell(e,t){this.move((e-this.x)*this.world.cellWidth,(t-this.y)*this.world.cellWidth),this.x=e,this.y=t,this.world.moveSprite(e,t,this)}setDirection(e){let t=(e-this.direction+4)%4,i=this.world.left+this.x*this.world.cellWidth+14,n=this.world.top+this.y*this.world.cellWidth+14;this.sprite.localTransform.translate(-i,-n),this.sprite.localTransform.rotate(-t*Math.PI/2),this.sprite.localTransform.translate(i,n),this.sprite.transform.onChange(),this.direction=e}isLeaf(){return this.imageIndex==1}isMushroom(){return this.imageIndex==2}isTree(){return this.imageIndex==3}isKara(){return this.imageIndex==0}getPositionFront(){return this.getPositionInDirection(0)}getPositionLeft(){return this.getPositionInDirection(1)}getPositionRight(){return this.getPositionInDirection(-1)}getPositionInDirection(e){let t=zs.directions[(this.direction+e+4)%4];return{x:(this.x+t.dx+this.world.sizeX)%this.world.sizeX,y:(this.y+t.dy+this.world.sizeY)%this.world.sizeY}}putLeaf(){if(this.world.isLeaf(this.x,this.y)){this.throwException("Unter Kara liegt schon ein Kleeblatt, es kann an dieser Position nicht  noch eines abgelegt werden.");return}new zs(this.world,this.x,this.y,3,1)}removeLeaf(){if(!this.world.isLeaf(this.x,this.y)){this.throwException("Unter Kara liegt kein Kleeblatt, daher kann Kara keines aufheben (Methode removeLeaf).");return}this.world.removeLeaf(this.x,this.y)}setPosition(e,t){e<0&&(e=-e-1+this.world.sizeX),t<0&&(t=-t-1+this.world.sizeY),this.moveToCell(e%this.world.sizeX,t%this.world.sizeY)}getPosition(){let e=new he(this.world.positionKlass),t=this.world.positionKlass.attributeMap.get("x").index,i=this.world.positionKlass.attributeMap.get("y").index;return e.attributes[t]={value:this.x,type:C},e.attributes[i]={value:this.y,type:C},e}testDestroyed(e){return this.sprite.destroyed?(this.throwException("Die Methode "+e+" eines schon zerstörten Marienkäfers wurde aufgerufen."),!0):!1}};y(zs,"directions",[{index:0,dx:0,dy:-1},{index:1,dx:-1,dy:0},{index:2,dx:0,dy:1},{index:3,dx:1,dy:0}]);let Xs=zs;class RP extends ${constructor(e){super("Position",e,"Repräsentiert einen Position auf einem Gitternetz (nur ganzzahlige Koordinaten)"),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("x",C,null,!1,ee.public,!1,"x-Komponente der Position")),this.addAttribute(new ce("y",C,null,!1,ee.public,!1,"y-Komponente der Position")),this.setupAttributeIndicesRecursive();let t=this.attributeMap.get("x").index,i=this.attributeMap.get("y").index;this.addMethod(new m("IntPosition",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),null,n=>{let s=n[0].value,a=n[1].value,l=n[2].value;s.attributes[t]={type:C,value:a},s.attributes[i]={type:C,value:l}},!1,!1,"Instanziert eine neue Position den Komponenten x und y.",!0))}}class OP extends ${constructor(e){super("JavaHamsterWorld",e,"JavaHamster-Welt"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.addMethod(new m("JavaHamsterWorld",new g([{identifier:"Breite",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"Höhe",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=new Cf(10,10,n,s,e.main.getInterpreter(),i);i.intrinsicData.Actor=a},!1,!1,"Instanziert eine neue JavaHamster-Welt",!0)),this.addMethod(new m("getBreite",new g([]),C,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getBreite"))return n.sizeX},!1,!1,"Gibt zurück, wie viele Felder breit die Welt ist.",!1)),this.addMethod(new m("getHöhe",new g([]),C,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getHöhe"))return n.sizeX},!1,!1,"Gibt zurück, wie viele Felder hoch die Welt ist.",!1)),this.addMethod(new m("löscheAlles",new g([]),U,t=>{let n=t[0].value.intrinsicData.Actor;n.testdestroyed("löscheAlles")||n.clearAll()},!1,!1,"Löscht alles aus der Welt bis auf den Hamster.",!1)),this.addMethod(new m("setzeMauer",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=i.intrinsicData.Actor;a.testdestroyed("setzeMauer")||a.setOrRemoveWall(n,s)},!1,!1,"Setzt oder entfernt an der Position (x, y) eine Mauer.",!1)),this.addMethod(new m("setzeGetreide",new g([{identifier:"x",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahl",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=i.intrinsicData.Actor;l.testdestroyed("setzeAnzahl")||l.setGrain(n,s,a)},!1,!1,"Setzt an der Position (x, y) die Anzahl der Getreidekörner.",!1)),this.addMethod(new m("init",new g([{identifier:"worldAsString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),P,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("init")||(s.clearAll(),s.init(n))},!1,!1,"Baut die Welt mithilfe eines mehrzeiligen Strings. Dabei bedeutet \\n einen Zeilenumbruch, m eine Mauer und 1 ... 9, a ... f die entsprechende Anzahl an Getreidekörnern.",!1)),this.addMethod(new m("scale",new g([{identifier:"factor",type:A,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("scale")||s.scaleNew(n)},!1,!1,"Streckt das Grafikobjekt um den angegebenen Faktor. Das Zentrum der Streckung ist der 'Mittelpunkt' des Objekts.",!1))}}class Cf extends vi{constructor(t,i,n,s,a,l){super(a,l);y(this,"cellWidth",40);y(this,"backgroundGraphics");y(this,"columns");y(this,"hamsters",[]);y(this,"belowWorldText");this.left=t,this.top=i,this.sizeX=n,this.sizeY=s,this.runtimeObject=l,this.borderWidth=2,this.fillColor=9498256,this.fillAlpha=1,this.borderColor=9127187,this.borderAlpha=1,this.centerXInitial=t+this.borderWidth/2+n*this.cellWidth/2,this.centerYInitial=i+this.borderWidth/2+s*this.cellWidth/2,this.displayObject=new Rt,this.worldHelper.stage.addChild(this.displayObject),this.addToDefaultGroupAndSetDefaultVisibility(),this.render(),this.renderBelowWorld(),this.columns=[];for(let o=0;o<n;o++){let u=[];this.columns.push(u);for(let h=0;h<s;h++)u.push(new BP(this,o,h))}}setGrain(t,i,n){this.columns[t][i].setGrainCount(n)}setOrRemoveWall(t,i){let n=this.columns[t][i];n.setWall(!n.isWall())}scaleNew(t){this.displayObject.updateTransform();let i=new xe(this.left,this.top);this.displayObject.transform.worldTransform.apply(i,i),this.scale(t,i.x,i.y)}isWall(t,i){return this.columns[t][i].isWall()}getGrainCount(t,i){return this.columns[t][i].getGrainCount()}getCopy(t){let i=new he(t),n=new Cf(this.left,this.top,this.sizeX,this.sizeY,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}renderBelowWorld(){let t=new Hi({fontFamily:"sans-serif",fontSize:28,fontStyle:"normal",fontWeight:"normal",fill:16777215,stroke:"#00000040",strokeThickness:2,align:"center"});this.belowWorldText=new jn("Hamster: 0, Feld: 0",t),this.belowWorldText.localTransform.translate(this.left,this.top+this.sizeY*this.cellWidth+5),this.belowWorldText.transform.onChange(),this.displayObject.addChild(this.belowWorldText)}render(){this.backgroundGraphics!=null&&this.backgroundGraphics.destroy();let t=this.displayObject;this.backgroundGraphics=new gt,t.addChild(this.backgroundGraphics),t.setChildIndex(this.backgroundGraphics,0);let i=this.sizeX*this.cellWidth,n=this.sizeY*this.cellWidth;this.hitPolygonInitial=[{x:this.left,y:this.top},{x:this.left,y:this.top+n},{x:this.left+i,y:this.top+n},{x:this.left+i,y:this.top}],this.backgroundGraphics.clear(),this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,1),this.backgroundGraphics.moveTo(this.left,this.top),this.backgroundGraphics.lineTo(this.left+i,this.top),this.backgroundGraphics.lineTo(this.left+i,this.top+n),this.backgroundGraphics.lineTo(this.left,this.top+n),this.backgroundGraphics.closePath(),this.fillColor!=null&&this.backgroundGraphics.endFill(),this.backgroundGraphics.lineStyle(1,this.borderColor,this.borderAlpha,.5);for(let s=1;s<this.sizeX;s++){let a=this.left+this.cellWidth*s;this.backgroundGraphics.moveTo(a,this.top),this.backgroundGraphics.lineTo(a,this.top+n)}for(let s=1;s<this.sizeY;s++){let a=this.top+this.cellWidth*s;this.backgroundGraphics.moveTo(this.left,a),this.backgroundGraphics.lineTo(this.left+i,a)}}getWallGrainSprite(t,i){return this.columns[t][i]}isOutside(t,i){return t<0||i<0||t>=this.sizeX||i>=this.sizeY}clearAll(){}init(t){let i=t.split(`
`);for(let n=0;n<i.length&&!(n>=this.sizeY);n++){let s=i[n];for(let a=0;a<s.length&&!(a>=this.sizeX);a++){let l=this.columns[a][n],o=s.charAt(a).toLocaleLowerCase();if(o=="m")l.setWall(!0);else{let u=o.charCodeAt(0),h=0;u>=97&&u<=102&&(h=u-97+10),u>=49&&u<=57&&(h=u-49+1),h>0&&l.setGrainCount(h)}}}}destroy(){for(let t of this.columns)for(let i of t)i.destroy();this.backgroundGraphics.destroy(),this.hamsters.forEach(t=>t.destroy()),this.belowWorldText.destroy(),super.destroy()}}class LP extends ${constructor(e){super("Hamster",e,"JavaHamster-Hamster"),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("NORD",C,i=>{i.value=0},!0,ee.public,!0,"Direction NORD")),this.addAttribute(new ce("OST",C,i=>{i.value=1},!0,ee.public,!0,"Direction OST")),this.addAttribute(new ce("SÜD",C,i=>{i.value=2},!0,ee.public,!0,"Direction SÜD")),this.addAttribute(new ce("WEST",C,i=>{i.value=3},!0,ee.public,!0,"Direction WEST")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass);let t=e.typeStore.getType("JavaHamsterWorld");this.addMethod(new m("Hamster",new g([{identifier:"javaHamsterWorld",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"reihe",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"spalte",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"blickrichtung",type:C,declaration:null,usagePositions:null,isFinal:!0},{identifier:"anzahlKörner",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,i=>{let n=i[0].value,s=i[1].value,a=i[3].value,l=i[2].value,o=i[4].value,u=i[5].value;if(s==null){e.main.getInterpreter().throwException("Der Parameter javaHamsterWorld darf nicht null sein.");return}let h=new ic(s.intrinsicData.Actor,a,l,o,u);n.intrinsicData.Helper=h},!1,!1,"Instanziert ein neues Hamster-Objekt",!0)),this.addMethod(new m("vor",new g([]),U,i=>{let s=i[0].value.intrinsicData.Helper;s.testDestroyed("vor")||s.forward()},!1,!1,"Bewegt Hamster um ein Feld nach vorne.",!1)),this.addMethod(new m("getWorld",new g([]),t,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("getWorld"))return s.world.runtimeObject},!1,!1,"Gibt das JavaHamsterWorld-Objekt zurück, in dem sich Hamster befindet.",!1)),this.addMethod(new m("getBlickrichtung",new g([]),C,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("getBlickrichtung"))return s.direction},!1,!1,"Gibt die Blickrichtung von Hamster zurück: 0 == Norden, 1 == Osten, 2 == Süden, 3 == Westen",!1)),this.addMethod(new m("getReihe",new g([]),C,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("getReihe"))return s.y},!1,!1,"Gibt die Reihe zurück, in der sich der Hamster gerade befindet. Reihe 0 ist ganz oben.",!1)),this.addMethod(new m("getSpalte",new g([]),C,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("getSpalte"))return s.y},!1,!1,"Gibt die Spalte zurück, in der sich der Hamster gerade befindet. Reihe 0 ist ganz links.",!1)),this.addMethod(new m("getAnzahlKoerner",new g([]),C,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("getAnzahlKörner"))return s.grainCount},!1,!1,"Gibt die Anzahl der Körner zurück, die der Hamster gerade im Mund hat.",!1)),this.addMethod(new m("linksUm",new g([]),U,i=>{let s=i[0].value.intrinsicData.Helper;s.testDestroyed("linksUm")||s.turn(-1)},!1,!1,"Dreht Hamster um 90° nach links",!1)),this.addMethod(new m("gib",new g([]),U,i=>{let s=i[0].value.intrinsicData.Helper;s.testDestroyed("gib")||s.give()},!1,!1,"Der Hamster legt ein Korn in der Zelle ab, in der er sich gerade befindet.",!1)),this.addMethod(new m("nimm",new g([]),U,i=>{let s=i[0].value.intrinsicData.Helper;s.testDestroyed("nimm")||s.take()},!1,!1,"Der Hamster nimmt ein Korn aus der Zelle, in der er sich gerade befindet.",!1)),this.addMethod(new m("vornFrei",new g([]),P,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("vornFrei"))return s.nextCellFree()},!1,!1,"Liefert genau dann true, wenn sich in Blickrichtung vor dem aufgerufenen Hamster keine Mauer befindet (wenn sich der Hamster in Blickrichtung am Rand des Territoriums befindet, wird false geliefert)",!1)),this.addMethod(new m("maulLeer",new g([]),P,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("maulLeer"))return s.grainCount==0},!1,!1,"Liefert genau dann true, wenn der Hamster keine Körner im Mund hat.",!1)),this.addMethod(new m("kornDa",new g([]),P,i=>{let s=i[0].value.intrinsicData.Helper;if(!s.testDestroyed("kornDa"))return s.sitsOnGrain()},!1,!1,"Liefert genau dann true, wenn sich in der Zelle, auf der der Hamster sich befindet, mindestens ein Korn befindet.",!1)),this.addMethod(new m("schreib",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value;n.intrinsicData.Helper.testDestroyed("schreib")||(s.endsWith("\\n")||(s+=`
`),e.main.getInterpreter().printManager.print(s))},!1,!1,"Gibt den Text auf dem Bildschirm aus.",!1))}}const js=class js{constructor(e,t,i,n,s){y(this,"sprite");this.world=e,this.x=t,this.y=i,this.direction=n,this.grainCount=s;let l=yi.get("spritesheet").textures["Hamster#0"];l.baseTexture.scaleMode=0,this.sprite=new Wt(l),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.move(e.left+(t+.5)*e.cellWidth,e.top+(i+.5)*e.cellWidth),e.displayObject.addChild(this.sprite),this.direction=2,this.setDirection(n),e.hamsters.push(this)}writeBelowWorldText(){this.world.hamsters.length==1&&(this.world.belowWorldText.text=`Hamster: ${this.grainCount}, Zelle: ${this.world.getGrainCount(this.x,this.y)}`)}testDestroyed(e){return this.sprite.destroyed?(this.throwException("Die Methode "+e+" eines schon zerstörten Hamsters wurde aufgerufen."),!0):!1}destroy(){this.sprite.destroy()}forward(){let e=js.directions[this.direction],t=this.x+e.dx,i=this.y+e.dy;if(this.world.isOutside(t,i)){this.throwException(`Die neue Position (${t}, ${i}) ist außerhalb der Welt. Der Hamster kann daher nicht weitergehen.`);return}if(this.world.isWall(t,i)){this.throwException(`An der neuen Position (${t}, ${i}) befindet sich eine Mauer. Der Hamster kann daher nicht weitergehen.`);return}this.moveToCell(t,i),this.writeBelowWorldText()}turn(e){this.setDirection((this.direction+e+4)%4)}throwException(e){let t=this.world.worldHelper.interpreter;t.throwException(e),t.stop()}move(e,t){this.sprite.localTransform.translate(e,t),this.sprite.transform.onChange()}moveToCell(e,t){this.move((e-this.x)*this.world.cellWidth,(t-this.y)*this.world.cellWidth),this.x=e,this.y=t}setDirection(e){let t=(e-this.direction+4)%4,i=this.world.left+(this.x+.5)*this.world.cellWidth,n=this.world.top+(this.y+.5)*this.world.cellWidth;this.sprite.localTransform.translate(-i,-n),this.sprite.localTransform.rotate(t*Math.PI/2),this.sprite.localTransform.translate(i,n),this.sprite.transform.onChange(),this.direction=e}getPositionInDirection(e){let t=js.directions[(this.direction+e+4)%4];return{x:(this.x+t.dx+this.world.sizeX)%this.world.sizeX,y:(this.y+t.dy+this.world.sizeY)%this.world.sizeY}}setPosition(e,t){e<0&&(e=-e-1+this.world.sizeX),t<0&&(t=-t-1+this.world.sizeY),this.moveToCell(e%this.world.sizeX,t%this.world.sizeY)}give(){if(this.grainCount<=0){this.throwException("Der Hamster hat kein Korn mehr, das er ablegen könnte.");return}this.grainCount--,this.world.setGrain(this.x,this.y,this.world.getGrainCount(this.x,this.y)+1),this.writeBelowWorldText()}take(){if(this.world.getGrainCount(this.x,this.y)<=0){this.throwException("In der Zelle, in der sich der Hamster befindet, liegt kein Korn. Der Hamster kann daher keines nehmen.");return}this.grainCount++,this.world.setGrain(this.x,this.y,this.world.getGrainCount(this.x,this.y)-1),this.writeBelowWorldText()}nextCellFree(){let e=js.directions[this.direction],t=this.x+e.dx,i=this.y+e.dy;return this.world.isOutside(t,i)?!1:!this.world.isWall(t,i)}sitsOnGrain(){return this.world.getGrainCount(this.x,this.y)>0}};y(js,"directions",[{index:0,dx:0,dy:-1},{index:1,dx:1,dy:0},{index:2,dx:0,dy:1},{index:3,dx:-1,dy:0}]);let ic=js;class BP{constructor(e,t,i){y(this,"wallSprite");y(this,"grainSprite");y(this,"grainText");y(this,"grainCount",0);y(this,"_isWall",!1);this.world=e,this.x=t,this.y=i;let n=yi.get("spritesheet"),s=e.displayObject,a=e.left+(t+.5)*e.cellWidth,l=e.top+(i+.5)*e.cellWidth,o=n.textures["Hamster#1"];o.baseTexture.scaleMode=0,this.grainSprite=new Wt(o),this.move(a,l,this.grainSprite),this.grainSprite.anchor.x=.5,this.grainSprite.anchor.y=.5,s.addChild(this.grainSprite);let u=n.textures["Hamster#2"];u.baseTexture.scaleMode=0,this.wallSprite=new Wt(u),this.move(a,l,this.wallSprite),this.wallSprite.anchor.x=.5,this.wallSprite.anchor.y=.5,s.addChild(this.wallSprite),this.grainText=new jn("0",new Hi({fontFamily:"sans-serif",fontSize:24,fontStyle:"normal",fontWeight:"normal",fill:0,stroke:"#ffffff40",strokeThickness:2,align:"center"})),this.grainText.anchor.x=.5,this.grainText.anchor.y=.5,this.move(a,l,this.grainText),s.addChild(this.grainText),this.grainSprite.visible=!1,this.wallSprite.visible=!1,this.grainText.visible=!1}move(e,t,i){i.localTransform.translate(e,t),i.transform.onChange()}setGrainCount(e){this.grainSprite.visible=e>0,this.grainText.visible=e>0,this.grainText.text=""+e,this.grainCount=e}getGrainCount(){return this.grainCount}isWall(){return this._isWall}setWall(e){this._isWall=e,this.wallSprite.visible=e}destroy(){this.wallSprite.destroy(),this.grainSprite.destroy(),this.grainText.destroy()}}class zP extends ${constructor(e){super("GuiComponent",e,"Oberklasse für alle GUI-Komponenten"),this.setBaseClass(e.typeStore.getType("FilledShape")),this.isAbstract=!0;let t=e.typeStore.getType("ChangeListener");this.postConstructorCallbacks=[i=>{let n=i.class.getMethodBySignature("onChange(String)");(n==null?void 0:n.program)!=null&&(i.intrinsicData.onChange=n)}],this.addMethod(new m("getWidth",new g([]),A,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getWidth"))return s.getWidth()},!1,!1,"Gibt die Breite des Buttons zurück.",!1)),this.addMethod(new m("getHeight",new g([]),A,i=>{let s=i[0].value.intrinsicData.Actor;if(!s.testdestroyed("getHeight"))return s.getHeight()},!1,!1,"Gibt die Höhe des Buttons zurück.",!1)),this.addMethod(new m("addChangeListener",new g([{identifier:"changeListener",type:t,declaration:null,usagePositions:null,isFinal:!0}]),U,i=>{let n=i[0].value,s=i[1].value,a=n.intrinsicData.Actor;a.testdestroyed("addChangeListener")||a.addChangeListener(s)},!1,!1,"Fügt einen ChangeListener hinzu, dessen onChange-Methode immer dann aufgerufen wird, wenn sich der Wert der GUI-Komponente aufgrund von Benutzeraktionen ändert.",!1)),this.addMethod(new m("onChange",new g([{identifier:"newValue",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,()=>{},!1,!1,"Wird aufgerufen, wenn sich der Wert der GUI-Komponente aufgrund von Benutzeraktionen ändert.",!1))}}class jP extends vi{constructor(t,i,n,s){super(t,i);y(this,"height",0);y(this,"width",0);y(this,"changeListeners",[]);this.interpreter=t,this.runtimeObject=i,this.registerAsMouseListener=n,this.registerAsKeyboardListener=s,this.registerAsListener()}registerAsListener(){this.registerAsMouseListener&&this.worldHelper.internalMouseListeners.push(this),this.registerAsKeyboardListener&&this.worldHelper.internalKeyboardListeners.push(this)}unregisterAsListener(){let t=this.worldHelper.internalMouseListeners.indexOf(this);this.worldHelper.internalMouseListeners.splice(t,1);let i=this.worldHelper.internalKeyboardListeners.indexOf(this);this.worldHelper.internalKeyboardListeners.splice(i,1)}destroy(){this.unregisterAsListener(),super.destroy()}setVisible(t){super.setVisible(t),t?this.registerAsListener():this.unregisterAsListener()}moveTo(t,i){let n=new xe(0,0);this.displayObject.updateTransform(),this.displayObject.localTransform.apply(n,n),this.move(t-n.x,i-n.y)}getWidth(){return this.width}getHeight(){return this.height}addChangeListener(t){this.changeListeners.push(t)}onChange(t){let i=[],n=this.runtimeObject.intrinsicData.onChange;n!=null&&i.push({rto:this.runtimeObject,method:n});for(let a of this.changeListeners){let l=a.class.getMethodBySignature("onChange(Object, String)");l!=null&&i.push({rto:a,method:l})}let s=()=>{let a=i.pop();a.method.parameterlist.parameters.length==2?this.worldHelper.module.main.getInterpreter().runTimer(a.method,[{value:a.rto,type:this.runtimeObject.class},{value:this.runtimeObject,type:this.runtimeObject.class},{value:t,type:F}],()=>{i.length>0&&s()},!0):this.worldHelper.module.main.getInterpreter().runTimer(a.method,[{value:a.rto,type:this.runtimeObject.class},{value:t,type:F}],()=>{i.length>0&&s()},!0)};i.length>0&&s()}}class NP extends ${constructor(e){super("GuiTextComponent",e,"Abstrakte Oberklasse für alle Gui-Komponenten mit Textanteil"),this.setBaseClass(e.typeStore.getType("GuiComponent")),this.addMethod(new m("setFontsize",new g([{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setFontsize(n)},!1,!1,"Setzt die Schriftgröße des Textes (Einheit: Pixel).",!1)),this.addMethod(new m("setText",new g([{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.Actor.setText(n)},!1,!1,"Setzt den Text.",!1)),this.addMethod(new m("getFontSize",new g([]),A,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getFontSize"))return n.fontsize},!1,!1,"Gibt die Schriftgröße zurück.",!1)),this.addMethod(new m("getText",new g([]),F,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getText"))return n.text},!1,!1,"Gibt den Textinhalt zurück.",!1)),this.addMethod(new m("setStyle",new g([{identifier:"isBold",type:P,declaration:null,usagePositions:null,isFinal:!0},{identifier:"isItalic",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=i.intrinsicData.Actor;a.testdestroyed("setStyle")||a.setStyle(n,s)},!1,!1,"Setzt die Eigenschaften Fettdruck (bold) und Schrägschrift (italic).",!1)),this.addMethod(new m("setTextColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setTextColor")||s.setTextColor(n)},!1,!1,"Setzt die Textfarbe. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau",!1))}}class Ou extends jP{constructor(t,i,n,s,a,l,o){super(t,i,n,s);y(this,"pixiText");y(this,"textColor",16777215);y(this,"textHeight",10);y(this,"textWidth",10);y(this,"textStyle",new Hi({fontFamily:"Arial",fontSize:10,fontStyle:"normal",fontWeight:"normal",fill:16777215,stroke:0,strokeThickness:0,dropShadow:!1,wordWrap:!1,align:"center",lineJoin:"round"}));this.fontsize=a,this.text=l,this.fontFamily=o,this.fontsize==0&&(this.fontsize=10),this.textStyle.stroke=0,this.textStyle.fontSize=a,o!=null&&(this.textStyle.fontFamily=o)}setStyle(t,i){this.textStyle.fontWeight=t?"bold":"normal",this.textStyle.fontStyle=i?"italic":"normal",this.render()}textCompomentPrerender(){this.textStyle.fill=this.textColor==null?0:this.textColor,this.textStyle.stroke=0,this.textStyle.strokeThickness=0,this.textStyle.fontSize=this.fontsize}setFontsize(t){this.fontsize=t,this.fontsize==0&&(this.fontsize=10),this.render()}setText(t){this.text=t,this.render()}setTextColor(t){this.textColor=t,this.render()}}class GP extends ${constructor(e){super("TextField",e,"Text, der innerhalb der Grafikausgabe dargestellt werden kann"),this.setBaseClass(e.typeStore.getType("GuiTextComponent")),this.addMethod(new m("TextField",new g([]),null,t=>{let i=t[0].value,n=new ja(0,0,300,24,"Text",e.main.getInterpreter(),i);i.intrinsicData.Actor=n},!1,!1,"Instanziert ein neues TextField-Objekt.",!0)),this.addMethod(new m("TextField",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"caption",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new ja(n,s,a,l,o,e.main.getInterpreter(),i);i.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues TextField-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("TextField",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"caption",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"font-family",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=new ja(n,s,a,l,o,e.main.getInterpreter(),i,u);i.intrinsicData.Actor=h},!1,!1,"Instanziert ein neues Textobjekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des TextField-Objekts und git sie zurück.",!1)),this.addMethod(new m("setPadding",new g([{identifier:"padding",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setPadding")||(s.padding=n,s.render())},!1,!1,"Setzt den Innenabstand (padding) des Textes zum umgebenden Rechteck.",!1))}}class ja extends Ou{constructor(t,i,n,s,a,l,o,u){super(l,o,!0,!0,s,a,u);y(this,"backgroundGraphics");y(this,"mask");y(this,"keyboardFocusRect");y(this,"cursor");y(this,"selectionRectangle");y(this,"padding",8);y(this,"hasKeyboardFocus",!1);y(this,"characterStops",[]);y(this,"characterCenterList",[]);y(this,"isSelecting",!1);y(this,"selectionStart",0);y(this,"selectionEnd",0);y(this,"renderFromCharacterPosition",0);y(this,"timerId");y(this,"isMouseOver",!1);this.x=t,this.y=i,this.width=n,this.fontsize=s,this.fontFamily=u,this.centerXInitial=t,this.centerYInitial=i,this.borderColor=8421504,this.borderWidth=s/10,this.fillColor=16777215,this.textColor=0,this.hitPolygonInitial=[],this.generateCharacterStops(),this.render(),this.addToDefaultGroupAndSetDefaultVisibility(),this.initTimer()}initTimer(){let t=this;this.timerId=setInterval(()=>{t.cursor!=null&&!t.cursor.destroyed&&t.hasKeyboardFocus&&(t.cursor.visible=!t.cursor.visible)},500)}unregisterAsListener(){super.unregisterAsListener(),clearInterval(this.timerId)}getCopy(t){let i=new he(t),n=new ja(this.x,this.y,this.width,this.fontsize,this.text,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}render(){this.scrollIfNecessary(),this.textCompomentPrerender();let t=this.text;if(t.length==0?(t=this.text,this.textStyle.fill=4210752):t=this.text.substring(this.renderFromCharacterPosition),this.displayObject==null){this.backgroundGraphics=new gt,this.keyboardFocusRect=new gt,this.cursor=new gt,this.selectionRectangle=new gt,this.mask=new gt,this.pixiText=new jn(t,this.textStyle),this.displayObject=new Rt,this.displayObject.localTransform.translate(this.x+this.padding,this.y+this.padding),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(this.displayObject);let a=this.displayObject;a.addChild(this.mask),a.addChild(this.backgroundGraphics),a.addChild(this.keyboardFocusRect),a.addChild(this.selectionRectangle),a.addChild(this.pixiText),a.addChild(this.cursor),this.pixiText.mask=this.mask,this.selectionRectangle.mask=this.mask}else this.pixiText.text=t,this.backgroundGraphics.clear(),this.mask.clear(),this.keyboardFocusRect.clear(),this.selectionRectangle.clear(),this.cursor.clear(),this.pixiText.alpha=this.fillAlpha,this.pixiText.anchor.x=0,this.textStyle.align=this.alignment,this.pixiText.style=this.textStyle;this.centerXInitial=0,this.centerYInitial=0;let i=0;if(this.text!=null){let a=Ct.measureText(this.text,this.textStyle);i=this.width,this.height=a.height,a.fontProperties.ascent,this.centerXInitial=i/2,this.centerYInitial=this.height/2}let n=0-this.pixiText.anchor.x*i,s=0-this.pixiText.anchor.y*this.height;if(this.hitPolygonInitial=[{x:n,y:s},{x:n,y:s+this.height},{x:n+i,y:s+this.height},{x:n+i,y:s}],this.hitPolygonDirty=!0,-this.padding,-this.padding,this.mask.beginFill(0),this.mask.drawRect(0,0,this.width-2*this.padding,this.height),this.mask.endFill(),this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,.5),this.backgroundGraphics.drawRoundedRect(-this.padding,-this.padding,this.width,this.height+2*this.padding,this.fontsize/8),this.fillColor!=null&&this.backgroundGraphics.endFill(),this.selectionEnd!=this.selectionStart){this.selectionRectangle.beginFill(8421631,.5);let a=this.characterStops[this.selectionStart]-this.characterStops[this.renderFromCharacterPosition],l=this.characterStops[this.selectionEnd]-this.characterStops[this.renderFromCharacterPosition];if(l<a){let o=l;l=a,a=o}this.selectionRectangle.drawRoundedRect(a,0,l-a,this.height,this.fontsize/8),this.selectionRectangle.endFill()}this.renderCursor(),this.keyboardFocusRect.lineStyle(this.borderWidth,8388608,1,.5),this.keyboardFocusRect.drawRect(-this.padding,-this.padding,this.width,this.height+2*this.padding),this.keyboardFocusRect.closePath(),this.keyboardFocusRect.visible=this.hasKeyboardFocus}renderCursor(){this.cursor.clear();let t=Math.min(2,this.fontsize/10);this.cursor.lineStyle(t,0,1,.5);let i=this.characterStops[this.selectionEnd]-this.characterStops[this.renderFromCharacterPosition],n=new xe(i,0),s=new xe(i,this.height);this.cursor.moveTo(n.x,n.y).lineTo(s.x,s.y),this.cursor.visible=this.hasKeyboardFocus}getLocalCoordinates(t,i){let n=new xe(t*this.worldHelper.globalScale,i*this.worldHelper.globalScale);return this.displayObject.worldTransform.applyInverse(n,n),n}onMouseEvent(t,i,n){let s=this.containsPoint(i,n);switch(t){case"mousedown":s?(this.gainKeyboardFocus(),this.startSelecting(i,n)):this.looseKeyboardFocus();break;case"mouseup":this.stopSelecting();break;case"mouseleave":this.stopSelecting(),this.isMouseOver=!1,this.worldHelper.setCursor("default");break;case"mousemove":{if(this.isSelecting){let a=this.getLocalCoordinates(i,n);this.selectionEnd=this.getCharacterPosition(a.x),this.render()}this.isMouseOver!=s&&(this.isMouseOver=s,this.worldHelper.setCursor(s?"pointer":"default"))}break}}generateCharacterStops(){this.characterStops=[0];for(let t=1;t<=this.text.length;t++){let i=this.text.substring(0,t),n=Ct.measureText(i,this.textStyle);this.characterStops.push(n.width)}this.characterCenterList=[];for(let t=0;t<this.characterStops.length-1;t++)this.characterCenterList.push((this.characterStops[t]+this.characterStops[t+1])/2)}startSelecting(t,i){this.isSelecting=!0;let n=this.getLocalCoordinates(t,i);this.selectionStart=this.getCharacterPosition(n.x),this.selectionEnd=this.selectionStart,this.render()}stopSelecting(){this.isSelecting=!1}deleteSelected(){this.selectionEnd!=this.selectionStart&&(this.adjustSelectStartLowerSelectEnd(),this.text=this.text.substring(0,this.selectionStart)+this.text.substring(this.selectionEnd),this.selectionEnd=this.selectionStart,this.isSelecting=!1)}adjustSelectStartLowerSelectEnd(){if(this.selectionEnd<this.selectionStart){let t=this.selectionEnd;this.selectionEnd=this.selectionStart,this.selectionStart=t}}onKeyDown(t,i,n,s){if(!this.hasKeyboardFocus)return;this.isSelecting=!1;let a=this;if(n&&t=="c")this.adjustSelectStartLowerSelectEnd(),Aw(this.text.substring(this.selectionStart,this.selectionEnd));else if(n&&t=="v")navigator.clipboard.readText().then(l=>{a.deleteSelected(),a.text=a.text.substring(0,a.selectionEnd)+l+a.text.substring(a.selectionEnd),a.selectionEnd+=l.length,a.selectionStart=a.selectionEnd,a.generateCharacterStops(),a.render(),this.onChange(this.text)});else if(t.length==1)this.deleteSelected(),this.text=this.text.substring(0,this.selectionEnd)+t+this.text.substring(this.selectionEnd),this.selectionEnd++,this.selectionStart=this.selectionEnd,this.generateCharacterStops(),this.render(),this.onChange(this.text);else switch(t){case"ArrowRight":this.selectionEnd=Math.min(this.selectionEnd+1,this.text.length),i||(this.selectionStart=this.selectionEnd),this.render();break;case"ArrowLeft":this.selectionEnd=Math.max(this.selectionEnd-1,0),i||(this.selectionStart=this.selectionEnd),this.render();break;case"Delete":this.selectionStart!=this.selectionEnd?this.deleteSelected():this.selectionEnd<this.text.length&&(this.text=this.text.substring(0,this.selectionEnd)+this.text.substring(this.selectionEnd+1)),this.generateCharacterStops(),this.render(),this.onChange(this.text);break;case"Backspace":this.selectionStart!=this.selectionEnd?this.deleteSelected():this.selectionEnd>0&&(this.text=this.text.substring(0,this.selectionEnd-1)+this.text.substring(this.selectionEnd),this.selectionEnd--,this.selectionStart=this.selectionEnd),this.generateCharacterStops(),this.render(),this.onChange(this.text);break;case"Insert":break;case"Home":this.selectionStart=0,this.selectionEnd=0,this.render();break;case"End":this.selectionStart=this.text.length,this.selectionEnd=this.text.length,this.render();break;default:console.log(t);break}}scrollIfNecessary(){let t=this.getCursorXFromCharacterPos(this.selectionEnd),i=!1;for(;t<0&&this.renderFromCharacterPosition>0;)this.renderFromCharacterPosition--,t=this.getCursorXFromCharacterPos(this.selectionEnd),i=!0;for(;t>this.width-2*this.padding&&this.renderFromCharacterPosition<this.text.length;)this.renderFromCharacterPosition++,t=this.getCursorXFromCharacterPos(this.selectionEnd),i=!0;return i}getCursorXFromCharacterPos(t){return this.characterStops[t]-this.characterStops[this.renderFromCharacterPosition]}gainKeyboardFocus(){for(let t of this.worldHelper.internalKeyboardListeners)t!=this&&t.looseKeyboardFocus();this.hasKeyboardFocus=!0,this.keyboardFocusRect.visible=!0,this.cursor.visible=!0}looseKeyboardFocus(){this.hasKeyboardFocus=!1,this.keyboardFocusRect.visible=!1,this.cursor.visible=!1}getCharacterPosition(t){if(this.characterCenterList.length==0)return 0;for(let i=0;i<this.characterCenterList.length;i++)if(t<=this.characterCenterList[i]-this.characterStops[this.renderFromCharacterPosition])return i;return this.characterCenterList.length}}class WP extends ${constructor(e){super("CheckBox",e,"Checkbox, die innerhalb der Grafikausgabe dargestellt werden kann"),this.setBaseClass(e.typeStore.getType("GuiTextComponent")),this.addMethod(new m("CheckBox",new g([]),null,t=>{let i=t[0].value,n=new Bs(0,0,300,24,"Text",e.main.getInterpreter(),i,!1);i.intrinsicData.Actor=n},!1,!1,"Instanziert ein neues CheckBox-Objekt.",!0)),this.addMethod(new m("CheckBox",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new Bs(n,s,a,l,o,e.main.getInterpreter(),i,!1);i.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues CheckBox-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("CheckBox",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"checked",type:P,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=new Bs(n,s,a,l,o,e.main.getInterpreter(),i,u);i.intrinsicData.Actor=h},!1,!1,"Instanziert ein neues CheckBox-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("CheckBox",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"font-family",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=new Bs(n,s,a,l,o,e.main.getInterpreter(),i,!1,u);i.intrinsicData.Actor=h},!1,!1,"Instanziert ein neues Textobjekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des CheckBox-Objekts und git sie zurück.",!1)),this.addMethod(new m("setCrossColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setCrossColor")||s.setCrossColor(n)},!1,!1,"Setzt die Farbe des Kreuzchens. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau",!1)),this.addMethod(new m("setChecked",new g([{identifier:"checked",type:P,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setChecked")||s.setChecked(n)},!1,!1,"Setzt den Zustand der Checkbox: angekreuzt bzw. nicht angekreuzt",!1)),this.addMethod(new m("isChecked",new g([]),P,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("isChecked"))return n.isChecked},!1,!1,"Gibt genau dann true zurück, falls die Checkbox angekreuzt ist.",!1))}}class Bs extends Ou{constructor(t,i,n,s,a,l,o,u,h){super(l,o,!0,!1,s,a,h);y(this,"backgroundGraphics");y(this,"cross");y(this,"distanceToText",4);y(this,"crossColor",0);y(this,"isChecked",!0);y(this,"mouseIsDown",!1);y(this,"isMouseOver",!1);this.x=t,this.y=i,this.checkboxWidth=n,this.fontsize=s,this.text=a,this.fontFamily=h,this.isChecked=u,this.centerXInitial=t,this.centerYInitial=i,this.fontsize==0&&(this.fontsize=10),this.borderColor=8421504,this.borderWidth=n/10,this.fillColor=16777215,this.textStyle.stroke=0,this.textStyle.fontSize=s,h!=null&&(this.textStyle.fontFamily=h),this.hitPolygonInitial=[],this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}onKeyDown(t,i,n,s){}looseKeyboardFocus(){}setCrossColor(t){this.crossColor=t,this.render()}getCopy(t){let i=new he(t),n=new Bs(this.x,this.y,this.checkboxWidth,this.fontsize,this.text,this.worldHelper.interpreter,i,this.isChecked);return i.intrinsicData.Actor=n,n.copyFrom(this),n.render(),i}render(){if(this.textCompomentPrerender(),this.displayObject==null){this.backgroundGraphics=new gt,this.cross=new gt,this.pixiText=new jn(this.text,this.textStyle),this.pixiText.x=this.checkboxWidth+this.distanceToText,this.pixiText.y=0,this.displayObject=new Rt,this.displayObject.localTransform.translate(this.x,this.y),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(this.displayObject);let u=this.displayObject;u.addChild(this.backgroundGraphics),u.addChild(this.pixiText),u.addChild(this.cross)}else this.pixiText.text=this.text,this.backgroundGraphics.clear(),this.cross.clear(),this.pixiText.alpha=this.fillAlpha,this.pixiText.anchor.x=0,this.textStyle.align=this.alignment,this.pixiText.style=this.textStyle;this.centerXInitial=0,this.centerYInitial=0;let t=0;if(this.text!=null){let u=Ct.measureText(this.text,this.textStyle);this.textWidth=u.width,this.textHeight=u.height,u.fontProperties.ascent,t=(this.checkboxWidth-this.textHeight)/2,this.distanceToText=u.fontProperties.descent*3,this.pixiText.localTransform.identity(),this.pixiText.localTransform.translate(this.checkboxWidth+this.distanceToText,t),this.pixiText.transform.onChange(),this.centerXInitial=(this.checkboxWidth+this.textWidth+this.distanceToText)/2,this.centerYInitial=this.checkboxWidth/2}let i=0,n=0,s=n+this.checkboxWidth-t,a=this.textWidth+this.checkboxWidth+this.distanceToText;this.width=a,this.height=Math.max(this.checkboxWidth,this.textHeight),this.hitPolygonInitial=[{x:i,y:n},{x:i+this.checkboxWidth,y:n},{x:i+this.checkboxWidth+this.distanceToText,y:t},{x:i+a,y:t},{x:i+a,y:s},{x:i+this.checkboxWidth+this.distanceToText,y:s},{x:i+this.checkboxWidth,y:n+this.checkboxWidth},{x:i,y:n+this.checkboxWidth}],this.hitPolygonDirty=!0,this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,1),this.backgroundGraphics.drawRoundedRect(0,0,this.checkboxWidth,this.checkboxWidth,this.checkboxWidth/8),this.fillColor!=null&&this.backgroundGraphics.endFill();let l=3,o=this.borderWidth*l;this.cross.lineStyle({width:this.borderWidth*2,color:this.crossColor,alpha:this.fillAlpha,alignment:.5,cap:mr.ROUND}),this.cross.moveTo(o,o),this.cross.lineTo(this.checkboxWidth-o,this.checkboxWidth-o),this.cross.moveTo(this.checkboxWidth-o,o),this.cross.lineTo(o,this.checkboxWidth-o),this.cross.visible=this.isChecked}getLocalCoordinates(t,i){let n=new xe(t*this.worldHelper.globalScale,i*this.worldHelper.globalScale);return this.displayObject.worldTransform.applyInverse(n,n),n}setChecked(t){this.isChecked=t,this.render()}onMouseEvent(t,i,n){let s=this.containsPoint(i,n);switch(t){case"mousedown":s&&(this.mouseIsDown=!0);break;case"mouseup":s&&this.mouseIsDown&&(this.isChecked=!this.isChecked,this.render()),this.mouseIsDown=!1;break;case"mouseleave":this.isMouseOver=!1,this.worldHelper.setCursor("default");break;case"mousemove":this.isMouseOver!=s&&(this.isMouseOver=s,this.worldHelper.setCursor(s?"pointer":"default"))}}}class HP extends ${constructor(e){super("RadioButton",e,"RadioButton, der innerhalb der Grafikausgabe dargestellt werden kann"),this.setBaseClass(e.typeStore.getType("GuiTextComponent")),this.addMethod(new m("RadioButton",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=new su(n,s,a,l,o,u,e.main.getInterpreter(),i);i.intrinsicData.Actor=h},!1,!1,"Instanziert ein neues RadioButton-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("RadioButton",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"width",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"font-family",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=t[6].value,h=t[7].value,d=new su(n,s,a,l,o,h,e.main.getInterpreter(),i,u);i.intrinsicData.Actor=d},!1,!1,"Instanziert ein neues Textobjekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des RadioButton-Objekts und git sie zurück.",!1)),this.addMethod(new m("getIndex",new g([]),C,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getIndex"))return n.index},!1,!1,"Gibt den Index des Radiobuttons zurück.",!1)),this.addMethod(new m("getIndexOfSelectedRadiobutton",new g([]),C,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getIndexOfSelectedRadiobutton"))return n.getIndexOfSelectedRadiobutton()},!1,!1,"Sind mehrere Radiobuttons mittels connectTo mit dieserm logisch verbunden, so ist genau einer davon selektiert. Diese Methode gibt den Index dieses selektierten Radiobuttons zurück.",!1)),this.addMethod(new m("getTextOfSelectedRadiobutton",new g([]),F,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("getTextOfSelectedRadiobutton"))return n.getTextOfSelectedRadiobutton()},!1,!1,"Sind mehrere Radiobuttons mittels connectTo mit dieserm logisch verbunden, so ist genau einer davon selektiert. Diese Methode gibt den Text dieses selektierten Radiobuttons zurück.",!1)),this.addMethod(new m("setIndex",new g([{identifier:"index",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setIndex")||(s.index=n)},!1,!1,"Setzt den Index des Radiobuttons.",!1)),this.addMethod(new m("setDotColor",new g([{identifier:"color",type:C,declaration:null,usagePositions:null,isFinal:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;s.testdestroyed("setDotColor")||s.setDotColor(n)},!1,!1,"Setzt die Farbe des Kreuzchens. Die Farbe wird als int-Wert gegeben, wobei farbe == 256*256*rot + 256*grün + blau",!1)),this.addMethod(new m("connectTo",new g([{identifier:"other_radiobuttons",type:new ze(this),declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!0}]),U,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.Actor;if(s.testdestroyed("connectTo"))return;let a=n.map(l=>l.value.intrinsicData.Actor);a.push(s),a=a.concat(s.otherButtons);for(let l of a)l.connectTo(a);s.setSelected(),s.render();for(let l of s.otherButtons)l.render()},!1,!1,"Verbindet diesen Radiobutton logisch mit den anderen Radiobuttons. Wird anschließend auf einen davon geklickt, so wird dieser selektiert, die anderen deselektiert.",!1)),this.addMethod(new m("isSelected",new g([]),U,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("isSelected"))return n.isSelected},!1,!1,"Gibt genau dann true zurück, falls die RadioButton selektiert ist.",!1)),this.addMethod(new m("select",new g([]),U,t=>{let n=t[0].value.intrinsicData.Actor;if(!n.testdestroyed("select"))return n.setSelected()},!1,!1,"Selektiert diesen Radiobutton und deselektiert alle via connectTo mit ihm verbundenen Radiobuttons.",!1))}}class su extends Ou{constructor(t,i,n,s,a,l,o,u,h){super(o,u,!0,!1,s,a,h);y(this,"backgroundGraphics");y(this,"dot");y(this,"distanceToText",4);y(this,"dotColor",0);y(this,"isSelected",!0);y(this,"mouseIsDown",!1);y(this,"isMouseOver",!1);y(this,"otherButtons",[]);this.x=t,this.y=i,this.radiobuttonWidth=n,this.fontsize=s,this.text=a,this.index=l,this.fontFamily=h,this.centerXInitial=t,this.centerYInitial=i,this.fontsize==0&&(this.fontsize=10),this.borderColor=8421504,this.borderWidth=s/8,this.fillColor=16777215,this.textStyle.stroke=0,this.textStyle.fontSize=s,h!=null&&(this.textStyle.fontFamily=h),this.hitPolygonInitial=[],this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}onKeyDown(t,i,n,s){}looseKeyboardFocus(){}getIndexOfSelectedRadiobutton(){if(this.isSelected)return this.index;for(let t of this.otherButtons)if(t.isSelected)return t.index;return-1}getTextOfSelectedRadiobutton(){if(this.isSelected)return this.text;for(let t of this.otherButtons)if(t.isSelected)return t.text;return""}setSelected(){this.isSelected=!0,this.render();for(let t of this.otherButtons)t.isSelected=!1,t.render()}connectTo(t){for(let i of t)this.otherButtons.indexOf(i)<=0&&i!=this&&this.otherButtons.push(i)}setDotColor(t){this.dotColor=t,this.render()}getCopy(t){let i=new he(t),n=new su(this.x,this.y,this.radiobuttonWidth,this.fontsize,this.text,this.index,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.dotColor=this.dotColor,n.textColor=this.textColor,n.distanceToText=this.distanceToText,n.isSelected=this.isSelected,n.text=this.text,n.index=this.index++,n.copyFrom(this),n.render(),i}render(){if(this.textCompomentPrerender(),this.displayObject==null){this.backgroundGraphics=new gt,this.dot=new gt,this.pixiText=new jn(this.text,this.textStyle),this.pixiText.x=this.radiobuttonWidth+this.distanceToText,this.pixiText.y=0,this.displayObject=new Rt,this.displayObject.localTransform.translate(this.x,this.y),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(this.displayObject);let l=this.displayObject;l.addChild(this.backgroundGraphics),l.addChild(this.pixiText),l.addChild(this.dot)}else this.pixiText.text=this.text,this.backgroundGraphics.clear(),this.dot.clear(),this.pixiText.alpha=this.fillAlpha,this.pixiText.anchor.x=0,this.pixiText.style=this.textStyle;this.centerXInitial=0,this.centerYInitial=0;let t=0;if(this.text!=null){let l=Ct.measureText(this.text,this.textStyle);this.textWidth=l.width,this.textHeight=l.height,l.fontProperties.ascent,t=(this.radiobuttonWidth-this.textHeight)/2,this.distanceToText=l.fontProperties.descent*3,this.pixiText.localTransform.identity(),this.pixiText.localTransform.translate(this.radiobuttonWidth+this.distanceToText,t),this.pixiText.transform.onChange(),this.centerXInitial=(this.radiobuttonWidth+this.textWidth+this.distanceToText)/2,this.centerYInitial=this.radiobuttonWidth/2}let i=0,n=0,s=n+this.radiobuttonWidth-t,a=this.textWidth+this.radiobuttonWidth+this.distanceToText;this.width=a,this.height=Math.max(this.textHeight,this.radiobuttonWidth),this.hitPolygonInitial=[{x:i,y:n},{x:i+this.radiobuttonWidth,y:n},{x:i+this.radiobuttonWidth+this.distanceToText,y:t},{x:i+a,y:t},{x:i+a,y:s},{x:i+this.radiobuttonWidth+this.distanceToText,y:s},{x:i+this.radiobuttonWidth,y:n+this.radiobuttonWidth},{x:i,y:n+this.radiobuttonWidth}],this.hitPolygonDirty=!0,this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,1),this.backgroundGraphics.drawCircle(this.radiobuttonWidth/2,this.radiobuttonWidth/2,this.radiobuttonWidth/2),this.fillColor!=null&&this.backgroundGraphics.endFill(),this.dot.beginFill(this.dotColor,this.fillAlpha),this.dot.drawCircle(this.radiobuttonWidth/2,this.radiobuttonWidth/2,this.radiobuttonWidth/6),this.dot.visible=this.isSelected}getLocalCoordinates(t,i){let n=new xe(t*this.worldHelper.globalScale,i*this.worldHelper.globalScale);return this.displayObject.worldTransform.applyInverse(n,n),n}onMouseEvent(t,i,n){let s=this.containsPoint(i,n);switch(t){case"mousedown":s&&(this.mouseIsDown=!0);break;case"mouseup":s&&this.mouseIsDown&&(this.setSelected(),this.onChange(""+this.index)),this.mouseIsDown=!1;break;case"mouseleave":this.isMouseOver=!1,this.worldHelper.setCursor("default");break;case"mousemove":this.isMouseOver!=s&&(this.isMouseOver=s,this.worldHelper.setCursor(s?"pointer":"default"))}}}class UP extends ${constructor(e){super("Button",e,"Button, der innerhalb der Grafikausgabe dargestellt werden kann"),this.setBaseClass(e.typeStore.getType("GuiTextComponent")),this.addMethod(new m("Button",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=new au(n,s,a,l,e.main.getInterpreter(),i);i.intrinsicData.Actor=o},!1,!1,"Instanziert ein neues Button-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("Button",new g([{identifier:"x",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"y",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"fontsize",type:A,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"font-family",type:F,declaration:null,usagePositions:null,isFinal:!0}]),null,t=>{let i=t[0].value,n=t[1].value,s=t[2].value,a=t[3].value,l=t[4].value,o=t[5].value,u=new au(n,s,a,l,e.main.getInterpreter(),i,o);i.intrinsicData.Actor=u},!1,!1,"Instanziert ein neues Button-Objekt. (x, y) sind die Koordinaten der linken oberen Ecke, fontsize die Höhe des Textes in Pixeln.",!0)),this.addMethod(new m("copy",new g([]),this,t=>{let i=t[0].value,n=i.intrinsicData.Actor;if(!n.testdestroyed("copy"))return n.getCopy(i.class)},!1,!1,"Erstellt eine Kopie des Button-Objekts und git sie zurück.",!1))}}class au extends Ou{constructor(t,i,n,s,a,l,o){super(a,l,!0,!1,n,s,o);y(this,"backgroundGraphics");y(this,"higlightGraphics");y(this,"mouseIsDown",!1);y(this,"isMouseOver",!1);this.x=t,this.y=i,this.fontsize=n,this.text=s,this.fontFamily=o,this.centerXInitial=t,this.centerYInitial=i,this.borderColor=8421504,this.borderWidth=n/8,this.fillColor=255,this.hitPolygonInitial=[],this.render(),this.addToDefaultGroupAndSetDefaultVisibility()}onKeyDown(t,i,n,s){}looseKeyboardFocus(){}getCopy(t){let i=new he(t),n=new au(this.x,this.y,this.fontsize,this.text,this.worldHelper.interpreter,i);return i.intrinsicData.Actor=n,n.textColor=this.textColor,n.text=this.text,n.copyFrom(this),n.render(),i}render(){this.textCompomentPrerender();let t=this.fontsize/5;if(this.displayObject==null){this.backgroundGraphics=new gt,this.higlightGraphics=new gt,this.pixiText=new jn(this.text,this.textStyle),this.displayObject=new Rt,this.displayObject.localTransform.translate(this.x,this.y),this.displayObject.transform.onChange(),this.worldHelper.stage.addChild(this.displayObject);let a=this.displayObject;a.addChild(this.higlightGraphics),a.addChild(this.backgroundGraphics),a.addChild(this.pixiText)}else this.pixiText.text=this.text,this.backgroundGraphics.clear(),this.higlightGraphics.clear(),this.pixiText.alpha=this.fillAlpha,this.pixiText.anchor.x=0,this.pixiText.style=this.textStyle;if(this.centerXInitial=0,this.centerYInitial=0,this.text!=null){let a=Ct.measureText(this.text,this.textStyle);this.textWidth=a.width,this.textHeight=a.height,this.pixiText.localTransform.identity(),this.pixiText.localTransform.translate(t,t),this.pixiText.transform.onChange(),this.centerXInitial=this.textWidth/2+t,this.centerYInitial=this.textHeight/2+t}let i=0,n=0;this.width=this.textWidth+2*t,this.height=this.textHeight+2*t,this.hitPolygonInitial=[{x:i,y:n},{x:i+this.width,y:n},{x:i+this.width,y:n+this.height},{x:i,y:n+this.height}],this.hitPolygonDirty=!0,this.fillColor!=null&&this.backgroundGraphics.beginFill(this.fillColor,this.fillAlpha),this.borderColor!=null&&this.backgroundGraphics.lineStyle(this.borderWidth,this.borderColor,this.borderAlpha,1),this.backgroundGraphics.drawRoundedRect(0,0,this.width,this.height,this.height/8),this.fillColor!=null&&this.backgroundGraphics.endFill();let s=this.height/10+this.borderWidth;this.higlightGraphics.beginFill(Mw(this.fillColor,.4),1),this.higlightGraphics.drawRoundedRect(-s,-s,this.width+2*s,this.height+2*s,this.height/4),this.fillColor!=null&&this.higlightGraphics.endFill(),this.higlightGraphics.visible=this.mouseIsDown}onMouseEvent(t,i,n){let s=this.containsPoint(i,n);switch(t){case"mousedown":s&&(this.mouseIsDown=!0,this.higlightGraphics.visible=!0);break;case"mouseup":s&&this.mouseIsDown&&(this.higlightGraphics.visible=!1,this.onChange("clicked")),this.mouseIsDown=!1;break;case"mouseleave":this.isMouseOver=!1,this.worldHelper.setCursor("default");break;case"mousemove":this.isMouseOver!=s&&(this.isMouseOver=s,this.worldHelper.setCursor(s?"pointer":"default"))}}}class VP extends ${constructor(e){super("Files",e,"Klasse mit statischen Methoden zum Lesen/Schreiben von Dateien."),this.setBaseClass(e.typeStore.getType("Object")),this.staticClass.setupAttributeIndicesRecursive(),this.staticClass.classObject=new he(this.staticClass),this.addMethod(new m("read",new g([{identifier:"workspaceFilename",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{let i=t[1].value,n=e.main.getCurrentWorkspace().moduleStore.getModule(i),s=e.main.getInterpreter();if(n==null){s.throwException("Die Datei mit dem angegebenen Namen '"+i+"' gibt es nicht.");return}return n.getProgramTextFromMonacoModel()},!1,!0,"Gibt den Inhalt der Workspacedatei zurück.")),this.addMethod(new m("write",new g([{identifier:"workspaceFilename",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{let i=t[1].value,n=t[2].value,s=e.main.getCurrentWorkspace().moduleStore.getModule(i),a=e.main.getInterpreter();if(s==null){a.throwException("Die Datei mit dem angegebenen Namen '"+i+"' gibt es nicht.");return}if(n.length>2e5){a.throwException("Der Text ist zu lang (> 200 000 Zeichen).");return}s.file.text=n,s.model.setValue(n),s.file.saved=!1},!1,!0,"Schreibt den Text in die Workspacedatei.")),this.addMethod(new m("append",new g([{identifier:"workspaceFilename",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"text",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{let i=t[1].value,n=t[2].value,s=e.main.getCurrentWorkspace().moduleStore.getModule(i),a=e.main.getInterpreter();if(s==null){a.throwException("Die Datei mit dem angegebenen Namen '"+i+"' gibt es nicht.");return}if(n.length+s.file.text.length>2e5){a.throwException("Der Text ist zu lang (> 200 000 Zeichen).");return}s.file.text+=n,s.model.setValue(s.file.text),s.file.saved=!1},!1,!0,"Fügt den Text zur Workspacedatei hinzu."))}}class $P extends ${constructor(e){super("HttpHeader",e,"Speichert key und value eines Http-Headers."),this.setBaseClass(e.typeStore.getType("Object")),this.addAttribute(new ce("key",F,t=>{let i=t.object;t.value=i.intrinsicData.key},!1,ee.public,!0,"Schlüssel (key) des Http-Headers")),this.addAttribute(new ce("value",F,t=>{let i=t.object;t.value=i.intrinsicData.value},!1,ee.public,!0,"Wert (value) des Http-Headers")),this.setupAttributeIndicesRecursive()}}class XP extends ${constructor(e){super("HttpRequest",e,"Ein Objekt der Klasse HttpRequest umfasst die URI, den Header und die Daten eines Http-Requests."),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("HttpRequest",new g([]),null,t=>{var a,l;let i=t[0].value,n=(l=(a=this.module)==null?void 0:a.main)==null?void 0:l.getInterpreter(),s=new KP(i,n);i.intrinsicData.Helper=s},!1,!1,"Instanziert ein neues HttpRequest-Objekt.",!0)),this.addMethod(new m("uri",new g([{identifier:"uri",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>{let i=t[0].value,n=t[1].value;return i.intrinsicData.Helper.setUri(n),i},!1,!1,"Legt die URI des Requests fest.",!1)),this.addMethod(new m("header",new g([{identifier:"key",type:F,declaration:null,usagePositions:null,isFinal:!0},{identifier:"value",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>{let i=t[0].value,n=t[1].value,s=t[2].value;return i.intrinsicData.Helper.header(n,s),i},!1,!1,"Fügt dem Request einen Header hinzu.",!1)),this.addMethod(new m("POST",new g([{identifier:"data",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,t=>{let i=t[0].value,n=t[1].value;return i.intrinsicData.Helper.post(n),i},!1,!1,"Setzt die Request-Methode auf POST und fügt dem Request die übergebenen Daten hinzu.",!1)),this.addMethod(new m("GET",new g([]),this,t=>{let i=t[0].value;return t[1].value,i.intrinsicData.Helper.get(),i},!1,!1,"Setzt die Request-Methode auf GET.",!1))}}class KP{constructor(e,t){y(this,"headers",[]);y(this,"uri");y(this,"postData");y(this,"method","GET");this.runtimeObject=e,this.interpreter=t}get(){this.method="GET"}post(e){this.method="POST",this.postData=e}header(e,t){this.headers.push({key:e,value:t})}setUri(e){this.uri=e}}class qP extends ${constructor(e){super("HttpResponse",e,"Ein Objekt der Klasse HttpResponse umfasst den Statuscode, die Header und den Body (d.h. die Daten) eines http-Response."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("HttpRequest"),i=e.typeStore.getType("HttpHeader");this.addMethod(new m("uri",new g([]),F,n=>n[0].value.intrinsicData.Helper.getUri(),!1,!1,"Gibt die URI des Responses zurück.",!1)),this.addMethod(new m("body",new g([]),F,n=>n[0].value.intrinsicData.Helper.getBody(),!1,!1,"Gibt den Body dieses Responses zurück.",!1)),this.addMethod(new m("statusCode",new g([]),C,n=>n[0].value.intrinsicData.Helper.getStatusCode(),!1,!1,"Gibt den den http-Status dieses Responses zurück.",!1)),this.addMethod(new m("statusText",new g([]),C,n=>n[0].value.intrinsicData.Helper.getStatusText(),!1,!1,"Gibt den den http-Status dieses Responses in Textform zurück.",!1)),this.addMethod(new m("request",new g([]),t,n=>n[0].value.intrinsicData.Helper.request,!1,!1,"Gibt das Request-Objekt zurück, das diesen Response zur Folge hatte.",!1)),this.addMethod(new m("headers",new g([]),new ze(i),n=>{let a=n[0].value.intrinsicData.Helper,l=[];for(let o of a.headers){let u=new he(i);u.intrinsicData.key=o.key,u.intrinsicData.value=o.value,l.push({type:i,value:u})}return l},!1,!1,"Gibt die Header dieses Responses zurück.",!1))}}class YP{constructor(e,t,i,n){y(this,"headers",[]);this.runtimeObject=e,this.request=t,this.response=i,this.body=n,i.headers.forEach((s,a)=>this.headers.push({key:a,value:s}))}getUri(){return this.response.url}getBody(){return this.body}getStatusCode(){return this.response.status}getStatusText(){return this.response.statusText}}class ZP extends ${constructor(e){super("HttpClient",e,"Ein Objekt der Klasse HttpClient kann Http-Requests senden."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("HttpRequest"),i=e.typeStore.getType("HttpResponse");this.addMethod(new m("HttpClient",new g([]),null,n=>{var o,u;let s=n[0].value,a=(u=(o=this.module)==null?void 0:o.main)==null?void 0:u.getInterpreter(),l=new JP(s,a,i);s.intrinsicData.Helper=l},!1,!1,"Instanziert ein neues HttpClient-Objekt.",!0)),this.addMethod(new m("send",new g([{identifier:"request",type:t,declaration:null,usagePositions:null,isFinal:!0}]),i,n=>{let s=n[0].value,a=n[1].value,l=s.intrinsicData.Helper,o=a.intrinsicData.Helper;return l.send(o,a)},!1,!1,"Sendet den Request an den Server.",!1))}}class JP{constructor(e,t,i){this.runtimeObject=e,this.interpreter=t,this.httpResponseType=i}send(e,t){this.interpreter.pauseForInput(Re.waitingForDB);let i={};for(let n of e.headers)i[n.key]=n.value;try{fetch(e.uri,{method:e.method,body:e.method=="GET"?void 0:e.postData,headers:i,redirect:"follow",cache:"no-cache"}).then(n=>{n.text().then(s=>{let a=new he(this.httpResponseType),l=new YP(a,t,n,s);a.intrinsicData.Helper=l,this.interpreter.resumeAfterInput({value:a,type:this.httpResponseType},!0)})}).catch(n=>{this.interpreter.throwException(""+n)})}catch(n){console.log(n)}}}class QP extends ${constructor(e){super("URLEncoder",e,"Klasse mit einer statischen Methode zum Encodieren von URLs."),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("encode",new g([{identifier:"value",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,t=>{t[0].value;let i=t[1].value;return encodeURI(i)},!1,!0,"Encodiert eine URL gemäß RFC3986.",!1))}}class eI extends ${constructor(e){super("JsonElement",e,"Repräsentiert ein einzelnes Element in einem Json-Objektbaum."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("Integer"),i=e.typeStore.getType("Boolean"),n=e.typeStore.getType("Double");this.addMethod(new m("getType",new g([]),F,s=>{let l=s[0].value.intrinsicData.v;return Array.isArray(l)?"array":typeof l},!1,!1,'Gibt den Typ des Json-Elements zurück. Mögliche Werte sind "string", "number", "array", "boolean" und "object".',!1)),this.addMethod(new m("getArrayValues",new g([]),new ze(this),s=>{let l=s[0].value.intrinsicData.v;if(!Array.isArray(l)){e.main.getInterpreter().throwException("Das Json-Element ist kein Array, daher kann getArrayValues() kein Array zurückgeben.");return}return l.map(u=>{let h=new he(this);return h.intrinsicData.v=u,{value:h,type:this}})},!1,!1,"Falls das Json-Element ein Array ist, gibt diese Funktion es als Array von Json-Elementen zurück.",!1)),this.addMethod(new m("getAttributeValue",new g([{identifier:"attributeIdentifier",type:F,declaration:null,usagePositions:null,isFinal:!0}]),this,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.v;if(Array.isArray(o)||typeof o!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann getAttributeValue() keinen Attributwert zurückgeben.");return}let u=new he(this);return u.intrinsicData.v=o[l],u},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion den Wert seine Attributs mit dem übergebenen Bezeichner als JsonElement zurück.",!1)),this.addMethod(new m("getAsString",new g([]),F,s=>{let l=s[0].value.intrinsicData.v;if(typeof l!="string"){e.main.getInterpreter().throwException("Das Json-Element ist kein String, daher kann getAsString() keinen Wert zurückgeben.");return}return l},!1,!1,"Gibt den String-Wert des JSon-Elements zurück.",!1)),this.addMethod(new m("getAsInt",new g([]),t,s=>{let l=s[0].value.intrinsicData.v;if(typeof l!="number"){e.main.getInterpreter().throwException("Das Json-Element ist keine Zahl, daher kann getAsInt() keinen Wert zurückgeben.");return}return Math.round(l)},!1,!1,"Gibt den int-Wert des JSon-Elements zurück.",!1)),this.addMethod(new m("toJson",new g([]),F,s=>{let l=s[0].value.intrinsicData.v;return JSON.stringify(l)},!1,!1,"Gibt den Wert des Json-Elements als Json-codierten String zurück.",!1)),this.addMethod(new m("getAsDouble",new g([]),n,s=>{let l=s[0].value.intrinsicData.v;if(typeof l!="number"){e.main.getInterpreter().throwException("Das Json-Element ist keine Zahl, daher kann getAsDouble() keinen Wert zurückgeben.");return}return l},!1,!1,"Gibt den double-Wert des JSon-Elements zurück.",!1)),this.addMethod(new m("getAsBoolean",new g([]),i,s=>{let l=s[0].value.intrinsicData.v;if(typeof l!="boolean"){e.main.getInterpreter().throwException("Das Json-Element ist kein boolescher Wert, daher kann getAsBoolean() keinen Wert zurückgeben.");return}return l},!1,!1,"Gibt den boolean-Wert des JSon-Elements zurück.",!1)),this.addMethod(new m("getAsString",new g([{identifier:"attributeIdentifier",type:F,declaration:null,usagePositions:null,isFinal:!0}]),F,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.v;if(Array.isArray(o)||typeof o!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann getAttributeValue() keinen Attributwert zurückgeben.");return}let u=o[l];if(typeof u!="string"){e.main.getInterpreter().throwException("Der Wert des Attributs "+l+" ist kein String.");return}return u},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion den Wert seine Attributs mit dem übergebenen Bezeichner als String zurück.",!1)),this.addMethod(new m("getAsInt",new g([{identifier:"attributeIdentifier",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.v;if(Array.isArray(o)||typeof o!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann getAttributeValue() keinen Attributwert zurückgeben.");return}let u=o[l];if(typeof u!="number"){e.main.getInterpreter().throwException("Der Wert des Attributs "+l+" ist keine Zahl.");return}return Math.round(u)},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion den Wert seine Attributs mit dem übergebenen Bezeichner als int-Wert zurück.",!1)),this.addMethod(new m("getAsDouble",new g([{identifier:"attributeIdentifier",type:F,declaration:null,usagePositions:null,isFinal:!0}]),n,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.v;if(Array.isArray(o)||typeof o!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann getAttributeValue() keinen Attributwert zurückgeben.");return}let u=o[l];if(typeof u!="number"){e.main.getInterpreter().throwException("Der Wert des Attributs "+l+" ist keine Zahl.");return}return u},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion den Wert seine Attributs mit dem übergebenen Bezeichner als double-Wert zurück.",!1)),this.addMethod(new m("getAsBoolean",new g([{identifier:"attributeIdentifier",type:F,declaration:null,usagePositions:null,isFinal:!0}]),i,s=>{let a=s[0].value,l=s[1].value,o=a.intrinsicData.v;if(Array.isArray(o)||typeof o!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann getAttributeValue() keinen Attributwert zurückgeben.");return}let u=o[l];if(typeof u!="boolean"){e.main.getInterpreter().throwException("Der Wert des Attributs "+l+" ist kein boolescher Wert.");return}return u},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion den Wert seine Attributs mit dem übergebenen Bezeichner als boolean-Wert zurück.",!1)),this.addMethod(new m("getAttributeIdentifiers",new g([]),new ze(F),s=>{let l=s[0].value.intrinsicData.v;if(Array.isArray(l)||typeof l!="object"){e.main.getInterpreter().throwException("Das Json-Element ist kein Objekt, daher kann diese Methode kein Array von Attributbzeichnern liefern.");return}let o=[];for(const[u,h]of Object.entries(l))o.push({type:F,value:u});return o},!1,!1,"Falls das Json-Element ein Objekt ist, gibt diese Funktion ein Array mit seinen Attributbezeichnern zurück.",!1))}}class tI extends ${constructor(e){super("JsonParser",e,"Parst Json-Code und gibt ihn als Objektbaum zurück."),this.setBaseClass(e.typeStore.getType("Object"));let t=e.typeStore.getType("JsonElement");this.addMethod(new m("parse",new g([{identifier:"jsonString",type:F,declaration:null,usagePositions:null,isFinal:!0}]),t,i=>{i[0].value;let n=i[1].value;try{let s=JSON.parse(n),a=new he(t);return a.intrinsicData.v=s,a}catch(s){e.main.getInterpreter().throwException("Fehler beim Parsen des Json-Strings: "+s);return}},!1,!0,"Wandelt einen Json-String in einen Objektbaum um.",!1))}}class iI extends Pe{constructor(e){super("ChangeListener",e,"Listener-Interface für GUI-Klassen (Button, TextField, Checkbox, Radiobutton)");let t=e.typeStore.getType("Object");this.addMethod(new m("onChange",new g([{identifier:"changedObject",type:t,declaration:null,usagePositions:null,isFinal:!0},{identifier:"newValue",type:F,declaration:null,usagePositions:null,isFinal:!0}]),U,null,!0,!1,"Wird immer dann aufgerufen, wenn sich das GUI-Objekt verändert hat."))}}class nI extends ${constructor(e){super("Collections",e,"Utility-Klasse für Listen");let t=e.typeStore.getType("Object"),i=e.typeStore.getType("List");this.setBaseClass(t),this.addMethod(new m("shuffle",new g([{identifier:"list",type:i,declaration:null,usagePositions:null,isFinal:!0}]),U,n=>{let a=n[1].value.intrinsicData.ListHelper,l=a.valueArray,o=a.objectArray,u=l.length;for(let h=0;h<u*2;h++){let d=Math.floor(Math.random()*u),p=Math.floor(Math.random()*u),v=l[d];l[d]=l[p],l[p]=v;let w=o[d];o[d]=o[p],o[p]=w}},!1,!0,"Vertauscht die Elemente der Liste in zufälliger Weise."))}}class nd{constructor(){y(this,"positivePraefix","");y(this,"positiveSuffix","");y(this,"negativePraefix","");y(this,"negativeSuffix","");y(this,"multiplier",1);y(this,"groupingSize",0);y(this,"minimumIntegerDigits",0);y(this,"maximumIntegerDigits",16);y(this,"minimumFractionDigits",0);y(this,"maximumFractionDigits",0);y(this,"minimumExponentDigits",0);y(this,"roundingMode","HALF_EVEN")}}const Ua=class Ua{constructor(e="00.00"){y(this,"position");y(this,"pattern",new nd);y(this,"parsePositiveOrNegativePattern","positive");this.formatString=e,this.parseFormatString(e)}parseFormatString(e){if(this.formatString=e,this.position=0,this.pattern=new nd,this.parsePositiveOrNegativePattern="positive",this.parsePattern(),this.comes(";",!0)){let t=this.pattern;this.pattern=new nd,this.parsePositiveOrNegativePattern="negative",this.parsePattern(),t.negativePraefix=null,t.negativeSuffix=null,this.pattern=t}else this.pattern.negativePraefix="-"+this.pattern.positivePraefix,this.pattern.negativeSuffix=this.pattern.positiveSuffix}format(e){let i=e.toString().match(/(-)?(\d*).?(\d*)(e([+-](\d*)))?/),n=i[1],s=i[2],a=i[3];i[4]!=null;let l=i[5];i[6];let o=n=="-"?-1:1,u="";o==-1?this.pattern.negativePraefix==null?u="-"+this.pattern.positivePraefix:u=this.pattern.negativePraefix:u=this.pattern.positivePraefix;let h="",d="",p="",v=s.length-1;if(l!=null&&(v+=Number.parseInt(l)),v>this.pattern.maximumIntegerDigits)h=s.substring(0,1)+"."+s.substring(1)+a==null?"":a,h+="E"+v.toString();else{if(a!=null){p=".";let T=this.pattern.minimumFractionDigits-a.length;if(T>0&&(a+=Ua.stringWithNulls.substring(0,T)),this.pattern.maximumFractionDigits<a.length){let D=Number.parseInt("1"+a.substring(0,this.pattern.maximumFractionDigits));Number.parseInt(a.substring(this.pattern.maximumFractionDigits,this.pattern.maximumFractionDigits+1))>=5&&(D+=1);let O=""+D;O.startsWith("2")&&(s=""+(Number.parseInt(s)+1)),a=O.substring(1,O.length),a=a.substring(0,this.pattern.maximumFractionDigits)}p+=a}let _=this.pattern.minimumIntegerDigits-s.length;if(_>0&&(s=Ua.stringWithNulls.substring(0,_)+s),this.pattern.groupingSize>0){let T="",D=s.length,L=D-this.pattern.groupingSize;for(;L>=0;)T=s.substring(L,D)+T,L>0&&(T=","+T),D-=this.pattern.groupingSize,L-=this.pattern.groupingSize;D>0&&(T=s.substring(0,D)+T),s=T}d=s}let w=u+h+d+p;return o==-1&&this.pattern.negativeSuffix!=null?w+=this.pattern.negativeSuffix:w+=this.pattern.positiveSuffix,w}comes(e,t=!0){let i=this.formatString.indexOf(e,this.position)==this.position;return i&&t&&(this.position+=e.length),i}parsePattern(){this.parsePraefix(),this.parseNumber(),this.parseSuffix()}parsePraefix(){let e=this.getNextCharacter(!1);for(;"0#".indexOf(e)<0&&!this.isEnd();){switch(this.position++,e){case"'":e=this.getNextCharacter(!0);break;case"%":this.pattern.multiplier=100;break;case"‰":this.pattern.multiplier=1e3;break}this.pattern.positivePraefix+=e,e=this.getNextCharacter(!1)}}parseSuffix(){let e=this.getNextCharacter(!0);for(;!this.isEnd();){switch(e){case"'":e=this.getNextCharacter(!0);break;case"%":this.pattern.multiplier=100;break;case"‰":this.pattern.multiplier=1e3;break}this.pattern.positiveSuffix+=e,e=this.getNextCharacter(!0)}}parseNumber(){this.parseInteger(),this.comes(".",!0)&&this.parseFraction(),this.comes("E",!0)&&this.parseExponent()}parseInteger(){let e=0,t=!1;for(;this.comes("#",!1);){for(;this.comes("#",!0);)t&&e++;if(this.comes(",",!0)){t=!0,this.pattern.groupingSize=e,e=0;continue}break}for(this.pattern.groupingSize=e;this.comes("0",!1);){for(;this.comes("0",!0);)e++,this.pattern.minimumIntegerDigits++;if(this.comes(",",!0)){this.pattern.groupingSize=e,e=0;continue}break}}parseFraction(){for(;this.comes("0",!0);)this.pattern.minimumFractionDigits++;for(this.pattern.maximumFractionDigits=this.pattern.minimumFractionDigits;this.comes("#",!0);)this.pattern.maximumFractionDigits++}parseExponent(){for(;this.comes("0",!0);)this.pattern.minimumExponentDigits++}isEnd(){return this.position>=this.formatString.length}getNextCharacter(e=!0){if(this.isEnd())return"￿";let t=this.formatString.charAt(this.position);return e&&this.position++,t}};y(Ua,"stringWithNulls","0000000000000000000000000000000000000000");let nc=Ua;class rI extends ${constructor(e){super("DecimalFormat",e,"Ermöglicht das Formatieren und Parsen von Dezimalzahlen"),this.setBaseClass(e.typeStore.getType("Object")),this.addMethod(new m("DecimalFormat",new g([{identifier:"format",type:F,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.h=new nc(n)},!1,!1,"Instanziert ein neues DecimalFormat-Objekt mit dem angegebenen Zahlenformat",!0)),this.addMethod(new m("format",new g([{identifier:"number",type:A,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),F,t=>{let i=t[0].value,n=t[1].value;return i.intrinsicData.h.format(n)},!1,!1,"Wandelt die übergebene Zahl anhand des gespeicherten Formats in eine Zeichenkette um.",!1))}}class sI extends ${constructor(e){super("BigInteger",e,"Repräsentiert eine ganze Zahl mit 'beliebig' vielen Stellen."),this.setBaseClass(e.typeStore.getType("Object")),this.setupAttributeIndicesRecursive(),this.addMethod(new m("BigInteger",new g([{identifier:"val",type:F,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),null,t=>{let i=t[0].value,n=t[1].value;i.intrinsicData.bi=BigInt(n)},!1,!1,"Instanziert ein neues BigInteger-Objekt",!0)),this.addMethod(new m("add",new g([{identifier:"val",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.bi,a=n.intrinsicData.bi,l=new he(this);return l.intrinsicData.bi=s+a,l},!1,!1,"Addiert das übergebene BigInteger-Objekt zum aktuellen BigInteger-Objekt und gibt ein neues BigInteger-Objekt zurück, dessen Wert die errechnete Summe ist. Die Methode add ändert nicht das aktuelle BigInteger-Objekt!",!1)),this.addMethod(new m("divide",new g([{identifier:"val",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.bi,a=n.intrinsicData.bi,l=new he(this);return l.intrinsicData.bi=s/a,l},!1,!1,"Dividiert das aktuelle Objekt durch das übergebene BigInteger-Objekt und gibt ein neues BigInteger-Objekt zurück, dessen Wert der ganzzahlige Anteil des errechneten Quotienten ist. Die Methode divide ändert nicht das aktuelle BigInteger-Objekt!",!1)),this.addMethod(new m("multiply",new g([{identifier:"val",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.bi,a=n.intrinsicData.bi,l=new he(this);return l.intrinsicData.bi=s*a,l},!1,!1,"Multipliziert das aktuelle Objekt mit dem übergebenen BigInteger-Objekt und gibt ein neues BigInteger-Objekt zurück, dessen Wert das Produkt der beiden Zahlen ist. Die Methode multiply ändert nicht das aktuelle BigInteger-Objekt!",!1)),this.addMethod(new m("remainder",new g([{identifier:"val",type:this,declaration:null,usagePositions:null,isFinal:!0,isEllipsis:!1}]),this,t=>{let i=t[0].value,n=t[1].value,s=i.intrinsicData.bi,a=n.intrinsicData.bi,l=new he(this);return l.intrinsicData.bi=s%a,l},!1,!1,"Dividiert das aktuelle Objekt durch das übergebenen BigInteger-Objekt und gibt ein neues BigInteger-Objekt zurück, dessen Wert der Rest der Division ist. Die Methode remainder ändert nicht das aktuelle BigInteger-Objekt!",!1)),this.addMethod(new m("toString",new g([]),F,t=>t[0].value.intrinsicData.bi.toString(),!1,!1,"Gibt das BigInteger-Objekt als Zeichenkette (dezimal!) zurück.",!1)),this.addMethod(new m("intValue",new g([]),C,t=>{let n=t[0].value.intrinsicData.bi;return Number(BigInt.asIntN(52,n))},!1,!1,"Gibt das BigInteger-Objekt mod (2^53) als int-Wert zurück.",!1))}}const pr=class pr{constructor(e,t){y(this,"file");y(this,"uri");y(this,"model");y(this,"oldErrorDecorations",[]);y(this,"lastSavedVersionId");y(this,"editorState");y(this,"isSystemModule",!1);y(this,"breakpoints",[]);y(this,"breakpointDecorators",[]);y(this,"decoratorIdToBreakpointMap",{});y(this,"errors",[[],[],[],[]]);y(this,"colorInformation",[]);y(this,"tokenList");y(this,"mainProgramAst");y(this,"classDefinitionsAST");y(this,"typeNodes");y(this,"typeStore");y(this,"mainProgram");y(this,"mainProgramEnd");y(this,"mainSymbolTable");y(this,"identifierPositions",{});y(this,"methodCallPositions",{});y(this,"dependsOnModules");y(this,"isStartable");y(this,"dependsOnModulesWithErrors");y(this,"bracketError");if(this.main=t,e==null||this.main==null)return;this.file=e;let i=e.name;i=i.replaceAll("//","_");let n=pr.uriMap[i];n==null?n=0:n++,pr.uriMap[i]=n,n>0&&(i+=" ("+n+")"),this.uri=monaco.Uri.from({path:i,scheme:"inmemory"});let s=Mi.filenameToFileType(e.name);for(;monaco.editor.getModel(this.uri)!=null;)i+="x",this.uri=monaco.Uri.from({path:i,scheme:"inmemory"});this.model=monaco.editor.createModel(e.text,s.language,this.uri),this.model.updateOptions({tabSize:3,bracketColorizationOptions:{enabled:!0}});let a=new pc;if(t.isEmbedded()&&e.text!=null&&e.text.length>3&&s.language=="myJava"){let o=a.format(this.model);this.model.applyEdits(o)}this.lastSavedVersionId=this.model.getAlternativeVersionId();let l=this;this.model.onDidChangeContent(()=>{let o=l.model.getAlternativeVersionId();if(o!=l.lastSavedVersionId&&(l.file.dirty=!0,l.file.saved=!1,l.file.identical_to_repository_version=!1,l.lastSavedVersionId=o),!l.main.isEmbedded()){let u=t;u.workspacesOwnerId!=u.user.id?(l.file.text_before_revision==null||l.file.student_edited_after_revision)&&(l.file.student_edited_after_revision=!1,l.file.text_before_revision=l.file.text,l.file.saved=!1,u.networkManager.sendUpdates(null,!1),u.bottomDiv.homeworkManager.showHomeWorkRevisionButton(),u.projectExplorer.renderHomeworkButton(l.file)):l.file.student_edited_after_revision=!0}})}setupMonacoModel(){}toExportedModule(){return{name:this.file.name,text:this.getProgramTextFromMonacoModel(),identical_to_repository_version:this.file.identical_to_repository_version,is_copy_of_id:this.file.is_copy_of_id,repository_file_version:this.file.repository_file_version}}getMethodDeclarationAtPosition(e){if(this.classDefinitionsAST==null)return null;for(let t of this.classDefinitionsAST)if(t.type==f.keywordClass||t.type==f.keywordEnum){for(let i of t.methods)if(i.position!=null&&i.scopeTo!=null&&i.position.line<=e.lineNumber&&i.scopeTo.line>=e.lineNumber)return i}return null}static restoreFromData(e,t){let i=$d.patch(e.text),n={name:e.name,text:i.patchedText,text_before_revision:e.text_before_revision,submitted_date:e.submitted_date,student_edited_after_revision:!1,dirty:!0,saved:!i.modified,version:e.version,id:e.id,is_copy_of_id:e.is_copy_of_id,repository_file_version:e.repository_file_version,identical_to_repository_version:e.identical_to_repository_version};return new pr(n,t)}getFileData(e){let t=this.file;return{id:t.id,name:t.name,text:t.text,text_before_revision:t.text_before_revision,submitted_date:t.submitted_date,student_edited_after_revision:t.student_edited_after_revision,version:t.version,is_copy_of_id:t.is_copy_of_id,repository_file_version:t.repository_file_version,identical_to_repository_version:t.identical_to_repository_version,workspace_id:e.id,forceUpdate:!1}}pushMethodCallPosition(e,t,i,n){let s=[];s.push(e.line);for(let l of t)s.indexOf[l.line]<0&&s.push(l.line);let a={identifierPosition:e,commaPositions:t,possibleMethods:i,rightBracketPosition:n};for(let l of s){let o=this.methodCallPositions[l];o==null&&(this.methodCallPositions[l]=[],o=this.methodCallPositions[l]),o.push(a)}}toggleBreakpoint(e,t){this.getBreakpointPositionsFromEditor(),this.getAndRemoveBreakpoint(e)==null&&this.setBreakpoint(e,1),t&&this.renderBreakpointDecorators()}getAndRemoveBreakpoint(e){for(let t=0;t<this.breakpoints.length;t++){let i=this.breakpoints[t];if(i.line==e)return this.breakpoints.splice(t,1),i.statement!=null&&(i.statement.breakpoint=void 0),i}return null}setBreakpoint(e,t){let i={line:e,column:t,statement:null};return this.attachToStatement(i),this.breakpoints.push(i),i}attachToStatement(e,t){var s;e.statement!=null&&(e.statement.breakpoint=void 0),t==null&&(t=this.getPrograms());let i=null,n=1e5;for(let a of t)for(let l of a.statements){let o=(s=l==null?void 0:l.position)==null?void 0:s.line;if(o!=null&&o>=e.line){o-e.line<n&&(i=l,n=o-e.line);break}}e.statement=i,i!=null&&(i.breakpoint=e)}getPrograms(){let e=[];if(this.mainProgram!=null&&e.push(this.mainProgram),this.typeStore!=null){for(let t of this.typeStore.typeList)if(t instanceof $){t.attributeInitializationProgram!=null&&e.push(t.attributeInitializationProgram);for(let i of t.methods)i.program!=null&&e.push(i.program);t.staticClass.attributeInitializationProgram!=null&&e.push(t.staticClass.attributeInitializationProgram);for(let i of t.staticClass.methods)i.program!=null&&e.push(i.program)}}return e}renderBreakpointDecorators(){this.getBreakpointPositionsFromEditor();let e=[];for(let t of this.breakpoints)e.push({range:{startLineNumber:t.line,endLineNumber:t.line,startColumn:1,endColumn:1},options:{isWholeLine:!0,className:"jo_decorate_breakpoint",overviewRuler:{color:"#580000",position:monaco.editor.OverviewRulerLane.Left},minimap:{color:"#580000",position:monaco.editor.MinimapPosition.Inline},marginClassName:"jo_margin_breakpoint",stickiness:monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges},breakpoint:t});this.breakpointDecorators=this.main.getMonacoEditor().deltaDecorations(this.breakpointDecorators,e),this.decoratorIdToBreakpointMap={};for(let t=0;t<this.breakpointDecorators.length;t++)this.decoratorIdToBreakpointMap[this.breakpointDecorators[t]]=this.breakpoints[t]}getBreakpointPositionsFromEditor(){let e=this.main.getMonacoEditor().getModel();if(e!=null){for(let t of e.getAllDecorations())if(t.options.marginClassName=="jo_margin_breakpoint"){let i=this.decoratorIdToBreakpointMap[t.id];i!=null&&(i.line=t.range.startLineNumber)}}}findSymbolTableAtPosition(e,t){return this.mainSymbolTable==null?null:((e>this.mainSymbolTable.positionTo.line||e==this.mainSymbolTable.positionTo.line&&t>this.mainSymbolTable.positionTo.column)&&(e=this.mainSymbolTable.positionTo.line,t=this.mainSymbolTable.positionTo.column-1),this.mainSymbolTable.findTableAtPosition(e,t))}getErrorCount(){let e=0;for(let t of this.errors)t.forEach(i=>e+=i.level=="error"?1:0);return e}hasMainProgram(){return this.mainProgram==null||this.mainProgram.statements==null?!1:this.mainProgram.statements.length>2||this.mainProgram.statements.length==2&&this.mainProgram.statements[0].type==f.callMainMethod}getProgramTextFromMonacoModel(){return this.model.getValue(monaco.editor.EndOfLinePreference.LF,!1)}addIdentifierPosition(e,t){let i=this.identifierPositions[e.line];i==null&&(i=[],this.identifierPositions[e.line]=i),i.push({position:e,element:t})}getTypeAtPosition(e,t){let i=this.identifierPositions[e];if(i==null)return null;let n=null;for(let s of i)if(t>=s.position.column&&t<=s.position.column+s.position.length){n=s;let a=n.element;if(a instanceof m)return{type:a,isStatic:!1};let l=a instanceof ar?a:a.type;return n.position.length>0&&a.type!=null?{type:l,isStatic:!1}:{type:l,isStatic:n.position.length>0}}return null}getElementAtPosition(e,t){let i=this.identifierPositions[e];if(i==null)return null;let n=null;for(let s of i)t>=s.position.column&&t<=s.position.column+s.position.length&&s.position.length>0&&(n==null||s.element instanceof m&&n.element instanceof $)&&(n=s);return n==null?null:n.element}copy(){let e=new pr(this.file,this.main);e.model=this.model,e.mainProgram=this.mainProgram,this.mainProgram=null,e.mainSymbolTable=this.mainSymbolTable,this.mainSymbolTable=null,e.typeStore=this.typeStore,e.isStartable=this.isStartable,e.dependsOnModulesWithErrors=this.dependsOnModulesWithErrors,e.breakpoints=this.breakpoints,this.breakpoints=[];let t=e.getPrograms();t.forEach(i=>i.module=e);for(let i of e.breakpoints)this.breakpoints.push({line:i.line,column:i.column,statement:null}),e.attachToStatement(i,t);return this.file.dirty=!0,e}clear(){this.identifierPositions={},this.file!=null&&this.file.dirty&&(this.tokenList=null,this.errors[0]=[],this.errors[1]=[]),this.errors[2]=[],this.typeNodes=[],this.typeStore=new lI,this.errors[3]=[],this.mainSymbolTable=new qa(null,{line:1,column:1,length:1},{line:1e5,column:1,length:0}),this.mainProgram=null,this.methodCallPositions={},this.dependsOnModules=new Map}hasErrors(){for(let e of this.errors)if(e.find(t=>t.level=="error"))return!0;return!1}getSortedAndFilteredErrors(){let e=[];for(let t of this.errors)e=e.concat(t);e.sort((t,i)=>t.position.line>i.position.line?1:i.position.line>t.position.line?-1:t.position.column>=i.position.column?1:-1);for(let t=0;t<e.length-1;t++){let i=e[t],n=e[t+1];i.position.line==n.position.line&&i.position.column+10>n.position.column&&(this.errorLevelCompare(i.level,n.level)==1?e.splice(t+1,1):e.splice(t,1),t--)}return e}errorLevelCompare(e,t){return e=="error"?1:t=="error"?2:e=="warning"?1:t=="warning"?2:1}renderStartButton(){var t,i,n;let e=(n=(i=(t=this.file)==null?void 0:t.panelElement)==null?void 0:i.$htmlFirstLine)==null?void 0:n.find(".jo_additionalButtonStart");if(e!=null&&(e.find(".jo_startButton").remove(),this.isStartable)){let s=I('<div class="jo_startButton img_start-dark jo_button jo_active" title="Hauptprogramm in der Datei starten"></div>');e.append(s);let a=this;s.on("mousedown",l=>l.stopPropagation()),s.on("click",l=>{l.stopPropagation(),a.main.setModuleActive(a),a.main.getInterpreter().start()})}}};y(pr,"maxUriNumber",0),y(pr,"uriMap",{});let Ni=pr;class am extends Ni{constructor(e){super({name:"Base Module",text:"",text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,dirty:!1,saved:!0,version:1,identical_to_repository_version:!0},e),this.isSystemModule=!0,this.mainProgram=null,this.clear(),this.typeStore.addType(U),this.typeStore.addType(C),this.typeStore.addType(se),this.typeStore.addType(it),this.typeStore.addType(G),this.typeStore.addType(A),this.typeStore.addType(Ge),this.typeStore.addType(P),this.typeStore.addType(F),this.typeStore.addType(Wi),this.typeStore.addType(lo),this.typeStore.addType(lc),this.typeStore.addType(oc),this.typeStore.addType(uc),this.typeStore.addType(hc),this.typeStore.addType(dc),this.typeStore.addType(cc),this.typeStore.addType(new RP(this)),this.typeStore.addType(new sI(this)),this.typeStore.addType(new Qv(this)),this.typeStore.addType(new Jv(this)),this.typeStore.addType(new Zv(this)),this.typeStore.addType(new ew(this)),this.typeStore.addType(new Yv(this)),this.typeStore.addType(new iw(this)),this.typeStore.addType(new lw(this)),this.typeStore.addType(new ow(this)),this.typeStore.addType(new uw(this)),this.typeStore.addType(new tw(this)),this.typeStore.addType(new Ja(this)),this.typeStore.addType(new nw(this)),this.typeStore.addType(new sw(this)),this.typeStore.addType(new aw(this)),this.typeStore.addType(new gc(this)),this.typeStore.addType(new CA(this)),this.typeStore.addType(new MA(this)),this.typeStore.addType(new nI(this)),this.typeStore.addType(new hw(this)),this.typeStore.addType(new bA(this)),this.typeStore.addType(new VP(this)),this.typeStore.addType(new rM(this)),this.typeStore.addType(new rI(this)),this.typeStore.addType(new RA(this)),this.typeStore.addType(new vA(this)),this.typeStore.addType(new rA(this)),this.typeStore.addType(new hA(this)),this.typeStore.addType(new mA(this)),this.typeStore.addType(new kA(this)),this.typeStore.addType(new TA(this)),this.typeStore.addType(new eA(this)),this.typeStore.addType(new WC(this)),this.typeStore.addType(new sM(this));let t=new KC(this);this.typeStore.addType(t),this.typeStore.addType(new YC(this)),this.typeStore.addType(new aA(this)),this.typeStore.addType(new oA(this)),this.typeStore.addType(new ZC(this)),this.typeStore.addType(new JC(this)),this.typeStore.addType(new QC(this)),this.typeStore.addType(new tA(this)),this.typeStore.addType(new qC(this)),this.typeStore.addType(new HC(this)),this.typeStore.addType(new gA(this)),this.typeStore.addType(new uA(this)),this.typeStore.addType(new Qo(this)),this.typeStore.addType(new lA(this)),this.typeStore.addType(new cA(this));let i=new dA(this);this.typeStore.addType(i),t.setSpriteType(i),this.typeStore.addType(new iA(this)),this.typeStore.addType(new nA(this)),this.typeStore.addType(new sA(this)),this.typeStore.addType(new FA(this)),this.typeStore.addType(new EA(this)),this.typeStore.addType(new HA(this)),this.typeStore.addType(new eI(this)),this.typeStore.addType(new tI(this)),this.typeStore.addType(new $P(this)),this.typeStore.addType(new XP(this)),this.typeStore.addType(new qP(this)),this.typeStore.addType(new ZP(this)),this.typeStore.addType(new QP(this)),this.typeStore.addType(new iI(this)),this.typeStore.addType(new zP(this)),this.typeStore.addType(new NP(this)),this.typeStore.addType(new GP(this)),this.typeStore.addType(new WP(this)),this.typeStore.addType(new HP(this)),this.typeStore.addType(new UP(this)),this.typeStore.addType(new DP(this)),this.typeStore.addType(new FP(this)),this.typeStore.addType(new OP(this)),this.typeStore.addType(new LP(this)),this.typeStore.addType(new OA(this)),this.typeStore.addType(new LA(this)),this.typeStore.addType(new yA(this)),this.typeStore.addType(new NC(this)),this.typeStore.addType(new GA(this)),this.typeStore.getType("Actor").registerWorldType(),this.typeStore.addType(new xA(this)),this.typeStore.addType(new _A(this)),this.typeStore.addType(new wA(this)),this.typeStore.addType(new SA(this)),this.typeStore.addType(new IA(this)),this.typeStore.addType(new DA(this)),this.typeStore.addType(new PA(this)),this.typeStore.addType(new BA(this)),this.typeStore.addType(new jA(this)),this.typeStore.addType(new xP(this)),this.typeStore.addType(new wP(this)),this.typeStore.addType(new _P(this)),this.typeStore.addType(new kP(this)),this.typeStore.addType(new AP(this)),this.typeStore.addType(new EP(this)),this.typeStore.addType(new IP(this)),F.module=this}clearUsagePositions(){for(let e of this.typeStore.typeList)e.clearUsagePositions()}}class aI extends Ni{constructor(e,t){super({name:"Graphics and Games - Module",text:"",text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,dirty:!1,saved:!0,version:1,identical_to_repository_version:!0},e),this.isSystemModule=!0,this.mainProgram=null,this.clear(),this.typeStore.addType(new qA(this)),this.typeStore.addType(new KA(this,t)),this.typeStore.addType(new VA(this,t)),this.typeStore.addType(new Oi(this,t)),this.typeStore.addType(new $A(this,t)),this.typeStore.addType(new YA(this,t)),this.typeStore.addType(new JA(this,t)),this.typeStore.addType(new tM(this,t)),this.typeStore.addType(new eM(this,t)),this.typeStore.addType(new nM(this,t)),this.typeStore.addType(new aM(this,t))}clearUsagePositions(){for(let e of this.typeStore.typeList)e.clearUsagePositions()}}class Lu{constructor(e,t,i=[]){y(this,"modules",[]);y(this,"moduleMap",{});y(this,"baseModule");y(this,"dirty",!1);this.main=e,this.additionalLibraries=i,t&&(this.baseModule=new am(e),this.putModule(this.baseModule));for(let n of i)this.addLibraryModule(n)}rename(e,t){let i=this.moduleMap[e];i!=null&&(this.moduleMap[e]=void 0,this.moduleMap[t]=i)}addLibraryModule(e){switch(e){case"gng":this.putModule(new aI(this.main,this));break}}setAdditionalLibraries(e){this.modules=this.modules.filter(t=>!t.isSystemModule||t instanceof am),this.moduleMap={};for(let t of this.modules)this.moduleMap[t.file.name]=t;if(e!=null)for(let t of e)this.addLibraryModule(t)}findModuleById(e){for(let t of this.modules)if(t.file.id==e)return t;return null}getBaseModule(){return this.baseModule}clearUsagePositions(){this.baseModule.clearUsagePositions()}copy(){let e=new Lu(this.main,!0);for(let t of this.modules)t.isSystemModule||e.putModule(t.copy());return e}findModuleByFile(e){for(let t of this.modules)if(t.file==e)return t;return null}hasErrors(){for(let e of this.modules)if(e.hasErrors())return!0;return!1}getFirstModule(){if(this.modules.length>0){for(let e of this.modules)if(!e.isSystemModule)return e}return null}isDirty(){if(this.dirty)return this.dirty=!1,!0;let e=!1;for(let t of this.modules)if(t.file.dirty){e=!0;break}return e}getJavaModules(e=!1){return this.getModules(e).filter(t=>Mi.filenameToFileType(t.file.name).file_type==0)}getModules(e,t){let i=[];for(let n of this.modules)n.file.name!=t&&(!n.isSystemModule||e)&&i.push(n);return i}putModule(e){this.modules.push(e),this.moduleMap[e.file.name]=e}removeModuleWithFile(e){for(let t of this.modules)if(t.file==e){this.removeModule(t);break}}removeModule(e){this.modules.indexOf(e)<0||(this.modules.splice(this.modules.indexOf(e),1),this.moduleMap[e.file.name]=void 0,this.dirty=!0)}getModule(e){return this.moduleMap[e]}getType(e){for(let t of this.modules)if(t.typeStore!=null){let i=t.typeStore.getType(e);if(i!=null)return{type:i,module:t}}return null}getTypeCompletionItems(e,t){let i=[];for(let n of this.modules)if(n.typeStore!=null){for(let s of n.typeStore.typeList)if(n==e||s instanceof $&&s.visibility==ee.public||n.isSystemModule){let a="Klasse";s.documentation!=null?a=s.documentation:n.isSystemModule&&(s instanceof ut?a="Primitiver Datentyp":a="Systemklasse");let l={label:s.identifier,detail:a,insertText:s.identifier,kind:s instanceof ut?monaco.languages.CompletionItemKind.Struct:monaco.languages.CompletionItemKind.Class,range:t,generic:(s instanceof $||s instanceof Pe)&&s.typeVariables.length>0};i.push(l)}}return i}}class lI{constructor(){y(this,"typeList",[]);y(this,"typeMap",new Map)}addType(e){this.typeList.push(e),this.typeMap.set(e.identifier,e)}clear(){this.typeList.length=0,this.typeMap.clear()}getType(e){return this.typeMap.get(e)}}class rd{constructor(e,t,i,n,s){y(this,"$sliderDiv");this.$container=e,this.firstLast=t,this.horVert=i,this.callback=n,this.$otherDiv=s,this.initSlider()}initSlider(){let e=this;this.$otherDiv==null&&this.$container.parent().children().each((i,n)=>{n!=this.$container[0]&&(e.$otherDiv=I(n))}),this.$sliderDiv=I('<div class="joe_slider"></div>'),this.$sliderDiv.css({width:this.horVert?"100%":"4px",height:this.horVert?"4px":"100%",cursor:this.horVert?"row-resize":"col-resize"}),this.firstLast?this.$sliderDiv.css({top:"0px",left:"0px"}):this.horVert?this.$sliderDiv.css({bottom:"0px",left:"0px"}):this.$sliderDiv.css({top:"0px",right:"0px"}),this.$container.append(this.$sliderDiv);let t=window.PointerEvent?"pointer":"mouse";this.$sliderDiv.on(t+"down",i=>{let n=i.clientX,s=i.clientY;I(document).on(t+"move.slider",a=>{let l=a.clientX-n,o=a.clientY-s;e.slide(l,o),n=a.clientX,s=a.clientY}),I(document).on(t+"up.slider",()=>{I(document).off(t+"move.slider"),I(document).off(t+"up.slider")})}),setTimeout(()=>{e.slide(1,1)},600)}setColor(e){this.$sliderDiv.css("background-color",e)}slide(e,t){if(this.horVert){let i=Number.parseInt(this.$container.css("height").replace("px","")),n=Number.parseInt(this.$otherDiv.css("height").replace("px","")),s=this.firstLast?i-=t:i+=t,a=this.firstLast?n+=t:n-=t;this.$container.css("height",s+"px"),this.$otherDiv.css("height",a+"px"),this.callback(s)}else{let i=Number.parseInt(this.$container.css("width").replace("px","")),n=Number.parseInt(this.$otherDiv.css("width").replace("px","")),s=this.firstLast?i-=e:i+=e,a=this.firstLast?n+=e:n-=e;this.$container.css("width",s+"px"),this.$otherDiv.css("width",a+"px"),this.callback(s)}this.$container.css("flex","0 1 auto")}}class oI{constructor(e,t,i){y(this,"currentFile");y(this,"files",[]);this.moduleStore=e,this.$fileListDiv=t,this.main=i;let n=this;for(let s of e.getModules(!1))this.addModule(s);if(t!=null){let s=t.parent(),a=I('<div class="joe_addFileButton jo_button img_add-dark jo_active" title="Datei hinzufügen"></div>');s.append(a),a.on("click",()=>{let l=this.main.addModule({text:"",title:"Neue Datei.java"}),o=this.addModule(l);this.renameElement(o,()=>{n.currentFile!=o&&n.selectFile(o)})})}}removeAllFiles(){this.files.forEach(e=>this.removeFile(e))}addHint(e){let t=this,i=I('<div class="jo_file jo_hint" ><div class="jo_fileimage"></div><div class="jo_filename" style="line-height: 22px">'+e.title+'</div><div class="jo_additionalButtons"></div></div></div>');this.$fileListDiv.append(i);let n={module:null,$fileDiv:i,type:"hint",hint:e.text};this.files.push(n),i.on("click",s=>{t.selectFile(n)})}addModule(e){let t=this,i="jo_"+Mi.filenameToFileType(e.file.name).iconclass,n=I(`<div class="jo_file ${i}" >
        <div class="jo_fileimage"></div>
        <div class="jo_filename" style="line-height: 22px">${e.file.name}</div>
        <div class="jo_additionalButtonStart"></div>
        <div class="jo_delete img_delete jo_button jo_active" title="Datei löschen"></div></div></div>`);this.$fileListDiv!=null&&this.$fileListDiv.append(n);let s={module:e,$fileDiv:n,type:"java"};return this.files.push(s),e.file.panelElement={name:e.file.name,$htmlFirstLine:n,isFolder:!1,path:[],iconClass:Mi.filenameToFileType(e.file.name).iconclass,readonly:!1,isPruefungFolder:!1},n.find(".jo_delete").on("mousedown",a=>{t.onDelete(s,a)}),n.find(".jo_delete").on("click",a=>{a.preventDefault(),a.stopPropagation()}),n.on("click",a=>{t.selectFile(s)}),n[0].addEventListener("contextmenu",function(a){a.preventDefault(),wr([{caption:"Umbenennen",callback:()=>{t.renameElement(s,()=>{})}}],a.pageX,a.pageY)},!1),s}onDelete(e,t){t.preventDefault(),t.stopPropagation();let i=this;wr([{caption:"Abbrechen",callback:()=>{}},{caption:"Ich bin mir sicher: löschen!",color:"#ff6060",callback:()=>{i.removeFile(e)}}],t.pageX+2,t.pageY+2)}removeFile(e,t=!0){e.$fileDiv.remove(),this.main.removeModule(e.module),this.files=this.files.filter(i=>i!=e),this.currentFile==e&&(this.files.length>0?this.selectFile(this.files[0],t):(this.main.getMonacoEditor().setValue("Keine Datei vorhanden."),this.main.getMonacoEditor().updateOptions({readOnly:!0}))),this.files.forEach(i=>{i.module!=null&&(i.module.file.saved=!1)})}removeModule(e,t=!0){for(let i of this.files)i.module==e&&this.removeFile(i,t)}renameElement(e,t){let i=e.$fileDiv.find(".jo_filename"),n=e.module.file.name.indexOf("."),s=n==null?null:{start:0,end:n};fm(i,i,a=>{e.module.file.name=a,i.html(a),e.$fileDiv.removeClass("jo_java jo_emptyFile jo_xml jo_json jo_text");let l=Mi.filenameToFileType(a);e.$fileDiv.addClass("jo_"+l.iconclass),monaco.editor.setModelLanguage(e.module.model,l.language),t!=null&&t()},s)}setFirstFileActive(){this.files.length>0&&this.selectFile(this.files[0],!1)}selectFile(e,t=!0){if(e!=null)switch(e.type){case"java":this.main.$hintDiv.hide(),this.main.$monacoDiv.show(),this.main.setModuleActive(e.module),t&&this.main.getMonacoEditor().focus();break;case"hint":this.main.$monacoDiv.hide(),this.main.$hintDiv.show();let i={},n=[],s=window.markdownit({highlight:function(a,l){return n.push(a),""}});s.renderer.rules.code_inline=function(a,l,o,u,h){var d=a[l];return n.push(d.content),""},s.render(e.hint),this.colorize(n,i,()=>{let a=window.markdownit({highlight:function(o,u){return i[o]}});a.renderer.rules.code_inline=function(o,u,h,d,p){var v=o[u];return i[v.content].replace("<br/>","")};let l=a.render(e.hint);this.main.$hintDiv.html(l)}),this.$fileListDiv.find(".jo_file").removeClass("jo_active"),e.$fileDiv.addClass("jo_active");break}}colorize(e,t,i){let n=this;if(e.length>0){let s=e.pop();monaco.editor.colorize(s,"myJava",{tabSize:3}).then(a=>{t[s]=a,n.colorize(e,t,i)})}else i()}markFile(e){this.$fileListDiv!=null&&(this.$fileListDiv.find(".jo_file").removeClass("jo_active"),this.currentFile=this.files.find(t=>t.module==e),this.currentFile!=null&&this.currentFile.$fileDiv.addClass("jo_active"))}}class uI{constructor(){y(this,"db")}open(e){if(window.indexedDB){let t=window.indexedDB.open("LearnJ",1),i=this;t.onerror=function(n){console.log("Couldn't open IndexedDB: "+n.type)},t.onsuccess=function(n){i.db=t.result,i.db.onerror=function(s){console.log("Datenbankfehler: "+s.target.error.message)},e()},t.onupgradeneeded=function(n){i.db=n.target.result;let s=i.db.createObjectStore("scripts",{keyPath:"scriptId",autoIncrement:!1});s.transaction.oncomplete=function(a){}}}else console.log("IndexedDB not available.")}writeScript(e,t){this.db.transaction("scripts","readwrite").objectStore("scripts").put({scriptId:e,script:t})}removeScript(e){this.db.transaction("scripts","readwrite").objectStore("scripts").delete(e)}getScript(e,t){let n=this.db.transaction("scripts","readwrite").objectStore("scripts").get(e);n.onerror=s=>{t(null)},n.onsuccess=s=>{n.result==null?t(null):t(n.result.script)}}}class hI{constructor(e){this.module=e}getName(){return this.module.file.name}getText(){return this.module.getProgramTextFromMonacoModel()}}class dI{constructor(e){this.ide=e}getFiles(){return this.ide.getCurrentWorkspace().moduleStore.getModules(!1).map(e=>new hI(e))}}const Va=class Va{static registerIDE(e){Va.ideMap.set(e.config.id,new dI(e))}getIDE(e){return Va.ideMap.get(e)}};y(Va,"ideMap",new Map);let lu=Va;class Ib{constructor(e,t){y(this,"pixiApp");y(this,"config");y(this,"editor");y(this,"programPointerDecoration",[]);y(this,"programPointerModule");y(this,"currentWorkspace");y(this,"actionManager");y(this,"compiler");y(this,"interpreter");y(this,"$runDiv");y(this,"debugger");y(this,"$debuggerDiv");y(this,"bottomDiv");y(this,"$filesListDiv");y(this,"$hintDiv");y(this,"$monacoDiv");y(this,"$resetButton");y(this,"programIsExecutable",!1);y(this,"version",0);y(this,"timerHandle");y(this,"rightDiv");y(this,"$rightDivInner");y(this,"fileExplorer");y(this,"debounceDiagramDrawing");y(this,"indexedDB");y(this,"compileRunsAfterCodeReset",0);y(this,"semicolonAngel");y(this,"userSpritesheet");this.scriptList=t,this.readConfig(e),this.initGUI(e),this.initScripts(),this.config.hideStartPanel||(this.indexedDB=new uI,this.indexedDB.open(()=>{this.config.id!=null&&this.readScripts()})),this.semicolonAngel=new hb(this),window.ONLINE_IDE_ACCESS=new lu,lu.registerIDE(this)}isEmbedded(){return!0}jumpToDeclaration(e,t){}getCompiler(){return this.compiler}getInterpreter(){return this.interpreter}getCurrentWorkspace(){return this.currentWorkspace}getDebugger(){return this.debugger}getMonacoEditor(){return this.editor.editor}getRightDiv(){return this.rightDiv}getBottomDiv(){return this.bottomDiv}getActionManager(){return this.actionManager}getCurrentlyEditedModule(){var e;return this.config.withFileList?(e=this.fileExplorer.currentFile)==null?void 0:e.module:this.currentWorkspace.moduleStore.getFirstModule()}initScripts(){var e;(e=this.fileExplorer)==null||e.removeAllFiles(),this.initWorkspace(this.scriptList),this.config.withFileList?(this.fileExplorer=new oI(this.currentWorkspace.moduleStore,this.$filesListDiv,this),this.fileExplorer.setFirstFileActive(),this.scriptList.filter(t=>t.title.endsWith(".md")).forEach(t=>this.fileExplorer.addHint(t))):this.setModuleActive(this.currentWorkspace.moduleStore.getFirstModule())}readConfig(e){let t=e.data("java-online");t!=null&&typeof t=="string"?this.config=JSON.parse(t.split("'").join('"')):this.config={},this.config.hideEditor==null&&(this.config.hideEditor=!1),this.config.hideStartPanel==null&&(this.config.hideStartPanel=!1),this.config.withBottomPanel==null&&(this.config.withBottomPanel=this.config.withConsole||this.config.withPCode||this.config.withFileList||this.config.withErrorList),this.config.hideEditor&&(this.config.withBottomPanel=!1,this.config.withFileList=!1,this.config.withConsole=!1,this.config.withPCode=!1,this.config.withErrorList=!1),this.config.withBottomPanel&&(this.config.withFileList==null&&(this.config.withFileList=!0),this.config.withPCode==null&&(this.config.withPCode=!0),this.config.withConsole==null&&(this.config.withConsole=!0),this.config.withErrorList==null&&(this.config.withErrorList=!0)),this.config.speed==null&&(this.config.speed="max"),this.config.libraries==null&&(this.config.libraries=[]),this.config.jsonFilename==null&&(this.config.jsonFilename="workspace.json")}setModuleActive(e){e!=null&&(this.config.withFileList&&this.fileExplorer.currentFile!=null&&(this.fileExplorer.currentFile.module.editorState=this.getMonacoEditor().saveViewState()),this.config.withFileList&&this.fileExplorer.markFile(e),this.getMonacoEditor().updateOptions({readOnly:!1,lineNumbersMinChars:4}),this.editor.editor.setModel(e.model),e.editorState!=null&&this.getMonacoEditor().restoreViewState(e.editorState),e.renderBreakpointDecorators())}eraseDokuwikiSearchMarkup(e){return e.replace(/<span class="search\whit">(.*?)<\/span>/g,"$1")}readScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=this;this.indexedDB.getScript(this.config.id,i=>{var n;if(i==null)setInterval(()=>{t.saveScripts()},1e3);else{let s=JSON.parse(i),a=s.length;for(let l of e)(n=t.fileExplorer)==null||n.removeModule(l,!1),t.removeModule(l);for(let l of s){let o=this.config.id+l;this.indexedDB.getScript(o,u=>{var h,d;if(u!=null){u=this.eraseDokuwikiSearchMarkup(u);let p=t.addModule({title:l,text:u});(h=t.fileExplorer)==null||h.addModule(p),t.$resetButton.fadeIn(1e3)}if(a--,a==0&&(setInterval(()=>{t.saveScripts()},1e3),(d=t.fileExplorer)==null||d.setFirstFileActive(),t.fileExplorer==null)){let p=t.currentWorkspace.moduleStore.getModules(!1);p.length>0&&t.setModuleActive(p[0])}})}}})}saveScripts(){let e=this.currentWorkspace.moduleStore.getModules(!1),t=[],i=!1;if(e.forEach(n=>i=i||!n.file.saved),i){for(let n of e){t.push(n.file.name);let s=this.config.id+n.file.name;this.indexedDB.writeScript(s,n.getProgramTextFromMonacoModel()),n.file.saved=!0}this.indexedDB.writeScript(this.config.id,JSON.stringify(t))}}deleteScriptsInDB(){this.indexedDB.getScript(this.config.id,e=>{if(e!=null){let t=JSON.parse(e);for(let i of t){let n=this.config.id+i;this.indexedDB.removeScript(n)}this.indexedDB.removeScript(this.config.id)}})}initWorkspace(e){this.currentWorkspace=new mn("Embedded-Workspace",this,0),this.currentWorkspace.settings.libraries=this.config.libraries,this.currentWorkspace.alterAdditionalLibraries();for(let t of e)this.addModule(t)}addModule(e){Mi.filenameToFileType(e.title);let t=Ni.restoreFromData({id:this.currentWorkspace.moduleStore.getModules(!0).length,name:e.title,text:e.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,workspace_id:0,forceUpdate:!1,identical_to_repository_version:!1},this);this.currentWorkspace.moduleStore.putModule(t);let i=this;return t.model.onDidChangeContent(()=>{i.considerShowingCodeResetButton()}),t}removeModule(e){this.currentWorkspace.moduleStore.removeModule(e)}initGUI(e){e.css({"background-image":"none","background-size":"100%"});let t=I('<div class="joe_centerDiv"></div>'),i=this.makeCodeResetModalWindow(e),n=this.makeRightDiv(),s=I('<div class="joe_editorDiv"></div>');this.$monacoDiv=I('<div class="joe_monacoDiv"></div>'),this.$hintDiv=I('<div class="joe_hintDiv jo_scrollable"></div>'),this.$resetButton=I('<div class="joe_resetButton jo_button jo_active" title="Code auf Ausgangszustand zurücksetzen">Code Reset</div>'),s.append(this.$monacoDiv,this.$hintDiv,this.$resetButton);let a=this.makeBracketErrorDiv();s.append(a),this.$resetButton.hide(),this.$resetButton.on("click",()=>{i.show()}),this.$hintDiv.hide();let l=I('<div class="joe_controlsDiv"></div>'),o=I('<div class="joe_bottomDivInner"></div>'),u=I('<label type="file" class="img_open-file jo_button jo_active"style="margin-right: 8px;" title="Workspace aus Datei laden"><input type="file" style="display:none"></label>'),h=this;u.find("input").on("change",_=>{var T=_.originalEvent.target.files;h.loadWorkspaceFromFile(T[0])});let d=I('<div class="img_save-dark jo_button jo_active"style="margin-right: 8px;" title="Workspace in Datei speichern"></div>');if(d.on("click",()=>{h.saveWorkspaceToFile()}),l.append(u,d),this.config.withBottomPanel){let _=I('<div class="joe_bottomDiv"></div>');if(this.makeBottomDiv(o,l),_.append(o),this.config.withFileList){let T=this.makeFilesDiv();_.prepend(T),new rd(T,!1,!1,()=>{})}Ao(o),t.append(s,_),new rd(_,!0,!0,()=>{this.editor.editor.layout()})}else t.prepend(s);this.config.withBottomPanel||(this.config.hideEditor?n.prepend(l):(t.prepend(l),l.addClass("joe_controlPanel_top"),s.css({position:"relative",height:"1px"}))),e.addClass("joe_javaOnlineDiv"),e.append(t,n),this.config.hideEditor||new rd(n,!0,!1,()=>{I(".jo_graphics").trigger("sizeChanged"),this.editor.editor.layout()}),this.editor=new wm(this,!1,!0),this.editor.initGUI(this.$monacoDiv),this.$monacoDiv.find(".monaco-editor").css("z-index","10"),e.attr("tabindex")==null&&e.attr("tabindex","0"),this.actionManager=new bm(e,this),this.actionManager.init(),this.bottomDiv=new vm(this,o,e),this.bottomDiv.initGUI(),this.rightDiv=new ub(this,this.$rightDivInner),this.rightDiv.initGUI();let p=I('<div class="jo_rightdiv-rightside-container">'),v=I('<div class="jo_coordinates">(0/0)</div>');this.$rightDivInner.append(p),p.append(v),this.debugger=new ym(this,this.$debuggerDiv,null),this.interpreter=new cb(this,this.debugger,new Sm(l,s),this.$runDiv);let w=I('<div class="jo_button jo_active img_ellipsis-dark" style="margin-left: 16px"></div>');l.append(w),w.on("mousedown",_=>{_.preventDefault(),_.stopPropagation(),wr([{caption:"Über die Online-IDE ...",link:"https://www.online-ide.de",callback:()=>{}}],_.pageX+2,_.pageY+2)}),setTimeout(()=>{this.interpreter.initGUI(),this.editor.editor.layout(),this.loadUserSpritesheet().then(()=>{this.compiler=new um(this),this.interpreter.controlButtons.speedControl.setSpeedInStepsPerSecond(this.config.speed),this.startTimer()})},200),this.config.hideEditor&&(t.hide(),n.css("flex","1"),this.config.hideStartPanel?e.find(".joe_controlsDiv").hide():(e.find(".joe_rightDivInner").css("height","calc(100% - 24px)"),e.find(".joe_controlsDiv").css("padding","2px"),e.find(".jo_speedcontrol-outer").css("z-index","10")))}makeBracketErrorDiv(){return I(`
        <div class="jo_parenthesis_warning" title="Klammerwarnung!" style="bottom: 55px">
        <div class="jo_warning_light"></div>
        <div class="jo_pw_heading">{ }</div>
        <div title="Letzten Schritt rückgängig" 
            class="jo_pw_undo img_undo jo_button jo_active"></div>
        </div>
        `)}makeCodeResetModalWindow(e){let t=I(`
            <div class="joe_codeResetModal">
            <div style="flex: 1"></div>
            <div style="display: flex">
                <div style="flex: 1"></div>
                <div style="padding-left: 30px;">
                <div style="color: red; margin-bottom: 10px; font-weight: bold">Warnung:</div>
                <div>Soll der Code wirklich auf den Ausgangszustand zurückgesetzt werden?</div>
                <div>Alle von Dir gemachten Änderungen werden damit verworfen.</div>
                </div>
                <div style="flex: 1"></div>
            </div>
            <div class="joe_codeResetModalButtons">
            <div class="joe_codeResetModalCancel jo_button jo_active">Abbrechen</div>
            <div class="joe_codeResetModalOK jo_button jo_active">OK</div>
            </div>
            <div style="flex: 2"></div>
            </div>
        `);return t.hide(),e.append(t),I(".joe_codeResetModalCancel").on("click",()=>{t.hide()}),I(".joe_codeResetModalOK").on("click",()=>{this.initScripts(),this.deleteScriptsInDB(),t.hide(),this.$resetButton.hide(),this.compileRunsAfterCodeReset=1}),t}showProgramPointerPosition(e,t){if(e==null)return;if(this.config.withFileList){let n=this.fileExplorer.files.find(s=>s.module.file==e);if(n==null)return;n.module!=this.getCurrentlyEditedModule()&&this.setModuleActive(n.module),this.programPointerModule=n.module}else this.programPointerModule=this.currentWorkspace.moduleStore.getFirstModule();let i={startColumn:t.column,startLineNumber:t.line,endColumn:t.column+t.length,endLineNumber:t.line};this.getMonacoEditor().revealRangeInCenterIfOutsideViewport(i),this.programPointerDecoration=this.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[{range:i,options:{className:"jo_revealProgramPointer",isWholeLine:!0}},{range:i,options:{beforeContentClassName:"jo_revealProgramPointerBefore"}}])}hideProgramPointerPosition(){this.getCurrentlyEditedModule()==this.programPointerModule&&this.getMonacoEditor().deltaDecorations(this.programPointerDecoration,[]),this.programPointerModule=null,this.programPointerDecoration=[]}makeFilesDiv(){let e=I('<div class="joe_bottomDivFiles jo_scrollable"></div>'),t=I('<div class="joe_filesHeader jo_tabheading jo_active"  style="line-height: 24px">Programmdateien</div>');return this.$filesListDiv=I('<div class="joe_filesList jo_scrollable"></div>'),e.append(t,this.$filesListDiv),e}startTimer(){this.timerHandle!=null&&clearInterval(this.timerHandle);let e=this;this.timerHandle=setInterval(()=>{e.compileIfDirty()},500)}compileIfDirty(){var e,t;if(this.currentWorkspace!=null&&this.currentWorkspace.moduleStore.isDirty()&&this.compiler.compilerStatus!=Za.compiling&&this.interpreter.state!=Re.running&&this.interpreter.state!=Re.paused)try{this.compiler.compile(this.currentWorkspace.moduleStore);let i=(t=(e=this.bottomDiv)==null?void 0:e.errorManager)==null?void 0:t.showErrors(this.currentWorkspace);this.editor.onDidChangeCursorPosition(null),this.printProgram(),this.version++;let n=this.interpreter.getStartableModule(this.currentWorkspace.moduleStore)!=null;n&&this.interpreter.state==Re.not_initialized&&(this.copyExecutableModuleStoreToInterpreter(),this.interpreter.setState(Re.done),this.config.hideStartPanel&&this.actionManager.trigger("interpreter.start")),!n&&(this.interpreter.state==Re.done||this.interpreter.state==Re.error)&&this.interpreter.setState(Re.not_initialized)}catch(i){console.error(i),this.compiler.compilerStatus=Za.error}}considerShowingCodeResetButton(){this.compileRunsAfterCodeReset++,this.compileRunsAfterCodeReset==3&&this.$resetButton.fadeIn(1e3)}printProgram(){this.bottomDiv.printModuleToBottomDiv(this.currentWorkspace,this.getCurrentlyEditedModule())}drawClassDiagrams(e){}copyExecutableModuleStoreToInterpreter(){let e=this.currentWorkspace.moduleStore.copy();this.interpreter.moduleStore=e,this.interpreter.moduleStoreVersion=this.version,this.interpreter.state==Re.not_initialized&&this.programIsExecutable&&this.interpreter.setState(Re.done)}saveWorkspaceToFile(){let e=prompt("Bitte geben Sie den Dateinamen ein",this.config.jsonFilename);if(e==null){alert("Der Dateiname ist leer, daher wird nichts gespeichert.");return}e.endsWith(".json")||(e=e+".json");let t=this.currentWorkspace;t.name.replace(/\//g,"_"),bc(t.toExportedWorkspace(),e)}makeBottomDiv(e,t){let i=I('<div class="jo_tabheadings"></div>');i.css("position","relative");let n=I('<div class="joe_tabheading-right jo_noHeading"></div>');if(n.append(t),this.config.withConsole){let a=I('<div class="img_clear-dark jo_button jo_active jo_console-clear"style="display: none; margin-left: 8px;" title="Console leeren"></div>');n.append(a)}if(this.config.withErrorList){let a=I('<div class="jo_tabheading jo_active" data-target="jo_errorsTab" style="line-height: 24px">Fehler</div>');i.append(a)}if(this.config.withConsole){let a=I('<div class="jo_tabheading jo_console-tab" data-target="jo_consoleTab" style="line-height: 24px">Console</div>');i.append(a)}if(this.config.withPCode){let a=I('<div class="jo_tabheading" data-target="jo_pcodeTab" style="line-height: 24px">PCode</div>');i.append(a)}i.append(n),e.append(i);let s=I('<div class="jo_tabs jo_scrollable"></div>');if(this.config.withErrorList){let a=I('<div class="jo_active jo_scrollable jo_errorsTab"></div>');s.append(a)}if(this.config.withConsole){let a=I(`
        <div class="jo_editorFontSize jo_consoleTab">
        <div class="jo_console-inner">
            <div class="jo_scrollable jo_console-top"></div>
            <div class="jo_commandline"></div>
        </div>
        </div>
    `);s.append(a)}if(this.config.withPCode){let a=I('<div class="jo_scrollable jo_pcodeTab">PCode</div>');s.append(a)}e.append(s)}loadWorkspaceFromFile(e){let t=this;if(e!=null){var i=new FileReader;i.onload=n=>{let s=n.target.result;if(!s.startsWith("{")){alert(`<div>Das Format der Datei ${e.name} passt nicht.</div>`);return}let a=JSON.parse(s);if(a.modules==null||a.name==null||a.settings==null){alert(`<div>Das Format der Datei ${e.name} passt nicht.</div>`);return}let l=new mn(a.name,this,0);l.settings=a.settings,l.alterAdditionalLibraries();for(let o of a.modules){let u={name:o.name,dirty:!1,saved:!0,text:o.text,text_before_revision:null,submitted_date:null,student_edited_after_revision:!1,version:1,is_copy_of_id:null,repository_file_version:null,identical_to_repository_version:null},h=new Ni(u,this);l.moduleStore.putModule(h)}t.currentWorkspace=l,t.fileExplorer!=null?(t.fileExplorer.removeAllFiles(),l.moduleStore.getModules(!1).forEach(o=>t.fileExplorer.addModule(o)),t.fileExplorer.setFirstFileActive()):this.setModuleActive(this.currentWorkspace.moduleStore.getFirstModule()),t.saveScripts()},i.readAsText(e)}}makeRightDiv(){let e=I('<div class="joe_rightDiv"></div>');if(this.$rightDivInner=I('<div class="joe_rightDivInner"></div>'),e.append(this.$rightDivInner),this.$debuggerDiv=I('<div class="joe_debuggerDiv"></div>'),this.$runDiv=I(`
            <div class="jo_tab jo_active jo_run">
            <div class="jo_run-programend">Programm beendet</div>
            <div class="jo_run-input">
            <div>
            <div>
        <div class="jo_run-input-message" class="jo_rix">Bitte geben Sie eine Zahl ein!</div>
        <input class="jo_run-input-input" type="text" class="jo_rix">
        <div class="jo_run-input-button-outer" class="jo_rix">
        <div class="jo_run-input-button" class="jo_rix">OK</div>
        </div>
        
        <div class="jo_run-input-error" class="jo_rix"></div>
    </div>
    </div>
    </div> 
    <div class="jo_run-inner">
    <div class="jo_graphics"></div>
    <div class="jo_output jo_scrollable"></div>
    </div>
    
    </div>
    
    `),this.config.hideEditor)this.$rightDivInner.append(this.$runDiv);else{let t=I('<div class="jo_tabheadings"></div>');t.css("position","relative");let i=I('<div class="jo_tabheading jo_active" data-target="jo_run" style="line-height: 24px">Ausgabe</div>'),n=I('<div class="jo_tabheading jo_console-tab" data-target="jo_variablesTab" style="line-height: 24px">Variablen</div>');t.append(i,n),this.$rightDivInner.append(t);let s=I('<div class="jo_scrollable jo_editorFontSize jo_variablesTab"></div>'),a=I(`
            <div class="jo_alternativeText jo_scrollable">
            <div style="font-weight: bold">Tipp:</div>
            Die Variablen sind nur dann sichtbar, wenn das Programm
            <ul>
            <li>im Einzelschrittmodus ausgeführt wird(Klick auf <span class="img_step-over-dark jo_inline-image"></span>),</li>
            <li>an einem Breakpoint hält (Setzen eines Breakpoints mit Mausklick links neben den Zeilennummern und anschließendes Starten des Programms mit 
                <span class="img_start-dark jo_inline-image"></span>) oder </li>
                <li>in sehr niedriger Geschwindigkeit ausgeführt wird (weniger als 10 Schritte/s).
                </ul>
                </div>
                `);s.append(this.$debuggerDiv,a);let l=I('<div class="jo_tabs jo_scrollable"></div>');l.append(this.$runDiv,s),this.$rightDivInner.append(l),Ao(e)}return e}getSemicolonAngel(){return this.semicolonAngel}async loadUserSpritesheet(){this.config.spritesheetURL!=null&&await new lb().initializeSpritesheetForWorkspace(this.currentWorkspace,this,this.config.spritesheetURL)}}const cI="/assets/spritesheet.json-3bb46aa8.txt",fI="/assets/spritesheet-fc4fee7d.png";class pI{constructor(){y(this,"startupComplete",2);y(this,"themeManager")}initGUI(){this.initTypes(),this.checkStartupComplete(),this.correctPIXITransform(),ge.RENDER_OPTIONS.hello=!1,this.themeManager=new lm}correctPIXITransform(){Pr.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var i=e.worldTransform,n=this.worldTransform;n.a=t.a*i.a+t.b*i.c,n.b=t.a*i.b+t.b*i.d,n.c=t.c*i.a+t.d*i.c,n.d=t.c*i.b+t.d*i.d,n.tx=t.tx*i.a+t.ty*i.c+i.tx,n.ty=t.tx*i.b+t.ty*i.d+i.ty,this._parentID=e._worldID,this._worldID++}}}initEditor(){new pc().init(),this.checkStartupComplete()}checkStartupComplete(){this.startupComplete--,this.startupComplete==0&&this.start()}initTypes(){U.init(),C.init(),se.init(),it.init(),G.init(),A.init(),P.init(),F.init(),Ge.init(),lc.init(),oc.init(),uc.init(),hc.init(),dc.init(),cc.init()}start(){this.initJavaOnlineDivs()}async initJavaOnlineDivs(){let e=[];I(".java-online").addClass("notranslate").each((t,i)=>{let n=I(i),s=[];n.find("script").each((a,l)=>{let o=I(l),u=o.attr("src"),h=o.text().trim(),d={title:o.attr("title"),text:h};o.data("type")=="hint"&&!d.title.endsWith(".md")&&(d.title+=".md"),u!=null&&(d.url=u),d.text=this.eraseDokuwikiSearchMarkup(d.text),s.push(d)}),e.push([n,s])});for(let t of e)await this.initDiv(t[0],t[1])}eraseDokuwikiSearchMarkup(e){return e.replace(/<span class="search\whit">(.*?)<\/span>/g,"$1")}async initDiv(e,t){for(let i of t)if(i.url!=null){const n=await fetch(i.url);i.text=await n.text()}new Ib(e,t)}}I(function(){let r=new pI,e="",t="lib/monaco-editor/dev/vs";window.javaOnlineDir!=null&&(e=window.javaOnlineDir),window.monacoEditorPath!=null&&(t=window.monacoEditorPath),window.require.config({paths:{vs:e+t}}),window.require.config({"vs/nls":{availableLanguages:{"*":"de"}},ignoreDuplicateModules:["vs/editor/editor.main"]}),window.require(["vs/editor/editor.main"],function(){r.initEditor(),r.initGUI()}),p5.disableFriendlyErrors=!0;let i="";window.javaOnlineDir!=null&&(i=window.javaOnlineDir),i.endsWith("/")&&(i=i.substring(0,i.length-1)),fetch(i+`${cI}`).then(n=>n.json()).then(n=>{yi.load(i+`${fI}`).then(s=>{n.meta.size.w=s.width,n.meta.size.h=s.height;let a=new ll(s,n);a.parse().then(()=>{yi.cache.set("spritesheet",a)})})}),yi.add("steve",i+"/assets/graphics/robot/minecraft_steve/scene.gltf"),yi.load(["steve"]),console.log("1.3.0")})});export default gI();
//# sourceMappingURL=online-ide-embedded.js.map
